webpackJsonp([0],{1291:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}var s=n(1),c=n.n(s),l=n(0),u=n.n(l),m=n(2),p=n.n(m),d=n(68),f=n(485),h=n(48),y=n(174),b=n(1323),v=(n.n(b),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),g={top:10,left:20},C={top:0,left:0},w=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={transEnded:!1,rect:null,translate:null,scale:null,url:null},e.getBoundingClientRect=function(){var t=e.props,n=t.img,o=t.data,r=n.getBoundingClientRect(),a=r.left,i=r.top,s=r.width,c=r.height,l=o.width,u=o.height,m={left:a,top:i,width:s,height:c},p=1;return l>u?(m.height=c,p=c/u,m.width=l*p,m.left=a+(s-m.width)/2,m.top=i+(c-m.height)/2):l<u&&(m.width=s,p=s/l,m.height=u*p,m.left=a+(s-m.width)/2,m.top=i+(c-m.height)/2),m},e.handleClick=e.handleClick.bind(e),e.handleTransEnd=e.handleTransEnd.bind(e),e.handleOriginLoad=e.handleOriginLoad.bind(e),e}return a(t,e),v(t,[{key:"componentWillMount",value:function(){f.a();var e=this.props,t=e.img,n=e.isOriginalUrl,o=this.loadImg=new Image;o.src=Object(d.a)(t.dataset.original,"r"),o.addEventListener("load",this.handleOriginLoad),this.setState({rect:!1===n?this.getBoundingClientRect():t.getBoundingClientRect()})}},{key:"componentDidMount",value:function(){var e=this,t=this.props.img,n=t.dataset.rawwidth,o=t.naturalWidth;setTimeout(function(){return e.setState(Object.assign({},e.computeTransition(e.state.rect,{width:n||o})))})}},{key:"componentWillUnmount",value:function(){this.loadImg.removeEventListener("load",this.handleOriginLoad),f.b()}},{key:"handleClick",value:function(){this.setState({translate:null,scale:null})}},{key:"handleTransEnd",value:function(){var e=this.state,t=e.translate,n=e.scale,o=this.props.onClose;t&&n?(this.setState({transEnded:!0}),this.scrollNode.style.overflow="auto"):o()}},{key:"handleOriginLoad",value:function(e){this.setState({url:e.target.src})}},{key:"computeTransition",value:function(e,t){var n=this.props,o=n.transitionType,r=n.data,a=Object(h.a)(navigator.userAgent).Mobile?C:g,s=a.top,c=a.left,l=window,u=l.innerWidth,m=l.innerHeight,p={left:0,top:0,width:u,height:m},d=i(p),f={width:p.width-2*c,height:p.height-2*s},y={},b={},v=void 0;return 1===o?(y.width=f.width>r.width?r.width:f.width,v=y.width/r.width,y.height=r.height*v,b={x:(f.width-y.width)/2+c,y:y.height<f.height?(f.height-y.height)/2+s:g.top}):(y.width=f.width>t.width?t.width:f.width,v=y.width/e.width,y.height=e.height*v,b={x:d.x-e.width/2,y:(y.height<f.height?d.y:g.top+y.height/2)-e.height/2}),{translate:b,scale:v}}},{key:"render",value:function(){var e=this,t=this.props,n=t.img,o=t.isOriginalUrl,r=t.data,a=t.transitionType,i=t.className,s=this.state,c=s.translate,l=s.scale,m=s.rect,f=s.url,b=s.transEnded,v=c&&l,w=1,E="",k=void 0;if(1===a){var O=Object(h.a)(navigator.userAgent).Mobile?C:g,P=O.left;k=Math.min(window.innerWidth-2*P,r.width);var j=m.width/k;E=v?"translate3d("+c.x+"px, "+c.y+"px, 0) scale3d(1, 1, 1) ":"translate3d("+m.left+"px, "+m.top+"px, 0) scale3d("+j+", "+j+", 1) ",w=v?1:0}else E=v?"translate3d("+c.x+"px ,"+c.y+"px,0) scale3d("+l+","+l+",1) ":"translate3d("+m.left+"px,"+m.top+"px,0)";return u.a.createElement(y.a,null,u.a.createElement("div",{className:p()("ImageView",i,{"is-active":v}),style:{paddingBottom:g.top},onClick:this.handleClick},u.a.createElement("div",{className:"ImageView-inner",ref:function(t){e.scrollNode=t}},u.a.createElement("img",{ref:function(t){e.imgEl=t},src:!1===o?Object(d.a)(n.dataset.original,"r"):b&&f||n.src,className:p()("ImageView-img",{"ImageView-transformOrigin":1===a}),style:{width:k||m.width,transform:E,opacity:w},onTransitionEnd:this.handleTransEnd,alt:"preview"}))))}}]),t}(l.Component);w.propTypes={img:c.a.object.isRequired,onClose:c.a.func.isRequired},t.a=w},1293:function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=e.className,n=e.meta,r=e.children,a=l()(e,["className","meta","children"]),i=p.Children.only(r),s=i.type.displayName,c={className:h()("Tabs-link",i.props.className)};return void 0!==n&&(c.children=[].concat(o(p.Children.toArray(i.props.children)),[d.a.createElement("span",{key:"meta",className:"Tabs-meta"},n)])),"Link"!==s&&"IndexLink"!==s||(c.activeClassName="is-active"),d.a.createElement("li",Object.assign({role:"tab",className:h()("Tabs-item",t,{"Tabs-item--noMeta":void 0===n})},a),Object(p.cloneElement)(i,c))}n.d(t,"a",function(){return s});var c=n(13),l=n.n(c),u=n(1),m=n.n(u),p=n(0),d=n.n(p),f=n(2),h=n.n(f),y=n(1343),b=(n.n(y),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),v=function(e){function t(){return r(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),b(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.onRef,o=l()(e,["className","onRef"]);return d.a.createElement("ul",Object.assign({ref:n,role:"tablist",className:h()("Tabs",t)},o))}}]),t}(p.Component);s.propTypes={meta:m.a.node},t.b=v},1295:function(e,t,n){"use strict";var o=n(0),r=n.n(o),a=n(2),i=n.n(a),s=(n(1341),function(e){var t=e.avatar,n=e.bottom,o=e.button,a=e.className,s=e.height,c=e.icon,l=e.inline,u=e.right,m=e.style,p=void 0===m?{}:m,d=e.title,f=e.width,h=Object.assign({},p);return f&&(h.width=f+"px"),s&&(h.height=s+"px"),n&&(h.marginBottom=n+"px"),u&&(h.marginRight=u+"px"),r.a.createElement("div",{className:i()("Holder",a,{"Holder--inline":l,"Holder--title":d,"Holder--icon":c,"Holder--button":o,"Holder--avatar":t}),style:h})}),c=s;n.d(t,"a",function(){return c})},1311:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d,f,h,y,b,v,g=n(0),C=n.n(g),w=n(1),E=n.n(w),k=n(5),O=n(8),P=n(72),j=n(21),S=n(112),N=(n(1373),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),R=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_={all:"开放评论",censor:"预审评论",nobody:"关闭评论"},I={all:"允许任何人评论",follower:"允许关注我的人评论",censor:"评论由我筛选后显示",followee:"允许我关注的人评论",paid:"付费用户可评论",nobody:"关闭评论"},T=(d=Object(k.connect)(function(e){return{isOrg:Object(j.f)(e)}}))((y=h=function(e){function t(){var e,n,i,s;r(this,t);for(var c=arguments.length,l=Array(c),u=0;u<c;u++)l[u]=arguments[u];return n=i=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.handleClickOption=function(e){var t=i.props,n=t.isOrg,o=t.target,r=t.onChange,a=t.current;if(e!==a){if(!o)return void r(e);var s=o.id;o.adminClosedComment?Object(S.b)("此内容无法更改评论权限",{theme:"red-ghost"}):n||"censor"!==e&&"censor"!==a?r(s,e):Object(S.a)("你确定要更改评论权限吗？",{content:"censor"===e?"更改后，已有评论不变，新评论需要经过筛选才会公开显示":"更改后，所有待筛选评论都会被公开显示出来"}).then(function(){return r(s,e)}).catch(function(){return null})}},i.getCommentPermission=function(){var e=i.props.target,t=e&&"answer"===e.type&&"paid"===e.answerType;return Object.keys(I).filter(function(n){if("paid"!==n||t)return"follower"!==n||e&&"article"===e.type}).reduce(function(e,t){return N({},e,o({},t,I[t]))},{})},s=n,a(i,s)}return i(t,e),R(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.isOrg,o=t.current,r=n?_:this.getCommentPermission();return C.a.createElement(g.Fragment,null,Object.keys(r).map(function(t){var n=t===o;return C.a.createElement(P.b,{key:t,onClick:function(){return e.handleClickOption(t)},className:"CommentPermission-item"},n&&C.a.createElement(O.w,{text:!0,center:!0}),r[t])}))}}]),t}(g.Component),h.propTypes={current:E.a.string.isRequired,target:E.a.object,onChange:E.a.func.isRequired},f=y))||f,x=T,B=n(42),A=n(1374),L=n.n(A),M=n(168),D=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),F=(b=Object(M.a)({view:{id:3038},trackCardShow:!0}))(v=function(e){function t(){return s(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),D(t,[{key:"render",value:function(){return C.a.createElement("img",{src:L.a,style:{maxWidth:"200px",marginTop:"30px"},alt:"delete-comment-success"})}}]),t}(g.Component))||v;F.showModal=function(e){B.b.open(function(t){var n=e||{},o=n.reportText;return setTimeout(t,2e3),C.a.createElement(B.b,{title:"举报成功",onClose:t},C.a.createElement("div",{style:{textAlign:"center"}},C.a.createElement("div",null,o||"你的举报我们已经收到，处理完成后将会私信告知处理结果。"),C.a.createElement(F,null)))})};var q=F,z=n(3),V=n(268),U=(n(1375),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),W=function(e){function t(){var e,n,o,r;u(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=m(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={reportModalShown:!1},o.handleSubmit=function(){var e=o.props,t=e.id,n=e.onDelete,r=e.onClose;n(t),r()},o.handleReportModalOpen=function(){return o.setState({reportModalShown:!0})},o.handleReportModalClose=function(){o.setState({reportModalShown:!1}),o.handleSubmit()},o.handleSuccess=function(){o.handleSubmit()},r=n,m(o,r)}return p(t,e),U(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.shown,o=e.onClose,r=e.reportAndDeleteExperiment;return C.a.createElement(g.Fragment,null,C.a.createElement(B.b,{title:"你确定要删除这条评论吗？",closeButton:null,maskClosable:!1,hotKeyClosable:!1,onClose:o,footer:r&&C.a.createElement("div",{className:"CommentDeleteAndReport-extra"},"评论若构成举报条件可以",C.a.createElement(z.c,{preset:"link",onClick:this.handleReportModalOpen},"删除并举报"))},n&&C.a.createElement(B.a,{direction:"horizontal"},C.a.createElement(z.c,{onClick:o},"取消"),C.a.createElement(z.c,{preset:"primary",color:"blue",onClick:this.handleSubmit},"确定"))),C.a.createElement(V.a,{title:"删除成功，请选择举报理由",subtitle:"",shown:this.state.reportModalShown,type:"comment",urlToken:t,zaEnabled:!0,onSuccess:this.handleSuccess,onClose:this.handleReportModalClose}))}}]),t}(g.Component),H=W;n.d(t,"c",function(){return x}),n.d(t,"a",function(){return H}),n.d(t,"b",function(){return q})},1323:function(e,t){},1338:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l,u,m=n(1),p=n.n(m),d=n(0),f=n.n(d),h=n(48),y=n(18),b=n(6),v=n(515),g=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},w=function(e,t,n,o){return e?{card:{content:e}}:C({},t&&{card:t},n&&{list:n},o&&{attached_info_bytes:o})},E=(u=l=function(e){function t(){var e,n,a,i;o(this,t);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];return n=a=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.handleViewed=function(){var e=a.props.extra;setTimeout(function(){b.default.trackCardShow(a,{},e)})},a.trackEvent=function(e,t,n){b.default.trackEvent(e,t,C({},a.props.extra,n))},i=n,r(a,i)}return a(t,e),g(t,[{key:"componentDidMount",value:function(){this.setModule()}},{key:"componentDidUpdate",value:function(){this.setModule()}},{key:"setModule",value:function(){var e=this.props,t=e.module,n=e.index,o=e.isAd,r=e.moduleName,a=e.content,i=e.list,s=e.card,c=e.attachedInfoBytes;if(t){var l=Object(y.findDOMNode)(this);l&&b.default.setModule(l,{module:t,index:n,is_ad:o,module_name:r},w(a,s,i,c))}}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.trackCardShow,o=e.children,r="string"==typeof o.type?o:Object(d.cloneElement)(o,{trackEvent:this.trackEvent});return n?f.a.createElement(v.a,{id:t,onViewed:this.handleViewed},r):r}}]),t}(d.Component),l.propTypes={id:p.a.string,module:p.a.string,index:p.a.string,isAd:p.a.bool,content:p.a.object,extra:p.a.object,trackCardShow:p.a.bool,attachedInfoBytes:p.a.string},l.defaultProps={id:null,module:null,index:null,isAd:!1,content:null,extra:null,attachedInfoBytes:null,trackCardShow:!1},u),k=E,O=(function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}}(),n(169)),P=n(492),j=n(79);n(1372);n.d(t,"a",function(){return B});var S,N,R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),T={zhihu:"注册或登录",wechat:"使用微信快速登录",weibo:"使用微博快速登录",qq:"使用 QQ 快速登录"},x={qq:"qqconn",weibo:"sina",wechat:"wechat_mp"},B=(N=S=function(e){function t(){var e,n,o,r;i(this,t);for(var a=arguments.length,c=Array(a),l=0;l<a;l++)c[l]=arguments[l];return n=o=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),o.jumpToOAuthUrl=function(e){var t=o.props,n=t.redirectUrl,r=void 0===n?location.href:n,a=t.edition,i=t.utm,s=Object(j.b)(r,a,i),c=s.utmSource,l=s.refSource,u=Object(h.a)(navigator.userAgent),m=u.isZhihu;if("zhihu"===e)return void(location.href=m?"zhihu://signin?next="+r:"https://www.zhihu.com/signin?next="+r+(c?"?utm_source="+c:""));location.href="https://www.zhihu.com/oauth/redirect/login/"+x[e]+"?next=/oauth/account_callback&from="+encodeURIComponent(r)+"&utm_source="+c+"&ref_source="+l},o.renderSignButtons=function(){var e=o.props.buttons;return"string"==typeof e?o.renderSingleSignButton({name:e}):e.map(function(e){return"string"==typeof e?o.renderSingleSignButton({name:e}):"object"===(void 0===e?"undefined":_(e))?o.renderSingleSignButton(e):null})},o.renderSingleSignButton=function(e){var t=e.name,n=e.text,r=e.fill,a=e.color,i="#fff"===r||"#ffffff"===r;return-1===Object.keys(T).indexOf(t)?null:f.a.createElement("button",{className:"SignInModal-button-"+t,key:t,style:{backgroundColor:r,borderColor:i?"#0f88eb":r,color:i?"#0f88eb":a},onClick:function(){o.jumpToOAuthUrl(t)}},n||T[t])},r=n,s(o,r)}return c(t,e),I(t,[{key:"render",value:function(){var e=this.props,t=e.onClose,n=e.utm,o=e.edition,r=o.yidianzixun,a=o.baidu,i=e.urlScheme,s=this.props.title||(a||!i?"":"打开 App 或")+"登录后继续操作";return r&&(s="打开知乎 App 继续操作"),f.a.createElement(O.b,{size:"small",className:"SignInModal",title:s,onClose:t},f.a.createElement(k,{module:"SignForm",moduleName:s,trackCardShow:!0},f.a.createElement("div",{className:"SignInModal-content"},i&&!a&&f.a.createElement(P.a,R({className:"SignInModal-openInAppButton",href:i},n),"立即打开",r?"":" App"),!r&&this.renderSignButtons())))}}]),t}(d.Component),S.propTypes={onClose:p.a.func.isRequired,urlScheme:p.a.string,redirectUrl:p.a.string,edition:p.a.object,buttons:p.a.oneOfType([p.a.array,p.a.string])},S.defaultProps={buttons:["zhihu"],edition:{},utm:{}},N)},1341:function(e,t){},1343:function(e,t){},1344:function(e,t,n){"use strict";var o=n(0),r=n.n(o),a=n(2),i=n.n(a),s=n(1376);n.n(s);t.a=function(e){var t=e.header,n=e.options,o=e.className,a=e.onRef,s=e.showOptions,c=void 0===s||s;return r.a.createElement("div",{className:i()("Topbar",o,!1),ref:a},r.a.createElement("div",{className:"Topbar-title"},t),c&&r.a.createElement("div",{className:"Topbar-options"},n))}},1372:function(e,t){},1373:function(e,t){},1374:function(e,t,n){e.exports=n.p+"assets/deleteComment.97d8abc0.gif"},1375:function(e,t){},1376:function(e,t){},1396:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),c=n(2),l=n.n(c),u=n(77),m=n.n(u),p=(n(1431),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),d=function(e){function t(){var e;o(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];var s=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a)));return s.state={uid:m()()},s.handleChange=function(e){var t=e.target.files;t&&s.uploadFiles(t),s.setState({uid:m()()})},s.uploadFiles=function(e){var t=s.props.multiple,n=m()(),o=Array.prototype.slice.call(e);if(!t)return void s.upload(o[0],n);o.map(function(e){s.upload(e,n)})},s.upload=function(e,t){var n=s.props,o=n.beforeUpload,r=n.customUpload,a=n.onStart,i=n.onSuccess,c=n.onError,l=void 0;if(o&&(l=o(e)),!1!==l&&r){var u={file:e,uid:t,status:"uploading"};a&&a(u),Promise.resolve().then(function(){return r({file:e})}).then(function(e){i&&i(Object.assign({},u,{remoteInfo:e,status:"success"}))}).catch(function(e){c&&c(Object.assign({},u,{remoteInfo:e,status:"error"}))})}},s}return a(t,e),p(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.accept,o=e.multiple,r=e.disabled,a=e.onRef,i=e.onClick,c=e.children;return s.a.createElement("label",{className:l()("UploadPicture-wrapper",t)},s.a.createElement("input",{type:"file",accept:n,multiple:o,className:"UploadPicture-input",disabled:r,ref:a,onChange:this.handleChange,onClick:i}),c)}}]),t}(s.a.Component);d.defaultProps={multiple:!1,disabled:!1},n.d(t,"a",function(){return d})},1431:function(e,t){},1482:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var r=n(539),a=o(r),i=n(540),s=o(i);e.exports={TransitionGroup:s.default,CSSTransitionGroup:a.default}},1483:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var u=n(0),m=n.n(u),p=n(2),d=n.n(p),f=n(3),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),y=function(e){function t(){var e;o(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];var s=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a)));return s.handleClick=function(){var e=s.props;(0,e.onSelect)(e.page)},s}return a(t,e),h(t,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.isCurrent,o=e.className;return m.a.createElement(f.c,{preset:f.b.Plain,className:d()("PaginationButton",{"PaginationButton--current":n},o),onClick:this.handleClick,disabled:n},t)}}]),t}(u.Component),b=(n(1497),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.from({length:t},function(t,n){return n+e})},g=function(e,t){return t<=5?v(1,t):e>t-3?[1,"..."].concat(l(v(t-3,3)),[t]):e<=3?[1].concat(l(v(2,3)),["...",t]):[1,"..."].concat(l(v(e-Math.floor(1.5),3)),["...",t])},C=function(e,t){return function(){e.apply(void 0,arguments)}},w=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),b(t,[{key:"render",value:function(){var e=this.props,t=e.onSelect,n=e.className,o=e.clickCallback,r=this.props.current,a=this.props.total,i=o&&C(o),s=i||t,c=g(r,a);return m.a.createElement("div",{className:d()("Pagination",n)},r>1&&r<=a&&m.a.createElement(y,{className:"PaginationButton-prev",onSelect:s,text:"上一页",page:r-1}),c.map(function(e,t){return"number"==typeof e?m.a.createElement(y,{onSelect:s,text:e,page:e,key:t,isCurrent:r===e}):m.a.createElement("button",{disabled:!0,key:t,className:"PaginationButton PaginationButton--ellipsis"},e)}),r>0&&r<a&&m.a.createElement(y,{className:"PaginationButton-next",onSelect:s,text:"下一页",page:r+1}))}}]),t}(u.Component);w.defaultProps={current:1,total:1,onSelect:function(){}},n.d(t,"a",function(){return w}),n.d(t,!1,function(){return g})},1497:function(e,t){},1680:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var p,d,f,h,y=n(0),b=n.n(y),v=n(1),g=n.n(v),C=n(2),w=n.n(C),E=n(1293),k=n(3),O=n(260),P=n(1344),j=n(8),S=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),N={normal:{text:"默认排序",value:"reverse"},reverse:{text:"时间排序",value:"normal"}},R=(d=p=function(e){function t(){var e,n,a,i;o(this,t);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];return n=a=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.state={text:"时间排序",value:"normal"},a.switchType=function(e){var t=a.state.value,n=a.props.onOrderChange,o=N[t],r=o.text,i=o.value;a.setState({text:r,value:i}),n&&n(i,e)},i=n,r(a,i)}return a(t,e),S(t,[{key:"render",value:function(){var e=this.state.text,t=this.props,n=t.isConversation,o=t.commentClosed;return t.shouldReverse?!n&&!o&&b.a.createElement(k.c,{preset:"plain",onClick:this.switchType,icon:j._65,label:"切换为"+e}):null}}]),t}(y.Component),p.propTypes={isConversation:g.a.bool,commentClosed:g.a.bool,onOrderChange:g.a.func,shouldReverse:g.a.bool},d),_=n(29),I=(n(2356),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),T=(h=f=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),I(t,[{key:"render",value:function(){var e=this.props,t=e.commentPattern,n=e.onNavBack;return b.a.createElement("h2",{className:"CommentTopbar-title"},"bottom"!==t?b.a.createElement(k.c,{className:"CommentTopbar-back",preset:"plain",onClick:n},b.a.createElement(_.a,{className:"CommentTopbar-backIcon",name:"arrowLeft",left:!0,width:14,height:14}),"返回评论"):b.a.createElement("div",null,"查看对话"))}}]),t}(y.Component),f.propTypes={commentPattern:g.a.string,onNavBack:g.a.func},h);n(2357);n.d(t,"a",function(){return L});var x,B,A=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),L=(B=x=function(e){function t(){var e,n,o,r;l(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.renderTopBarSwitch=function(){var e=o.props,t=e.isMobile,n=e.status,r=e.isConversation,a=e.commentCount,i=e.onOrderChange,s=e.commentClosed,c=e.shouldReverse,l=a&&!s;return!t&&Boolean(l)&&"reviewing"!==n&&b.a.createElement(R,{isConversation:r,onOrderChange:i,commentClosed:s,shouldReverse:c})},r=n,u(o,r)}return m(t,e),A(t,[{key:"renderTitle",value:function(){var e=this.props,t=e.commentCount,n=e.commentClosed,o=e.isConversation,r=e.onNavBack,a=e.targetLink,i=e.isCommentReviewer,s=e.reviewingCounts,c=e.onStatusChange,l=e.status,u=e.commentPattern,m=e.isOrg,p=e.isMobile,d=e.isBaidu;return o?b.a.createElement(T,{commentPattern:u,onNavBack:r}):i&&!n?b.a.createElement("div",{className:"CommentTopbar-tabsWrapper"},b.a.createElement(E.b,{className:"CommentTopbar-tabs"},b.a.createElement(E.a,{className:"CommentTopbar-tab","aria-controls":"CommentTopbar-open",meta:Object(O.a)(t)},b.a.createElement(k.c,{className:w()("CommentTopbar-tabButton",{"is-active":"open"===l}),onClick:function(){return c("open")}},"公开评论")),!p&&b.a.createElement(E.a,{className:"CommentTopbar-tab","aria-controls":"CommentTopbar-reviewing",meta:void 0===s?null:Object(O.a)(s)},b.a.createElement(k.c,{className:w()("CommentTopbar-tabButton",{"is-active":"reviewing"===l}),onClick:function(){return c("reviewing")}},"待"+(m?"审核":"筛选")+"评论"))),a):b.a.createElement(y.Fragment,null,b.a.createElement("h2",{className:"CommentTopbar-title"},t&&!n?Object(O.a)(t)+" 条评论":"还没有评论",a),d&&this.renderTopBarSwitch())}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.onRef,o=e.isMobile,r=e.isBaidu,a=e.options;return b.a.createElement(P.a,{className:w()("CommentTopbar",t),onRef:n,header:this.renderTitle(),options:r?a:this.renderTopBarSwitch(),showOptions:!o})}}]),t}(y.Component),x.propTypes={commentCount:g.a.oneOfType([g.a.number,g.a.string]),isConversation:g.a.bool,onNavBack:g.a.func,isCommentReviewer:g.a.bool,onStatusChange:g.a.func,onOrderChange:g.a.func,status:g.a.string,reviewingCounts:g.a.oneOfType([g.a.number,g.a.string]),targetLink:g.a.node,commentClosed:g.a.bool,commentPattern:g.a.string,isOrg:g.a.bool,isMobile:g.a.bool,isBaidu:g.a.bool,options:g.a.element,shouldReverse:g.a.bool},x.defaultProps={shouldReverse:!0},B)},1817:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.selectedKey,i=void 0===r?"selectedProps":r,s=n.dropedKey,c=void 0===s?"dropedProps":s;return Object.keys(e).reduce(function(n,r){var s=t.includes(r)?i:c;return a({},n,o({},s,a({},n[s],o({},r,e[r]))))},{})}t.a=r;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}},1818:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(e){return"article"===e?"Post":"book_review"===e?"BookReview":""+e.slice(0,1).toUpperCase()+e.slice(1)}},1861:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return m});var i=n(0),s=n.n(i),c=n(180),l=n(2355),u=(n.n(l),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),m=function(e){function t(){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"render",value:function(){var e=this.props.onRef;return s.a.createElement("div",{className:"Comments-pattern-loading",ref:e},s.a.createElement(c.a,null))}}]),t}(i.PureComponent)},2048:function(e,t){e.exports={attributes:{width:"72px",height:"58px",viewBox:"0 0 72 58"},content:'<defs>         <path d="M0.00434937116,11.7604183 C0.0014585125,11.8367351 0,11.9134174 0,11.9904392 L0,52.0095608 C0,55.3137533 2.68603825,58 5.99943435,58 L66.0005656,58 C69.3089213,58 72,55.317989 72,52.0095608 L72,11.9904392 C72,8.68624675 69.3139617,6 66.0005656,6 L31.1520961,6 L30.2346555,3.7077864 C29.4154984,1.66113281 26.9585394,0 24.7478675,0 L6.18638069,0 C2.86742525,0 0.139552484,2.68348852 0.0902454792,5.99373937 L0.00434937116,11.7604183 Z" id="path-1"></path>         <mask id="mask-2" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="72" height="58" fill="white">             <use xlink:href="#path-1"></use>         </mask>     </defs>     <g id="空状态" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">         <g id="collection" transform="translate(-39.000000, -30.000000)" stroke="#E7EAF1">             <g transform="translate(39.000000, 30.000000)" id="Group-7">                 <g>                     <use id="Combined-Shape" mask="url(#mask-2)" stroke-width="6" xlink:href="#path-1"></use>                     <path d="M36.4126782,38.4800003 L30.2669271,41.2927815 C29.7656337,41.522213 29.4096881,41.2718295 29.4738593,40.716584 L30.2498317,34.0024302 L25.6755762,29.0266708 C25.3024658,28.6208107 25.4306014,28.2049135 25.9785012,28.0943637 L32.6038296,26.7575697 L35.9225353,20.8696 C36.1932338,20.3893332 36.6283715,20.3826781 36.9028211,20.8696 L40.2215268,26.7575697 L46.8468552,28.0943637 C47.3872665,28.2034026 47.5280608,28.6151866 47.1497802,29.0266708 L42.5755247,34.0024302 L43.3514971,40.716584 C43.4147912,41.2642406 43.0666691,41.5253922 42.5584293,41.2927815 L36.4126782,38.4800003 Z" id="Star" stroke-width="3"></path>                 </g>             </g>         </g>     </g>'}},2049:function(e,t){},2346:function(e,t){},2347:function(e,t){},2348:function(e,t){},2349:function(e,t){},2350:function(e,t){},2351:function(e,t){},2352:function(e,t){},2353:function(e,t){},2354:function(e,t){},2355:function(e,t){},2356:function(e,t){},2357:function(e,t){},2358:function(e,t){},2359:function(e,t,n){function o(e,t,n){var o=null==e?0:e.length;if(!o)return-1;var l=o-1;return void 0!==n&&(l=i(n),l=n<0?s(o+l,0):c(l,o-1)),r(e,a(t,3),l,!0)}var r=n(311),a=n(107),i=n(313),s=Math.max,c=Math.min;e.exports=o},2360:function(e,t){},2361:function(e,t){},2362:function(e,t){},2363:function(e,t){},2364:function(e,t){},2365:function(e,t){},2366:function(e,t){},2367:function(e,t){},2368:function(e,t){},2393:function(e,t){},2394:function(e,t){},2395:function(e,t){},2396:function(e,t){},2897:function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e,t){switch(e){case"answer":return Object(Z.l)(t);case"article":return Object(J.b)(t);default:return null}}function f(e,t){var n=t.parent,o=t.parent,r=o.type,a=o.id,i=t.status,s=t.order,c=t.byComment,l=t.commentPattern,u=e.entities,m=e.comments,p=e.env.userAgent.BaiduApp,d=r+"_"+a,f=m.parent,h=m.pagination;"reviewing"===i&&(h=m.reviewing),"reverse"===s&&"open"===i&&(h=m.reverse);var y=[],b=m.collapsed[d]||{};b&&b.ids&&b.ids.length>0&&(y=b.ids.map(function(e){return u.comments[e]}));var v=h[d]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},g=v.isFetching,C=v.isPrevDrained,w=v.isDrained,E=v.ids,k=v.newIds,O=void 0===k?[]:k,P=v.totals,j="bottom"!==l?E:O,S=j.map(function(e){return u.comments[e]}),N=Object(Q.d)(e);return{isFetching:g,isPrevDrained:C,isDrained:w,totals:P,comments:S,collapsedInfo:b,collapsedComments:y,targetComment:u.comments[c],parent:qe({},n,f[d]),isBaidu:p||N.baidu||N.baiduBeijing,referer:Object(Q.g)(e),edition:N}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function v(e,t){var n=t.commentId,o=e.entities.comments,r=e.comments.conversation,a=r[n]||{isFetching:!1,isDrained:!1,ids:[]};return{isFetching:a.isFetching,isDrained:a.isDrained,comments:a.ids.map(function(e){return o[e]}),openComment:o[n]}}function g(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var k,O,P,j,S=n(1),N=n.n(S),R=n(0),_=n.n(R),I=n(5),T=n(2),x=n.n(T),B=n(544),A=n(1482),L=n(6),M=n(175),D=n(105),F=n.n(D),q=n(8),z=n(492),V=n(261),U=n(1483),W=n(3),H=n(260),G=n(497),K=n(17),Q=n(70),Z=n(171),J=n(490),Y=n(279),$=n(19),X=n(486),ee=n.n(X),te=n(31),ne=n(169),oe=n(514),re=(n(2346),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),ae=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ie=function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["回复","",""],["回复","",""]),se="zhihu::comment_local_key",ce=5,le=function(){return""},ue=(k=Object(I.connect)(function(e){return{edition:Object(Q.d)(e),referer:Object(Q.g)(e),shouldOia:Object(Q.h)(e)}}),Object($.withRouter)(O=k((j=P=function(e){function t(e,n){r(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.initLocalComment=function(){var e=i.props,t=e.type,n=e.id;if(t&&n){var o=te.a.get(se)||[],r=t+"_"+n,a=o.find(function(e){return e.key===r}),s=a&&a.value;s&&i.setState({value:{toHTML:function(){return s}},disabled:!1})}},i.saveLocalComment=function(e){var t=i.props,n=t.type,r=t.id;if(n&&r){var a=e?e.toHTML():i.state.value.toHTML(),s=n+"_"+r,c=(te.a.get(se)||[]).filter(function(e){return e.key!==s}),l=a?[].concat(o(c.slice(0,ce-1)),[{key:s,value:a}]):c;te.a.set(se,l)}},i.handleChange=function(e){i.setState({value:e,disabled:e.isEmpty})},i.handleCommentShow=i.context.authRequired(function(){i.setState({shown:!0}),i.hiddenInput.focus()}),i.handleCommentHide=function(){i.setState({shown:!1})},i.handleMobileComment=function(){i.onSubmit(),i.handleCommentHide()},i.onChange=i.handleChange.bind(i),i.onFocus=i.handleFocus.bind(i),i.onBlur=i.handleBlur.bind(i),i.onSubmit=i.context.authRequired(i.handleSubmit.bind(i),void 0,K.b),i.state={active:e.defaultActive,disabled:!0,shown:!1,value:{toHTML:le}},i}return i(t,e),ae(t,[{key:"componentDidMount",value:function(){this.initLocalComment()}},{key:"componentWillUnmount",value:function(){this.saveLocalComment()}},{key:"handleFocus",value:function(){this.setState({active:!0})}},{key:"handleBlur",value:function(){var e=this;setTimeout(function(){return e.setState({active:!1})},100)}},{key:"handleSubmit",value:function(){var e=this,t=this.props,n=t.replyTo,o=t.onSubmit,r=t.onCancel,a=this.input.toHTML();if(a&&o){this.saveLocalComment();var i=o(a,n);i.then?i.then(function(){r&&r(),e.input?(e.input.reset(),e.setState({value:{toHTML:le}},function(){return e.saveLocalComment()})):e.saveLocalComment({toHTML:le})}):(r&&r(),this.input.reset()),L.default.trackEvent(this,{action:"Comment",element:"Button"})}}},{key:"renderInput",value:function(e){var t=this,n=e.placeholder,o=e.className,r=this.props.autoFocus;return _.a.createElement(oe.a,{className:x()("CommentEditor-input",o),defaultValue:this.state.value.toHTML(),richtext:!0,large:!0,spread:!0,allowMention:!0,autoFocus:Boolean(!1)||r,outputBlockType:"div",onRef:function(e){t.input=e},placeholder:n,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,onSubmit:this.onSubmit,minRows:5})}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,o=e.className,r=(e.onClick,e.onCancel),a=e.ownerAuthorIsOrg,i=e.ownerAuthorIsBrand,s=(e.type,e.id,e.edition,e.shouldOia,e.location.query,e.referer,e.preset,this.state),c=s.active,l=s.disabled,u=a?"机构":"作者";if(t){var m=ee()(ie,t.author.member.name,n?"，评论由"+u+"筛选后公开":"");return _.a.createElement("div",{className:x()(o,"CommentEditor--inCommentItem",{"CommentEditor--active":c})},this.renderInput({placeholder:m}),_.a.createElement("div",{className:"CommentEditor-actions"},_.a.createElement(W.c,{preset:"plain",onClick:r},"取消"),_.a.createElement(W.c,{preset:"primary",color:"blue",onClick:this.onSubmit,disabled:l},"评论")))}var p="写下你的评论...";n&&(p=i?"已开启预审评论，评论由品牌筛选后公开":a?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示");var d=(x()(o,"CommentEditor--normal"),this.state.shown,{preset:"primary",color:"blue",children:"评论",disabled:l});return _.a.createElement("div",{className:x()(o,"CommentEditor--normal",{"CommentEditor--active":c})},this.renderInput({placeholder:p}),_.a.createElement(W.c,re({},d,{className:"CommentEditor-singleButton",onClick:this.onSubmit})))}}]),t}(R.Component),P.contextTypes={authRequired:N.a.func},O=j))||O)||O);ue.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1},ue.propTypes={className:N.a.string,defaultActive:N.a.bool,replyTo:N.a.object,inCommentItem:N.a.bool,commentNeedsReview:N.a.bool,canComment:N.a.object,onCancel:N.a.func,onSubmit:N.a.func.isRequired};var me,pe,de,fe,he,ye,be,ve,ge,Ce,we,Ee,ke,Oe=ue,Pe=(n(72),n(1338),n(481)),je=n(10),Se=n(268),Ne=n(262),Re=n(170),_e=n(1311),Ie=n(112),Te=n(564),xe=(n(2354),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),Be=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Ae=(me=Object(I.connect)(function(e){return{edition:Object(Q.d)(e),referer:Object(Q.g)(e),isWechat:e.env.userAgent.Wechat}}),Object($.withRouter)(pe=me((fe=de=function(e){function t(){var e,n,o,r;s(this,t);for(var a=arguments.length,i=Array(a),l=0;l<a;l++)i[l]=arguments[l];return n=o=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={reportModalShown:!1,isReplying:!1,collapsed:!0,guideShown:!1},o.getRedirectUrl=function(){var e=o.props.parent;switch(e.type){case"answer":return"/question/"+e.question.id+"/answer/"+e.id;case"article":return"https://zhuanlan.zhihu.com/p/"+e.id;default:return""}},o.like=o.context.authRequired(function(e){var t=o.props;(0,t.onLike)(t.comment.id,e)},je.L.like,K.b),o.dislike=o.context.authRequired(function(){var e=o.props;(0,e.onDislike)(e.comment.id)},je.L.like,K.b),o.delete=function(){var e=o.props;(0,e.onDelete)(e.comment.id)},o.feature=function(){var e=o.props;(0,e.onFeature)(e.comment.id)},o.collapse=function(){var e=o.props;(0,e.onCollapse)(e.comment.id)},o.approve=function(){var e=o.props;(0,e.onApprove)(e.comment.id)},o.showConversation=function(){var e=o.props;(0,e.onShowConversation)(e.comment.id)},o.startReply=o.context.authRequired(function(){o.setState({isReplying:!0})},void 0,K.b),o.stopReply=function(){o.setState({isReplying:!1})},o.openReportModal=o.context.authRequired(function(){o.setState({reportModalShown:!0})}),o.closeReportModal=function(e){if(e){var t=e.result.payload,n=t&&t.message||t&&t.code&&"举报失败";e.commentDeleteResult&&!(e.commentDeleteResult.payload||{}).code?_e.b.showModal({reportText:n}):Object(Ie.b)(n||"举报成功")}o.setState({reportModalShown:!1})},o.handleExpand=function(){o.setState({collapsed:!1})},o.handleToggleGuide=function(){o.setState({guideShown:!o.state.guideShown})},o.handleDelete=function(){return o.setState({deleteModal:!0})},o.handleCloseDelete=function(){return o.setState({deleteModal:!1})},r=n,c(o,r)}return l(t,e),Be(t,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:_.a.createElement("span",{className:"CommentItem-roleInfo"},"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) ")}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var o=t.member,r=void 0===o?{}:o,a=t.role;return _.a.createElement("span",null,_.a.createElement("span",{className:"CommentItem-reply"},"回复"),_.a.createElement(Re.a,{className:x()({"CommentItem-userLink":!1}),noBadge:!0,noHoverCard:!0,user:r}),this.renderRoleInfo(a,n))}},{key:"renderInner",value:function(){var e=this,t=this.props,n=t.comment,o=n.isDelete,r=n.collapsed,a=t.isConversation,i=t.ownerAuthorIsOrg;t.edition;if(o)return a?_.a.createElement("div",{className:"CommentItem-deletedContent"},"这里有一条已删除的评论"):null;if(r&&a&&this.state.collapsed)return _.a.createElement("div",{className:"CommentItem-deletedContent"},"这里有一条已折叠的评论，",_.a.createElement(W.c,{preset:"plain",onClick:this.handleExpand},"查看"));var s=this.state,c=s.reportModalShown,l=s.isReplying,u=this.props,m=u.parent,p=m.canComment;p=void 0===p?{status:!0}:p;var d=p.status,f=m.questionType,h=u.commentNeedsReview,y=u.comment,b=u.onReply,v=u.status,g=u.type,C=u.canOperate,w=u.commentPattern,E=u.isMobile,k=y.id,O=y.author,P=y.content,j=y.voteCount,S=y.replyToAuthor,N=y.isAuthor,R=y.isParentAuthor,I=y.createdTime,T=y.featured,B=y.voting,A=y.reviewing,L=y.disliked,M=y.resourceType,D=y.collapsedReason,F=void 0===D?"":D,z=O||{},V=z.member,U=z.role,H=void 0;if(l)H=_.a.createElement(Oe,{type:"comment",id:k,commentNeedsReview:h,className:"CommentItem-editor",defaultActive:!0,replyTo:y,onCancel:this.stopReply,onSubmit:b});else if("reviewing"===v)H=_.a.createElement("div",{className:"CommentItem-footer"},_.a.createElement(W.c,{preset:"plain",onClick:this.approve},_.a.createElement(q.U,{style:{marginRight:5},center:!0,size:14}),"公开"),_.a.createElement(W.c,{className:x()({"CommentItem-hoverBtn":!0}),preset:"plain",onClick:this.handleDelete},_.a.createElement(q._66,{style:{marginRight:5},center:!0,size:16}),"删除"));else{var G=N||R&&("question"!==g||"commercial"===f);H=_.a.createElement("div",{className:x()("CommentItem-footer",{"CommentItem-mobileFooter":!1})},_.a.createElement(W.c,{className:x()("CommentItem-likeBtn",B&&"is-liked"),preset:"plain",onClick:this.like,disabled:N},_.a.createElement(q._30,{style:{marginRight:5},center:!0,size:16}),j>0?j:"赞"),r&&F&&_.a.createElement("div",{className:"CommentItem-walleTag"},"阴阳怪气自动折叠"===F&&_.a.createElement(q.e,{size:16,className:"CommentItem-walleIcon"}),F),!a&&S&&_.a.createElement(W.c,{preset:"plain",className:"CommentItem-talkBtn",onClick:this.showConversation},_.a.createElement(q.B,{style:{marginRight:5},center:!0,size:16}),"查看对话"),!a&&!N&&d&&!r&&_.a.createElement(W.c,{preset:"plain",className:x()({"CommentItem-hoverBtn":!0}),onClick:this.startReply},_.a.createElement(q._52,{style:{marginRight:5},center:!0,size:16}),"回复"),R&&C&&!E&&_.a.createElement(W.c,{className:x()({"CommentItem-hoverBtn":!N}),preset:"plain",onClick:this.feature},_.a.createElement(q._50,{style:{marginRight:5},center:!0,size:16}),T?"取消推荐":"推荐"),R&&C&&!E&&_.a.createElement(W.c,{className:x()({"CommentItem-hoverBtn":!N}),preset:"plain",onClick:this.collapse},_.a.createElement(q.V,{style:{marginRight:5},center:!0,size:14}),r?"取消折叠":"折叠"),!R&&!N&&C&&!E&&_.a.createElement(W.c,{className:x()({"CommentItem-hoverBtn":!0}),preset:"plain",onClick:this.dislike},_.a.createElement(q._30,{style:{transform:"rotate(180deg)",marginRight:5},size:16,center:!0}),L?"取消踩":"踩"),N||_.a.createElement(W.c,{className:x()({"CommentItem-hoverBtn":!0}),preset:"plain",onClick:this.openReportModal},_.a.createElement(q._53,{style:{marginRight:5},center:!0,size:16}),"举报"),G&&!0&&_.a.createElement(W.c,{className:x()({"CommentItem-hoverBtn":!N}),preset:"plain",onClick:this.handleDelete},_.a.createElement(q._66,{style:{marginRight:5},center:!0,size:16}),"删除"),!1,!1,_.a.createElement(_e.a,{shown:this.state.deleteModal,id:k,onDelete:this.delete,onClose:this.handleCloseDelete}),_.a.createElement(Se.a,xe({type:"comment",urlToken:k,shown:c,onClose:this.closeReportModal},G&&{onDeleteComment:function(){return e.props.onDelete(k)}},{notification:{failure:Te.a},zaEnabled:!0})))}return _.a.createElement("div",null,_.a.createElement("div",{className:"CommentItem-meta"},V&&_.a.createElement(Re.a,{className:"CommentItem-avatar",avatar:!0,noHoverCard:"fixed"===w,user:V}),V&&_.a.createElement(Re.a,{className:x()({"CommentItem-userLink":!1}),noBadge:!0,noHoverCard:!0,user:V}),this.renderRoleInfo(U,M),this.renderReplyTo(),A&&_.a.createElement(q.V,{className:"CommentItem-reviewing","data-tooltip":!1===i?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开",center:!0,size:14}),_.a.createElement("span",{className:"CommentItem-time"},Object(Pe.e)(I))),_.a.createElement(Ne.a,{className:"CommentItem-content",html:P}),H)}},{key:"render",value:function(){var e=this.renderInner(),t=this.props,n=t.parent;n.type,n.id,t.isWechat,t.edition,t.referer,t.location.query;return e&&_.a.createElement("div",{className:"CommentItem",ref:this.props.onRef},e,!1)}}]),t}(R.PureComponent),de.propTypes={comment:N.a.object.isRequired,parent:N.a.object.isRequired,commentNeedsReview:N.a.bool,type:N.a.string,isConversation:N.a.bool,onLike:N.a.func.isRequired,onShowConversation:N.a.func,onReply:N.a.func,onFeature:N.a.func,onDelete:N.a.func.isRequired,onCollapse:N.a.func,commentPattern:N.a.string,isMobile:N.a.bool},de.contextTypes={currentUser:N.a.object,authRequired:N.a.func},pe=fe))||pe)||pe),Le=Ae,Me=n(1861),De=n(1680),Fe=(n(2358),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ze=(ye=he=function(e){function t(e,n){u(this,t);var o=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.state={collapsed:!0,current:1,packupButtonStatus:!1,packupButtonLeft:0},o.handleOpenCollapsed=function(){o.setState({collapsed:!1}),o.load(o.props,!1,!0)},o.createOnRef=F()(function(e){return function(t){var n=o.props.byComment;e===Number(n)&&(o.targetCommentEl=t)}}),o.handlePageSelect=function(e){var t=o.props.onPaginationClick,n=o.state.current;t&&t(n,e),o.commentsElement.scrollIntoView(),o.setState({current:e}),o.loadByPagination(e)},o.renderComment=function(e){var t=o.props,n=t.parent,r=n.type,a=n.author;a=void 0===a?{isOrg:!1}:a;var i=a.isOrg,s=t.isMobile,c=t.parent,l=t.commentNeedsReview,u=t.onShowConversation,m=t.status,p=t.onItemLike,d=t.onItemDelete,f=t.onItemCollapse,h=t.onItemDislike,y=t.onItemApprove,b=t.canOperateItem,v=t.commentPattern;return _.a.createElement(Le,{key:e.id,isMobile:s,comment:e,onRef:o.createOnRef(e.id),status:m,type:r,parent:c,canOperate:b,commentNeedsReview:l,onShowConversation:u,ownerAuthorIsOrg:i,onLike:p,onReply:o.addComment,onFeature:o.featureItem,onDelete:d,onCollapse:f,onDislike:h,onApprove:y,commentPattern:v})},o.renderNormalComments=function(e){var t=o.state.collapsed,n=o.props.byComment,r=[];if(o.lastFeaturedIndex=0,e.length>0){var a=e[0].featured,i=!1;e.forEach(function(s,c){if(n||!s.collapsed){var l=e[c-1];if(!s.collapsed||(l&&l.collapsed||r.push(o.renderCollapsedDivider()),!t)){r.push(o.renderComment(s));var u=e[c+1];a&&!i&&s.featured&&(!u||!u.featured)&&(i=!0,o.lastFeaturedIndex=c,r.push(_.a.createElement("div",{className:"CommentList-divider",key:"divider-featured"},_.a.createElement("div",{className:"CommentList-dividerLine"}),_.a.createElement("div",{className:"CommentList-dividerText"},"以上为精选评论",_.a.createElement(q._9,{className:"CommentList-questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论",center:!0,size:16})))))}}})}return r},o.renderCollapsedComments=function(){var e=[],t=o.props.collapsedComments;return o.state.collapsed||!t||t.length<=0?[]:(e.push(t.map(function(e){return o.renderComment(e)})),e)},o.renderComments=function(e){return e.map(o.renderComment)},o.renderBottomButton=function(){var e=o.props,t=e.params,n=t.id,r=t.answerId,a=e.location.query,i=e.edition,s=e.referer,c=Boolean(r);return _.a.createElement("div",{className:"Comments-footer CommentEditor--normal"},_.a.createElement(W.c,{className:"CommentEditor-startCommentButton",preset:"primary",color:"blue",onClick:function(e){return Object(z.b)(e,{href:Object(G.a)(c?{type:"answer",id:r}:{type:"question",id:n},{edition:i,query:a,referer:s,utm_content:"comment_area"}),zaProps:{id:3906}})}},"打开 App 参与站内讨论"))},o.load=o.load.bind(o),o.loadByPagination=o.loadByPagination.bind(o),o.addComment=o.addComment.bind(o),o.featureItem=o.featureItem.bind(o),o.handleScroll=o.handleScroll.bind(o),o}return p(t,e),Fe(t,[{key:"componentDidMount",value:function(){this.subscription=Object(M.subscribe)("scroll",this.handleScroll);var e=this.props,t=e.byComment,n=e.commentPattern,o=e.parent.adminClosedComment,r=this.state.current;t&&this.scrollToTarget(),"bottom"!==n||o||(this.loadByPagination(r),this.commentsWithPaginationEl&&this.setState({packupButtonLeft:this.commentsWithPaginationEl.getBoundingClientRect().right-16}))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,r=t.targetComment,a=t.commentPattern;n===e.order&&o===e.status||("bottom"===a?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!r&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Object(K.e)(K.b)),this.subscription&&this.subscription.unsubscribe()}},{key:"load",value:function(e,t,n){if(!this.props.isFetching&&!this.props.parent.adminClosedComment){var o=e||this.props,r=o.order,a=o.byComment,i=o.status,s=o.parent,c=s.id,l=s.type,u=o.dispatch,m=o.commentPattern;if(o.needLoadCommentPermission&&d(l,c)&&u(d(l,c)),n){u(Object(B.e)(l,c,{order:r,isPrevious:t,byComment:a,status:"collapsed",commentPattern:m},!0))}else u(Object(B.e)(l,c,{order:r,isPrevious:t,byComment:a,status:i,commentPattern:m}))}}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,r=o.id,a=o.type,i=n.dispatch,s=[a,r,e];return t&&(s[3]=t.id),i(B.a.apply(void 0,s))}},{key:"featureItem",value:function(e){this.props.onItemFeature(e,this.lastFeaturedIndex)}},{key:"handleScroll",value:function(){if(this.commentsElement&&this.commentsWithPaginationEl){var e=window.innerHeight,t=this.state.packupButtonStatus,n=this.commentsWithPaginationEl.getBoundingClientRect(),o=n.top,r=n.bottom,a=n.height;!t&&a>500&&r>e&&o<0?this.setState({packupButtonStatus:!0}):t&&(a<=500||r<=e||o>=0)&&this.setState({packupButtonStatus:!1})}}},{key:"scrollToTarget",value:function(){var e=this.targetCommentEl,t=this.listEl;if(t&&e){var n=e.getBoundingClientRect(),o=n.top,r=n.height,a=t.getBoundingClientRect(),i=a.top,s=a.height;this.listEl.scrollTop+=o-i-(s-r)/2,e.classList.add("CommentItem--highlighted"),setTimeout(function(){return e.classList.remove("CommentItem--highlighted")},2e3),e.tabIndex=-1,e.focus()}}},{key:"loadByPagination",value:function(e,t){var n=t||this.props,o=n.order,r=n.byComment,a=n.status,i=n.parent,s=i.id,c=i.type,l=n.dispatch,u=n.commentPattern;n.needLoadCommentPermission&&d(c,s)&&l(d(c,s)),l(Object(B.e)(c,s,{order:o,isPrevious:!1,byComment:r,status:a,commentPattern:u,current:e}))}},{key:"renderCollapsedDivider",value:function(){var e=this.props,t=e.isDrained,n=e.parent.collapsedCounts;return!t||n<=0?[]:this.state.collapsed?_.a.createElement("div",{className:"CommentList-action",key:"collapsed"},_.a.createElement("div",{className:"CommentList-expendCollapseButton"},_.a.createElement("span",{onClick:this.handleOpenCollapsed},Object(H.a)(n)," 条评论被折叠"),"（",_.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):_.a.createElement("div",{className:"CommentList-divider",key:"divider-collapsed"},_.a.createElement("div",{className:"CommentList-dividerLine"}),_.a.createElement("div",{className:"CommentList-dividerText"},Object(H.a)(n)," 条评论被折叠（",_.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))}},{key:"renderCollapsedInfiLoader",value:function(){var e=this,t=this.state.collapsed;if(t)return[];var n=this.props.collapsedInfo;n=void 0===n?{}:n;var o=n.isFetching,r=n.isPrevDrained,a=n.isDrained;return _.a.createElement(V.b,{className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:o,isPrevDrained:r,isDrained:a,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:_.a.createElement(V.a,{className:"CommentItem",small:!0})},this.renderCollapsedComments())}},{key:"renderPatternContent",value:function(e){var t=this,n=this.props,o=n.isFetching,r=n.parent.adminClosedComment,a=n.byComment,i=n.status,s=n.order,c=n.totals,l=n.handlePackupButton,u=n.apps,m=Math.ceil(c/20),p=this.state,d=p.current,f=p.packupButtonStatus,h=p.packupButtonLeft;return r?null:o?_.a.createElement(Me.a,{onRef:function(e){t.commentsWithPaginationEl=e}}):_.a.createElement("div",{ref:function(e){t.commentsWithPaginationEl=e}},_.a.createElement("div",{className:"CommentList"},"normal"===s&&"open"===i?this.renderNormalComments(e):this.renderComments(e)),m>1&&_.a.createElement(U.a,{className:"comments-pagination",current:d,total:m,onSelect:this.handlePageSelect}),!a&&this.renderCollapsedDivider(),!a&&this.renderCollapsedInfiLoader(),_.a.createElement(A.CSSTransitionGroup,{transitionName:"Comments-Packup-Button",transitionEnterTimeout:300,transitionLeaveTimeout:300},f&&"column"!==u&&_.a.createElement("button",{onClick:l,className:"Comments-Packup-Button",style:{left:h}},"收起评论",_.a.createElement(q.j,{center:!0}))))}},{key:"renderModalContent",value:function(e){var t=this,n=this.props,o=n.collapsedInfo,r=n.parent.adminClosedComment,a=n.status,i=n.order,s=n.byComment,c=this.state.collapsed,l=c?this.props:o,u=l.isFetching,m=l.isDrained,p=l.isPrevDrained;if(m&&e.length<=0||r)return _.a.createElement("div",{className:"Comments-empty"},_.a.createElement(Y.a,{entityType:"comments"}));var d={getContainer:function(e){return e}};return _.a.createElement(V.b,qe({className:"CommentList",onRef:function(e){t.listEl=e},isLocal:!0,isLoading:u,isPrevDrained:p,isDrained:m,onLoad:function(e){return t.load(t.props,e,!c)},placeholder:_.a.createElement(V.a,{className:"CommentItem",small:!0})},d),"normal"===i&&"open"===a?this.renderNormalComments(e):this.renderComments(e),!s&&this.renderCollapsedDivider(),!s&&this.renderCollapsedComments())}},{key:"renderCommentEdit",value:function(e){var t=this.props,n=t.parent,o=n.canComment;o=void 0===o?{status:!0}:o;var r=o.status,a=o.reason,i=n.author;i=void 0===i?{isOrg:!1}:i;var s=i.isOrg,c=n.type,l=n.id,u=n.adminClosedComment,m=n.questionType,p=t.byComment,d=t.isAutoblur,f=t.commentNeedsReview,h=u?"当前内容暂时无法评论":a,y=d?!d:!p;return r&&!u?_.a.createElement(Oe,qe({className:"Comments-"+("top"===e?"top":"footer"),type:c,id:l,commentNeedsReview:f,onSubmit:this.addComment,autoFocus:y,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===m},"top"===e&&{preset:"default",onClick:function(e){L.default.trackEvent(e.target,{id:3905})}})):"top"!==e&&_.a.createElement("div",{className:x()("Comments-disabledText",{"Comments-disabledText--fixed":!1})},_.a.createElement("div",{className:"Comments-disabledReason"},h))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.isAuthor,r=t.comments,a=t.commentPattern,i=t.parent,s=i.canComment;s=void 0===s?{status:!0}:s;var c=s.status,l=i.author;l=void 0===l?{isOrg:!1}:l;var u=l.isOrg,m=i.commentPermission,p=i.reviewingCounts,d=i.commentCount,f=i.adminClosedComment,h=t.totals,y=t.status,b=t.order,v=t.onStatusChange,g=t.apps,C=t.onOrderChange,w=t.targetLink,E=t.isBaidu,k=r.filter(function(e){return!e.isDelete}),O="censor"===m&&o,P=O?{isCommentReviewer:O,onStatusChange:v,status:y,reviewingCounts:p}:{status:y},j=x()({Comments:!0,"Comments--withEditor":!0,"Comments-withPagination":"bottom"===a},n);return _.a.createElement("div",{className:j,ref:function(t){e.commentsElement=t}},_.a.createElement(De.a,qe({commentCount:void 0!==d?d:h,commentClosed:f,targetLink:w,order:b,onOrderChange:C,commentPattern:a,isOrg:u,isBaidu:E,options:this.renderCommentEdit("top")},P)),"column"===g&&this.renderCommentEdit(),"bottom"===a?this.renderPatternContent(k):this.renderModalContent(k),"column"!==g&&(!E||!c)&&this.renderCommentEdit(),"column"!==g&&E&&c&&this.renderBottomButton())}}]),t}(R.Component),he.propTypes={type:N.a.string,parent:N.a.object.isRequired,targetLink:N.a.node,commentNeedsReview:N.a.bool,byComment:N.a.oneOfType([N.a.number,N.a.string]),commentPattern:N.a.string,handlePackupButton:N.a.func,onPaginationClick:N.a.func,isAutoblur:N.a.bool},he.contextTypes={authRequired:N.a.func.isRequired},he.defaultProps={isAutoblur:!1},ye),Ve=Object(I.connect)(f)(ze),Ue=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),We=(ve=be=function(e){function t(e,n){h(this,t);var o=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.load=o.load.bind(o),o.addComment=n.authRequired(o.addComment.bind(o),void 0,K.b),o}return b(t,e),Ue(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.props.dispatch(Object(B.f)(this.props.commentId))}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,r=o.type,a=o.id,i=n.commentId,s=n.dispatch,c=[r,a,e,t.id,i];return s(B.a.apply(void 0,c))}},{key:"render",value:function(){var e=this.props,t=e.onItemLike,n=e.onItemDelete,o=e.onItemFeature,r=e.onItemApprove,a=e.onItemCollapse,i=e.onItemDislike,s=e.onNavBack,c=e.canOperateItem,l=e.isFetching,u=e.comments,m=e.commentNeedsReview,p=e.openComment.collapsed,d=e.parent,f=e.parent.canComment;f=void 0===f?{status:!0}:f;var h=f.status,y=f.reason,b=e.commentPattern,v=e.commentId,g=this.context.currentUser,C=Boolean(g&&u.find(function(e){return e.author&&e.author.member.urlToken===g.urlToken})),w=void 0,E=void 0;C&&(w=u.filter(function(e){return e.author&&e.author.member.urlToken!==g.urlToken}),E=w[w.length-1]);var k=void 0;return l&&!u.length?k=_.a.createElement(V.a,{className:"CommentItem",small:!0}):u.length&&(k=u.map(function(e,s){return _.a.createElement(Le,{key:s,isConversation:!0,commentNeedsReview:m,canOperate:c,parent:d,comment:e,onLike:t,onDelete:n,onFeature:o,onApprove:r,onCollapse:a,onDislike:i,collapsedShown:p})})),"bottom"===b?_.a.createElement(ne.b,{size:"fullPage",onClose:s},_.a.createElement("div",{className:"Comments"},_.a.createElement(De.a,{isConversation:!0,commentPattern:b}),_.a.createElement("div",{className:"CommentList"},k))):_.a.createElement("div",{className:"Comments"},_.a.createElement(De.a,{isConversation:!0,onNavBack:s}),_.a.createElement("div",{className:"CommentList"},k),E&&(h?_.a.createElement(Oe,{id:v,type:"conversation",className:"Comments-footer",replyTo:E,commentNeedsReview:m,onSubmit:this.addComment}):_.a.createElement("div",{className:"Comments-disabledText"},y)))}}]),t}(R.Component),be.propTypes={commentId:N.a.number.isRequired,type:N.a.string,parent:N.a.object.isRequired,commentNeedsReview:N.a.bool},be.contextTypes={currentUser:N.a.object,authRequired:N.a.func.isRequired},ve),He=Object(I.connect)(v)(We),Ge=n(263),Ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Qe=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Ze=(ge=Object(Ge.a)(null))((Ee=we=function(e){function t(e){C(this,t);var n=w(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));ke.call(n);var o=e.parent,r=e.dispatch;return n.feature=function(e,t){return r(Object(B.i)(e,o.id,o.type,t))},n.delete=function(e){return r(Object(B.d)(e,o.type,o.id))},n.showConversation=function(e){return n.setState({openedCommentId:e})},n.showComments=function(){return n.setState({openedCommentId:null})},n}return E(t,e),Qe(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.domNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.parent,o=t.commentPattern,r=t.type,a=t.parent;a=void 0===a?{}:a;var i=a.commentPermission,s=a.relationship,c=void 0===s?{}:s,l=a.author,u=void 0===l?{}:l,m=t.needLoadCommentPermission,p=g(t,["parent","commentPattern","type","parent","needLoadCommentPermission"]),d=this.context.currentUser,f=void 0===c.isAuthor?d&&u.urlToken&&d.urlToken===u.urlToken:c.isAuthor,h="censor"===i&&!f,y="answer"===r||"article"===r,b=this.state,v=b.openedCommentId,C=b.status,w=b.order,E={commentNeedsReview:h,parent:n,type:r,canOperateItem:y,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve};return _.a.createElement("div",{className:"Comments-container",ref:function(t){return e.domNode=t}},_.a.createElement(Ve,Ke({},p,E,{commentPattern:o,className:x()({"Comments--hidden":v&&"bottom"!==o}),order:w,status:C,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:m,isAuthor:f})),v&&_.a.createElement(He,Ke({},p,E,{commentPattern:o,commentId:v,onNavBack:this.showComments})))}}]),t}(R.Component),we.propTypes={type:N.a.string.isRequired,parent:N.a.object.isRequired,onOrderChange:N.a.func,onItemLike:N.a.func,isAuthor:N.a.bool,onMount:N.a.func},we.defaultProps={type:"answer"},we.contextTypes={currentUser:N.a.object,authRequired:N.a.func.isRequired},ke=function(){var e=this;this.state={openedCommentId:null,status:"open",order:"normal"},this.like=function(t,n){var o=e.props,r=o.onItemLike,a=o.dispatch;r&&r(t,n),a(Object(B.j)(t))},this.collapse=function(t){var n=e.props,o=n.dispatch,r=n.parent;o(Object(B.g)(t,r.type,r.id))},this.dislike=function(t){return e.props.dispatch(Object(B.h)(t))},this.approve=function(t){var n=e.props,o=n.dispatch,r=n.parent,a=n.type;o(Object(B.b)(t,r.type||a,r.id))},this.handleStatusChange=function(t){e.setState({status:t})},this.handleOrderChange=function(t,n){e.props.onOrderChange&&e.props.onOrderChange(t,n),e.setState({order:t})}},Ce=Ee))||Ce;t.default=Object(I.connect)()(Ze)},2898:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var y,b,v,g,C,w,E,k=n(1),O=n.n(k),P=n(0),j=n.n(P),S=n(3),N=(n(574),n(42)),R=n(6),_=n(169),I=n(69),T=n(506),x=function(e,t,n){return n&&void 0!==t&&(e||!t)},B=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),A=20,L=60,M=(b=y=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.shouldSubmitIsDisabled=function(){var t=e.state,n=t.title,o=t.description;return!n||n.length>A||o.length>L},e.state={isPublic:!0,title:"",description:""},e.handleSubmit=e.handleSubmit.bind(e),e}return a(t,e),B(t,[{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state,n=t.isPublic,o=t.title,r=t.description;if(o){var a=this.props,i=a.onSubmit,s=a.onBack,c=a.authRequired,l=a.isActive,u={title:o,description:r,isPublic:n};x(n,l,c)?c(i)(u):(i(u),s())}}},{key:"render",value:function(){var e=this,t=this.state,n=t.title,o=t.description,r=t.isPublic,a=this.props.onBack,i=this.shouldSubmitIsDisabled();return j.a.createElement("form",{className:"Favlists-content",onSubmit:this.handleSubmit},j.a.createElement("div",{className:"Favlists-addItems"},j.a.createElement("div",{className:"Favlists-addItem"},j.a.createElement(I.a,{className:"Favlists-titleInput",placeholder:"收藏标题",onChange:function(t){var n=t.target.value;e.setState({title:n})}}),j.a.createElement("div",{className:"Favlists-inputTips"},j.a.createElement(T.a,{name:"收藏标题",current:n?n.length:0,max:A}))),j.a.createElement("div",{className:"Favlists-addItem"},j.a.createElement(I.a,{multiline:!0,className:"Favlists-descritionInput",placeholder:"收藏描述（可选）",onChange:function(t){var n=t.target.value;e.setState({description:n})},rows:5}),j.a.createElement("div",{className:"Favlists-inputTips"},j.a.createElement(T.a,{name:"收藏描述",current:o?o.length:0,max:L}))),j.a.createElement("div",{className:"Favlists-addItem"},j.a.createElement("label",{className:"Favlists-privacyOption"},j.a.createElement("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"true",checked:r,onChange:function(){return e.setState({isPublic:!0})}}),j.a.createElement("span",null,"公开"),j.a.createElement("span",{className:"Favlists-privacyOptionTips"},"有其他人关注此收藏夹时不可设置为私密")),j.a.createElement("label",{className:"Favlists-privacyOption"},j.a.createElement("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"false",checked:!r,onChange:function(){return e.setState({isPublic:!1})}}),j.a.createElement("span",null,"私密"),j.a.createElement("span",{className:"Favlists-privacyOptionTips"},"只有你自己可以查看这个收藏夹")))),j.a.createElement(N.a,{direction:"horizontal",className:""},a&&j.a.createElement(S.c,{onClick:a},"返回"),j.a.createElement(S.c,{color:"blue",preset:"primary",type:"submit",disabled:i},"确认创建")))}}]),t}(P.Component),y.propTypes={onSubmit:O.a.func.isRequired,onBack:O.a.func,authRequired:O.a.func},b),D=M,F=n(261),q=n(1295),z=n(8),V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},U=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),W=function(e){function t(){var e,n,o,r;i(this,t);for(var a=arguments.length,c=Array(a),l=0;l<a;l++)c[l]=arguments[l];return n=o=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),o.handleChange=function(){var e=o.props;(0,e.onChange)(e.id,o.props.checked)},r=n,s(o,r)}return c(t,e),U(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.zaEnabled,n=e.id;t&&R.default.setModule(this,{module:"CollectionItem"},{card:{card_type:"Content",content:{type:"Collection",token:String(n)}}})}},{key:"render",value:function(){var e=this.props,t=e.answerCount,n=e.title,o=e.isPublic,r=e.checked,a=void 0!==r&&r,i=a?{preset:"primary",color:"grey",children:"已收藏"}:{color:"blue",children:"收藏"};return j.a.createElement("div",{className:"Favlists-item"},j.a.createElement("div",{className:"Favlists-itemInner"},j.a.createElement("div",{className:"Favlists-itemName"},j.a.createElement("span",{className:"Favlists-itemNameText"},n),!1===o&&j.a.createElement("span",{className:"Favlists-itemIcon"},j.a.createElement(z._34,{size:16}))),j.a.createElement("div",{className:"Favlists-itemContent"},t," 条内容")),j.a.createElement(S.c,V({},i,{className:"Favlists-updateButton",onClick:this.handleChange})))}}]),t}(P.Component),H=W,G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},K=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Q=(g=v=function(e){function t(){var e,n,o,r;l(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.items={},o.handleFavlistItemChange=function(e,t){R.default.trackEvent(o.items[e],{action:t?"UnCollect":"Collect",element:"Button",is_intent:!1}),o.props.onUpdate(e,t)},r=n,u(o,r)}return m(t,e),K(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.relations,o=t.items,r=t.isFetching,a=t.isDrained,i=t.onAdd,s=t.onLoad;return j.a.createElement("div",{className:"Favlists-content"},j.a.createElement(F.b,{isLocal:!0,isLoading:r,isDrained:a,onLoad:s,placeholder:j.a.createElement(q.a,{title:!0}),getContainer:function(e){return e},className:"Favlists-items"},o.map(function(t){return j.a.createElement(H,G({key:t.id,onChange:e.handleFavlistItemChange,checked:n[t.id]},t,{ref:function(n){e.items[t.id]=n}}))})),!o.length&&r||j.a.createElement("div",{className:"Favlists-actions"},j.a.createElement(S.c,{className:"Favlists-addButton",onClick:i,preset:"primary",color:"blue"},"创建收藏夹")))}}]),t}(P.Component),v.propTypes={isFecthing:O.a.bool,relations:O.a.object,onUpdate:O.a.func.isRequired,onAdd:O.a.func.isRequired,onLoad:O.a.func.isRequired,items:O.a.array.isRequired,isDrained:O.a.bool,authRequired:O.a.func},g),Z=Q,J=n(1817),Y=n(1818),$=(n(2048),n(2049),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),X=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ee={list:{title:"添加收藏",tips:function(e){return e?"请选择你想添加的收藏夹":"你可以创建多个收藏夹，将答案分类收藏"}},add:{title:"创建新收藏夹"}},te=(w=C=function(e){function t(){var e,n,o,r;d(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),E.call(o),r=n,f(o,r)}return h(t,e),X(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.shown,o=t.items,r=t.id,a=t.type,i=t.onFetchRelations,s=e.items,c=e.relations;if(i&&(s.length!==o.length&&e.shown||s.length&&!n&&e.shown)){var l=(c?s.filter(function(e){return!{}.hasOwnProperty.call(c,e.id)}):s).map(function(e){return e.id});l.length&&i(r,a,l)}s.length>o.length&&this.setState({status:"list"})}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.id,o=t.type,r=t.shown,a=t.zaEnabled;r&&!e.shown&&this.container&&a&&R.default.setModule(this.container,{module:"CollectionDialogue"},{card:{card_type:"Content",content:{type:Object(Y.a)(o),token:String(n)}}})}},{key:"render",value:function(){var e=this,t=this.state.status,n=ee[t],o=n.title,r=n.tips,a=this.props,i=a.shown,s=a.defaultStatus,c=a.relations,l=a.onFavlistAdd,u=a.onLoad,m=a.isFetching,d=a.isDrained,f=a.items,h=a.zaEnabled,y=a.authRequired,b=a.isUserActive,v=p(a,["shown","defaultStatus","relations","onFavlistAdd","onLoad","isFetching","isDrained","items","zaEnabled","authRequired","isUserActive"]),g=!(d&&!f.length),C=Object(J.a)(v,Object.keys(_.b.propTypes)),w=C.selectedProps,E=void 0;return E="list"===t?g?j.a.createElement(Z,{ref:function(t){e.container=t},items:f,isFetching:m,isDrained:d,relations:c,onAdd:this.handleAdd,onUpdate:this.handleUpdate,onLoad:u,zaEnabled:h}):j.a.createElement(N.a,null,j.a.createElement(S.c,{preset:"primary",color:"blue",onClick:this.handleAdd},"创建收藏夹"),j.a.createElement(S.c,{onClick:this.handleCloseModal},"取消")):j.a.createElement(D,{onSubmit:l,isActive:b,onBack:"add"===s?this.handleCloseModal:this.handleBack,authRequired:y}),j.a.createElement(_.b,$({},w,{onClose:this.handleCloseModal,title:o,subtitle:r&&r(g),buttonGroupOnly:!g,className:"FavlistsModal",size:"large"}),i&&E)}}]),t}(P.Component),C.propTypes={id:O.a.oneOfType([O.a.string,O.a.number]),type:O.a.oneOf(["answer","article","pin"]),relations:O.a.object,onUpdateFav:O.a.func.isRequired,onFavlistAdd:O.a.func.isRequired,onFetchRelations:O.a.func,onClose:O.a.func.isRequired,shown:O.a.bool,zaEnabled:O.a.bool,authRequired:O.a.func,isUserActive:O.a.number},C.defaultProps={defaultStatus:"list",relations:{},authRequired:function(e){return e}},E=function(){var e=this;this.state={status:this.props.defaultStatus},this.handleCloseModal=function(){e.props.onClose&&e.props.onClose(),e.setState({status:"list"})},this.handleUpdate=function(t,n){var o=e.props,r=o.onUpdateFav,a=o.id,i=o.type,s=o.items,c=o.authRequired,l=o.isUserActive,u=s.find(function(e){return e.id===t})||{},m=[t,a,i,u.isPublic];return!n&&x(u.isPublic,l,c)?c(r).apply(void 0,m):r.apply(void 0,m)},this.handleAdd=function(){return e.setState({status:"add"})},this.handleBack=function(){return e.setState({status:"list"})}},w),ne=te;n.d(t,"FavlistsModal",function(){return ne})},2899:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t=e.infringementType;return se.a.createElement("p",{className:"ReportOrgContent"},"若您已注册机构号，可使用",se.a.createElement("span",{className:"ReportOrgContent-highlight"},"机构号"),"declare"===t?"发表澄清声明":"提交侵权举报","，",se.a.createElement("span",{className:"ReportOrgContent-highlight"},"免提交资质材料"),"。")}function c(e){var t=e.infringementType,n=e.isIndividualReason,o=e.onBackClick,r="declare"===t;return se.a.createElement("div",{className:"ReportInfringementMobile"},se.a.createElement("p",{className:"ReportInfringementMobile-text"},"1."," ",r?(n?"个人":"企业")+"可以对站内关于自身的不实描述内容发表澄清声明，声明通过审核后，将会以标记的方式形式显示在投诉内容的上方，点击可跳转至您的声明全文。":"您提交的侵权举报将会根据知乎侵权举报规范进行受理。"),se.a.createElement("p",{className:"ReportInfringementMobile-text"},"2. 根据",se.a.createElement("a",{className:"ReportInfringementMobile-link",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"知乎侵权举报规范"),"，您需按照提示提供完整、有效的证明材料，",r?"以发表澄清声明。":"并规范填写投诉说明。","若您已确认完毕，",se.a.createElement("span",{className:"ReportInfringementMobile-bold"},"请到桌面版网页进行诉求提交。")),!n&&se.a.createElement("p",{className:"ReportInfringementMobile-text"},"若您已注册机构号，可使用机构号"+(r?"发表澄清声明":"提交侵权举报")+"，免提交资质材料。"),se.a.createElement("img",{className:"ReportInfringementMobile-img",src:"https://zhstatic.zhihu.com/report/app_report.png"}),se.a.createElement(de.c,{color:de.a.Blue,preset:de.b.Primary,onClick:o,className:"ReportInfringementMobile-button"},"我知道了"))}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function j(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function S(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function L(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var z,V,U,W,H,G,K,Q,Z,J,Y,$,X,ee,te,ne,oe,re=n(1),ae=n.n(re),ie=n(0),se=n.n(ie),ce=n(6),le=n(169),ue=n(2),me=n.n(ue),pe=n(8),de=n(3),fe=n(42),he=(n(2347),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),ye={oneself:"oneself",enterprise:"enterprise"},be=[{title:"发表澄清声明",image:"https://zhstatic.zhihu.com/assets/report/Statement@3x.png",description:(z={},i(z,ye.oneself,"个人可以对站内关于自身的不实描述内容发表澄清声明，声明通过审核后，将会以标记的方式形式显示在投诉内容的上方，点击可跳转至您的声明全文。"),i(z,ye.enterprise,"企业可以对站内关于自身的不实描述内容发表澄清声明，声明通过审核后，将会以标记的方式形式显示在投诉内容的上方，点击可跳转至您的声明全文。"),z),defaultReasonIdMap:(V={},i(V,ye.oneself,46),i(V,ye.enterprise,48),V)},{title:"提交侵权举报",image:"https://zhstatic.zhihu.com/assets/report/Infringement@3x.png",description:se.a.createElement("span",null,"您提交的侵权举报将会根据知乎侵权举报规范进行受理"),defaultReasonIdMap:(U={},i(U,ye.oneself,47),i(U,ye.enterprise,49),U),memberReasonIdMap:(W={},i(W,ye.oneself,12),i(W,ye.enterprise,13),W)}],ve=(H={},i(H,ye.enterprise,"当您发现知乎上存在涉嫌侵犯您企业合法权益的内容时，您可以先尝试与作者沟通解决，如沟通无效，也可以通过以下方式向知乎提出诉求。"),i(H,ye.oneself,"当您发现知乎上存在涉嫌侵犯您个人合法权益的内容时，您可以通过以下方式向知乎提出诉求。"),H),ge=function(e,t){return("member"===e?10===t:29===t)?ye.oneself:ye.enterprise},Ce=function(e){function t(){var e,n,a,i;o(this,t);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];return n=a=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.handleClick=function(e){ce.default.trackEvent(e,{id:3467})},i=n,r(a,i)}return a(t,e),he(t,[{key:"componentDidMount",value:function(){ce.default.trackCardShow(null,{id:3466})}},{key:"render",value:function(){var e=this,t=this.props,n=t.onSubMenuEnter,o=t.onBackClick,r=t.activeId,a=t.isMobile,i=t.type,s=["answer","article","pin"].includes(i),c=s?be:be.slice(1),l=ge(i,r);return se.a.createElement("section",{className:me()("ReportInfringement",{"ReportInfringement--mobile":a})},se.a.createElement("p",{className:"ReportInfringement-subtitle"},ve[l]),se.a.createElement("ul",{className:"ReportInfringement-list"},c.map(function(t){var o=t.image,r=t.title,a=t.description,s=t.defaultReasonIdMap,c=t.memberReasonIdMap,u="member"===i?c:s,m=u[l],p=a[l]||a;return se.a.createElement("li",{className:"ReportInfringement-item",key:r,"data-za-module":"Content","data-za-detail-view-path-module_name":r,onClick:function(t){e.handleClick(t.currentTarget),n(m)}},se.a.createElement("img",{className:"ReportInfringement-image",src:o}),se.a.createElement("div",{className:"ReportInfringement-content"},se.a.createElement("h1",{className:"ReportInfringement-itemTitle"},r),se.a.createElement("p",{className:"ReportInfringement-itemDescription"},p)),se.a.createElement(pe.i,{className:"ReportInfringement-arrow"}))})),se.a.createElement(fe.a,{direction:"horizontal"},se.a.createElement(de.c,{"data-za-module":"Content","data-za-detail-path-view-module_name":"返回",onClick:function(t){e.handleClick(t.currentTarget),o()}},"返回")))}}]),t}(se.a.Component),we=n(27),Ee=function(e){return"https://www.zhihu.com/account/infringement?"+Object(we.stringify)(e)},ke=(n(2348),n(2349),n(2350),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),Oe=function(e){function t(){var e,n,o,r;l(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.handleClick=function(e){ce.default.trackEvent(null,{id:3469},{button:{text:e}})},r=n,u(o,r)}return m(t,e),ke(t,[{key:"componentDidMount",value:function(){ce.default.trackCardShow(null,{id:3468})}},{key:"render",value:function(){var e=this,t=this.props,n=t.onBackClick,o=t.urlToken,r=t.type,a=t.activeId,i=t.isMobile,l=46===a;return i?se.a.createElement(c,{isIndividualReason:l,infringementType:"declare",onBackClick:n}):se.a.createElement("section",{className:"ReportDeclare"},se.a.createElement("div",{className:"ReportDeclare-description"},"当您发现知乎上有关于您",l?"个人":"企业","的侵权内容时，您可通过此方式发表澄清声明。",se.a.createElement("br",null),se.a.createElement("br",null),"申请发表澄清声明的流程如下：",se.a.createElement("ul",null,se.a.createElement("li",null,"1. 在站内写一篇",se.a.createElement("a",{href:"https://zhuanlan.zhihu.com/write",target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.handleClick("澄清声明文章")}},"澄清声明文章"),"并发布。",se.a.createElement("a",{href:"https://zhstatic.zhihu.com/assets/report/template-v2.png",target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.handleClick("查看模版")}},"查看模版"),se.a.createElement("br",null)),se.a.createElement("li",null,"2.返回此页面继续发表声明，您需按照提示提供完整、有效的证明材料。",se.a.createElement("br",null)),se.a.createElement("li",null,"3.审核通过后，侵权纠纷内容上会关联展示您的澄清声明，点击可跳转至您的声明全文。")),!l&&se.a.createElement(s,{infringementType:"declare"})),se.a.createElement(fe.a,{direction:"horizontal"},se.a.createElement(de.c,{onClick:n},"返回"),se.a.createElement(de.c,{onClick:function(){return e.handleClick("继续发表声明")},component:"a",href:Ee({infringementType:"declare",resourceId:o,type:r,reasonType:l?"inflictIndividual":"enterprise"}),className:"ReportDeclare-continue",color:de.a.Blue,preset:de.b.Primary},"继续发表声明")))}}]),t}(se.a.Component),Pe=(n(2351),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),je=function(e){function t(){var e,n,o,r;p(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=d(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.handleClick=function(e){ce.default.trackEvent(null,{id:3510},{button:{text:e}})},r=n,d(o,r)}return f(t,e),Pe(t,[{key:"componentDidMount",value:function(){ce.default.trackCardShow(null,{id:3509})}},{key:"render",value:function(){var e=this,t=this.props,n=t.onBackClick,o=t.urlToken,r=t.type,a=t.activeId,i=t.isMobile,l="member"===r?12===a:47===a;return i?se.a.createElement(c,{isIndividualReason:l,infringementType:"trespass",onBackClick:n}):se.a.createElement("section",{className:"ReportTrespass"},se.a.createElement("p",{className:"ReportTrespass-description"},"根据",se.a.createElement("a",{href:"https://www.zhihu.com/terms#sec-report",onClick:function(){e.handleClick("知乎侵权举报规范")}},"知乎侵权举报规范"),"，您需按照提示提供完整、有效的证明材料，并规范填写投诉说明。若您已确认完毕，请继续提交举报信息。"),!l&&se.a.createElement(s,{infringementType:"trespass"}),se.a.createElement(fe.a,{direction:"horizontal"},se.a.createElement(de.c,{onClick:function(){e.handleClick("返回"),n()}},"返回"),se.a.createElement(de.c,{onClick:function(){e.handleClick("继续提交举报")},component:"a",href:Ee({resourceId:o,type:r,reasonType:l?"inflictIndividual":"enterprise"}),className:"ReportTrespass-continue",color:de.a.Blue,preset:de.b.Primary},"继续提交举报")))}}]),t}(se.a.Component),Se=[{id:0,text:"举报",childIds:[1,2,3,4,5,21,7,8,9]},{id:1,text:"低质问题",types:["question"],childIds:[23,33,34,15,35,27,22]},{id:2,text:"垃圾广告信息",reason:"spam",copywriter:{title:"举报说明",placeholder:"举报详细说明（选填）",isRequired:!1},disabled:!0},{id:3,text:"不友善行为",types:["answer","comment","article","pin","book_review","favlist"],childIds:[40,41]},{id:4,text:"有害信息",childIds:[19,30,39,26,18,28]},{id:5,text:"涉嫌侵权",childIds:[20,29,12],types:["question","answer","comment","article","pin","book_review"],reason:"infringement",disabled:!0},{id:6,types:[]},{id:7,text:"其他",reason:"old",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:8,reason:"direction",shouldShow:function(e){return e.isColumnArticle}},{id:9,reason:"tipjar",shouldShow:function(e){return e.isTipjarEnabled}},{id:10,reason:"mention"},{id:11,reason:"privacy",disabled:!0},{id:12,reason:"enterprise",disabled:!0,customComponent:Ce},{id:13,reason:"copy",copywriter:{title:"原文链接或出处",placeholder:"填写原文链接或描述内容出处（必填）"},disabled:!0},{id:14,reason:"defamation",disabled:!0},{id:15,reason:"abuse"},{id:16,reason:"intention"},{id:17,reason:"spam"},{id:18,reason:"illegality",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:19,reason:"politics"},{id:20,reason:"repost",copywriter:{title:"举报说明",placeholder:"原文链接或补充说明（必填）"},types:["answer","article","pin","book_review"],disabled:!0},{id:21,reason:"temptation",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0,types:["answer","comment","article"]},{id:22,reason:"personal"},{id:23,reason:"ambiguity"},{id:24,reason:"worthless"},{id:25,reason:"rumour"},{id:26,reason:"suicide",types:["question","answer","article","pin","book_review","comment"]},{id:27,reason:"medicine"},{id:28,reason:"superstition"},{id:29,reason:"oneself",disabled:!0,customComponent:Ce},{id:30,reason:"porn"},{id:31,reason:"pirate"},{id:32,reason:"invalid"},{id:33,reason:"subjective"},{id:34,reason:"rumour"},{id:35,reason:"provoke"},{id:36,reason:"edit"},{id:37,reason:"harassment"},{id:38,reason:"hatred"},{id:39,text:"不实信息",types:["answer","comment","article","pin","book_review"],childIds:[42,43,44,45]},{id:40,reason:"abuse",text:"骚扰、辱骂、歧视等"},{id:41,reason:"unfriendly",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:42,reason:"untruth_science",text:"科学类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:43,reason:"untruth_rumor",text:"社会谣言类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:44,reason:"untruth_fake_profile",text:"编造经历类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:45,text:"诽谤等侵权信息",childIds:[20,29,12]},{id:46,customComponent:Oe,text:"发表澄清声明",reason:"declare",subtitle:"个人侵权"},{id:47,customComponent:je,text:"提交侵权举报",reason:"trespass",subtitle:"个人侵权"},{id:48,customComponent:Oe,text:"发表澄清声明",reason:"declare",subtitle:"企业侵权"},{id:49,customComponent:je,text:"提交侵权举报",reason:"trespass",subtitle:"企业侵权"}],Ne=[{id:0,text:"举报",childIds:[1,2,3,4]},{id:1,text:"垃圾广告信息",reason:"spam"},{id:2,text:"不友善行为",reason:"unkind"},{id:3,text:"有害信息",reason:"imitation"},{id:4,text:"其他",reason:"old",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0}],Re=[{id:0,text:"举报",childIds:[1,2,3]},{id:1,reason:"abuse"},{id:2,reason:"harassment"},{id:3,reason:"spam"}],_e=[{id:0,text:"举报",childIds:[1,4,6,7]},{id:1,text:"冒充我或他人",childIds:[8,9],reason:"fake",disabled:!0},{id:2,reason:"abuse",text:"发过辱骂我或他人的内容"},{id:3,reason:"illegality",text:"发过违反法律法规的内容"},{id:4,reason:"spam",text:"垃圾广告帐号"},{id:5,reason:"politics",text:"发过政治敏感内容"},{id:6,reason:"profile",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:7,reason:"old",text:"其他",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:8,text:"冒充我",subtitle:"请选择举报理由",reason:"oneself",disabled:!0,childIds:[10,11]},{id:9,reason:"impersonate",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},text:"冒充他人",disabled:!0},{id:10,text:"个人侵权",isRequired:!0,customComponent:Ce},{id:11,text:"企业侵权",isRequired:!0,customComponent:Ce},{id:12,isRequired:!0,customComponent:je,text:"提交侵权举报",reason:"trespass",subtitle:"个人侵权"},{id:13,isRequired:!0,customComponent:je,text:"提交侵权举报",reason:"trespass",subtitle:"企业侵权"}],Ie=n(48),Te=n(556),xe=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Be=(K=G=function(e){function t(){h(this,t);var e=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.handleClick=e.handleClick.bind(e),e}return b(t,e),xe(t,[{key:"handleClick",value:function(){var e=this.props,t=e.id,n=e.reason,o=e.disabled,r=e.onSubMenuEnter,a=e.onItemSelect;n&&!o?a(t):r(t)}},{key:"render",value:function(){var e=this.props,t=e.reason,n=e.text,o=e.disabled,r=e.isSelected,a=e.id,i=n||Te.b[t];return Boolean(t&&!o)?se.a.createElement("label",{className:"ReportMenu-item",htmlFor:t},se.a.createElement("div",{className:"ReportMenu-itemValue needsclick"},i),se.a.createElement("input",{className:"ReportMenu-itemCheck",type:"radio",name:"report",value:a,id:t,checked:r,onChange:this.handleClick}),se.a.createElement(pe.x,{size:18,className:"ReportMenu-itemCheckIcon",name:"checkRound"})):se.a.createElement("button",{className:"ReportMenu-item",onClick:this.handleClick},se.a.createElement("span",{className:"ReportMenu-itemValue"},i),se.a.createElement(pe.i,{size:18}))}}]),t}(ie.Component),G.propTypes={id:ae.a.number.isRequired,reason:ae.a.string,text:ae.a.string,disabled:ae.a.bool,isSelected:ae.a.bool,onSubMenuEnter:ae.a.func.isRequired,onItemSelect:ae.a.func.isRequired},K),Ae=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Le=(Z=Q=function(e){function t(){return v(this,t),g(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return C(t,e),Ae(t,[{key:"render",value:function(){switch(this.props.reason){case"privacy":return se.a.createElement("div",{className:"ReportMenu-inner"},se.a.createElement("div",{className:"ReportMenu-paragraph"},"您好，当您发现知乎上有泄漏您隐私的内容时，您可向知乎进行举报。 请您把以下内容通过邮件发送到 ",se.a.createElement("a",{className:"ReportMenu-link",href:"mailto:i@zhihu.com"},"i@zhihu.com")," 邮箱，我们会尽快处理。"),se.a.createElement("ul",{className:"ReportMenu-paragraph"},se.a.createElement("li",null,"1. 您认为哪些内容泄露了您的隐私？（请在邮件中列出您举报的内容、链接地址，并给出简短的说明）"),se.a.createElement("li",null,"2. 您是谁？（身份证明材料，可以是身份证或护照等证件）")),se.a.createElement("div",{className:"ReportMenu-paragraph ReportMenu-paragraph--light"},"邮件格式请参考",se.a.createElement("a",{className:"ReportMenu-link--light",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"这里"),"；"));case"defamation":return se.a.createElement("div",{className:"ReportMenu-inner"},se.a.createElement("div",{className:"ReportMenu-paragraph"},"您好，当您发现知乎上有诽谤您的内容时，您可以向知乎进行举报。 请您把以下内容通过邮件发送到",se.a.createElement("a",{className:"ReportMenu-link",href:"mailto:i@zhihu.com"}," ","i@zhihu.com"," "),"邮箱，我们会尽快处理。"),se.a.createElement("ul",{className:"ReportMenu-paragraph"},se.a.createElement("li",null,"1. 您举报的内容以及侵犯了您什么权益？（请在邮件中列出您举报的内容、链接地址，并给出简短的说明）"),se.a.createElement("li",null,"2. 您是谁？（身份证明材料，可以是身份证或护照等证件）")),se.a.createElement("div",{className:"ReportMenu-paragraph ReportMenu-paragraph--light"},"邮件格式请参考 ",se.a.createElement("a",{className:"ReportMenu-link--light",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"这里")," ；"));default:return null}}}]),t}(ie.Component),Q.propTypes={reason:ae.a.string.isRequired},Z),Me=n(69),De=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Fe=(Y=J=function(e){function t(){return w(this,t),E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return k(t,e),De(t,[{key:"render",value:function(){var e=this.props,t=e.copywriter.placeholder,n=e.onDetailInput,o=e.errorText,r=e.checkCustomReasonContent;return se.a.createElement("div",{className:"ReportMenu-inner"},se.a.createElement(Me.a,{multiline:!0,grey:!0,rows:5,className:"ReportMenu-textarea",placeholder:t,onChange:function(e){return n(e.target.value)},onBlur:r}),se.a.createElement("div",{className:"ReportMenu-errorText"},o))}}]),t}(ie.Component),J.propTypes={onDetailInput:ae.a.func.isRequired,copywriter:ae.a.object,errorText:ae.a.string},Y),qe=(n(2352),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),ze=function(e){function t(){return O(this,t),P(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return j(t,e),qe(t,[{key:"render",value:function(){var e=this.props,t=e.checked,n=e.onChange,o=e.name,r=e.text,a=e.desc,i=o||r;return se.a.createElement("div",null,se.a.createElement("label",{className:"ReportOption-check",htmlFor:i},se.a.createElement("input",{type:"checkbox",name:i,checked:t,onChange:n}),se.a.createElement("span",null,"同时",r)),a&&se.a.createElement("div",{className:"ReportOption-desc"},a))}}]),t}(ie.Component),Ve=ze,Ue=function(e){var t=/[\u4e00-\u9fa5a-zA-Z0-9]/;return e.length>150?{isLegal:!1,errorReason:Te.a.contentTooLong}:t.test(e)?{isLegal:!0,errorReason:""}:{isLegal:!1,errorReason:Te.a.contentIllegal}},We=(n(2353),function(){function e(e,t){var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()),He=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ge=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Ke=(X=$=function(e){function t(){var e,n,o,r;N(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=R(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={blockChecked:null,commentChecked:null,activeId:0,parentId:null,selectedId:null,errorText:"",isMobile:!1,isSubmiting:!1,isSubmited:!1,path:[]},o.menuItems={},o.getReportText=function(e){if(!e)return"";var t=o.props.nodes[e];return t?t.text||Te.b[t.reason]||"":""},o.getReportLevel=function(){return"第 "+(o.state.path.length+1)+" 级"},o.handleItemSelect=function(e){var t=o.selectedId===e?null:e;o.setState({selectedId:t});var n=o.props,r=n.zaEnabled,a=n.type;t&&r&&ce.default.trackEvent(null,{action:"Select",element:"Menu",id:2883,name:o.getReportLevel()},{button:{text:o.getReportText(e)},report:{id:e,type:a}})},o.handleSubMenuEnter=function(e){o.setState(function(t){var n=t.activeId,o=t.path;return{activeId:e,parentId:n,selectedId:null,path:o.concat([e])}});var t=o.props,n=t.zaEnabled,r=t.type;n&&ce.default.trackEvent(null,{action:"Expand",element:"Menu",id:2883,name:o.getReportLevel()},{button:{text:o.getReportText(e)},report:{id:e,type:r}})},o.getCommentChecked=function(){var e=o.state,t=e.commentChecked,n=e.parentId,r=e.activeId;return"boolean"==typeof t?t:[2,3].includes(n||r)},o.handleDetailInput=function(e){o.setState({customReason:e,errorText:""})},o.handleBackClick=function(){var e=o.props.nodes,t=o.state,n=t.parentId,r=t.path,a=Object.keys(e).find(function(t){var o=e[t].childIds;return o&&o.includes(n)});o.setState({activeId:n,parentId:a&&Number(a),selectedId:null,hasWarning:!1,customReason:"",errorText:"",path:r.slice(0,-1)});var i=o.props,s=i.zaEnabled,c=i.type;s&&ce.default.trackEvent(null,{action:"Back",element:"Button",id:2884,name:o.getReportLevel()},{report:{id:o.state.activeId,type:c}})},o.handleSubmitAppeal=function(){var e="",t=o.state.activeId,n=o.props,r=n.type,a=n.urlToken,i=n.nodes;"enterprise"===i[t].reason||13===t?e="org":"oneself"!==i[t].reason&&37!==t||(e="people"),window.open("//www.zhihu.com/account/complaints/"+e+"/"+r+"/"+a)},o.handleSubmit=function(){var e=o.state,t=e.selectedId,n=e.customReason,r=e.activeId,a=e.parentId,i=o.getCommentChecked();if(o.isSubmitEnabled()&&o.checkCustomReasonContent()){var s=o.props,c=s.nodes,l=s.onSubmit,u=s.onDeleteComment,m=c[t||r],p=m.reason,d=m.id;o.setState({isSubmiting:!0});var f=l({reason:p,customReason:n});f&&f.then?f.then(o.submitEnd):o.submitEnd();var h=a||r,y=u&&[2,3].includes(h),b=o.props,v=b.zaEnabled,g=b.type;v&&(ce.default.trackEvent(null,{id:2885,name:o.getReportLevel()},{report:{type:g},button:{text:o.getReportText(d)}}),ce.default.trackEvent(o,He({action:"Report",element:"Button"},y&&{id:3039,name:p}),He({report:{id:d,type:g}},y&&{button:{text:i?"举报并删除":"仅举报"}})))}},o.submitEnd=function(e){o.setState({isSubmiting:!1,isSubmited:!0});var t=o.state.blockChecked,n=o.props,r=n.onBlockUser,a=n.onDeleteComment,i=n.onEnd;Promise.all([t&&r&&r(),o.getCommentChecked()&&a&&a()].map(function(e){return Promise.resolve(e).catch(function(e){return e})})).then(function(t){var n=We(t,2),o=n[0],r=n[1];i&&i({result:e,blockUserResult:o,commentDeleteResult:r})})},o.checkCustomReasonContent=function(){var e=o.state,t=e.activeId,n=e.customReason,r=o.props.nodes,a=r[t].copywriter;if((14===t||24===t||Boolean(a))&&n){var i=Ue(n),s=i.isLegal,c=i.errorReason;if(!s)return o.setState({errorText:c}),!1}return!0},r=n,R(o,r)}return _(t,e),Ge(t,[{key:"componentDidMount",value:function(){var e=this.props.type,t=Object(Ie.a)(navigator.userAgent);this.setState({isMobile:t.Mobile}),ce.default.trackCardShow(null,{id:2890},{button:{text:e}})}},{key:"componentWillUpdate",value:function(e,t){var n=this.state.activeId,o=t.activeId,r=this.props,a=r.nodes,i=r.onContentChange;if(o!==n){var s=a[o],c=s.reason,l=s.text,u=s.childIds,m=s.copywriter,p=s.subtitle;i(l||Te.b[c],p||m&&m.title||(u?void 0:""))}}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.zaEnabled,n=e.type,o=this.state.isSubmited;t&&!o&&ce.default.trackEvent(null,{id:4328,name:this.getReportLevel()},{report:{type:n}})}},{key:"isSubmitEnabled",value:function(){var e=this.state,t=e.selectedId,n=e.activeId,o=e.customReason,r=this.props.nodes;return t||(Boolean(r[n].copywriter)||14===n||24===n)&&(!1===r[n].copywriter.isRequired||o)}},{key:"render",value:function(){var e=this,t=this.props,n=t.nodes,o=t.options,r=S(t,["nodes","options"]),a=this.state,i=a.activeId,s=a.parentId,c=a.selectedId,l=a.errorText,u=a.isMobile,m=n[i],p=m.reason,d=m.childIds,f=m.copywriter,h=m.customComponent;if(void 0!==h)return se.a.createElement(h,He({onBackClick:this.handleBackClick,onItemSelect:this.handleItemSelect,onSubMenuEnter:this.handleSubMenuEnter},this.props,this.state));var y=Boolean(d),b=14===i||24===i||Boolean(f),v=y&&se.a.createElement("div",{className:"ReportMenu-inner ReportMenu-options"},d.map(function(e){return n[e]}).filter(function(e){return e&&(!e.shouldShow||e.shouldShow(r))}).map(function(t){return se.a.createElement(Be,He({ref:function(n){e.menuItems[t.id]=n},key:t.id},t,{isSelected:c===t.id,onSubMenuEnter:e.handleSubMenuEnter,onItemSelect:e.handleItemSelect}))})," ")||b&&se.a.createElement(Fe,{onDetailInput:this.handleDetailInput,copywriter:f,errorText:l,checkCustomReasonContent:this.checkCustomReasonContent})||se.a.createElement(Le,{isMobile:u,reason:p}),g=y&&r.talkerToken&&se.a.createElement(Ve,{checked:this.state.blockChecked,text:"将此人屏蔽",onChange:function(t){return e.setState({blockChecked:t.target.checked})}}),C=s||i,w=r.onDeleteComment&&[2,3].includes(C)&&se.a.createElement(Ve,{checked:this.getCommentChecked(),desc:Boolean(C)&&"社区鼓励举报"+n[C].text+"，同时可以直接删除该评论，删除操作并不影响对违规内容和违规用户的处理。",onChange:function(t){return e.setState({commentChecked:t.target.checked})},text:"删除该评论"}),E=this.props.isSubmiting;return se.a.createElement("div",{className:me()("ReportMenu",{"ReportMenu-mobile":u})},v,(g||w)&&se.a.createElement("div",null,g,w,o),se.a.createElement(fe.a,{direction:"horizontal"},"number"==typeof s&&se.a.createElement(de.c,{onClick:this.handleBackClick}," 返回 "),y||b?se.a.createElement(de.c,{className:"ReportMenu-button",disabled:E||!this.isSubmitEnabled(),onClick:this.handleSubmit,color:"blue",preset:"primary"},"举报"):!u&&se.a.createElement(de.c,{onClick:this.handleSubmitAppeal,preset:"primary",color:"blue"},"进入诉求提交页面")))}}]),t}(ie.Component),$.propTypes={nodes:ae.a.object.isRequired,onContentChange:ae.a.func.isRequired,onSubmit:ae.a.func.isRequired,onEnd:ae.a.func,onBlockUser:ae.a.func,onDeleteComment:ae.a.func,isColumnArticle:ae.a.bool,isTipjarEnabled:ae.a.bool},X),Qe=Ke,Ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Je=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Ye=(te=ee=function(e){function t(){var e,n,o,r;x(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=B(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.filterNodes=function(e,t,n){var o=e.filter(function(e){return!!e.isRequired||(-1!=["infringement","repost","oneself","enterprise","fake"].indexOf(e.reason)||0===e.id||("question"!==t||-1==["closed","suggested","evaluated","locked"].indexOf(n)||0===e.id)&&("member"!==t||-1==["ban","hang"].indexOf(n)||"profile"===e.reason))});return 1===o.length&&0===o[0].id&&(o=[]),o},r=n,B(o,r)}return A(t,e),Je(t,[{key:"render",value:function(){var e=this.props,t=e.type,n=e.status,o=T(e,["type","status"]),r=void 0;return r="message"===t?Re:"member"===t?_e:"favlist"===t?Ne:Se.filter(function(e){return!e.types||e.types.includes(t)}),r=this.filterNodes(r,t,n),se.a.createElement(Qe,Ze({nodes:r.reduce(function(e,t){return Ze({},e,I({},t.id,t))},{})},o,{type:t}))}}]),t}(ie.Component),ee.propTypes={type:ae.a.string.isRequired},te),$e=n(1817),Xe=n(1818),et=n(104),tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},nt=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ot="请选择举报理由",rt="举报",at=(oe=ne=function(e){function t(){var e,n,o,r;D(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=F(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={title:void 0!==o.props.title?o.props.title:rt,subtitle:void 0!==o.props.subtitle?o.props.subtitle:ot},o.handleSubmit=function(e){var t=e.reason,n=e.customReason,r=o.props,a=r.urlToken,i=r.type;return o.props.doReport(a,i,t,n)},o.handleContentChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ot;o.setState({title:e,subtitle:t})},o.handleClose=function(){o.props.zaEnabled&&ce.default.trackEvent(o.container,{action:"Ok"},{button:{text:"知道了"}}),o.props.onClose()},r=n,F(o,r)}return q(t,e),nt(t,[{key:"componentDidUpdate",value:function(e){if(!e.shown&&this.props.shown){var t=this.props,n=t.type,o=t.id;ce.default.setModule(this.container,{module:"ReportDialog"},{card:{card_type:"Content",content:M({type:Object(Xe.a)(n)},"comment"===n?"id":"token",String(o))}})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.shown,o=t.onClose,r=L(t,["shown","onClose"]),a=this.state,i=a.title,s=a.subtitle,c=Object($e.a)(r,Object.keys(le.b.propTypes)),l=c.selectedProps,u=c.dropedProps;return se.a.createElement(le.b,tt({title:i,subtitle:s,onClose:this.handleClose,className:"ReportModal"},l),n&&se.a.createElement(Ye,tt({ref:function(t){e.container=t},onSubmit:this.handleSubmit,onEnd:o,onContentChange:this.handleContentChange},u)))}}]),t}(ie.Component),ne.propTypes={onClose:ae.a.func.isRequired,type:ae.a.oneOf(et.a).isRequired,shown:ae.a.bool.isRequired,isColumnArticle:ae.a.bool,isTipjarEnabled:ae.a.bool,onBlockUser:ae.a.func,onDeleteComment:ae.a.func,doReport:ae.a.func.isRequired,zaEnabled:ae.a.bool},ne.defaultTypes={zaEnabled:!1},oe);n.d(t,"ReportModal",function(){return at})},2900:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function y(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function j(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _(e){var t=e.id,n=e.replyTo,o=e.isConversation;if(e.isNotification)return{type:"notification"};if(o)return{type:"conversation"};if(!n)return{type:"comment"};var r=n.featured,a=n.replyToAuthor,i=n.id;return t===i&&r&&!a?{type:"replyToFeatured"}:t===i&&r&&a?{type:"replyToSubFeatured"}:t!==i||a?t!==i&&a?{type:"replyToSubCommon"}:{type:"comment"}:{type:"replyToCommon"}}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function B(e,t){var n=t.parent,o=t.parent,r=o.type,a=o.id,i=t.status,s=t.order,c=t.byComment,l=t.commentPattern,u=t.notificationId,m=e.entities,p=e.commentsV2,d=e.commentsV2,f=d.conversation,h=d.stickers,y=void 0===h?[]:h,b=d.commentWithPicPermission,v=d.notificationsComments,g=r+"_"+a,C=p.parent,w=m.comments[c],E=p.pagination;"reviewing"===i&&(E=p.reviewing);var k="reverse"===s&&"open"===i;k&&(E=p.reverse);var O=[],P=p.collapsed[g]||{};P&&P.ids&&P.ids.length>0&&(O=P.ids.map(function(e){return m.comments[e]})),u&&(E=v,g=u);var j=E[g]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},S=j.isFetching,N=j.isPrevDrained,R=j.isDrained,_=j.ids,I=j.newIds,T=void 0===I?[]:I,x=j.totals,B="bottom"!==l?_:T,A=B.map(function(e){return m.comments[e]}),L=Re()(B,function(e){return String(e).includes("_featured")});return{currentUser:Object(qt.c)(e),isFetching:S,isPrevDrained:N,isDrained:R,totals:u?A.length:x,collapsedInfo:P,collapsedComments:O,targetComment:w,conversation:f,entities:m,stickers:y,lastFeaturedIndex:L,comments:A,isReverseAndStatusOpen:k,commentWithPicPermission:b,ids:B,parent:zt({},n,C[g])}}function A(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function D(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function F(e,t){var n=t.conversationId,o=t.isAnchorComments,r=e.entities.comments,a=e.commentsV2,i=a.conversation,s=a.conversationMore,c=i[n]||{isFetching:!1,isDrained:!1,isPrevDrained:!1,ids:[]},l=c.isFetching,u=c.isDrained,m=c.isPrevDrained,p=c.ids,d=c.totals,f=c.topComments;f=void 0===f?{}:f;var h=f.paging,y=h||{},b=y.isEnd,v=s[n]||{isFetching:!1,isDrained:!1,ids:[]},g=v.isFetching,C=v.isDrained,w=v.ids,E=w.map(function(e){return r[e]}),k=p.map(function(e){return r[e]}),O=r[n+"_featured"]||r[n]||{},P=o?Kt()(w.length?[].concat(A(k.slice(0,4)),A(E),A(k.slice(4))):k,"id"):[O].concat(A(k)),j=h?[].concat(A(k.slice(0,3)),A(E)).length:-1;return{isFetching:l,isDrained:u,isPrevDrained:m,totals:d,comments:P,openComment:O,topCommentsPaging:h,isConversationMoreFetching:g,isConversationMoreDrained:b||C,offsetIndex:j}}function q(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var W,H,G,K,Q,Z,J,Y,$,X,ee,te,ne,oe,re,ae,ie,se,ce,le,ue,me,pe,de,fe,he,ye,be,ve=n(0),ge=n.n(ve),Ce=n(1),we=n.n(Ce),Ee=n(5),ke=n(2),Oe=n.n(ke),Pe=n(535),je=n(1482),Se=n(175),Ne=n(2359),Re=n.n(Ne),_e=n(8),Ie=n(261),Te=n(1483),xe=n(260),Be=n(279),Ae=n(18),Le=n(19),Me=n(6),De=n(486),Fe=n.n(De),qe=n(31),ze=n(3),Ve=n(514),Ue=n(506),We=n(73),He=n(511),Ge=n(1396),Ke=n(273),Qe=n(17),Ze="zhihu::comment_local_key",Je=5,Ye=10,$e=1e3,Xe=980,et=function(){return""},tt={error:"上传失败",success:"上传成功",uploadIng:"上传中",default:""},nt=(n(2360),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),ot=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),rt=(W=Object(Ee.connect)(null,{showNotification:Qe.g,uploadImage:Ke.b}))((K=G=function(e){function t(){var e,n,a,i;o(this,t);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];return n=a=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.state={uploadStatus:tt.default},a.triggerClick=function(e){var t=a.props.handleInputActive;a.uploadInput.click(),t(!0),e.preventDefault()},a.onError=function(){var e=a.props,t=e.showNotification,n=e.resetUploadImg;t("图片上传失败","red"),n()},a.onSuccess=function(){a.setState({uploadStatus:tt.default})},a.resetFileInput=function(){a.uploadInput.value=null},a.beforeUpload=function(e){var t=a.props.showNotification;return e?e.size>1024*Ye*1024?(t("请上传小于 "+Ye+"M 的图片。","red"),a.resetFileInput(),!1):(a.reactPopoverNode.open(),void a.setState({uploadStatus:tt.uploadIng})):(a.resetFileInput(),!1)},a.uploadImage=function(e){var t=e.file,n=a.props,o=n.uploadImage,r=n.handleImages,i=n.updatePublishStatus;o(t).then(function(e){r([nt({},e.payload,{url:e.payload.src})]),i(!1),a.resetFileInput()}).catch(function(){a.setState({uploadStatus:tt.error}),r([])})},a.handleOnRef=function(e){var t=a.props.onRef;t&&t(e),a.reactPopoverNode=e},i=n,r(a,i)}return a(t,e),ot(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.images,o=t.disableButton,r=t.resetUploadImg,a=this.state.uploadStatus,i=Boolean(n.length);return ge.a.createElement(ve.Fragment,null,ge.a.createElement(We.a,{className:"ImagePopover",arrowed:!0,ref:this.handleOnRef,placement:"bottom",globalClose:!n.length,onClick:this.triggerClick,toggler:ge.a.createElement(He.a,{label:"插入图片",icon:_e.b,disabled:o})},ge.a.createElement("div",{className:"ImagePopover-thumbnail"},i&&ge.a.createElement(ve.Fragment,null,ge.a.createElement("img",{src:n[0].src}),ge.a.createElement("div",{className:"closeButton",onClick:r},ge.a.createElement(_e.z,null))),a&&!i&&ge.a.createElement("p",{className:"ImagePopover-uplodaStatus"},a))),ge.a.createElement(Ge.a,{accept:"image/png,image/jpeg",onRef:function(t){e.uploadInput=t},beforeUpload:this.beforeUpload,customUpload:this.uploadImage,onSuccess:this.onSuccess,onError:this.onError}))}}]),t}(ve.Component),G.propTypes={className:we.a.string,disableButton:we.a.bool},G.defaultProps={disableButton:!0},H=K))||H,at=n(68),it=(n(2361),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),st=(Z=Q=function(e){function t(e){i(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.state={isGifReady:!1,isGifError:!1},n.renderLoadStatus=function(){var e=n.state.isGifError;return ge.a.createElement("div",{className:"CommentSticker-load"},e?ge.a.createElement(ge.a.Fragment,null,ge.a.createElement(_e._54,{className:"CommentSticker-load-Icons"}),"加载失败"):ge.a.createElement(ge.a.Fragment,null,ge.a.createElement(_e.T,{className:"CommentSticker-load-Icons"}),"加载中"))};var o=n.props.src;return Object(at.b)(Object(at.a)(o)).then(function(){n.setState({isGifReady:!0})}).catch(function(){n.setState({isGifError:!0})}),n}return c(t,e),it(t,[{key:"render",value:function(){var e=this.state.isGifReady,t=this.props,n=t.src,o=t.handleStickerClick;return ge.a.createElement("div",{className:"CommentSticker"},e?ge.a.createElement("img",{src:n,className:"CommentSticker-img",onClick:o}):this.renderLoadStatus())}}]),t}(ge.a.Component),Q.propsTypes={handleStickerClick:we.a.func},Z),ct=st,lt=(n(2362),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),ut=(Y=J=function(e){function t(){var e,n,o,r;l(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.handleOnRef=function(e){var t=o.props.onRef;t&&t(e)},r=n,u(o,r)}return m(t,e),lt(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.sticker,o=e.stickers,r=e.disableButton,a=e.handleStickerPopoverOpen,i=e.handleStickerPopoverClose,s=e.resetStickers,c=e.addSticker,l=e.handleEmotionClick;return ge.a.createElement(We.a,{className:t,arrowed:!0,ref:this.handleOnRef,globalClose:!n.length,preventCloseOnTarget:!0,onClick:l,onOpen:a,onClose:i,toggler:ge.a.createElement(He.a,{label:"插入表情",icon:_e.T,disabled:r}),placement:"bottom"},Boolean(n.length)&&ge.a.createElement("li",{className:"StickerPopover-stickers-item StickerPopover-stickers-item-single"},ge.a.createElement("img",{src:Object(at.a)(n[0].url),alt:n[0].title}),ge.a.createElement("div",{className:"closeButton",onClick:s},ge.a.createElement(_e.z,null))),!n.length&&ge.a.createElement("div",{className:"StickerPopover-stickers-wrap"},ge.a.createElement("ul",{className:"StickerPopover-stickers-list"},o.map(function(e){var t=e.url,n=e.title,o=e.id;return ge.a.createElement("li",{className:"StickerPopover-stickers-item",key:o},ge.a.createElement(ct,{width:48,height:48,src:t,handleStickerClick:function(){return c(e)}}),ge.a.createElement("p",null,n))}))))}}]),t}(ve.Component),J.propTypes={className:we.a.string,disableButton:we.a.bool},J.defaultProps={disableButton:!0},Y),mt=n(70),pt=(n(2363),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),dt=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ft=function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["回复","",""],["回复","",""]),ht=($=Object(Ee.connect)(function(e){return{edition:Object(mt.d)(e),referer:Object(mt.g)(e),stickers:e.commentsV2.stickers||[],commentWithPicPermission:e.commentsV2.commentWithPicPermission||{}}},{showNotification:Qe.g}),Object(Le.withRouter)(X=$((te=ee=function(e){function t(){var e,n,o,r;d(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={active:!1,disabled:!0,shown:!1,value:{toHTML:et},images:[],uploadIsFetchingNum:0,sticker:[],stickerIconActive:!1,toggleInputStyle:!1,commentTextLength:0},o.handleSubmit=o.context.authRequired(function(){var e=o.props,t=e.replyTo,n=e.onSubmit,r=e.onCancel,a=e.rootCommentId,i=e.isConversation,s=e.zaInfo.zaSubmitCommentId,c=o.state,l=c.images,u=c.sticker,m=o.input.toHTML();if(m||l.length||u.length){m&&o.saveLocalComment();var p=m;if(l.length||u.length){var d=l[0]||u[0];p+='<a class="'+(l[0]&&(l[0].url.includes(".gif")?"comment_gif":"comment_img")||"comment_sticker")+"\" href='"+d.url+"' data-width='"+(d.dataRawwidth||"")+"' data-height='"+(d.dataRawheight||"")+"'>["+(d.title||"图片")+"]</a>"}var f=n(p,t,{rootCommentId:a,isConversation:i});f.then?f.then(function(){r&&r(),o.input?(o.input.reset(),o.resetImage(),o.setState({value:{toHTML:et}},function(){return o.saveLocalComment()})):o.saveLocalComment({toHTML:et})}):(r&&r(),o.input.reset()),Me.default.trackEvent(o,pt({action:"Comment",element:"Button"},s&&{id:s}))}},void 0,Qe.b),o.handleCommentShow=o.context.authRequired(function(){o.setState({shown:!0}),o.hiddenInput.focus()}),o.handleCommentHide=function(){o.setState({shown:!1})},o.initLocalComment=function(){var e=o.props,t=e.type,n=e.id;if(t&&n){var r=qe.a.get(Ze)||[],a=t+"_"+n,i=r.find(function(e){return e.key===a}),s=i&&i.value;s&&o.setState({value:{toHTML:function(){return s}},disabled:!1})}},o.saveLocalComment=function(e){var t=o.props,n=t.type,r=t.id;if(n&&r){var a=e?e.toHTML():o.state.value.toHTML(),i=n+"_"+r,s=(qe.a.get(Ze)||[]).filter(function(e){return e.key!==i}),c=a?[].concat(p(s.slice(0,Je-1)),[{key:i,value:a}]):s;qe.a.set(Ze,c)}},o.handleChange=function(e){var t=o.state,n=t.sticker,r=t.images;n.length||r.length?o.setState({value:e}):o.setState({value:e,disabled:e.isEmpty}),o.handleInputChange()},o.handleFocus=function(){o.setState({active:!0},o.handleInputChange)},o.handleBlur=function(){var e=o.state,t=e.sticker,n=e.images;t.length||n.length||(o.setState({active:!1}),o.handleInputChange())},o.handleMobileComment=function(){o.handleSubmit(),o.handleCommentHide()},o.handleEmotionClick=function(){var e=o.state.stickerIconActive;e&&o.setState({stickerIconActive:e},o.stickerPopover.close)},o.handleInputChange=function(){if(o.input){var e=Object(Ae.findDOMNode)(o.input);e.getBoundingClientRect().height>40?o.setState({toggleInputStyle:!0}):o.setState({toggleInputStyle:!1});var t=void 0;t="innerText"in document?e.innerText.length:e.textContent.length,o.setState({commentTextLength:t}),o.imgUploadPopover&&o.imgUploadPopover.position(),o.stickerPopover&&o.stickerPopover.position()}},o.handleStickerPopoverOpen=function(){o.setState({active:!0,stickerIconActive:!0},o.stickerPopover.position),setTimeout(o.stickerPopover.position,400)},o.handleStickerPopoverClose=function(){o.setState({stickerIconActive:!1})},o.handleImages=function(e){o.setState({images:e},o.imgUploadPopover.position)},o.handleInputActive=function(e){o.setState({active:e})},o.updatePublishStatus=function(e){o.setState({disabled:e})},o.resetStickers=function(){var e=o.state.value,t=void 0===e.isEmpty||e.isEmpty;o.stickerPopover&&o.stickerPopover.close(),o.setState({sticker:[],disabled:t})},o.resetImage=function(){o.resetStickers(),o.resetUploadImg()},o.resetUploadImg=function(){var e=o.state.value,t=void 0===e.isEmpty||e.isEmpty;o.imgUploadPopover&&o.imgUploadPopover.close(),o.setState({images:[],disabled:t})},o.addSticker=function(e){o.setState({sticker:[e],disabled:!1},o.stickerPopover.position)},o.createImageOnRef=function(e){o.imgUploadPopover=e},o.createStickerOnRef=function(e){o.stickerPopover=e},o.renderInput=function(e){var t=e.placeholder,n=e.className,r=o.props,a=r.autoFocus,i=r.stickers,s=r.commentWithPicPermission.commentWithPic,c=o.state,l=c.images,u=c.sticker,m=c.stickerIconActive,p=c.toggleInputStyle,d=c.active,f=c.commentTextLength,h=Boolean(u.length)||Boolean(l.length);return ge.a.createElement("div",{className:Oe()("CommentEditorV2-inputWrap",{"CommentEditorV2-inputWrap--change":p,"CommentEditorV2-inputWrap--active":d}),onClick:function(e){e.nativeEvent.stopImmediatePropagation()}},ge.a.createElement(Ve.a,{className:Oe()("CommentEditorV2-input",n),defaultValue:o.state.value.toHTML(),richtext:!0,large:!0,spread:!0,allowMention:!0,autoFocus:a,outputBlockType:"div",onRef:function(e){o.input=e},placeholder:t,onFocus:o.handleFocus,onChange:o.handleChange,onSubmit:o.handleSubmit,minRows:5}),ge.a.createElement("div",{className:Oe()("CommentEditorV2-inputUpload",{"CommentEditorV2-inputUpload--FlexEnd":p,"CommentEditorV2-inputUpload--SpaceBetween":p&&f>Xe})},p&&f>Xe&&ge.a.createElement(Ue.a,{className:"CommentEditorV2-MaxLength",current:f,max:$e}),ge.a.createElement("div",{className:"CommentEditorV2-popoverWrap"},s&&ge.a.createElement(rt,{onRef:o.createImageOnRef,images:l,disableButton:h,resetUploadImg:o.resetUploadImg,handleInputActive:o.handleInputActive,updatePublishStatus:o.updatePublishStatus,handleImages:o.handleImages}),ge.a.createElement(ut,{className:Oe()("CommentEditorV2-inputUpLoad-Icon",{"CommentEditorV2-inputUpLoad-Icon--active":m&&!u.length}),onRef:o.createStickerOnRef,disableButton:h,handleEmotionClick:o.handleEmotionClick,handleStickerPopoverOpen:o.handleStickerPopoverOpen,handleStickerPopoverClose:o.handleStickerPopoverClose,stickerIconActive:m,sticker:u,stickers:i,resetStickers:o.resetStickers,addSticker:o.addSticker}))))},r=n,f(o,r)}return h(t,e),dt(t,[{key:"componentDidMount",value:function(){this.initLocalComment(),document.addEventListener("click",this.handleBlur)}},{key:"componentWillUnmount",value:function(){this.saveLocalComment(),document.removeEventListener("click",this.handleBlur)}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,o=e.className,r=e.ownerAuthorIsOrg,a=e.ownerAuthorIsBrand,i=this.state,s=i.active,c=i.disabled,l=r?"机构":"作者",u={preset:"primary",color:"blue",children:"发布",disabled:c};if(t){var m=Fe()(ft,t.author.member.name,n?"，评论由"+l+"筛选后公开":"");return ge.a.createElement("div",{className:Oe()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":s})},this.renderInput({placeholder:m}),ge.a.createElement(ze.c,pt({},u,{className:"CommentEditorV2-singleButton",onClick:this.handleSubmit})))}var p="写下你的评论...";return n&&(p=a?"已开启预审评论，评论由品牌筛选后公开":r?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示"),ge.a.createElement("div",{className:Oe()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":s})},this.renderInput({placeholder:p}),ge.a.createElement(ze.c,pt({},u,{className:"CommentEditorV2-singleButton",onClick:this.handleSubmit})))}}]),t}(ve.Component),ee.propTypes={className:we.a.string,defaultActive:we.a.bool,replyTo:we.a.object,inCommentItem:we.a.bool,commentNeedsReview:we.a.bool,canComment:we.a.object,onCancel:we.a.func,onSubmit:we.a.func.isRequired,zaInfo:we.a.object},ee.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1,zaInfo:{}},ee.contextTypes={authRequired:we.a.func},X=te))||X)||X),yt=n(1861),bt=n(1680),vt=n(481),gt=n(1311),Ct=n(268),wt=n(170),Et=n(1291),kt=n(262),Ot=(n(2364),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),Pt=function(e){function t(){var e,n,o,r;b(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=v(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={previewImg:null},o.handlePreview=function(e){var t=e.target;o.setState({previewImg:t})},r=n,v(o,r)}return g(t,e),Ot(t,[{key:"mount",value:function(){var e=this;this.imagesGifNode=this.root.getElementsByClassName("comment_gif"),this.imagesNode=this.root.getElementsByClassName("comment_img"),this.imagesStickerNode=this.root.getElementsByClassName("comment_sticker"),this.imgNode=this.root.getElementsByClassName("origin_image zh-lightbox-thumb"),this.imagesNodes=Array.from([].concat(y(this.imagesGifNode),y(this.imagesNode),y(this.imagesStickerNode),y(this.imgNode))).map(function(t){var n=t.dataset||{},o=n.width,r=n.height,a=n.rawwidth,i=n.rawheight,s=Number(o||a),c=Number(r||i),l=document.createElement("div");l.className="Richtext-content_img",t.parentNode.replaceChild(l,t);var u=t.getAttribute("href")||t.getAttribute("src"),m=new Image,p=t.getAttribute("class");return"comment_sticker"!==p&&l.addEventListener("click",e.handlePreview),m.className=p,m.src=u,m.dataset.original=Object(at.a)(u,"r"),m.dataset.rawwidth=s,m.onload=function(){s===c||"comment_sticker"===p?l.classList.add("Richtext-content_img-square"):s>c?l.classList.add("Richtext-content_img-square--wideShape"):l.classList.add("Richtext-content_img-square--highShape"),l.appendChild(m)},l})}},{key:"unmount",value:function(){this.imagesNodes&&this.imagesNodes.forEach(function(e){Object(Ae.unmountComponentAtNode)(e)})}},{key:"componentDidMount",value:function(){this.mount()}},{key:"componentWillUpdate",value:function(e){this.props.html!==e.html&&this.unmount()}},{key:"componentDidUpdate",value:function(e){e.html!==this.props.html&&this.mount()}},{key:"componentWillUnmount",value:function(){this.unmount()}},{key:"render",value:function(){var e=this,t=this.state.previewImg,n=this.props,o=n.html,r=n.className;return ge.a.createElement("div",{className:Oe()("CommentRichText",r),ref:function(t){return e.root=t}},ge.a.createElement(kt.a,{html:o}),t&&ge.a.createElement(Et.a,{className:"CommentRichText-ImageView",img:t,onClose:function(){return e.setState({previewImg:null})}}))}}]),t}(ve.Component),jt=n(10),St=n(112),Nt=n(564),Rt=(n(2365),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),_t=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),It=(ne=Object(Ee.connect)(function(e){return{edition:Object(mt.d)(e),referer:Object(mt.g)(e),isWechat:e.env.userAgent.Wechat}}),Object(Le.withRouter)(oe=ne((ae=re=function(e){function t(){var e,n,o,r;C(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=w(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={reportModalShown:!1,isReplying:!1,collapsed:!0,guideShown:!1,deleteModal:!1},o.toggleReply=o.context.authRequired(function(){o.setState({isReplying:!o.state.isReplying})},void 0,Qe.b),o.openReportModal=o.context.authRequired(function(){o.setState({reportModalShown:!0})}),o.like=o.context.authRequired(function(e){var t=o.props;(0,t.onLike)(t.comment.id,e)},jt.L.like,Qe.b),o.dislike=o.context.authRequired(function(){var e=o.props;(0,e.onDislike)(e.comment.id)},jt.L.like,Qe.b),o.delete=function(){var e=o.props;return(0,e.onDelete)(e.comment.id)},o.feature=function(e){var t=o.props,n=t.onFeature,r=t.comment.id;n(e?r+"_featured":r)},o.collapse=function(){var e=o.props;(0,e.onCollapse)(e.comment.id)},o.approve=function(){var e=o.props;(0,e.onApprove)(e.comment.id)},o.reject=function(){var e=o.props;(0,e.onReject)(e.comment.id)},o.showConversation=function(e){var t=o.props;(0,t.onShowConversation)({commentId:t.comment.id,isAnchorComments:e})},o.stopReply=function(){o.setState({isReplying:!1})},o.closeReportModal=function(e){if(e){var t=e.result.payload,n=t&&t.message||t&&t.code&&"举报失败";e.commentDeleteResult&&!(e.commentDeleteResult.payload||{}).code?gt.b.showModal({reportText:n}):Object(St.b)(n||"举报成功")}o.setState({reportModalShown:!1})},o.handleToggleGuide=function(){o.setState({guideShown:!o.state.guideShown})},o.handleCloseDelete=function(){return o.setState({deleteModal:!1})},o.handleDelete=function(){return o.setState({deleteModal:!0})},r=n,w(o,r)}return E(t,e),_t(t,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:ge.a.createElement("span",{className:"CommentItemV2-roleInfo"},"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) ")}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var o=t.member,r=void 0===o?{}:o,a=t.role;return ge.a.createElement(ge.a.Fragment,null,ge.a.createElement("span",{className:"CommentItemV2-reply"},"回复"),ge.a.createElement(wt.a,{noBadge:!0,noHoverCard:!0,user:r}),this.renderRoleInfo(a,n))}},{key:"renderItem",value:function(){var e=this,t=this.props,n=t.comment,o=n.isDelete,r=n.collapsed,a=t.isConversation,i=t.ownerAuthorIsOrg,s=r&&a&&this.state.collapsed,c=o||s,l=this.state,u=l.reportModalShown,m=l.isReplying,p=this.props,d=p.parent,f=d.canComment;f=void 0===f?{status:!0}:f;var h=f.status,y=d.questionType,b=p.commentNeedsReview,v=p.comment,g=p.onReply,C=p.status,w=p.type,E=p.canOperate,k=p.commentPattern,O=p.rootCommentId,P=p.byComment,j=p.isReverseAndStatusOpen,S=p.hasRecommend,N=p.isQuestionAuthor,R=v.id,_=v.author,I=v.content,T=v.voteCount,x=v.replyToAuthor,B=v.isAuthor,A=v.createdTime,L=v.featured,M=v.voting,D=v.reviewing,F=v.disliked,q=v.resourceType,z=v.childCommentCount,V=v.allowDelete,U=v.allowVote,W=v.canRecommend,H=v.canCollapse,G=v.collapsedReason,K=void 0===G?"":G,Q=_||{},Z=Q.member,J=Q.role,Y=Boolean(x),$=L&&(z>0||Y)&&!a,X=P&&Y,ee=j&&Y,te=$||X||ee,ne=void 0,oe=B||V&&("question"!==w||"commercial"===y),re=ge.a.createElement("div",{className:"CommentItemV2-footer"},ge.a.createElement(ze.c,{className:Oe()("CommentItemV2-likeBtn",M&&"is-liked"),preset:"plain",onClick:this.like,disabled:B},ge.a.createElement(_e._30,{style:{marginRight:5},center:!0,size:16}),T>0?T:"赞"),r&&K&&ge.a.createElement("div",{className:"CommentItemV2-walleTag"},"阴阳怪气自动折叠"===K&&ge.a.createElement(_e.e,{size:16,className:"CommentItemV2-walleIcon"}),K),te&&ge.a.createElement(ze.c,{preset:"plain",className:"CommentItemV2-talkBtn",onClick:function(){return e.showConversation(Y)}},ge.a.createElement(_e.B,{style:{marginRight:5},center:!0,size:16}),"查看回复"),!B&&h&&!r&&ge.a.createElement(ze.c,{preset:"plain",className:Oe()({"CommentItemV2-hoverBtn":!m}),onClick:this.toggleReply},ge.a.createElement(_e._52,{style:{marginRight:5},center:!0,size:16}),m?"取消回复":"回复"),W&&!S&&E&&ge.a.createElement(ze.c,{className:Oe()({"CommentItemV2-hoverBtn":!B&&!m}),preset:"plain",onClick:function(){return e.feature(L)}},ge.a.createElement(_e._50,{style:{marginRight:5},center:!0,size:16}),L?"取消推荐":"推荐"),H&&!B&&ge.a.createElement(ze.c,{className:Oe()({"CommentItemV2-hoverBtn":!B&&!m}),preset:"plain",onClick:this.collapse},ge.a.createElement(_e.V,{style:{marginRight:5},center:!0,size:14}),r?"取消折叠":"折叠"),U&&!B&&E&&ge.a.createElement(ze.c,{className:Oe()({"CommentItemV2-hoverBtn":!m}),preset:"plain",onClick:this.dislike},ge.a.createElement(_e._30,{style:{transform:"rotate(180deg)",marginRight:5},size:16,center:!0}),F?"取消踩":"踩"),B||ge.a.createElement(ge.a.Fragment,null,ge.a.createElement(ze.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.openReportModal},ge.a.createElement(_e._53,{style:{marginRight:5},center:!0,size:16}),"举报"),"question"===w&&"commercial"===y&&N&&ge.a.createElement(ze.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.reject},ge.a.createElement(_e.V,{style:{marginRight:5},center:!0,size:16}),"隐藏")),oe&&ge.a.createElement(ze.c,{className:Oe()({"CommentItemV2-hoverBtn":!B&&!m&&!m}),preset:"plain",onClick:this.handleDelete},ge.a.createElement(_e._66,{style:{marginRight:5},center:!0,size:16}),"删除"),ge.a.createElement(gt.a,{shown:this.state.deleteModal,id:R,onDelete:this.delete,onClose:this.handleCloseDelete}),ge.a.createElement(Ct.a,Rt({type:"comment",urlToken:R,shown:u,onClose:this.closeReportModal},oe&&{onDeleteComment:this.delete},{notification:{failure:Nt.a},zaEnabled:!0})));return ne=m?ge.a.createElement("div",null,re,ge.a.createElement(ht,{type:"comment",id:R,commentNeedsReview:b,className:"CommentItemV2-editor",defaultActive:!0,replyTo:v,onCancel:this.stopReply,onSubmit:g,rootCommentId:O,isConversation:a})):"reviewing"===C?ge.a.createElement("div",{className:"CommentItemV2-footer"},ge.a.createElement(ze.c,{preset:"plain",onClick:this.approve},ge.a.createElement(_e.U,{style:{marginRight:5},center:!0,size:14}),"公开"),ge.a.createElement(ze.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.handleDelete},ge.a.createElement(_e._66,{style:{marginRight:5},center:!0,size:16}),"删除"),ge.a.createElement(gt.a,{shown:this.state.deleteModal,id:R,onDelete:this.delete,onClose:this.handleCloseDelete})):re,ge.a.createElement("div",null,ge.a.createElement("div",{className:"CommentItemV2-meta"},Z&&ge.a.createElement(wt.a,{className:"CommentItemV2-avatar",avatar:!0,noHoverCard:"fixed"===k,user:Z}),Z&&ge.a.createElement(wt.a,{noBadge:!0,noHoverCard:!0,user:Z}),this.renderRoleInfo(J,q),this.renderReplyTo(),D&&ge.a.createElement(_e.V,{className:"CommentItemV2-reviewing","data-tooltip":!1===i?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开",center:!0,size:14}),ge.a.createElement("span",{className:"CommentItemV2-time"},Object(vt.e)(A))),ge.a.createElement("div",{className:"CommentItemV2-metaSibling"},ge.a.createElement(Pt,{className:Oe()("CommentItemV2-content",{"CommentItemV2-shield":c}),html:I}),!c&&ne))}},{key:"render",value:function(){return this.renderItem()&&ge.a.createElement("div",{className:"CommentItemV2",ref:this.props.onRef},this.renderItem())}}]),t}(ve.Component),re.propTypes={comment:we.a.object.isRequired,parent:we.a.object.isRequired,commentNeedsReview:we.a.bool,type:we.a.string,isConversation:we.a.bool,onLike:we.a.func.isRequired,onShowConversation:we.a.func,onReply:we.a.func,onFeature:we.a.func,onDelete:we.a.func.isRequired,onCollapse:we.a.func,commentPattern:we.a.string},re.contextTypes={currentUser:we.a.object,authRequired:we.a.func},oe=ae))||oe)||oe),Tt=(n(2366),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),xt=5,Bt=2,At=(se=ie=function(e){function t(){var e,n,o,r;O(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=P(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={},o.handleClick=function(){var e=o.props,t=e.loadRestComments,n=e.onShowConversation,r=e.comment,a=r.id,i=r.childCommentCount,s=i<=xt&&i>Bt;(s?t:n)({commentId:a}),s&&o.setState(k({},"hide_"+a,!0))},o.handleRef=function(e){var t=o.props.onRef;"function"==typeof t&&t(e)},r=n,P(o,r)}return j(t,e),Tt(t,[{key:"render",value:function(){var e=this.props,t=e.comment,n=t.id,o=t.childCommentCount,r=e.isFetching,a=e.className,i=this.state["hide_"+n],s=o<=xt&&o>Bt,c=s?"展开其他 "+(o-Bt)+" 条回复":"查看全部 "+o+" 条回复";return ge.a.createElement("div",{className:a,ref:this.handleRef},!i&&ge.a.createElement("div",{className:"CommentMoreReplyButton"},ge.a.createElement(ze.c,{preset:"plain",onClick:this.handleClick},c)),r&&ge.a.createElement(Ie.a,{className:"CommentMoreReplyButton",small:!0}))}}]),t}(ve.Component),ie.propTypes={comment:we.a.object.isRequired,isFetching:we.a.bool,onShowConversation:we.a.func,loadRestComments:we.a.func},se),Lt=(n(2367),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),Mt=(ce=Object(Ee.connect)(null,{loadConversation:Pe.g}))(le=function(e){function t(){var e,n,o,r;S(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=N(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.loadRestComments=function(e){var t=e.commentId;(0,o.props.loadConversation)({id:t,isLoadRest:!0})},r=n,N(o,r)}return R(t,e),Lt(t,[{key:"render",value:function(){var e=this.props,t=e.parent,n=t.type,o=t.author;o=void 0===o?{isOrg:!1}:o;var r=o.isOrg,a=e.parent,i=e.commentNeedsReview,s=e.onShowConversation,c=e.status,l=e.onItemLike,u=e.onItemDelete,m=e.onItemCollapse,p=e.onItemDislike,d=e.onItemApprove,f=e.onItemReject,h=e.canOperateItem,y=e.commentPattern,b=e.conversation,v=void 0===b?{}:b,g=e.entities,C=e.byComment,w=e.isReverseAndStatusOpen,E=e.comment,k=e.onReply,O=e.onFeature,P=e.ids,j=e.isAuthor,S=E.id,N=E.featured,R=E.childComments,_=void 0===R?[]:R,I=E.childCommentCount,T=void 0===I?0:I,x=N?S+"_featured":""+S,B=!N,A=B&&P.includes(S+"_featured"),L=Boolean(_.length)&&!w,M=T<=5&&T>2,D=_.map(function(e){return g.comments[e]}),F=!N&&T>2&&!w,q=M&&v[S]||{isFetching:!1},z=q.isFetching;return ge.a.createElement(ve.Fragment,null,ge.a.createElement("li",{className:Oe()({"NestComment--rootCommentNoChild":!L,"NestComment--rootComment":L}),key:x},ge.a.createElement(It,{key:x,comment:E,status:c,type:n,parent:a,canOperate:h,commentNeedsReview:i,onShowConversation:s,ownerAuthorIsOrg:r,onLike:l,onReply:k,onFeature:O,onDelete:u,onCollapse:m,onDislike:p,onApprove:d,onReject:f,commentPattern:y,rootCommentId:S,byComment:C,isReverseAndStatusOpen:w,hasRecommend:A,isQuestionAuthor:j})),L&&D.map(function(e){var t=e.id,o=e.featured,b=o?t+"_featured":""+t,v=!o,g=v&&P.includes(t+"_featured");return ge.a.createElement("li",{className:"NestComment--child",key:b},ge.a.createElement(It,{key:b,comment:e,status:c,type:n,parent:a,canOperate:h,commentNeedsReview:i,onShowConversation:s,ownerAuthorIsOrg:r,onLike:l,onReply:k,onFeature:O,onDelete:u,onCollapse:m,onDislike:p,onApprove:d,onReject:f,commentPattern:y,rootCommentId:S,hasRecommend:g,isQuestionAuthor:j}))}),F&&ge.a.createElement(At,{comment:E,isFetching:z,onShowConversation:s,loadRestComments:this.loadRestComments}))}}]),t}(ve.Component))||le,Dt=n(171),Ft=n(490),qt=n(21),zt=(n(2368),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),Vt=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Ut=(ue=Object(Ee.connect)(B,{loadComments:Pe.f,loadConversation:Pe.g,addComment:Pe.a,loadStickers:Pe.j,clearNotification:Qe.e,getCommentWithPicPermission:Pe.e,loadNotificationComments:Pe.i,loadAnswerCommentPermission:Dt.l,loadArticleCommentPermission:Ft.b}))((de=pe=function(e){function t(){var e,n,o,r;I(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=T(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={collapsed:!0,current:1,packupButtonStatus:!1,packupButtonLeft:0},o.load=function(e,t,n){if(!o.props.isFetching&&!o.props.parent.adminClosedComment){var r=e||o.props,a=r.order,i=r.status,s=r.parent,c=s.id,l=s.type,u=r.commentPattern,m=r.needLoadCommentPermission,p=r.loadComments,d=r.notificationId,f=r.loadNotificationComments;if(d)return f(d);if(m&&o.loadCommentPermission(l,c),n){p(l,c,{order:a,isPrevious:t,status:"collapsed",commentPattern:u},!0)}else p(l,c,{order:a,isPrevious:t,status:i,commentPattern:u})}},o.addComment=function(e,t,n){var r=n.rootCommentId,a=n.isConversation,i=o.props,s=i.parent,c=s.id,l=s.type,u=i.commentId,m=i.addComment,p=i.notificationId;return m({parentType:l,parentId:c,content:e,replyTo:t,conversationId:u,rootCommentId:r,isConversation:a,notificationId:p,replyType:_({id:r,replyTo:t,isConversation:a,isNotification:Boolean(p)}).type})},o.featureItem=function(e){(0,o.props.onItemFeature)(e,o.lastFeaturedIndex)},o.handleOpenCollapsed=function(){o.setState({collapsed:!1}),o.load(o.props,!1,!0)},o.handleScroll=function(){if(o.commentsElement&&o.commentsWithPaginationEl){var e=window.innerHeight,t=o.state.packupButtonStatus,n=o.commentsWithPaginationEl.getBoundingClientRect(),r=n.top,a=n.bottom,i=n.height;!t&&i>500&&a>e&&r<0?o.setState({packupButtonStatus:!0}):t&&(i<=500||a<=e||r>=0)&&o.setState({packupButtonStatus:!1})}},o.handlePageSelect=function(e){var t=o.props.onPaginationClick,n=o.state.current;t&&t(n,e),o.commentsElement.scrollIntoView(),o.setState({current:e}),o.loadByPagination(e)},o.loadByPagination=function(e,t){var n=t||o.props,r=n.order,a=n.status,i=n.parent,s=i.id,c=i.type,l=n.commentPattern,u=n.needLoadCommentPermission,m=n.loadComments;u&&o.loadCommentPermission(c,s),m(c,s,{order:r,isPrevious:!1,status:a,commentPattern:l,current:e})},o.renderComment=function(e){var t=e.id,n=e.featured,r=n?t+"_featured":t;return ge.a.createElement("ul",{className:"NestComment",key:r},ge.a.createElement(Mt,zt({comment:e,onReply:o.addComment,onFeature:o.featureItem},o.props)))},o.renderNormalComments=function(e){var t=o.state.collapsed,n=o.props,r=n.byComment,a=n.lastFeaturedIndex,i=n.parent,s=i.featuredCounts,c=i.commonCounts,l=[],u=s>0;return o.lastFeaturedIndex=0,e.length>0&&e.forEach(function(n,i){if(r||!n.collapsed){var m=e[i-1];n.collapsed&&(m&&m.collapsed||l.push(o.renderCollapsedDivider()),t)||(i===a&&l.push(ge.a.createElement("div",{className:"NestComment-nextSiblings--noBorder",key:"NestComment-nextSiblings--noBorder"})),u&&0===i&&-1!==a&&l.push(ge.a.createElement("div",{className:"CommentListV2-header-divider",key:"divider-featured"},"精选评论（",s,"）")),l.push(o.renderComment(n)),i===a&&(o.lastFeaturedIndex=i,l.push(ge.a.createElement("div",{className:"CommentListV2-header-divider",key:"divider-comment"},"评论（",c,"）"))))}}),l},o.renderCollapsedComments=function(){var e=[],t=o.props,n=t.collapsedComments,r=t.isDrained,a=t.parent;a=void 0===a?{}:a;var i=a.collapsedCounts;return!r||i<=0?[]:(e.push(n.map(function(e){return o.renderComment(e)})),e)},o.renderComments=function(e){return e.map(o.renderComment)},o.renderCollapsedDivider=function(){var e=o.props,t=e.isDrained,n=e.parent.collapsedCounts;return!t||n<=0?[]:o.state.collapsed?ge.a.createElement("div",{className:"CommentListV2-action",key:"collapsed"},ge.a.createElement("div",{className:"CommentListV2-expendCollapseButton"},ge.a.createElement("span",{onClick:o.handleOpenCollapsed},Object(xe.a)(n)," 条评论被折叠"),"（",ge.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):ge.a.createElement("div",{className:"CommentListV2-divider",key:"divider-collapsed"},ge.a.createElement("div",{className:"CommentListV2-dividerLine"}),ge.a.createElement("div",{className:"CommentListV2-dividerText"},Object(xe.a)(n)," 条评论被折叠（",ge.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},o.renderCollapsedInfiLoader=function(){var e=o.state.collapsed;if(e)return[];var t=o.props.collapsedInfo;t=void 0===t?{}:t;var n=t.isFetching,r=t.isPrevDrained,a=t.isDrained;return ge.a.createElement(Ie.b,{className:"CommentListV2",onRef:function(e){o.listEl=e},isLocal:!0,isLoading:n,isPrevDrained:r,isDrained:a,onLoad:function(t){return o.load(o.props,t,!e)},placeholder:ge.a.createElement(Ie.a,{className:"CommentItem",small:!0})},o.renderCollapsedComments())},o.renderPatternContent=function(e){var t=o.props,n=t.isFetching,r=t.parent.adminClosedComment,a=t.byComment,i=t.status,s=t.order,c=t.totals,l=t.handlePackupButton,u=t.apps,m=Math.ceil(c/20),p=o.state,d=p.current,f=p.packupButtonStatus,h=p.packupButtonLeft;return r?null:n?ge.a.createElement(yt.a,{onRef:function(e){o.commentsWithPaginationEl=e}}):ge.a.createElement("div",{ref:function(e){o.commentsWithPaginationEl=e}},ge.a.createElement("div",{className:"CommentListV2"},"normal"===s&&"open"===i?o.renderNormalComments(e):o.renderComments(e)),m>1&&ge.a.createElement(Te.a,{className:"CommentsV2-pagination",current:d,total:m,onSelect:o.handlePageSelect}),!a&&o.renderCollapsedDivider(),!a&&o.renderCollapsedInfiLoader(),ge.a.createElement(je.CSSTransitionGroup,{transitionName:"CommentsV2-Packup-Button",transitionEnterTimeout:300,transitionLeaveTimeout:300},f&&"column"!==u&&ge.a.createElement("button",{onClick:l,className:"CommentsV2-Packup-Button",style:{left:h}},"收起评论",ge.a.createElement(_e.j,{center:!0}))))},o.renderModalContent=function(e){var t=o.props,n=t.collapsedInfo,r=t.parent.adminClosedComment,a=t.status,i=t.order,s=t.byComment,c=o.state.collapsed,l=c?o.props:n,u=l.isFetching,m=l.isDrained,p=l.isPrevDrained;if(m&&e.length<=0||r)return ge.a.createElement("div",{className:"CommentsV2-empty"},ge.a.createElement(Be.a,{entityType:"comments"}));var d={getContainer:function(e){return e}};return ge.a.createElement(Ie.b,zt({className:"CommentListV2",onRef:function(e){o.listEl=e},isLocal:!0,isLoading:u,isPrevDrained:p,isDrained:m,onLoad:function(e){return o.load(o.props,e,!c)},placeholder:ge.a.createElement(Ie.a,{className:"CommentItemV2",small:!0})},d),"normal"===i&&"open"===a?o.renderNormalComments(e):o.renderComments(e),!s&&o.renderCollapsedDivider(),!s&&o.renderCollapsedComments())},o.renderCommentEdit=function(){var e=o.props,t=e.parent,n=t.canComment;n=void 0===n?{status:!0}:n;var r=n.status,a=n.reason,i=t.author;i=void 0===i?{isOrg:!1}:i;var s=i.isOrg,c=t.type,l=t.id,u=t.adminClosedComment,m=t.questionType,p=e.byComment,d=e.isAutoblur,f=e.commentNeedsReview,h=e.zaInfo,y=u?"当前内容暂时无法评论":a,b=d?!d:!p;return r&&!u?ge.a.createElement(ht,{className:"CommentsV2-footer",type:c,id:l,commentNeedsReview:f,onSubmit:o.addComment,autoFocus:b,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===m,zaInfo:h}):ge.a.createElement("div",{className:Oe()("CommentsV2-disabledText")},ge.a.createElement("div",{className:"CommentsV2-disabledReason"},y))},r=n,T(o,r)}return x(t,e),Vt(t,[{key:"loadCommentPermission",value:function(e,t){var n=this.props,o=n.loadAnswerCommentPermission,r=n.loadArticleCommentPermission;switch(e){case"answer":return o(t);case"article":return r(t);default:return null}}},{key:"componentDidMount",value:function(){this.subscription=Object(Se.subscribe)("scroll",this.handleScroll);var e=this.props,t=e.commentPattern,n=e.parent.adminClosedComment,o=e.stickers,r=e.loadStickers,a=e.getCommentWithPicPermission,i=e.commentWithPicPermission,s=e.currentUser,c=this.state.current;"bottom"!==t||n||(this.loadByPagination(c),this.commentsWithPaginationEl&&this.setState({packupButtonLeft:this.commentsWithPaginationEl.getBoundingClientRect().right-16})),!o.length&&r(),void 0===i.commentWithPic&&s&&a()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,r=t.targetComment,a=t.commentPattern;n===e.order&&o===e.status||("bottom"===a?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!r&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentWillUnmount",value:function(){Object(Qe.e)(Qe.b),this.subscription&&this.subscription.unsubscribe()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.isAuthor,r=t.comments,a=t.commentPattern,i=t.parent,s=i.author;s=void 0===s?{isOrg:!1}:s;var c=s.isOrg,l=i.commentPermission,u=i.reviewingCounts,m=i.commentCount,p=i.adminClosedComment,d=t.totals,f=t.status,h=t.order,y=t.onStatusChange,b=t.apps,v=t.onOrderChange,g=t.targetLink,C=t.shouldReverse,w="censor"===l&&o,E=w?{isCommentReviewer:w,onStatusChange:y,status:f,reviewingCounts:u}:{status:f};return ge.a.createElement("div",{className:Oe()("CommentsV2 CommentsV2--withEditor",{"CommentsV2-withPagination":"bottom"===a},n),ref:function(t){e.commentsElement=t}},ge.a.createElement(bt.a,zt({commentCount:void 0!==m?m:d,shouldReverse:C,commentClosed:p,targetLink:g,order:h,onOrderChange:v,commentPattern:a,isOrg:c},E)),"column"===b&&this.renderCommentEdit(),"bottom"===a?this.renderPatternContent(r):this.renderModalContent(r),"column"!==b&&this.renderCommentEdit())}}]),t}(ve.Component),pe.propTypes={type:we.a.string,parent:we.a.object.isRequired,targetLink:we.a.node,commentNeedsReview:we.a.bool,byComment:we.a.oneOfType([we.a.number,we.a.string]),commentPattern:we.a.string,handlePackupButton:we.a.func,onPaginationClick:we.a.func,isAutoblur:we.a.bool,shouldReverse:we.a.bool},pe.contextTypes={authRequired:we.a.func.isRequired},pe.defaultProps={isAutoblur:!1,shouldReverse:!0},me=de))||me,Wt=n(105),Ht=n.n(Wt),Gt=n(312),Kt=n.n(Gt),Qt=n(169),Zt=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Jt=(fe=Object(Ee.connect)(F,{loadConversation:Pe.g,addComment:Pe.a,loadMoreAnchorComments:Pe.h}))((be=ye=function(e){function t(){var e,n,o,r;L(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=M(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.load=function(){var e=o.props,t=e.isAnchorComments,n=e.conversationId;(0,e.loadConversation)({id:n,isAnchorComments:t})},o.addComment=function(e,t,n){var r=n.rootCommentId,a=n.isConversation,i=o.props,s=i.parent,c=s.type,l=s.id,u=i.conversationId,m=i.addComment,p=i.isAnchorComments;return m({parentType:c,parentId:l,content:e,replyTo:t,conversationId:u,rootCommentId:r,isConversation:a,replyType:_({id:r,replyTo:t,isConversation:a}).type,isAnchorComments:p})},o.loadMoreAnchorComments=function(){var e=o.props,t=e.conversationId,n=e.topCommentsPaging,r=void 0===n?{}:n;(0,e.loadMoreAnchorComments)({conversationId:t,nextUrl:r.next})},o.createOnRef=Ht()(function(e){return function(t){var n=o.props.byComment;parseInt(e)===Number(n)&&(o.targetCommentEl=t)}}),o.scrollToTarget=function(){var e=o,t=e.targetCommentEl,n=e.listEl;if(n&&t){var r=t.getBoundingClientRect(),a=r.top,i=r.height,s=n.getBoundingClientRect(),c=s.top,l=s.height;o.listEl.scrollTop+=a-c-(l-i)/2,t.classList.add("CommentItemV2--highlighted"),setTimeout(function(){return t.classList.remove("CommentItemV2--highlighted")},2e3),t.tabIndex=-1,t.focus()}},r=n,M(o,r)}return D(t,e),Zt(t,[{key:"componentDidMount",value:function(){this.props.byComment&&this.scrollToTarget()}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"render",value:function(){var e=this,t=this.props,n=t.onItemLike,o=t.onItemDelete,r=t.onItemFeature,a=t.onItemApprove,i=t.onItemCollapse,s=t.onItemDislike,c=t.onNavBack,l=t.canOperateItem,u=t.isFetching,m=t.comments,p=void 0===m?[]:m,d=t.commentNeedsReview,f=t.openComment.collapsed,h=t.parent,y=t.commentPattern,b=t.totals,v=t.isDrained,g=t.isPrevDrained,C=t.isConversationMoreFetching,w=t.isConversationMoreDrained,E=t.offsetIndex,k=null;return u&&!p.length?k=ge.a.createElement(ve.Fragment,null,ge.a.createElement(Ie.a,{className:"CommentItemV2",small:!0}),ge.a.createElement("div",{className:"CommentsV2-openComment-divider"}),ge.a.createElement("div",{className:"CommentsV2-replyNum"},b+" 条回复")):p.length&&(k=p.map(function(t,c){return c?w||c!==E||C?C&&c===E?ge.a.createElement(ve.Fragment,{key:t.id},ge.a.createElement(It,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment}),ge.a.createElement(Ie.a,{key:"NestCoomment-moreCommentButton-PlaceHolder",className:"NestCoomment-moreCommentButton ",small:!0})):ge.a.createElement(It,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment}):ge.a.createElement(ve.Fragment,{key:t.id},ge.a.createElement(It,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment}),ge.a.createElement("div",{key:"NestCoomment-moreCommentButton",preset:"plain",className:"NestCoomment-moreCommentButton",onClick:e.loadMoreAnchorComments},ge.a.createElement(_e.g,null),ge.a.createElement("p",null,"点击查看更多回复"))):ge.a.createElement(ve.Fragment,{key:t.id},ge.a.createElement("div",{className:"CommentsV2-openComment"},ge.a.createElement(It,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment})),ge.a.createElement("div",{className:"CommentsV2-openComment-divider"}),ge.a.createElement("div",{key:t.id+"-title"},ge.a.createElement("div",{className:"CommentsV2-replyNum"},b+" 条回复")))})),"bottom"===y?ge.a.createElement(Qt.b,{size:"fullPage",onClose:c},ge.a.createElement("div",{className:"CommentsV2"},ge.a.createElement(bt.a,{isConversation:!0,commentPattern:y}),ge.a.createElement(Ie.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isDrained:v,isPrevDrained:g,onLoad:this.load,placeholder:ge.a.createElement(Ie.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},k))):ge.a.createElement("div",{className:"CommentsV2"},ge.a.createElement(bt.a,{isConversation:!0,onNavBack:c}),ge.a.createElement(Ie.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isDrained:v,isPrevDrained:g,onLoad:this.load,placeholder:ge.a.createElement(Ie.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},k))}}]),t}(ve.Component),ye.propTypes={conversationId:we.a.number.isRequired,type:we.a.string,parent:we.a.object.isRequired,commentNeedsReview:we.a.bool},ye.contextTypes={currentUser:we.a.object,authRequired:we.a.func.isRequired},he=be))||he,Yt=n(263);n.d(t,"default",function(){return an});var $t,Xt,en,tn,nn,on=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},rn=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),an=($t=Object(Ee.connect)(null,{updateCommentLikeStatus:Pe.o,updateCommentFeatureStatus:Pe.n,deleteComment:Pe.d,updateCommentCollapsed:Pe.l,updateCommentDisliked:Pe.m,approveComment:Pe.b,rejectComment:Pe.k}),Xt=Object(Yt.a)(null),$t(en=Xt((nn=tn=function(e){function t(){var e,n,o,r;z(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=o=V(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={openedCommentId:null,isAnchorComments:!1,status:"open",order:"normal"},o.showConversation=function(e){var t=e.commentId,n=e.isAnchorComments;o.setState({openedCommentId:t,isAnchorComments:n})},o.showComments=function(){o.setState({openedCommentId:null,isAnchorComments:!1})},o.delete=function(e){var t=o.props,n=t.parent;return(0,t.deleteComment)(e,n.type,n.id)},o.feature=function(e){var t=o.props,n=t.parent,r=t.updateCommentFeatureStatus,a=t.notificationId;r({id:o.state.openedCommentId,commentId:e,parentId:n.id,parentType:n.type,notificationId:a})},o.like=function(e,t){var n=o.props,r=n.onItemLike,a=n.updateCommentLikeStatus;r&&r(e,t),a(e)},o.collapse=function(e){var t=o.props,n=t.parent;(0,t.updateCommentCollapsed)(e,n.type,n.id)},o.dislike=function(e){(0,o.props.updateCommentDisliked)(e)},o.approve=function(e){var t=o.props,n=t.parent,r=t.type;(0,t.approveComment)(e,n.type||r,n.id)},o.reject=function(e){var t=o.props,n=t.parent,r=t.type;(0,t.rejectComment)(e,n.type||r,n.id)},o.handleStatusChange=function(e){o.setState({status:e})},o.handleOrderChange=function(e,t){var n=o.props.onOrderChange;n&&n(e,t),o.setState({order:e})},r=n,V(o,r)}return U(t,e),rn(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.commentsContainerNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.parent,o=t.commentPattern,r=t.type,a=t.parent;a=void 0===a?{}:a;var i=a.commentPermission,s=a.relationship,c=void 0===s?{}:s,l=a.author,u=void 0===l?{}:l,m=t.needLoadCommentPermission,p=t.byComment,d=q(t,["parent","commentPattern","type","parent","needLoadCommentPermission","byComment"]),f=this.context.currentUser,h=void 0===c.isAuthor?f&&u.urlToken&&f.urlToken===u.urlToken:c.isAuthor,y="censor"===i&&!h,b="answer"===r||"article"===r,v=this.state,g=v.openedCommentId,C=v.status,w=v.order,E=v.isAnchorComments,k=E&&(g||p)||p;return ge.a.createElement("div",{className:"Comments-container",ref:function(t){return e.commentsContainerNode=t}},ge.a.createElement(Ut,on({className:Oe()({"CommentsV2--hidden":g&&"bottom"!==o})},d,{type:r,order:w,status:C,parent:n,commentPattern:o,commentNeedsReview:y,canOperateItem:b,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,byComment:k,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:m,isAuthor:h})),g&&ge.a.createElement(Jt,on({},d,{parent:n,type:r,canOperateItem:b,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,commentPattern:o,conversationId:g,onNavBack:this.showComments,byComment:k,isAnchorComments:E,commentNeedsReview:y,onShowConversation:this.showConversation})))}}]),t}(ve.Component),tn.propTypes={type:we.a.string.isRequired,parent:we.a.object.isRequired,onOrderChange:we.a.func,onItemLike:we.a.func,isAuthor:we.a.bool,onMount:we.a.func},tn.defaultProps={type:"answer"},tn.contextTypes={currentUser:we.a.object,authRequired:we.a.func.isRequired},en=nn))||en)||en)},2901:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){return Array.isArray(e)||(e=[e]),e.map(function(e,t){return c.a.createElement("span",{className:"PushNotifications-actor",key:t},e.link?c.a.createElement("a",{href:e.link},e.name):c.a.createElement("span",null,e.name))})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n.n(s),l=n(2),u=n.n(l),m=n(594),p=(n.n(m),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),d=function(e){function t(){var e,n,a,i;o(this,t);for(var s=arguments.length,l=Array(s),u=0;u<s;u++)l[u]=arguments[u];return n=a=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),a.renderTarget=function(){var e=a.props.item,t=e.content.target,n=t.text,o=t.link,r=e.id,i=e.target,s=e.target;s=void 0===s?{}:s;var l=s.id,u=s.target,m=void 0===u?{}:u,p=m.type;return i&&"comment"===i.type?a.renderCommentButton(n,{type:p,href:o,byComment:l,target:m,notificationId:r}):c.a.createElement("span",null,o?c.a.createElement("a",{href:o},n):c.a.createElement("span",null,n))},i=n,r(a,i)}return a(t,e),p(t,[{key:"renderCommentButton",value:function(e,t){var n=this,o=t.href,r=t.byComment,a=t.notificationId;return c.a.createElement("a",{href:o+(r?"#comment-"+r+"?notificationId="+a:""),onClick:function(e){e.preventDefault(),n.props.onCommentsModalOpen(t)}},e)}},{key:"render",value:function(){var e=this.props.item,t=e.content,n=t.verb,o=t.actors,r=e.isRead;return c.a.createElement("div",{className:u()("PushNotifications-item",{"PushNotifications-newItem":!r})},c.a.createElement("span",null,i(o))," ",n," ",this.renderTarget())}}]),t}(s.Component);t.default=d},2903:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){return e?t?!0===t?"":t:e:""}function s(e){for(var t,n=e.length,o=e.chars,r=e.maskChar,a=[],s=0;s<n;s+=1)t=o[s],a.push(C.a.createElement("span",{className:O()("TPassBox",{"TPassBox-mask":t&&Boolean(r)}),key:s},i(t,r)));return C.a.createElement("span",{className:"TPassBoxes"},a)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function f(){this.payments={},this.chosePaymentName=null,this.codeUrl="",this.qrLoaded=!1,this.need=null,this.passcode="",this.needSMS=!1,this.smsTimer=0,this.isInProgress=!1,this.error=null}function h(e,t){return G&&e&&e!==G&&t(new Error("A pay-sdk from different source has been load")),G=e,window.zhihu&&window.zhihu.pay?window.zhihu.pay.ready(t):(K||(K=Object(H.a)(e)),K.then(function(){return window.zhihu.pay.ready(t)},function(e){t(e),K=null}))}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var g=n(0),C=n.n(g),w=n(1),E=n.n(w),k=n(2),O=n.n(k),P=n(3),j=n(42),S=n(575),N=n(176),R=n(29),_=(n(2393),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),I={backspace:8,tab:9,enter:13,0:48,9:57},T=function(e){function t(e){o(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onInputFocus=n.onInputFocus.bind(n),n.onInputChange=n.onInputChange.bind(n),n.onKeyDown=n.onKeyDown.bind(n),n}return a(t,e),_(t,[{key:"onInputFocus",value:function(){this.props.onFocus()}},{key:"onInputChange",value:function(e){var t=String(e.target.value);if(t){t=t[t.length-1];var n=this.props.chars,o=this.props.length;n.length===o?n=n.replace(/.$/,t):n+=t,this.props.onChange(n),n.length===o&&this.props.onFinish(n)}}},{key:"onKeyDown",value:function(e){var t=e.keyCode;if(!e.metaKey&&!e.ctrlKey&&t!==I.tab&&t!==I.enter){var n=this.props.chars;t===I.backspace?(n=n.slice(0,-1),this.props.onChange(n)):(t<I[0]||t>I[9])&&(e.preventDefault(),this.props.onError(e))}}},{key:"focus",value:function(){this.input.focus()}},{key:"blur",value:function(){this.input.blur()}},{key:"render",value:function(){var e=this,t=this.props,n=t.length,o=t.chars,r=t.maskChar,a=t.autoFocus,i=t.className,c=t.children,l=o.length===n?n-1:o.length,u=o[l]||"";return C.a.createElement("label",{className:O()("TPass",i)},C.a.createElement("span",{className:"TPass-wrapper"},C.a.createElement(s,{length:n,chars:o,maskChar:r}),C.a.createElement("input",{className:"TPass-input",value:u,style:{left:60*l},onFocus:this.onInputFocus,onChange:this.onInputChange,onKeyDown:this.onKeyDown,onPaste:function(e){return e.preventDefault()},type:"number",min:"0",max:"9",pattern:"[0-9]*",autoFocus:a,ref:function(t){e.input=t}})),c)}}]),t}(C.a.Component);T.defaultProps={length:6,chars:"",maskChar:!1,autoFocus:!1,onFocus:function(){},onChange:function(){},onError:function(){},onFinish:function(){}},T.propTypes={length:E.a.number,chars:E.a.string,maskChar:E.a.oneOfType([E.a.bool,E.a.string]),autoFocus:E.a.bool,onFocus:E.a.func,onChange:E.a.func,onError:E.a.func,onFinish:E.a.func,className:E.a.string,children:E.a.node};var x,B,A=T,L=(n(2394),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),M=(B=x=function(e){function t(){return c(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),L(t,[{key:"render",value:function(){var e=this.props;return C.a.createElement("div",{className:O()("Spinner",e)},C.a.createElement("i",{className:"Spinner-loading"}))}}]),t}(g.Component),x.propTypes={className:E.a.string},B),D=n(177),F=(n(2395),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),V=11,U=function(e){function t(e){m(this,t);var n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onPasscodeFocus=function(){n.state.error&&(n.setState({error:null}),6===n.state.passcode.length&&n.setState({passcode:""}))},n.onPasscodeInput=function(e){"object"===(void 0===e?"undefined":q(e))&&(e=e.target.value),n.setState({passcode:e})},n.onPasscodeFinish=function(e){n.tpass.blur(),n.payWithBalance(e)},n.onSendSMSCode=function(){n.props.trade.resendSMSCode(function(){n.startSMSTimer(),n.smsInput.focus()},function(e){n.setState({error:e})})},n.onQrLoad=function(){n.setState({qrLoaded:!0})},n.onBalanceFormSubmit=function(e){e.preventDefault(),n.payWithBalance(n.state.passcode)},n.setPayments=function(e){n.setState({payments:e})},n.confirmPayment=function(){var e=n.state,t=e.choseName,o=e.payments,r=n.props.onConfirmPayment,a=t;if(t||(a=o.balance&&o.balance.enable?"balance":"wechat"),r(!a),n.setState({chosePaymentName:a}),"wechat"===a&&n.isInWechat){var i=n.props.tradeNumber,s=location.protocol+"//"+location.host+location.pathname,c="https://www.zhihu.com/pay/weixin/pay?service_id="+V+"&trade_number="+i+"&redirect_uri="+encodeURIComponent(s);return void window.location.replace(c)}n.props.trade["wechat"===a?"initWechatPay":"initBalancePay"]()},n.pid=0,n.smsTimer=null,n.state=new f,n.isInWechat=e.ua.Wechat,n}return d(t,e),z(t,[{key:"componentWillMount",value:function(){var e=this.props.trade;this.getPaymentsList(e),this.initListeners(e)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.trade!==this.props.trade&&(this.setState(new f),setTimeout(function(){t.getPaymentsList(e.trade)},300),this.initListeners(e.trade))}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.smsTimer),this.props.trade.dispose()}},{key:"getPaymentsList",value:function(e){var t=this;if(e){var n=this.pid+=1;e.getPaymentsList(function(e){t.pid===n&&t.setPayments(e)})}}},{key:"initListeners",value:function(e){var t=this;e&&e.on("payInited",function(e,n){t.setState(F({},n))}).on("paySuccess",function(){t.setState({isInProgress:!1,error:null}),t.props.onSuccess()}).on("payCancel",function(){t.setState({isInProgress:!1,chosePaymentName:null})}).on("payFail",function(e){var n=e;"object"!==(void 0===e?"undefined":q(e))||e instanceof Error||(n=e.message),t.setState({isInProgress:!1,error:n}),t.props.onFail(e)}).on("needSMS",function(e){t.setState({isInProgress:!1,error:null,needSMS:e.message,passcode:""})}).on("needWechatCode",function(){t.props.onError("needWechatCode")}).on("error",function(e,n){t.props.onError(e,n)})}},{key:"startSMSTimer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60;window.clearInterval(this.smsTimer),this.setState({smsTimer:t}),this.smsTimer=window.setInterval(function(){t-=1,t<=0?(window.clearInterval(e.smsTimer),e.smsTimer=null,e.setState({smsTimer:0})):e.setState({smsTimer:t})},1e3)}},{key:"payWithBalance",value:function(e){return 6!==e.length?(this.setState({error:"请输入 6 位支付密码"}),!1):(this.setState({isInProgress:!0,error:null}),this.props.trade.payWithBalance(e))}},{key:"renderPaymentsList",value:function(){var e=this,t=this.state,n=t.payments,o=t.chosePaymentName,r=t.choseName,a=this.props.trade;if(o)return null;var i=n.balance&&n.balance.amount,s=a.info.total,c=n.wechat&&n.wechat.enable,l=n.balance&&n.balance.enable,u=n.balance&&!n.balance.enable,m=i>=s?"使用余额（剩余 "+(i/100).toFixed(2)+"）":"微信支付",p=i>=s?"wallet":"wechatPayment",d="PaymentItem-"+(i>=s?"wallet":"wechatPayment");r&&(m="wechat"===r?"微信支付":"使用余额（剩余 "+(i/100).toFixed(2)+"）",p="wechat"===r?"wechatPayment":"wallet",d="PaymentItem-"+("wechat"===r?"wechatPayment":"wallet"));var f=C.a.createElement("div",null,C.a.createElement(R.a,{name:p,className:d}),C.a.createElement(P.c,{className:"Payment-Popover"},m),C.a.createElement(R.a,{className:"Select-arrow",name:"select"}));return C.a.createElement("div",{className:"PaymentsList"},C.a.createElement("span",{className:"Payment-Topline"}),C.a.createElement("span",{className:"PaymentWay"},"支付方式"),C.a.createElement(D.a,{placeholder:f},C.a.createElement(N.b,{plain:!0,className:"Payment-select",listClassName:"Payment-select-list",targetClassName:"Popover-targetContainer-verification",text:i>=s?"使用余额（剩余 "+(i/100).toFixed(2)+"）":"微信支付",menuToggler:f,onChange:function(t){"disabled"!==t&&e.setState({choseName:t})}},l&&C.a.createElement(N.a,{value:"balance",className:"PaymentItem"},C.a.createElement(R.a,{name:"wallet",className:"PaymentItem-wallet"}),"使用余额（剩余 "+(i/100).toFixed(2)+"）"),u&&C.a.createElement(N.a,{value:"disabled",className:"PaymentItem PaymentItem--disabled"},C.a.createElement(R.a,{name:"wallet",className:"PaymentItem-wallet"}),"使用余额（剩余 "+(i/100).toFixed(2)+"）"),c&&C.a.createElement(N.a,{value:"wechat",className:"PaymentItem"},C.a.createElement(R.a,{name:"wechatPayment",className:"PaymentItem-wechatPayment"}),"微信支付"))),C.a.createElement("span",{className:"Payment-Bottomline"}),C.a.createElement(P.c,{className:"Payment-CheckedButton",onClick:this.confirmPayment},"确认支付"))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.trade,r=this.state,a=r.payments,i=r.chosePaymentName,s=r.codeUrl,c=r.needSMS,l=r.isInProgress;return o?C.a.createElement("div",{className:O()("Payment",n)},Object.keys(a).length?this.renderPaymentsList():C.a.createElement("div",{className:"Payment-placeholder"},C.a.createElement(M,null)),"wechat"===i&&C.a.createElement("div",{className:"Payment-wechatPay"},C.a.createElement("div",{className:"Payment-wechatPayTitle"},C.a.createElement("i",{className:"icon icon-ic_wechatpay PaymentIconWechat"}),"微信支付"),!this.isInWechat&&C.a.createElement("div",null,"使用微信扫描二维码完成支付"),this.state.qrLoaded?C.a.createElement("span",{className:"Payment-qrWrapper"},C.a.createElement("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url="+s,width:"150",height:"150"})):C.a.createElement("div",{className:"Payment-qrPlaceholder"},C.a.createElement(M,null),!this.isInWechat&&C.a.createElement("div",null,"正在生成二维码"),s&&C.a.createElement("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url="+s,width:"1",height:"1",onLoad:this.onQrLoad}))),"balance"===i&&C.a.createElement("form",{onSubmit:this.onBalanceFormSubmit,className:"Payment-balancePay"},C.a.createElement("div",{className:"Payment-balancePayTitle"},C.a.createElement("i",{className:"icon icon-wallet PaymentIconWallet"}),"余额支付"),!c&&C.a.createElement("div",null,C.a.createElement("div",{className:"Payment-description"},"请输入 6 位数知乎支付密码，用于支付验证。"),C.a.createElement(A,{chars:this.state.passcode,onFocus:this.onPasscodeFocus,onChange:this.onPasscodeInput,maskChar:!0,onFinish:this.onPasscodeFinish,className:O()("Payment-tpass",{"Payment-errorInput":this.state.error,"Payment-progressing":l}),autoFocus:!0,ref:function(t){e.tpass=t}},l&&C.a.createElement(M,{className:"Payment-balancePaySpinner"}))),Boolean(c)&&C.a.createElement("div",{className:"Payment-balancePaySms"},C.a.createElement("div",{className:"Payment-balancePaySmsText"},String(c)),C.a.createElement("input",{onChange:this.onPasscodeInput,value:this.state.passcode,className:O()("Payment-sms","SimpleInput",{"Payment-errorInput":this.state.error}),type:"text",pattern:"\\d{6}",minLength:"6",maxLength:"6",title:"验证码应为 6 位数字",placeholder:"输入 6 位数验证码",required:!0,autoFocus:!0,ref:function(t){e.smsInput=t}}),this.state.smsTimer?C.a.createElement("button",{className:"Payment-sendSms",type:"button",disabled:!0},this.state.smsTimer," 秒后可重发"):C.a.createElement("button",{onClick:this.onSendSMSCode,className:"Payment-sendSms",type:"button"},"发送验证码")),C.a.createElement("div",{className:"Payment-balancePayFooter"},C.a.createElement("p",{className:"Payment-errorTip",style:{visibility:this.state.error?"visible":"hidden"}},this.state.error),Boolean(c)&&C.a.createElement(P.c,{color:"blue",disabled:l,className:"Payment-balancePayConfirmBtn",type:"submit"},"确认")),!c&&C.a.createElement("div",{className:"Payment-balancePayForget"},"如果忘记密码请邮件联系"," ",C.a.createElement("email",{className:"Payment-email"},"i@zhihu.com")))):C.a.createElement("div",{className:O()("Payment",n)},C.a.createElement("div",{className:"Payment-placeholder Payment-placehoder--empty"},C.a.createElement(M,null)))}}]),t}(C.a.Component);U.propTypes={trade:E.a.object,autoChooseSinglePayment:E.a.bool,onSuccess:E.a.func.isRequired,onFail:E.a.func,onError:E.a.func,onConfirmPayment:E.a.func},U.defaultProps={trade:null,onSuccess:function(){},onFail:function(){},onError:function(){},autoChooseSinglePayment:!0,className:""};var W=U,H=n(561),G="",K=null,Q=n(10);n(2396);n.d(t,"TipjarDialog",function(){return ee});var Z,J,Y=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),$=[200,500,1e3,5e3,1e4,2e4],X=100,ee=(J=Z=function(e){function t(e){y(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.lockScroll=function(){document.body.classList.add("scroll-locked"),n.scrollTop=window.scrollY,document.body.style.width="100%",document.body.style.position="fixed",document.body.style.top=-n.scrollTop+"px"},n.unlockScroll=function(){document.body.classList.remove("scroll-locked"),document.body.style.width=null,document.body.style.position=null,void 0!==n.scrollTop&&(window.scrollTo(0,n.scrollTop),n.scrollTop=void 0),document.body.style.top=null},n.onConfirmPayment=function(e){n.setState({chosePaymentName:e})},n.onPaySuccess=function(){n.props.onPaySuccess(),n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:"",customButton:!1})},n.handleCustomAmount=function(){n.state.trade&&n.state.trade.dispose(),n.setState({showCustom:!0})},n.handleCustomChange=function(e){var t=e.target.value;isNaN(t)?n.setState({customAmount:""}):n.setState({customAmount:parseInt(t)||""})},n.handleCustomKeyUp=function(e){13===e.keyCode&&n.handleSubmitCustom()},n.handleSubmitCustom=function(){var e=n.state.customAmount*X;e>0&&e<=5e4&&(n.setState({customButton:!0,showCustom:!1,colseTijarDialogStatus:!1}),n.createTrade(e))},n.closeModal=function(){n.state.trade&&n.state.trade.dispose(),n.setState(n.getDefaultState())},n.handleAmountButton=function(e){n.createTrade(e.currentTarget.dataset.amount),n.setState({colseTijarDialogStatus:!1,customButton:!1,showCustom:!1})},n.createTrade=function(e){n.setState({tradeLoading:!0,currentAmount:e});var t=n.props.ua;n.props.addReward(e,t.Wechat?"wechat":"normal"),n.setState({tradeLoading:!1})},n.colseTijarDialog=function(){n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:""}),n.props.colseTijarDialog()},n.state=n.getDefaultState(),n}return v(t,e),Y(t,[{key:"componentDidMount",value:function(){this.showTip()}},{key:"componentDidUpdate",value:function(e){var t=e.TipjarRender,n=this.props,o=n.tradeNumber,r=n.type,a=n.isMobile,i=n.TipjarRender,s=this.state,c=s.trade,l=s.colseTijarDialogStatus,u="article"===r?11:17;if(o&&(!c||o!==c.tradeNo)&&!l){var m=new window.zhihu.pay.Trade(o,u);this.setState({trade:m})}a&&(!t&&i?this.lockScroll():t&&!i&&this.unlockScroll())}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.TipjarRender,n=e.isMobile;t&&this.props.removeTradeNumber(),t&&n&&this.unlockScroll()}},{key:"getDefaultState",value:function(){return{showCustom:!1,customAmount:"",currentAmount:"",showTipModal:!1,customButton:!1,chosePaymentName:!0,colseTijarDialogStatus:!1}}},{key:"showTip",value:function(){var e=this;h("https://pay.zhihu.com/api/js",function(){e.setState({showTipModal:!0})})}},{key:"renderAmountCustom",value:function(){var e=this.state,t=e.showCustom,n=e.customAmount,o=e.currentAmount,r=e.customButton;return C.a.createElement("div",{className:"Reward-TipjarDialog-amountCustom"},t?C.a.createElement("div",{className:"Reward-TipjarDialog-amountInput"},C.a.createElement("input",{name:"",type:"text",className:"SimpleInput",placeholder:"你想赞赏的金额（不超过 500）",value:n,onChange:this.handleCustomChange,onKeyUp:this.handleCustomKeyUp,ref:function(e){e&&e.focus()}}),C.a.createElement(P.c,{disabled:n<=0||n>500,color:"blue",preset:"primary",onClick:this.handleSubmitCustom},"确定"),C.a.createElement("div",{className:"Reward-TipjarDialog-error",style:{display:n>500?"block":"none"}},"不能超过 500 元")):C.a.createElement(P.c,{preset:"plain",className:r?"TipjarDialog-customButton-cheked":"TipjarDialog-customButton",onClick:this.handleCustomAmount},r?"自定义金额： ￥ "+o/X:"自定义金额"))}},{key:"renderTipjarDialog",value:function(){var e=this,t=this.props,n=t.author,o=n.name,r=n.avatarUrl,a=n.isOrg,i=n.urlToken,s=n.id,c=t.tagline,l=this.state.currentAmount;return C.a.createElement("div",{className:"Reward-TipjarDialog"},C.a.createElement("div",{className:"Reward-TipjarDialog-user"},C.a.createElement("a",{href:"/"+(a?"org":"people")+"/"+(i||s),className:"Reward-UserAvatar"},C.a.createElement("img",{src:r.replace("_is","_l"),className:"Reward-Avatar",alt:"当前用户"})),o),C.a.createElement("div",{className:"Reward-TipjarDialog-tagLine"},c),C.a.createElement("div",{className:"Reward-TipjarDialog-selectAmount"},C.a.createElement("div",{className:"Reward-TipjarDialog-amountList"},$.map(function(t){return C.a.createElement(P.c,{key:t,"data-amount":t,onClick:e.handleAmountButton,color:"red",className:O()({"Reward-Button-checked":Number(l)===t})},C.a.createElement("b",null,Number(l)===t?t/X+" 元":"￥ "+t/X))})),this.renderAmountCustom()))}},{key:"render",value:function(){var e=this.props,t=e.ua,n=e.TipjarRender,o=e.isMobile,r=e.tradeNumber,a=this.state,i=a.showCustom,s=a.tradeLoading,c=a.showTipModal,l=a.trade,u=a.chosePaymentName,m=o?S.a:j.b,p=o?"small":"default";return C.a.createElement(m,{overlay:!0,size:p,onClose:this.colseTijarDialog,className:"Reward-TipjarDialogModal"},n&&C.a.createElement("div",null,c&&u&&this.renderTipjarDialog(),(l||s)&&!i&&C.a.createElement(W,{trade:l,tradeNumber:r,ua:t,onSuccess:this.onPaySuccess,onConfirmPayment:this.onConfirmPayment})))}}]),t}(g.Component),Z.propTypes={author:E.a.object,tagline:E.a.string,colseTijarDialog:E.a.func,addReward:E.a.func,tradeNumber:E.a.number,removeTradeNumber:E.a.func,onPaySuccess:E.a.func,isMobile:E.a.bool,type:E.a.string},Z.defaultProps={tagline:Q.i},J)}});
//# sourceMappingURL=main.modals.f38962d88bbdc063a769.js.map