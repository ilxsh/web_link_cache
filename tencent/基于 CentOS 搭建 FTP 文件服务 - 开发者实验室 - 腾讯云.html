<!DOCTYPE html>
<html lang="zh">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="utf-8">
<link rel="dns-prefetch" href="//imgcache.qq.com">
<link rel="dns-prefetch" href="//qzs.qq.com">
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<title>基于 CentOS 搭建 FTP 文件服务 - 开发者实验室 - 腾讯云</title>
<meta name="keywords" content="基于 CentOS 搭建 FTP 文件服务,开发者实验室,腾讯云实验室">
<meta name="description" content="FTP 是一个很实用的文件传输协议，方便在客户端和服务器之间进行文件的传输。本实验带您使用 vsftpd 来搭建一个 FTP  服务，并且创建专有的 FTP 登录账户，保障服务器安全。">
<meta name="format-detection" content="telephone=no" />
<script>document.domain = 'cloud.tencent.com';</script>
<link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/portal/css/global-20199171625.css?max-age=31536000">
<link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/college/labs/css/lab-201907241519.css?max-age=31536000">
</head>
<body class="lab-pdetail-pg">
<div class="qcloud-train">
	
<!--[if lt IE 9]>
<script src="//imgcache.qq.com/qcloud/main/scripts/release/common/libs/updateTips.js?max_age=31536000&v=20161118"></script>
<![endif]-->



<script>
	window.ISABSOLUTEHEADER = false;
	window.ISMOBILE = false;
</script>

<!-- Header导航背景类型：空气导航、黑色导航（默认）和白色导航，通过参数`navMode`传入, 参数值分别为`airMode`,`dark`,`white` -->


<div 
	id="navigationBar" 
	data-type="cn_zh" 
	class="c-nav-wrap c-nav c-nav-wrap-dark"
>
	<div class="c-nav-mod c-nav-mod-pc c-nav-dark">
		<div class="c-nav-top" id="qcTopNavFstLevel" data-nosearch="1" data-nolang="1">
			<a id="qcLeftNavSwitcher" href="javascript:;" class="c-nav-all-trigger" hotrep="hp.header.trigger" role="button">
				<i class="c-nav-all-trigger-icon"></i>
			</a>
			<i class="c-nav-top-divider"></i>
			<a class="c-nav-bg-logo" href="/" hotrep="hp.header.hp">
				<i>腾讯云</i>
			</a>
			<div class="c-nav-top-operation">
				<div class="c-nav-top-ctrl">
					<div class="c-nav-top-links">
						<a href="https://cloud.tencent.com/product/ba" hotrep="hp.header.ba" class="link-item">备案</a>
						<a href="https://console.cloud.tencent.com" hotrep="hp.header.console" class="link-item" role="button">控制台</a>
					</div>
				</div>
			</div>
		</div>

		<div class="c-nav-bottom responsive">
			<a href="/edu" class="c-nav-project-logo" hotrep="hp.header.logo.edu">
				<i class="c-nav-project-bg-logo">腾讯云大学</i>
			</a>
			<div class="c-nav-bm-categories">
				<ul class="c-nav-list J-qcTopNavList J-nav-list" style="visibility: visible;">

					<li class="presentation J-qcTopNavItem J-header-nav-learning">
						<a href="https://cloud.tencent.com/edu/learning" hotrep="qcloud.header.nav.learning">在线学习中心</a>
					</li>
					<li class="presentation J-qcTopNavItem J-header-nav-training">
						<a href="https://cloud.tencent.com/edu/training" hotrep="qcloud.header.nav.training">培训认证中心</a>
					</li>
					<li class="presentation J-qcTopNavItem J-header-nav-university">
						<a href="https://cloud.tencent.com/edu/university" hotrep="qcloud.header.nav.university">校企合作中心</a>
					</li>
					<li class="presentation J-qcTopNavItem J-header-nav-talents">
						<a href="https://cloud.tencent.com/edu/talents" hotrep="qcloud.header.nav.talents">人才培养计划</a>
					</li>
					<li class="presentation J-qcTopNavItem J-header-nav-paths">
						<a href="https://cloud.tencent.com/edu/paths" hotrep="qcloud.header.nav.paths">学习路径</a>
					</li>
					<li class="presentation J-qcTopNavItem J-header-nav-labs actived">
						<a href="/developer/labs" hotrep="qcloud.header.nav.labs">开发者实验室</a>
					</li>
				</ul>
			</div>
			<div class="c-nav-bm-right J-user-operation" style="display: none">
				<!-- search -->
				<a class="c-nav-bm-search-btn J-search-open" href="javascript:;" role="button" hotrep="hp.header.opensearch">
					<i class="nav-search-icon"></i> 搜索
				</a>
				<div class="c-nav-bm-search J-search-open" href="javascript:;" role="button" hotrep="hp.header.opensearch">
					<input placeholder="输入感兴趣的实验主题">
					<i class="nav-search-icon"></i>
				</div>

				<!-- tip -->
				<!-- <a class="nav-bm-link J-tips-show" hotrep="hp.header.tips">
					<i></i>
				</a> -->

				<!-- login -->
				<div class="c-nav-bm-text-btns J-login-group" style="display: none">
					<a href="javascript:;" class="c-nav-bm-text-btn J-login-btn">登录</a>
					<i class="c-nav-divider-dot"></i>
					<a href="javascript:;" class="c-nav-bm-text-btn J-login-register">注册</a>
				</div>

				<!--个人资料操作 start-->
				<div class="c-nav-dropdown-btn c-nav-user-mod J-userinfo" style="display: none">
					<!-- 该处与语言选择下拉列表一样 -->
					<a href="/developer/labs/workbench" class="c-nav-dropdown-btn-inner J-profile-trigger" hotrep="hp.header.user"
					 aria-expanded="false" aria-haspopup="true" aria-owns="login_select" aria-controls="login_select">
						<span class="nav-dropdown-btn-txt">
							<i class="c-nav-img-user J-user-avatar"></i>
							<!--如果有未读消息，加 has-msg-->
							<!--<i class="c-nav-icon-user has-msg"></i>-->
						</span>
						<i class="nav-status-dot" tabindex="-1"></i>
					</a>
					<div class="c-bubble c-bubble-top nav-user-bubble J-profile-dropdown" style="display: none;">
						<div class="c-bubble-inner">
							<div class="nav-dropdown-mini">
								<div class="dropdown-mini-inner dropdown-mini-data">
									<div class="dropdown-mini-list">
										<ul>
											<li class="dropdown-mini-item">
												<a class="mini-item-nickname" tabindex="-1">
													昵称：
													<span class="mini-item-num J-user-name"></span>
												</a>
											</li>
											<li class="dropdown-mini-item">
												<a href="/developer/labs/collection" hotrep="hp.header.profile.collection">教程征集</a>
											</li>
											<li class="dropdown-mini-item">
												<a href="/developer/labs/workbench" hotrep="hp.header.profile.workbench">个人工作台</a>
											</li>
											<li class="dropdown-mini-item J-qcTopNavBtnLogoutWrapper J-logout-btn">
												<a href="javascript:;" class="J-qcTopNavBtnLogout" hotrep="hp.header.profile.logout">退出</a>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--个人资料操作 end-->
			</div>

			<!--search start-->
			<div id="qcTopNavSearch" class="c-top-searchbar J-search-bar">
				<div class="c-top-searchbar-inner">
					<div class="c-top-searchbar-box" role="combobox">
						<div class="c-searchbar-ctrl">
							<a href="javascript:;" class="search-btn J-qcBtnDoSearch" hotrep="hp.header.dosearch">
								<i class="nav-search-icon"></i>
							</a>
							<input type="search" class="search-ipt J-search-input" placeholder="输入感兴趣的实验主题" aria-autocomplete="list"
							 autocomplete="on" aria-owns="search-list">
							<a href="javascript:;" class="search-btn-close J-search-close" hotrep="hp.header.closesearch">
								<i class="nav-search-close-icon">取消</i>
							</a>
						</div>
						<!--联想 start-->
						<div class="nav-dropdown-mini J-search-dropdown" tabindex="-1" style="box-shadow: 0 10px 20px rgba(3,27,78,.1); border: 1px solid #E7E8F1;">
							<div class="dropdown-mini-inner dropdown-mini-lang">
							</div>
						</div>
						<!--联想 end-->
					</div>
				</div>
			</div>
			<!--search end-->

		</div>
	</div>
</div>

<!-- 移动端导航 start -->
<div class="J-lab-header c-nav-wrap-m c-nav">
	<div class="c-nav-mod c-nav-mod-m">
		<div class="c-nav-inner">
			<div class="J-mobile-navigation-btn coll-nav-logo-mb">
				<span class="c-nav-r-btn">
					<span></span>
					<span></span>
					<span></span>
				</span>
				<span class="coll-nav-logo-mb-text" hotrep="qcloud.edu.header.labs">开发者实验室</span>
			</div>
			<div class="c-nav-right">
				<a class="J-header-search-toggle c-nav-m-btn" href="javascript:" style="display: inline-block;">
					<i class="c-nav-icon-search-m"></i>
				</a>
				<!-- 未登录状态显示登录按钮 -->
				<a href="javascript:;" class="J-mobile-header-login c-nav-m-btn" style="display:none;">登录</a>
				<!-- 已登录状态显示头像 -->
				<a class="J-mobile-header-userinfo-btn c-nav-m-btn" href="javascript:" style="display:none;">
					<i class="c-nav-icon-user-m"></i>
				</a>
				<span class="J-mobile-header-menus-btn c-nav-r-btn J-qcTopNavMenu" style="display: none;">
					<span></span>
					<span></span>
					<span></span>
				</span>
			</div>
		</div>

		<!-- 个人信息展开项 start -->
		<div id="qcTopNavUserProfile" class="J-mobile-userinfo-panel c-nav-m-user" style="display: none;">
			<ul>
				<li class="dropdown-mini-item">
					<a class="J-mobile-nickname" href="javascript:;">昵称:</a>
				</li>
				<li class="dropdown-mini-item"><a href="/developer/labs/collection">教程征集</a></li>
				<li class="dropdown-mini-item"><a href="/developer/labs/bench">个人工作台</a></li>
				<li class="J-mobile-logout dropdown-mini-item"><a href="javascript:;">退出登录</a></li>
			</ul>
		</div>
		<!-- 个人信息展开项 end -->

		<!-- 搜索展开项 strat -->
		<div class="J-mobile-search-panel lab-header m-search top" style="display: none;">
			<div class="lab-search J-mobile-search">
				<div class="lab-search-inner">
					<div class="search-box">
						<div class="search-box-inner">
							<form onsubmit="return false;" method="GET" action="/">
								<input type="search" class="com-search-input" placeholder="输入感兴趣的实验主题" value="" autocomplete="off">
							</form>
							<div class="clean" style="display: none;"><i class="lab-i-clean"></i></div>
						</div>
					</div>
					<section class="J-search-dropdown"></section>
				</div>
			</div>
		</div>
		<!-- 搜索展开项 end -->
	</div>
</div>

<!-- 移动端侧边导航菜单 start -->
<div class="coll-nav-side-m">
    <div class="J-mobile-side-navigation-mask com-m-side-mask hidden"></div>
    <section class="J-mobile-side-navigation-panel com-m-side com-2-m-side hidden">
        <header class="com-m-side-hd">
            <div class="header-logo-wrap">
				<a href="/edu" class="header-logo" hotrep="qcloud.edu.header.home">
					<i class="logo-icon logo-college"></i>
					<h1 class="header-title">腾讯云大学</h1>
				</a>
			</div>
            <div class="J-mobile-navigation-close-btn com-m-side-hd-extra">
				<a href="javascript:;" class="com-m-side-link only-icon">
					<i class="icon-back"></i>
				</a>
			</div>
        </header>
        <div class="com-m-side-bd">
            <ul class="com-m-side-nav">
                <li class="com-m-side-nav-item">
					<a href="javascript:;" class="J-mobile-navigation-item com-m-side-nav-link" data-link="/edu" hotrep="qcloud.edu.header.menu.home">
						<i class="icon-home"></i>首页
					</a>
				</li>
                <li class="com-m-side-nav-item">
					<a href="javascript:;" class="J-mobile-navigation-item com-m-side-nav-link" data-link="/edu/learning" hotrep="qcloud.edu.header.menu.learning">
						<i class="icon-education"></i>在线学习中心
					</a>
				</li>
                <li class="com-m-side-nav-item">
					<a href="javascript:;" class="J-mobile-navigation-item com-m-side-nav-link" data-link="/edu/training" hotrep="qcloud.edu.header.menu.training">
						<i class="icon-training"></i>培训认证中心
					</a>
				</li>
                <li class="com-m-side-nav-item">
					<a href="javascript:;" class="J-mobile-navigation-item com-m-side-nav-link" data-link="/edu/university" hotrep="qcloud.edu.header.menu.university">
						<i class="icon-cooperation"></i>校企合作中心
					</a>
				</li>
                <li class="com-m-side-nav-item">
					<a href="javascript:;" class="J-mobile-navigation-item com-m-side-nav-link" data-link="/edu/talents" hotrep="qcloud.edu.header.menu.talents">
						<i class="icon-talents"></i>人才培养计划
					</a>
				</li>
                <li class="com-m-side-nav-item">
					<a href="javascript:;" class="J-mobile-navigation-item com-m-side-nav-link" data-link="/edu/paths" hotrep="qcloud.edu.header.menu.paths">
						<i class="icon-path"></i>学习路径
					</a>
				</li>
                <li class="com-m-side-nav-item actived">
					<a href="javascript:;" class="J-mobile-navigation-item com-m-side-nav-link" data-link="/developer/labs" hotrep="qcloud.edu.header.menu.labs">
						<i class="icon-lab"></i>开发者实验室
					</a>
				</li>
            </ul>
            <div class="com-m-side-idx-link-wrap">
				<a href="/" class="com-m-side-idx-link" hotrep="qcloud.edu.header.index">
					返回腾讯云官网
				</a>
			</div>
        </div>
    </section>
</div>
<!-- 移动端侧边导航菜单 end -->

<!--导航菜单点击之后，遮罩显示-->
<div class="J-mobile-mask c-nav-mask" id="qcGlobalMask" style="position: fixed; z-index: 999;display: none;"></div>
<!-- 移动端导航 end -->

	<div class="J-lab-body">
		<div class="lab-placard">
			<div class="lab-placard-inner">
				<h2 class="title">基于 CentOS 搭建 FTP 文件服务</h2>
				<div class="desc">
					<div class="item">
						<i class="lab-pdetail-i-author"></i>
						
							腾讯云
						
					</div>
					<div class="item"><i class="lab-pdetail-i-level"></i>入门</div>
					<div class="item"><i class="lab-pdetail-i-task"></i><span class="J-stage-num">0</span> 个任务</div>
					<div class="item"><i class="lab-pdetail-i-rest"></i>剩余 4 个名额</div>
				</div>
				<div class="lab-btns ">

	
	<div class="J-status-section" data-show-status="countdown" style="display:none;">
		<!--
		<div class="tip">已抢光，距离下个空闲名额还有
			<span class="J-countdown" data-finish-time="0">
				<span class="J-countdown-day">00</span><span class="unit">天</span>
				<span class="J-countdown-hour">00</span><span class="unit">时</span>
				<span class="J-countdown-minute">00</span><span class="unit">分</span>
				<span class="J-countdown-second">00</span><span class="unit">秒</span>
			</span>
		</div>
		-->
		<!--
		<div class="tip">资源紧张中</div>
		-->
		
		<div class="tip">实验资源紧张，距离下个空闲名额预计还有 4 分钟</div>
		<p class="lab-text-info">你也可以 <a href="javascript:;" class="J-buy-cvm-btn">创建</a> 或者 <a href="javascript:;" class="J-use-mine-btn">使用已有</a> 云主机不限时上机</p>
		<!--
		<p class="lab-text-info">一旦有用户下机，即可抢占空闲的服务器进行实验<a href="javascript:;" class="J-more-machine">查看云主机队列</a>
		-->
	</div>

	
	<div class="J-status-section" data-show-status="ready" >
		<button class="lab-btn large J-start-btn">开始上机</button>
<p class="lab-text-info">你还可以 <a href="javascript:;" class="J-buy-cvm-btn">创建</a> 或者 <a href="javascript:;" class="J-use-mine-btn">使用已有</a> 云主机不限时上机</p>
	</div>

	
	<div class="J-status-section" data-show-status="initialing" style="display:none;">
		<div class="tip">有 <span class="J-initializing-num">0</span> 台正在初始化，请稍等</div>
		<p class="lab-text-info">你也可以 <a href="javascript:;" class="J-buy-cvm-btn">创建</a> 或者 <a href="javascript:;" class="J-use-mine-btn">使用已有</a> 云主机不限时上机</p>
	</div>

	
	<div class="J-status-section" data-show-status="done" style="display:none;">
		<button class="lab-btn large J-use-mine-btn">用已有云主机上机</button>
<p class="lab-text-info">或者 <a href="javascript:;" class="J-buy-cvm-btn">购买云主机</a> 上机</p>
	</div>
</div>
			</div>
		</div>

		<!-- layout start -->
		<div class="lab-pdetail-layout">

			<!-- Main -->
			<div class="lab-main">
				<div class="J-tab tab first">
					<a class="item first">实验概述</a><a class="item second">实验手册</a><a class="item third" style="display: none;">评论 (<span class="J-comment-total">0</span>)</a>
					<div class="active-line"></div>
				</div>

				<div class="J-cont cont first">
					<!-- Info -->
					<div class="lab-info item first">
						<div class="section">
							<h3 class="title">实验内容</h3>
							<pre class="content" style="word-break: break-word; white-space: pre-line; font-family: 'pingfang SC','helvetica neue',arial,'hiragino sans gb','microsoft yahei ui','microsoft yahei',simsun,sans-serif;">FTP 是一个很实用的文件传输协议，方便在客户端和服务器之间进行文件的传输。本实验带您使用 vsftpd 来搭建一个 FTP  服务，并且创建专有的 FTP 登录账户，保障服务器安全。</pre>
							

<p
	class="content warning J-status-section"
	data-show-status="!done"
	
>首次可免费使用云主机  45 分钟 ，到期后云主机将被重置并退库，若想保留成果请及时留用。</p>


<p
	class="content warning J-status-section"
	data-show-status="done"
	style="display:none;"
>您已用过此实验室的免费体验名额，距离下一次使用还剩余 <span class="J-leftTime" data-next_recv_time="1573022745000">00:00:00</span>，您还可以使用个人云主机再次进行实验。</p>


						</div>
						<div class="section">
							<h3 class="title">实验资源</h3>
							<div class="content">
								
									<div class="tag">云服务器</div>
								
								
							</div>
						</div>
						<div class="section">
							<h3 class="title">软件环境</h3>
							<div class="content">
								
									<div class="tag">CentOS 7.2 64 位</div>
								
								
							</div>
						</div>
					</div>

					<!-- Doc -->
					<div class="lab-doc item second">
						<div class="J-catalog-cont catalog">
							<h3 class="title">目录</h3>
							<div class="J-catalog"></div>
						</div>
						<div class="J-doc doc">
							<code># 搭建 FTP 文件服务

## 安装并启动 FTP 服务

&gt; &lt;time&gt;5min ~ 10min&lt;/time&gt;

### 安装 VSFTPD

使用 `yum` 安装 [vsftpd][]：

```
yum install vsftpd -y
```

&gt; &lt;bubble for=&#34;vsftpd&#34;&gt;
&gt; `vsftpd` 是在 Linux 上被广泛使用的 FTP 服务器，根据其[官网介绍][https://security.appspot.com/vsftpd.html]，它可能是 UNIX-like 系统下最安全和快速的 FTP 服务器软件。
&gt; &lt;/bubble&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;ls /etc/vsftpd -la&#34; hint=&#34;安装 vsftpd&#34;&gt;
&gt;     &lt;keyword regex=&#34;vsftpd.conf&#34; /&gt;
&gt; &lt;/checker&gt;

### 启动 VSFTPD

安装完成后，启动 FTP 服务：

```
service vsftpd start
```

启动后，可以看到系统已经[监听了 21 端口][21]：

```
netstat -nltp | grep 21
```

此时，访问 [ftp://${runtime.vars.cvmIpAddress}][] 可浏览机器上的 [/var/ftp][ftp-home] 目录了。

&gt; &lt;bubble for=&#34;21&#34;&gt;
&gt; FTP 协议默认使用 21 端口作为服务端口
&gt; &lt;/bubble&gt;

&gt; &lt;locate for=&#34;ftp-home&#34; path=&#34;/var/ftp&#34; hint=&#34;默认 FTP 访问目录在此&#34; /&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;netstat -nltp&#34; hint=&#34;启动 vsftp 服务&#34;&gt;
&gt;     &lt;keyword regex=&#34;:21&#34; /&gt;
&gt; &lt;/checker&gt;

## 配置 FTP 权限

&gt; &lt;time&gt;5min ~ 10min&lt;/time&gt;

目前 FTP 服务登陆允许匿名登陆，也无法区分用户访问，我们需要配置 FTP 访问权限

### 了解 VSFTP 配置

vsftpd 的配置目录为 [/etc/vsftpd][0]，包含下列的配置文件：

  - [vsftpd.conf][1] 为主要配置文件
  - [ftpusers][2] 配置禁止访问 FTP 服务器的用户列表
  - [user_list][3] 配置用户访问控制

阅读上述配置以了解更多信息。如果您准备好了，点击下一步开始修改配置来设置权限。

&gt; &lt;locate for=&#34;0&#34; path=&#34;/etc/vsftpd&#34; hint=&#34;vsftp 配置目录&#34; /&gt;

&gt; &lt;locate for=&#34;1&#34; path=&#34;/etc/vsftpd/vsftpd.conf&#34; hint=&#34;vsftp 主要配置&#34; /&gt;

&gt; &lt;locate for=&#34;2&#34; path=&#34;/etc/vsftpd/ftpusers&#34; hint=&#34;vsftp 黑名单用户列表&#34; /&gt;

&gt; &lt;locate for=&#34;3&#34; path=&#34;/etc/vsftpd/user_list&#34; hint=&#34;vsftp 用户访问控制&#34; /&gt;

### 阻止匿名访问和切换根目录

匿名访问和切换根目录都会给服务器带来[安全风险][safety]，我们把这两个功能关闭。

[编辑 /etc/vsftpd/vsftpd.conf][edit]，[找到下面两处配置][find]并修改：

```
# 禁用匿名用户
anonymous_enable=NO

# 禁止切换根目录
chroot_local_user=YES
```

编辑完成后，按 `Ctrl + S` 保存配置，重新启动 FTP 服务，如：

```
service vsftpd restart
```

&gt; &lt;bubble for=&#34;safety&#34;&gt;
&gt; 匿名访问让所有人都可以上传文件到服务器上而无需鉴权，而允许切换根目录则可能产生越权访问问题。
&gt; &lt;/bubble&gt;

&gt; &lt;bubble for=&#34;find&#34;&gt;
&gt; 在代码编辑器中，用 `Ctrl + F` 进行搜索，Mac 用户用 `Cmd + F` 进行搜索
&gt; &lt;/bubble&gt;

&gt; &lt;locate for=&#34;1&#34; path=&#34;/etc/vsftpd/vsftpd.conf&#34; hint=&#34;编辑主配置文件&#34; /&gt;

&gt; &lt;edit for=&#34;edit&#34; file=&#34;/etc/vsftpd/vsftpd.conf&#34; /&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;cat /etc/vsftpd/vsftpd.conf&#34; hint=&#34;修改配置以禁止匿名用户访问&#34;&gt;
&gt;     &lt;keyword regex=&#34;^anonymous_enable=NO&#34; /&gt;
&gt; &lt;/checker&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;cat /etc/vsftpd/vsftpd.conf&#34; hint=&#34;修改配置以禁止用户切换根目录&#34;&gt;
&gt;     &lt;keyword regex=&#34;^chroot_local_user=YES&#34; /&gt;
&gt; &lt;/checker&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;curl ftp://${runtime.vars.cvmIpAddress} -v 2&gt;&amp;1&#34; hint=&#34;重启 FTP 服务&#34;&gt;
&gt;     &lt;keyword regex=&#34;530&#34; /&gt;
&gt; &lt;/checker&gt;

### 创建 FTP 用户 

创建一个用户 `ftpuser` [:question][user]：

```
useradd ftpuser
```

为用户 `ftpuser` 设置密码 [:question][password]：

```
echo &#34;${runtime.vars.allocatedPassword}&#34; | passwd ftpuser --stdin
```

&gt; &lt;bubble for=&#34;user&#34;&gt;
&gt; 为了方便后面的实验步骤，不建议使用其它的用户名
&gt; &lt;/bubble&gt;

&gt; &lt;bubble for=&#34;password&#34;&gt;
&gt; 下面命令中的密码为实验室为您生成，为了方便后面的实验步骤，不建议使用其他密码
&gt; &lt;/bubble&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;cat /etc/passwd&#34; hint=&#34;创建 FTP 用户（如果您使用其它用户，请直接下一步）&#34;&gt;
&gt;     &lt;keyword regex=&#34;ftpuser:&#34; /&gt;
&gt; &lt;/checker&gt;

### 限制该用户仅能通过 FTP 访问

限制用户 `ftpuser` 只能通过 FTP 访问服务器，而不能直接登录服务器：

```
usermod -s /sbin/nologin ftpuser
```

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;cat /etc/passwd&#34; hint=&#34;限制 FTP 用户登录方式&#34;&gt;
&gt;     &lt;keyword regex=&#34;ftpuser:/sbin/nologin&#34; /&gt;
&gt; &lt;/checker&gt;

### 为用户分配主目录

为用户 `ftpuser` 创建[主目录][ftp-home]并约定：

`/data/ftp` 为主目录, 该目录不可上传文件

`/data/ftp/pub` 文件只能上传到该目录下

```
mkdir -p /data/ftp/pub
```

创建登录欢迎文件 [:question][welcome]：

```
echo &#34;Welcome to use FTP service.&#34; &gt; /data/ftp/welcome.txt
```

设置访问权限：

```
chmod a-w /data/ftp &amp;&amp; chmod 777 -R /data/ftp/pub
```

设置为用户的主目录：

```
usermod -d /data/ftp ftpuser
```

&gt; &lt;bubble for=&#34;ftp-home&#34;&gt;
&gt; 用户的主目录是用户通过 FTP 登录后看到的根目录
&gt; &lt;/bubble&gt;

&gt; &lt;bubble for=&#34;welcome&#34;&gt;
&gt; 方便用户登录后可以看到欢迎信息，并且确定用户确实登录到了主目录上。
&gt; &lt;/bubble&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;ls -la /data&#34; hint=&#34;创建目录 /data/ftp&#34;&gt;
&gt;     &lt;keyword regex=&#34;ftp&#34; /&gt;
&gt; &lt;/checker&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;ls -ld /data/ftp&#34; hint=&#34;设置 /data/ftp 访问权限为 a-w&#34;&gt;
&gt;     &lt;keyword regex=&#34;dr-xr-xr-x&#34; /&gt;
&gt; &lt;/checker&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;ls -ld /data/ftp/pub&#34; hint=&#34;设置 /data/ftp/pub 访问权限为 777&#34;&gt;
&gt;     &lt;keyword regex=&#34;drwxrwxrwx&#34; /&gt;
&gt; &lt;/checker&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;cat /etc/passwd&#34; hint=&#34;设置 /data/ftp 为用户 ftpuser 的主目录&#34;&gt;
&gt;     &lt;keyword regex=&#34;ftpuser&#34; /&gt;
&gt;     &lt;keyword regex=&#34;/data/ftp&#34; /&gt;
&gt; &lt;/checker&gt;

&gt; &lt;checker type=&#34;output-contains&#34; command=&#34;ls -la /data/ftp&#34; hint=&#34;创建登录欢迎文件 welcome.txt&#34;&gt;
&gt;     &lt;keyword regex=&#34;welcome&#34; /&gt;
&gt; &lt;/checker&gt;

## 准备域名和证书
&gt; &lt;time&gt;15min ~ 30min&lt;/time&gt;

注：如果您不需要通过域名访问 FTP 服务器则可以直接点击“已完成，下一步”跳过域名和证书的准备环节

### 域名注册

如果您还没有域名，可以[在腾讯云上选购][buy_link]，过程可以参考下面的视频。

* [视频 - 在腾讯云上购买域名][buy_domain_video]

&gt; &lt;link for=&#34;buy_link&#34; href=&#34;https://dnspod.qcloud.com/?fromSource=lab&#34;&gt;&lt;/link&gt;
&gt; &lt;video for=&#34;buy_domain_video&#34; platform=&#34;qq&#34; vid=&#34;p05077pwelw&#34; name=&#34;域名选购&#34;&gt;&lt;/video&gt;

### 域名解析

域名购买完成后, 需要将域名解析到实验云主机上，实验云主机的 IP 为：


```
${runtime.vars.cvmIpAddress}
```

在腾讯云购买的域名，可以[到控制台添加解析记录][https://console.qcloud.com/domain]，过程可参考下面的视频：

* [视频 - 如何在腾讯云上解析域名][video_resolve_domain] 

&gt; &lt;video for=&#34;video_resolve_domain&#34; platform=&#34;qq&#34; vid=&#34;t0507ps9kxo&#34; name=&#34;域名解析&#34;&gt;&lt;/video&gt;

域名设置解析后需要过一段时间才会生效，通过 `ping` 命令检查域名是否生效 [:question][replace]，如：

&gt; &lt;bubble for=&#34;replace&#34;&gt;注意替换下面命令中的 `www.yourmpdomain.com` 为您自己的注册的域名&lt;/bubble&gt;

```
ping www.yourdomain.com
```

如果 ping 命令返回的信息中含有你设置的解析的 IP 地址，说明解析成功。

## 访问 FTP 服务

&gt; &lt;time&gt;5min ~ 10min&lt;/time&gt;

FTP 服务已安装并配置完成，下面我们来使用该 FTP 服务

### 访问 FTP 服务

根据您个人的工作环境，选择一种方式来访问已经搭建的 FTP 服务

#### 通过 Windows 资源管理器访问

Windows 用户可以复制下面的[链接][address]到资源管理器的地址栏访问：

&gt; &lt;bubble for=&#34;address&#34;&gt;
&gt; 如果您申请了域名，可以将链接中的 Ip 地址替换为对应的域名访问 FTP 服务
&gt; &lt;/bubble&gt;

```
ftp://ftpuser:${runtime.vars.allocatedPassword}@${runtime.vars.cvmIpAddress}
```

#### 通过 FTP 客户端工具访问

FTP 客户端工具众多，下面推荐两个常用的：

  - [WinSCP][ws] - Windows 下的 FTP 和 SFTP 连接客户端
  - [FileZilla][fz] - 跨平台的 FTP 客户端，支持 Windows 和 Mac

下载和安装 FTP 客户端后，使用下面的凭据进行连接即可：

[主机][host]：

&gt; &lt;bubble for=&#34;host&#34;&gt;
&gt; 如果您申请了域名，可以将 Ip 地址替换为对应的域名作为访问凭据
&gt; &lt;/bubble&gt;

```
${runtime.vars.cvmIpAddress}
```

用户：

```
ftpuser
```

密码：

```
${runtime.vars.allocatedPassword}
```

如果能够正常连接，那么大功告成，您可以开始使用属于您自己的 FTP 服务器了！

接下来，请上传任意一张图片到您的 FTP 服务器上的pub目录下，然后，就可以在 [/data/ftp/pub][ftp] 中看到了。

注意: `请不要直接上传文件到根目录下`，您应该选择上传到 `pub` 目录下

&gt; &lt;locate for=&#34;ftp&#34; path=&#34;/data/ftp/pub&#34; hint=&#34;上传后，重新打开此目录查看文件&#34; /&gt;

&gt; &lt;checker type=&#34;output-contains-no&#34; command=&#34;ls -1p /data/ftp/pub | grep -v &#39;/&#39; | wc -l&#34; hint=&#34;上传图片到 FTP 服务器上&#34;&gt;
&gt;   &lt;keyword regex=&#34;0&#34; /&gt;
&gt; &lt;/checker&gt;

### 大功告成

恭喜！您已经成功完成了搭建 FTP 服务器的实验任务。
</code>
						</div>
					</div>

					<!-- Comment -->
					<div id="react-root" class="item third"></div>
				</div>
			</div>

			<!-- Sidebar -->
			<div class="lab-sidebar">
<!--
	<a class="collection" href="/developer/labs/collection" target="_blank">
		<h3 class="title">教程悬赏征集</h3>
		<div class="subject">主题：微信小程序</div>
		<div class="time">时间：2017.12.18-2018.01.30</div>
		<p class="btn">立即投稿</p>
	</a>
-->
	<div class="content">

		<div class="item">
			<h3 class="title">推荐活动</h3>
			<ul>
				<li><a target="_blank" href="/act/campus" title="学生主机 10 元起">学生主机 10 元起</a></li>
			</ul>
		</div>

		<div class="item">
			<h3 class="title">推荐实验</h3>
			<ul>
				
					<li><a target="_blank" href="/developer/labs/lab/10386" title="蓝鲸智云社区版V4.1单机部署体验">蓝鲸智云社区版V4.1单机部署体验</a></li>
				
					<li><a target="_blank" href="/developer/labs/lab/10054" title="搭建 Docker 环境">搭建 Docker 环境</a></li>
				
					<li><a target="_blank" href="/developer/labs/lab/10414" title="使用 Docker Compose 快速搭建个人云并配置多存储介质">使用 Docker Compose 快速搭建个人云并配置多存储介质</a></li>
				
					<li><a target="_blank" href="/developer/labs/lab/10029" title="搭建 LNMP 环境">搭建 LNMP 环境</a></li>
				
					<li><a target="_blank" href="/developer/labs/lab/10035" title="搭建 Java Web 开发环境">搭建 Java Web 开发环境</a></li>
				
			</ul>
		</div>

		<div class="item">
			<h3 class="title">相关产品</h3>
			<ul>
				
					<li><a target="_blank" href="https://cloud.tencent.com/product/cvm" title="云服务器">云服务器</a></li>
				
			</ul>
		</div>

	</div>
</div>

		</div>
	</div>
</div>

<script>
	window.__LABINFO = {
		labId: 10002,
		resourceTotalNum: 1,
		labStatus: {"idleNum":4,"busyNum":0,"dueTime":0,"status":0,"nextRecvTime":1573022745000},
		statusCode: 'ready',
		labInfo: {"hasAuth":1,"logo":"https://share-10039692.file.myqcloud.com/lab/ac197229e6/logo/d80m1eclca/exp-ftp.svg","title":"基于 CentOS 搭建 FTP 文件服务","level":"started","status":1,"levelStr":"入门","desc":"FTP 是一个很实用的文件传输协议，方便在客户端和服务器之间进行文件的传输。本实验带您使用 vsftpd 来搭建一个 FTP  服务，并且创建专有的 FTP 登录账户，保障服务器安全。","type":"official","category":"env_build","certLogo":"","ldsUrl":"//share-10039692.file.myqcloud.com/lab/lds/release/10002-6e677746abf53f3e1162c906d25b6c4b.lds.js","draftVersion":"8852ff38ba542265a817b9b0473e5dc5","resourceNum":1,"freeTime":45,"resourceConfig":{"cvm":{"regionId":1,"zoneId":100003,"osName":"centos7.2x86_64","image":{"imgId":"img-31tjrtph","imgType":"2","imgName":"CentOS 7.2 64位"},"goods_version":"v1","goodsDetail":{"cpu":1,"mem":1,"bandwidth":1,"disk":50,"isWinOs":0,"family":2}}},"packageConfig":[{"name":"云服务器","url":"https://cloud.tencent.com/product/cvm"}],"softEnv":["CentOS 7.2 64 位"],"idleNum":4,"source":"","owner":"腾讯云","uin":0,"isSubmitLab":0}
	};
	window.__PAGE_VERSION = 'NEW';
</script>

<div class="lab-footer-blogroll J-lab-footer" style="position:fixed;bottom:0;width:100%;">
	<div class="blogroll-inner">
		<div class="link-set">
			<div class="department">
				<a href="http://www.tencent.com" class="icon-tc"><span class="visually-hidden">tencent</span></a>
				<a href="http://open.qq.com/" hotrep="hp.footer.link.open" class="slide" target="_blank">腾讯开放平台</a>
				<a href="http://iot.qq.com/" hotrep="hp.footer.link.iot" class="slide" target="_blank">QQ物联</a>
				<a href="http://www.dnspod.cn/" hotrep="hp.footer.link.dnspod" class="slide" target="_blank">DNSPod</a>
				<a href="http://mp.weixin.qq.com/" hotrep="hp.footer.link.weixin" class="slide" target="_blank">微信公众平台</a>
				<a href="http://b.qq.com/?utm_source=youlian&amp;utm_medium=qcloud&amp;utm_campaign=youlian" hotrep="hp.footer.link.bqq" class="slide" target="_blank">企业QQ</a>
				<a href="http://open.youtu.qq.com/" hotrep="hp.footer.link.youtu" class="slide" target="_blank">腾讯优图</a>
				<a href="http://bk.tencent.com/" hotrep="hp.footer.link.lanjing" class="slide" target="_blank">腾讯蓝鲸</a>
				<a href="http://www.weiyun.com/" hotrep="hp.footer.link.weiyun" class="slide" target="_blank">腾讯微云</a>
				<a href="//www.qcloud.com/friendlink/index.html" hotrep="hp.footer.link.friendlink" class="slide" target="_blank">友情链接</a>
			</div>
			<div class="links">
				<p class="line copyright">
					<span class="slide">Copyright &copy; 2013<script>new Date().getFullYear()>2013&&document.write("-"+new Date().getFullYear());</script> Tencent Cloud. All Rights Reserved. <span>腾讯云&nbsp;版权所有</span></span>
					<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802020287" target="_blank" class="slide slide-ct">京公网安备 11010802020287</a>
					<a href="http://www.beian.miit.gov.cn" target="_blank" class="slide slide-ct">京ICP备11018762号</a>
				</p>
			</div>
		</div>
</div>

<script src="//imgcache.qq.com/qcloud/main/scripts/release/common/vendors/babel/polyfill.6.26.min.js?max-age=31536000"></script>
<script type="text/javascript" src="//imgcache.qq.com/qcloud/app/qcconsole_web/dest/_imgcache_qq_com_idc.js" async></script>
<script type="text/javascript" src="//cloud.tencent.com/qccomponent/_cloud_tencent_com_idc.js" async></script>
<script type="text/javascript" src="//www.qcloud.com/_www_qcloud_com_idc.js" async></script>
<script>
	window.getCurrServerTime = (function(s, c) {return function(){return +new Date()+s-c;}})(1573022745878, +new Date());
	window.__enableReport = true;
	window.lifeId = "ByMQhJlsB";
	window.lifeStart = getCurrServerTime();
</script>
<script src="https://imgcache.qq.com/qcloud/insight/insight-client.985ac73c2.js"></script>
<script>
	try {
		if (typeof window.Insight === 'object') {
			Insight.install({
				app: 'qcmain',
				lid: window.lifeId,
				born: window.lifeStart,
				time: window.getCurrServerTime,
				shouldReportEvent: function () {
					return window.__enableReport && document.cookie.search('disableInsight=1') === -1;
				}
			});
		}
	} catch(e) {
		console.warn('官网监控初始化失败');
	}
</script>
<script>
	try {
		for(var key in localStorage) {
			if (localStorage.hasOwnProperty(key) && key.indexOf('qcmain/js') === 0) {
				localStorage.removeItem(key);
			}
		}
	} catch (e) {}
</script>
<script src="//imgcache.qq.com/qcloud/main/scripts/release/common/base.4b21e383c1054d05a671.js?max_age=31536000"></script>
<script src="//cloud.tencent.com/qccomponent/login/api.js?max_age=31536000"></script>

<script src="//imgcache.qq.com/qcloud/main/scripts/release/common/qcloudStatApi.js"></script>


<script src="//imgcache.qq.com/qcloud/main/scripts/release/labs/common/index.e915e128e229eaf50cad.js?max_age=31536000"></script>

<script src="/qccomponent/leftnav/loader.js" async></script>

<script src="//imgcache.qq.com/qcloud/main/scripts/release/labs/detail/index.790b78745652932fe58d.js?max_age=31536000"></script>

<script src="//imgcache.qq.com/qcloud/main/scripts/release/common/vendors/react/react.16.2.0.min.js"></script>
<script src="//imgcache.qq.com/qcloud/main/scripts/release/common/vendors/react/react-dom.16.2.0.min.js"></script>

<script>
	window.WECHAT_SHARE_CONFIG = {
		default: {
			imgUrl: 'https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/laboratory/css/img/exp/exp-ftp.png',
		}
	};
</script>

<script>
	window.$serverTime = 1573022745752;
	window.$clientTime = Date.now();
</script>


	<script src="//imgcache.qq.com/qcloud/main/scripts/release/labs/comment.d0b96c8340c83ea2590d.js?max_age=31536000"></script>

<script src="//imgcache.qq.com/qcloud/main/scripts/release/common/deps/wechatJsSdk.js?version=1_0_1&max_age=31536000"></script>
</body>
</html>
