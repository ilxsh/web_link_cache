// (function(){

    var timeline = new TimelineMax(), 
    	bannerAd = document.getElementById("banner"),
        allDivs_loader = banner.querySelectorAll("*"),
        smoked = document.getElementsByClassName("smoke"),
        smoke_count = 0,
        total = 50,
        totalCount,        
        allDivs = bannerAd.children,   
    	divsLoaded = 0,
        banner_timer,
    	divsTotal;

    var replay = document.getElementById("replay_button")
    var clickable = document.getElementById("clickable")

    replay.addEventListener('click', tabOneClickHandler, false);
    clickable.addEventListener('click', exitClicked, false);

    function tabOneClickHandler(e) {
        console.log('tabOneClickHandler');
        Enabler.counter('hybitxdgitmonsterolv300x250simplivitytameit_en_prdgseventreplay', true);
    }

    function exitClicked() {
        console.log('exitClicked');
        Enabler.exit('exit clicked');
    }

    // Turn elements opacity off
    for (i = 0; i < allDivs.length; i++) {
        allDivs[i].style.opacity = 0;
    }
    //

    //Create Particles
    var imgCount = 4;
    var dir = 'images/';
    var images = new Array
        images[1] = "particle.png",
        images[2] = "particle.png",
        images[3] = "particle.png",
        images[4] = "particle.png";

    for (i=0; i<total; i++){
      totalCount = i;
      var iDiv = document.createElement('div');
      var randomCount = Math.round(Math.random() * (imgCount - 1)) + 1;
        iDiv.className = 'smoke';
        iDiv.id = 'smokes'+[i];
        document.getElementById('smoke_pack').appendChild(iDiv); 
    }
    
    function particle_set(elm){
      TweenMax.set(elm,
        {
        delay: totalCount/200,
        scale:random(1, 1.4),
        opacity:1,
        y:Random(300),
        x:Random(300),
        });
    };
    //

    // Load Dom
    document.addEventListener('DOMContentLoaded', domLoaded, false);
    window.addEventListener('load', windowLoaded, false);

    function domLoaded(e) {
        // console.log('Dom Has Loaded');
        frameOne();

        // Banner Timer 15 seconds
        // banner_timer = setInterval(bannerTime, 100);
        //

        // TweenMax.set([], {force3D:true});
    }

    function windowLoaded(e) {
        // console.log('Window Has Loaded');
    }
    //

    // Animation Station
    function frameOne() {
        TweenMax.to(bannerAd, .2, {
            opacity: 1
        }
        ),
        TweenMax.set([bg1, text1, logo, monster], {
            opacity: 1
        }
        ),
        TweenMax.set(blur_text, {
            x: -300
        },
        ),
        TweenMax.to(text1, .5, {
            opacity: 0, delay: 1.4
        }
        ),
        TweenMax.to(text2, .5, {
            opacity: 1, delay: 2.2
        }
        ),
        TweenMax.to(text2, .3, {
            x: 300, delay: 3.1
        }
        ),
        TweenMax.to(blur_text, .7, {
            opacity: 1, x: 170, delay: 3.1
        }
        ),
        TweenMax.to(blur_text, .1, {
            opacity: 0, delay: 3.5
        }
        ),
        TweenMax.to(monster, .01, {
            opacity: 0, delay: 3.2
        }
        ),
        TweenMax.staggerFromTo([monster_4, monster_5, monster_6], .035, {
            opacity: 0
        }
        , {
            opacity: 1, yoyo: !0, repeat: 50, delay: 3.2, ease: Power2.easeInOut
        }
        , -.05),
        TweenMax.to(walk_shadow, .05, {
            opacity: 1, delay: 3.09
        }
        ),
        TweenMax.fromTo([walk_shadow], .05, {
            scale: .9
        }
        , {
            scale: 1, yoyo: !0, repeat: 50, delay: 3.09, ease: Power2.easeInOut
        }
        , -.05),
        TweenMax.to([monster_4, monster_5, monster_6], .4, {
            x: -1, y: 1, repeat: 20, rotation: -1, yoyo: !0, ease: Back.easeInOut.config(3), delay: 3.2
        }
        ),
        TweenMax.to([monster_4, monster_5, monster_6], .2, {
            top: -40, ease: Power2.easeOut, delay: 3.2
        }
        ),
        TweenMax.to([monster_4, monster_5, monster_6], .2, {
            top: 0, ease: Bounce.easeInOut, delay: 3.4
        }
        ),
        TweenMax.to(text3, .1, {
            opacity: 1, delay: 3.5
        }
        ),
        TweenMax.delayedCall(4.85, chalk_explosion)
    }


    function chalk_explosion () {

        TweenMax.set([
            chalk_bottom,
            chalk_left,
            chalk_right,
            chalk_top,
            chalk_center,
        ], {opacity:0, scale:0, transformOrigin:"150px 125px"});

        TweenMax.set([
            chalk_holder,
            chalk_shadow,
        ], {opacity:1});

        TweenMax.to(chalk_center, 0.2, {opacity:1, scale:1});
        
        TweenMax.staggerTo([
            chalk_left,
            chalk_right,
            chalk_bottom,
            // chalk_top,
        ], 0.2, {opacity:1, scale:1, delay:0.1}, 0);

        TweenMax.to(chalk_top, 0.2, {opacity:1, scale:1, delay:0.2});

        TweenMax.to(chalk_holder, 0.3, {scale:5,
            //
            ease: Back. easeIn.config( 1.7),
            //
        });           
		TweenMax.to([monster_4, monster_5, monster_6, walk_shadow], 0.5, {opacity:0});
        TweenMax.to(chalk_holder, 1, {opacity:0, delay:0.2});

        TweenMax.fromTo(chalk_shadow,  1, {scale:0, opacity:0, transformOrigin:"150px, 220px"}, {scale:1.5, opacity:0.3, transformOrigin:"150px, 220px"});
        TweenMax.to(chalk_shadow, 1, {opacity:0, delay:0.5});

        TweenMax.delayedCall(0.5, frameTwo);
    }

    function particle_dust () {
        TweenMax.set([
            smoke_pack
        ], {opacity:1});

        for (i=0; i<total; i++){
        
        var smokes_num = document.getElementById("smokes" + [i]);
            
          TweenMax.set(smokes_num, {opacity:0, transformOrigin:"50% 50%", rotation:Random(360), opacity:0, x:150, y:125,
            scale:Random(1),
            y:random(-100,250),
            x:Random(300),
            top:"0px",
           backgroundImage:"url(" + dir + images[randomCount] + ")"});

          particle_falling(smokes_num);
        }
    }

    function particle_falling(elm){

      TweenMax.to(elm, random(2, 4),
        {
            delay: totalCount/300,
            opacity:1,
            top:Random(300)+"px",
            scale:Random(0.7),
        });
    };       

    // function frameThree () {
    //     TweenMax.to(smoke_pack, 1, {opacity:0, delay:2});
    //     TweenMax.delayedCall(1.5, frameFour);
    // }

    function frameTwo () {
        TweenMax.set([
            icon1_shadow,
            icon1,
            bg2,
        ], {opacity:1});
        
        TweenMax.to([text3], 0.7, {opacity:0});

        TweenMax.from(icon1, 1, {scale:0.5, opacity:0, transformOrigin:"150px 300px", delay:0.4});
        TweenMax.from(icon1_shadow, 1, {scale:0, opacity:0, delay:0.4});


        TweenMax.to([icon1, icon1_shadow], 1, {opacity:0, delay:1.8});
        TweenMax.from([bg2], 1, {opacity:0, delay:1.8});

        TweenMax.delayedCall(2.3, frameThree);
    }

    function frameThree () {
        TweenMax.set([
            ctaCon,
            text4,       
            replay_button,
            monster_FF
        ], {opacity:1});

        TweenMax.staggerFromTo([
            text4,
            ctaCon,
            replay_button
        ], 1, {opacity:0, ease:Power0.easeNone}, {opacity:1, ease:Power0.easeNone}, 1)

        TweenMax.from(monster_FF, 2, { opacity: 0, scale: 0.98 })
        
        TweenMax.delayedCall(4, ctaAnimation);
		document.getElementById("replay_button").addEventListener("click", replayFunction);
		// TweenMax.set(popup, {display: 'block', opacity: 1});
        // closeLegalText.addEventListener("click", hideLegal, false);
        // popup.addEventListener("mouseover", showLegal, false);
    }

    function ctaAnimation(){
        bannerAd.removeEventListener("mouseover", ctaAnimation);
        TweenMax.set(sheen, {x:0, opacity:0.5});
        
        TweenMax.to(sheen, 1.5, {x:200, onComplete:ctaOver, ease:Power0.easeNone});
    }

    function ctaOver(){
        bannerAd.addEventListener("mouseover", ctaAnimation);
	}
	function spinAnimation() {
		TweenMax.set(spinBlur1, {x:0, opacity:0.5});
        TweenMax.to(sheen, 0.2, {x:150, ease:Power0.easeNone});
	}

    // Replay Funk
    function replayFunction(){
		TweenMax.killAll(false);
		

        for (i = 0; i < allDivs_loader.length; i++) {

            TweenMax.set(allDivs_loader[i], {
                x:0,
                y:0,
                rotation:0,
                scale:1,
                // alpha:1,
            });
		}   
		
        
        elements_off();
	} 
	
	function hideLegal(){
		TweenMax.set(legalText, {css: {display: "none", opacity: "0"}})
		TweenMax.to(popup, 0.5, {opacity:1});
	}
	
	function showLegal(){
		TweenMax.set(legalText, {css: {display: "block", opacity: "1"}})
		TweenMax.set(popup, {opacity:0});
	}

    function elements_off () {
        // Turn elements opacity off
        
        for (i = 0; i < allDivs.length; i++) {
            TweenMax.set(allDivs[i], {alpha:0});
        }
        frameOne();
    }    
    //

    function monster_blink() {
        TweenMax.staggerTo([
            left_eye_open,
            left_eye_half,
            // left_eye_closed,
        ], 0.1, {opacity:0, repeat:1, yoyo:true, force3D:true}, 0);

        TweenMax.staggerTo([
            right_eye_open,
            right_eye_half,
            // right_eye_closed,
        ], 0.1, {opacity:0, repeat:1, yoyo:true, force3D:true}, 0);        
    }


    var banner_start = Date.now();
    var banner_end = banner_start + 15000;//
    function bannerTime(){
        banner_start = Date.now();

        if(banner_start > banner_end){
            clearInterval(banner_timer);
            // TweenMax.killAll();
            alert("Banner = 15 seconds");
        }
    }

    function timeScale(element, duration, speed){
        TweenMax.to(element, duration, {timeScale:speed, ease:Power4.easeIn});
    }

    // Random
    function Random (max) {
        return Math.random()*max;
    }

    function random(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }



// })();
