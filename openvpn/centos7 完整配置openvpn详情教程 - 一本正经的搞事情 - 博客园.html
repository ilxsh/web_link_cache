<!DOCTYPE html>
<!-- saved from url=(0049)https://www.cnblogs.com/zhujingzhi/p/9905067.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="referrer" content="origin">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园</title>
    <meta property="og:description" content="1. 什么是OpenVpn OpenVPN 是一个用于创建虚拟专用网络加密通道的软件包，最早是由James Yonan编写的。OpenVPN允许创建的VPN使用公开密钥、电子证书、或者用户名">
    <link type="text/css" rel="stylesheet" href="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/bundle-coffee.css">
<link type="text/css" rel="stylesheet" href="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/456372.css">
<link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/bundle-coffee-mobile.css">
    <link title="RSS" type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/zhujingzhi/rss">
    <link title="RSD" type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/zhujingzhi/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/zhujingzhi/wlwmanifest.xml">
    <script src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/amp4ads-host-v0.js.download"></script><script async="" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/analytics.js.download"></script><script type="text/javascript" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/encoder.js.download"></script><script src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/pubads_impl_rendering_2019052001.js.download"></script><script src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/jquery-2.2.0.min.js.download"></script>
    <script>var currentBlogId=456372;var currentBlogApp='zhujingzhi',cb_enable_mathjax=false;var isLogined=false;</script>
    <script src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/blog-common.js.download" type="text/javascript"></script>
<link rel="preload" href="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/f.txt" as="script"><script type="text/javascript" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/f.txt"></script><script src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/pubads_impl_2019052001.js.download" async=""></script><link rel="prefetch" href="https://tpc.googlesyndication.com/safeframe/1-0-33/html/container.html"><script src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/share.js.download"></script><style type="text/css">.heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}</style></head>
<body>
<a name="top"></a>

<div id="page_begin_html"><script type="text/javascript">window['__document_write_ajax_callbacks__']['3']();</script><script>window['__document_write_ajax_callbacks__']['1']();</script>


<!-- 添加顶部滚动信息（公告）例子：《沁园春.雪》-->
<div id="Scroll_info" style="text-align: center;color:red;font-size:13px;padding:5px;opacity: 0.5">所不能。天将降大任于是人也，必先苦其心志，劳其筋骨，饿其体肤，空乏其身，行拂乱其所为，所以动心忍性，曾益其</div>
<script type="text/javascript">window['__document_write_ajax_callbacks__']['4']();</script><script>window['__document_write_ajax_callbacks__']['2']();</script>


<!-- 添加博客顶部博主信息-->
<p style="text-align: center;font-size:35px;margin-bottom:5px;margin-top:20px;opacity: 0.5">时间在流逝,在不正经就晚咯</p></div><script>load_page_begin_html();</script>

<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="https://www.cnblogs.com/zhujingzhi/"><img id="blogLogo" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/logo.gif" alt="返回主页"></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="https://www.cnblogs.com/zhujingzhi/">一本正经的搞事情</a></h1>
<h2>改变懒惰,成就心中的自己,并非难事</h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="navigator">
			
<ul id="navList">
	<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">博客园</a></li>
	<li><a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/zhujingzhi/">首页</a></li>
	<li><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
	<li><a id="blog_nav_contact" accesskey="9" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/%E4%B8%80%E6%9C%AC%E6%AD%A3%E7%BB%8F%E7%9A%84%E6%90%9E%E4%BA%8B%E6%83%85">联系</a></li>
	<li><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
	<li><a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/zhujingzhi/rss">订阅</a>
	<a id="blog_nav_rss_image" class="aHeaderXML" href="https://www.cnblogs.com/zhujingzhi/rss"><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/xml.gif" alt="订阅"></a></li>
</ul>


			<div class="blogStats">
				
				<div id="blog_stats">
<!--done-->
随笔- 40&nbsp;
文章- 0&nbsp;
评论- 6&nbsp;
</div>
				
			</div><!--end: blogStats -->
		</div><!--end: navigator 博客导航栏 -->
		
        <div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/zhujingzhi/p/9905067.html">centos7 完整配置openvpn详情教程</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body"><a name="_labelTop"></a><div id="navCategory" style="color:#152e97;"><p style="font-size:18px;"><b>目录</b></p><ul><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_label0">1.&nbsp;什么是OpenVpn</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_label1">2.&nbsp;OpenVpn的原理</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_label2">3.&nbsp;加密和认证方式</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_label3">4.&nbsp;功能与端口</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_label4">5. 配置文件详情</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_label5">6. 用户名密码验证服务器端安装配置</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_label6">7. 证书认证服务器配置</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_label7">8. windows客户端配置</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_label8">8. Linux客户端配置</a></li></ul></div><p>&nbsp;</p><hr style="height:1px;border:none;border-top:1px dashed #0066CC;"><div style="text-align: right;"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label0"></a></div><h2 id="blogTitle0">1.&nbsp;什么是OpenVpn</h2>
<p>OpenVPN 是一个用于创建虚拟专用网络加密通道的软件包，最早是由James Yonan编写的。OpenVPN允许创建的VPN使用公开密钥、电子证书、或者用户名/密码来进行身份验证.</p>
<p>它大量使用了OpenSSL加密库中的SSLv3/TLSv1协议函数库.</p>
<p>目前OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Microsoft Windows以及Android和iOS上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容.</p>
<div style="text-align: right;"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label1"></a></div><h2 id="blogTitle1">2.&nbsp;OpenVpn的原理</h2>
<p><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/1479220-20181104182051972-1496534676.png" alt=""></p>
<p>&nbsp;</p>
<p>OpenVPN的技术核心是虚拟网卡，其次是SSL协议实现</p>
<p>OpenVPN中的虚拟网卡是使用网络底层编程技术实现的一个驱动软件,安装此类程序后会在主机上增加一个非真实的网卡，并可以像其他网卡一样进行配置,服务程序可以在应用层打开虚拟网卡，如果应用软件(如网络浏览器)向虚拟网卡发送数据,则服务程序可以读取到该数据,如果服务程序写合适的数据到虚拟网卡,应用软件也可以接受的到.虚拟网卡在很多的操作系统中都有相应的实现，这也是OpenVPN能够跨平台使用的重要原因。</p>
<p>在OpenVPN中，如果用户访问一个远程的虚拟地址(属于虚拟网卡配用的地址系列，区别于真实的地址)，则操作系统会通过路由机制将数据包(TUN模式)或者数据帧(TAP模式)发送到虚拟网卡上，服务程序接收该数据并进行相应的处理后，会通过socket从外网发送出去，这完成了一个单项传输的过程，反之亦然，当有远程服务程序通过socket从外网上接收到数据并进行相应的处理后，有会发送回给虚拟网卡，该应程序就可以接收到.</p>
<div style="text-align: right;"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label2"></a></div><h2 id="blogTitle2">3.&nbsp;加密和认证方式</h2>
<p>OpenVPN使用OpenSSL库来加密数据与控制信息，这就意味着它能够使用任何的OpenSSL支持的算法，它提供了可选的数据包HMAC功能以提高连接的安全性，此外，OpenSSL的硬件加速也能提高它的性能，在2.3.0以后的版本又引入了PolarSSL</p>
<p>OpenVPN提供了多种的身份验证方式，用来确认连接双方的身份，包括：<br>预享私钥<br>第三方的证书<br>用户名/密码组合<br>预享秘钥最为简单，但同时它只能用于创建点对点的VPN<br>基于PKI的第三方证书提供了最完善的功能，但是需要额外的维护一个PKI证书系统<br>OpenVPN2.0后引入了用户名/密码组合的身份验证方式，它可以省略客户端的证书，但仍然需要一份服务器证书用作加密</p>
<div style="text-align: right;"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label3"></a></div><h2 id="blogTitle3">4.&nbsp;功能与端口</h2>
<p>OpenVPN所有的通信都是基于一个单一的IP端口，默认且推荐使用UDP协议通信，同时也支持TCP,IANA(Internet Assigned Numbers Authority)指定给OpenVPN的官方端口为1194，OpenVPN2.0以后版本每个进程可以同时管理数个并发的隧道，OpenVPN使用通过网络协议(TCP和UDP)的特点使它成为IPsec等协议的理想替代，尤其是ISP(Internet service provider)过滤某些特定VPN协议的情况下.</p>
<p>OpenVPN连接数能通过大多数的代理服务器，并且能够在NAT的环境中很好的工作</p>
<p>服务端具有向客户端"推送"某些网络配置信息的功能，这些信息包:IP地址、路由设置等</p>
<p>OpenVPN提供了两种虚拟网络接口:通过Tun/Tap驱动，通过他们，可以创建三层IP隧道，或者虚拟二层以太网，后者可以传送任何类型的二层以太网网络数据.</p>
<p>传送的数据可以通过LZO算法压缩</p>
<p>OpenVPN与生俱来具备了很多的安全特性:它在用户空间运行，无须对内核及网络协议栈做修改，初始完成后以chroot的方式运行，放弃root的权限，使用mlockall以防止敏感数据交换到磁盘.</p>
<p>OpenVPN通过PKCS#11支持硬件加密标识，如智能卡等</p>
<div style="text-align: right;"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label4"></a></div><h2 id="blogTitle4">5. 配置文件详情</h2>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;7e273260-f30a-4b32-a841-4f9819327628&#39;)"><img id="code_img_closed_7e273260-f30a-4b32-a841-4f9819327628" class="code_img_closed" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/ContractedBlock.gif" alt=""><img id="code_img_opened_7e273260-f30a-4b32-a841-4f9819327628" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;7e273260-f30a-4b32-a841-4f9819327628&#39;,event)" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_7e273260-f30a-4b32-a841-4f9819327628" class="cnblogs_code_hide">
<pre>本文将介绍如何配置OpenVPN服务器端的配置文件。在Windows系统中，该配置文件一般叫做server.ovpn；在Linux/<span style="color: #000000;">BSD系统中，该配置文件一般叫做server.conf。虽然配置文件名称不同，但其中的配置内容与配置方法却是相同的。

本文根据官方提供的server.ovpn示例文件直接翻译得出。Windows、Linux、BSD等系统的服务器端配置文件均可参考本文。
#################################################
# 针对多客户端的OpenVPN </span><span style="color: #800080;">2.0</span><span style="color: #000000;"> 的服务器端配置文件示例
#
# 本文件用于多客户端</span>&lt;-&gt;<span style="color: #000000;">单服务器端的OpenVPN服务器端配置
#
# OpenVPN也支持单机</span>&lt;-&gt;<span style="color: #000000;">单机的配置(更多信息请查看网站上的示例页面)
#
# 该配置支持Windows或者Linux</span>/<span style="color: #000000;">BSD系统。此外，在Windows上，记得将路径加上双引号，
# 并且使用两个反斜杠，例如：</span><span style="color: #800000;">"</span><span style="color: #800000;">C:\\Program Files\\OpenVPN\\config\\foo.key</span><span style="color: #800000;">"</span><span style="color: #000000;">
#
# </span><span style="color: #800000;">'</span><span style="color: #800000;">#</span><span style="color: #800000;">'</span> or <span style="color: #800000;">'</span><span style="color: #800000;">;</span><span style="color: #800000;">'</span><span style="color: #000000;">开头的均为注释内容
#################################################

#OpenVPN应该监听本机的哪些IP地址？
#该命令是可选的，如果不设置，则默认监听本机的所有IP地址。
;local a.b.c.d

# OpenVPN应该监听哪个TCP</span>/<span style="color: #000000;">UDP端口？
# 如果你想在同一台计算机上运行多个OpenVPN实例，你可以使用不同的端口号来区分它们。
# 此外，你需要在防火墙上开放这些端口。
port </span><span style="color: #800080;">1194</span><span style="color: #000000;">

#OpenVPN使用TCP还是UDP协议</span>?<span style="color: #000000;">
;proto tcp
proto udp

# 指定OpenVPN创建的通信隧道类型。
# </span><span style="color: #800000;">"</span><span style="color: #800000;">dev tun</span><span style="color: #800000;">"</span><span style="color: #000000;">将会创建一个路由IP隧道，
# </span><span style="color: #800000;">"</span><span style="color: #800000;">dev tap</span><span style="color: #800000;">"</span><span style="color: #000000;">将会创建一个以太网隧道。
#
# 如果你是以太网桥接模式，并且提前创建了一个名为</span><span style="color: #800000;">"</span><span style="color: #800000;">tap0</span><span style="color: #800000;">"</span>的与以太网接口进行桥接的虚拟接口，则你可以使用<span style="color: #800000;">"</span><span style="color: #800000;">dev tap0</span><span style="color: #800000;">"</span><span style="color: #000000;">
#
# 如果你想控制VPN的访问策略，你必须为TUN</span>/<span style="color: #000000;">TAP接口创建防火墙规则。
#
# 在非Windows系统中，你可以给出明确的单位编号(unit number)，例如</span><span style="color: #800000;">"</span><span style="color: #800000;">tun0</span><span style="color: #800000;">"</span><span style="color: #000000;">。
# 在Windows中，你也可以使用</span><span style="color: #800000;">"</span><span style="color: #800000;">dev-node</span><span style="color: #800000;">"</span><span style="color: #000000;">。
# 在多数系统中，除非你部分禁用或者完全禁用了TUN</span>/<span style="color: #000000;">TAP接口的防火墙，否则VPN将不起作用。
;dev tap
dev tun

# 如果你想配置多个隧道，你需要用到网络连接面板中TAP</span>-Win32适配器的名称(例如<span style="color: #800000;">"</span><span style="color: #800000;">MyTap</span><span style="color: #800000;">"</span><span style="color: #000000;">)。
# 在XP SP2或更高版本的系统中，你可能需要有选择地禁用掉针对TAP适配器的防火墙
# 通常情况下，非Windows系统则不需要该指令。
;dev</span>-<span style="color: #000000;">node MyTap

# 设置SSL</span>/<span style="color: #000000;">TLS根证书(ca)、证书(cert)和私钥(key)。
# 每个客户端和服务器端都需要它们各自的证书和私钥文件。
# 服务器端和所有的客户端都将使用相同的CA证书文件。
#
# 通过easy</span>-<span style="color: #000000;">rsa目录下的一系列脚本可以生成所需的证书和私钥。
# 记住，服务器端和每个客户端的证书必须使用唯一的Common Name。
#
# 你也可以使用遵循X509标准的任何密钥管理系统来生成证书和私钥。
# OpenVPN 也支持使用一个PKCS #12格式的密钥文件(详情查看站点手册页面的</span><span style="color: #800000;">"</span><span style="color: #800000;">pkcs12</span><span style="color: #800000;">"</span><span style="color: #000000;">指令)
ca ca.crt
cert server.crt
key server.key  # 该文件应该保密

# 指定迪菲·赫尔曼参数。
# 你可以使用如下名称命令生成你的参数：
#   openssl dhparam </span>-out dh1024.pem <span style="color: #800080;">1024</span><span style="color: #000000;">
# 如果你使用的是2048位密钥，使用2048替换其中的1024。
dh dh1024.pem

# 设置服务器端模式，并提供一个VPN子网，以便于从中为客户端分配IP地址。
# 在此处的示例中，服务器端自身将占用10.</span><span style="color: #800080;">8.0</span>.<span style="color: #800080;">1</span><span style="color: #000000;">，其他的将提供客户端使用。
# 如果你使用的是以太网桥接模式，请注释掉该行。更多信息请查看官方手册页面。
server </span><span style="color: #800080;">10.8</span>.<span style="color: #800080;">0.0</span> <span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.0</span><span style="color: #000000;">

# 指定用于记录客户端和虚拟IP地址的关联关系的文件。
# 当重启OpenVPN时，再次连接的客户端将分配到与上一次分配相同的虚拟IP地址
</span><span style="color: #0000ff;">ifconfig</span>-pool-<span style="color: #000000;">persist ipp.txt

# 该指令仅针对以太网桥接模式。
# 首先，你必须使用操作系统的桥接能力将以太网网卡接口和TAP接口进行桥接。
# 然后，你需要手动设置桥接接口的IP地址、子网掩码；
# 在这里，我们假设为10.</span><span style="color: #800080;">8.0</span>.4和255.<span style="color: #800080;">255.255</span>.<span style="color: #800080;">0</span><span style="color: #000000;">。
# 最后，我们必须指定子网的一个IP范围(例如从10.</span><span style="color: #800080;">8.0</span>.50开始，到10.<span style="color: #800080;">8.0</span><span style="color: #000000;">.100结束)，以便于分配给连接的客户端。
# 如果你不是以太网桥接模式，直接注释掉这行指令即可。
;server</span>-bridge <span style="color: #800080;">10.8</span>.<span style="color: #800080;">0.4</span> <span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.0</span> <span style="color: #800080;">10.8</span>.<span style="color: #800080;">0.50</span> <span style="color: #800080;">10.8</span>.<span style="color: #800080;">0.100</span><span style="color: #000000;">

# 该指令仅针对使用DHCP代理的以太网桥接模式，
# 此时客户端将请求服务器端的DHCP服务器，从而获得分配给它的IP地址和DNS服务器地址。
#
# 在此之前，你也需要先将以太网网卡接口和TAP接口进行桥接。
# 注意：该指令仅用于OpenVPN客户端，并且该客户端的TAP适配器需要绑定到一个DHCP客户端上。
;server</span>-<span style="color: #000000;">bridge

# 推送路由信息到客户端，以允许客户端能够连接到服务器背后的其他私有子网。
# (简而言之，就是允许客户端访问VPN服务器自身所在的其他局域网)
# 记住，这些私有子网也要将OpenVPN客户端的地址池(</span><span style="color: #800080;">10.8</span>.<span style="color: #800080;">0.0</span>/<span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.0</span><span style="color: #000000;">)反馈回OpenVPN服务器。
;push </span><span style="color: #800000;">"</span><span style="color: #800000;">route 192.168.10.0 255.255.255.0</span><span style="color: #800000;">"</span><span style="color: #000000;">
;push </span><span style="color: #800000;">"</span><span style="color: #800000;">route 192.168.20.0 255.255.255.0</span><span style="color: #800000;">"</span><span style="color: #000000;">


# 当客户端重新启动时，通知客户端可以自动重新连接。
explicit</span>-exit-notify <span style="color: #800080;">1</span><span style="color: #000000;">

# 为指定的客户端分配指定的IP地址，或者客户端背后也有一个私有子网想要访问VPN，
# 那么你可以针对该客户端的配置文件使用ccd子目录。
# (简而言之，就是允许客户端所在的局域网成员也能够访问VPN)

# 举个例子：假设有个Common Name为</span><span style="color: #800000;">"</span><span style="color: #800000;">Thelonious</span><span style="color: #800000;">"</span>的客户端背后也有一个小型子网想要连接到VPN，该子网为192.<span style="color: #800080;">168.40</span>.<span style="color: #800080;">128</span>/<span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.248</span><span style="color: #000000;">。
# 首先，你需要去掉下面两行指令的注释：
;client</span>-config-<span style="color: #0000ff;">dir</span><span style="color: #000000;"> ccd
;route </span><span style="color: #800080;">192.168</span>.<span style="color: #800080;">40.128</span> <span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.248</span><span style="color: #000000;">
# 然后创建一个文件ccd</span>/<span style="color: #000000;">Thelonious，该文件的内容为：
#     iroute </span><span style="color: #800080;">192.168</span>.<span style="color: #800080;">40.128</span> <span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.248</span><span style="color: #000000;">
#这样客户端所在的局域网就可以访问VPN了。
# 注意，这个指令只能在你是基于路由、而不是基于桥接的模式下才能生效。
# 比如，你使用了</span><span style="color: #800000;">"</span><span style="color: #800000;">dev tun</span><span style="color: #800000;">"</span>和<span style="color: #800000;">"</span><span style="color: #800000;">server</span><span style="color: #800000;">"</span><span style="color: #000000;">指令。

# 再举个例子：假设你想给Thelonious分配一个固定的IP地址10.</span><span style="color: #800080;">9.0</span>.<span style="color: #800080;">1</span><span style="color: #000000;">。
# 首先，你需要去掉下面两行指令的注释：
;client</span>-config-<span style="color: #0000ff;">dir</span><span style="color: #000000;"> ccd
;route </span><span style="color: #800080;">10.9</span>.<span style="color: #800080;">0.0</span> <span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.252</span><span style="color: #000000;">
# 然后在文件ccd</span>/<span style="color: #000000;">Thelonious中添加如下指令：
#   </span><span style="color: #0000ff;">ifconfig</span>-push <span style="color: #800080;">10.9</span>.<span style="color: #800080;">0.1</span> <span style="color: #800080;">10.9</span>.<span style="color: #800080;">0.2</span><span style="color: #000000;">

# 如果你想要为不同群组的客户端启用不同的防火墙访问策略，你可以使用如下两种方法：
# (</span><span style="color: #800080;">1</span><span style="color: #000000;">)运行多个OpenVPN守护进程，每个进程对应一个群组，并为每个进程(群组)启用适当的防火墙规则。
# (</span><span style="color: #800080;">2</span><span style="color: #000000;">) (进阶)创建一个脚本来动态地修改响应于来自不同客户的防火墙规则。
# 关于learn</span>-<span style="color: #000000;">address脚本的更多信息请参考官方手册页面。
;learn</span>-address ./<span style="color: #000000;">script

# 如果启用该指令，所有客户端的默认网关都将重定向到VPN，这将导致诸如web浏览器、DNS查询等所有客户端流量都经过VPN。
# (为确保能正常工作，OpenVPN服务器所在计算机可能需要在TUN</span>/<span style="color: #000000;">TAP接口与以太网之间使用NAT或桥接技术进行连接)
;push </span><span style="color: #800000;">"</span><span style="color: #800000;">redirect-gateway def1 bypass-dhcp</span><span style="color: #800000;">"</span><span style="color: #000000;">

# 某些具体的Windows网络设置可以被推送到客户端，例如DNS或WINS服务器地址。
# 下列地址来自opendns.com提供的Public DNS 服务器。
;push </span><span style="color: #800000;">"</span><span style="color: #800000;">dhcp-option DNS 208.67.222.222</span><span style="color: #800000;">"</span><span style="color: #000000;">
;push </span><span style="color: #800000;">"</span><span style="color: #800000;">dhcp-option DNS 208.67.220.220</span><span style="color: #800000;">"</span><span style="color: #000000;">

# 去掉该指令的注释将允许不同的客户端之间相互</span><span style="color: #800000;">"</span><span style="color: #800000;">可见</span><span style="color: #800000;">"</span><span style="color: #000000;">(允许客户端之间互相访问)。
# 默认情况下，客户端只能</span><span style="color: #800000;">"</span><span style="color: #800000;">看见</span><span style="color: #800000;">"</span>服务器。为了确保客户端只能看见服务器，你还可以在服务器端的TUN/<span style="color: #000000;">TAP接口上设置适当的防火墙规则。
;client</span>-to-<span style="color: #000000;">client

# 如果多个客户端可能使用相同的证书</span>/<span style="color: #000000;">私钥文件或Common Name进行连接，那么你可以取消该指令的注释。
# 建议该指令仅用于测试目的。对于生产使用环境而言，每个客户端都应该拥有自己的证书和私钥。
# 如果你没有为每个客户端分别生成Common Name唯一的证书</span>/<span style="color: #000000;">私钥，你可以取消该行的注释(但不推荐这样做)。
;duplicate</span>-<span style="color: #000000;">cn

# keepalive指令将导致类似于ping命令的消息被来回发送，以便于服务器端和客户端知道对方何时被关闭。
# 每10秒钟ping一次，如果120秒内都没有收到对方的回复，则表示远程连接已经关闭。
keepalive </span><span style="color: #800080;">10</span> <span style="color: #800080;">120</span><span style="color: #000000;">

# 出于SSL</span>/TLS之外更多的安全考虑，创建一个<span style="color: #800000;">"</span><span style="color: #800000;">HMAC 防火墙</span><span style="color: #800000;">"</span><span style="color: #000000;">可以帮助抵御DoS攻击和UDP端口淹没攻击。
# 你可以使用以下命令来生成：
#   openvpn </span>--genkey --<span style="color: #000000;">secret ta.key
#
# 服务器和每个客户端都需要拥有该密钥的一个拷贝。
# 第二个参数在服务器端应该为</span><span style="color: #800000;">'</span><span style="color: #800000;">0</span><span style="color: #800000;">'</span>，在客户端应该为<span style="color: #800000;">'</span><span style="color: #800000;">1</span><span style="color: #800000;">'</span><span style="color: #000000;">。
;tls</span>-auth ta.key <span style="color: #800080;">0</span><span style="color: #000000;"> # 该文件应该保密

# 选择一个密码加密算法。
# 该配置项也必须复制到每个客户端配置文件中。
;cipher BF</span>-<span style="color: #000000;">CBC        # Blowfish (默认)
;cipher AES</span>-<span style="color: #800080;">128</span>-<span style="color: #000000;">CBC   # AES
;cipher DES</span>-EDE3-CBC  # Triple-<span style="color: #000000;">DES

# 在VPN连接上启用压缩。
# 如果你在此处启用了该指令，那么也应该在每个客户端配置文件中启用它。
comp</span>-<span style="color: #000000;">lzo

# 允许并发连接的客户端的最大数量
;max</span>-clients <span style="color: #800080;">100</span><span style="color: #000000;">

# 在完成初始化工作之后，降低OpenVPN守护进程的权限是个不错的主意。
# 该指令仅限于非Windows系统中使用。
;user nobody
;group nobody

# 持久化选项可以尽量避免访问那些在重启之后由于用户权限降低而无法访问的某些资源。
persist</span>-<span style="color: #000000;">key
persist</span>-<span style="color: #000000;">tun

# 输出一个简短的状态文件，用于显示当前的连接状态，该文件每分钟都会清空并重写一次。
status openvpn</span>-<span style="color: #000000;">status.log

# 默认情况下，日志消息将写入syslog(在Windows系统中，如果以服务方式运行，日志消息将写入OpenVPN安装目录的log文件夹中)。
# 你可以使用log或者log</span>-<span style="color: #000000;">append来改变这种默认情况。
# </span><span style="color: #800000;">"</span><span style="color: #800000;">log</span><span style="color: #800000;">"</span><span style="color: #000000;">方式在每次启动时都会清空之前的日志文件。
# </span><span style="color: #800000;">"</span><span style="color: #800000;">log-append</span><span style="color: #800000;">"</span><span style="color: #000000;">这是在之前的日志内容后进行追加。
# 你可以使用两种方式之一(但不要同时使用)。
;log         openvpn.log
;log</span>-<span style="color: #000000;">append  openvpn.log

# 为日志文件设置适当的冗余级别(</span><span style="color: #800080;">0</span>~<span style="color: #800080;">9</span><span style="color: #000000;">)。冗余级别越高，输出的信息越详细。
#
# </span><span style="color: #800080;">0</span><span style="color: #000000;"> 表示静默运行，只记录致命错误。
# </span><span style="color: #800080;">4</span><span style="color: #000000;"> 表示合理的常规用法。
# </span><span style="color: #800080;">5</span> 和 <span style="color: #800080;">6</span><span style="color: #000000;"> 可以帮助调试连接错误。
# </span><span style="color: #800080;">9</span><span style="color: #000000;"> 表示极度冗余，输出非常详细的日志信息。
verb </span><span style="color: #800080;">3</span><span style="color: #000000;">

# 重复信息的沉默度。
# 相同类别的信息只有前20条会输出到日志文件中。
;mute </span><span style="color: #800080;">20</span></pre>
</div>
<span class="cnblogs_code_collapse">服务端配置文件详情</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;0d8e58a1-6676-4fd3-81e3-4532958a1c94&#39;)"><img id="code_img_closed_0d8e58a1-6676-4fd3-81e3-4532958a1c94" class="code_img_closed" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/ContractedBlock.gif" alt=""><img id="code_img_opened_0d8e58a1-6676-4fd3-81e3-4532958a1c94" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;0d8e58a1-6676-4fd3-81e3-4532958a1c94&#39;,event)" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_0d8e58a1-6676-4fd3-81e3-4532958a1c94" class="cnblogs_code_hide">
<pre><span style="color: #000000;">##############################################
# 针对多个客户端的OpenVPN </span><span style="color: #800080;">2.0</span><span style="color: #000000;"> 的客户端配置文件示例
#
# 该配置文件可以被多个客户端使用，当然每个客户端都应该有自己的证书和密钥文件
#
# 在Windows上此配置文件的后缀应该是</span><span style="color: #800000;">"</span><span style="color: #800000;">.ovpn</span><span style="color: #800000;">"</span>，在Linux/BSD系统中则是<span style="color: #800000;">"</span><span style="color: #800000;">.conf</span><span style="color: #800000;">"</span><span style="color: #000000;">
##############################################

# 指定这是一个客户端，将从服务器上获取某些配置文件指令
client


# 指定OpenVPN创建的通信隧道类型。
# </span><span style="color: #800000;">"</span><span style="color: #800000;">dev tun</span><span style="color: #800000;">"</span><span style="color: #000000;">将会创建一个路由IP隧道，
# </span><span style="color: #800000;">"</span><span style="color: #800000;">dev tap</span><span style="color: #800000;">"</span><span style="color: #000000;">将会创建一个以太网隧道。
# 如果你是以太网桥接模式，并且提前创建了一个名为</span><span style="color: #800000;">"</span><span style="color: #800000;">tap0</span><span style="color: #800000;">"</span>的与以太网接口进行桥接的虚拟接口，则你可以使用<span style="color: #800000;">"</span><span style="color: #800000;">dev tap0</span><span style="color: #800000;">"</span><span style="color: #000000;">
# 如果你想控制VPN的访问策略，你必须为TUN</span>/<span style="color: #000000;">TAP接口创建防火墙规则。
# 在非Windows系统中，你可以给出明确的单位编号(unit number)，例如</span><span style="color: #800000;">"</span><span style="color: #800000;">tun0</span><span style="color: #800000;">"</span><span style="color: #000000;">。
# 在Windows中，你也可以使用</span><span style="color: #800000;">"</span><span style="color: #800000;">dev-node</span><span style="color: #800000;">"</span><span style="color: #000000;">。
# 在多数系统中，除非你部分禁用或者完全禁用了TUN</span>/<span style="color: #000000;">TAP接口的防火墙，否则VPN将不起作用
;dev tap
dev tun

# 在Windows系统中，如果你想配置多个隧道，则需要该指令。
# 你需要用到网络连接面板中TAP</span>-Win32适配器的名称(例如<span style="color: #800000;">"</span><span style="color: #800000;">MyTap</span><span style="color: #800000;">"</span><span style="color: #000000;">)。
# 在XP SP2或更高版本的系统中，你可能需要禁用掉针对TAP适配器的防火墙。
;dev</span>-<span style="color: #000000;">node MyTap

# 指定连接的服务器是采用TCP还是UDP协议。
# 这里需要使用与服务器端相同的设置。
proto tcp
;proto udp

# 指定服务端的主机名或者IP以及端口
# 如果有多个VPN服务器，为了实现负载均衡，可以设置多个remote指令
remote </span><span style="color: #800080;">192.168</span>.<span style="color: #800080;">188.129</span> <span style="color: #800080;">1194</span><span style="color: #000000;">
;remote my</span>-server-<span style="color: #800080;">2</span> <span style="color: #800080;">1194</span><span style="color: #000000;">

# 如果开启多个remote指令，启动该指令将随机连接其中的一台服务器
# 否则，客户端将按照指定的先后顺序依次尝试连接
;remote</span>-<span style="color: #000000;">random

# 启用该指令，与服务器连接中断后将自动重新连接，这在网络不稳定的情况下(例如：笔记本电脑无线网络)非常有用。
resolv</span>-<span style="color: #000000;">retry infinite

# 大多数客户端不需要绑定本机特定的端口号
nobind

# 在初始化完毕后，降低OpenVPN的权限(该指令仅限于非Windows系统中使用)
;user nobody
;group nobody

# 持久化选项可以尽量避免访问在重启时由于用户权限降低而无法访问的某些资源
persist</span>-<span style="color: #000000;">key
persist</span>-<span style="color: #000000;">tun

# 如果你是通过HTTP代理方式来连接到实际的VPN服务器，请在此处指定代理服务器的主机名(或IP)和端口号。
# 如果你的代理服务器需要身份认证，请参考官方手册页面
;http</span>-proxy-<span style="color: #000000;">retry # 如果失败将重试
;http</span>-<span style="color: #000000;">proxy [proxy server] [proxy port #]

# 无线网络通常会产生大量的重复数据包。设置此标识将忽略掉重复数据包的警告信息
;mute</span>-replay-<span style="color: #000000;">warnings

# SSL</span>/<span style="color: #000000;">TLS 参数配置。
# 更多描述信息请参考服务器端配置文件。
# 最好为每个客户端单独分配.crt</span>/<span style="color: #000000;">.key文件对。
# 单个CA证书可以供所有客户端使用。
ca ca.crt
cert client.crt
key client.key

# 指定采用服务器校验方式
remote</span>-cert-<span style="color: #000000;">tls server

# 如果服务器端使用了tls</span>-<span style="color: #000000;">auth密钥，那么每个客户端也都应该有该密钥。
tls</span>-auth ta.key <span style="color: #800080;">1</span><span style="color: #000000;">

# 指定密码的加密算法。
# 如果服务器端启用了cipher指令选项，那么你必须也在这里指定它
cipher AES</span>-<span style="color: #800080;">256</span>-<span style="color: #000000;">CBC

# 在VPN连接中启用压缩。
# 该指令的启用</span>/<span style="color: #000000;">禁用应该与服务器端保持一致。
comp</span>-<span style="color: #000000;">lzo

# 设置日志文件冗余级别(</span><span style="color: #800080;">0</span>~<span style="color: #800080;">9</span><span style="color: #000000;">)。
# </span><span style="color: #800080;">0</span><span style="color: #000000;"> 表示静默运行，只记录致命错误。
# </span><span style="color: #800080;">4</span><span style="color: #000000;"> 表示合理的常规用法。
# </span><span style="color: #800080;">5</span> 和 <span style="color: #800080;">6</span><span style="color: #000000;"> 可以帮助调试连接错误。
# </span><span style="color: #800080;">9</span><span style="color: #000000;"> 表示极度冗余，输出非常详细的日志信息
verb </span><span style="color: #800080;">3</span><span style="color: #000000;">

# 忽略过多的重复信息。
# 相同类别的信息只有前20条会输出到日志文件中。
;mute </span><span style="color: #800080;">20</span></pre>
</div>
<span class="cnblogs_code_collapse">客户端配置文件详情</span></div>
<div style="text-align: right;"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label5"></a></div><h2 id="blogTitle5">6. 用户名密码验证服务器端安装配置</h2>
<p><span style="background-color: #ff6600;">温馨提示</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_887273" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">主机环境：</code></div><div class="line number2 index1 alt1"><code class="bash plain">一台centos7的主机</code></div><div class="line number3 index2 alt2"><code class="bash plain">主机名:manager</code></div><div class="line number4 index3 alt1"><code class="bash plain">外网IP：192.168.1.170</code></div><div class="line number5 index4 alt2"><code class="bash plain">内网IP：192.168.20.12</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">安装我们要使用的包</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_432358" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># yum -y install epel-release</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># yum -y install openvpn unzip wget lrzsz</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">下载openvpn</span> (<a href="https://github.com/OpenVPN/easy-rsa/" target="_blank">github</a>)<br><span style="background-color: #99ccff;">并解压</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_444706" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># mkdir openvpn</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># cd openvpn/</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@manager openvpn]</code><code class="bash comments"># wget https://github.com/OpenVPN/easy-rsa/archive/v3.0.6.zip</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@manager openvpn]</code><code class="bash comments"># ll</code></div><div class="line number5 index4 alt2"><code class="bash plain">total 640</code></div><div class="line number6 index5 alt1"><code class="bash plain">-rw-r--r--. 1 root root 653578 Nov&nbsp; 4 03:59 v3.0.6.zip</code></div><div class="line number7 index6 alt2"><code class="bash plain">[root@manager openvpn]</code><code class="bash comments"># unzip v3.0.6.zip</code></div><div class="line number8 index7 alt1"><code class="bash plain">[root@manager openvpn]</code><code class="bash comments"># mv easy-rsa-3.0.6/ easy-rsa</code></div><div class="line number9 index8 alt2"><code class="bash plain">[root@manager openvpn]</code><code class="bash comments"># ll</code></div><div class="line number10 index9 alt1"><code class="bash plain">total 640</code></div><div class="line number11 index10 alt2"><code class="bash plain">drwxr-xr-x. 8 root root&nbsp;&nbsp;&nbsp; 252 Oct&nbsp; 4 18:43 easy-rsa</code></div><div class="line number12 index11 alt1"><code class="bash plain">-rw-r--r--. 1 root root 653578 Nov&nbsp; 4 03:59 v3.0.6.zip</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">在/etc/下创建openvpn的目录，并拷贝</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_180503" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager openvpn]</code><code class="bash comments"># mkdir -p /etc/openvpn</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager openvpn]</code><code class="bash comments"># cp -a easy-rsa/ /etc/openvpn/</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@manager openvpn]</code><code class="bash comments"># cd /etc/openvpn/easy-rsa/easyrsa3/</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># cp vars.example vars</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">配置，编辑vars文件，根据自己的环境配置</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_481321" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># cat vars | grep set_var | grep -vE '#set_var|# '</code></div><div class="line number2 index1 alt1"><code class="bash plain">set_var EASYRSA_REQ_COUNTRY&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash string">"CN"</code></div><div class="line number3 index2 alt2"><code class="bash plain">set_var EASYRSA_REQ_PROVINCE&nbsp;&nbsp;&nbsp; </code><code class="bash string">"BJ"</code></div><div class="line number4 index3 alt1"><code class="bash plain">set_var EASYRSA_REQ_CITY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash string">"BEIJING"</code></div><div class="line number5 index4 alt2"><code class="bash plain">set_var EASYRSA_REQ_ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash string">"YXJY"</code></div><div class="line number6 index5 alt1"><code class="bash plain">set_var EASYRSA_REQ_EMAIL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash string">"brian@@qq.com"</code></div><div class="line number7 index6 alt2"><code class="bash plain">set_var EASYRSA_REQ_OU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash string">"YUEXINJIAOYU"</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">初始化</span>　　</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_307973" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># ./easyrsa init-pki</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="bash plain">Note: using Easy-RSA configuration from: .</code><code class="bash plain">/vars</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="bash plain">init-pki complete; you may now create a CA or requests.</code></div><div class="line number6 index5 alt1"><code class="bash plain">Your newly created PKI </code><code class="bash functions">dir</code> <code class="bash plain">is: </code><code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">创建根证书</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_120572" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># ./easyrsa build-ca</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="bash plain">Note: using Easy-RSA configuration from: .</code><code class="bash plain">/vars</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="bash plain">Using SSL: openssl OpenSSL 1.0.2k-fips&nbsp; 26 Jan 2017</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="bash comments"># 这里要输入两次密码，密码自定义(一定不能忘)</code></div><div class="line number8 index7 alt1"><code class="bash plain">Enter New CA Key Passphrase: </code></div><div class="line number9 index8 alt2"><code class="bash plain">Re-Enter New CA Key Passphrase: </code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="bash plain">Generating RSA private key, 2048 bit long modulus</code></div><div class="line number12 index11 alt1"><code class="bash plain">.........................................................................................+++</code></div><div class="line number13 index12 alt2"><code class="bash plain">..........................................................+++</code></div><div class="line number14 index13 alt1"><code class="bash plain">e is 65537 (0x10001)</code></div><div class="line number15 index14 alt2"><code class="bash plain">You are about to be asked to enter information that will be incorporated</code></div><div class="line number16 index15 alt1"><code class="bash plain">into your certificate request.</code></div><div class="line number17 index16 alt2"><code class="bash plain">What you are about to enter is what is called a Distinguished Name or a DN.</code></div><div class="line number18 index17 alt1"><code class="bash plain">There are quite a few fields but you can leave some blank</code></div><div class="line number19 index18 alt2"><code class="bash plain">For some fields there will be a default value,</code></div><div class="line number20 index19 alt1"><code class="bash plain">If you enter </code><code class="bash string">'.'</code><code class="bash plain">, the field will be left blank.</code></div><div class="line number21 index20 alt2"><code class="bash plain">-----</code></div><div class="line number22 index21 alt1"><code class="bash comments"># 输入一个通用名(唯一)</code></div><div class="line number23 index22 alt2"><code class="bash plain">Common Name (eg: your user, host, or server name) [Easy-RSA CA]:yxjy</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="bash plain">CA creation complete and you may now </code><code class="bash functions">import</code> <code class="bash plain">and sign cert requests.</code></div><div class="line number26 index25 alt1"><code class="bash plain">Your new CA certificate </code><code class="bash functions">file</code> <code class="bash keyword">for</code> <code class="bash plain">publishing is at:</code></div><div class="line number27 index26 alt2"><code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/ca</code><code class="bash plain">.crt</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">创建服务器端证书</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_322383" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># ./easyrsa gen-req server nopass</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="bash plain">Note: using Easy-RSA configuration from: .</code><code class="bash plain">/vars</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="bash plain">Using SSL: openssl OpenSSL 1.0.2k-fips&nbsp; 26 Jan 2017</code></div><div class="line number6 index5 alt1"><code class="bash plain">Generating a 2048 bit RSA private key</code></div><div class="line number7 index6 alt2"><code class="bash plain">....................+++</code></div><div class="line number8 index7 alt1"><code class="bash plain">....+++</code></div><div class="line number9 index8 alt2"><code class="bash plain">writing new private key to </code><code class="bash string">'/etc/openvpn/easy-rsa/easyrsa3/pki/private/server.key.8wvYsw415K'</code></div><div class="line number10 index9 alt1"><code class="bash plain">-----</code></div><div class="line number11 index10 alt2"><code class="bash plain">You are about to be asked to enter information that will be incorporated</code></div><div class="line number12 index11 alt1"><code class="bash plain">into your certificate request.</code></div><div class="line number13 index12 alt2"><code class="bash plain">What you are about to enter is what is called a Distinguished Name or a DN.</code></div><div class="line number14 index13 alt1"><code class="bash plain">There are quite a few fields but you can leave some blank</code></div><div class="line number15 index14 alt2"><code class="bash plain">For some fields there will be a default value,</code></div><div class="line number16 index15 alt1"><code class="bash plain">If you enter </code><code class="bash string">'.'</code><code class="bash plain">, the field will be left blank.</code></div><div class="line number17 index16 alt2"><code class="bash plain">-----</code></div><div class="line number18 index17 alt1"><code class="bash comments"># 一个通用名(唯一)</code></div><div class="line number19 index18 alt2"><code class="bash plain">Common Name (eg: your user, host, or server name) [server]:brian</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="bash plain">Keypair and certificate request completed. Your files are:</code></div><div class="line number22 index21 alt1"><code class="bash plain">req: </code><code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/reqs/server</code><code class="bash plain">.req</code></div><div class="line number23 index22 alt2"><code class="bash plain">key: </code><code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/private/server</code><code class="bash plain">.key</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">签约服务端证书</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_333762" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># ./easyrsa sign server server</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="bash plain">Note: using Easy-RSA configuration from: .</code><code class="bash plain">/vars</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="bash plain">Using SSL: openssl OpenSSL 1.0.2k-fips&nbsp; 26 Jan 2017</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="bash plain">You are about to sign the following certificate.</code></div><div class="line number9 index8 alt2"><code class="bash plain">Please check over the details shown below </code><code class="bash keyword">for</code> <code class="bash plain">accuracy. Note that this request</code></div><div class="line number10 index9 alt1"><code class="bash plain">has not been cryptographically verified. Please be sure it came from a trusted</code></div><div class="line number11 index10 alt2"><code class="bash functions">source</code> <code class="bash plain">or that you have verified the request checksum with the sender.</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="bash plain">Request subject, to be signed as a server certificate </code><code class="bash keyword">for</code> <code class="bash plain">1080 days:</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="bash plain">subject=</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">commonName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = brian</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="bash comments"># 这里输入yes即可</code></div><div class="line number20 index19 alt1"><code class="bash plain">Type the word </code><code class="bash string">'yes'</code> <code class="bash plain">to </code><code class="bash keyword">continue</code><code class="bash plain">, or any other input to abort.</code></div><div class="line number21 index20 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash plain">Confirm request details: </code><code class="bash functions">yes</code></div><div class="line number22 index21 alt1"><code class="bash plain">Using configuration from </code><code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/safessl-easyrsa</code><code class="bash plain">.cnf</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="bash comments"># 这里要输入上面一开始的密码</code></div><div class="line number25 index24 alt2"><code class="bash plain">Enter pass phrase </code><code class="bash keyword">for</code> <code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/private/ca</code><code class="bash plain">.key:</code></div><div class="line number26 index25 alt1"><code class="bash plain">Check that the request matches the signature</code></div><div class="line number27 index26 alt2"><code class="bash plain">Signature ok</code></div><div class="line number28 index27 alt1"><code class="bash plain">The Subject's Distinguished Name is as follows</code></div><div class="line number29 index28 alt2"><code class="bash plain">commonName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :ASN.1 12:</code><code class="bash string">'brian'</code></div><div class="line number30 index29 alt1"><code class="bash plain">Certificate is to be certified </code><code class="bash keyword">until</code> <code class="bash plain">Oct 19 09:08:51 2021 GMT (1080 days)</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="bash plain">Write out database with 1 new entries</code></div><div class="line number33 index32 alt2"><code class="bash plain">Data Base Updated</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="bash plain">Certificate created at: </code><code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/issued/server</code><code class="bash plain">.crt</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">创建Diffie-Hellman，确保key穿越不安全网络的命令</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_312158" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># ./easyrsa gen-dh</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="bash plain">Note: using Easy-RSA configuration from: .</code><code class="bash plain">/vars</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="bash plain">Using SSL: openssl OpenSSL 1.0.2k-fips&nbsp; 26 Jan 2017</code></div><div class="line number6 index5 alt1"><code class="bash plain">Generating DH parameters, 2048 bit long safe prime, generator 2</code></div><div class="line number7 index6 alt2"><code class="bash plain">This is going to take a long </code><code class="bash functions">time</code></div><div class="line number8 index7 alt1"><code class="bash plain">.................................................................................+</code></div><div class="line number9 index8 alt2"><code class="bash plain">..................................................................+............................</code></div><div class="line number10 index9 alt1"><code class="bash plain">..............+........................+.......................................................</code></div><div class="line number11 index10 alt2"><code class="bash plain">...........................................+.</code></div><div class="line number12 index11 alt1"><code class="bash plain">DH parameters of size 2048 created at </code><code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/dh</code><code class="bash plain">.pem</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">将证书key文件统一到一个文件夹</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_874434" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># mkdir /etc/openvpn/ca</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># cp /etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt /etc/openvpn/ca/</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># cp /etc/openvpn/easy-rsa/easyrsa3/pki/private/server.key /etc/openvpn/ca/</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># cp /etc/openvpn/easy-rsa/easyrsa3/pki/issued/server.crt /etc/openvpn/ca/</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># cp /etc/openvpn/easy-rsa/easyrsa3/pki/dh.pem /etc/openvpn/ca/</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># cd /etc/openvpn/ca/</code></div><div class="line number7 index6 alt2"><code class="bash plain">[root@manager ca]</code><code class="bash comments"># ls</code></div><div class="line number8 index7 alt1"><code class="bash plain">ca.crt&nbsp; dh.pem&nbsp; server.crt&nbsp; server.key</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">创建配置文件目录并配置配置文件</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_541927" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager ca]</code><code class="bash comments"># mkdir /etc/openvpn/config</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager ca]</code><code class="bash comments"># cd /etc/openvpn/config/</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># rpm -ql openvpn |grep server.conf</code></div><div class="line number4 index3 alt1"><code class="bash plain">/usr/share/doc/openvpn-2</code><code class="bash plain">.4.6</code><code class="bash plain">/sample/sample-config-files/roadwarrior-server</code><code class="bash plain">.conf</code></div><div class="line number5 index4 alt2"><code class="bash plain">/usr/share/doc/openvpn-2</code><code class="bash plain">.4.6</code><code class="bash plain">/sample/sample-config-files/server</code><code class="bash plain">.conf</code></div><div class="line number6 index5 alt1"><code class="bash plain">/usr/share/doc/openvpn-2</code><code class="bash plain">.4.6</code><code class="bash plain">/sample/sample-config-files/xinetd-server-config</code></div><div class="line number7 index6 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># cp /usr/share/doc/openvpn-2.4.6/sample/sample-config-files/server.conf .</code></div><div class="line number8 index7 alt1"><code class="bash plain">[root@manager config]</code><code class="bash comments"># ls</code></div><div class="line number9 index8 alt2"><code class="bash plain">server.conf</code></div><div class="line number10 index9 alt1"><code class="bash plain">[root@manager config]</code><code class="bash comments"># grep '^[^#|;]' /etc/openvpn/config/server.conf&nbsp; &gt;&gt; server1.conf</code></div><div class="line number11 index10 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># mv server.conf server.conf.bak</code></div><div class="line number12 index11 alt1"><code class="bash plain">[root@manager config]</code><code class="bash comments"># mv server1.conf server.conf</code></div><div class="line number13 index12 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># ll</code></div><div class="line number14 index13 alt1"><code class="bash plain">total 16</code></div><div class="line number15 index14 alt2"><code class="bash plain">-rw-r--r--. 1 root root&nbsp;&nbsp; 334 Nov&nbsp; 4 04:25 server.conf</code></div><div class="line number16 index15 alt1"><code class="bash plain">-rw-r--r--. 1 root root 10784 Nov&nbsp; 4 04:26 server.conf.bak</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">在用用户名密码验证的时候我们需要一个用户名密码验证的脚本这个脚本的名字是checkpsw.sh</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_484248" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># cd /etc/openvpn/sh/</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager sh]</code><code class="bash comments"># cat checkpsw.sh </code></div><div class="line number3 index2 alt2"><code class="bash preprocessor bold">#!/bin/sh</code></div><div class="line number4 index3 alt1"><code class="bash comments">###########################################################</code></div><div class="line number5 index4 alt2"><code class="bash comments"># checkpsw.sh (C) 2004 Mathias Sundman &lt;mathias@openvpn.se&gt;</code></div><div class="line number6 index5 alt1"><code class="bash comments">#</code></div><div class="line number7 index6 alt2"><code class="bash comments"># This script will authenticate OpenVPN users against</code></div><div class="line number8 index7 alt1"><code class="bash comments"># a plain text file. The passfile should simply contain</code></div><div class="line number9 index8 alt2"><code class="bash comments"># one row per user with the username first followed by</code></div><div class="line number10 index9 alt1"><code class="bash comments"># one or more space(s) or tab(s) and then the password.</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="bash comments"># 这里根据自己的情况修改路径</code></div><div class="line number13 index12 alt2"><code class="bash comments"># 存放用户名密码的文件</code></div><div class="line number14 index13 alt1"><code class="bash plain">PASSFILE=</code><code class="bash string">"/etc/openvpn/config/psw-file"</code></div><div class="line number15 index14 alt2"><code class="bash comments"># 日志文件</code></div><div class="line number16 index15 alt1"><code class="bash plain">LOG_FILE=</code><code class="bash string">"/etc/openvpn/config/openvpn-password.log"</code></div><div class="line number17 index16 alt2"><code class="bash plain">TIME_STAMP=`</code><code class="bash functions">date</code> <code class="bash string">"+%Y-%m-%d %T"</code><code class="bash plain">`</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="bash comments">###########################################################</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="bash keyword">if</code> <code class="bash plain">[ ! -r </code><code class="bash string">"${PASSFILE}"</code> <code class="bash plain">]; </code><code class="bash keyword">then</code></div><div class="line number22 index21 alt1"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">echo</code> <code class="bash string">"${TIME_STAMP}: Could not open password file \"${PASSFILE}\" for reading."</code> <code class="bash plain">&gt;&gt; ${LOG_FILE}</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">exit</code> <code class="bash plain">1</code></div><div class="line number24 index23 alt1"><code class="bash keyword">fi</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="bash plain">CORRECT_PASSWORD=`</code><code class="bash functions">awk</code> <code class="bash string">'!/^;/&amp;&amp;!/^#/&amp;&amp;$1=="'</code><code class="bash plain">${username}</code><code class="bash string">'"{print $2;exit}'</code> <code class="bash plain">${PASSFILE}`</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="bash keyword">if</code> <code class="bash plain">[ </code><code class="bash string">"${CORRECT_PASSWORD}"</code> <code class="bash plain">= </code><code class="bash string">""</code> <code class="bash plain">]; </code><code class="bash keyword">then</code></div><div class="line number29 index28 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">echo</code> <code class="bash string">"${TIME_STAMP}: User does not exist: username=\"${username}\", password=\"${password}\"."</code> <code class="bash plain">&gt;&gt; ${LOG_FILE}</code></div><div class="line number30 index29 alt1"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">exit</code> <code class="bash plain">1</code></div><div class="line number31 index30 alt2"><code class="bash keyword">fi</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="bash keyword">if</code> <code class="bash plain">[ </code><code class="bash string">"${password}"</code> <code class="bash plain">= </code><code class="bash string">"${CORRECT_PASSWORD}"</code> <code class="bash plain">]; </code><code class="bash keyword">then</code></div><div class="line number34 index33 alt1"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">echo</code> <code class="bash string">"${TIME_STAMP}: Successful authentication: username=\"${username}\"."</code> <code class="bash plain">&gt;&gt; ${LOG_FILE}</code></div><div class="line number35 index34 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">exit</code> <code class="bash plain">0</code></div><div class="line number36 index35 alt1"><code class="bash keyword">fi</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="bash functions">echo</code> <code class="bash string">"${TIME_STAMP}: Incorrect password: username=\"${username}\", password=\"${password}\"."</code> <code class="bash plain">&gt;&gt; ${LOG_FILE}</code></div><div class="line number39 index38 alt2"><code class="bash functions">exit</code> <code class="bash plain">1</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">创建用户名密码文件 psw-file</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_323553" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># cd /etc/openvpn/config/</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager config]</code><code class="bash comments"># ls</code></div><div class="line number3 index2 alt2"><code class="bash plain">openvpn-password.log&nbsp; psw-</code><code class="bash functions">file</code>&nbsp; <code class="bash plain">server.conf&nbsp; server.conf.bak</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@manager config]</code><code class="bash comments"># cat psw-file </code></div><div class="line number5 index4 alt2"><code class="bash plain">zjz&nbsp;&nbsp;&nbsp; 123.com　　</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">编辑服务端配置文件</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_414368" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># cat server.conf</code></div><div class="line number2 index1 alt1"><code class="bash comments"># 监听地址</code></div><div class="line number3 index2 alt2"><code class="bash functions">local</code> <code class="bash plain">0.0.0.0</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="bash comments"># openvpn监听的端口(默认1194)</code></div><div class="line number6 index5 alt1"><code class="bash plain">port 1194</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="bash comments"># 采用TCP/UDP协议(默认udp)</code></div><div class="line number9 index8 alt2"><code class="bash plain">proto udp</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="bash comments"># 创建openvpn的通信隧道类型(默认tun)</code></div><div class="line number12 index11 alt1"><code class="bash comments"># "dev tun"将会创建一个路由IP隧道，</code></div><div class="line number13 index12 alt2"><code class="bash comments"># "dev tap"将会创建一个以太网隧道。</code></div><div class="line number14 index13 alt1"><code class="bash plain">dev tun</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number16 index15 alt1"><code class="bash comments"># 设置SSL/TLS根证书(ca)、证书(cert)和私钥(key)。</code></div><div class="line number17 index16 alt2"><code class="bash plain">ca&nbsp;&nbsp;&nbsp; </code><code class="bash plain">/etc/openvpn/ca/ca</code><code class="bash plain">.crt</code></div><div class="line number18 index17 alt1"><code class="bash plain">cert </code><code class="bash plain">/etc/openvpn/ca/server</code><code class="bash plain">.crt</code></div><div class="line number19 index18 alt2"><code class="bash plain">key </code><code class="bash plain">/etc/openvpn/ca/server</code><code class="bash plain">.key&nbsp; </code><code class="bash comments"># 这个文件应该保密</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number21 index20 alt2"><code class="bash comments"># 指定迪菲·赫尔曼参数</code></div><div class="line number22 index21 alt1"><code class="bash plain">dh </code><code class="bash plain">/etc/openvpn/ca/dh</code><code class="bash plain">.pem</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number24 index23 alt1"><code class="bash comments"># 设置服务器端模式，并提供一个VPN子网，以便于从中为客户端分配IP地址</code></div><div class="line number25 index24 alt2"><code class="bash plain">server 10.8.0.0 255.255.255.0</code></div><div class="line number26 index25 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number27 index26 alt2"><code class="bash comments"># 如果启用该指令，所有客户端的默认网关都将重定向到VPN，这将导致诸如web浏览器、DNS查询等所有客户端流量都经过VPN</code></div><div class="line number28 index27 alt1"><code class="bash plain">push </code><code class="bash string">"redirect-gateway def1 bypass-dhcp"</code></div><div class="line number29 index28 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number30 index29 alt1"><code class="bash comments"># 指定DNS</code></div><div class="line number31 index30 alt2"><code class="bash plain">push </code><code class="bash string">"dhcp-option DNS 8.8.8.8"</code></div><div class="line number32 index31 alt1"><code class="bash plain">push </code><code class="bash string">"dhcp-option DNS 114.114.114.114"</code></div><div class="line number33 index32 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number34 index33 alt1"><code class="bash comments"># 客户端之间互相通信</code></div><div class="line number35 index34 alt2"><code class="bash plain">client-to-client </code></div><div class="line number36 index35 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number37 index36 alt2"><code class="bash comments"># 传输数据压缩</code></div><div class="line number38 index37 alt1"><code class="bash plain">comp-lzo</code></div><div class="line number39 index38 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number40 index39 alt1"><code class="bash comments"># 最多允许 20 客户端连接</code></div><div class="line number41 index40 alt2"><code class="bash plain">max-clients 20</code></div><div class="line number42 index41 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number43 index42 alt2"><code class="bash comments"># 用户和用户组</code></div><div class="line number44 index43 alt1"><code class="bash plain">user openvpn</code></div><div class="line number45 index44 alt2"><code class="bash plain">group openvpn</code></div><div class="line number46 index45 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number47 index46 alt2"><code class="bash comments"># 指定用于记录客户端和虚拟IP地址的关联关系的文件</code></div><div class="line number48 index47 alt1"><code class="bash functions">ifconfig</code><code class="bash plain">-pool-persist ipp.txt</code></div><div class="line number49 index48 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number50 index49 alt1"><code class="bash comments"># 连接关闭时间</code></div><div class="line number51 index50 alt2"><code class="bash plain">keepalive 10 120</code></div><div class="line number52 index51 alt1">&nbsp;</div><div class="line number53 index52 alt2">&nbsp;</div><div class="line number54 index53 alt1"><code class="bash comments"># 用户名密码验证</code></div><div class="line number55 index54 alt2"><code class="bash plain">script-security 3</code></div><div class="line number56 index55 alt1"><code class="bash plain">auth-user-pass-verify </code><code class="bash plain">/etc/openvpn/sh/checkpsw</code><code class="bash plain">.sh via-</code><code class="bash functions">env</code></div><div class="line number57 index56 alt2"><code class="bash plain">username-as-common-name</code></div><div class="line number58 index57 alt1"><code class="bash plain">verify-client-cert none</code></div><div class="line number59 index58 alt2">&nbsp;</div><div class="line number60 index59 alt1">&nbsp;</div><div class="line number61 index60 alt2"><code class="bash comments"># 选择一种加密算法</code></div><div class="line number62 index61 alt1"><code class="bash plain">cipher AES-256-CBC</code></div><div class="line number63 index62 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number64 index63 alt1"><code class="bash comments"># 持久化选项可以尽量避免访问那些在重启之后由于用户权限降低而无法访问的某些资源</code></div><div class="line number65 index64 alt2"><code class="bash plain">persist-key</code></div><div class="line number66 index65 alt1"><code class="bash plain">persist-tun</code></div><div class="line number67 index66 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number68 index67 alt1"><code class="bash comments"># 输出一个简短的状态文件，用于显示当前的连接状态，该文件每分钟都会清空并重写一次</code></div><div class="line number69 index68 alt2"><code class="bash plain">status </code><code class="bash plain">/var/log/openvpn/openvpn-status</code><code class="bash plain">.log</code></div><div class="line number70 index69 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number71 index70 alt2"><code class="bash comments"># 默认情况下，日志消息将写入syslog中</code></div><div class="line number72 index71 alt1"><code class="bash comments"># "log"方式在每次启动时都会清空之前的日志文件</code></div><div class="line number73 index72 alt2"><code class="bash plain">log&nbsp;&nbsp; </code><code class="bash plain">/var/log/openvpn/openvpn</code><code class="bash plain">.log</code></div><div class="line number74 index73 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number75 index74 alt2"><code class="bash comments"># 为日志文件设置适当的冗余级别(0~9)。冗余级别越高，输出的信息越详细</code></div><div class="line number76 index75 alt1"><code class="bash plain">verb 3</code></div><div class="line number77 index76 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number78 index77 alt1"><code class="bash comments"># 当客户端重新启动时，通知客户端可以自动重新连接。</code></div><div class="line number79 index78 alt2"><code class="bash plain">explicit-</code><code class="bash functions">exit</code><code class="bash plain">-notify 1</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">创建log目录并配置权限</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_453319" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># mkdir /var/log/openvpn</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager config]</code><code class="bash comments"># chown -R openvpn.openvpn /var/log/openvpn/</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># chown -R openvpn.openvpn /etc/openvpn/*</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">配置防火墙(这里非常的关键,不配置会出现通不了的情况)</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_507574" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># 关闭自带防火墙</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager config]</code><code class="bash comments"># systemctl stop firewalld</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># systemctl disable firewalld</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="bash comments"># 我在/root/rc.local/下创建了一个iptables的脚本</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@manager sh]</code><code class="bash comments"># cd /root/rc.local/</code></div><div class="line number7 index6 alt2"><code class="bash plain">[root@manager rc.</code><code class="bash functions">local</code><code class="bash plain">]</code><code class="bash comments"># cat iptables.sh </code></div><div class="line number8 index7 alt1"><code class="bash preprocessor bold">#!/bin/bash</code></div><div class="line number9 index8 alt2"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-F</code></div><div class="line number10 index9 alt1"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-X</code></div><div class="line number11 index10 alt2"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-P INPUT ACCEPT</code></div><div class="line number12 index11 alt1"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-P OUTPUT ACCEPT</code></div><div class="line number13 index12 alt2"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-A INPUT -i lo -j ACCEPT</code></div><div class="line number14 index13 alt1"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-A INPUT -i ens37 -j ACCEPT</code></div><div class="line number15 index14 alt2"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-A INPUT -p udp --dport 1194 -j ACCEPT&nbsp;&nbsp; </code><code class="bash comments"># 开放udp的1194端口</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="bash comments"># openvpn</code></div><div class="line number19 index18 alt2"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-A FORWARD -s 10.8.0.0</code><code class="bash plain">/24</code> <code class="bash plain">-d 192.168.20.0</code><code class="bash plain">/24</code> <code class="bash plain">-i tun0 -j ACCEPT </code><code class="bash comments"># 接收公网10.8.0.x</code></div><div class="line number20 index19 alt1"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-A FORWARD -s 192.168.20.0</code><code class="bash plain">/24</code> <code class="bash plain">-d 10.8.0.0</code><code class="bash plain">/24</code> <code class="bash plain">-i ens37 -j ACCEPT </code><code class="bash comments"># 回传内网192.168.20.x</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-A INPUT -p ICMP&nbsp; -j ACCEPT</code></div><div class="line number23 index22 alt2"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</code></div><div class="line number24 index23 alt1"><code class="bash plain">/sbin/iptables</code> <code class="bash plain">-A INPUT -j DROP</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="bash comments"># 开启路由转发</code></div><div class="line number27 index26 alt2"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># echo "net.ipv4.ip_forward = 1" &gt;&gt; /etc/sysctl.conf </code></div><div class="line number28 index27 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># sysctl -p</code></div><div class="line number29 index28 alt2"><code class="bash plain">net.ipv4.ip_forward = 1　</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">启动并查看是否启动成功</span>　　</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_608439" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># nohup openvpn /etc/openvpn/config/server.conf &amp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># netstat -lntup | grep 1194</code></div><div class="line number3 index2 alt2"><code class="bash plain">udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.0.0.0:1194&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3189</code><code class="bash plain">/openvpn</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="line number4 index3 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># ps aux | grep openvpn | grep -v grep </code></div><div class="line number5 index4 alt2"><code class="bash plain">openvpn&nbsp;&nbsp;&nbsp; 3189&nbsp; 0.0&nbsp; 0.2&nbsp; 77092&nbsp; 3988 pts</code><code class="bash plain">/0</code>&nbsp;&nbsp;&nbsp; <code class="bash plain">S+&nbsp;&nbsp; 05:00&nbsp;&nbsp; 0:00 openvpn </code><code class="bash plain">/etc/openvpn/config/server</code><code class="bash plain">.conf</code></div></div></td></tr></tbody></table></div></div>
</div>
<div style="text-align: right;"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label6"></a></div><h2 id="blogTitle6">7. 证书认证服务器配置</h2>
<p>使用客户端证书验证我们需要在服务端先生成客户端的证书文件，然后下载的本来的安装目录下</p>
<p><span style="background-color: #ff6600;">温馨提示：</span></p>
<p><span style="background-color: #ff6600;">上面的安装操作这里就略过了，这里主要是和上面不同要修改的地方和生成客户端证书文件，请结合上面的进行操作</span></p>
<p><span style="background-color: #99ccff;">生成客户端证书文件</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_168790" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div><div class="line number102 index101 alt1">102</div><div class="line number103 index102 alt2">103</div><div class="line number104 index103 alt1">104</div><div class="line number105 index104 alt2">105</div><div class="line number106 index105 alt1">106</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># 创建client存放的路径将解压好的包cp到client路径</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># mkdir client</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># cp -a openvpn/easy-rsa/ client/</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># cd client/easy-rsa/easyrsa3/</code></div><div class="line number5 index4 alt2"><code class="bash comments"># 初始化 需输入yes 确定</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># ./easyrsa init-pki</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="bash plain">Note: using Easy-RSA configuration from: .</code><code class="bash plain">/vars</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="bash plain">WARNING!!!</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="bash plain">You are about to remove the EASYRSA_PKI at: </code><code class="bash plain">/root/client/easy-rsa/easyrsa3/pki</code></div><div class="line number14 index13 alt1"><code class="bash plain">and initialize a fresh PKI here.</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="bash plain">Type the word </code><code class="bash string">'yes'</code> <code class="bash plain">to </code><code class="bash keyword">continue</code><code class="bash plain">, or any other input to abort.</code></div><div class="line number17 index16 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash plain">Confirm removal: </code><code class="bash functions">yes</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="bash plain">init-pki complete; you may now create a CA or requests.</code></div><div class="line number20 index19 alt1"><code class="bash plain">Your newly created PKI </code><code class="bash functions">dir</code> <code class="bash plain">is: </code><code class="bash plain">/root/client/easy-rsa/easyrsa3/pki</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="bash comments"># 创建客户端key及生成证书（记住生成是自己客户端登录输入的密码）</code></div><div class="line number24 index23 alt1"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># ./easyrsa gen-req zjz</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="bash plain">Note: using Easy-RSA configuration from: .</code><code class="bash plain">/vars</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="bash plain">Using SSL: openssl OpenSSL 1.0.2k-fips&nbsp; 26 Jan 2017</code></div><div class="line number29 index28 alt2"><code class="bash plain">Generating a 2048 bit RSA private key</code></div><div class="line number30 index29 alt1"><code class="bash plain">.......+++</code></div><div class="line number31 index30 alt2"><code class="bash plain">....+++</code></div><div class="line number32 index31 alt1"><code class="bash plain">writing new private key to </code><code class="bash string">'/root/client/easy-rsa/easyrsa3/pki/private/zjz.key.8BHEEeC4aA'</code></div><div class="line number33 index32 alt2"><code class="bash comments"># 这里需要时输入两次密码(客户端登录的密码)</code></div><div class="line number34 index33 alt1"><code class="bash plain">Enter PEM pass phrase:</code></div><div class="line number35 index34 alt2"><code class="bash plain">Verifying - Enter PEM pass phrase:</code></div><div class="line number36 index35 alt1"><code class="bash plain">-----</code></div><div class="line number37 index36 alt2"><code class="bash plain">You are about to be asked to enter information that will be incorporated</code></div><div class="line number38 index37 alt1"><code class="bash plain">into your certificate request.</code></div><div class="line number39 index38 alt2"><code class="bash plain">What you are about to enter is what is called a Distinguished Name or a DN.</code></div><div class="line number40 index39 alt1"><code class="bash plain">There are quite a few fields but you can leave some blank</code></div><div class="line number41 index40 alt2"><code class="bash plain">For some fields there will be a default value,</code></div><div class="line number42 index41 alt1"><code class="bash plain">If you enter </code><code class="bash string">'.'</code><code class="bash plain">, the field will be left blank.</code></div><div class="line number43 index42 alt2"><code class="bash plain">-----</code></div><div class="line number44 index43 alt1"><code class="bash comments"># 名字自定义</code></div><div class="line number45 index44 alt2"><code class="bash plain">Common Name (eg: your user, host, or server name) [zjz]:zjz</code></div><div class="line number46 index45 alt1">&nbsp;</div><div class="line number47 index46 alt2"><code class="bash plain">Keypair and certificate request completed. Your files are:</code></div><div class="line number48 index47 alt1"><code class="bash plain">req: </code><code class="bash plain">/root/client/easy-rsa/easyrsa3/pki/reqs/zjz</code><code class="bash plain">.req</code></div><div class="line number49 index48 alt2"><code class="bash plain">key: </code><code class="bash plain">/root/client/easy-rsa/easyrsa3/pki/private/zjz</code><code class="bash plain">.key</code></div><div class="line number50 index49 alt1">&nbsp;</div><div class="line number51 index50 alt2"><code class="bash comments"># 将的到的zjz.req导入</code></div><div class="line number52 index51 alt1"><code class="bash comments"># 这里需要在 /etc/openvpn/easy-rsa/easyrsa3/ 执行</code></div><div class="line number53 index52 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># cd /etc/openvpn/easy-rsa/easyrsa3/</code></div><div class="line number54 index53 alt1"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># ./easyrsa import-req /root/client/easy-rsa/easyrsa3/pki/reqs/zjz.req zjz</code></div><div class="line number55 index54 alt2">&nbsp;</div><div class="line number56 index55 alt1"><code class="bash plain">Note: using Easy-RSA configuration from: .</code><code class="bash plain">/vars</code></div><div class="line number57 index56 alt2">&nbsp;</div><div class="line number58 index57 alt1"><code class="bash plain">Using SSL: openssl OpenSSL 1.0.2k-fips&nbsp; 26 Jan 2017</code></div><div class="line number59 index58 alt2">&nbsp;</div><div class="line number60 index59 alt1"><code class="bash comments"># 提示出现successfully 表示成功</code></div><div class="line number61 index60 alt2"><code class="bash plain">The request has been successfully imported with a short name of: zjz</code></div><div class="line number62 index61 alt1"><code class="bash plain">You may now use this name to perform signing operations on this request.</code></div><div class="line number63 index62 alt2">&nbsp;</div><div class="line number64 index63 alt1"><code class="bash comments"># 签约证书</code></div><div class="line number65 index64 alt2"><code class="bash comments"># 同样是在/etc/openvpn/easy-rsa/easyrsa3/ 执行</code></div><div class="line number66 index65 alt1"><code class="bash comments"># 这里生成client所以必须为client，zjz要与之前导入名字一致</code></div><div class="line number67 index66 alt2"><code class="bash plain">[root@manager easyrsa3]</code><code class="bash comments"># ./easyrsa sign client zjz</code></div><div class="line number68 index67 alt1">&nbsp;</div><div class="line number69 index68 alt2"><code class="bash plain">Note: using Easy-RSA configuration from: .</code><code class="bash plain">/vars</code></div><div class="line number70 index69 alt1">&nbsp;</div><div class="line number71 index70 alt2"><code class="bash plain">Using SSL: openssl OpenSSL 1.0.2k-fips&nbsp; 26 Jan 2017</code></div><div class="line number72 index71 alt1">&nbsp;</div><div class="line number73 index72 alt2">&nbsp;</div><div class="line number74 index73 alt1"><code class="bash plain">You are about to sign the following certificate.</code></div><div class="line number75 index74 alt2"><code class="bash plain">Please check over the details shown below </code><code class="bash keyword">for</code> <code class="bash plain">accuracy. Note that this request</code></div><div class="line number76 index75 alt1"><code class="bash plain">has not been cryptographically verified. Please be sure it came from a trusted</code></div><div class="line number77 index76 alt2"><code class="bash functions">source</code> <code class="bash plain">or that you have verified the request checksum with the sender.</code></div><div class="line number78 index77 alt1">&nbsp;</div><div class="line number79 index78 alt2"><code class="bash plain">Request subject, to be signed as a client certificate </code><code class="bash keyword">for</code> <code class="bash plain">1080 days:</code></div><div class="line number80 index79 alt1">&nbsp;</div><div class="line number81 index80 alt2"><code class="bash plain">subject=</code></div><div class="line number82 index81 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">commonName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = zjz</code></div><div class="line number83 index82 alt2">&nbsp;</div><div class="line number84 index83 alt1">&nbsp;</div><div class="line number85 index84 alt2"><code class="bash plain">Type the word </code><code class="bash string">'yes'</code> <code class="bash plain">to </code><code class="bash keyword">continue</code><code class="bash plain">, or any other input to abort.</code></div><div class="line number86 index85 alt1"><code class="bash comments"># 输入yes</code></div><div class="line number87 index86 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash plain">Confirm request details: </code><code class="bash functions">yes</code></div><div class="line number88 index87 alt1"><code class="bash plain">Using configuration from </code><code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/safessl-easyrsa</code><code class="bash plain">.cnf</code></div><div class="line number89 index88 alt2"><code class="bash comments"># 这里要求的密码是生成服务端证书时候的密码</code></div><div class="line number90 index89 alt1"><code class="bash plain">Enter pass phrase </code><code class="bash keyword">for</code> <code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/private/ca</code><code class="bash plain">.key:</code></div><div class="line number91 index90 alt2"><code class="bash plain">Check that the request matches the signature</code></div><div class="line number92 index91 alt1"><code class="bash plain">Signature ok</code></div><div class="line number93 index92 alt2"><code class="bash plain">The Subject's Distinguished Name is as follows</code></div><div class="line number94 index93 alt1"><code class="bash plain">commonName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :ASN.1 12:</code><code class="bash string">'zjz'</code></div><div class="line number95 index94 alt2"><code class="bash plain">Certificate is to be certified </code><code class="bash keyword">until</code> <code class="bash plain">Oct 20 03:42:12 2021 GMT (1080 days)</code></div><div class="line number96 index95 alt1">&nbsp;</div><div class="line number97 index96 alt2"><code class="bash plain">Write out database with 1 new entries</code></div><div class="line number98 index97 alt1"><code class="bash plain">Data Base Updated</code></div><div class="line number99 index98 alt2">&nbsp;</div><div class="line number100 index99 alt1"><code class="bash plain">Certificate created at: </code><code class="bash plain">/etc/openvpn/easy-rsa/easyrsa3/pki/issued/zjz</code><code class="bash plain">.crt</code></div><div class="line number101 index100 alt2">&nbsp;</div><div class="line number102 index101 alt1"><code class="bash plain">把客户端必要的证书、秘钥文件放到</code><code class="bash plain">/root/openvpn/ca/</code> <code class="bash plain">目录下(这个路径随意)</code></div><div class="line number103 index102 alt2"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># mkdir client/ca</code></div><div class="line number104 index103 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># cp /etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt /root/client/ca/</code></div><div class="line number105 index104 alt2"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># cp /etc/openvpn/easy-rsa/easyrsa3/pki/issued/zjz.crt /root/client/ca/</code></div><div class="line number106 index105 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># cp /root/client/easy-rsa/easyrsa3/pki/private/zjz.key /root/client/ca/</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">服务端配置文件(这里主要是删除了用户名密码验证的相关配置，并且不需要 checkpsw.sh 脚本和 pws-file 用户名密码文件)</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_90643" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager config]</code><code class="bash comments"># cat server.conf</code></div><div class="line number2 index1 alt1"><code class="bash comments"># 监听地址</code></div><div class="line number3 index2 alt2"><code class="bash functions">local</code> <code class="bash plain">0.0.0.0</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="bash comments"># openvpn监听的端口(默认1194)</code></div><div class="line number6 index5 alt1"><code class="bash plain">port 1194</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="bash comments"># 采用TCP/UDP协议(默认udp)</code></div><div class="line number9 index8 alt2"><code class="bash plain">proto udp</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="bash comments"># 创建openvpn的通信隧道类型(默认tun)</code></div><div class="line number12 index11 alt1"><code class="bash comments"># "dev tun"将会创建一个路由IP隧道，</code></div><div class="line number13 index12 alt2"><code class="bash comments"># "dev tap"将会创建一个以太网隧道。</code></div><div class="line number14 index13 alt1"><code class="bash plain">dev tun</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number16 index15 alt1"><code class="bash comments"># 设置SSL/TLS根证书(ca)、证书(cert)和私钥(key)。</code></div><div class="line number17 index16 alt2"><code class="bash plain">ca&nbsp;&nbsp;&nbsp; </code><code class="bash plain">/etc/openvpn/ca/ca</code><code class="bash plain">.crt</code></div><div class="line number18 index17 alt1"><code class="bash plain">cert </code><code class="bash plain">/etc/openvpn/ca/server</code><code class="bash plain">.crt</code></div><div class="line number19 index18 alt2"><code class="bash plain">key </code><code class="bash plain">/etc/openvpn/ca/server</code><code class="bash plain">.key&nbsp; </code><code class="bash comments"># 这个文件应该保密</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number21 index20 alt2"><code class="bash comments"># 指定迪菲·赫尔曼参数</code></div><div class="line number22 index21 alt1"><code class="bash plain">dh </code><code class="bash plain">/etc/openvpn/ca/dh</code><code class="bash plain">.pem</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number24 index23 alt1"><code class="bash comments"># 设置服务器端模式，并提供一个VPN子网，以便于从中为客户端分配IP地址</code></div><div class="line number25 index24 alt2"><code class="bash plain">server 10.8.0.0 255.255.255.0</code></div><div class="line number26 index25 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number27 index26 alt2"><code class="bash comments"># 如果启用该指令，所有客户端的默认网关都将重定向到VPN，这将导致诸如web浏览器、DNS查询等所有客户端流量都经过VPN</code></div><div class="line number28 index27 alt1"><code class="bash plain">push </code><code class="bash string">"redirect-gateway def1 bypass-dhcp"</code></div><div class="line number29 index28 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number30 index29 alt1"><code class="bash comments"># 指定DNS</code></div><div class="line number31 index30 alt2"><code class="bash plain">push </code><code class="bash string">"dhcp-option DNS 8.8.8.8"</code></div><div class="line number32 index31 alt1"><code class="bash plain">push </code><code class="bash string">"dhcp-option DNS 114.114.114.114"</code></div><div class="line number33 index32 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number34 index33 alt1"><code class="bash comments"># 客户端之间互相通信</code></div><div class="line number35 index34 alt2"><code class="bash plain">client-to-client </code></div><div class="line number36 index35 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number37 index36 alt2"><code class="bash comments"># 传输数据压缩</code></div><div class="line number38 index37 alt1"><code class="bash plain">comp-lzo</code></div><div class="line number39 index38 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number40 index39 alt1"><code class="bash comments"># 最多允许 20 客户端连接</code></div><div class="line number41 index40 alt2"><code class="bash plain">max-clients 20</code></div><div class="line number42 index41 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number43 index42 alt2"><code class="bash comments"># 用户和用户组</code></div><div class="line number44 index43 alt1"><code class="bash plain">user openvpn</code></div><div class="line number45 index44 alt2"><code class="bash plain">group openvpn</code></div><div class="line number46 index45 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number47 index46 alt2"><code class="bash comments"># 指定用于记录客户端和虚拟IP地址的关联关系的文件</code></div><div class="line number48 index47 alt1"><code class="bash functions">ifconfig</code><code class="bash plain">-pool-persist ipp.txt</code></div><div class="line number49 index48 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number50 index49 alt1"><code class="bash comments"># 连接关闭时间</code></div><div class="line number51 index50 alt2"><code class="bash plain">keepalive 10 120</code></div><div class="line number52 index51 alt1">&nbsp;</div><div class="line number53 index52 alt2"><code class="bash comments"># 选择一种加密算法</code></div><div class="line number54 index53 alt1"><code class="bash plain">cipher AES-256-CBC</code></div><div class="line number55 index54 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number56 index55 alt1"><code class="bash comments"># 持久化选项可以尽量避免访问那些在重启之后由于用户权限降低而无法访问的某些资源</code></div><div class="line number57 index56 alt2"><code class="bash plain">persist-key</code></div><div class="line number58 index57 alt1"><code class="bash plain">persist-tun</code></div><div class="line number59 index58 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number60 index59 alt1"><code class="bash comments"># 输出一个简短的状态文件，用于显示当前的连接状态，该文件每分钟都会清空并重写一次</code></div><div class="line number61 index60 alt2"><code class="bash plain">status </code><code class="bash plain">/var/log/openvpn/openvpn-status</code><code class="bash plain">.log</code></div><div class="line number62 index61 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number63 index62 alt2"><code class="bash comments"># 默认情况下，日志消息将写入syslog中</code></div><div class="line number64 index63 alt1"><code class="bash comments"># "log"方式在每次启动时都会清空之前的日志文件</code></div><div class="line number65 index64 alt2"><code class="bash plain">log&nbsp;&nbsp; </code><code class="bash plain">/var/log/openvpn/openvpn</code><code class="bash plain">.log</code></div><div class="line number66 index65 alt1"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number67 index66 alt2"><code class="bash comments"># 为日志文件设置适当的冗余级别(0~9)。冗余级别越高，输出的信息越详细</code></div><div class="line number68 index67 alt1"><code class="bash plain">verb 3</code></div><div class="line number69 index68 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number70 index69 alt1"><code class="bash comments"># 当客户端重新启动时，通知客户端可以自动重新连接。</code></div><div class="line number71 index70 alt2"><code class="bash plain">explicit-</code><code class="bash functions">exit</code><code class="bash plain">-notify 1</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #ff6600;">下面就是需要配置防火墙，启动openvpn服务了和上面的一样，这里就不贴命令了</span></p>
<div style="text-align: right;"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label7"></a></div><h2 id="blogTitle7">8. windows客户端配置</h2>
<p><span style="background-color: #99ccff;">7.1. 安装客户端软件</span></p>
<p>客户端下载地址:<a href="https://swupdate.openvpn.org/community/releases/openvpn-2.4.6.zip" target="_blank">&nbsp;https://swupdate.openvpn.org/community/releases/openvpn-2.4.6.zip</a></p>
<p>windows客户端安装：</p>
<p>下载完成后-----&gt; 解压 ---------------&gt; 双击安装 -----------&gt; 下一步 --------&gt; 安装(会有个提示是否安装)----------------&gt; 完成</p>
<p>温馨提示：</p>
<p>最后的默认安装路径在：C:\Program Files\OpenVPN 下面</p>
<p><span style="background-color: #99ccff;">7.2.&nbsp;用户名密码</span></p>
<p>温馨提示:</p>
<p>客户端需要的文件有：</p>
<p>ca.crt (ca证书文件)</p>
<p>client.ovpn (客户端配置文件)</p>
<p>以上两个文件都是必须的，缺一不可</p>
<p>首先我们要把服务端上生成的 ca.crt 文件(在服务端的/etc/openvpn/ca/ 下) 放到本地windows主机上的 C:\Program Files\OpenVPN\config 路径下</p>
<p>我这里使用的sz命令(在Linux上面 这个命令需要安装lrzsz 上面已经安装了)把 ca.crt 文件下载到我的windows主机上</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_849689" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># Linux服务器执行</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># cd /etc/openvpn/ca/</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@manager ca]</code><code class="bash comments"># ls</code></div><div class="line number4 index3 alt1"><code class="bash plain">ca.crt&nbsp; dh.pem&nbsp; server.crt&nbsp; server.key</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@manager ca]</code><code class="bash comments"># sz ca.crt</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>然后配置客户端的配置文件</p>
<p>客户端的文件名叫client.ovpn (不要修改哦)</p>
<p>编辑client.ovpn文件</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_603099" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># 指定这是一个客户端，我们将从服务器获取某些配置文件指令</code></div><div class="line number2 index1 alt1"><code class="bash plain">client</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="bash comments"># 创建openvpn的通信隧道类型(默认tun)</code></div><div class="line number5 index4 alt2"><code class="bash comments"># "dev tun"将会创建一个路由IP隧道，</code></div><div class="line number6 index5 alt1"><code class="bash comments"># "dev tap"将会创建一个以太网隧道。</code></div><div class="line number7 index6 alt2"><code class="bash plain">dev tun</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="bash comments"># 采用TCP/UDP协议(需要和服务端保持一致)</code></div><div class="line number10 index9 alt1"><code class="bash plain">proto udp</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="bash comments"># 指定服务端的外网IP和端口(根据自己的服务器地址和端口进行修改)</code></div><div class="line number13 index12 alt2"><code class="bash plain">remote 192.168.1.170 1194</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="bash comments"># 启用该指令，与服务器连接中断后将自动重新连接，这在网络不稳定的情况下(例如：笔记本电脑无线网络)非常有用</code></div><div class="line number16 index15 alt1"><code class="bash plain">resolv-retry infinite</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="bash comments"># 大多数客户端不需要绑定本机特定的端口号</code></div><div class="line number19 index18 alt2"><code class="bash plain">nobind</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="bash comments"># 将忽略掉重复数据包的警告信息</code></div><div class="line number22 index21 alt1"><code class="bash plain">mute-replay-warnings</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="bash comments"># 指定ca证书文件路径(默认安装路径下的config目录)这里的ca.crt是在服务端生成的</code></div><div class="line number25 index24 alt2"><code class="bash plain">ca&nbsp; ca.crt</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="bash comments"># 传输数据压缩</code></div><div class="line number28 index27 alt1"><code class="bash plain">comp-lzo</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="bash comments"># 使用账户密码的方式(必须指定)</code></div><div class="line number31 index30 alt2"><code class="bash plain">auth-user-pass</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="bash comments"># 配置DNS(不是必须的)</code></div><div class="line number34 index33 alt1"><code class="bash plain">dhcp-option DNS 114.114.114.114</code></div><div class="line number35 index34 alt2"><code class="bash plain">dhcp-option DNS 8.8.8.8</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>客户端config目录下面　　</p>
<p><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/1479220-20181105105801458-1008296316.png" alt=""></p>
<p>&nbsp;</p>
<p>然后以管理员的身份运行安装好的客户端程序</p>
<p>&nbsp;输入用户名密码</p>
<p><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/1479220-20181105105929580-1408474964.png" alt=""></p>
<p>出现下面的提示说明连接成功</p>
<p>&nbsp;<img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/1479220-20181105110150985-1968169322.png" alt=""></p>
<p>&nbsp;测试ping内网地址</p>
<p>&nbsp;<img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/1479220-20181105110218375-388846699.png" alt=""></p>
<p><span style="background-color: #99ccff;">7.3. 证书</span></p>
<p>客户端使用证书验证需要的到的文件有：</p>
<p>ca.crt (CA证书)</p>
<p>zjz.crt (客户端证书)</p>
<p>zjz.key (客户端key)</p>
<p>client.ovpn (客户端配置文件)</p>
<p>上面的文件是必须的缺一不可</p>
<p>在服务器上使用 sz 命令下载证书和key文件到本地安装目录</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_319405" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@manager ~]</code><code class="bash comments"># cd /root/client/ca/</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@manager ca]</code><code class="bash comments"># sz ca.crt zjz.crt zjz.key </code></div></div></td></tr></tbody></table></div></div>
</div>
<p>&nbsp;编辑 client.ovpn 文件</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_480308" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># 指定这是一个客户端，我们将从服务器获取某些配置文件指令</code></div><div class="line number2 index1 alt1"><code class="bash plain">client</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="bash comments"># 创建openvpn的通信隧道类型(默认tun)</code></div><div class="line number5 index4 alt2"><code class="bash comments"># "dev tun"将会创建一个路由IP隧道，</code></div><div class="line number6 index5 alt1"><code class="bash comments"># "dev tap"将会创建一个以太网隧道。</code></div><div class="line number7 index6 alt2"><code class="bash plain">dev tun</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="bash comments"># 采用TCP/UDP协议(需要和服务端保持一致)</code></div><div class="line number10 index9 alt1"><code class="bash plain">proto udp</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="bash comments"># 指定服务端的外网IP和端口(根据自己的服务器地址和端口进行修改)</code></div><div class="line number13 index12 alt2"><code class="bash plain">remote 192.168.1.170 1194</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="bash comments"># 启用该指令，与服务器连接中断后将自动重新连接，这在网络不稳定的情况下(例如：笔记本电脑无线网络)非常有用</code></div><div class="line number16 index15 alt1"><code class="bash plain">resolv-retry infinite</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="bash comments"># 大多数客户端不需要绑定本机特定的端口号</code></div><div class="line number19 index18 alt2"><code class="bash plain">nobind</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="bash comments"># 将忽略掉重复数据包的警告信息</code></div><div class="line number22 index21 alt1"><code class="bash plain">mute-replay-warnings</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="bash comments"># 指定ca证书客户端证书客户端秘钥文件路径(默认安装路径下的config目录)</code></div><div class="line number25 index24 alt2"><code class="bash plain">ca&nbsp; ca.crt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments">#服务器证书</code></div><div class="line number26 index25 alt1"><code class="bash plain">cert zjz.crt&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments">#client的证书</code></div><div class="line number27 index26 alt2"><code class="bash plain">key zjz.key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments">#client的密钥</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="bash comments"># 传输数据压缩</code></div><div class="line number30 index29 alt1"><code class="bash plain">comp-lzo</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="bash comments"># 配置DNS(不是必须的)</code></div><div class="line number33 index32 alt2"><code class="bash plain">dhcp-option DNS 114.114.114.114</code></div><div class="line number34 index33 alt1"><code class="bash plain">dhcp-option DNS 8.8.8.8</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>客户端目录下有</p>
<p>　<img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/1479220-20181105120017859-266836081.png" alt=""></p>
<p>&nbsp;</p>
<p>以管理员的身份运行安装好的openvpn客户端，输入生成客户端证书的时候的密码</p>
<p><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/1479220-20181105120454412-1364743704.png" alt=""></p>
<p>出现下面的状态说明连接成功</p>
<p><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/1479220-20181105121342750-693682846.png" alt=""></p>
<p>测试ping</p>
<p><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/1479220-20181105121404582-249418493.png" alt=""></p>
<div style="text-align: right;"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label8"></a></div><h2 id="blogTitle8">8. Linux客户端配置</h2>
<p><span style="background-color: #ffff00; font-size: 16px;">8.1. 安装客户端</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_654899" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># yum -y install epel-release</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># yum -y install openvpn</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #ffff00; font-size: 16px;">8.2. 用户名密码</span></p>
<p>客户端使用用户名密码登录需要的文件：</p>
<p>ca.crt(CA证书文件)</p>
<p>client.ovpn(客户端配置文件)</p>
<p>user.txt(自己创建的存放用户名密码文件，为了不需要每次登录的时候重复输入用户名密码，不是必须的)</p>
<p>我这里使用rz命令将证书文件上传到linux的客户端</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_997993" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># 创建存放文件的目录</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># mkdir -p /root/client/config</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># cd client/config/</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@node1 config]</code><code class="bash comments"># ll</code></div><div class="line number5 index4 alt2"><code class="bash plain">total 12</code></div><div class="line number6 index5 alt1"><code class="bash plain">-rw-r--r-- 1 root root 1143 Nov&nbsp; 5 11:45 ca.crt</code></div><div class="line number7 index6 alt2"><code class="bash plain">-rw-r--r-- 1 root root 1055 Nov&nbsp; 5 12:04 client.ovpn</code></div><div class="line number8 index7 alt1"><code class="bash plain">-rw-r--r-- 1 root root&nbsp;&nbsp; 12 Nov&nbsp; 5 15:05 user.txt</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">客户端配置文件</span>　　</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_181843" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@node1 config]</code><code class="bash comments"># cat client.ovpn </code></div><div class="line number2 index1 alt1"><code class="bash comments"># 指定这是一个客户端，我们将从服务器获取某些配置文件指令</code></div><div class="line number3 index2 alt2"><code class="bash plain">client</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="bash comments"># 创建openvpn的通信隧道类型(默认tun)</code></div><div class="line number6 index5 alt1"><code class="bash comments"># "dev tun"将会创建一个路由IP隧道，</code></div><div class="line number7 index6 alt2"><code class="bash comments"># "dev tap"将会创建一个以太网隧道。</code></div><div class="line number8 index7 alt1"><code class="bash plain">dev tun</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="bash comments"># 采用TCP/UDP协议(需要和服务端保持一致)</code></div><div class="line number11 index10 alt2"><code class="bash plain">proto udp</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="bash comments"># 指定服务端的外网IP和端口(根据自己的服务器地址和端口进行修改)</code></div><div class="line number14 index13 alt1"><code class="bash plain">remote 192.168.1.170 1194</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="bash comments"># 启用该指令，与服务器连接中断后将自动重新连接，这在网络不稳定的情况下(例如：笔记本电脑无线网络)非常有用</code></div><div class="line number17 index16 alt2"><code class="bash plain">resolv-retry infinite</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="bash comments"># 大多数客户端不需要绑定本机特定的端口号</code></div><div class="line number20 index19 alt1"><code class="bash plain">nobind</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="bash comments"># 将忽略掉重复数据包的警告信息</code></div><div class="line number23 index22 alt2"><code class="bash plain">mute-replay-warnings</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="bash comments"># 指定ca证书客户端证书客户端秘钥文件路径(默认安装路径下的config目录)</code></div><div class="line number26 index25 alt1"><code class="bash plain">ca&nbsp; </code><code class="bash plain">/root/client/config/ca</code><code class="bash plain">.crt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments">#服务器证书</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="bash comments"># 使用账户密码的方式(必须指定)</code></div><div class="line number29 index28 alt2"><code class="bash plain">auth-user-pass</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="bash comments"># 指定用户名密码文件</code></div><div class="line number32 index31 alt1"><code class="bash comments"># 用户认证文件, 用户名占一行, 密码占一行</code></div><div class="line number33 index32 alt2"><code class="bash plain">auth-user-pass </code><code class="bash string">'/root/client/config/user.txt'</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="bash comments"># # 禁止将用户名和密码缓存在内存中 </code></div><div class="line number36 index35 alt1"><code class="bash plain">auth-nocache</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="bash comments"># 传输数据压缩</code></div><div class="line number39 index38 alt2"><code class="bash plain">comp-lzo</code></div><div class="line number40 index39 alt1">&nbsp;</div><div class="line number41 index40 alt2"><code class="bash comments"># 配置DNS(不是必须的)</code></div><div class="line number42 index41 alt1"><code class="bash plain">dhcp-option DNS 114.114.114.114</code></div><div class="line number43 index42 alt2"><code class="bash plain">dhcp-option DNS 8.8.8.8</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">用户名密码文件</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_925788" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@node1 config]</code><code class="bash comments"># cat user.txt </code></div><div class="line number2 index1 alt1"><code class="bash plain">zjz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 用户名</code></div><div class="line number3 index2 alt2"><code class="bash plain">123.com&nbsp; </code><code class="bash comments"># 密码</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #99ccff;">测试连接</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_921268" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># 启动并查看</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># nohup openvpn /root/client/config^Client.ovpn &amp;&gt;/dev/null &amp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">[1] 14155</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># netstat -lntup | grep openvpn</code></div><div class="line number5 index4 alt2"><code class="bash plain">udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.0.0.0:21806&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 14068</code><code class="bash plain">/openvpn</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># ps aux | grep openvpn | grep -v grep </code></div><div class="line number7 index6 alt2"><code class="bash plain">root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 14068&nbsp; 0.0&nbsp; 0.4&nbsp; 75368&nbsp; 4620 pts</code><code class="bash plain">/0</code>&nbsp;&nbsp;&nbsp; <code class="bash plain">S&nbsp;&nbsp;&nbsp; 15:34&nbsp;&nbsp; 0:00 openvpn </code><code class="bash plain">/root/client/config/client</code><code class="bash plain">.ovpn</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="bash comments"># 查看openvpn虚拟网卡信息</code></div><div class="line number10 index9 alt1"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># ifconfig tun0</code></div><div class="line number11 index10 alt2"><code class="bash plain">tun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;&nbsp; mtu 1500</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">inet 10.8.0.6&nbsp; netmask 255.255.255.255&nbsp; destination 10.8.0.5</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00&nbsp; txqueuelen 100&nbsp; (UNSPEC)</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">RX packets 0&nbsp; bytes 0 (0.0 B)</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">RX errors 0&nbsp; dropped 0&nbsp; overruns 0&nbsp; frame 0</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">TX packets 0&nbsp; bytes 0 (0.0 B)</code></div><div class="line number17 index16 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">TX errors 0&nbsp; dropped 0 overruns 0&nbsp; carrier 0&nbsp; collisions 0</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="bash comments"># 测试连接</code></div><div class="line number20 index19 alt1"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># ping 192.168.20.12</code></div><div class="line number21 index20 alt2"><code class="bash plain">PING 192.168.20.12 (192.168.20.12) 56(84) bytes of data.</code></div><div class="line number22 index21 alt1"><code class="bash plain">64 bytes from 192.168.20.12: icmp_seq=1 ttl=64 </code><code class="bash functions">time</code><code class="bash plain">=0.450 ms</code></div><div class="line number23 index22 alt2"><code class="bash plain">64 bytes from 192.168.20.12: icmp_seq=2 ttl=64 </code><code class="bash functions">time</code><code class="bash plain">=0.474 ms</code></div><div class="line number24 index23 alt1"><code class="bash plain">^C</code></div><div class="line number25 index24 alt2"><code class="bash plain">--- 192.168.20.12 </code><code class="bash functions">ping</code> <code class="bash plain">statistics ---</code></div><div class="line number26 index25 alt1"><code class="bash plain">2 packets transmitted, 2 received, 0% packet loss, </code><code class="bash functions">time</code> <code class="bash plain">1000ms</code></div><div class="line number27 index26 alt2"><code class="bash plain">rtt min</code><code class="bash plain">/avg/max/mdev</code> <code class="bash plain">= 0.450</code><code class="bash plain">/0</code><code class="bash plain">.462</code><code class="bash plain">/0</code><code class="bash plain">.474</code><code class="bash plain">/0</code><code class="bash plain">.012 ms</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #ffff00; font-size: 16px;">8.3. 证书</span></p>
<p>证书认证需要的文件：</p>
<p>ca.crt (CA证书)</p>
<p>zjz.crt (客户端证书)</p>
<p>zjz.key (客户端key)</p>
<p>client.ovpn (客户端配置文件)</p>
<p>我这里使用rz命令将证书文件上传到linux的客户端</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_458229" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># cd client/config/</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@node1 config]</code><code class="bash comments"># ll</code></div><div class="line number3 index2 alt2"><code class="bash plain">total 20</code></div><div class="line number4 index3 alt1"><code class="bash plain">-rw-r--r-- 1 root root 1143 Nov&nbsp; 5 11:45 ca.crt</code></div><div class="line number5 index4 alt2"><code class="bash plain">-rw-r--r-- 1 root root 1268 Nov&nbsp; 5 15:26 client.ovpn</code></div><div class="line number6 index5 alt1"><code class="bash plain">-rw-r--r-- 1 root root 4395 Nov&nbsp; 5 11:45 zjz.crt</code></div><div class="line number7 index6 alt2"><code class="bash plain">-rw-r--r-- 1 root root 1834 Nov&nbsp; 5 11:46 zjz.key</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>配置文件需要修改</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_472021" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@node1 config]</code><code class="bash comments"># cat client.ovpn </code></div><div class="line number2 index1 alt1"><code class="bash comments"># 指定这是一个客户端，我们将从服务器获取某些配置文件指令</code></div><div class="line number3 index2 alt2"><code class="bash plain">client</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="bash comments"># 创建openvpn的通信隧道类型(默认tun)</code></div><div class="line number6 index5 alt1"><code class="bash comments"># "dev tun"将会创建一个路由IP隧道，</code></div><div class="line number7 index6 alt2"><code class="bash comments"># "dev tap"将会创建一个以太网隧道。</code></div><div class="line number8 index7 alt1"><code class="bash plain">dev tun</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="bash comments"># 采用TCP/UDP协议(需要和服务端保持一致)</code></div><div class="line number11 index10 alt2"><code class="bash plain">proto udp</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="bash comments"># 指定服务端的外网IP和端口(根据自己的服务器地址和端口进行修改)</code></div><div class="line number14 index13 alt1"><code class="bash plain">remote 192.168.1.170 1194</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="bash comments"># 启用该指令，与服务器连接中断后将自动重新连接，这在网络不稳定的情况下(例如：笔记本电脑无线网络)非常有用</code></div><div class="line number17 index16 alt2"><code class="bash plain">resolv-retry infinite</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="bash comments"># 大多数客户端不需要绑定本机特定的端口号</code></div><div class="line number20 index19 alt1"><code class="bash plain">nobind</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="bash comments"># 将忽略掉重复数据包的警告信息</code></div><div class="line number23 index22 alt2"><code class="bash plain">mute-replay-warnings</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="bash comments"># 指定ca证书客户端证书客户端秘钥文件路径(默认安装路径下的config目录)</code></div><div class="line number26 index25 alt1"><code class="bash plain">ca&nbsp; </code><code class="bash plain">/root/client/config/ca</code><code class="bash plain">.crt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments">#服务器证书</code></div><div class="line number27 index26 alt2"><code class="bash plain">cert </code><code class="bash plain">/root/client/config/zjz</code><code class="bash plain">.crt</code></div><div class="line number28 index27 alt1"><code class="bash plain">key </code><code class="bash plain">/root/client/config/zjz</code><code class="bash plain">.key</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="bash comments"># 传输数据压缩</code></div><div class="line number32 index31 alt1"><code class="bash plain">comp-lzo</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="bash comments"># 配置DNS(不是必须的)</code></div><div class="line number35 index34 alt2"><code class="bash plain">dhcp-option DNS 114.114.114.114</code></div><div class="line number36 index35 alt1"><code class="bash plain">dhcp-option DNS 8.8.8.8</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>测试连接</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_189137" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># 启动并查看</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@node1 client]</code><code class="bash comments">#&nbsp; openvpn /root/client/config/client.ovpn </code></div><div class="line number3 index2 alt2"><code class="bash plain">Mon Nov&nbsp; 5 15:47:07 2018 WARNING: </code><code class="bash functions">file</code> <code class="bash string">'/root/client/config/zjz.key'</code> <code class="bash plain">is group or others accessible</code></div><div class="line number4 index3 alt1"><code class="bash plain">Mon Nov&nbsp; 5 15:47:07 2018 OpenVPN 2.4.6 x86_64-redhat-linux-gnu [Fedora EPEL patched] [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH</code><code class="bash plain">/PKTINFO</code><code class="bash plain">] [AEAD] built on Apr 26 2018</code></div><div class="line number5 index4 alt2"><code class="bash plain">Mon Nov&nbsp; 5 15:47:07 2018 library versions: OpenSSL 1.0.2k-fips&nbsp; 26 Jan 2017, LZO 2.06</code></div><div class="line number6 index5 alt1"><code class="bash plain">Mon Nov&nbsp; 5 15:47:07 2018 WARNING: No server certificate verification method has been enabled.&nbsp; See http:</code><code class="bash plain">//openvpn</code><code class="bash plain">.net</code><code class="bash plain">/howto</code><code class="bash plain">.html</code><code class="bash comments">#mitm for more info.</code></div><div class="line number7 index6 alt2"><code class="bash comments"># 这里要输入创建证书的时候的密码</code></div><div class="line number8 index7 alt1"><code class="bash plain">Enter Private Key Password: *******</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># netstat -lntup | grep openvpn</code></div><div class="line number12 index11 alt1"><code class="bash plain">udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.0.0.0:21806&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 14068</code><code class="bash plain">/openvpn</code></div><div class="line number13 index12 alt2"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># ps aux | grep openvpn | grep -v grep </code></div><div class="line number14 index13 alt1"><code class="bash plain">root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 14068&nbsp; 0.0&nbsp; 0.4&nbsp; 75368&nbsp; 4620 pts</code><code class="bash plain">/0</code>&nbsp;&nbsp;&nbsp; <code class="bash plain">S&nbsp;&nbsp;&nbsp; 15:34&nbsp;&nbsp; 0:00 openvpn </code><code class="bash plain">/root/client/config/client</code><code class="bash plain">.ovpn</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="bash comments"># 查看openvpn虚拟网卡信息</code></div><div class="line number17 index16 alt2"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># ifconfig tun0</code></div><div class="line number18 index17 alt1"><code class="bash plain">tun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;&nbsp; mtu 1500</code></div><div class="line number19 index18 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">inet 10.8.0.6&nbsp; netmask 255.255.255.255&nbsp; destination 10.8.0.5</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00&nbsp; txqueuelen 100&nbsp; (UNSPEC)</code></div><div class="line number21 index20 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">RX packets 0&nbsp; bytes 0 (0.0 B)</code></div><div class="line number22 index21 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">RX errors 0&nbsp; dropped 0&nbsp; overruns 0&nbsp; frame 0</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">TX packets 0&nbsp; bytes 0 (0.0 B)</code></div><div class="line number24 index23 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">TX errors 0&nbsp; dropped 0 overruns 0&nbsp; carrier 0&nbsp; collisions 0</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="bash comments"># 测试连接</code></div><div class="line number27 index26 alt2"><code class="bash plain">[root@node1 ~]</code><code class="bash comments"># ping 192.168.20.12</code></div><div class="line number28 index27 alt1"><code class="bash plain">PING 192.168.20.12 (192.168.20.12) 56(84) bytes of data.</code></div><div class="line number29 index28 alt2"><code class="bash plain">64 bytes from 192.168.20.12: icmp_seq=1 ttl=64 </code><code class="bash functions">time</code><code class="bash plain">=0.450 ms</code></div><div class="line number30 index29 alt1"><code class="bash plain">64 bytes from 192.168.20.12: icmp_seq=2 ttl=64 </code><code class="bash functions">time</code><code class="bash plain">=0.474 ms</code></div><div class="line number31 index30 alt2"><code class="bash plain">^C</code></div><div class="line number32 index31 alt1"><code class="bash plain">--- 192.168.20.12 </code><code class="bash functions">ping</code> <code class="bash plain">statistics ---</code></div><div class="line number33 index32 alt2"><code class="bash plain">2 packets transmitted, 2 received, 0% packet loss, </code><code class="bash functions">time</code> <code class="bash plain">1000ms</code></div><div class="line number34 index33 alt1"><code class="bash plain">rtt min</code><code class="bash plain">/avg/max/mdev</code> <code class="bash plain">= 0.450</code><code class="bash plain">/0</code><code class="bash plain">.462</code><code class="bash plain">/0</code><code class="bash plain">.474</code><code class="bash plain">/0</code><code class="bash plain">.012 ms</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="font-size: 16px; color: #ff6600;">最后的温馨提示：</span><br><span style="font-size: 16px; color: #ff6600;">1、可能会出现能连接但是不能访问的现象</span><br><span style="font-size: 16px; color: #ff6600;">解决思路：请检查防火墙</span><br><span style="font-size: 16px; color: #ff6600;">2、出现启动错误</span><br><span style="font-size: 16px; color: #ff6600;">解决思路：请检查配置文件 看看是不是路径问题或者有没有相应的文件</span><br><span style="font-size: 16px; color: #ff6600;">3、如果申请证书的时候密码忘记了</span><br><span style="font-size: 16px; color: #ff6600;">解决思路：请重新来过</span><br><span style="font-size: 16px; color: #ff6600;">4、其他问题</span><br><span style="font-size: 16px; color: #ff6600;">解决思路：请检查日志文件或者直接评论或者QQ联系我</span></p>
<p>　　</p>
<p>&nbsp;</p></div><div id="MySignature" style="display: block;"><div>作者：<a href="https://www.cnblogs.com/zhujingzhi/">朱敬志</a></div>
<div>出处：<a href="https://www.cnblogs.com/zhujingzhi/">https://www.cnblogs.com/zhujingzhi/
</a></div>
<p>-------------------------------------------</p>
<p>个性签名：在逆境中要看到生活的美，在希望中别忘记不断奋斗</p>
<p>如果觉得这篇文章对你有小小的帮助的话，记得在右下角点个<span>“推荐”</span>哦，博主在此感谢！</p>
<p></p>
<p>万水千山总是情，打赏一分行不行，所以如果你心情还比较高兴，也是可以扫码打赏博主，哈哈哈(っ•̀ω•́)っ✎⁾⁾！</p>
<img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/o_zfb.JPG" alt="支付宝" width="100" height="100">
<img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/o_wx.JPG" alt="微信" width="100" height="100"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory">分类: <a href="https://www.cnblogs.com/zhujingzhi/category/1292030.html" target="_blank">VPN</a></div>
<div id="EntryTag">标签: <a href="https://www.cnblogs.com/zhujingzhi/tag/openvpn/">openvpn</a>, <a href="https://www.cnblogs.com/zhujingzhi/tag/VPN/">VPN</a>, <a href="https://www.cnblogs.com/zhujingzhi/tag/linux/">linux</a>, <a href="https://www.cnblogs.com/zhujingzhi/tag/centos/">centos</a></div>
<div id="blog_post_info"><div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(9905067,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
            <a id="green_channel_follow" onclick="follow(&#39;74c950b8-42c2-4253-8de8-08d6108cf535&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/zhujingzhi/" target="_blank"><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/20181008163850.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/zhujingzhi/">一本正经的搞事情</a><br>
            <a href="https://home.cnblogs.com/u/zhujingzhi/followees">关注 - 10</a><br>
            <a href="https://home.cnblogs.com/u/zhujingzhi/followers">粉丝 - 15</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;74c950b8-42c2-4253-8de8-08d6108cf535&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg"><div style="padding-bottom: 5px"><span class="icon_favorite" style="padding-top: 2px"></span><a onclick="cnblogs.UserManager.FollowBlogger(&#39;9a35f2c7-18ab-e111-aa3f-842b2b196315&#39;);" href="javascript:void(0);" style="font-weight: bold; padding-left:5px;">关注一下楼主吧</a> </div>
    <div class="diggit" onclick="votePost(9905067,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">3</span>
    </div>
    <div class="buryit" onclick="votePost(9905067,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>
<script type="text/javascript">
    currentDiggType = 0;
</script></div>
<div class="clear"></div>
<div id="post_next_prev"><a href="https://www.cnblogs.com/zhujingzhi/p/9903681.html" class="p_n_p_prefix">« </a> 上一篇：<a href="https://www.cnblogs.com/zhujingzhi/p/9903681.html" title="发布于2018-11-04 13:27">centos7 系统优化</a><br><a href="https://www.cnblogs.com/zhujingzhi/p/9968073.html" class="p_n_p_prefix">» </a> 下一篇：<a href="https://www.cnblogs.com/zhujingzhi/p/9968073.html" title="发布于2018-11-18 16:57">elasticsearch+logstash+redis+kibana 实时分析nginx日志</a><br></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2018-11-05 15:56</span> <a href="https://www.cnblogs.com/zhujingzhi/">一本正经的搞事情</a> 阅读(<span id="post_view_count">5206</span>) 评论(<span id="post_comment_count">0</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=9905067" rel="nofollow">编辑</a> <a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" onclick="AddToWz(9905067);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=456372,cb_entryId=9905067,cb_blogApp=currentBlogApp,cb_blogUserGuid='74c950b8-42c2-4253-8de8-08d6108cf535',cb_entryCreatedDate='2018/11/5 15:56:00';loadViewCount(cb_entryId);var cb_postType=1;var isMarkdown=false;</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"><a href="http://www.ucancode.com/index.htm" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-工控&#39;)">【推荐】超50万C++/C#源码: 大型实时仿真组态图形源码</a><br><a href="https://ke.qq.com/adActivity.html?name=xiangxueketang2" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-享学&#39;)">【推荐】Java工作两年，一天竟收到33份面试通知</a><br><a href="https://q.cnblogs.com/" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-博问&#39;)">【推荐】程序员问答平台，解决您开发中遇到的技术难题</a><br></div>
<div id="opt_under_post"></div>
<script async="async" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/gpt.js.download"></script>
<script>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
</script>
<script>
  googletag.cmd.push(function() {
        googletag.defineSlot('/1090369/C1', [300, 250], 'div-gpt-ad-1546353474406-0').addService(googletag.pubads());
        googletag.defineSlot('/1090369/C2', [468, 60], 'div-gpt-ad-1539008685004-0').addService(googletag.pubads());
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
  });
</script>
<div id="cnblogs_c1" class="c_ad_block">
    <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;" data-google-query-id="CKn_gsKFuuICFVh7iwod9JkByA"><div id="google_ads_iframe_/1090369/C1_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C1_0" title="3rd party ad content" name="google_ads_iframe_/1090369/C1_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" style="border: 0px; vertical-align: bottom;" data-google-container-id="1" data-load-complete="true" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/saved_resource.html"></iframe></div></div>
</div>
<div id="under_post_news"><div class="itnews c_ad_block"><b>相关博文：</b><br>·  <a href="https://www.cnblogs.com/wayneiscoming/p/7552339.html" target="_blank" onclick="clickRecomItmem(7552339)">OpenVPN CentOS7 安装部署配置详解</a><br>·  <a href="https://www.cnblogs.com/along21/p/8339955.html" target="_blank" onclick="clickRecomItmem(8339955)">完整CentOS搭建企业OpenVPN服务详细教程</a><br>·  <a href="https://www.cnblogs.com/hwlong/p/6774090.html" target="_blank" onclick="clickRecomItmem(6774090)">centos 6.5 部署openvpn 2.4</a><br>·  <a href="https://www.cnblogs.com/wjoyxt/p/9489549.html" target="_blank" onclick="clickRecomItmem(9489549)">Centos7搭建OpenVPN服务器</a><br>·  <a href="https://www.cnblogs.com/theitnotes/p/4162927.html" target="_blank" onclick="clickRecomItmem(4162927)">OpenVPN详细安装配置教程</a><br></div></div>
<div id="cnblogs_c2" class="c_ad_block">
    <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;" data-google-query-id="CKr_gsKFuuICFVh7iwod9JkByA"><div id="google_ads_iframe_/1090369/C2_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C2_0" title="3rd party ad content" name="google_ads_iframe_/1090369/C2_0" width="468" height="60" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" style="border: 0px; vertical-align: bottom;" data-google-container-id="2" data-load-complete="true" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/saved_resource(1).html"></iframe></div></div>
</div>
<div id="under_post_kb"><div class="itnews c_ad_block"><b>最新新闻</b>：<br> ·  <a href="https://news.cnblogs.com/n/625906/" target="_blank">一线丨中国铁塔4年：节省投资1148亿元 共享率升至75%</a><br> ·  <a href="https://news.cnblogs.com/n/625905/" target="_blank">全球亿万富豪地图出炉！有钱人最多的城市是...</a><br> ·  <a href="https://news.cnblogs.com/n/625904/" target="_blank">为何要去探测太阳——专访帕克太阳探针号首席科学家Marco Velli</a><br> ·  <a href="https://news.cnblogs.com/n/625903/" target="_blank">邬贺铨谈华为事件：华为已熟练掌握ARM架构修改</a><br> ·  <a href="https://news.cnblogs.com/n/625902/" target="_blank">独角兽Palantir上市受阻 IPO日期或延至2020年</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
 if(enablePostBottom()) {
    codeHighlight();
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverT2();
    deliverC1();
    deliverC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);  
}
</script>
</div>

    
	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/20181008163850(1).png" alt="一本正经的搞事情的头像" class="img_avatar">

<a target="_blank" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1024331014&amp;site=qq&amp;menu=yes"><img border="0" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/pa" alt="点击这里给我发消息" title="点击这里给我发消息"></a>



<!-- 为页面添加爱心特效 -->
<script type="text/javascript">window['__document_write_ajax_callbacks__']['3']();</script><script type="text/javascript">window['__document_write_ajax_callbacks__']['1']();</script><div id="profile_block">昵称：<a href="https://home.cnblogs.com/u/zhujingzhi/">一本正经的搞事情</a><br>园龄：<a href="https://home.cnblogs.com/u/zhujingzhi/" title="入园时间：2018-09-02">8个月</a><br>粉丝：<a href="https://home.cnblogs.com/u/zhujingzhi/followers/">15</a><br>关注：<a href="https://home.cnblogs.com/u/zhujingzhi/followees/">10</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="follow(&#39;74c950b8-42c2-4253-8de8-08d6108cf535&#39;)">+加关注</a></div><script type="text/javascript">window['__document_write_ajax_callbacks__']['4']();</script><script>window['__document_write_ajax_callbacks__']['2']();</script></div></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style=""><table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2019/04/01&#39;);return false;">&lt;</a></td><td align="center">2019年5月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2019/06/01&#39;);return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" align="center" abbr="日" scope="col">日</th><th class="CalDayHeader" align="center" abbr="一" scope="col">一</th><th class="CalDayHeader" align="center" abbr="二" scope="col">二</th><th class="CalDayHeader" align="center" abbr="三" scope="col">三</th><th class="CalDayHeader" align="center" abbr="四" scope="col">四</th><th class="CalDayHeader" align="center" abbr="五" scope="col">五</th><th class="CalDayHeader" align="center" abbr="六" scope="col">六</th></tr><tr><td class="CalOtherMonthDay" align="center">28</td><td class="CalOtherMonthDay" align="center">29</td><td class="CalOtherMonthDay" align="center">30</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td class="CalWeekendDay" align="center">4</td></tr><tr><td class="CalWeekendDay" align="center">5</td><td align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td align="center">10</td><td class="CalWeekendDay" align="center">11</td></tr><tr><td class="CalWeekendDay" align="center">12</td><td align="center">13</td><td align="center">14</td><td align="center">15</td><td align="center">16</td><td align="center">17</td><td class="CalWeekendDay" align="center">18</td></tr><tr><td class="CalWeekendDay" align="center">19</td><td align="center">20</td><td align="center">21</td><td align="center">22</td><td align="center">23</td><td align="center">24</td><td class="CalWeekendDay" align="center">25</td></tr><tr><td class="CalWeekendDay" align="center">26</td><td class="CalTodayDay" align="center">27</td><td align="center">28</td><td align="center">29</td><td align="center">30</td><td align="center">31</td><td class="CalOtherMonthDay" align="center">1</td></tr><tr><td class="CalOtherMonthDay" align="center">2</td><td class="CalOtherMonthDay" align="center">3</td><td class="CalOtherMonthDay" align="center">4</td><td class="CalOtherMonthDay" align="center">5</td><td class="CalOtherMonthDay" align="center">6</td><td class="CalOtherMonthDay" align="center">7</td><td class="CalOtherMonthDay" align="center">8</td></tr>
</tbody></table></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block">
<div id="sidebar_search" class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="sidebar_search_box">
<div id="widget_my_zzk" class="div_my_zzk"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk"></div>
<div id="widget_my_google" class="div_my_zzk"><input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event)" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk"></div>
</div>
</div>

</div><div id="sidebar_shortcut" class="sidebar-block">
<div class="catListLink">
<h3 class="catListTitle">常用链接</h3>
<ul>
<li><a href="https://www.cnblogs.com/zhujingzhi/p/" title="我的博客的随笔列表">我的随笔</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/MyComments.html" title="我发表过的评论列表">我的评论</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/RecentComments.html" title="我的博客的评论列表">最新评论</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/tag/" title="我的博客的标签列表">我的标签</a></li>
<li><a id="itemListLink" onclick="this.blur();WarpClass(&#39;itemListLink&#39;, &#39;itemListLin_con&#39;);return false;" href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#">更多链接</a></li>
</ul>
<div id="itemListLin_con" style="display:none;">
<ul>

</ul>
</div>
</div></div><div id="sidebar_categories">
<div class="catListPostCategory">
<h3 class="catListTitle">随笔分类</h3>

<ul>

<li><a id="CatList_LinkList_0_Link_0" href="https://www.cnblogs.com/zhujingzhi/category/1292035.html">Docker(12)</a> </li>

<li><a id="CatList_LinkList_0_Link_1" href="https://www.cnblogs.com/zhujingzhi/category/1312556.html">DockerFile(4)</a> </li>

<li><a id="CatList_LinkList_0_Link_2" href="https://www.cnblogs.com/zhujingzhi/category/1292038.html">ELK(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_3" href="https://www.cnblogs.com/zhujingzhi/category/1308069.html">Gitlab(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_4" href="https://www.cnblogs.com/zhujingzhi/category/1292036.html">K8S</a> </li>

<li><a id="CatList_LinkList_0_Link_5" href="https://www.cnblogs.com/zhujingzhi/category/1322233.html">Linux 基础服务(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_6" href="https://www.cnblogs.com/zhujingzhi/category/1317666.html">Python(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_7" href="https://www.cnblogs.com/zhujingzhi/category/1292034.html">Python模块(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_8" href="https://www.cnblogs.com/zhujingzhi/category/1292033.html">shell脚本(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_9" href="https://www.cnblogs.com/zhujingzhi/category/1292030.html">VPN(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_10" href="https://www.cnblogs.com/zhujingzhi/category/1292026.html">Web(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_11" href="https://www.cnblogs.com/zhujingzhi/category/1292023.html">备份(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_12" href="https://www.cnblogs.com/zhujingzhi/category/1292039.html">常用命令</a> </li>

<li><a id="CatList_LinkList_0_Link_13" href="https://www.cnblogs.com/zhujingzhi/category/1292024.html">存储(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_14" href="https://www.cnblogs.com/zhujingzhi/category/1292029.html">防火墙(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_15" href="https://www.cnblogs.com/zhujingzhi/category/1292027.html">负载</a> </li>

<li><a id="CatList_LinkList_0_Link_16" href="https://www.cnblogs.com/zhujingzhi/category/1292050.html">公司部署优化改造</a> </li>

<li><a id="CatList_LinkList_0_Link_17" href="https://www.cnblogs.com/zhujingzhi/category/1292051.html">公司问题库</a> </li>

<li><a id="CatList_LinkList_0_Link_18" href="https://www.cnblogs.com/zhujingzhi/category/1292031.html">监控(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_19" href="https://www.cnblogs.com/zhujingzhi/category/1296982.html">企业面试题</a> </li>

<li><a id="CatList_LinkList_0_Link_20" href="https://www.cnblogs.com/zhujingzhi/category/1292255.html">三剑客</a> </li>

<li><a id="CatList_LinkList_0_Link_21" href="https://www.cnblogs.com/zhujingzhi/category/1292025.html">数据库(6)</a> </li>

<li><a id="CatList_LinkList_0_Link_22" href="https://www.cnblogs.com/zhujingzhi/category/1292041.html">问题库</a> </li>

<li><a id="CatList_LinkList_0_Link_23" href="https://www.cnblogs.com/zhujingzhi/category/1298388.html">心理学(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_24" href="https://www.cnblogs.com/zhujingzhi/category/1295861.html">学习目标(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_25" href="https://www.cnblogs.com/zhujingzhi/category/1292037.html">云计算</a> </li>

<li><a id="CatList_LinkList_0_Link_26" href="https://www.cnblogs.com/zhujingzhi/category/1295838.html">自动化(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_27" href="https://www.cnblogs.com/zhujingzhi/category/1292028.html">自动化统一管理</a> </li>

</ul>

</div>

<div class="catListPostArchive">
<h3 class="catListTitle">随笔档案</h3>

<ul>

<li><a id="CatList_LinkList_1_Link_0" href="https://www.cnblogs.com/zhujingzhi/archive/2018/11.html">2018年11月 (4)</a> </li>

<li><a id="CatList_LinkList_1_Link_1" href="https://www.cnblogs.com/zhujingzhi/archive/2018/10.html">2018年10月 (10)</a> </li>

<li><a id="CatList_LinkList_1_Link_2" href="https://www.cnblogs.com/zhujingzhi/archive/2018/09.html">2018年9月 (26)</a> </li>

</ul>

</div>

</div><div id="sidebar_scorerank" class="sidebar-block">
<div class="catListBlogRank">
<h3 class="catListTitle">积分与排名</h3>
<ul>
	<li class="liScore">
		积分 -	49442
	</li><li class="liRank">
		排名 -	11691
	</li>
</ul>
</div>


</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<div class="catListComment">
<h3 class="catListTitle">最新评论</h3>

	<div id="RecentCommentsBlock"><ul>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/zhujingzhi/p/9760198.html#4172214">1. Re:Docker三剑客之Docker Machine</a></li>
        <li class="recent_comment_body">博主你好！在创建machine的时候，你博文中也提到了下面这个错误：Error creating machine: Error running provisioning: error installi......</li>
        <li class="recent_comment_author">--技术流ken</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/zhujingzhi/p/9609872.html#4093402">2. Re:MySQL多实例(二)</a></li>
        <li class="recent_comment_body">@故園·舊夢其实docker起MySQL多容器和MySQL的多实例实现的效果是一样的，这还是看需求和会的东西了...</li>
        <li class="recent_comment_author">--一本正经的搞事情</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/zhujingzhi/p/9609872.html#4092698">3. Re:MySQL多实例(二)</a></li>
        <li class="recent_comment_body">楼主您好，mysql多实例在实际生产环境中使用的多吗？现在有了虚拟化技术之后mysql还有必要多实例吗？</li>
        <li class="recent_comment_author">--故園·舊夢</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/zhujingzhi/p/9703457.html#4084651">4. Re:gitlab服务部署及使用</a></li>
        <li class="recent_comment_body">嘿嘿，希望大家多多来捧场</li>
        <li class="recent_comment_author">--一本正经的搞事情</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/zhujingzhi/p/9703457.html#4076585">5. Re:gitlab服务部署及使用</a></li>
        <li class="recent_comment_body">不错，看了好多汉化都不行，这次按照博主的步骤一步步做直接成功了</li>
        <li class="recent_comment_author">--胡源</li>
</ul>
</div>
</div>
</div></div><div id="sidebar_topviewedposts" class="sidebar-block"><div id="topview_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">阅读排行榜</h3>
	<div id="TopViewPostsBlock"><ul><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html">1. centos7 完整配置openvpn详情教程(5206)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9703457.html">2. gitlab服务部署及使用(3427)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9742085.html">3. 基于alpine用dockerfile创建的nginx镜像(3033)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9746760.html">4. 基于alpine用dockerfile创建的tomcat镜像(2237)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9740423.html">5. 基于alpine用dockerfile创建的ssh镜像(2164)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topcommentedposts" class="sidebar-block"><div id="topfeedback_posts_wrap">
<div class="catListFeedback">
<h3 class="catListTitle">评论排行榜</h3>
	<div id="TopFeedbackPostsBlock"><ul><li><a href="https://www.cnblogs.com/zhujingzhi/p/9609872.html">1. MySQL多实例(二)(2)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9703457.html">2. gitlab服务部署及使用(2)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9686208.html">3. paramiko模块使用(1)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9760198.html">4. Docker三剑客之Docker Machine(1)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topdiggedposts" class="sidebar-block"><div id="topdigg_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">推荐排行榜</h3>
<div id="TopDiggPostsBlock"><ul><li><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html">1. centos7 完整配置openvpn详情教程(3)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9703457.html">2. gitlab服务部署及使用(3)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9574800.html">3. Rsync备份服务(1)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9574813.html">4. NFS存储服务(1)</a></li><li><a href="https://www.cnblogs.com/zhujingzhi/p/9686208.html">5. paramiko模块使用(1)</a></li></ul></div>
</div></div></div></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright ©2019 一本正经的搞事情
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->

<!--PageEndHtml Block Begin-->
<script language="javascript" type="text/javascript">
// 生成目录索引列表
// ref: http://www.cnblogs.com/wangqiguo/p/4355032.html
// modified by: zjz
function GenerateContentList()
{
    var mainContent = $('#cnblogs_post_body');
    var h2_list = $('#cnblogs_post_body h2');//如果你的章节标题不是h2,只需要将这里的h2换掉即可

    if(mainContent.length < 1)
        return;
 
    if(h2_list.length>0)
    {
        var content = '<a name="_labelTop"></a>';
        content += '<div id="navCategory" style="color:#152e97;">';
        content += '<p style="font-size:18px;"><b>目录</b></p>';
        content += '<ul>';
        for(var i=0; i<h2_list.length; i++)
        {
            var go_to_top = '<div style="text-align: right;"><a href="#_labelTop" style="color:#f68a33">回到顶部</a><a name="_label' + i + '"></a></div>';
            $(h2_list[i]).before(go_to_top);
            
            var h4_list = $(h2_list[i]).nextAll("h4");
            var li3_content = '';
            for(var j=0; j<h4_list.length; j++)
            {
                var tmp = $(h4_list[j]).prevAll('h2').first();
                if(!tmp.is(h2_list[i]))
                    break;
                var li3_anchor = '<a name="_label' + i + '_' + j + '"></a>';
                $(h4_list[j]).before(li3_anchor);
                li3_content += '<li><a href="#_label' + i + '_' + j + '">' + $(h4_list[j]).text() + '</a></li>';
            }
            
            var li2_content = '';
            if(li3_content.length > 0)
                li2_content = '<li><a href="#_label' + i + '">' + $(h2_list[i]).text() + '</a><ul>' + li3_content + '</ul></li>';
            else
                li2_content = '<li><a href="#_label' + i + '">' + $(h2_list[i]).text() + '</a></li>';
            content += li2_content;
        }
        content += '</ul>';
        content += '</div><p>&nbsp;</p>';
        content += '<hr style="height:1px;border:none;border-top:1px dashed #0066CC;"/>';
        if($('#cnblogs_post_body').length != 0 )
        {
            $($('#cnblogs_post_body')[0]).prepend(content);
        }
    }   
}

GenerateContentList();
</script>

<span id="back-to-top"><a href="https://www.cnblogs.com/zhujingzhi/p/9905067.html#top"><img src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/o_aa.png"></a></span>

<script type="text/javascript" src="./centos7 完整配置openvpn详情教程 - 一本正经的搞事情 - 博客园_files/Comments.js.download"></script><script type="text/javascript">window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script><script type="text/javascript">
       function func(){
           var tag = document.getElementById('Scroll_info');
           var content = tag.innerText;
           var f = content.charAt(0);
           var l = content.substring(1,content.length);
           var new_content = l + f;
           tag.innerText = new_content;
       }
       setInterval('func()',1600);
</script><script type="text/javascript">

(function(window,document,undefined){
    var hearts = [];
    
    window.requestAnimationFrame = (function(){
        return window.requestAnimationFrame || 
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
         window.oRequestAnimationFrame ||
         window.msRequestAnimationFrame ||
         function (callback){
             setTimeout(callback,1000/60);
         }
    })();
    
    init();

    function init(){
        css(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
        attachEvent();
        gameloop();
    }

    function gameloop(){
        for(var i=0;i<hearts.length;i++){
            if(hearts[i].alpha <=0){
                document.body.removeChild(hearts[i].el);
                hearts.splice(i,1);
                continue;
             }

             hearts[i].y--;
             hearts[i].scale += 0.004;
             hearts[i].alpha -= 0.013;
             hearts[i].el.style.cssText = "left:"+hearts[i].x+"px;top:"+hearts[i].y+"px;opacity:"+hearts[i].alpha+";transform:scale("+hearts[i].scale+","+hearts[i].scale+") rotate(45deg);background:"+hearts[i].color;
        }

        requestAnimationFrame(gameloop);
    }

    function attachEvent(){
        var old = typeof window.onclick==="function" && window.onclick;
        window.onclick = function(event){
            old && old();
            createHeart(event);
        }
    }

    function createHeart(event){
        var d = document.createElement("div");
        d.className = "heart";
        hearts.push({
            el : d,
            x : event.clientX - 5,
            y : event.clientY - 5,
            scale : 1,
            alpha : 1,
            color : randomColor()
        });

        document.body.appendChild(d);
    }

    function css(css){
        var style = document.createElement("style");
        style.type="text/css";
        try{
            style.appendChild(document.createTextNode(css));
        }
        catch(ex){
            style.styleSheet.cssText = css;
        }

        document.getElementsByTagName('head')[0].appendChild(style);
    }

    function randomColor(){
        return "rgb("+(~~(Math.random()*255))+","+(~~(Math.random()*255))+","+(~~(Math.random()*255))+")";
    }
    
})(window,document);
</script><script type="text/javascript">getFollowStatus('74c950b8-42c2-4253-8de8-08d6108cf535')</script>






<!-- 生成博客目录的JS代码，两级目录 -->
<script type="text/javascript">
/*  
    这段代码按H2、H3格式生成两级菜单
    写博客按H2、H3格式写，不然生成不了
    Markdown写作按##、###两级目录写
    当然你也可以改写代码成三级菜单
    参考：孤傲苍狼    zhang_derek
*/
var BlogDirectory = {
    /* 获取元素位置，距浏览器左边界的距离（left）和距浏览器上边界的距离（top）*/
    getElementPosition:function (ele) {
        var topPosition = 0;
        var leftPosition = 0;
        while (ele){
            topPosition += ele.offsetTop;
            leftPosition += ele.offsetLeft;
            ele = ele.offsetParent;
        }
        return {top:topPosition, left:leftPosition};
    },
    /*获取滚动条当前位置 */
    getScrollBarPosition:function () {
        var scrollBarPosition = document.body.scrollTop || document.documentElement.scrollTop;
        return  scrollBarPosition;
    },
    /* 移动滚动条，finalPos 为目的位置，internal 为移动速度 */
    moveScrollBar:function(finalpos, interval) {
        //若不支持此方法，则退出
        if(!window.scrollTo) {
            return false;
        }
        
        //窗体滚动时，禁用鼠标滚轮
        window.onmousewheel = function(){
            return false;
        };
        
        //清除计时
        if (document.body.movement) {
            clearTimeout(document.body.movement);
        }
        
        //获取滚动条当前位置
        var currentpos =BlogDirectory.getScrollBarPosition();

        var dist = 0;
        //到达预定位置，则解禁鼠标滚轮，并退出
        if (currentpos == finalpos) {
            window.onmousewheel = function(){
                return true;
            }
            return true;
        }
        //未到达，则计算下一步所要移动的距离
        if (currentpos < finalpos) {
            dist = Math.ceil((finalpos - currentpos)/10);
            currentpos += dist;
        }
        if (currentpos > finalpos) {
            dist = Math.ceil((currentpos - finalpos)/10);
            currentpos -= dist;
        }

        var scrTop = BlogDirectory.getScrollBarPosition();//获取滚动条当前位置
        window.scrollTo(0, currentpos);//移动窗口
        if(BlogDirectory.getScrollBarPosition() == scrTop)//若已到底部，则解禁鼠标滚轮，并退出
        {
            window.onmousewheel = function(){
                return true;
            }
            return true;
        }

        //进行下一步移动
        var repeat = "BlogDirectory.moveScrollBar(" + finalpos + "," + interval + ")";
        document.body.movement = setTimeout(repeat, interval);
    },

    htmlDecode:function (text){
        var temp = document.createElement("div");
        temp.innerHTML = text;
        var output = temp.innerText || temp.textContent;
        temp = null;
        return output;
    },
    
    /*
    创建博客目录，id表示包含博文正文的 div 容器的 id，
    mt 和 st 分别表示主标题和次级标题的标签名称（如 H2、H3，大写或小写都可以！），
    interval 表示移动的速度
    */
    createBlogDirectory:function (id, mt, st, interval){
        //获取博文正文div容器
        var elem = document.getElementById(id);
        if(!elem) return false;
        //获取div中所有元素结点
        var nodes = elem.getElementsByTagName("*");
        //创建博客目录的div容器
        var divSideBar = document.createElement('DIV');
        divSideBar.className = 'uprightsideBar';
        divSideBar.setAttribute('id', 'uprightsideBar');
        var divSideBarTab = document.createElement('DIV');
        divSideBarTab.setAttribute('id', 'sideBarTab');
        divSideBar.appendChild(divSideBarTab);
        var h2 = document.createElement('H2');
        divSideBarTab.appendChild(h2);
        var txt = document.createTextNode('目录导航');
        h2.appendChild(txt);
        var divSideBarContents = document.createElement('DIV');
        divSideBarContents.style.display = 'none';
        divSideBarContents.setAttribute('id', 'sideBarContents');
        divSideBar.appendChild(divSideBarContents);
        //创建自定义列表
        var dlist = document.createElement("dl");
        divSideBarContents.appendChild(dlist);
        var num = 0;//统计找到的mt和st
        mt = mt.toUpperCase();//转化成大写
        st = st.toUpperCase();//转化成大写
        //遍历所有元素结点
        for(var i=0; i<nodes.length; i++)
        {
            if(nodes[i].nodeName == mt|| nodes[i].nodeName == st)
            {
                //获取标题文本
                var nodetext = nodes[i].innerHTML.replace(/<\/?[^>]+>/g,"");//innerHTML里面的内容可能有HTML标签，所以用正则表达式去除HTML的标签
                nodetext = nodetext.replace(/ /ig, "");//替换掉所有的
                nodetext = BlogDirectory.htmlDecode(nodetext);
                //插入锚
                nodes[i].setAttribute("id", "blogTitle" + num);
                var item;
                switch(nodes[i].nodeName)
                {
                    case mt:    //若为主标题
                        item = document.createElement("dt");
                        break;
                    case st:    //若为子标题
                        item = document.createElement("dd");
                        break;
                }

                //创建锚链接
                var itemtext = document.createTextNode(nodetext);
                item.appendChild(itemtext);
                item.setAttribute("name", num);
                //添加鼠标点击触发函数
                item.onclick = function(){        
                var pos = BlogDirectory.getElementPosition(document.getElementById("blogTitle" + this.getAttribute("name")));
                    if(!BlogDirectory.moveScrollBar(pos.top, interval)) return false;
                };
                //将自定义表项加入自定义列表中
                dlist.appendChild(item);
                num++;
            }
        }

        if(num == 0) return false;
        /* 鼠标进入时的事件处理 */
        divSideBarTab.onmouseenter = function(){
            divSideBarContents.style.display = 'block';
        }
        /* 鼠标离开时的事件处理 */
        divSideBar.onmouseleave = function() {
            divSideBarContents.style.display = 'none';
        }

        document.body.appendChild(divSideBar);
    }

};

window.onload=function(){
    /* 页面加载完成之后生成博客目录 */
    BlogDirectory.createBlogDirectory("cnblogs_post_body","h2","h4",20);
    
    //为右下角推荐推荐区域添加关注按钮
    $('#div_digg').prepend('<div style="padding-bottom: 5px"><span class="icon_favorite" style="padding-top: 2px"></span><a onclick="cnblogs.UserManager.FollowBlogger(\'9a35f2c7-18ab-e111-aa3f-842b2b196315\');" href="javascript:void(0);" style="font-weight: bold; padding-left:5px;">关注一下楼主吧</a> </div>');
}
</script>
<!--PageEndHtml Block End-->


<div class="uprightsideBar" id="uprightsideBar"><div id="sideBarTab"><h2>目录导航</h2></div><div id="sideBarContents" style="display: none;"><dl><dt name="0">1.&nbsp;什么是OpenVpn</dt><dt name="1">2.&nbsp;OpenVpn的原理</dt><dt name="2">3.&nbsp;加密和认证方式</dt><dt name="3">4.&nbsp;功能与端口</dt><dt name="4">5.配置文件详情</dt><dt name="5">6.用户名密码验证服务器端安装配置</dt><dt name="6">7.证书认证服务器配置</dt><dt name="7">8.windows客户端配置</dt><dt name="8">8.Linux客户端配置</dt></dl></div></div></body></html>