<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0049)https://bbs.archlinux.org/viewtopic.php?id=219859 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>systemd: Cryptsetup of device in crypttab does not happen - timeout / Installation / Arch Linux Forums</title>
<link rel="stylesheet" type="text/css" href="./systemd_ Cryptsetup of device in crypttab does not happen - timeout _ Installation _ Arch Linux Forums_files/ArchLinux.css">
<link rel="canonical" href="https://bbs.archlinux.org/viewtopic.php?id=219859" title="Page 1">
<link rel="next" href="https://bbs.archlinux.org/viewtopic.php?id=219859&amp;p=2" title="Page 2">
<link rel="alternate" type="application/atom+xml" href="https://bbs.archlinux.org/extern.php?action=feed&amp;tid=219859&amp;type=atom" title="Atom topic feed">
    <link rel="stylesheet" media="screen" href="./systemd_ Cryptsetup of device in crypttab does not happen - timeout _ Installation _ Arch Linux Forums_files/arch.css">
        <link rel="stylesheet" media="screen" href="./systemd_ Cryptsetup of device in crypttab does not happen - timeout _ Installation _ Arch Linux Forums_files/archnavbar.css">
    
<link rel="shortcut icon" href="https://bbs.archlinux.org/style/ArchLinux/favicon.ico">
</head>

<body>
<div id="archnavbar" class="anb-forum">
	<div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div>
	<div id="archnavbarmenu">
		<ul id="archnavbarlist">
			<li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-security"><a href="https://security.archlinux.org/">Security</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li>		</ul>
	</div>
</div>


<div id="punviewtopic" class="pun">
<div class="top-box"></div>
<div class="punwrap">

<div id="brdheader" class="block">
	<div class="box">
		<div id="brdmenu" class="inbox">
			<ul>
				<li id="navindex" class="isactive"><a href="https://bbs.archlinux.org/index.php">Index</a></li>
				<li id="navrules"><a href="https://bbs.archlinux.org/misc.php?action=rules">Rules</a></li>
				<li id="navsearch"><a href="https://bbs.archlinux.org/search.php">Search</a></li>
				<li id="navregister"><a href="https://bbs.archlinux.org/register.php">Register</a></li>
				<li id="navlogin"><a href="https://bbs.archlinux.org/login.php">Login</a></li>
			</ul>
		</div>
		<div id="brdwelcome" class="inbox">
			<p class="conl">You are not logged in.</p>
			<ul class="conr">
				<li><span>Topics: <a href="https://bbs.archlinux.org/search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="https://bbs.archlinux.org/search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li>
			</ul>
			<div class="clearer"></div>
		</div>
	</div>
</div>



<div id="brdmain">
<div class="linkst">
	<div class="inbox crumbsplus">
		<ul class="crumbs">
			<li><a href="https://bbs.archlinux.org/index.php">Index</a></li>
			<li><span>»&nbsp;</span><a href="https://bbs.archlinux.org/viewforum.php?id=17">Installation</a></li>
			<li><span>»&nbsp;</span><strong><a href="https://bbs.archlinux.org/viewtopic.php?id=219859">systemd: Cryptsetup of device in crypttab does not happen - timeout</a></strong></li>
		</ul>
		<div class="pagepost">
			<p class="pagelink conl"><span class="pages-label">Pages: </span><strong class="item1">1</strong> <a href="https://bbs.archlinux.org/viewtopic.php?id=219859&amp;p=2">2</a> <a rel="next" href="https://bbs.archlinux.org/viewtopic.php?id=219859&amp;p=2">Next</a></p>
		</div>
		<div class="clearer"></div>
	</div>
</div>

<div id="p1671295" class="blockpost rowodd firstpost blockpost1">
	<h2><span><span class="conr">#1</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1671295#p1671295">2016-11-22 11:14:03</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>lasombra</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Luzern</span></dd>
						<dd><span>Registered: 2011-09-01</span></dd>
						<dd><span>Posts: 66</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>I have installed a secondary disk (Sdb1) and formatted with a single luks-encrypted partition.</p><div class="codebox"><pre><code>lsblk -o NAME,UUID
NAME                                          UUID
sda                                           
├─sda2                                        556bf1e4-3730-4da3-8688-0f3c468bf5bb
│ └─luks-556bf1e4-3730-4da3-8688-0f3c468bf5bb jC1V25-7L1I-KG4K-iFr2-7syc-3ORc-5Ye7ji
│   ├─CryptVol-swap                           3a365fa3-de6b-4404-97aa-877c1d8331b6
│   └─CryptVol-root                           78d7fc05-a371-4808-ad4b-82cabba079a9
└─sda1                                        3E22-B7AB
sdb                                           
└─sdb1                                        1d8820b3-346c-424c-aa56-c7a6c4874e86</code></pre></div><p>The luks partition in encrypted with a keyfile which resides in /etc. I can decrypt the partition without problems using cryptsetup open. But I actually want that the device is decrypted and mapped on boot. Therefore I have setup fstab and crypttab as follows:<br>/etc/crypttab</p><div class="codebox"><pre><code># &lt;name&gt;       &lt;device&gt;                                     &lt;password&gt;              &lt;options&gt;
home           UUID=1d8820b3-346c-424c-aa56-c7a6c4874e86     /etc/keyfile.enc	    luks,timeout=15</code></pre></div><p>/etc/fstab</p><div class="codebox"><pre><code># /dev/mapper/home
/dev/mapper/home	/home     	ext4      	rw,relatime,data=ordered	0 2</code></pre></div><p>But this does not work and I get the following error at boot time:</p><div class="codebox"><pre><code>[ TIME ] timeout waiting for device dev-mapper-home.device</code></pre></div><p>I was following <a href="https://wiki.archlinux.org/index.php/Dm-crypt/System_configuration#crypttab" rel="nofollow">https://wiki.archlinux.org/index.php/Dm … n#crypttab</a> and to my understanding it should work as I have set it up.</p>
						<p class="postedit"><em>Last edited by lasombra (2016-11-22 17:13:01)</em></p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1671297" class="blockpost roweven">
	<h2><span><span class="conr">#2</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1671297#p1671297">2016-11-22 11:23:09</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>frostschutz</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd class="postavatar"><img src="./systemd_ Cryptsetup of device in crypttab does not happen - timeout _ Installation _ Arch Linux Forums_files/76897.png" width="80" height="80" alt=""></dd>
						<dd><span>Registered: 2013-11-15</span></dd>
						<dd><span>Posts: 909</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><blockquote><div><p>I can decrypt the partition without problems using cryptsetup open.</p></div></blockquote></div><p>Using the --key-file=/etc/keyfile.enc option? Sometimes there is confusion if you have newlines in that file and added it the wrong way.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1671302" class="blockpost rowodd">
	<h2><span><span class="conr">#3</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1671302#p1671302">2016-11-22 12:06:56</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>lasombra</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Luzern</span></dd>
						<dd><span>Registered: 2011-09-01</span></dd>
						<dd><span>Posts: 66</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>frostschutz wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>I can decrypt the partition without problems using cryptsetup open.</p></div></blockquote></div><p>Using the --key-file=/etc/keyfile.enc option? Sometimes there is confusion if you have newlines in that file and added it the wrong way.</p></div></blockquote></div><p>Yes here is the command I use:</p><div class="codebox"><pre><code>cryptsetup open --type luks /dev/sdb1 --key-file=/etc/keyfile.enc home</code></pre></div><p>The keyfile was created as follows:</p><div class="codebox"><pre><code>dd bs=512 count=4 if=/dev/urandom of=/etc/keyfile.enc iflag=fullblock</code></pre></div>
						<p class="postedit"><em>Last edited by lasombra (2016-11-22 12:07:15)</em></p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1671331" class="blockpost roweven">
	<h2><span><span class="conr">#4</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1671331#p1671331">2016-11-22 14:55:35</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>lasombra</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Luzern</span></dd>
						<dd><span>Registered: 2011-09-01</span></dd>
						<dd><span>Posts: 66</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>I tried adding noauto,x-systemd.automount to the fstab but with the same effect, the home partition is not decrypted and therefore not mounted</p><div class="codebox"><pre><code>/dev/mapper/home	/home     	ext4      	 noauto,x-systemd.automount,rw,relatime,data=ordered	0 2</code></pre></div>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1671373" class="blockpost rowodd">
	<h2><span><span class="conr">#5</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1671373#p1671373">2016-11-22 17:02:00</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>lasombra</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Luzern</span></dd>
						<dd><span>Registered: 2011-09-01</span></dd>
						<dd><span>Posts: 66</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>In the directory /var/run/systemd/generator I can only find the service files which take care of mounting but not of the cryptsetup for home.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1671643" class="blockpost roweven">
	<h2><span><span class="conr">#6</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1671643#p1671643">2016-11-23 19:53:35</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>lasombra</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Luzern</span></dd>
						<dd><span>Registered: 2011-09-01</span></dd>
						<dd><span>Posts: 66</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>If I check journalctl it tells me </p><div class="codebox"><pre><code>systemd-cryptsetup-generator[272]: Not creating device 'home' because it was not specified on the kernel command line</code></pre></div><p>Do I need to add kernel parameter? As I want to decrypt a non-root device I thought not. Does not make sense to me...</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1672037" class="blockpost rowodd">
	<h2><span><span class="conr">#7</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1672037#p1672037">2016-11-25 11:42:22</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>lasombra</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Luzern</span></dd>
						<dd><span>Registered: 2011-09-01</span></dd>
						<dd><span>Posts: 66</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>So when I add luks parameter for the second hard disk the home partition actually is decrypted and mounted</p><div class="codebox"><pre><code>title	Arch Linux (Systemd Cryptdev Alternative)
linux	/vmlinuz-linux
initrd	/initramfs-linux.img
options luks.uuid=556bf1e4-3730-4da3-8688-0f3c468bf5bb luks.uuid=1d8820b3-346c-424c-aa56-c7a6c4874e86 luks.key=/etc/keyfile.enc resume=/dev/mapper/CryptVol-swap root=/dev/mapper/CryptVol-root rw
1d8820b3-346c-424c-aa56-c7a6c4874e86</code></pre></div><p>However, 1) I am always asked for a password for the home partition and 2) I still don't get the point why I should provide luks parameters when I want it shall be read from crypttab</p><p>Is this a bug? Current version of systemd is 231-4</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691768" class="blockpost roweven">
	<h2><span><span class="conr">#8</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691768#p1691768">2017-02-17 20:58:15</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>Seven.issimo</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Brescia, IT</span></dd>
						<dd><span>Registered: 2008-09-07</span></dd>
						<dd><span>Posts: 8</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>I'm experiencing the same problem described in this thread (so I avoid to open a new one).</p><p>I'm trying to install Arch in relative-simple configuration with encrypted partitions,<br>but I can't get non-root partition(s) unlocked and mounted on boot as if crypttab was just ignored.</p><p>System is UEFI capable; disk is GPT partitioned; systemd-boot as chosen bootloader.<br>Desidered configuration is:</p><div class="codebox"><pre><code>sda
+-sda1 --- to be used in windows (not as OS partition!)
+-sda2     FAT / UEFI   mounted to /boot
+-sda3     LUKS         unlocked to /dev/mapper/arch
| +-arch   ext4         mounted to /
+-sda4     LUKS         unlocked to /dev/mapper/home
  +-home   ext4         mounted to /home</code></pre></div><br><p>Arch setup went smooth.</p><p>When I boot Arch, systemd-boot loads initrd and vmlinux, kernel with systemd-encrypt prompts for password, it opens luks partiton and mounts root (/). It does mount /boot, as listed on /etc/fstab, but <strong>it fails mounting 'home' because luks partition wasn't unlocked</strong>.</p><br><p>Relevant configuration:</p><h5>lsblk -f</h5><div class="codebox"><pre><code>NAME                                          FSTYPE      LABEL UUID                                 MOUNTPOINT
sda
|-sda1
|-sda2                                        vfat        UEFI  77E0-9445                            /boot
|-sda3                                        crypto_LUKS       632a70ab-b2f3-46ee-95e1-f88b1e44e250
| `-luks-632a70ab-b2f3-46ee-95e1-f88b1e44e250 ext4        arch  8dbe352c-0b5e-4e6f-b296-b342b8df0821 /
`-sda4                                        crypto_LUKS       8f9f6801-971a-48ae-9154-70930ca29e23</code></pre></div><h5>/etc/crypttab</h5><div class="codebox"><pre><code># crypttab: mappings for encrypted partitions
# &lt;name&gt;       &lt;device&gt;                               &lt;password&gt;     &lt;options&gt;
home    UUID=8f9f6801-971a-48ae-9154-70930ca29e23     none           luks</code></pre></div><p>Also tested with: 2nd param in form PARTUUID or /dev/disk/by-uuid/..., third param as keyfile path or even 'ASK', fourth param empty or not and combinations of them.</p><h5>/etc/fstab</h5><div class="codebox"><pre><code># UUID=8dbe352c-0b5e-4e6f-b296-b342b8df0821 LABEL=arch
/dev/mapper/arch        /               ext4            rw,noatime      0 1

# UUID=77E0-9445 LABEL=UEFI
UUID=77E0-9445          /boot           vfat            rw,noatime,fmask=0022,dmask=0022,errors=remount-ro      0 2

# UUID=5d35f3e0-01e4-4619-82a9-b40d30659035 LABEL=home
/dev/mapper/home        /home           ext4            rw,noatime       0 2</code></pre></div><h5>Hooks in mkinitcpio.conf</h5><div class="codebox"><pre><code>HOOKS="base systemd autodetect modconf block sd-vconsole keyboard sd-encrypt filesystems fsck"</code></pre></div><h5>/proc/cmdline</h5><div class="codebox"><pre><code>initrd=\initramfs-linux.img luks.uuid=632a70ab-b2f3-46ee-95e1-f88b1e44e250 root=/dev/mapper/luks-632a70ab-b2f3-46ee-95e1-f88b1e44e250 luks.crypttab=yes</code></pre></div><h5>systemd-cryptsetup-generator</h5><div class="codebox"><pre><code>~# /usr/lib/systemd/system-generators/systemd-cryptsetup-generator
Not creating device 'home' because it was not specified on the kernel command line.

~# ls /var/run/systemd/generator/**
 /var/run/systemd/generator/-.mount
 /var/run/systemd/generator/boot.mount
 /var/run/systemd/generator/home.mount
'/var/run/systemd/generator/systemd-cryptsetup@luks\x2d632a70ab\x2db2f3\x2d46ee\x2d95e1\x2df88b1e44e250.service'

/var/run/systemd/generator/cryptsetup.target.requires:
'systemd-cryptsetup@luks\x2d632a70ab\x2db2f3\x2d46ee\x2d95e1\x2df88b1e44e250.service'

'/var/run/systemd/generator/dev-disk-by\x2duuid-632a70ab\x2db2f3\x2d46ee\x2d95e1\x2df88b1e44e250.device.wants':
'systemd-cryptsetup@luks\x2d632a70ab\x2db2f3\x2d46ee\x2d95e1\x2df88b1e44e250.service'

'/var/run/systemd/generator/dev-mapper-luks\x2d632a70ab\x2db2f3\x2d46ee\x2d95e1\x2df88b1e44e250.device.d':
90-device-timeout.conf

'/var/run/systemd/generator/dev-mapper-luks\x2d632a70ab\x2db2f3\x2d46ee\x2d95e1\x2df88b1e44e250.device.requires':
'systemd-cryptsetup@luks\x2d632a70ab\x2db2f3\x2d46ee\x2d95e1\x2df88b1e44e250.service'

/var/run/systemd/generator/local-fs.target.requires:
-.mount  boot.mount

/var/run/systemd/generator/local-fs.target.wants:
home.mount  systemd-fsck-root.service</code></pre></div><p>In addition I should mention that, if I manually open sda4 to /dev/mapper/home, it gets automatically mounted.</p><br><h5>tl;dr</h5><p><strong>/etc/crypttab seems to be ingored by systemd despite luks.crypttab=yes</strong></p><p>As documented on <a href="https://wiki.archlinux.org/index.php/Dm-crypt/System_configuration#crypttab" rel="nofollow">ArchWiki</a> and <a href="https://www.freedesktop.org/software/systemd/man/systemd-cryptsetup-generator.html#luks.crypttab=" rel="nofollow">here</a>, systemd-cryptsetup-generator should consider LUKS devices listed on /etc/crypttab and open them on boot.<br>Am I missing something?</p><br><p>PS. Add every LUKS device on kernel command line seems dumb to me.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691788" class="blockpost rowodd">
	<h2><span><span class="conr">#9</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691788#p1691788">2017-02-18 01:44:45</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>rdeckard</strong></dt>
						<dd class="usertitle"><strong>Wiki Maintainer</strong></dd>
						<dd><span>Registered: 2015-01-28</span></dd>
						<dd><span>Posts: 137</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>It looks like you're using the "sd-encrypt" hook. Have you tried the "encrypt" hook with the equivalent options as a comparison?</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691815" class="blockpost roweven">
	<h2><span><span class="conr">#10</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691815#p1691815">2017-02-18 09:15:53</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>userak</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>Registered: 2017-02-04</span></dd>
						<dd><span>Posts: 39</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>I'm facing the similar problem. The home partition which&nbsp; is encypted with luks fail to map&nbsp; at boot time, with the error "device not responding or busy".</p><p>Actually Despite of the above error home parition is getting mapped and mounted. I choose to put the name of home partition as "crypt_home" in crypttab file, but it is getting mapped as "home".</p><p>You guys should try changing the kernel command line parameter "luks" to "rd.luks" home partition should get mapped, it did in my case. However the bootlogs still shows the same error.</p><p><a href="https://bbs.archlinux.org/viewtopic.php?id=222758" rel="nofollow"> Here is the thread I posted the similar problem"</a></p>
						<p class="postedit"><em>Last edited by userak (2017-02-18 09:17:41)</em></p>
					</div>
					<div class="postsignature postmsg"><hr><p>A newbie archlinux user ...</p></div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691823" class="blockpost rowodd">
	<h2><span><span class="conr">#11</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691823#p1691823">2017-02-18 10:10:58</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>Seven.issimo</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Brescia, IT</span></dd>
						<dd><span>Registered: 2008-09-07</span></dd>
						<dd><span>Posts: 8</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>rdeckard wrote:</cite><blockquote><div><p>It looks like you're using the "sd-encrypt" hook. Have you tried the "encrypt" hook with the equivalent options as a comparison?</p></div></blockquote></div><p>Encrypt hook works like a charm without messing init command line as I expect since /etc/crypttab exists.</p><p>Can I say it's a systemd-encrypt bug?<br>or do I misunderstood something and I'm missing some configuration?</p><div class="quotebox"><cite>userak wrote:</cite><blockquote><div><p>You guys should try changing the kernel command line parameter "luks" to "rd.luks" home partition should get mapped, it did in my case. However the bootlogs still shows the same error.</p></div></blockquote></div><p>I haven't any luks/rd.luks entry related to 'home' on my kernel command line and I do not want add it. It does not make sense.</p><p>Imho, kernel command line is supposed to boot the system from scratch, with no more than basic capabilities, while /etc/crypttab (as like /etc/fstab) complete system configuration.<br>Imagine a machine (server?) with 10+ luks partitions... what would kernel command line become?</p><p>(Although, as I have already tested, this works around the problem)</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691847" class="blockpost roweven">
	<h2><span><span class="conr">#12</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691847#p1691847">2017-02-18 11:57:59</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>userak</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>Registered: 2017-02-04</span></dd>
						<dd><span>Posts: 39</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>@Seven.issimo </p><p>I myself don't have 'home' related entry on the kernel command line.&nbsp; I tried changing the the parameter for the root partition from "luks" to "rd.luks" and it is getting mapped ( It is getting mapped but not with name "crypt_home" that I have specified in crypttab file ).</p><p>Btw How many times&nbsp; it should ask me to enter password during boot , if&nbsp; I'm not using any password files&nbsp; and&nbsp; "boot" "root" "home" "swap" are separate partitions&nbsp; encrypted with luks .</p>
					</div>
					<div class="postsignature postmsg"><hr><p>A newbie archlinux user ...</p></div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691852" class="blockpost rowodd">
	<h2><span><span class="conr">#13</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691852#p1691852">2017-02-18 12:22:07</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>Seven.issimo</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Brescia, IT</span></dd>
						<dd><span>Registered: 2008-09-07</span></dd>
						<dd><span>Posts: 8</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>userak wrote:</cite><blockquote><div><p>I myself don't have 'home' related entry on the kernel command line.&nbsp; I tried changing the the parameter for the root partition from "luks" to "rd.luks" and it is getting mapped ( It is getting mapped but not with name "crypt_home" that I have specified in crypttab file ).</p></div></blockquote></div><p>Maybe I misunderstood your suggestion.</p><p>However my problem is not root-related or mapping name related:<br>luks.uuid=&lt;uuid&gt; and root=/dev/mapper/luks-&lt;uuid&gt; handle my encrypted root with no issues.</p><div class="quotebox"><cite>userak wrote:</cite><blockquote><div><p>Btw How many times&nbsp; it should ask me to enter password during boot , if&nbsp; I'm not using any password files&nbsp; and&nbsp; "boot" "root" "home" "swap" are separate partitions&nbsp; encrypted with luks .</p></div></blockquote></div><p>That's exactly the point.<br>That's because boot process (not bootloader) should attempt /etc/crypttab with all its devices and keyfiles (or random keyfile for swap).</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691864" class="blockpost roweven">
	<h2><span><span class="conr">#14</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691864#p1691864">2017-02-18 13:01:04</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>userak</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>Registered: 2017-02-04</span></dd>
						<dd><span>Posts: 39</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>@Seven.issimo&nbsp; Yeah&nbsp; I think there is some communication gap ... may be I'm not able to explain the scenario properly. English is 3rd language for me.</p><p>During boot I'm being asked to enter password only 2 times .&nbsp; One buy the grub to unlock the "boot" parittion&nbsp; and other&nbsp; by the&nbsp; systemd-cryptsetup&nbsp; to unlock "root" partition .&nbsp; I'm not being asked password for "swap" and "home" partions.&nbsp; Which is peculiar since&nbsp; I have not specified any keyfile in&nbsp; "crypttab" file and even then&nbsp; both the partitions are getting mapped somehow and are accessible . </p><p>What is going on ?</p><p>Did switching to init instead of systemd-boot&nbsp; resolved the problem ?</p>
						<p class="postedit"><em>Last edited by userak (2017-02-18 13:14:13)</em></p>
					</div>
					<div class="postsignature postmsg"><hr><p>A newbie archlinux user ...</p></div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691869" class="blockpost rowodd">
	<h2><span><span class="conr">#15</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691869#p1691869">2017-02-18 13:28:28</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>userak</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>Registered: 2017-02-04</span></dd>
						<dd><span>Posts: 39</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>Seven.issimo wrote:</cite><blockquote><div><p>However my problem is not root-related or mapping name related:<br>luks.uuid=&lt;uuid&gt; and root=/dev/mapper/luks-&lt;uuid&gt; handle my encrypted root with no issues.</p></div></blockquote></div><p>I think, again there is some confusion .&nbsp; specifying root partition with the parameter&nbsp; luks.uuid=&lt;uuid of root partition &gt; fails to mount home paritition . While on specifying the same parameter as rd.luks.uuid=&lt;uuid of root partition&gt; "home" gets mapped somehow. </p><p><a href="https://wiki.archlinux.org/index.php/Dm-crypt/System_configuration" rel="nofollow">Following is the quote from this page</a></p><br><div class="quotebox"><blockquote><div><p>Note: If you use luks.* kernel parameters for the rootfs while also using /etc/crypttab for the swap then systemd will complain about "Not creating device 'swap' because it was not specified on the kernel command line.". To fix this issue just use rd.luks.* parameters instead.</p></div></blockquote></div>
						<p class="postedit"><em>Last edited by userak (2017-02-18 13:29:44)</em></p>
					</div>
					<div class="postsignature postmsg"><hr><p>A newbie archlinux user ...</p></div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691872" class="blockpost roweven">
	<h2><span><span class="conr">#16</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691872#p1691872">2017-02-18 13:30:41</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>teateawhy</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: GER</span></dd>
						<dd><span>Registered: 2012-03-05</span></dd>
						<dd><span>Posts: 1,135</span></dd>
						<dd class="usercontacts"><span class="website"><a href="https://github.com/vitamins/archinstaller" rel="nofollow">Website</a></span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>I can confirm the problem with crypttab, it seems to be a bug in systemd.<br>I usually use a keyfile, but in order to test this i replaced the keyfile path in /etc/crypttab with "none". Now systemd asks for a password, but after i typed half of it, it skips over the password entry before i can press enter, and nothing gets done.<br>What's even worse is that some characters of the password are typed into the console and visible after the password entry is skipped.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691876" class="blockpost rowodd">
	<h2><span><span class="conr">#17</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691876#p1691876">2017-02-18 13:41:13</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>userak</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>Registered: 2017-02-04</span></dd>
						<dd><span>Posts: 39</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>userak wrote:</cite><blockquote><div><p>Btw How many times&nbsp; it should ask me to enter password during boot , if&nbsp; I'm not using any password files&nbsp; and&nbsp; "boot" "root" "home" "swap" are separate partitions&nbsp; encrypted with luks .</p></div></blockquote></div><p>@teateawhy can you confirm the case mentioned in above quote.</p>
					</div>
					<div class="postsignature postmsg"><hr><p>A newbie archlinux user ...</p></div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691884" class="blockpost roweven">
	<h2><span><span class="conr">#18</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691884#p1691884">2017-02-18 14:03:33</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>teateawhy</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: GER</span></dd>
						<dd><span>Registered: 2012-03-05</span></dd>
						<dd><span>Posts: 1,135</span></dd>
						<dd class="usercontacts"><span class="website"><a href="https://github.com/vitamins/archinstaller" rel="nofollow">Website</a></span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>userak wrote:</cite><blockquote><div><div class="quotebox"><cite>userak wrote:</cite><blockquote><div><p>Btw How many times&nbsp; it should ask me to enter password during boot , if&nbsp; I'm not using any password files&nbsp; and&nbsp; "boot" "root" "home" "swap" are separate partitions&nbsp; encrypted with luks .</p></div></blockquote></div><p>@teateawhy can you confirm the case mentioned in above quote.</p></div></blockquote></div><p>I added a second entry to crypttab as a test,&nbsp; but i can't really confirm or deny this quote, since the the first password entry isn't completed, i can't say what happens after that.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691901" class="blockpost rowodd">
	<h2><span><span class="conr">#19</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691901#p1691901">2017-02-18 16:02:21</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>Seven.issimo</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Brescia, IT</span></dd>
						<dd><span>Registered: 2008-09-07</span></dd>
						<dd><span>Posts: 8</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>userak wrote:</cite><blockquote><div><div class="quotebox"><cite>Seven.issimo wrote:</cite><blockquote><div><p>However my problem is not root-related or mapping name related:<br>luks.uuid=&lt;uuid&gt; and root=/dev/mapper/luks-&lt;uuid&gt; handle my encrypted root with no issues.</p></div></blockquote></div><p>I think, again there is some confusion .&nbsp; specifying root partition with the parameter&nbsp; luks.uuid=&lt;uuid of root partition &gt; fails to mount home paritition . While on specifying the same parameter as rd.luks.uuid=&lt;uuid of root partition&gt; "home" gets mapped somehow. </p><p><a href="https://wiki.archlinux.org/index.php/Dm-crypt/System_configuration" rel="nofollow">Following is the quote from this page</a></p><div class="quotebox"><blockquote><div><p>Note: If you use luks.* kernel parameters for the rootfs while also using /etc/crypttab for the swap then systemd will complain about "Not creating device 'swap' because it was not specified on the kernel command line.". To fix this issue just use rd.luks.* parameters instead.</p></div></blockquote></div></div></blockquote></div><br><p>This works!</p><p>Thank @userak, I'm really sorry I misunderstood your suggestion. But I can't find any logic in systemd behaviour.</p><p>Moreover, imao, ArchWiki is not clear at all on this: it refers to 'rootfs' and 'swap' but, apparently, systemd ignores the entire crypttab if luks.uuid option is specified.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691917" class="blockpost roweven">
	<h2><span><span class="conr">#20</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691917#p1691917">2017-02-18 16:40:39</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>Seven.issimo</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Brescia, IT</span></dd>
						<dd><span>Registered: 2008-09-07</span></dd>
						<dd><span>Posts: 8</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>I'm trying to test teateawhy's issue: I added second entry to /etc/crypttab and removed keyfile for home. This should give me at least 2 prompt (after rootfs one).</p><p>I really don't know how but 'home' get opened and mounted without password prompt <img src="./systemd_ Cryptsetup of device in crypttab does not happen - timeout _ Installation _ Arch Linux Forums_files/neutral.png" width="15" height="15" alt="neutral"><br>Instead I am asked my password for the second partition (as expected).</p><p>However, in no case, boot continues without waiting for complete password input.</p><p><a href="http://i64.tinypic.com/2evyxig.png" rel="nofollow">Screenshot</a></p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1691929" class="blockpost rowodd">
	<h2><span><span class="conr">#21</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1691929#p1691929">2017-02-18 17:35:13</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>userak</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>Registered: 2017-02-04</span></dd>
						<dd><span>Posts: 39</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>Glad it worked...&nbsp; However there is something more to it ... Try going through the bootlogs with the cmd&nbsp; &nbsp;"journalctl -b"&nbsp; and see if there are any mapping error. The device mapped name problem that I was talking about might be&nbsp; there ..&nbsp; I saw your "crypttab" file you have named the device as "home"&nbsp; so you might not be noticing that problem. Try naming the "home" partion device name to something else&nbsp; in "crypttab" and "fstab" files and see if it still works. It is working in my case.</p>
						<p class="postedit"><em>Last edited by userak (2017-02-18 17:39:53)</em></p>
					</div>
					<div class="postsignature postmsg"><hr><p>A newbie archlinux user ...</p></div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1692004" class="blockpost roweven">
	<h2><span><span class="conr">#22</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1692004#p1692004">2017-02-18 21:30:36</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>Seven.issimo</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Brescia, IT</span></dd>
						<dd><span>Registered: 2008-09-07</span></dd>
						<dd><span>Posts: 8</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>userak wrote:</cite><blockquote><div><p>Glad it worked...&nbsp; However there is something more to it ... Try going through the bootlogs with the cmd&nbsp; &nbsp;"journalctl -b"&nbsp; and see if there are any mapping error. The device mapped name problem that I was talking about might be&nbsp; there ..&nbsp; I saw your "crypttab" file you have named the device as "home"&nbsp; so you might not be noticing that problem. Try naming the "home" partion device name to something else&nbsp; in "crypttab" and "fstab" files and see if it still works. It is working in my case.</p></div></blockquote></div><p>I changed my /etc/crypttab to:</p><div class="codebox"><pre><code># PART=sda4 LABEL=none WAS=home
whatever        UUID=8f9f6801-971a-48ae-9154-70930ca29e23    none     luks

# PART=sda1 LABEL=none WAS=test
disk_123        UUID=9bd3addc-8c6b-4b92-8acb-c7b6f97fe0c2    none     luks</code></pre></div><p><strong>* With /etc/fstab untouched</strong> (with /dev/mapper/home and /dev/mapper/test)<br>...boot fails as I could expect. <a href="http://oi66.tinypic.com/11j91ua.jpg" rel="nofollow">screenshot</a></p><p><strong>* Updating /etc/fstab</strong> to reflect crypttab changes, it works and get me to this configuration:</p><div class="codebox"><pre><code># lsblk -f
NAME                                          FSTYPE      LABEL UUID                                 MOUNTPOINT
sda
|-sda1                                        crypto_LUKS       9bd3addc-8c6b-4b92-8acb-c7b6f97fe0c2
| `-disk_123                                  ntfs              5F9F0FFC2E3D2419                     /root/test
|-sda2                                        vfat        UEFI  77E0-9445                            /boot
|-sda3                                        crypto_LUKS       632a70ab-b2f3-46ee-95e1-f88b1e44e250
| `-luks-632a70ab-b2f3-46ee-95e1-f88b1e44e250 ext4        arch  8dbe352c-0b5e-4e6f-b296-b342b8df0821 /
`-sda4                                        crypto_LUKS       8f9f6801-971a-48ae-9154-70930ca29e23
  `-whatever                                  ext4        home  5d35f3e0-01e4-4619-82a9-b40d30659035 /home</code></pre></div><br><p>Still remains my doubts about how 'home' is unlocked without password prompt or keyfile.</p><p>With these same /etc/crypttab and /etc/fstab, but <strong><span class="bbu">with encrypt hook (instead of sd-encrypt one)</span></strong>, I'm prompted for three passwords: first one for rootfs, then for 'whatever' (home) and then for disk_123.</p>
						<p class="postedit"><em>Last edited by Seven.issimo (2017-02-20 09:22:56)</em></p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1692325" class="blockpost rowodd">
	<h2><span><span class="conr">#23</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1692325#p1692325">2017-02-19 23:10:30</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>damjan</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>Registered: 2006-05-30</span></dd>
						<dd><span>Posts: 416</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<p>A very similar scenario works for me fine, since … 2 year ago at least.</p><p>I have root and home luks partitions, root is decrypted from the initramfs - which asks for a password. in /etc on the root partition I have the key file for home, so only one password is needed.</p><p>/etc/crypttab:<br>home&nbsp; &nbsp; &nbsp; &nbsp;UUID=xyz-abc-....&nbsp; &nbsp; /etc/crypttab.home&nbsp; &nbsp; &nbsp; discard</p><p>/etc/fstab:<br>/dev/mapper/home&nbsp; &nbsp; &nbsp; &nbsp; /home&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ext4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rw,noatime,data=ordered,discard 0 2</p><p>kernel command line is:<br>cryptdevice=UUID=yyy-ppprrr-xxx:root:allow-discards root=/dev/mapper/root rw elevator=noop quiet</p><p>/etc/mkinitcpio.conf:<br>HOOKS="base udev autodetect modconf block encrypt filesystems keyboard fsck"</p><br><p>Things to check:<br>- make sure your initramfs doesn't contain weird things, like old copies of crypttab, other hooks etc<br>- permissions of /etc/crypttab* are 600</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1692398" class="blockpost roweven">
	<h2><span><span class="conr">#24</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1692398#p1692398">2017-02-20 09:40:39</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>Seven.issimo</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>From: Brescia, IT</span></dd>
						<dd><span>Registered: 2008-09-07</span></dd>
						<dd><span>Posts: 8</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>damjan wrote:</cite><blockquote><div><p>/etc/mkinitcpio.conf:<br>HOOKS="base udev autodetect modconf block encrypt filesystems keyboard fsck"</p><p>Things to check:<br>- make sure your initramfs doesn't contain weird things, like old copies of crypttab, other hooks etc<br>- permissions of /etc/crypttab* are 600</p></div></blockquote></div><p>Thank @damjan but my (our) problem is <strong><span class="bbu">not with 'encrypt' hook</span></strong>.<br>As I mentioned above, it does work like a charm prompting a password each luks device listed in /etc/crypttab.</p><p>Issue of "auto-unlocking home" happen with <strong><span class="bbu">sd-encrypt hook (= systemd-cryptsetup)</span></strong>.</p><p>And I'm curious to investigate the wierd behavior of systemd-cryptsetup...</p>
					</div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div id="p1692401" class="blockpost rowodd">
	<h2><span><span class="conr">#25</span> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1692401#p1692401">2017-02-20 10:25:35</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postbody">
				<div class="postleft">
					<dl>
						<dt><strong>userak</strong></dt>
						<dd class="usertitle"><strong>Member</strong></dd>
						<dd><span>Registered: 2017-02-04</span></dd>
						<dd><span>Posts: 39</span></dd>
					</dl>
				</div>
				<div class="postright">
					<h3>Re: systemd: Cryptsetup of device in crypttab does not happen - timeout</h3>
					<div class="postmsg">
						<div class="quotebox"><cite>Seven.issimo wrote:</cite><blockquote><div><p>I changed my /etc/crypttab to:</p><div class="codebox"><pre><code># PART=sda4 LABEL=none WAS=home
whatever        UUID=8f9f6801-971a-48ae-9154-70930ca29e23    none     luks

# PART=sda1 LABEL=none WAS=test
disk_123        UUID=9bd3addc-8c6b-4b92-8acb-c7b6f97fe0c2    none     luks</code></pre></div><p><strong>* With /etc/fstab untouched</strong> (with /dev/mapper/home and /dev/mapper/test)<br>...boot fails as I could expect. <a href="http://oi66.tinypic.com/11j91ua.jpg" rel="nofollow">screenshot</a></p><p><strong>* Updating /etc/fstab</strong> to reflect crypttab changes, it works and get me to this configuration:</p><div class="codebox"><pre><code># lsblk -f
NAME                                          FSTYPE      LABEL UUID                                 MOUNTPOINT
sda
|-sda1                                        crypto_LUKS       9bd3addc-8c6b-4b92-8acb-c7b6f97fe0c2
| `-disk_123                                  ntfs              5F9F0FFC2E3D2419                     /root/test
|-sda2                                        vfat        UEFI  77E0-9445                            /boot
|-sda3                                        crypto_LUKS       632a70ab-b2f3-46ee-95e1-f88b1e44e250
| `-luks-632a70ab-b2f3-46ee-95e1-f88b1e44e250 ext4        arch  8dbe352c-0b5e-4e6f-b296-b342b8df0821 /
`-sda4                                        crypto_LUKS       8f9f6801-971a-48ae-9154-70930ca29e23
  `-whatever                                  ext4        home  5d35f3e0-01e4-4619-82a9-b40d30659035 /home</code></pre></div></div></blockquote></div><p>Did you tried this with sd-encrypt hooks ... because this problem is unique to systemd-boot and not init boot.</p>
					</div>
					<div class="postsignature postmsg"><hr><p>A newbie archlinux user ...</p></div>
				</div>
			</div>
		</div>
		<div class="inbox">
			<div class="postfoot clearb">
				<div class="postfootleft"><p><span>Offline</span></p></div>
			</div>
		</div>
	</div>
</div>

<div class="postlinksb">
	<div class="inbox crumbsplus">
		<div class="pagepost">
			<p class="pagelink conl"><span class="pages-label">Pages: </span><strong class="item1">1</strong> <a href="https://bbs.archlinux.org/viewtopic.php?id=219859&amp;p=2">2</a> <a rel="next" href="https://bbs.archlinux.org/viewtopic.php?id=219859&amp;p=2">Next</a></p>
		</div>
		<ul class="crumbs">
			<li><a href="https://bbs.archlinux.org/index.php">Index</a></li>
			<li><span>»&nbsp;</span><a href="https://bbs.archlinux.org/viewforum.php?id=17">Installation</a></li>
			<li><span>»&nbsp;</span><strong><a href="https://bbs.archlinux.org/viewtopic.php?id=219859">systemd: Cryptsetup of device in crypttab does not happen - timeout</a></strong></li>
		</ul>
		<div class="clearer"></div>
	</div>
</div>
</div>

<div id="brdfooter" class="block">
	<h2><span>Board footer</span></h2>
	<div class="box">
		<div id="brdfooternav" class="inbox">
			<div class="conl">
				<form id="qjump" method="get" action="https://bbs.archlinux.org/viewforum.php">
					<div><label><span>Jump to<br></span>
					<select name="id" onchange="window.location=(&#39;viewforum.php?id=&#39;+this.options[this.selectedIndex].value)">
						<optgroup label="Technical Issues and Assistance">
							<option value="23">Newbie Corner</option>
							<option value="17" selected="selected">Installation</option>
							<option value="22">Kernel &amp; Hardware</option>
							<option value="18">Applications &amp; Desktop Environments</option>
							<option value="31">Laptop Issues</option>
							<option value="8">Networking, Server, and Protection</option>
							<option value="32">Multimedia and Games</option>
							<option value="50">System Administration</option>
							<option value="35">Other Architectures</option>
						</optgroup>
						<optgroup label="Arch-centric">
							<option value="24">Announcements, Package &amp; Security Advisories</option>
							<option value="1">Arch Discussion</option>
							<option value="13">Forum &amp; Wiki discussion</option>
						</optgroup>
						<optgroup label="Pacman Upgrades, Packaging &amp; AUR">
							<option value="44">Pacman &amp; Package Upgrade Issues</option>
							<option value="49">[testing] Repo Forum</option>
							<option value="4">Creating &amp; Modifying Packages</option>
							<option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option>
						</optgroup>
						<optgroup label="Contributions &amp; Discussion">
							<option value="20">GNU/Linux Discussion</option>
							<option value="27">Community Contributions</option>
							<option value="33">Programming &amp; Scripting</option>
							<option value="30">Other Languages</option>
							<option value="47">Artwork and Screenshots</option>
						</optgroup>
					</select></label>
					<input type="submit" value=" Go " accesskey="g">
					</div>
				</form>
			</div>
			<div class="conr">
				<p id="feedlinks"><span class="atom"><a href="https://bbs.archlinux.org/extern.php?action=feed&amp;tid=219859&amp;type=atom">Atom topic feed</a></span></p>
				<p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p>
			</div>
			<div class="clearer"></div>
		</div>
	</div>
</div>

</div>
<div class="end-box"></div>
</div>



</body></html>