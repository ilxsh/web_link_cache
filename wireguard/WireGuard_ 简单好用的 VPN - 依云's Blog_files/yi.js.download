'use strict'

const send_yi = function(data) {
  const xhr = new XMLHttpRequest()
  xhr.open('POST', 'https://lab.lilydjwg.me/cgi-bin/yi', true)
  xhr.onload = function() {
    if(xhr.status == 200) {
      localStorage.yi = true
    } else {
      console.error(xhr)
    }
  }
  xhr.send(data)
}

const main = function() {
  const canvas = document.createElement('canvas')
  canvas.width = '100'
  canvas.height = '60'
  const ctx = canvas.getContext('2d')
  ctx.font = '48px sans-serif'
  ctx.fillText('依云', 4, 48)
  const url = canvas.toDataURL()

  const data = url.substr('data:image/png;base64,'.length)
  send_yi(data)
}

if(!(localStorage && localStorage.yi)) {
  main()
}
