<!DOCTYPE html>
<html class="client-js" dir="ltr" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title>WireGuard (简体中文) - ArchWiki</title>
<script>document.documentElement.className="client-js";RLCONF={"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"WireGuard_(简体中文)","wgTitle":"WireGuard (简体中文)","wgCurRevisionId":609817,"wgRevisionId":609817,"wgArticleId":26928,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Pages with broken package links","Pages with broken section links","Virtual Private Network (简体中文)"],"wgBreakFrames":!1,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"WireGuard_(简体中文)","wgRelevantArticleId":26928,"wgRequestId"
:"6abe410f590323a23cf843da","wgCSPNonce":!1,"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[]};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.toc.styles":"ready","zzz.ext.archLinux.styles":"ready","skins.vector.styles.responsive":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"};RLPAGEMODULES=["site","mediawiki.page.startup","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.tokens@tffin",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="WireGuard%20(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)%20-%20ArchWiki_files/load.css">
<script async="" src="WireGuard%20(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)%20-%20ArchWiki_files/load.php"></script>
<style>
.suggestions{overflow:hidden;position:absolute;top:0;left:0;width:0;border:0;z-index:1099;padding:0;margin:-1px 0 0 0}.suggestions-special{position:relative;background-color:#fff;cursor:pointer;border:1px solid #a2a9b1;margin:0;margin-top:-2px;display:none;padding:0.25em 0.25em;line-height:1.25em}.suggestions-results{background-color:#fff;cursor:pointer;border:1px solid #a2a9b1;padding:0;margin:0}.suggestions-result{color:#000;margin:0;line-height:1.5em;padding:0.01em 0.25em;text-align:left; overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.suggestions-result-current{background-color:#2a4b8d;color:#fff}.suggestions-special .special-label{color:#72777d;text-align:left}.suggestions-special .special-query{color:#000;font-style:italic;text-align:left}.suggestions-special .special-hover{background-color:#c8ccd1}.suggestions-result-current .special-label,.suggestions-result-current .special-query{color:#fff}.highlight{font-weight:bold}
@media screen {
	.tochidden,.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.toctoggle{font-size:94%}}
@media print {
	.toc.tochidden,.toctoggle{display:none}}</style><style>
.suggestions a.mw-searchSuggest-link,.suggestions a.mw-searchSuggest-link:hover,.suggestions a.mw-searchSuggest-link:active,.suggestions a.mw-searchSuggest-link:focus{color:#000;text-decoration:none}.suggestions-result-current a.mw-searchSuggest-link,.suggestions-result-current a.mw-searchSuggest-link:hover,.suggestions-result-current a.mw-searchSuggest-link:active,.suggestions-result-current a.mw-searchSuggest-link:focus{color:#fff}.suggestions a.mw-searchSuggest-link .special-query{ overflow:hidden;text-overflow:ellipsis;white-space:nowrap}</style><meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="WireGuard%20(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)%20-%20ArchWiki_files/load_002.css">
<meta name="generator" content="MediaWiki 1.34.1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="https://wiki.archlinux.org/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="https://wiki.archlinux.org/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="https://wiki.archlinux.org/index.php?title=Special:RecentChanges&amp;feed=atom">
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-WireGuard_简体中文 rootpage-WireGuard_简体中文 skin-vector action-view"><div id="archnavbar" class="noprint">
    <div id="archnavbarlogo">
        <p><a id="logo" href="https://www.archlinux.org/"></a></p>
    </div>
    <div id="archnavbarmenu">
        <ul id="archnavbarlist">
                        <li id="anb-home"><a href="https://www.archlinux.org/">Home</a></li>            <li id="anb-packages"><a href="https://www.archlinux.org/packages/">Packages</a></li>            <li id="anb-forums"><a href="https://bbs.archlinux.org/">Forums</a></li>            <li id="anb-wiki" class="anb-selected"><a href="https://wiki.archlinux.org/">Wiki</a></li>            <li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li>            <li id="anb-security"><a href="https://security.archlinux.org/">Security</a></li>            <li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li>            <li id="anb-download"><a href="https://www.archlinux.org/download/">Download</a></li>        </ul>
    </div>
</div>

<div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading" class="firstHeading" lang="en">WireGuard (简体中文)</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" dir="ltr" class="mw-content-ltr" lang="en"><div class="mw-parser-output"><div class="noprint archwiki-template-message">
<p><a href="https://wiki.archlinux.org/index.php/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="WireGuard%20(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)%20-%20ArchWiki_files/Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>本页面需要更新翻译。要贡献翻译，请访问<a href="https://wiki.archlinux.org/index.php/ArchWiki_Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" class="mw-redirect" title="ArchWiki Translation Team (简体中文)">简体中文翻译团队</a>。</b><a href="https://wiki.archlinux.org/index.php/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="WireGuard%20(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)%20-%20ArchWiki_files/Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div><b>附注：</b><span style="color:red;">请使用模板的第一个参数进行更详细的指示。</span></div>
</div>
<p>From the <a rel="nofollow" class="external text" href="https://www.wireguard.com/">WireGuard</a> project homepage: 
</p>
<dl><dd>Wireguard is an extremely simple yet fast and modern VPN that 
utilizes state-of-the-art cryptography. It aims to be faster, simpler, 
leaner, and more useful than IPSec, while avoiding the massive headache.
 It intends to be considerably more performant than OpenVPN. WireGuard 
is designed as a general purpose VPN for running on embedded interfaces 
and super computers alike, fit for many different circumstances. 
Initially released for the Linux kernel, it plans to be cross-platform 
and widely deployable. It is currently under heavy development, but 
already it might be regarded as the most secure, easiest to use, and 
simplest VPN solution in the industry.</dd></dl>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> <i>WireGuard has not undergone proper degrees of security auditing and the protocol is still subject to change.</i><a rel="nofollow" class="external autonumber" href="https://www.wireguard.com/#work-in-progress">[1]</a></div>
<div id="toc" class="toc"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" dir="ltr" lang="en"><h2>Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#安装"><span class="tocnumber">1</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#使用"><span class="tocnumber">2</span> <span class="toctext">使用</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Peer_A_配置"><span class="tocnumber">2.1</span> <span class="toctext">Peer A 配置</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Peer_B_配置"><span class="tocnumber">2.2</span> <span class="toctext">Peer B 配置</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#基本检查"><span class="tocnumber">2.3</span> <span class="toctext">基本检查</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#配置持久化"><span class="tocnumber">2.4</span> <span class="toctext">配置持久化</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#示例_peer_配置"><span class="tocnumber">2.5</span> <span class="toctext">示例 peer 配置</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#配置一个_VPN_服务器"><span class="tocnumber">3</span> <span class="toctext">配置一个 VPN 服务器</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#服务器"><span class="tocnumber">3.1</span> <span class="toctext">服务器</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#客户端_(转发所有流量)"><span class="tocnumber">3.2</span> <span class="toctext">客户端 (转发所有流量)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Troubleshooting"><span class="tocnumber">4</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#DKMS_module_not_available"><span class="tocnumber">4.1</span> <span class="toctext">DKMS module not available</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Tips_and_tricks"><span class="tocnumber">5</span> <span class="toctext">Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#Store_private_keys_in_encrypted_form"><span class="tocnumber">5.1</span> <span class="toctext">Store private keys in encrypted form</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span></h2>
<p><a href="https://wiki.archlinux.org/index.php/%E5%AE%89%E8%A3%85" class="mw-redirect" title="安装">安装</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wireguard-tools">wireguard-tools</a></span> 包以及一个或多个适当的内核模块：
</p>
<ul><li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wireguard-arch">wireguard-arch</a></span><sup>[<a href="https://wiki.archlinux.org/index.php/Help:Procedures#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：replaced by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=linux">linux</a></span>]</sup> 用于默认 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=linux">linux</a></span> 内核。</li></ul>
<ul><li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wireguard-lts">wireguard-lts</a></span> 用于 LTS <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=linux-lts">linux-lts</a></span> 内核。</li></ul>
<ul><li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wireguard-dkms">wireguard-dkms</a></span> 用于其他 DKMS 变体<a href="https://wiki.archlinux.org/index.php/Kernel" title="Kernel">内核</a>。</li></ul>
<div class="archwiki-template-box archwiki-template-box-note"><strong>注意：</strong> WireGuard 已经并入 Linux 5.6。<a rel="nofollow" class="external autonumber" href="https://lists.zx2c4.com/pipermail/wireguard/2020-January/004906.html">[2]</a></div>
<div class="archwiki-template-box archwiki-template-box-tip"><strong>提示：</strong> <a href="https://wiki.archlinux.org/index.php/Systemd-networkd" title="Systemd-networkd">systemd-networkd</a> 和 <a href="https://wiki.archlinux.org/index.php/NetworkManager" title="NetworkManager">NetworkManager</a> 都为 WireGuard 接口设置提供原生支持，它们只需要内核模块。
<ul><li>有关 systemd-networkd 的支持详情，请参阅 <a href="#使用_systemd-networkd">#使用 systemd-networkd</a><sup>[<a href="https://wiki.archlinux.org/index.php/ArchWiki:Requests#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">broken link</a>: invalid section]</sup>。</li></ul>
<ul><li>有关 NetworkManager 的支持详情，请阅读 <a rel="nofollow" class="external text" href="https://blogs.gnome.org/thaller/2019/03/15/wireguard-in-networkmanager/">WireGuard in NetworkManager blog post</a>。</li></ul></div>
<h2><span id=".E4.BD.BF.E7.94.A8"></span><span class="mw-headline" id="使用">使用</span></h2>
<p>在 peer 上生成公钥和私钥：
</p>
<pre>$ wg genkey | tee privatekey | wg pubkey &gt; publickey
</pre>
<p>下面的指令会演示如何以表中的配置建立一条两个 peer 之间的隧道
</p>
<table class="wikitable">
<tbody><tr>
<th>
</th>
<th>Peer A
</th>
<th>Peer B
</th></tr>
<tr>
<td>External IP address
</td>
<td>10.10.10.1/24
</td>
<td>10.10.10.2/24
</td></tr>
<tr>
<td>Internal IP address
</td>
<td>10.0.0.1/24
</td>
<td>10.0.0.2/24
</td></tr>
<tr>
<td>wireguard listening port
</td>
<td>UDP/48574
</td>
<td>UDP/39814
</td></tr></tbody></table>
<p>Peer 应当已经拥有外网地址。例如，peer A 应当能够通过 <code>ping 10.10.10.2</code> ping 通 peer B，反之亦然。内部地址是由下文 <code>ip</code> 命令创建的新地址，并且将在 WireGuard 网络中共享。IP地址中 <code>/24</code> 的含义详见 <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation" class="extiw" title="wikipedia:Classless Inter-Domain Routing">CIDR</a>
</p>
<h4><span id="Peer_A_.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="Peer_A_配置">Peer A 配置</span></h4>
<p>这个 peer 将监听 UDP 端口 48574，通过将 peer B 的公钥与其内部和外部 IP 地址关联，接受来自 peer B 的连接。
</p>
<pre># ip link add dev wg0 type wireguard
# ip addr add 10.0.0.1/24 dev wg0
# wg set wg0 listen-port 48574 private-key ./privatekey
# wg set wg0 peer [Peer B public key] persistent-keepalive 25 allowed-ips 10.0.0.2/32 endpoint 10.10.10.2:39814
# ip link set wg0 up
</pre>
<p><code>[Peer B public key]</code> 的格式应当如同 <code>EsnHH9m6RthHSs+sd9uM6eCHe/mMVFaRh93GYadDDnM=</code>。<code>allowed-ips</code> 是 peer A 能够向之发送流量的地址列表。<code>allowed-ips 0.0.0.0/0</code> 将允许向任意地址发送流量。
</p>
<h4><span id="Peer_B_.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="Peer_B_配置">Peer B 配置</span></h4>
<p>如同 Peer A，只不过 wireguard 守护监听 UDP 端口 39814 并且只接受 peer A 的连接
</p>
<pre># ip link add dev wg0 type wireguard
# ip addr add 10.0.0.2/24 dev wg0
# wg set wg0 listen-port 39814 private-key ./privatekey
# wg set wg0 peer [Peer A public key] persistent-keepalive 25 allowed-ips 10.0.0.1/32 endpoint 10.10.10.1:48574
# ip link set wg0 up
</pre>
<h4><span id=".E5.9F.BA.E6.9C.AC.E6.A3.80.E6.9F.A5"></span><span class="mw-headline" id="基本检查">基本检查</span></h4>
<p>不带任何参数使用 wg 命令可以快速查看当前的配置。
</p><p>例如，当 peer A 配置好之后，我们可以看见它的身份和与之关联的 peers。
</p>
<pre> peer-a$ wg
 interface: wg0
   public key: UguPyBThx/+xMXeTbRYkKlP0Wh/QZT3vTLPOVaaXTD8=
   private key: (hidden)
   listening port: 48574
 
 peer: 9jalV3EEBnVXahro0pRMQ+cHlmjE33Slo9tddzCVtCw=
   endpoint: 10.10.10.2:39814
   allowed ips: 10.0.0.2/32
</pre>
<p>此时我们可以 ping 通隧道的另一端：
</p>
<pre> peer-a$ ping 10.0.0.2
</pre>
<h4><span id=".E9.85.8D.E7.BD.AE.E6.8C.81.E4.B9.85.E5.8C.96"></span><span class="mw-headline" id="配置持久化">配置持久化</span></h4>
<p>配置可以通过 <code>showconf</code> 来保存
</p>
<pre># wg showconf wg0 &gt; /etc/wireguard/wg0.conf
# wg setconf wg0 /etc/wireguard/wg0.conf
</pre>
<h4><span id=".E7.A4.BA.E4.BE.8B_peer_.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="示例_peer_配置">示例 peer 配置</span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/wireguard/wg0.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Interface]
PrivateKey = [CLIENT PRIVATE KEY]

[Peer]
PublicKey = [SERVER PUBLICKEY]
AllowedIPs = 10.0.0.0/24, 10.123.45.0/24, 1234:4567:89ab::/48
Endpoint = [SERVER ENDPOINT]:51820
PersistentKeepalive = 25</pre>
<h2><span id=".E9.85.8D.E7.BD.AE.E4.B8.80.E4.B8.AA_VPN_.E6.9C.8D.E5.8A.A1.E5.99.A8"></span><span class="mw-headline" id="配置一个_VPN_服务器">配置一个 VPN 服务器</span></h2>
<p>Wireguard 自带一个快速创建和销毁 VPN 服务器的工具，<code>wg-quick</code>。注意这里使用的配置文件不是一个能被 <code>wg setconf</code> 有效的配置文件，并且你可能至少要把 <code>eth0</code> 改成你实际使用的。
</p>
<h4><span id=".E6.9C.8D.E5.8A.A1.E5.99.A8"></span><span class="mw-headline" id="服务器">服务器</span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/wireguard/wg0server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Interface]
Address = 10.0.0.1/24  # This is the virtual IP address, with the subnet mask we will use for the VPN
PostUp   = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
ListenPort = 51820
PrivateKey = [SERVER PRIVATE KEY]

[Peer]
PublicKey = [CLIENT PUBLIC KEY]
AllowedIPs = 10.0.0.2/32  # 这表示客户端只有一个 ip。</pre>
<p>要使 iptables 规则生效，启用 IPv4 转发：
</p>
<pre># sysctl net.ipv4.ip_forward=1
</pre>
<p>永久保留这项改变，向 <code>/etc/sysctl.d/99-sysctl.conf</code> 添加 <code>net.ipv4.ip_forward = 1</code>。
</p><p>使用 <code>wg-quick up wg0server</code> 启用 Interface，<code>wg-quick down wg0server</code> 用以关闭
</p>
<h4><span id=".E5.AE.A2.E6.88.B7.E7.AB.AF_.28.E8.BD.AC.E5.8F.91.E6.89.80.E6.9C.89.E6.B5.81.E9.87.8F.29"></span><span class="mw-headline" id="客户端_(转发所有流量)">客户端 (转发所有流量)</span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/wireguard/wg0.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Interface]
Address = 10.0.0.2/24  # The client IP from wg0server.conf with the same subnet mask
PrivateKey = [CLIENT PRIVATE KEY]
DNS = 10.0.0.1

[Peer]
PublicKey = [SERVER PUBLICKEY]
AllowedIPs = 0.0.0.0/0,&nbsp;::0/0
Endpoint = [SERVER ENDPOINT]:51820
PersistentKeepalive = 25</pre>
<p>使用 <code>wg-quick up wg0</code> 来启用 Interface, 使用 <code>wg-quick down wg0</code> 来关闭。
</p><p>使用 <code>systemctl enable wg-quick@wg0</code> 来自动启动。
</p><p>如果你使用 <a href="https://wiki.archlinux.org/index.php/NetworkManager" title="NetworkManager">NetworkManager</a>, 可能有必要启用 NetworkManager-wait-online.service <code>systemctl enable NetworkManager-wait-online.service</code>
</p><p>或者你使用的是 systemd-networkd, 启用 systemd-networkd-wait-online.service <code>systemctl enable systemd-networkd-wait-online.service</code>
</p><p>等待所有设备就绪再尝试 wireguard 连接
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="DKMS_module_not_available">DKMS module not available</span></h3>
<p>If the following command does not list any module after you installed <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=wireguard-dkms">wireguard-dkms</a></span>,
</p>
<pre>$ modprobe wireguard &amp;&amp; lsmod | grep wireguard
</pre>
<p>or if creating a new link returns
</p>
<pre># ip link add dev wg0 type wireguard
RTNETLINK answers: Operation not supported
</pre>
<p>you probably miss the linux headers.
</p><p>These headers are available in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=linux-headers">linux-headers</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=linux-lts-headers">linux-lts-headers</a></span> depending of the kernel installed on your system.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Store_private_keys_in_encrypted_form">Store private keys in encrypted form</span></h3>
<p>It may be desirable to store private keys in encrypted form, such as through use of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=pass">pass</a></span>. Just replace the PrivateKey line under [Interface] in your config file with:
</p>
<pre> PostUp = wg set %i private-key &lt;(su user -c "export PASSWORD_STORE_DIR=/path/to/your/store/; pass WireGuard/private-keys/%i")
</pre>
<p>where user is your username. See the `wg-quick(8)` man page for more details.
</p>
<!-- 
NewPP limit report
Cached time: 20200615063727
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.041 seconds
Real time usage: 0.045 seconds
Preprocessor visited node count: 395/1000000
Preprocessor generated node count: 0/1000000
Post‐expand include size: 6220/2097152 bytes
Template argument size: 3054/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 4/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   20.817      1 -total
 24.84%    5.171      1 Template:Translateme_(简体中文)
 15.71%    3.270      1 Template:提示
 15.06%    3.135      1 Template:META_Message
 11.30%    2.353      1 Template:注意
  9.78%    2.037      3 Template:Hc
  8.67%    1.805      1 Template:META_Unexplained_Status_Template_(简体中文)
  8.52%    1.774     20 Template:Ic
  8.40%    1.748      1 Template:Broken_package_link_(简体中文)
  8.35%    1.738     11 Template:Pkg
-->

<!-- Saved in parser cache with key archwiki:pcache:idhash:26928-0!canonical and timestamp 20200615063727 and revision id 609817
 -->
</div></div>
		
		<div class="printfooter">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=609817">https://wiki.archlinux.org/index.php?title=WireGuard_(简体中文)&amp;oldid=609817</a>"</div>
		
		<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://wiki.archlinux.org/index.php/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="https://wiki.archlinux.org/index.php/Category:Virtual_Private_Network_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Virtual Private Network (简体中文)">Virtual Private Network (简体中文)</a></li></ul></div><div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul><li><a href="https://wiki.archlinux.org/index.php/Category:Pages_with_broken_package_links" title="Category:Pages with broken package links">Pages with broken package links</a></li><li><a href="https://wiki.archlinux.org/index.php/Category:Pages_with_broken_section_links" title="Category:Pages with broken section links">Pages with broken section links</a></li></ul></div></div>
		<div class="visualClear"></div>
		
	</div>
</div>


		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-createaccount"><a href="https://wiki.archlinux.org/index.php?title=Special:CreateAccount&amp;returnto=WireGuard+%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="https://wiki.archlinux.org/index.php?title=Special:UserLogin&amp;returnto=WireGuard+%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29" title="You are encouraged to log in; however, it is not mandatory [Alt+Shift+o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="https://wiki.archlinux.org/index.php/WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="View the content page [Alt+Shift+c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="https://wiki.archlinux.org/index.php?title=Talk:WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [Alt+Shift+t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label">
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<ul class="menu">
													</ul>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="https://wiki.archlinux.org/index.php/WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://wiki.archlinux.org/index.php?title=WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit" title="This page is protected.
You can view its source [Alt+Shift+e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://wiki.archlinux.org/index.php?title=WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=history" title="Past revisions of this page [Alt+Shift+h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span></h3>
						<ul class="menu">
													</ul>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search ArchWiki" title="Search ArchWiki [Alt+Shift+f]" accesskey="f" id="searchInput" autocomplete="off"><input type="hidden" value="Special:Search" name="title"><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton">							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="https://wiki.archlinux.org/index.php/Main_page" title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage-description"><a href="https://wiki.archlinux.org/index.php/Main_page" title="Visit the main page [Alt+Shift+z]" accesskey="z">Main page</a></li><li id="n-Table-of-contents"><a href="https://wiki.archlinux.org/index.php/Table_of_contents">Table of contents</a></li><li id="n-portal"><a href="https://wiki.archlinux.org/index.php/Getting_involved" title="Various ways Archers can contribute to the community">Getting involved</a></li><li id="n-currentevents"><a href="https://wiki.archlinux.org/index.php/ArchWiki:News" title="The latest lowdown on the wiki">Wiki news</a></li><li id="n-randompage"><a href="https://wiki.archlinux.org/index.php/Special:Random" title="Load a random page [Alt+Shift+x]" accesskey="x">Random page</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-Interaction" aria-labelledby="p-Interaction-label">
			<h3 id="p-Interaction-label">Interaction</h3>
			<div class="body">
								<ul>
					<li id="n-help"><a href="https://wiki.archlinux.org/index.php/Category:Help" title="Wiki navigation, reading, and editing help">Help</a></li><li id="n-Contributing"><a href="https://wiki.archlinux.org/index.php/ArchWiki:Contributing">Contributing</a></li><li id="n-recentchanges"><a href="https://wiki.archlinux.org/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [Alt+Shift+r]" accesskey="r">Recent changes</a></li><li id="n-Recent-talks"><a href="https://wiki.archlinux.org/index.php/Special:RecentChanges?namespace=all-discussions" rel="nofollow">Recent talks</a></li><li id="n-newpages"><a href="https://wiki.archlinux.org/index.php/Special:NewPages">New pages</a></li><li id="n-Statistics"><a href="https://wiki.archlinux.org/index.php/ArchWiki:Statistics">Statistics</a></li><li id="n-Requests"><a href="https://wiki.archlinux.org/index.php/ArchWiki:Requests">Requests</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Tools</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="https://wiki.archlinux.org/index.php/Special:WhatLinksHere/WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="A list of all wiki pages that link here [Alt+Shift+j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="https://wiki.archlinux.org/index.php/Special:RecentChangesLinked/WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" rel="nofollow" title="Recent changes in pages linked from this page [Alt+Shift+k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="https://wiki.archlinux.org/index.php/Special:SpecialPages" title="A list of all special pages [Alt+Shift+q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://wiki.archlinux.org/index.php?title=WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;printable=yes" rel="alternate" title="Printable version of this page [Alt+Shift+p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://wiki.archlinux.org/index.php?title=WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=609817" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://wiki.archlinux.org/index.php?title=WireGuard_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-lang" aria-labelledby="p-lang-label">
			<h3 id="p-lang-label">In other languages</h3>
			<div class="body">
								<ul>
					<li class="interlanguage-link interwiki-en"><a href="https://wiki.archlinux.org/index.php/WireGuard" title="WireGuard – English" hreflang="en" class="interlanguage-link-target" lang="en">English</a></li><li class="interlanguage-link interwiki-ja"><a href="https://wiki.archlinux.jp/index.php/WireGuard" title="WireGuard – 日本語" hreflang="ja" class="interlanguage-link-target" lang="ja">日本語</a></li><li class="interlanguage-link interwiki-pl"><a href="https://wiki.archlinux.org/index.php/WireGuard_(Polski)" title="WireGuard – polski" hreflang="pl" class="interlanguage-link-target" lang="pl">Polski</a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 2 May 2020, at 11:00.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="https://wiki.archlinux.org/index.php/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="https://wiki.archlinux.org/index.php/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
								<li id="footer-places-disclaimer"><a href="https://wiki.archlinux.org/index.php/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		

<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.041","walltime":"0.045","ppvisitednodes":{"value":395,"limit":1000000},"ppgeneratednodes":{"value":0,"limit":1000000},"postexpandincludesize":{"value":6220,"limit":2097152},"templateargumentsize":{"value":3054,"limit":2097152},"expansiondepth":{"value":6,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":4,"limit":5000000},"timingprofile":["100.00%   20.817      1 -total"," 24.84%    5.171      1 Template:Translateme_(简体中文)"," 15.71%    3.270      1 Template:提示"," 15.06%    3.135      1 Template:META_Message"," 11.30%    2.353      1 Template:注意","  9.78%    2.037      3 Template:Hc","  8.67%    1.805      1 Template:META_Unexplained_Status_Template_(简体中文)","  8.52%    1.774     20 Template:Ic","  8.40%    1.748      1 Template:Broken_package_link_(简体中文)","  8.35%    1.738     11 Template:Pkg"]},"cachereport":{"timestamp":"20200615063727","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":111});});</script>



<div style="display: none; font-size: 13px;" class="suggestions"><div class="suggestions-results"></div><div class="suggestions-special"></div></div></body><!-- Cached/compressed 20200615063727 --></html>