<!DOCTYPE html>
<!-- saved from url=(0042)https://blog.lancitou.net/wireguard-setup/ -->
<html lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" async="" src="./VPN 新宠 WireGuard 搭建 - 烂磁头 - 好记性不如烂磁头_files/analytics.js.download"></script><script async="" src="./VPN 新宠 WireGuard 搭建 - 烂磁头 - 好记性不如烂磁头_files/js"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-80293536-1');</script><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.69.0"><title>VPN 新宠 WireGuard 搭建 - 烂磁头 - 好记性不如烂磁头</title><meta property="og:title" content="VPN 新宠 WireGuard 搭建 - 烂磁头 - 好记性不如烂磁头"><meta property="og:title" content="VPN 新宠 WireGuard 搭建"><meta property="og:description" content="WireGuard 作为即将进入 Linux 内核的 VPN 新宠，以其简单优雅的设计和实现得到了 Linus Torvalds 的首肯： Can I just once again state my love for it and hope it gets merged soon? Maybe the code isn’t perfect, but I’ve skimmed it, and compared to the horrors that are OpenVPN and"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.lancitou.net/wireguard-setup/"><meta property="og:image" content="https://i.imgur.com/DiVPtHFl.png"><meta property="og:image" content="https://i.imgur.com/E7o9AtKl.jpg"><meta property="article:published_time" content="2018-11-15T14:42:27+00:00"><meta property="article:modified_time" content="2018-11-15T14:42:27+00:00"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://i.imgur.com/DiVPtHFl.png"><meta name="twitter:title" content="VPN 新宠 WireGuard 搭建"><meta name="twitter:description" content="WireGuard 作为即将进入 Linux 内核的 VPN 新宠，以其简单优雅的设计和实现得到了 Linus Torvalds 的首肯： Can I just once again state my love for it and hope it gets merged soon? Maybe the code isn’t perfect, but I’ve skimmed it, and compared to the horrors that are OpenVPN and"><link rel="stylesheet" href="./VPN 新宠 WireGuard 搭建 - 烂磁头 - 好记性不如烂磁头_files/main.css" media="all"><link rel="stylesheet" href="./VPN 新宠 WireGuard 搭建 - 烂磁头 - 好记性不如烂磁头_files/fonts.css"><link rel="icon" href="https://blog.lancitou.net/favicon.ico" sizes="32x32"><script src="./VPN 新宠 WireGuard 搭建 - 烂磁头 - 好记性不如烂磁头_files/lazysizes.min.js.download" async=""></script><script async="" src="https://yestyle.disqus.com/embed.js" data-timestamp="1589818836032"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head><body><div id="MathJax_Message" style="display: none;"></div><div class="wrapper"><header class="header"><nav class="nav"><a href="https://blog.lancitou.net/" class="nav-logo"><img src="./VPN 新宠 WireGuard 搭建 - 烂磁头 - 好记性不如烂磁头_files/logo.png" width="50" height="50" alt="Logo"></a><ul class="nav-links"><li><a href="https://blog.lancitou.net/authors">Authors</a></li><li><a href="https://blog.lancitou.net/archives">Archives</a></li><li><a href="https://blog.lancitou.net/1se">1SE</a></li></ul></nav></header><main class="content" role="main"><article class="article"><h1 class="article-title">VPN 新宠 WireGuard 搭建</h1><span class="article-date">15 Nov 2018</span><span class="article-author"><a href="https://blog.lancitou.net/authors/philip_ye">Philip Ye</a></span><div class="article-content"><p>WireGuard 作为即将进入 Linux 内核的 VPN 新宠，以其简单优雅的设计和实现得到了 <a href="https://lore.kernel.org/lkml/CA+55aFz5EWE9OTbzDoMfsY2ez04Qv9eg0KQhwKfyJY0vFvoD3g@mail.gmail.com/" title="Linus Torvalds loves WireGuard">Linus Torvalds 的首肯</a>：</p><blockquote><p>Can I just once again state my love for it and hope it gets merged soon? Maybe the code isn’t perfect, but I’ve skimmed it, and compared to the horrors that are OpenVPN and IPSec, it’s a work of art.</p></blockquote><p>最近在推特看到 <a href="https://twitter.com/EdgeSecurity/status/1059559371661815810">WireGuard for iOS 开放 TestFlight 测试</a>的消息，于是迫不及待地下载测试一番，顺便在笔记本电脑上也搭建了 WireGuard 通道。</p><h2 id="网络拓扑">网络拓扑</h2><p>本文所述搭建过程包括三个 WireGuard 节点（Peer），网络拓扑如下图所示：</p><p><img src="https://i.imgur.com/DiVPtHFl.png" alt=""></p><p>为了便于理解，把家里的小米路由器也画出来了，同时将每个设备的网络接口及对应的 IP 地址也一并列出。</p><p>需要特别指出的是，在 WireGuard 协议中，各个节点的关系是完全对等的。每个节点都可以与多个节点连接从而组成非常复杂的网络拓扑。但在本文的应用中，仅 VPS 连接了两个节点，而其它两个节点相互之间不直接相连（图中虚线所示）。</p><h2 id="安装">安装</h2><h3 id="ubuntu-安装">Ubuntu 安装</h3><p>笔记本电脑和 VPS 运行的都是 Ubuntu 系统，参考 WireGuard <a href="https://www.wireguard.com/install/" title="WireGuard Installation">官网安装页面</a>，二者的安装没有区别：</p><pre><code>$ sudo add-apt-repository ppa:wireguard/wireguard
$ sudo apt-get update
$ sudo apt-get install wireguard
</code></pre><h3 id="ios-安装">iOS 安装</h3><p>iOS 要求升级到 12.0 或更新的系统，兼容 iPhone、iPad 和 iPod touch。安装 TestFlight 后点击 <a href="https://testflight.apple.com/join/63I19SDT" title="WireGuard for iOS - TestFlight">WireGuard for iOS</a> 下载，目前对所有用户开放。</p><h2 id="密钥生成">密钥生成</h2><p>WireGuard 的每个节点都必须有一对 base64 编码的公钥和私钥。Ubuntu 在安装 WireGuard 后集成的 <code>wg</code> 命令可用于生成密钥：</p><pre><code>$ umask 077
$ wg genkey | tee private | wg pubkey &gt; public
</code></pre><p>上述命令生成私钥保存在文件 <code>private</code> 中，并从私钥派生出公钥保存在文件 <code>public</code> 中。</p><p>iOS 上在 WireGuard 主界面右上角点 + 号选择 Create from scratch，在弹出的 New configuration 界面中点击 Generate keypair 即可同时生成公钥和私钥。此界面同样用于节点配置。</p><p>记录下每个节点的私钥和公钥用于节点配置，例如：</p><ul><li>VPS (10.10.10.1):<ul><li>Private: EFkHNqKrLjjnVqeUfLd70extGCPHj7bsET1LNYjm51I=</li><li>Public: pJyCyGG5NAyqQte62JZ2d4tUDy1B06Y4kloQetAP/T0=</li></ul></li><li>iPhone (10.10.10.2):<ul><li>Private: qAsWByso80UOTNU0ZO37Gt7uIkwbStTCus/CjEZFcV4=</li><li>Public: 6ASrcQzy+hWVm1JEC/mz0AlyF2uASRE+SknTFqa4s1g=</li></ul></li><li>Laptop (10.10.10.3):<ul><li>Private: QJAWG0EVyt7DXfzK49KBniRm2XS698ptNr9wLfX4qG8=</li><li>Public: QEKrMGYh7VdGeuhdDR0VvSy2Gy+GESq1Y9SOXG2jShg=</li></ul></li></ul><h2 id="节点配置">节点配置</h2><p>有了各个节点的密钥之后，即可根据网络拓扑图在各个节点上配置相互之间的连接关系。</p><h3 id="vps-配置">VPS 配置</h3><p>在 VPS 的 <code>/etc/wireguard</code> 目录下新建 <code>wg0.conf</code> 配置文件，内容如下：</p><pre><code>[Interface]
PrivateKey = EFkHNqKrLjjnVqeUfLd70extGCPHj7bsET1LNYjm51I=
Address = 10.10.10.1
ListenPort = 54321
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o ens3 -j MASQUERADE

[Peer]
PublicKey = 6ASrcQzy+hWVm1JEC/mz0AlyF2uASRE+SknTFqa4s1g=
AllowedIPs = 10.10.10.2/32

[Peer]
PublicKey = QEKrMGYh7VdGeuhdDR0VvSy2Gy+GESq1Y9SOXG2jShg=
AllowedIPs = 10.10.10.3/32
</code></pre><p>需要说明几点：</p><ul><li><code>/etc/wireguard</code> 目录下配置文件的名称将作为生成的虚拟网卡的名称，此处命名为 <code>wg0</code>。</li><li>每个节点的配置文件都必须有 <code>[Interface]</code> 部分，配置本节点的 IP 地址、私钥等属性。</li><li>每个 <code>[Peer]</code> 对应一个对端节点，包括节点的公钥和允许的 IP 段，此处添加 iPhone 和笔记本电脑两个节点。<code>AllowedIPs</code> 属性对于出口流量来说是路由表，对于入口流量来说则是访问控制列表，参考 <a href="https://www.wireguard.com/#cryptokey-routing" title="Cryptokey Routing">Cryptokey Routing</a>。</li><li>VPS 作为被动节点，需要配置 <code>ListenPort</code>，此处设置为 <code>54321</code>。</li><li><code>PostUp</code> 和 <code>PostDown</code> 配置用于在节点创建和删除之后执行的操作，对于 WireGuard 协议本身非必需。此处用于实现流量转发的 iptables 添加和删除，对于代理服务器来说至关重要。</li></ul><p>配置保存后，使用 <code>wg-quick up wg0</code> 根据配置文件快速创建 <code>wg0</code> 虚拟网卡并执行 <code>PostUp</code> 指定操作；使用 <code>wg-quick down wg0</code> 删除虚拟网卡并执行 <code>PostDown</code> 指定操作；使用 <code>wg</code> 查看各个节点的状态。</p><h3 id="laptop-配置">Laptop 配置</h3><p>同样在笔记本电脑上新建 <code>/etc/wireguard/wg0.conf</code> 配置文件，内容如下：</p><pre><code>[Interface]
PrivateKey = QJAWG0EVyt7DXfzK49KBniRm2XS698ptNr9wLfX4qG8=
Address = 10.10.10.3
DNS = 8.8.8.8

[Peer]
PublicKey = pJyCyGG5NAyqQte62JZ2d4tUDy1B06Y4kloQetAP/T0=
Endpoint = 149.28.171.194:54321
AllowedIPs = 0.0.0.0/0
</code></pre><p>与 VPS 的配置不同的是：</p><ul><li><code>[Interface]</code> 部分配置了 Google DNS，用于防止域名污染。</li><li>仅有一个 <code>[Peer]</code> 即对应 VPS，且需要配置 <code>Endpoint</code> 为 VPS 公网 IP 和对应的 <code>ListenPort</code> 即 <code>54321</code>。</li><li><code>AllowedIPs</code> 配置为 <code>0.0.0.0/0</code> 用于将所有流量都路由到 VPS，相当于全局代理。</li></ul><p><code>wg-quick</code> 和 <code>wg</code> 命令的使用与 VPS 相同，不再赘述。</p><h3 id="iphone-配置">iPhone 配置</h3><p>在<a href="https://blog.lancitou.net/wireguard-setup/#%E5%AF%86%E9%92%A5%E7%94%9F%E6%88%90">密钥生成</a>的 New configuration 界面中，配置本端的 IP 地址等属性，再点击 Add peer 添加一个节点对应 VPS。完整配置如下图所示：</p><p><img src="https://i.imgur.com/E7o9AtKl.jpg" alt=""></p><p>将 <code>AllowedIPs</code> 配置为 <code>0.0.0.0/0</code> 相当于全局代理，可添加具体的允许 IP 网段，例如把 <code>AllowedIPs</code> 设置为 Telegram 的全部网段：</p><pre><code>149.154.160.0/20, 149.154.164.0/22, 149.154.168.0/22, 149.154.172.0/22, 91.108.4.0/22, 91.108.8.0/22, 91.108.12.0/22, 91.108.16.0/22, 91.108.56.0/22
</code></pre><p>则仅 Telegram 流量走代理。由此可见，目前 WireGuard for iOS 的分流功能非常有限，期待后续版本继续改进。</p><p>以上。</p></div><ul class="article-taxonomy"><hr><li><i class="fa fa-folder-open"></i><a href="https://blog.lancitou.net/categories/technology">Technology</a><a href="https://blog.lancitou.net/categories/network">NetWork</a></li><li><i class="fa fa-tags"></i><a href="https://blog.lancitou.net/tags/linux">Linux</a><a href="https://blog.lancitou.net/tags/ios">iOS</a><a href="https://blog.lancitou.net/tags/vpn">VPN</a><a href="https://blog.lancitou.net/tags/wireguard">WireGuard</a></li><hr><h3>See Also</h3><ul><li><a href="https://blog.lancitou.net/config-x86-x32-enabled-but-no-binutils-support/">CONFIG_X86_X32 enabled but no binutils support</a></li><li><a href="https://blog.lancitou.net/shell-script-not-found-caused-by-line-ending/">行结束符导致脚本执行错误</a></li><li><a href="https://blog.lancitou.net/default-dnsmasq-conf-for-xiaomi-router/">小米路由器默认 dnsmasq.conf</a></li><li><a href="https://blog.lancitou.net/sem-timedwait-not-waking-issue/">sem_timedwait() 阻塞导致网口单通故障分析</a></li><li><a href="https://blog.lancitou.net/access-files-of-xiaomi-router-under-linux/">Linux 下玩转小米路由器文件访问</a></li></ul></ul></article><div id="disqus_thread"></div><script type="application/javascript">var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"yestyle"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></main><footer class="footer"><ul class="footer-links"><li><a href="https://blog.lancitou.net/feed" type="application/rss+xml" target="_blank"><i class="fa fa-rss"></i>RSS feed</a></li><li><a href="https://github.com/yestyle/lancitou-on-hugo" target="_blank" rel="noreferrer"><i class="fab fa-github"></i>Code</a></li></ul></footer><script type="text/x-mathjax-config;executed=true">
	MathJax.Hub.Config({
	    tex2jax: {
	       inlineMath: [['$','$'], ['\\(','\\)']]}
	})
	</script><script type="text/javascript" src="./VPN 新宠 WireGuard 搭建 - 烂磁头 - 好记性不如烂磁头_files/MathJax.js.download"></script></div></body></html>