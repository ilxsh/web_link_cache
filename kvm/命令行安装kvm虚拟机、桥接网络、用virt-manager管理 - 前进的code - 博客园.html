
<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin" />
    <meta property="og:description" content="宿主机CentOS Linux release 7.2.1511 (Core)，内核3.10.0-327.el7.x86_64 1、配置宿主机网络桥接 想让虚拟机有自己的ip且外网可访问，需要在安装虚" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>命令行安装kvm虚拟机、桥接网络、用virt-manager管理 - 前进的code - 博客园</title>
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=sqi5FxOybx6gjGoG6Zfy1wD-0AwznLNLYOVx7Y9tIN0" />
    <link id="MainCss" rel="stylesheet" href="/skins/summergarden/bundle-summergarden.min.css?v=X4bFXeVITa4R62KibBcxY9PyNj-MkkV0-IpC8y8yg_Q" />
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/summergarden/bundle-summergarden-mobile.min.css?v=-QJralHuYdZVDw2zivi4j5fUWp9jAHwpSH6TIdmjbwI" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/beixiaobei/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/beixiaobei/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/beixiaobei/wlwmanifest.xml" />
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=W8J2DYaUeAZPX2Lx1iRh00kAY9PXrT8UdrrPQB3gEXU"></script>
    <script>
        var currentBlogId = 357337;
        var currentBlogApp = 'beixiaobei';
        var cb_enable_mathjax = false;
        var isLogined = false;
    </script>
    
    
    
</head>
<body>
    <a name="top"></a>
    
    
<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a href="https://www.cnblogs.com/beixiaobei/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/beixiaobei/">前进的code</a>
</h1>
<h2>

</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		

			<ul id="navList">
				<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
				<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/beixiaobei/">
首页</a>
</li>
				<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
				<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/%E5%89%8D%E8%BF%9B%E7%9A%84code">
联系</a></li>
				<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
				<li>
<a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/beixiaobei/rss/">
订阅</a>
				
<a id="blog_nav_rss_image" href="https://www.cnblogs.com/beixiaobei/rss/">
    <img src="/skins/summergarden/images/xml.gif" alt="订阅" />
</a></li>
			</ul>



		<div class="blogStats">
			
			<!--done-->
随笔 - 
46&nbsp;
文章 - 
0&nbsp;
评论 - 
0&nbsp;



			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class = "postTitle">
			
<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/beixiaobei/p/9044976.html">命令行安装kvm虚拟机、桥接网络、用virt-manager管理</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			
<div id="cnblogs_post_body" class="blogpost-body ">
    <p><span style="color: #333333;">宿主机CentOS Linux release 7.2.1511 (Core)，内核3.10.0-327.el7.x86_64</span></p>
<p><span style="color: #333333;"><strong><span style="font-size: 14pt;">1、配置宿主机网络桥接</span></strong></span></p>
<p><span style="color: #333333;">想让虚拟机有自己的ip且外网可访问，需要在安装虚拟机前配置宿主机网络（桥接BRIDGE）：</span></p>
<p><span style="color: #333333;">在目录/etc/sysconfig/network-scripts下，将原始的ifcfg-enp2s0重命名ifcfg-enp2s0.old当备份，然后新建ifcfg-enp2s0内容如下：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #333333;">TYPE=Ethernet
IPV4_FAILURE_FATAL=yes
IPV6INIT=no
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=yes
NAME=enp2s0
DEVICE=enp2s0
ONBOOT=yes
BRIDGE=br0
NM_CONTROLLED=no</span></pre>
</div>
<p><span style="color: #333333;">再新建ifcgf-br0内容如下：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #333333;">TYPE=Bridge
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=br0
DEVICE=br0
NM_CONTROLLED=no
ONBOOT=yes
IPADDR=223.129.0.xxx
PREFIX=25
GATEWAY=223.129.0.xxx
DNS1=8.8.8.8
IPV6_PRIVACY=no
ZONE=public</span></pre>
</div>
<p><span style="color: #333333;">重启网络：systemctl restart network</span></p>
<p><span style="color: #333333;">有时候会报错：</span></p>
<p><span style="color: #333333;">Restarting network (via systemctl): &nbsp;Job for network.service failed because the control process exited with error code. See "systemctl status network.service" and "journalctl -xe" for details.</span></p>
<p><span style="color: #333333;">可以通过journalctl -xe查看具体原因，我这里和该文<a href="http://blog.51cto.com/addam/1839518" target="_blank"><span style="color: #333333;">http://blog.51cto.com/addam/1839518</span></a>问题类似，所以通过：systemctl stop NetworkManager，然后再重启网络解决了...</span></p>
<p><span style="color: #333333;">ifconfig看到如下信息（要是不对可以尝试重启机器...）</span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre>br0: flags=<span style="color: #800080;">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color: #800080;">1500</span><span style="color: #000000;">
        inet </span><span style="color: #800080;">223.129</span>.<span style="color: #800080;">0.xxx</span>  netmask <span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.xxx</span>  broadcast <span style="color: #800080;">223.129</span>.<span style="color: #800080;">0.xxx</span><span style="color: #000000;">
        inet6 fe80::4a5b:39ff:fea4:3ef0  prefixlen </span><span style="color: #800080;">64</span>  scopeid <span style="color: #800080;">0x20</span>&lt;link&gt;<span style="color: #000000;">
        ether </span><span style="color: #800080;">48</span>:5b:<span style="color: #800080;">39</span>:a4:3e:f0  txqueuelen <span style="color: #800080;">0</span><span style="color: #000000;">  (Ethernet)
        RX packets </span><span style="color: #800080;">4016129</span>  bytes <span style="color: #800080;">379659216</span> (<span style="color: #800080;">362.0</span><span style="color: #000000;"> MiB)
        RX errors </span><span style="color: #800080;">0</span>  dropped <span style="color: #800080;">0</span>  overruns <span style="color: #800080;">0</span>  frame <span style="color: #800080;">0</span><span style="color: #000000;">
        TX packets </span><span style="color: #800080;">7392459</span>  bytes <span style="color: #800080;">11078132347</span> (<span style="color: #800080;">10.3</span><span style="color: #000000;"> GiB)
        TX errors </span><span style="color: #800080;">0</span>  dropped <span style="color: #800080;">0</span> overruns <span style="color: #800080;">0</span>  carrier <span style="color: #800080;">0</span>  collisions <span style="color: #800080;">0</span><span style="color: #000000;">
enp2s0: flags</span>=<span style="color: #800080;">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color: #800080;">1500</span><span style="color: #000000;">
        inet6 fe80::4a5b:39ff:fea4:3ef0  prefixlen </span><span style="color: #800080;">64</span>  scopeid <span style="color: #800080;">0x20</span>&lt;link&gt;<span style="color: #000000;">
        ether </span><span style="color: #800080;">48</span>:5b:<span style="color: #800080;">39</span>:a4:3e:f0  txqueuelen <span style="color: #800080;">1000</span><span style="color: #000000;">  (Ethernet)
        RX packets </span><span style="color: #800080;">4260879</span>  bytes <span style="color: #800080;">791804516</span> (<span style="color: #800080;">755.1</span><span style="color: #000000;"> MiB)
        RX errors </span><span style="color: #800080;">0</span>  dropped <span style="color: #800080;">1092</span>  overruns <span style="color: #800080;">0</span>  frame <span style="color: #800080;">0</span><span style="color: #000000;">
        TX packets </span><span style="color: #800080;">7528373</span>  bytes <span style="color: #800080;">11088764715</span> (<span style="color: #800080;">10.3</span><span style="color: #000000;"> GiB)
        TX errors </span><span style="color: #800080;">0</span>  dropped <span style="color: #800080;">0</span> overruns <span style="color: #800080;">0</span>  carrier <span style="color: #800080;">0</span>  collisions <span style="color: #800080;">0</span>&nbsp;</pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 14pt; color: #333333;"><strong>2、命令行安装kvm虚拟机</strong></span></p>
<p><span style="color: #333333;">安装必要的软件这里就不说了...</span></p>
<p><span style="color: #333333;">ubuntu下（前两条用于安装，第三条用于启动）：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #333333;">1 qemu-img create -f qcow2 /home/kvm/centos7-1511.img 20G
2 qemu-system-x86_64 -m 2048 -enable-kvm -hda /home/kvm/centos7-1511.img -cdrom /home/isos/CentOS-7-x86_64-DVD-1511.iso -boot d
3 qemu-system-x86_64 -enable-kvm -m 1024 -boot menu=on /home/kvm/centos7-1511.img</span></pre>
</div>
<p><span style="color: #333333;">centos下：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #333333;">1 qemu-img create -f qcow2 /home/kvm/centos7-1511.img 20G
2 /usr/libexec/qemu-kvm -m 2048 -enable-kvm -hda /home/kvm/centos7-1708.img -cdrom /home/isos/CentOS-7-x86_64-DVD-1511.iso -boot d
3 /usr/libexec/qemu-kvm -enable-kvm -m 1024 -boot menu=on /home/kvm/centos7-1511.img</span></pre>
</div>
<p><span style="color: #333333;">如果用ubuntu下的命令2在centos下运行，会出现问题：</span></p>
<p><span style="color: #333333;">1、bash: qemu-system-x86_64: 未找到命令...</span></p>
<p><span style="color: #333333;">解决：qemu-system-x86_64是在安装qemu（注意不是qemu-kvm）时生成的命令，而centos下默认安装的是qemu-kvm包，对应的命令是qemu-kvm。通过rpm -ql qemu-kvm查看输出：/usr/libexec/qemu-kvm，用此替换得到centos下正确的命令2。</span></p>
<p><span style="color: #333333;">正确命令2运行后，输出信息是：</span></p>
<p><span style="color: #333333;">2、VNC server running on `::1:5900'</span></p>
<p><span style="color: #333333;">解决：在xshell下运行：vncviewer :5900，会出现</span></p>
<p><span style="color: #333333;">....</span></p>
<p><span style="color: #333333;">Can't open display:</span></p>
<p><span style="color: #333333;">所以用vncviewer连接到目标主机，然后在图形界面下运行vncviewer :5900，即会跳出安装centos的界面，顺着安装即可（记得在SOFTWARE SELECTION选择要最小安装还是图形界面）</span></p>
<p><span style="color: #333333;">&nbsp;</span></p>
<p><span style="color: #333333;"><strong><span style="font-size: 14pt;">3、让virt-manager可以管理刚才新建的虚拟机</span></strong></span></p>
<p><span style="color: #333333;" lang="en-us" xml:lang="en-us">运行完上述的命令1和2后，如果不想每次都通过命令3启动虚拟机，可以通过libvirt管理（这样以后直接virsh start 虚拟机名，即可开启虚拟机）</span></p>
<p><span style="color: #333333;" lang="en-us" xml:lang="en-us">libvirt（包括<span lang="en-us" xml:lang="en-us">virsh）使用<span lang="en-us" xml:lang="en-us">xml文件对虚拟机进行配置，其中包括虚拟机名称、分配内存、<span lang="en-us" xml:lang="en-us">vcpu等多种信息</span></span></span></span></p>
<p><span style="color: #333333;" lang="en-us" xml:lang="en-us"><span lang="en-us" xml:lang="en-us"><span lang="en-us" xml:lang="en-us"><span lang="en-us" xml:lang="en-us">下面是一个名为<span lang="en-us" xml:lang="en-us"><span lang="en-us" xml:lang="en-us"><span lang="en-us" xml:lang="en-us">centos7-1511.xml的<span lang="en-us" xml:lang="en-us">xml文件，其中定义了一个名为centos7-1511<span lang="en-us" xml:lang="en-us">的<span lang="en-us" xml:lang="en-us">kvm虚拟机（如果是32位要写i686）</span></span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: #333333;">&lt;domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'&gt;
  &lt;name&gt;<strong><span style="color: #800000;">centos7-1511</span></strong>&lt;/name&gt;
  &lt;uuid&gt;af939aef-c0eb-4b83-96ca-c23aecd3e057&lt;/uuid&gt;
  &lt;memory unit='KiB'&gt;1048576&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='<strong><span style="color: #800000;">x86_64</span></strong>' machine='<span style="color: #800000;"><strong>pc-i440fx-rhel7.0.0</strong></span>'&gt;hvm&lt;/type&gt;
    &lt;boot dev='hd'/&gt;
    &lt;bootmenu enable='yes'/&gt;
    &lt;bios useserial='yes' rebootTimeout='0'/&gt;
  &lt;/os&gt;
  &lt;features&gt;
    &lt;acpi/&gt;
    &lt;apic/&gt;
  &lt;/features&gt;
  &lt;cpu mode='custom'&gt;
    &lt;model fallback='allow'&gt;&lt;/model&gt;
  &lt;/cpu&gt;
  &lt;clock offset='utc'&gt;
    &lt;timer name='rtc' tickpolicy='catchup'/&gt;
    &lt;timer name='pit' tickpolicy='delay'/&gt;
    &lt;timer name='hpet' present='no'/&gt;
  &lt;/clock&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;pm&gt;
    &lt;suspend-to-mem enabled='no'/&gt;
    &lt;suspend-to-disk enabled='no'/&gt;
  &lt;/pm&gt;
  &lt;devices&gt;
    &lt;emulator&gt;<strong><span style="color: #800000;">/usr/libexec/qemu-kvm</span></strong>&lt;/emulator&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='qcow2'/&gt;
      &lt;source file='<span style="color: #800000;"><strong>/home/kvm/centos7-1511.img</strong></span>'/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/&gt;
    &lt;/disk&gt;
    &lt;disk type='block' device='cdrom'&gt;
      &lt;driver name='qemu' type='raw'/&gt;
      &lt;target dev='hda' bus='ide'/&gt;
      &lt;readonly/&gt;
      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
    &lt;/disk&gt;
    &lt;controller type='usb' index='0'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/&gt;
    &lt;/controller&gt;
    &lt;controller type='pci' index='0' model='pci-root'/&gt;
    &lt;controller type='ide' index='0'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/&gt;
    &lt;/controller&gt;
    &lt;interface type='network'&gt;
      &lt;mac address='<span style="color: #800000;"><strong>48:5b:39:a4:3e:f1</strong></span>'/&gt;
      &lt;source network='default'/&gt;
      &lt;model type='e1000'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
    &lt;/interface&gt;
    &lt;serial type='pty'&gt;
      &lt;target port='0'/&gt;
    &lt;/serial&gt;
    &lt;console type='pty'&gt;
      &lt;target type='serial' port='0'/&gt;
    &lt;/console&gt;
    &lt;input type='tablet' bus='usb'/&gt;
    &lt;input type='mouse' bus='ps2'/&gt;
    &lt;input type='keyboard' bus='ps2'/&gt;
    &lt;graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0'&gt;
      &lt;listen type='address' address='0.0.0.0'/&gt;
    &lt;/graphics&gt;
    &lt;video&gt;
      &lt;model type='cirrus' vram='16384' heads='1'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/&gt;
    &lt;/video&gt;
    &lt;memballoon model='virtio'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/&gt;
    &lt;/memballoon&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</span></pre>
</div>
<p>然后运行下面的命令即可通过virt-manager管理名为centos7-1511的kvm虚拟机</p>
<div class="cnblogs_code">
<pre>1 [root@localhost kvm]# virsh define centos7-1511.xml 
定义域 centos7-1511（从 centos7-1511.xml）
2 [root@localhost kvm]# virsh list --all
Id    名称                         状态
----------------------------------------------------
 -     centos7-1511                   关闭
3 [root@localhost kvm]# virsh start centos7-1511
域 centos7-1511 已开始</pre>
</div>
<p>命令3可能会有问题：</p>
<div class="cnblogs_code">
<pre><span style="color: #333333;">[root@localhost kvm]# virsh start centos7-1511
错误：开始域 centos7-1511 失败
错误：internal error: process exited while connecting to monitor: qemu-kvm: -machine pc-i440fx-2.0,accel=kvm,usb=off,dump-guest-core=off: Unsupported machine type
Use -machine help to list supported machines!</span></pre>
</div>
<p><span style="color: #333333;">通过以下命令：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #333333;">[root@localhost kvm]# /usr/libexec/qemu-kvm -machine help
Supported machines are:
none                 empty machine
pc                   RHEL 7.0.0 PC (i440FX + PIIX, 1996) (alias of pc-i440fx-rhel7.0.0)
pc-i440fx-rhel7.0.0  RHEL 7.0.0 PC (i440FX + PIIX, 1996) (default)
rhel6.6.0            RHEL 6.6.0 PC
rhel6.5.0            RHEL 6.5.0 PC
rhel6.4.0            RHEL 6.4.0 PC
rhel6.3.0            RHEL 6.3.0 PC
rhel6.2.0            RHEL 6.2.0 PC
rhel6.1.0            RHEL 6.1.0 PC
rhel6.0.0            RHEL 6.0.0 PC</span></pre>
</div>
<p>将xml文件中machine部分替换，然后通过下面的undefine命令取消刚才的虚拟机，再重新运行上面的define即可</p>
<p>可通过:</p>
<p>virsh undefine centos7-1511取消定义虚拟机，之后系统无法识别centos7-1511（此步骤与virsh define centos7-1511.xml对应）</p>
<p>virsh destroy&nbsp;centos7-1511直接销毁虚拟机，取消定义，之后无法执行undefine</p>
<p>&nbsp;</p>
<p>注意：用virt-manager第一次启动虚拟机时别忘了修改为桥接，否则即使你在虚拟机里配置了ip等信息，ping网关啥的都会出现：Destination Host Unreachable</p>
<p><img src="https://images2018.cnblogs.com/blog/1168917/201805/1168917-20180516213350792-327307151.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;"><strong>4、虚拟机网络配置</strong></span></p>
<p>修改网络配置文件：</p>
<p>1、ubuntu虚拟机中修改网络配置文件（因为有时候图形界面操作时，会出现无法save的情况）</p>
<p>修改/etc/network/interfaces文件为：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;"># eth0是你虚拟机的网卡，可以通过ifconfig查看
auto eth0
iface eth0 inet </span><span style="color: #0000ff;">static</span><span style="color: #000000;">
#ip
address </span><span style="color: #800080;">223.129</span>.<span style="color: #800080;">0.xxx</span><span style="color: #000000;">
# 子网和网关
netmask </span><span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.xxx</span><span style="color: #000000;">
gateway </span><span style="color: #800080;">223.129</span>.<span style="color: #800080;">0.xxx</span></pre>
</div>
<p>修改/etc/resolvconf/resolv.conf.d/base文件，设置dns</p>
<div class="cnblogs_code">
<pre>nameserver <span style="color: #800080;">8.8</span>.<span style="color: #800080;">8.8</span></pre>
</div>
<p>重启虚拟机，通过ifconfig看到信息：</p>
<div class="cnblogs_code">
<pre>eth0      Link encap:Ethernet  HWaddr <span style="color: #800080;">52</span>:<span style="color: #800080;">54</span>:<span style="color: #800080;">00</span><span style="color: #000000;">:7c:da:c9  
          inet addr:</span><span style="color: #800080;">223.129</span>.<span style="color: #800080;">0.xxx</span>  Bcast:<span style="color: #800080;">223.129</span>.<span style="color: #800080;">0.xxx</span>  Mask:<span style="color: #800080;">255.255</span>.<span style="color: #800080;">255.xxx</span><span style="color: #000000;">
          inet6 addr: fe80::</span><span style="color: #800080;">5054</span>:ff:fe7c:dac9/<span style="color: #800080;">64</span><span style="color: #000000;"> Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:</span><span style="color: #800080;">1500</span>  Metric:<span style="color: #800080;">1</span><span style="color: #000000;">
          RX packets:</span><span style="color: #800080;">219111</span> errors:<span style="color: #800080;">0</span> dropped:<span style="color: #800080;">0</span> overruns:<span style="color: #800080;">0</span> frame:<span style="color: #800080;">0</span><span style="color: #000000;">
          TX packets:</span><span style="color: #800080;">9266</span> errors:<span style="color: #800080;">0</span> dropped:<span style="color: #800080;">0</span> overruns:<span style="color: #800080;">0</span> carrier:<span style="color: #800080;">0</span><span style="color: #000000;">
          collisions:</span><span style="color: #800080;">0</span> txqueuelen:<span style="color: #800080;">1000</span><span style="color: #000000;"> 
          RX bytes:</span><span style="color: #800080;">31389489</span> (<span style="color: #800080;">31.3</span> MB)  TX bytes:<span style="color: #800080;">761327</span> (<span style="color: #800080;">761.3</span><span style="color: #000000;"> KB)

lo        Link encap:Local Loopback  
          inet addr:</span><span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>  Mask:<span style="color: #800080;">255.0</span>.<span style="color: #800080;">0.0</span><span style="color: #000000;">
          inet6 addr: ::</span><span style="color: #800080;">1</span>/<span style="color: #800080;">128</span><span style="color: #000000;"> Scope:Host
          UP LOOPBACK RUNNING  MTU:</span><span style="color: #800080;">65536</span>  Metric:<span style="color: #800080;">1</span><span style="color: #000000;">
          RX packets:</span><span style="color: #800080;">64</span> errors:<span style="color: #800080;">0</span> dropped:<span style="color: #800080;">0</span> overruns:<span style="color: #800080;">0</span> frame:<span style="color: #800080;">0</span><span style="color: #000000;">
          TX packets:</span><span style="color: #800080;">64</span> errors:<span style="color: #800080;">0</span> dropped:<span style="color: #800080;">0</span> overruns:<span style="color: #800080;">0</span> carrier:<span style="color: #800080;">0</span><span style="color: #000000;">
          collisions:</span><span style="color: #800080;">0</span> txqueuelen:<span style="color: #800080;">1</span><span style="color: #000000;"> 
          RX bytes:</span><span style="color: #800080;">5632</span> (<span style="color: #800080;">5.6</span> KB)  TX bytes:<span style="color: #800080;">5632</span> (<span style="color: #800080;">5.6</span> KB)</pre>
</div>
<p>此时用xshell连接，会出现connection failed</p>
<p>因为ubuntu虚拟机中必须安装openssh-server软件，这样才可以通过ssh连接</p>
<p>安装命令：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> sudo apt-<span style="color: #0000ff;">get</span> install openssh-<span style="color: #000000;">server  
</span><span style="color: #008080;">2</span> sudo /etc/init.d/ssh restart  <span style="color: #008000;">//</span><span style="color: #008000;">重启ssh服务 </span></pre>
</div>
<p>安装好后，用以下命令查看22端口是否处于LISTEN状态，如果是，则说明已经配置好了ubuntu的ssh服务</p>
<div class="cnblogs_code">
<pre>root@jin:/home/jin# netstat -<span style="color: #000000;">ntlp 
Active Internet connections (only servers)
Proto Recv</span>-Q Send-Q Local Address           Foreign Address         State       PID/<span style="color: #000000;">Program name
tcp        </span><span style="color: #800080;">0</span>      <span style="color: #800080;">0</span> <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">22</span>              <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:*               LISTEN      <span style="color: #800080;">2645</span>/sshd </pre>
</div>
<p>&nbsp;</p>
<p>2、centos下</p>
<p>&nbsp;这个没试，下面是通过图形界面配置后，相应文件内容</p>
<div class="cnblogs_code">
<pre><span style="color: #333333;">[root@localhost network-scripts]# <strong><span style="color: #800000;">pwd</span></strong>
/etc/sysconfig/network-scripts
[root@localhost network-scripts]# <strong><span style="color: #800000;">cat ifcfg-ens3</span></strong> 
TYPE="Ethernet"
BOOTPROTO="none"
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_FAILURE_FATAL="no"
NAME="ens3"
UUID="3b886635-d2a9-4569-9763-7468890a64d8"
DEVICE="ens3"
ONBOOT="yes"
DNS1="8.8.8.8"
IPADDR=223.129.0.xxx
PREFIX=25
GATEWAY=223.129.0.xxx
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_PRIVACY=no</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong style="color: #333333; font-size: 14pt;">补充</strong></p>
<p><span style="color: #333333;">1、桥接和NAT</span></p>
<p><span style="color: #333333;">。。。。</span></p>
<p><span style="color: #333333;">2、创建虚拟机时各命令含义</span></p>
<p><span style="color: #333333;">。。。。占坑之后写</span></p>
<p><span style="color: #333333;">3、libvirt</span></p>
<p><span style="color: #333333;">。。。</span></p>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
		</div>
		<div class="postDesc">posted @ 
<span id="post-date">2018-05-16 21:38</span>&nbsp;<a href="https://www.cnblogs.com/beixiaobei/">前进的code</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>) <a href="https://i.cnblogs.com/EditPosts.aspx?postid=9044976" rel="nofollow"> 编辑</a> <a href="javascript:void(0)" onclick="AddToWz(9044976); return false;">收藏</a>
</div>
	</div>
	
	
</div>
<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 357337, cb_blogApp = 'beixiaobei', cb_blogUserGuid = '3b8ae2cc-220e-4d96-e399-08d49c350eca';
    var cb_entryId = 9044976, cb_entryCreatedDate = '2018-05-16 21:38', cb_postType = 1; 
    loadViewCount(cb_entryId);
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>

<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
    </script>
    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot("/1090369/C1", [300, 250], "div-gpt-ad-1546353474406-0").addService(googletag.pubads());
            googletag.defineSlot("/1090369/C2", [468, 60], "div-gpt-ad-1539008685004-0").addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;"></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;">
            <script>
                if (new Date() >= new Date(2018, 9, 13)) {
                    googletag.cmd.push(function () { googletag.display("div-gpt-ad-1539008685004-0"); });
                }
            </script>
        </div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
        deliverAdT2();
        deliverAdC1();
        deliverAdC2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div></div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>

			<div id="calendar"><div id="calendar"><div id="blog-calendar" style="display:none"></div></div>                
                    <script>loadBlogDefaultCalendar();</script></div>
			
			<DIV id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
			</DIV>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright &copy; 2019 前进的code
<br /><span id="poweredby">Powered by .NET Core 3.0.0-preview9-19423-09 on Linux</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    
</body>
</html>
