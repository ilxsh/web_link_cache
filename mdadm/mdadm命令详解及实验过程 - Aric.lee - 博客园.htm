<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin" />
    <meta property="og:description" content="一.概念 mdadm是multiple devices admin的简称，它是Linux下的一款标准的软件 RAID 管理工具，作者是Neil Brown 二.特点 mdadm能够诊断、监控和收集详细" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>mdadm命令详解及实验过程 - Aric.lee - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="//common.cnblogs.com/favicon.ico?v=20200522" type="image/x-icon" />
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=OkWhT11pACV4T_PiDJL8x9WKPwjvEyWNCWQ475DeMM0" />
    <link id="MainCss" rel="stylesheet" href="/skins/codinglife/bundle-codinglife.min.css?v=UeHyLv1TT2WTz4TwfUOiMoKNmtFvLUjUnIhFE2UmZ7I" />
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/codinglife/bundle-codinglife-mobile.min.css?v=H8GruHezJpXuD-qalJEizXcyJTpcNgvvj5MJRziylpg" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/ariclee/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/ariclee/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/ariclee/wlwmanifest.xml" />
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=vV4imX1ebLq2xPxSzhr9B0eW28ml5Xc7CSXMptQoB78"></script>
    <script>
        var currentBlogId = 239389;
        var currentBlogApp = 'ariclee';
        var cb_enable_mathjax = false;
        var isLogined = false;
        var skinName = 'CodingLife';
    </script>
    
    
    
</head>
<body>
    <a name="top"></a>
    
    
<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/ariclee/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/ariclee/">Aric.lee</a>
</h1>
<h2>

</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/ariclee/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/Aric.lee">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/ariclee/rss/">
订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			
			<span id="stats_post_count">随笔 - 
23&nbsp; </span>
<span id="stats_article_count">文章 - 
0&nbsp; </span>
<span id="stats-comment_count">评论 - 
1</span>

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class = "postTitle">
                
<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/ariclee/p/6403396.html">mdadm命令详解及实验过程</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                
<div id="cnblogs_post_body" class="blogpost-body ">
    <p><strong>一.概念</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mdadm是multiple devices admin的简称，它是Linux下的一款标准的软件 RAID 管理工具，作者是Neil Brown</p>
<p><strong>二.特点</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mdadm能够诊断、监控和收集详细的阵列信息 　　&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mdadm是一个单独集成化的程序而不是一些分散程序的集合，因此对不同RAID管<a title="理命" href="http://www.baike.com/sowiki/%E7%90%86%E5%91%BD?prd=content_doc_search" target="_blank">理命</a>令有共通的语法 　　&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mdadm能够执行几乎所有的功能而不需要配置文件(也没有默认的配置文件）</p>
<p><strong>三.作用&nbsp;（引用）</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在linux系统中目前以MD(Multiple Devices)虚拟块设备的方式实现软件RAID,利用多个底层的块设备虚拟出一个新的虚拟设备,并且利用条带化(stripping)技术将数据块均匀分布到多个磁盘上来提高虚拟设备的读写性能,利用不同的数据冗祭算法来保护用户数据不会因为某个块设备的故障而完全丢失,而且还能在设备被替换后将丢失的数据恢复到新的设备上.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目前MD支持linear,multipath,raid0(stripping),raid1(mirror),raid4,raid5,raid6,raid10等不同的冗余级别和级成方式,当然也能支持多个RAID陈列的层叠组成raid1 0,raid5 1等类型的陈列</p>
<p><strong>四.实验</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;试题：建立4个大小为1G的磁盘，并将其中3个创建为raid5的阵列磁盘，1个为热备份磁盘。测试热备份磁盘替换阵列中的磁盘并同步数据。移除损坏的磁盘，添加一个新磁盘作为热备份磁盘。最后要求开机自动挂载。</p>
<p><strong>4.1创建磁盘</strong></p>
<p>&nbsp;[root@xiao ~]# fdisk /dev/sda</p>
<p>WARNING: DOS-compatible mode is deprecated. It's strongly recommended to<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch off the mode (command 'c') and change display units to<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sectors (command 'u').</p>
<p>Command (m for help): n<br />First cylinder (10486-13054, default 10486):&nbsp;<br />Using default value 10486<br />Last cylinder, +cylinders or +size{K,M,G} (10486-13054, default 13054): +1G</p>
<p>Command (m for help): n<br />First cylinder (10618-13054, default 10618):&nbsp;<br />Using default value 10618<br />Last cylinder, +cylinders or +size{K,M,G} (10618-13054, default 13054): +1G</p>
<p>Command (m for help): n<br />First cylinder (10750-13054, default 10750):&nbsp;<br />Using default value 10750<br />Last cylinder, +cylinders or +size{K,M,G} (10750-13054, default 13054): +1G</p>
<p>Command (m for help): n<br />First cylinder (10882-13054, default 10882):&nbsp;<br />Using default value 10882<br />Last cylinder, +cylinders or +size{K,M,G} (10882-13054, default 13054): +1G</p>
<p>Command (m for help): t<br />Partition number (1-8): 8<br />Hex code (type L to list codes): fd<br />Changed system type of partition 8 to fd (Linux raid autodetect)</p>
<p>Command (m for help): t<br />Partition number (1-8): 7<br />Hex code (type L to list codes): fd<br />Changed system type of partition 7 to fd (Linux raid autodetect)</p>
<p>Command (m for help): t<br />Partition number (1-8): 6<br />Hex code (type L to list codes): fd<br />Changed system type of partition 6 to fd (Linux raid autodetect)</p>
<p>Command (m for help): t<br />Partition number (1-8): 5&nbsp;&nbsp;<br />Hex code (type L to list codes): fd<br />Changed system type of partition 5 to fd (Linux raid autodetect)</p>
<p>Command (m for help): p&nbsp;</p>
<p>Disk /dev/sda: 107.4 GB, 107374182400 bytes<br />255 heads, 63 sectors/track, 13054 cylinders<br />Units = cylinders of 16065 * 512 = 8225280 bytes<br />Sector size (logical/physical): 512 bytes / 512 bytes<br />I/O size (minimum/optimal): 512 bytes / 512 bytes<br />Disk identifier: 0x0008ed57</p>
<p>&nbsp;&nbsp; Device Boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Blocks&nbsp;&nbsp; Id&nbsp; System<br />/dev/sda1&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 204800&nbsp;&nbsp; 83&nbsp; Linux<br />Partition 1 does not end on cylinder boundary.<br />/dev/sda2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10225&nbsp;&nbsp;&nbsp; 81920000&nbsp;&nbsp; 83&nbsp; Linux<br />/dev/sda3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10225&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10486&nbsp;&nbsp;&nbsp;&nbsp; 2097152&nbsp;&nbsp; 82&nbsp; Linux swap / Solaris<br />/dev/sda4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10486&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 13054&nbsp;&nbsp;&nbsp; 20633279&nbsp;&nbsp;&nbsp; 5&nbsp; Extended<br />/dev/sda5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10486&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10617&nbsp;&nbsp;&nbsp;&nbsp; 1058045&nbsp;&nbsp; fd&nbsp; Linux raid autodetect<br />/dev/sda6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10618&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10749&nbsp;&nbsp;&nbsp;&nbsp; 1060258+&nbsp; fd&nbsp; Linux raid autodetect<br />/dev/sda7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10750&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10881&nbsp;&nbsp;&nbsp;&nbsp; 1060258+&nbsp; fd&nbsp; Linux raid autodetect<br />/dev/sda8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10882&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11013&nbsp;&nbsp;&nbsp;&nbsp; 1060258+&nbsp; fd&nbsp; Linux raid autodetect</p>
<p>Command (m for help): w<br />The partition table has been altered!</p>
<p>Calling ioctl() to re-read partition table.</p>
<p>WARNING: Re-reading the partition table failed with error 16: 设备或资源忙.<br />The kernel still uses the old table. The new table will be used at<br />the next reboot or after you run partprobe(8) or kpartx(8)<br />Syncing disks.</p>
<p><strong>4.2加载内核</strong></p>
<p>[root@xiao ~]# partx -a /dev/sda5 /dev/sda<br />[root@xiao ~]# partx -a /dev/sda6 /dev/sda<br />[root@xiao ~]# partx -a /dev/sda7 /dev/sda<br />[root@xiao ~]# partx -a /dev/sda8 /dev/sda</p>
<p><strong>4.3创建raid5及其热备份盘</strong></p>
<p>[root@xiao ~]# mdadm -C /dev/md0 -l 5 -n 3 -x 1&nbsp;&nbsp; /dev/sda{5,6,7,8}<br />mdadm: /dev/sda5 appears to be part of a raid array:<br />&nbsp;&nbsp;&nbsp; level=raid5 devices=3 ctime=Wed Dec 17 00:58:24 2014<br />mdadm: /dev/sda6 appears to be part of a raid array:<br />&nbsp;&nbsp;&nbsp; level=raid5 devices=3 ctime=Wed Dec 17 00:58:24 2014<br />mdadm: /dev/sda7 appears to be part of a raid array:<br />&nbsp;&nbsp;&nbsp; level=raid5 devices=3 ctime=Wed Dec 17 00:58:24 2014<br />mdadm: /dev/sda8 appears to be part of a raid array:<br />&nbsp;&nbsp;&nbsp; level=raid5 devices=3 ctime=Wed Dec 17 00:58:24 2014<br />Continue creating array? y<br />mdadm: Defaulting to version 1.2 metadata<br />mdadm: array /dev/md0 started.</p>
<p><strong>4.4初始化时间和磁盘阵列的读写的应用相关，使用cat /proc/mdstat信息查询RAID阵列当前重构的速度和预期的完成时间。</strong></p>
<p>[root@xiao ~]# cat /proc/mdstat<br />Personalities : [raid1] [raid0] [raid6] [raid5] [raid4]&nbsp;<br />md0 : active raid5 sda7[4] sda8[3](S) sda6[1] sda5[0]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2113536 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/2] [UU_]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [=========&gt;...........]&nbsp; recovery = 45.5% (482048/1056768) finish=0.3min speed=30128K/sec<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />unused devices: &lt;none&gt;<br />[root@xiao ~]# cat /proc/mdstat<br />Personalities : [raid1] [raid0] [raid6] [raid5] [raid4]&nbsp;<br />md0 : active raid5 sda7[4] sda8[3](S) sda6[1] sda5[0]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2113536 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/3] [UUU]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />unused devices: &lt;none&gt;</p>
<p>&nbsp;[root@xiao ~]# mke2fs -t ext3 /dev/md0 &nbsp; &nbsp; &nbsp; &nbsp;//格式化raid</p>
<p><strong>4.5挂载raid到/mnt目录下，并查看是否正常（显示lost+found为正常）</strong></p>
<p>[root@xiao ~]# mount /dev/md0 /mnt<br />[root@xiao ~]# ls /mnt<br />lost+found</p>
<p>&nbsp;</p>
<p><strong>4.6查看raid阵列的详细信息</strong></p>
<p>[root@xiao ~]# mdadm -D /dev/md0<br />/dev/md0:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Version : 1.2<br />&nbsp; Creation Time : Wed Dec 17 03:38:08 2014<br />&nbsp;&nbsp;&nbsp;&nbsp; Raid Level : raid5<br />&nbsp;&nbsp;&nbsp;&nbsp; Array Size : 2113536 (2.02 GiB 2.16 GB)<br />&nbsp; Used Dev Size : 1056768 (1032.17 MiB 1082.13 MB)<br />&nbsp;&nbsp; Raid Devices : 3<br />&nbsp; Total Devices : 4<br />&nbsp;&nbsp;&nbsp; Persistence : Superblock is persistent</p>
<p>&nbsp;&nbsp;&nbsp; Update Time : Wed Dec 17 03:55:11 2014<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; State : clean&nbsp;<br />&nbsp;Active Devices : 3<br />Working Devices : 4<br />&nbsp;Failed Devices : 0<br />&nbsp; Spare Devices : 1</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Layout : left-symmetric<br />&nbsp;&nbsp;&nbsp;&nbsp; Chunk Size : 512K</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name : xiao:0&nbsp; (local to host xiao)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UUID : bce110f2:34f3fbf1:8de472ed:633a374f<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Events : 18</p>
<p>&nbsp;&nbsp;&nbsp; Number&nbsp;&nbsp; Major&nbsp;&nbsp; Minor&nbsp;&nbsp; RaidDevice State<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active sync&nbsp;&nbsp; /dev/sda5<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active sync&nbsp;&nbsp; /dev/sda6<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active sync&nbsp;&nbsp; /dev/sda7</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spare&nbsp;&nbsp; /dev/sda8</p>
<p><strong>4.7模拟损坏其中的一个磁盘，这里我选择&nbsp; /dev/sda6磁盘</strong></p>
<p>[root@xiao ~]# mdadm /dev/md0 --fail /dev/sda6<br />mdadm: set /dev/sda6 faulty in /dev/md0</p>
<p><strong>4.7查看raid阵列详细信息，发现/dev/sda8自动替换了损坏的/dev/sda6磁盘。</strong><br />[root@xiao ~]# mdadm -D /dev/md0<br />/dev/md0:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Version : 1.2<br />&nbsp; Creation Time : Wed Dec 17 03:38:08 2014<br />&nbsp;&nbsp;&nbsp;&nbsp; Raid Level : raid5<br />&nbsp;&nbsp;&nbsp;&nbsp; Array Size : 2113536 (2.02 GiB 2.16 GB)<br />&nbsp; Used Dev Size : 1056768 (1032.17 MiB 1082.13 MB)<br />&nbsp;&nbsp; Raid Devices : 3<br />&nbsp; Total Devices : 4<br />&nbsp;&nbsp;&nbsp; Persistence : Superblock is persistent</p>
<p>&nbsp;&nbsp;&nbsp; Update Time : Wed Dec 17 04:13:59 2014<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; State : clean, degraded, recovering&nbsp;<br />&nbsp;Active Devices : 2<br />Working Devices : 3<br />&nbsp;Failed Devices : 1<br />&nbsp; Spare Devices : 1</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Layout : left-symmetric<br />&nbsp;&nbsp;&nbsp;&nbsp; Chunk Size : 512K</p>
<p>&nbsp;Rebuild Status : 43% complete</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name : xiao:0&nbsp; (local to host xiao)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UUID : bce110f2:34f3fbf1:8de472ed:633a374f<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Events : 26</p>
<p>&nbsp;&nbsp;&nbsp; Number&nbsp;&nbsp; Major&nbsp;&nbsp; Minor&nbsp;&nbsp; RaidDevice State<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active sync&nbsp;&nbsp; /dev/sda5<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spare rebuilding&nbsp;&nbsp; /dev/sda8<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active sync&nbsp;&nbsp; /dev/sda7</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; faulty&nbsp;&nbsp; /dev/sda6</p>
<p>[root@xiao ~]# cat /proc/mdstat<br />Personalities : [raid1] [raid0] [raid6] [raid5] [raid4]&nbsp;<br />md0 : active raid5 sda7[4] sda8[3] sda6[1](F) sda5[0]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2113536 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/3] [UUU]&nbsp;&nbsp; #正常的情况会是[UUU],若第一个磁盘损坏则显示[ _UU ].</p>
<p><strong>4.8 移除损坏的硬盘</strong></p>
<p>[root@xiao ~]# mdadm /dev/md0 -r /dev/sda6<br />mdadm: hot removed /dev/sda6 from /dev/md0</p>
<p><strong>4.9添加一个新硬盘作为热备份盘</strong></p>
<p>[root@xiao ~]# fdisk /dev/sda</p>
<p>WARNING: DOS-compatible mode is deprecated. It's strongly recommended to<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch off the mode (command 'c') and change display units to<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sectors (command 'u').</p>
<p>Command (m for help): n<br />First cylinder (11014-13054, default 11014):&nbsp;<br />Using default value 11014<br />Last cylinder, +cylinders or +size{K,M,G} (11014-13054, default 13054): +1G</p>
<p>Command (m for help): t<br />Partition number (1-9): 9<br />Hex code (type L to list codes): fd<br />Changed system type of partition 9 to fd (Linux raid autodetect)</p>
<p>Command (m for help): p</p>
<p>Disk /dev/sda: 107.4 GB, 107374182400 bytes<br />255 heads, 63 sectors/track, 13054 cylinders<br />Units = cylinders of 16065 * 512 = 8225280 bytes<br />Sector size (logical/physical): 512 bytes / 512 bytes<br />I/O size (minimum/optimal): 512 bytes / 512 bytes<br />Disk identifier: 0x0008ed57</p>
<p>&nbsp;&nbsp; Device Boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Blocks&nbsp;&nbsp; Id&nbsp; System<br />/dev/sda1&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 204800&nbsp;&nbsp; 83&nbsp; Linux<br />Partition 1 does not end on cylinder boundary.<br />/dev/sda2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10225&nbsp;&nbsp;&nbsp; 81920000&nbsp;&nbsp; 83&nbsp; Linux<br />/dev/sda3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10225&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10486&nbsp;&nbsp;&nbsp;&nbsp; 2097152&nbsp;&nbsp; 82&nbsp; Linux swap / Solaris<br />/dev/sda4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10486&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 13054&nbsp;&nbsp;&nbsp; 20633279&nbsp;&nbsp;&nbsp; 5&nbsp; Extended<br />/dev/sda5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10486&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10617&nbsp;&nbsp;&nbsp;&nbsp; 1058045&nbsp;&nbsp; fd&nbsp; Linux raid autodetect<br />/dev/sda6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10618&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10749&nbsp;&nbsp;&nbsp;&nbsp; 1060258+&nbsp; fd&nbsp; Linux raid autodetect<br />/dev/sda7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10750&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10881&nbsp;&nbsp;&nbsp;&nbsp; 1060258+&nbsp; fd&nbsp; Linux raid autodetect<br />/dev/sda8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10882&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11013&nbsp;&nbsp;&nbsp;&nbsp; 1060258+&nbsp; fd&nbsp; Linux raid autodetect<br />/dev/sda9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11014&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11145&nbsp;&nbsp;&nbsp;&nbsp; 1060258+&nbsp; fd&nbsp; Linux raid autodetect</p>
<p>Command (m for help): w<br />The partition table has been altered!</p>
<p>Calling ioctl() to re-read partition table.</p>
<p>WARNING: Re-reading the partition table failed with error 16: 设备或资源忙.<br />The kernel still uses the old table. The new table will be used at<br />the next reboot or after you run partprobe(8) or kpartx(8)<br />Syncing disks.<br />[root@xiao ~]# partx -a /dev/sda9 /dev/sda</p>
<p>[root@xiao ~]# mdadm /dev/md0 --add /dev/sda9<br />mdadm: added /dev/sda9</p>
<p>&nbsp;</p>
<p>[root@xiao ~]# mdadm -D /dev/md0<br />/dev/md0:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Version : 1.2<br />&nbsp; Creation Time : Wed Dec 17 03:38:08 2014<br />&nbsp;&nbsp;&nbsp;&nbsp; Raid Level : raid5<br />&nbsp;&nbsp;&nbsp;&nbsp; Array Size : 2113536 (2.02 GiB 2.16 GB)<br />&nbsp; Used Dev Size : 1056768 (1032.17 MiB 1082.13 MB)<br />&nbsp;&nbsp; Raid Devices : 3<br />&nbsp; Total Devices : 4<br />&nbsp;&nbsp;&nbsp; Persistence : Superblock is persistent</p>
<p>&nbsp;&nbsp;&nbsp; Update Time : Wed Dec 17 04:39:35 2014<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; State : clean&nbsp;<br />&nbsp;Active Devices : 3<br />Working Devices : 4<br />&nbsp;Failed Devices : 0<br />&nbsp; Spare Devices : 1</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Layout : left-symmetric<br />&nbsp;&nbsp;&nbsp;&nbsp; Chunk Size : 512K</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name : xiao:0&nbsp; (local to host xiao)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UUID : bce110f2:34f3fbf1:8de472ed:633a374f<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Events : 41</p>
<p>&nbsp;&nbsp;&nbsp; Number&nbsp;&nbsp; Major&nbsp;&nbsp; Minor&nbsp;&nbsp; RaidDevice State<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active sync&nbsp;&nbsp; /dev/sda5<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active sync&nbsp;&nbsp; /dev/sda8<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active sync&nbsp;&nbsp; /dev/sda7</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spare&nbsp;&nbsp; /dev/sda9</p>
<p><strong>5.开机自动挂载</strong></p>
<p>编辑/etc/fsab文件</p>
<p>/dev/md0&nbsp;&nbsp;/mnt&nbsp;&nbsp;&nbsp;ext3&nbsp;defaults&nbsp;0 0</p>
<p>:wq</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>6.mdadm中文man(引用)</strong><br />基本语法 ： mdadm [mode] [options]<br />[mode] 有7种：<br />Assemble：将以前定义的某个阵列加入当前在用阵列。<br />Build：Build a legacy array ，每个device 没有 superblocks<br />Create：创建一个新的阵列，每个device 具有 superblocks<br />Manage： 管理阵列，比如 add 或 remove<br />Misc：允许单独对阵列中的某个 device 做操作，比如抹去superblocks 或 终止在用的阵列。<br />Follow or Monitor:监控 raid 1,4,5,6 和 multipath 的状态<br />Grow：改变raid 容量或 阵列中的 device 数目<br />可用的 [options]:<br />-A, --assemble：加入一个以前定义的阵列<br />-B, --build：Build a legacy array without superblocks.<br />-C, --create：创建一个新的阵列<br />-Q, --query：查看一个device，判断它为一个 md device 或是 一个 md 阵列的一部分<br />-D, --detail：打印一个或多个 md device 的详细信息<br />-E, --examine：打印 device 上的 md superblock 的内容<br />-F, --follow, --monitor：选择 Monitor 模式<br />-G, --grow：改变在用阵列的大小或形态<br />-h, --help：帮助信息，用在以上选项后，则显示该选项信息<br />--help-options<br />-V, --version<br />-v, --verbose：显示细节<br />-b, --brief：较少的细节。用于 --detail 和 --examine 选项<br />-f, --force<br />-c, --config= ：指定配置文件，缺省为 /etc/mdadm/mdadm.conf<br />-s, --scan：扫描配置文件或 /proc/mdstat以搜寻丢失的信息。配置文件/etc/mdadm/mdadm.conf<br />create 或 build 使用的选项:<br />-c, --chunk=:Specify chunk size of kibibytes. 缺省为 64.<br />--rounding=: Specify rounding factor for linear array (==chunk size)<br />-l, --level=:设定 raid level.<br />--create可用:linear, raid0, 0, stripe, raid1,1, mirror, raid4, 4, raid5, 5, raid6, 6, multipath, mp.<br />--build可用：linear, raid0, 0, stripe.<br />-p, --parity=：设定 raid5 的奇偶校验规则:eft-asymmetric, left-symmetric, right-asymmetric, right-symmetric, la, ra, ls, rs.缺省为left-symmetric<br />--layout=:类似于--parity<br />-n, --raid-devices=:指定阵列中可用 device 数目，这个数目只能由 --grow 修改<br />-x, --spare-devices=：指定初始阵列的富余device 数目<br />-z, --size=：组建RAID1/4/5/6后从每个device获取的空间总数<br />--assume-clean:目前仅用于 --build 选项<br />-R, --run:阵列中的某一部分出现在其他阵列或文件系统中时，mdadm会确认该阵列。此选项将不作确认。<br />-f, --force:通常mdadm不允许只用一个device 创建阵列，而且创建raid5时会使用一个device作为missing drive。此选项正相反。<br />-a, --auto{=no,yes,md,mdp,part,p}{NN}：</p>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2017-02-15 21:07</span>&nbsp;
<a href="https://www.cnblogs.com/ariclee/">Aric.lee</a>&nbsp;
阅读(<span id="post_view_count">...</span>)&nbsp;
评论(<span id="post_comment_count">...</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=6403396" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(6403396);return false;">收藏</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>
<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 239389, cb_blogApp = 'ariclee', cb_blogUserGuid = 'a8f62240-1b3f-e511-b908-9dcfd8948a71';
    var cb_entryId = 6403396, cb_entryCreatedDate = '2017-02-15 21:07', cb_postType = 1; 
    loadViewCount(cb_entryId);
    loadSideColumnAd();
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>

<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
    </script>
    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot("/1090369/C1", [300, 250], "div-gpt-ad-1546353474406-0").addService(googletag.pubads());
            googletag.defineSlot("/1090369/C2", [468, 60], "div-gpt-ad-1539008685004-0").addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;"></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;"></div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);        deliverAdT2();
        deliverAdC1();
        deliverAdC2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>
	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>

<div id="sidebar_ad"></div>
			<div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright &copy; 2020 Aric.lee
<br /><span id="poweredby">Powered by .NET Core on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    
</body>
</html>
