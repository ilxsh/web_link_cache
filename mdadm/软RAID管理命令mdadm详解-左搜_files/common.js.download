/**
 * 
 */
$(function(){
    //f12
    // $(document).keydown(function(e){
    //     var currKey=0,evt=e||window.event;
    //     currKey=evt.keyCode||evt.which||evt.charCode;
    //     if((event.ctrlKey)&&(event.shiftKey)&&(event.keyCode==67)){
    //         window.event.cancelBubble = true;
    //         window.event.returnValue = false;
    //     }
    //     if (currKey == 123) {
    //         window.event.cancelBubble = true;
    //         window.event.returnValue = false;
    //     }
    // });
    // //鼠标右键菜单
    // $(document).on("contextmenu",function(e){return false;});
    // $(document).bind("onselectstart",function(e){return false;});
	init();
	 $('img.img-thumbnail').bootstrapImageViewer();
 	//绑定标签事件
	$(document).on('click','.viewTag',function(){
		var key=$(this).text();
		window.open("/s/"+encodeURIComponent(key));
	});
	
	//绑定打赏弹窗
	$(document).on('click','.reward-btn',function(){
		rewardFun();
	});
})
function init(){
	//获取用户cookie,处理菜单
	var userName=$.cookie("_uNickname");
    if (userName){
        userName=decodeURIComponent(userName);
    }else{
        userName='无名';
    }
	var sex=$.cookie("_uSex");
	var _uToken=$.cookie("_uToken");
	var _uManage=$.cookie("_uManage");
	var _uAuthor=$.cookie("_uAuthor");
	
	//处理性别
	var sexHtml='<span>♂</span>';
	if (sex==0) {
		sexHtml='<span>♀</span>';
	}
	
	if(userName&&_uToken){
		$('#header-login').html('');
		$('#header-login').addClass('dropdown');
		var html='<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'+userName+'·'+sexHtml+'<span class="caret"></span></a>'+
            '<ul class="dropdown-menu">'+
        '<li><a href="/admin" target="">个人中心</a>'+
        '<li><a href="/admin/logout" style="color:red;">退出</a></li>'+
      '</ul>';
		$('#header-login').append(html);
		$('.login-reg-btn').hide();
	}else{
		$('#header-login').html('');
		$('#header-login').removeClass('dropdown');
		$('.login-reg-btn').show();
	}
	//导航自动手抚琴效果-#navbar_top
	$('#main-nav>li.dropdown>a').mouseover(function() {
        $(this).parent().parent().find('li').removeClass('open');
		$(this).parent().addClass('open');
	});

	//网站头部搜索
	$('#header_search_value').keydown(function(event){
		if(event.keyCode ==13){
			var key=$(this).val();
			if(key!=null&&key.length>0){
				window.open("/s/"+encodeURIComponent(key));
			}else{
				layer.msg('输入点啥内容吧',{icon:2});
			}
		}
	});
	
}
function regmsg(){
	layer.alert("感谢您的支持,注册功能将后续开放,敬请期待...",{icon:0});
}

/**
 *是否包含非法字符
 **/
 function checkIllegal(str){
	 if(str){
		 var reg = new RegExp("<\s*script\s*>.*<\s*/\s*script\s*>");
		 if(reg.test(str)){
			 return true;
		 }else{
			 reg = new RegExp("<\s*script[^>|]*>");
			 if(reg.test(str)){
				 return true;
			 }else{
				 return false;
			 }
		 }
	 }
 }
/**打赏弹框**/
function rewardFun(){
var html= '<div class="row"> <div clss="col-xs-12">'+
				'<ul id="myTab" class="nav nav-tabs">'+
					'<li class="active">'+
						'<a href="#pop-reward-alipay" data-toggle="tab">支付宝</a>'+
					'</li>'+
					'<li>'+
						'<a href="#pop-reward-wechat" data-toggle="tab">微信</a>'+
					'</li>'+
				'</ul>'+
			'</div>'+
			'<div class="tab-content">'+
				'<div class="tab-pane fade in active" id="pop-reward-alipay">'+
				'<img alt="support" src="//images/support-alipay.png" class="img-responsive"/>'+
				'</div>'+
				'<div class="tab-pane fade items" id="pop-reward-wechat">'+
				'<img alt="support" src="/assets/images/support-wechat.png" class="img-responsive"/>'+
				'</div>'+
			'</div></div>';

layer.open({
	  title:'',
	  area: ['320px', '310px'],
	  anim: 1,
	  content: html,
	  btn:[]
	});
 }

//对Date的扩展，将 Date 转化为指定格式的String
//月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符， 
//年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字) 
//例子： 
//(new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423 
//(new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18 
Date.prototype.Format = function (fmt) { //author: meizz 
 var o = {
     "M+": this.getMonth() + 1, //月份 
     "d+": this.getDate(), //日 
     "h+": this.getHours(), //小时 
     "m+": this.getMinutes(), //分 
     "s+": this.getSeconds(), //秒 
     "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
     "S": this.getMilliseconds() //毫秒 
 };
 if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
 for (var k in o)
 if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
 return fmt;
}


//判断是否PC端
function isMobile(){
	return /Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent);
}

function blogSearch(el) {
	window.location.href="/s/"+$(el).find('input[name=keyword]').val();
	return false;
}
