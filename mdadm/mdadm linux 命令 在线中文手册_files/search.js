/*! jstest 2015-09-21 */
function searchindex(){var a=this;this.init=function(){time_now=(new Date).getTime(),a.right(),0==getCookie("iscollect")?a.collect():$(".collect").css("cursor","auto"),a.wrong(),a.radio(),a.formcheck(),a.logincheck(),a.replay(),a.commentcheck(),a.commentlist()},this.collect=function(){$(".collect").bind("click",function(){is_login=getCookie("haslogin"),0!=is_login?$.ajax({type:"POST",url:"./?mod=ajax&app=ajax_login",async:!1,success:function(b){"yes"==b&&($("#collect_menu").show(),$("#loginout").show(),$("#login").hide(),$("#regist").hide(),$(".collect").css("cursor","auto").unbind("click").find("em").html(parseInt($(".collect").find("em").html())+1),a.success_tip("收藏已成功"))}}):(a.qqlogin(),a.weibologin(),$("#collect").dialog({width:470,minHeight:50}))})},this.right=function(){$(".right").each(function(){getCookie($(this).attr("title")+$(this).attr("alt"))?$(this).css("cursor","auto"):$(this).bind("click",function(){$this=$(this),$.ajax({type:"POST",url:"./?mod=ajax&&app=ajax_search&act=correct",async:!1,data:{sigle:$this.attr("title"),id:$this.attr("alt")},success:function(a){"yes"==a&&$this.css("cursor","auto").unbind("click").find("em").html(parseInt($this.find("em").html())+1)}})})})},this.wrong=function(){$(".wrong").bind("click",function(){$("#sigle").val($(this).attr("title")),$("#id").val($(this).attr("alt")),$("#modify").dialog({width:570,minHeight:50}),$(".ui-dialog").draggable()})},this.radio=function(){$(".typeselect input[type='radio']").bind("click",function(){$("#addform").show(),(2==$(this).val()||$(this).checked)&&($("#e_content").parent().hide(),$("#e_content").val("1"),$("#c_correct").prev().html("添加内容:"),$("#selected_radio").val($(this).val())),(1==$(this).val()||$(this).checked)&&($("#e_content").parent().show(),$("#e_content").val(""),$("#e_content").prev().html("错误内容:"),$("#c_correct").prev().html("正确内容:"),$("#selected_radio").val($(this).val())),(3==$(this).val()||$(this).checked)&&($("#e_content").parent().show(),$("#e_content").val(""),$("#e_content").prev().html("删除内容:"),$("#c_correct").prev().html("删除原因:"),$("#selected_radio").val($(this).val()))})},this.reduce_time=function(){var b=parseInt($("#success span").text());b>1?$("#success span").html(b-1):$("#success").dialog("close"),$("#success:visible")&&setTimeout(a.reduce_time,1e3)},this.success_tip=function(b){string='<div id="success" title="操作"  style="display:none;">',string+=b+"<br /><span>4</span>秒后自动关闭 </div>",$(string).insertAfter("#modify"),$("#success").dialog({width:220,height:170,hide:"explode",close:function(){a.success_tip_remove()}}),a.reduce_time()},this.qqlogin=function(){QC.Login({btnId:"qqlogin",scope:"all",size:"A_M"},function(b,c){QC.Login.check()&&QC.Login.getMe(function(b,c){b&&$.ajax({type:"POST",url:"./?mod=ajax&app=ajax_login&act=qq",async:!1,data:{openid:b,access:c},success:function(b){"yes"==b&&($("#collect_menu").show(),$("#loginout").show(),$("#login").hide(),$("#regist").hide(),$("#collect").dialog("close"),$(".collect").css("cursor","auto").unbind("click").find("em").html(parseInt($(".collect").find("em").html())+1),a.success_tip("已收藏成功"))}})})})},this.weibologin=function(){WB2.anyWhere(function(b){b.widget.connectButton({id:"weibologin",type:"3,2",callback:{login:function(b){$.ajax({type:"POST",url:"./?mod=ajax&app=ajax_login&act=weibo",async:!1,success:function(b){"yes"==b&&($("#collect_menu").show(),$("#loginout").show(),$("#login").hide(),$("#regist").hide(),$("#collect").dialog("close"),$(".collect").css("cursor","auto").unbind("click").find("em").html(parseInt($(".collect").find("em").html())+1),a.success_tip("已收藏成功"))}})}}})})},this.success_tip_remove=function(){$("#success").remove()},this.formcheck=function(){$("#commandform").validate({errorPlacement:function(a,b){a.appendTo(b.parent()),"add_input"==$(b).parent().attr("class")&&b.next(".selectBox").addClass("error")},onkeyup:!1,rules:{e_content:"required",c_correct:"required",checkcode:{required:!0}},messages:{checkcode:{required:"验证码不能为空"},e_content:{required:"不能为空"},c_correct:{required:"不能为空"}},submitHandler:function(){$.ajax({type:"POST",url:"./?mod=ajax&&app=ajax_search&act=wrong",async:!1,data:$("#commandform").serialize(),success:function(b){"yes"==b&&($("#e_content,#c_correct,#username,#checkcode").val(""),$("#modify").dialog("close"),a.success_tip("提交已成功待审核")),"1"==b&&$("#checkcode").addClass("error")}})}})},this.replay=function(){$(".commentlist a").bind("click",function(){$("#respond").remove().clone().insertAfter($(this).parent().parent()),$("#cancel-comment-reply-link").show(),a.commentcheck(),$("#comment_parent").val($(this).parent().parent().attr("alt")),a.cancel()})},this.cancel=function(){$("#cancel-comment-reply-link").bind("click",function(){$("#respond").remove().clone().appendTo($(".content")),$("#comment_parent").val(""),a.commentcheck(),$("#cancel-comment-reply-link").hide()})},this.commentlist=function(){$(".commentlist li").each(function(){"0"!=$(this).attr("data")&&($("#comment-"+$(this).attr("data")).append($(this).parent().clone(!0)),$(this).parent().remove())})},this.commentcheck=function(){$("#commentform").validate({errorPlacement:function(a,b){a.appendTo(b.parent()),"add_input"==$(b).parent().attr("class")&&b.next(".selectBox").addClass("error")},onkeyup:!1,rules:{commentcode:{required:!0},commentconent:{required:!0}},messages:{commentcode:{required:"验证码不能为空"},commentconent:{required:"内容不能为空"}},submitHandler:function(){$.ajax({type:"POST",url:"./?mod=ajax&&app=ajax_search&act=comment",async:!1,data:$("#commentform").serialize(),success:function(b){"yes"==b&&($("#commentconent,#commentcode").val(""),a.success_tip("评论已成功待审核")),"1"==b&&$("#commentcode").addClass("error").next().next().html("验证码不正确").show()}})}})},this.logincheck=function(){$("#loginform").validate({errorPlacement:function(a,b){a.appendTo(b.parent()),"form_input"==$(b).parent().attr("class")&&b.next(".selectBox").addClass("error")},rules:{loginusername:{required:!0,email:!0},password:{required:!0},logincheckcode:{required:!0}},messages:{loginusername:{required:"请输入邮箱",email:"邮箱地址不正确"},password:{required:"请输入密码"},logincheckcode:{required:"验证码不能为空"}},submitHandler:function(){$.ajax({type:"POST",url:"./?mod=ajax&app=ajax_login",async:!1,data:{checkcode:$("#logincheckcode").val(),email:$("#loginusername").val(),password:$("#password").val(),remember:$("#remember:checked").length},success:function(b){"yes"==b&&($("#collect_menu").show(),$("#loginout").show(),$("#login").hide(),$("#regist").hide(),$("#collect").dialog("close"),$(".collect").css("cursor","auto").unbind("click").find("em").html(parseInt($(".collect").find("em").html())+1),a.success_tip("已收藏成功")),"1"==b&&$("#logincheckcode").addClass("error").next().next().html("验证码不正确").show()}})}})}}