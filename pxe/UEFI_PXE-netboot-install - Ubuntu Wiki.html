<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>UEFI/PXE-netboot-install - Ubuntu Wiki</title>
<script type="text/javascript" src="/moin_static198/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static198/light/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/moin_static198/light/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/moin_static198/light/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/moin_static198/light/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static198/light/css/msie.css">
<![endif]-->


<link rel="alternate" title="Ubuntu Wiki: UEFI/PXE-netboot-install" href="/UEFI/PXE-netboot-install?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=UEFI%2FPXE-netboot-install&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="/Home">
<link rel="Alternate" title="Wiki Markup" href="/UEFI/PXE-netboot-install?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/UEFI/PXE-netboot-install?action=print">
<link rel="Up" href="/UEFI">
<link rel="Search" href="/FindPage">
<link rel="Index" href="/TitleIndex">
<link rel="Glossary" href="/WordIndex">
<link rel="Help" href="/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">

<!-- BEGIN HEADER -->
<div id="wrapper" class="hfeed">
<div id="header">
    <ul id="mothership">
        <li> <a href="http://www.ubuntu.com/partners">Partners</a> </li>
        <li> <a href="http://www.ubuntu.com/support">Support</a> </li>
        <li> <a href="http://www.ubuntu.com/community">Community</a> </li>
        <li> <a href="http://www.ubuntu.com">Ubuntu.com</a> </li>
    </ul>

    <div id="orangeHeader">
        <h1> <a href="/" title="Ubuntu Wiki"><span>Ubuntu Wiki</span></a> </h1>
            <div id="search-box">

<form id="searchform" method="get" action="/UEFI/PXE-netboot-install">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>


            </div>
    </div>

</div>
    <div id="wikinav"> 
<ul class="editbar"><li><span class="disabled">Immutable Page</span></li><li><a class="nbinfo" href="/UEFI/PXE-netboot-install?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="/UEFI/PXE-netboot-install?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="/UEFI/PXE-netboot-install">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="RenderAsDocbook">Render as Docbook</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="CopyPage">Copy Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="SyncPages">Sync Pages</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="Load">Load</option>
<option value="Save">Save</option>
<option value="SlideShow">SlideShow</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="username">
<li><a href="/Home">Ubuntu Wiki</a></li>
<li><a href="?action=login">Login</a></li>
<li><a href="/HelpContents">Help</a></li>
</ul>

        <hr class="clearBoth" />
    </div>
    
	<div id="main"> 
		<div id="container">
			<div id="content">
		<h2 class="entry-title"> 
<span><a href="/UEFI/PXE-netboot-install">PXE-netboot-install</a></span>
</h2>
	<div class="hentry post">
               

<div id="page" lang="en" dir="ltr">

<!-- END HEADER --><div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
<h1 id="UEFI_PXE_netboot_.2F_install_procedure">UEFI PXE netboot / install procedure</h1>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><em>Method developed by Will Tinsdeall &lt;<a class="mailto" href="mailto:will.tinsdeall+opensource@mercianlabels.com">will.tinsdeall+opensource@mercianlabels.com</a>&gt;</em> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><em>Original article by Kamal Mostafa &lt;<a class="mailto" href="mailto:kamal@canonical.com">kamal@canonical.com</a>&gt;</em> <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line867">
<h2 id="Using_this_method">Using this method</h2>
<span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line874">This method is an experimental method, which serves a UEFI signed grub image, loads the configuration in grub.cfg and boots the Linux kernel. <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line874">The original method on this Wiki page used an all-in-one image, which was good for the simple install on diskless PCs, but made preseeding impossible without modifying the mini.iso <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line867">
<h3 id="Step_1:_Get_the_files">Step 1: Get the files</h3>
<span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line862">1. Download the UEFI signed grub image into /srv/tftp/: <a class="http" href="http://archive.ubuntu.com/ubuntu/dists/trusty/main/uefi/grub2-amd64/current/grubnetx64.efi.signed">http://archive.ubuntu.com/ubuntu/dists/trusty/main/uefi/grub2-amd64/current/grubnetx64.efi.signed</a> <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line862">2. Download the correct netboot.tar.gz archive (navigate to the correct one!): <a class="http" href="http://cdimage.ubuntu.com/netboot/">http://cdimage.ubuntu.com/netboot/</a> <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line874">3. Extract netboot.tar.gz into /srv/tftp/ <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h3 id="Step_2:_Get_the_files">Step 2: Get the files</h3>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line867"><img alt="Warning /!\" height="16" src="/moin_static198/light/img/icon_eek.png" title="Warning /!\" width="16" /> On releases after 14.04; you should also provide the file 'install/filesystem.squashfs' via HTTP or FTP to use to complete the netboot install. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line874">1. Create the file /srv/tftp/grub/grub.cfg with the following content. Add other entries as needed: <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">For standard install (Not Preseeded): <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line867"><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><pre><span class="anchor" id="line-1"></span>menuentry "Install Ubuntu" {
<span class="anchor" id="line-2"></span>set gfxpayload=keep
<span class="anchor" id="line-3"></span>linux /ubuntu-installer/amd64/linux gfxpayload=800x600x16,800x600 --- quiet
<span class="anchor" id="line-4"></span>initrd /ubuntu-installer/amd64/initrd.gz
<span class="anchor" id="line-5"></span>}</pre><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line867"><img alt="Warning /!\" height="16" src="/moin_static198/light/img/icon_eek.png" title="Warning /!\" width="16" /> On releases after 14.04; add "live-installer/net-image=$PATH_TO_FILESYSTEM_SQUASHFS" before the three dashes to provide a root filesystem for the installer to use as a base for the install; or use "live-installer/enable=false". <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line874">For Preseeding (automatic hands-off install - you will need an HTTP server to serve the config): <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line867"><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><pre><span class="anchor" id="line-1-1"></span>menuentry "Install Ubuntu" {
<span class="anchor" id="line-2-1"></span>set gfxpayload=keep
<span class="anchor" id="line-3-1"></span>linux /ubuntu-installer/amd64/linux gfxpayload=800x600x16,800x600 --- auto=true url=http://YOUR_PRESEED_SERVER/preseed.cfg quiet
<span class="anchor" id="line-4-1"></span>initrd /ubuntu-installer/amd64/initrd.gz
<span class="anchor" id="line-5-1"></span>}</pre><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><p class="line867">
<h3 id="Step_3:_Install_TFTP_and_DHCP_server_.28for_simplicity.2C_dnsmasq_is_used_here.29">Step 3: Install TFTP and DHCP server (for simplicity, dnsmasq is used here)</h3>
<span class="anchor" id="line-52"></span><p class="line874">1. Install dnsmasq: <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><p class="line867"><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><pre><span class="anchor" id="line-1-2"></span>sudo apt-get install dnsmasq</pre><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line874">2. Set your computer to use a static IP <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line874">3. Configure dnsmasq add these lines to /etc/dnsmasq.conf <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line867"><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><pre><span class="anchor" id="line-1-3"></span>interface=eth0
<span class="anchor" id="line-2-2"></span>bind-interfaces
<span class="anchor" id="line-3-2"></span>dhcp-range=192.168.99.10,192.168.99.254
<span class="anchor" id="line-4-2"></span>dhcp-boot=grubnetx64.efi.signed
<span class="anchor" id="line-5-2"></span>enable-tftp
<span class="anchor" id="line-6"></span>tftp-root=/srv/tftp/</pre><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line874">4. Reload dnsmasq <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line867"><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><pre><span class="anchor" id="line-1-4"></span>sudo service dnsmasq restart</pre><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><p class="line867">
<h2 id="Alternative_method_to_create_a_boot_image_.28all-in-one_file.29">Alternative method to create a boot image (all-in-one file)</h2>
<span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><p class="line874">Exchange this for Step 1 and Step 2. These instructions are from the original wiki <span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><ol type="1"><li>Install a regular Ubuntu system + updates, or use an existing Ubuntu system as the Server.    The Server can be any computer with a wired NIC; the Server itself does not need to be UEFI-capable.  (I installed ubuntu-11.10-desktop-amd64.iso from a USB stick on to an x220 laptop, but any Ubuntu installation should work). <span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span></li><li class="gap">On the Server system, fetch a netboot "mini.iso" image and save it with a distinct filename (or substitute a different Ubuntu distro for "trusty"; see Notes below about Debian): <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><pre><span class="anchor" id="line-1-5"></span>wget http://ftp.ubuntu.com/ubuntu/dists/trusty/main/installer-amd64/current/images/netboot/mini.iso  \
<span class="anchor" id="line-2-3"></span>                -O /tmp/mini-trusty.iso</pre><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span></li><li class="gap">Generate a custom "grubnetx64.efi.signed" image with the mini-distro.iso embedded inside, and (Important!) with all available x86_64-efi grub modules enabled.  You will move the generated .efi image file from /tmp to the tftpboot directory in a moment: <span class="anchor" id="line-90"></span><ul><li><p class="line862">the <tt class="backtick">ls|sed</tt> sequence generates the list of all modules. <span class="anchor" id="line-91"></span></li><li>many of the modules are actually required, but surely not all; I don't know which are or aren't required. <span class="anchor" id="line-92"></span></li></ul><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><pre><span class="anchor" id="line-1-6"></span>sudo apt-get install grub-efi-amd64-bin
<span class="anchor" id="line-2-4"></span>
<span class="anchor" id="line-3-3"></span>grub-mkimage --format=x86_64-efi  \
<span class="anchor" id="line-4-3"></span>                --output=/tmp/grubnetx64.efi.signed   \
<span class="anchor" id="line-5-3"></span>                --memdisk=/tmp/mini-trusty.iso  \
<span class="anchor" id="line-6-1"></span>                `ls /usr/lib/grub/x86_64-efi  | sed -n 's/\.mod//gp'`</pre><span class="anchor" id="line-100"></span><ul><li><p class="line862">Note that some modules may cause the installation to stall with a <em>error: no device connected</em> message, in this case you will need to remove the drivers giving the error. For instance, to remove the <em>pata</em> module, change the module listing part to <tt class="backtick">ls&nbsp;/usr/lib/grub/x86_64-efi&nbsp;&nbsp;|&nbsp;sed&nbsp;-n&nbsp;'s/\.mod//gp'&nbsp;|&nbsp;grep&nbsp;-v&nbsp;pata</tt> <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span></li></ul></li></ol><p class="line874">Notes: <span class="anchor" id="line-104"></span><ul><li><p class="line862">This method seems like it should work with Debian wheezy's netboot/mini.iso also, but it doesn't quite; the Clients just boot to a grub&gt; prompt instead of a grub installer menu.  Perhaps wheezy's iso contains a grub.cfg someplace other than the /boot/grub dir that Ubuntu's grub expects? <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span></li><li class="gap"><p class="line862">If you see a "error: variable `prefix' isn't set" message, it can be safely ignored. Really, it doesn't mean anything. If your installation is stalling and this is visible on-screen, you should look at the "next" error, that's the one actually stopping it form working. If it <em>really</em> bothers you, play around with the '-p'  parameter to <em>grub-mkimage</em> and see you can make it go away. <span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span></li></ul><p class="line867">
<h2 id="Optional_Extras">Optional Extras</h2>
<span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><p class="line867">
<h3 id="Install_a_package_cacher">Install a package cacher</h3>
<span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><p class="line862">This will ensure that your internet is not hammered by hundreds of PCs, by caching the downloads required for the install on a local server. If you are using preseed, add this to your HTTP Proxy settings in your preseed config (HTTP Proxy: <a class="http" href="http://[The">http://[The</a> IP Address]:3142/). <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line874">1. Install apt-cacher-ng to provide http proxy service to the Clients (proxy listens on port 3142): <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line867"><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><pre><span class="anchor" id="line-1-7"></span>sudo apt-get install apt-cacher-ng</pre><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line874">Notes: <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line874">* The installed Client system will remember the proxy server setting in /etc/apt/apt.conf -- remove that file from the installed Client if you don't plan to keep it attached to the server's network. <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line874">* If you use apt-cacher-ng as described above, subsequent client installs using this Server will be much faster than the first client install. <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><p class="line867">
<h2 id="Debugging_Options">Debugging Options</h2>
<span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><p class="line874">A. Watch syslog on the Server with "tail -f /var/log/syslog" <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><p class="line874">B. Run tcpdump on the server, to check which files are being requested (tcpdump must be installed): <span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><pre><span class="anchor" id="line-1-8"></span>tcpdump -i eth0 port 69</pre><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><p class="line867">
<h2 id="Notes">Notes</h2>
<span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><ul><li>It is possible to configure dhcp to offer different images to different clients based on MAC address and some other variables, which could be used to offer UEFI (bootx64.efi) and legacy BIOS (pxelinux.0) images, but this is not covered here. <span class="anchor" id="line-141"></span></li></ul><span class="anchor" id="bottom"></span></div> <!-- BEGIN FOOTER -->
<div id="pagebottom"></div>
</div>


        <div class="entry-utility"> 
            <span class="cat-links">
<p id="pageinfo" class="info" lang="en" dir="ltr">UEFI/PXE-netboot-install  (last edited 2016-09-23 20:55:07 by <span title="cyphermox @ localhost[127.0.0.1]"><a class="interwiki" href="https://launchpad.net/~cyphermox" title="cyphermox @ localhost[127.0.0.1]">cyphermox</a></span>)</p>

</span> 
        </div> 
    </div><!-- .post --> 
 
            </div><!-- #content --> 
        </div><!-- #container --> 
        <div class="clearBoth"></div> 
    </div><!-- #main --> 
</div><!-- #wrapper .hfeed --> 
    
<div id="footer"> 
    <div id="siteinfo">        
        <p> The material on this wiki is available under a free license, see 
	<a href="https://help.ubuntu.com/community/License">Copyright / License</a> for details.
        </p> 
    </div><!-- #siteinfo --> 
</div><!-- #footer  --> 
<script> (function(i,s,o,g,r,a,m){ i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1018242-7', 'auto'); ga('send', 'pageview'); </script></body>
</html>

