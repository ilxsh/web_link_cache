<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="https://wiki.debian.org/htdocs/favicon.ico">
<script type="text/javascript" src="LDAP_OpenLDAPSetup%20-%20Debian%20Wiki_files/bugstatus.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="index,nofollow">

<title>LDAP/OpenLDAPSetup - Debian Wiki</title>
<script type="text/javascript" src="LDAP_OpenLDAPSetup%20-%20Debian%20Wiki_files/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "搜索";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="LDAP_OpenLDAPSetup%20-%20Debian%20Wiki_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="LDAP_OpenLDAPSetup%20-%20Debian%20Wiki_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="LDAP_OpenLDAPSetup%20-%20Debian%20Wiki_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="LDAP_OpenLDAPSetup%20-%20Debian%20Wiki_files/projection.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="LDAP_OpenLDAPSetup%20-%20Debian%20Wiki_files/debian-wiki-1.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/htdocs/debwiki/css/msie.css">
<![endif]-->


<link rel="alternate" title="Debian Wiki: LDAP/OpenLDAPSetup" href="https://wiki.debian.org/LDAP/OpenLDAPSetup?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=LDAP%2FOpenLDAPSetup&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="https://wiki.debian.org/%E9%A6%96%E9%A1%B5">
<link rel="Alternate" title="维基标记" href="https://wiki.debian.org/LDAP/OpenLDAPSetup?action=raw">
<link rel="Alternate" media="print" title="打印视图" href="https://wiki.debian.org/LDAP/OpenLDAPSetup?action=print">
<link rel="Up" href="https://wiki.debian.org/LDAP">
<link rel="Search" href="https://wiki.debian.org/%E6%9F%A5%E6%89%BE%E7%BD%91%E9%A1%B5">
<link rel="Index" href="https://wiki.debian.org/%E6%A0%87%E9%A2%98%E7%B4%A2%E5%BC%95">
<link rel="Glossary" href="https://wiki.debian.org/%E8%AF%8D%E6%B1%87%E7%B4%A2%E5%BC%95">
<link rel="Help" href="https://wiki.debian.org/%E5%B8%AE%E5%8A%A9-%E6%8E%92%E7%89%88">
</head>

<body dir="ltr" lang="zh">
<div id="logo"><a href="https://www.debian.org/" title="Debian Homepage"><img src="LDAP_OpenLDAPSetup%20-%20Debian%20Wiki_files/openlogo-50.png" alt="Debian" width="50" height="61"></a></div>
<div id="header">
<div id="wikisection">
<p class="section"><a href="https://wiki.debian.org/FrontPage" title="Debian Wiki Homepage">Wiki</a></p>
<div id="username"><a href="https://wiki.debian.org/LDAP/OpenLDAPSetup?action=login" id="login" rel="nofollow">登录</a></div>
</div>
<div id="navbar">

<ul id="navibar">
<li class="wikilink"><a href="https://wiki.debian.org/%E9%A6%96%E9%A1%B5">首页</a></li><li class="wikilink"><a href="https://wiki.debian.org/%E6%9C%80%E6%96%B0%E6%94%B9%E5%8A%A8">最新改动</a></li><li class="wikilink"><a href="https://wiki.debian.org/%E6%9F%A5%E6%89%BE%E7%BD%91%E9%A1%B5">查找网页</a></li><li class="wikilink"><a href="https://wiki.debian.org/%E5%B8%AE%E5%8A%A9%E7%9B%AE%E5%BD%95">帮助目录</a></li><li class="current"><a href="https://wiki.debian.org/LDAP/OpenLDAPSetup">LDAP/OpenLDAPSetup</a></li>
</ul>

</div>

<form id="searchform" method="get" action="/LDAP/OpenLDAPSetup">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput" style="display: none;">搜索：</label>
<input id="searchinput" type="text" name="value" value="搜索" size="20" onfocus="searchFocus(this)" onblur="searchBlur(this)" onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search" class="disabled">
<input id="titlesearch" name="titlesearch" type="submit" value="标题" alt="Search Titles" disabled="disabled">
<input id="fullsearch" name="fullsearch" type="submit" value="正文" alt="Search Full Text" disabled="disabled">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="https://www.debian.org/" title="Debian Homepage"><img src="LDAP_OpenLDAPSetup%20-%20Debian%20Wiki_files/openlogo-50.png" alt="Debian" width="50" height="61"></a></div>

<div id="breadcrumbs"><a href="https://wiki.debian.org/FrontPage" title="Debian Wiki Homepage">Wiki</a><span class="sep">/</span>

</div>

<ul class="editbar"><li><a href="https://wiki.debian.org/LDAP/OpenLDAPSetup?action=login" id="login-1" rel="nofollow">登录</a></li><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onclick="toggleComments();return false;">注释</a></li><li><a class="nbinfo" href="https://wiki.debian.org/LDAP/OpenLDAPSetup?action=info" rel="nofollow">信息</a></li><li><a class="nbattachments" href="https://wiki.debian.org/LDAP/OpenLDAPSetup?action=AttachFile" rel="nofollow">附件</a></li><li>
<form class="actionsmenu" method="GET" action="/LDAP/OpenLDAPSetup">
<div>
    
    <select name="action" onchange="if ((this.selectedIndex != 0) &amp;&amp;
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" selected="selected">更多操作：</option><option value="raw">源码</option>
<option value="print">打印视图</option>
<option value="RenderAsDocbook">输出Docbook格式</option>
<option value="refresh">删除缓存</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="SpellCheck">拼写检查</option>
<option value="LikePages">相似网页</option>
<option value="LocalSiteMap">本站地图</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="RenamePage" disabled="disabled" class="disabled">改名</option>
<option value="DeletePage" disabled="disabled" class="disabled">删除</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="show" disabled="disabled" class="disabled">订阅</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="show" disabled="disabled" class="disabled">删除垃圾广告</option>
<option value="show" disabled="disabled" class="disabled">恢复成此版本</option>
<option value="PackagePages">网页打包</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="Load">加载</option>
<option value="Save">保存</option>
<option value="SlideShow">SlideShow</option>
    </select>
    
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('更多操作：');
//-->
</script>
</form>
</li></ul>

<h1 id="locationline">


<ul id="pagelocation">
<li><a href="https://wiki.debian.org/LDAP">LDAP</a></li><li><a href="https://wiki.debian.org/LDAP/OpenLDAPSetup">OpenLDAPSetup</a></li>
</ul>

</h1>
</div>

<div id="page" dir="ltr" lang="en">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><a class="https" href="https://openldap.org/">OpenLDAP</a> is an <a href="https://wiki.debian.org/OpenSource">open source</a> implementation of the <a class="interwiki" href="https://en.wikipedia.org/wiki/Lightweight%20Directory%20Access%20Protocol" title="WikiPedia">Lightweight Directory Access Protocol</a>. It includes <a class="interwiki" href="https://packages.debian.org/libldap-2.4-2" title="DebianPkg">libraries</a>, <a class="interwiki" href="https://packages.debian.org/ldap-utils" title="DebianPkg">clients</a>, and a <a class="interwiki" href="https://packages.debian.org/slapd" title="DebianPkg">server</a>. This page is about running the OpenLDAP Standalone LDAP Daemon <tt class="backtick">slapd</tt> on Debian. <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span></p><p class="line867"><a href="https://wiki.debian.org/FixMe">FixMe</a>: update for (Buster/Bullseye) defaults and recommendations <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span></p><p class="line867"><a href="https://wiki.debian.org/ToDo">ToDo</a>: update for Buster/Bullseye; review, organize, refactor; consider moving specific topics (e.g. Samba) to separate pages <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span></p><p class="line867"></p><div class="table-of-contents"><p class="table-of-contents-heading">目录</p><ol><li>
<a href="#Documentation_and_resources">Documentation and resources</a></li><li>
<a href="#Installing_and_configuring_the_OpenLDAP_server">Installing and configuring the OpenLDAP server</a><ol><li>
<a href="#Tour_of_the_installation">Tour of the installation</a></li></ol></li><li>
<a href="#Basic_tasks">Basic tasks</a><ol><li>
<a href="#Enable_request_logging">Enable request logging</a></li><li>
<a href="#Enable_TLS.2FSSL">Enable TLS/SSL</a></li><li>
<a href="#Check_and_configure_the_database_max_size">Check and configure the database max size</a></li><li>
<a href="#Change_the_administrator.27s_password">Change the administrator's password</a></li></ol></li><li>
<a href="#Advanced_tasks">Advanced tasks</a><ol><li>
<a href="#Indexes">Indexes</a></li><li>
<a href="#Access_control">Access control</a></li><li>
<a href="#For_SAMBA_LDAP_support">For SAMBA LDAP support</a></li><li>
<a href="#Access_controls_for_subtree-specific_LDAP_Admins">Access controls for subtree-specific LDAP Admins</a></li><li>
<a href="#Configuring_TLS.2FSSL">Configuring TLS/SSL</a></li><li>
<a href="#Configuring_MirrorMode_LDAP_Sync_Replication_.28syncrepl.29">Configuring MirrorMode LDAP Sync Replication (syncrepl)</a></li></ol></li></ol></div> <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line867">
</p><h1 id="Documentation_and_resources">Documentation and resources</h1>
<span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><ul><li><p class="line862">The Debian-specific setup and configuration of <a class="interwiki" href="https://packages.debian.org/slapd" title="DebianPkg">slapd</a> are documented in <a class="https" href="https://salsa.debian.org/openldap-team/openldap/raw/master/debian/slapd.README.Debian">/usr/share/doc/slapd/README.Debian.gz</a>. <span class="anchor" id="line-12"></span></p></li><li><p class="line862">Debian users have contributed some wiki pages about <a href="https://wiki.debian.org/LDAP">LDAP and OpenLDAP</a>. <span class="anchor" id="line-13"></span></p></li><li><p class="line862">OpenLDAP includes comprehensive documentation in the form of <a href="https://wiki.debian.org/ManPage">man pages</a>. In the beginning you will likely need (at least) <a class="interwiki" href="https://manpages.debian.org/man/5/slapd-config" title="DebianMan">slapd-config(5)</a>, <a class="interwiki" href="https://manpages.debian.org/man/1/ldapsearch" title="DebianMan">ldapsearch(1)</a>, <a class="interwiki" href="https://manpages.debian.org/man/1/ldapmodify" title="DebianMan">ldapmodify(1)</a>, and <a class="interwiki" href="https://manpages.debian.org/man/5/ldif" title="DebianMan">ldif(5)</a>. There are individual man pages for significant features of <a class="interwiki" href="https://manpages.debian.org/man/8/slapd" title="DebianMan">slapd(8)</a> such as <a class="interwiki" href="https://manpages.debian.org/man/5/slapd-config" title="DebianMan">configuration</a>, <a class="interwiki" href="https://manpages.debian.org/man/5/slapd.access" title="DebianMan">access control</a>, <a class="interwiki" href="https://manpages.debian.org/man/5/slapd.backends" title="DebianMan">backends</a>, and <a class="interwiki" href="https://manpages.debian.org/man/5/slapd.overlays" title="DebianMan">overlays</a>. <span class="anchor" id="line-14"></span></p></li><li><p class="line862">The OpenLDAP project maintains an <a class="https" href="https://openldap.org/doc/admin24/">Administrator's Guide</a>. <span class="anchor" id="line-15"></span></p></li><li><p class="line862">The Ubuntu Server Guide includes <a class="https" href="https://ubuntu.com/server/docs/service-ldap">a chapter on OpenLDAP</a>, including guides for specific use cases. <span class="anchor" id="line-16"></span></p></li><li><p class="line862">LDAP is defined in a number of <a class="interwiki" href="https://en.wikipedia.org/wiki/Request_for_Comments" title="WikiPedia">RFC</a> documents, beginning with <a class="interwiki" href="http://www.ietf.org/rfc/rfc4510.txt" title="RFC">RFC 4510</a>. <span class="anchor" id="line-17"></span></p></li><li><p class="line862">More information about LDAP in general may be found on <a class="https" href="https://ldap.com/">LDAP.com</a>. <span class="anchor" id="line-18"></span></p></li><li><p class="line862">Questions about the Debian packages may be emailed to the maintainers at <a class="mailto" href="mailto:pkg-openldap-devel@lists.alioth.debian.org">pkg-openldap-devel@lists.alioth.debian.org</a>. Please check <a class="interwiki" href="https://bugs.debian.org/src%3Aopenldap" title="DebianBug">the list of open bugs</a> in case your issue is already known. <span class="anchor" id="line-19"></span></p></li><li><p class="line862">Questions about OpenLDAP software may be emailed to the OpenLDAP mailing list at <a class="mailto" href="mailto:openldap-technical@openldap.org">openldap-technical@openldap.org</a>. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span></p></li></ul><p class="line867">
</p><h1 id="Installing_and_configuring_the_OpenLDAP_server">Installing and configuring the OpenLDAP server</h1>
<span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line862">The OpenLDAP server package is <a class="interwiki" href="https://packages.debian.org/slapd" title="DebianPkg">slapd</a>. The recommended tools for configuring <tt class="backtick">slapd</tt> and setting up your directory are <a class="interwiki" href="https://packages.debian.org/ldap-utils" title="DebianPkg">ldap-utils</a>. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span></p><p class="line867"><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span></p><pre><span class="anchor" id="line-1"></span>apt install slapd ldap-utils</pre><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">You will be prompted to provide a password for the database administrator. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span></p><p class="line862">By default, an initial database is created in <tt class="backtick">/var/lib/ldap</tt> and configured using the system's DNS domain name. If your system is in the domain <tt class="backtick">example.com</tt>, the database suffix is <tt class="backtick">dc=example,dc=com</tt> and the administrator is named <tt class="backtick">cn=admin,dc=example,dc=com</tt>. The domain name and other details can be changed by preseeding, by running the installation at a different <a class="interwiki" href="https://manpages.debian.org/man/7/debconf#Priorities" title="DebianMan">debconf(7) priority</a>, or by running <tt class="backtick">dpkg-reconfigure&nbsp;slapd</tt> after installation. <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span></p><p class="line862">To check the database suffix, once the server is running, use <a class="interwiki" href="https://manpages.debian.org/man/1/ldapsearch" title="DebianMan">ldapsearch(1)</a> to read the <tt class="backtick">namingContexts</tt> attribute of the root DSE: <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span></p><p class="line867"><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span></p><pre><span class="anchor" id="line-1-1"></span>ldapsearch -x -s base -b "" namingContexts</pre><p class="line874"> <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span></p><p class="line867">
</p><h2 id="Tour_of_the_installation">Tour of the installation</h2>
<span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line862">The following are the key files and directories installed by the <tt class="backtick">slapd</tt> package: <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span></p><ul><li><p class="line891"><a class="interwiki" href="https://manpages.debian.org/man/8/slapd" title="DebianMan">slapd(8)</a> and the associated tools such as <a class="interwiki" href="https://manpages.debian.org/man/8/slapadd" title="DebianMan">slapadd(8)</a>, <a class="interwiki" href="https://manpages.debian.org/man/8/slapcat" title="DebianMan">slapcat(8)</a>, <a class="interwiki" href="https://manpages.debian.org/man/8/slapindex" title="DebianMan">slapindex(8)</a>, and others are installed in <tt class="backtick">/usr/sbin</tt>. <span class="anchor" id="line-44"></span></p></li><li><p class="line862">The loadable modules included with <tt class="backtick">slapd</tt> are installed in <tt class="backtick">/usr/lib/ldap</tt>. <span class="anchor" id="line-45"></span></p></li><li><p class="line891"><a class="https" href="https://ldap.com/understanding-ldap-schema/">LDAP Schema</a> files included with <tt class="backtick">slapd</tt> or other packages are installed in <tt class="backtick">/etc/ldap/schema</tt>. <span class="anchor" id="line-46"></span></p><ul><li><p class="line862">Files ending in <tt class="backtick">.schema</tt> can be <tt class="backtick">include</tt>d into a legacy <tt class="backtick">slapd.conf</tt> file. By default, the Debian setup does not use these files. <span class="anchor" id="line-47"></span></p></li><li><p class="line862">Files ending in <tt class="backtick">.ldif</tt> can be imported into the configuration using <a class="interwiki" href="https://manpages.debian.org/man/1/ldapadd" title="DebianMan">ldapadd(1)</a>. This copies them into the configuration database and the source files are no longer used afterward. <span class="anchor" id="line-48"></span></p></li></ul></li><li><p class="line862">The configuration database <tt class="backtick">cn=config</tt> is stored in <tt class="backtick">/etc/ldap/slapd.d</tt>, owned by the <tt class="backtick">openldap</tt> user. <span class="anchor" id="line-49"></span></p></li><li><p class="line862">The default database is stored in <tt class="backtick">/var/lib/ldap</tt>, owned by the <tt class="backtick">openldap</tt> user. <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span></p></li></ul><p class="line862">The configuration is stored in an LDAP database rooted at <tt class="backtick">cn=config</tt>. Many configuration changes can be made online, while <tt class="backtick">slapd</tt> is running, using LDAP operations on this database. Debian's default access rules allow access by the system <tt class="backtick">root</tt> user only. <tt class="backtick">root</tt> may query or search the database using <a class="interwiki" href="https://manpages.debian.org/man/1/ldapsearch" title="DebianMan">ldapsearch(1)</a> with SASL EXTERNAL authentication: <span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span></p><p class="line867"><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span></p><pre><span class="anchor" id="line-1-2"></span>ldapsearch -H ldapi:/// -Y EXTERNAL -b "cn=config"</pre><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><p class="line874">The
 package sets up a default directory based on the system's DNS domain. 
Debian's default access rules allow anyone to search this directory 
without any authentication: <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span></p><p class="line867"><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span></p><pre><span class="anchor" id="line-1-3"></span>ldapsearch -x -b "dc=example,dc=com"</pre><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line874">To
 connect as the database administrator, use Simple authentication, and 
when prompted, enter the password configured during installation: <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span></p><p class="line867"><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span></p><pre><span class="anchor" id="line-1-4"></span>ldapsearch -x -D "cn=admin,dc=example,dc=com" -W -b "dc=example,dc=com"</pre><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line867">
</p><h1 id="Basic_tasks">Basic tasks</h1>
<span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line867">
</p><h2 id="Enable_request_logging">Enable request logging</h2>
<span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line862">The server logs are sent to the system log (syslog and/or the journal). The default log level is <tt class="backtick">none</tt>. <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span></p><p class="line862">To enable basic request logging, change the log level to <tt class="backtick">stats</tt>: <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span></p><p class="line867"><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span></p><pre><span class="anchor" id="line-1-5"></span>ldapmodify -H ldapi:/// -Y EXTERNAL &lt;&lt; EOF
<span class="anchor" id="line-2"></span>dn: cn=config
<span class="anchor" id="line-3"></span>changetype: modify
<span class="anchor" id="line-4"></span>replace: olcLogLevel
<span class="anchor" id="line-5"></span>olcLogLevel: stats
<span class="anchor" id="line-6"></span>
<span class="anchor" id="line-7"></span>EOF</pre><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><p class="line862">If you wish to disable request logging later, repeat the procedure and set the log level back to <tt class="backtick">none</tt>. <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span></p><p class="line862">For more information, read about <tt class="backtick">olcLogLevel</tt> in the <a class="interwiki" href="https://manpages.debian.org/man/5/slapd-config" title="DebianMan">slapd-config(5)</a> man page. <span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span></p><p class="line867">
</p><h2 id="Enable_TLS.2FSSL">Enable TLS/SSL</h2>
<span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><p class="line862">To enable <a class="interwiki" href="https://en.wikipedia.org/wiki/Transport_Layer_Security" title="WikiPedia">TLS</a> in <tt class="backtick">slapd</tt>, you will need the <strong>server certificate</strong> and the associated <strong>private key</strong>, both in <a class="interwiki" href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" title="WikiPedia">PEM</a> format. You may also have an <strong>intermediate certificate</strong>. Clients will need the <strong>CA certificate</strong> which is the Issuer of the server or intermediate certificate. <span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span></p><p class="line862">The files must all be readable by the <tt class="backtick">openldap</tt> user. It is recommended to ensure the private key is not readable by any user except <tt class="backtick">openldap</tt>. <span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span></p><p class="line862">To configure the server certificate, private key, and intermediate certificate used by <tt class="backtick">slapd</tt>: <span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span></p><p class="line867"><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span></p><pre><span class="anchor" id="line-1-6"></span>ldapmodify -H ldapi:/// -Y EXTERNAL &lt;&lt; EOF
<span class="anchor" id="line-2-1"></span>dn: cn=config
<span class="anchor" id="line-3-1"></span>changetype: modify
<span class="anchor" id="line-4-1"></span>replace: olcTLSCertificateFile
<span class="anchor" id="line-5-1"></span>olcTLSCertificateFile: /etc/ssl/certs/server.pem
<span class="anchor" id="line-6-1"></span>-
<span class="anchor" id="line-7-1"></span>replace: olcTLSCertificateKeyFile
<span class="anchor" id="line-8"></span>olcTLSCertificateKeyFile: /etc/ssl/private/server.key
<span class="anchor" id="line-9"></span>-
<span class="anchor" id="line-10"></span>replace: olcTLSCACertificateFile
<span class="anchor" id="line-11"></span>olcTLSCACertificateFile: /etc/ssl/certs/intermediate.pem
<span class="anchor" id="line-12"></span>
<span class="anchor" id="line-13"></span>EOF</pre><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line862">If you do not have an intermediate certificate, the <tt class="backtick">olcTLSCACertificate</tt> lines should be omitted. The root CA does not need to be configured in <tt class="backtick">slapd</tt>. <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span></p><p class="line862">If the modifications fail with <tt class="backtick">ldap_modify:&nbsp;Other&nbsp;(e.g.,&nbsp;implementation&nbsp;specific)&nbsp;error&nbsp;(80)</tt>, check the file paths for typos, and ensure the files are readable by the <tt class="backtick">openldap</tt> user. <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span></p><p class="line874">After applying the configuration, test a secure connection using StartTLS: <span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span></p><p class="line867"><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span></p><pre><span class="anchor" id="line-1-7"></span>LDAPTLS_CACERT=/etc/ssl/certs/ca.pem ldapwhoami -H ldap://ldap.example.com -ZZ -x</pre><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line862">where <tt class="backtick">ca.pem</tt> is the root CA certificate and <tt class="backtick">ldap.example.com</tt> is the server's name, exactly matching the Common Name (CN) or Subject Alternative Name (SAN) in the server certificate. <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span></p><p class="line862">If the secure connection is successful, <tt class="backtick">ldapwhoami</tt> should just print <tt class="backtick">anonymous</tt>. If it fails, append <tt class="backtick">-d&nbsp;1</tt> to the command line to enable debug output, and look for lines beginning with <tt class="backtick">TLS:</tt>. <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span></p><p class="line862">By default, <tt class="backtick">slapd</tt> supports <a class="interwiki" href="https://en.wikipedia.org/wiki/StartTLS" title="WikiPedia">StartTLS</a> on the standard LDAP port 389. If you wish to enable the LDAPS protocol on port 636, then edit <tt class="backtick">/etc/default/slapd</tt>, add <tt class="backtick">ldaps:///</tt> to the <tt class="backtick">SLAPD_SERVICES</tt> line, and restart <tt class="backtick">slapd</tt>. <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span></p><p class="line867"><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span></p><pre><span class="anchor" id="line-1-8"></span>vi /etc/default/slapd
<span class="anchor" id="line-2-2"></span>
<span class="anchor" id="line-3-2"></span>...
<span class="anchor" id="line-4-2"></span>SLAPD_SERVICES="ldap:/// ldapi:/// ldaps:///"
<span class="anchor" id="line-5-2"></span>...
<span class="anchor" id="line-6-2"></span>
<span class="anchor" id="line-7-2"></span>service slapd restart</pre><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><p class="line862">LDAPS can be tested the same way, using <tt class="backtick">-H&nbsp;ldaps://</tt> instead of <tt class="backtick">-ZZ</tt>: <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span></p><p class="line867"><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span></p><pre><span class="anchor" id="line-1-9"></span>LDAPTLS_CACERT=/etc/ssl/certs/ca.pem ldapwhoami -H ldaps://ldap.example.com -x</pre><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line862">Again, if successful, it should just print <tt class="backtick">anonymous</tt>. <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span></p><p class="line862">For more information, read about TLS Options in the <a class="interwiki" href="https://manpages.debian.org/man/5/slapd-config#TLS_OPTIONS" title="DebianMan">slapd-config(5)</a> man page, noting that the TLS implementation used in Debian is <a class="https" href="https://www.gnutls.org/">GnuTLS</a>. The OpenLDAP Administrator's Guide also has a <a class="https" href="https://openldap.org/doc/admin24/tls.html">chapter about TLS</a>. <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span></p><p class="line867">
</p><h2 id="Check_and_configure_the_database_max_size">Check and configure the database max size</h2>
<span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line862">The default database uses <a class="interwiki" href="https://manpages.debian.org/man/5/slapd-mdb" title="DebianMan">the LMDB storage backend</a>. This backend requires little configuration or tuning, but there is one important parameter: the max size. <span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span></p><p class="line862">The database is stored in a sparse file, <tt class="backtick">/var/lib/ldap/data.mdb</tt>. It has a fixed maximum size, specified by the <tt class="backtick">olcDbMaxSize</tt>
 parameter. The default database has its max size configured to 1 GiB 
upon installation. When the database reaches its max size, writes (even 
updates to existing entries) will fail. <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span></p><p class="line862">Use <a class="interwiki" href="https://manpages.debian.org/man/1/du" title="DebianMan">du(1)</a> to check the actual space used by the database: <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span></p><p class="line867"><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span></p><pre><span class="anchor" id="line-1-10"></span>du -h /var/lib/ldap/data.mdb</pre><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><p class="line874">To check the current max size of database #1: <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span></p><p class="line867"><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span></p><pre><span class="anchor" id="line-1-11"></span>ldapsearch -H ldapi:/// -Y EXTERNAL -b "olcDatabase={1}mdb,cn=config" olcDbMaxSize</pre><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><p class="line874">To set the max size of database #1 to 10 GiB (10737418240 bytes): <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span></p><p class="line867"><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span></p><pre><span class="anchor" id="line-1-12"></span>ldapmodify -H ldapi:/// -Y EXTERNAL &lt;&lt; EOF
<span class="anchor" id="line-2-3"></span>dn: olcDatabase={1}mdb,cn=config
<span class="anchor" id="line-3-3"></span>changetype: modify
<span class="anchor" id="line-4-3"></span>replace: olcDbMaxSize
<span class="anchor" id="line-5-3"></span>olcDbMaxSize: 10737418240
<span class="anchor" id="line-6-3"></span>
<span class="anchor" id="line-7-3"></span>EOF</pre><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><p class="line874">On
 32-bit systems, the max size is constrained by address space 
limitations, and it may not be possible to grow the database larger than
 about 2 GiB. For larger databases, a 64-bit system is recommended. <span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span></p><p class="line862">For more information, read about <tt class="backtick">maxsize</tt> in <a class="interwiki" href="https://manpages.debian.org/man/5/slapd-mdb" title="DebianMan">slapd-mdb(5)</a>. <span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span></p><p class="line867">
</p><h2 id="Change_the_administrator.27s_password">Change the administrator's password</h2>
<span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><p class="line862">The
 password configured during installation is saved in places. To change 
the password, both values must be updated. If only one is changed, the 
old password can still be used. This should be fixed in the next 
release; see <a class="interwiki open-bug" href="https://bugs.debian.org/821331" title="Open in openldap/2.4.42+dfsg-2: #821331: slapd: sets both olcRootPW and admin's userPassword">Debian bug #821331</a>. <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span></p><p class="line862">Use <a class="interwiki" href="https://manpages.debian.org/man/8/slappasswd" title="DebianMan">slappasswd(8)</a> to hash the new password, and then use <a class="interwiki" href="https://manpages.debian.org/man/1/ldapmodify" title="DebianMan">ldapmodify(1)</a> to update the hashed password in the <tt class="backtick">olcRootPW</tt> attribute in the database configuration. <span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span></p><p class="line867"><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span></p><pre><span class="anchor" id="line-1-13"></span># slappasswd
<span class="anchor" id="line-2-4"></span>New password: newpassword
<span class="anchor" id="line-3-4"></span>Re-enter new password: newpassword
<span class="anchor" id="line-4-4"></span>{SSHA}zYHmkowzdMxwX0KtEPNak5IbzfY8YmdQ
<span class="anchor" id="line-5-4"></span># ldapmodify -H ldapi:/// -Y EXTERNAL
<span class="anchor" id="line-6-4"></span>SASL/EXTERNAL authentication started
<span class="anchor" id="line-7-4"></span>SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
<span class="anchor" id="line-8-1"></span>SASL SSF: 0
<span class="anchor" id="line-9-1"></span>dn: olcDatabase={1}mdb,cn=config
<span class="anchor" id="line-10-1"></span>changetype: modify
<span class="anchor" id="line-11-1"></span>replace: olcRootPW
<span class="anchor" id="line-12-1"></span>olcRootPW: {SSHA}zYHmkowzdMxwX0KtEPNak5IbzfY8YmdQ
<span class="anchor" id="line-13-1"></span>
<span class="anchor" id="line-14"></span>modifying entry "olcDatabase={1}mdb,cn=config"</pre><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><p class="line862">Next, use <a class="interwiki" href="https://manpages.debian.org/man/1/ldappasswd" title="DebianMan">ldappasswd(1)</a> to change the password the administrator's account in the directory. <span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span></p><p class="line867"><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span></p><pre><span class="anchor" id="line-1-14"></span># ldappasswd -x -D cn=admin,dc=example,dc=com -W -S
<span class="anchor" id="line-2-5"></span>New password: newpassword
<span class="anchor" id="line-3-5"></span>Re-enter new password: newpassword
<span class="anchor" id="line-4-5"></span>Enter LDAP Password: oldpassword</pre><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><p class="line874">Finally, test authenticating with the old and new passwords, and confirm that only the new password can be used. <span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span></p><p class="line867"><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span></p><pre><span class="anchor" id="line-1-15"></span># ldapwhoami -x -D cn=admin,dc=example,dc=com -W
<span class="anchor" id="line-2-6"></span>Enter LDAP Password: oldpassword
<span class="anchor" id="line-3-6"></span>ldap_bind: Invalid credentials (49)
<span class="anchor" id="line-4-6"></span># ldapwhoami -x -D cn=admin,dc=example,dc=com -W
<span class="anchor" id="line-5-5"></span>Enter LDAP Password: newpassword
<span class="anchor" id="line-6-5"></span>dn:cn=admin,dc=example,dc=com</pre><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><p class="line867">
</p><h1 id="Advanced_tasks">Advanced tasks</h1>
<span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><p class="line867">
</p><h2 id="Indexes">Indexes</h2>
<span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><p class="line874">For better performance do more indexing than the default. <span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span></p><p class="line867">
</p><h3 id="with_slapd.conf">with slapd.conf</h3>
<span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><p class="line862">Create or modify <tt>/etc/ldap/slapd.conf</tt> to contain the following: <span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span></p><pre><span class="anchor" id="line-1-16"></span>index   objectClass             eq
<span class="anchor" id="line-2-7"></span>index   cn                      pres,sub,eq
<span class="anchor" id="line-3-7"></span>index   sn                      pres,sub,eq
<span class="anchor" id="line-4-7"></span>index   uid                     pres,sub,eq
<span class="anchor" id="line-5-6"></span>index   displayName             pres,sub,eq
<span class="anchor" id="line-6-6"></span>index   default                 sub
<span class="anchor" id="line-7-5"></span>index   uidNumber               eq
<span class="anchor" id="line-8-2"></span>index   gidNumber               eq
<span class="anchor" id="line-9-2"></span>index   mail,givenName          eq,subinitial
<span class="anchor" id="line-10-2"></span>index   dc                      eq</pre><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><p class="line862">After any new indexes have been defined or other major database changes have been made (e.g. <tt>slapadd</tt> was used) it is best to recreate the indexes. Note that you should stop <tt>slapd</tt> before recreating the indexes and should fix the permissions afterward. <span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span></p><pre><span class="anchor" id="line-1-17"></span>  # service slapd stop
<span class="anchor" id="line-2-8"></span>  # sudo -u openldap slapindex
<span class="anchor" id="line-3-8"></span>  # service slapd start</pre><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><p class="line867">
</p><h3 id="with_cn.3Dconfig">with cn=config</h3>
<span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><p class="line874">Create a LDIF file in /etc/ldap : olcDbIndex.ldif <span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span></p><pre><span class="anchor" id="line-1-18"></span>dn: olcDatabase={1}mdb,cn=config
<span class="anchor" id="line-2-9"></span>changetype: modify
<span class="anchor" id="line-3-9"></span>add: olcDbIndex
<span class="anchor" id="line-4-8"></span>olcDbIndex: cn pres,sub,eq
<span class="anchor" id="line-5-7"></span>-
<span class="anchor" id="line-6-7"></span>add: olcDbIndex
<span class="anchor" id="line-7-6"></span>olcDbIndex: sn pres,sub,eq
<span class="anchor" id="line-8-3"></span>-
<span class="anchor" id="line-9-3"></span>add: olcDbIndex
<span class="anchor" id="line-10-3"></span>olcDbIndex: uid pres,sub,eq
<span class="anchor" id="line-11-2"></span>-
<span class="anchor" id="line-12-2"></span>add: olcDbIndex
<span class="anchor" id="line-13-2"></span>olcDbIndex: displayName pres,sub,eq
<span class="anchor" id="line-14-1"></span>-
<span class="anchor" id="line-15"></span>add: olcDbIndex
<span class="anchor" id="line-16"></span>olcDbIndex: default sub
<span class="anchor" id="line-17"></span>-
<span class="anchor" id="line-18"></span>add: olcDbIndex
<span class="anchor" id="line-19"></span>olcDbIndex: uidNumber eq
<span class="anchor" id="line-20"></span>-
<span class="anchor" id="line-21"></span>add: olcDbIndex
<span class="anchor" id="line-22"></span>olcDbIndex: gidNumber eq
<span class="anchor" id="line-23"></span>-
<span class="anchor" id="line-24"></span>add: olcDbIndex
<span class="anchor" id="line-25"></span>olcDbIndex: mail,givenName eq,subinitial
<span class="anchor" id="line-26"></span>-
<span class="anchor" id="line-27"></span>add: olcDbIndex
<span class="anchor" id="line-28"></span>olcDbIndex: dc eq</pre><span class="anchor" id="line-291"></span><p class="line862">Note: use the correct database format in the first line, the default type during installation of slapd is <strong>mdb</strong>. <span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span></p><p class="line874">Use ldapmodify to add the indexing settings to the ldap : <span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span></p><pre><span class="anchor" id="line-1-19"></span>ldapmodify -Y EXTERNAL -H ldapi:/// -f ./olcDbIndex.ldif</pre><span class="anchor" id="line-298"></span><p class="line862">Do not leave out the <strong>-</strong> (dash character) from the file, it is needed. <span class="anchor" id="line-299"></span>After
 execution of the ldapmodify command, slapd will launch a internal task 
to create indexes. Don't stop slapd during indexing. <span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span></p><p class="line867">
</p><h2 id="Access_control">Access control</h2>
<span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line874">Configuring 'chsh' and 'chfn' to work with LDAP <span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span></p><p class="line867">
</p><h3 id="with_slapd.conf-1">with slapd.conf</h3>
<span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><p class="line862">Edit '<tt>/etc/ldap/slapd.conf</tt>' to allow access for users to update their <tt>loginShell</tt> and <tt>gecos</tt> entries by adding the following before the '<tt>access&nbsp;to&nbsp;*</tt>' entry: <span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span></p><p class="line867"><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span></p><pre><span class="anchor" id="line-1-20"></span>access to attrs=loginShell,gecos
<span class="anchor" id="line-2-10"></span>      by dn="cn=admin,dc=example,dc=com" write
<span class="anchor" id="line-3-10"></span>      by self write
<span class="anchor" id="line-4-9"></span>      by * read</pre><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><p class="line867">
</p><h3 id="with_cn.3Dconfig-1">with cn=config</h3>
<span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span><p class="line862">Create a LDIF file olcAccess.ldif with access permissions to <tt>loginShell</tt> and <tt>gecos</tt> entries for the user and admins : <span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span></p><pre><span class="anchor" id="line-1-21"></span>dn: olcDatabase={1}hdb,cn=config
<span class="anchor" id="line-2-11"></span>changetype: modify
<span class="anchor" id="line-3-11"></span>add: olcAccess
<span class="anchor" id="line-4-10"></span>olcAccess: {1}to attrs=loginShell,gecos
<span class="anchor" id="line-5-8"></span>  by dn="cn=admin,dc=example,dc=com" write
<span class="anchor" id="line-6-8"></span>  by self write
<span class="anchor" id="line-7-7"></span>  by * read</pre><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><p class="line874">Instanty apply these new permissions to ldap with  : <span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span></p><pre><span class="anchor" id="line-1-22"></span>ldapmodify -Y EXTERNAL -H ldapi:/// -f ./olcAccess.ldif</pre><span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><p class="line867">
</p><h2 id="For_SAMBA_LDAP_support">For SAMBA LDAP support</h2>
<span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><p class="line862">For
 Samba LDAP, slapd needs the Samba schema. The Debian package seems to 
have a samba.schema file which is old and out of date, and a 
samba.schema.gz file which is actually the correct one. Do the following
 (as <tt>root</tt>): <span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span></p><pre><span class="anchor" id="line-1-23"></span> # this package contains samba.schema.gz :
<span class="anchor" id="line-2-12"></span> aptitude install samba</pre><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><p class="line874">Copy example samba.schema to ldap configuration directory: <span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span></p><pre><span class="anchor" id="line-1-24"></span> zcat /usr/share/doc/samba/examples/LDAP/samba.schema.gz &gt; /etc/ldap/schema/samba.schema</pre><span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><p class="line867">
</p><h3 id="with_slapd.conf-2">with slapd.conf</h3>
<span class="anchor" id="line-349"></span><span class="anchor" id="line-350"></span><p class="line874">Add the following line to /etc/ldap/slapd.conf after the other includes. <span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span></p><p class="line867"><span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span></p><pre><span class="anchor" id="line-1-25"></span>include /etc/ldap/schema/samba.schema</pre><span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><p class="line874">And restart slapd: <span class="anchor" id="line-357"></span><span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span></p><pre><span class="anchor" id="line-1-26"></span>  # /etc/init.d/slapd restart</pre><span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><p class="line867">
</p><h3 id="with_cn.3Dconfig-2">with cn=config</h3>
<span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><p class="line874">Create a temporary config file samba.conf: <span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span><span class="anchor" id="line-368"></span><span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span></p><pre><span class="anchor" id="line-1-27"></span>  include          /etc/ldap/schema/core.schema
<span class="anchor" id="line-2-13"></span>  include          /etc/ldap/schema/cosine.schema
<span class="anchor" id="line-3-12"></span>  include          /etc/ldap/schema/nis.schema
<span class="anchor" id="line-4-11"></span>  include          /etc/ldap/schema/inetorgperson.schema
<span class="anchor" id="line-5-9"></span>  include          /etc/ldap/schema/samba.schema</pre><span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><p class="line874">Convert samba.schema into samba.ldif with slaptest: <span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span></p><pre><span class="anchor" id="line-1-28"></span>  # mkdir /tmp/slapd.d
<span class="anchor" id="line-2-14"></span>  # slaptest -f samba.conf -F /tmp/slapd.d/</pre><span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span><p class="line874">Load the /tmp/slapd.d/cn=config/cn=schema/cn={4}samba.ldif into your cn=config using: <span class="anchor" id="line-379"></span><span class="anchor" id="line-380"></span></p><p class="line867"><span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span><span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><span class="anchor" id="line-385"></span></p><pre><span class="anchor" id="line-1-29"></span>  # cp "/tmp/slapd.d/cn=config/cn=schema/cn={4}samba.ldif" "/etc/ldap/slapd.d/cn=config/cn=schema"
<span class="anchor" id="line-2-15"></span>  # chown openldap: '/etc/ldap/slapd.d/cn=config/cn=schema/cn={4}samba.ldif'
<span class="anchor" id="line-3-13"></span>  # /etc/init.d/slapd stop
<span class="anchor" id="line-4-12"></span>  # /etc/init.d/slapd start</pre><span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span><p class="line874">and check you now see the new samba schema: <span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span></p><p class="line867"><span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span></p><pre><span class="anchor" id="line-1-30"></span># ldapsearch -LLLQY EXTERNAL -H ldapi:/// -b cn=schema,cn=config "(objectClass=olcSchemaConfig)" dn
<span class="anchor" id="line-2-16"></span>dn: cn=schema,cn=config
<span class="anchor" id="line-3-14"></span>
<span class="anchor" id="line-4-13"></span>dn: cn={0}core,cn=schema,cn=config
<span class="anchor" id="line-5-10"></span>
<span class="anchor" id="line-6-9"></span>dn: cn={1}cosine,cn=schema,cn=config
<span class="anchor" id="line-7-8"></span>
<span class="anchor" id="line-8-4"></span>dn: cn={2}nis,cn=schema,cn=config
<span class="anchor" id="line-9-4"></span>
<span class="anchor" id="line-10-4"></span>dn: cn={3}inetorgperson,cn=schema,cn=config
<span class="anchor" id="line-11-3"></span>
<span class="anchor" id="line-12-3"></span>dn: cn={4}samba,cn=schema,cn=config</pre><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><span class="anchor" id="line-405"></span><p class="line867">
</p><h2 id="Access_controls_for_subtree-specific_LDAP_Admins">Access controls for subtree-specific LDAP Admins</h2>
<span class="anchor" id="line-406"></span><span class="anchor" id="line-407"></span><p class="line862">If
 you choose to use LDAP for many functions, such as having a single 
server for DNS, Authentication, and networking flat file database 
replacement, you may wish to have LDAP administrative users for each 
subtree in addition to the global admin (<tt>dn="cn=admin,&nbsp;dc=example,&nbsp;dc=com</tt>). The following example is useful when using a separate authentication tree which includes Samba. <span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span></p><p class="line867"><span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span><span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span></p><pre><span class="anchor" id="line-1-31"></span> # The manager dn has full write access to the auth subtree
<span class="anchor" id="line-2-17"></span> # Everyone else has read access to not otherwise protected fields and entries
<span class="anchor" id="line-3-15"></span> access to dn.sub="ou=auth,dc=example,dc=com"
<span class="anchor" id="line-4-14"></span>         by dn="cn=Manager,ou=auth,dc=example,dc=com" write
<span class="anchor" id="line-5-11"></span>         by * read</pre><span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><p class="line867">
</p><h2 id="Configuring_TLS.2FSSL">Configuring TLS/SSL</h2>
<span class="anchor" id="line-418"></span><span class="anchor" id="line-419"></span><p class="line874">By
 default, slapd runs as user/group openldap, so it can't read the key 
file. On Debian Lenny, the preferred solution to this dilemma seems to 
be to chown the key to root:ssl-cert, set permissions to 640 and add the
 user openldap to group ssl-cert: <span class="anchor" id="line-420"></span><span class="anchor" id="line-421"></span><span class="anchor" id="line-422"></span></p><pre><span class="anchor" id="line-1-32"></span>usermod -a -G ssl-cert openldap</pre><span class="anchor" id="line-423"></span><ul><li style="list-style-type:none">In Wheezy, not adding openldap to the ssl-cert group caused this in logs: <span class="anchor" id="line-424"></span></li></ul><p class="line867"><span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span></p><pre><span class="anchor" id="line-1-33"></span>main: TLS init def ctx failed: -1</pre><span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span><p class="line867">
</p><h3 id="Enable_LDAPS_.28if_required.29">Enable LDAPS (if required)</h3>
<span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><p class="line874">StartTLS
 is the standard operation for initiating TLS/SSL on an LDAP connection.
 StartTLS operates on the standard LDAP port (389) and no alternative 
port is necessary. <span class="anchor" id="line-431"></span><span class="anchor" id="line-432"></span></p><p class="line874">Clients
 using OpenLDAP libldap can be configured to use StartTLS, if they use 
an LDAP URL for connection configuration, by including the StartTLS 
extension in the URL. For example: <span class="anchor" id="line-433"></span><span class="anchor" id="line-434"></span></p><p class="line867"><span class="anchor" id="line-435"></span><span class="anchor" id="line-436"></span></p><pre><span class="anchor" id="line-1-34"></span>ldap://ldap.example.com/dc=example,dc=com????!StartTLS</pre><span class="anchor" id="line-437"></span><span class="anchor" id="line-438"></span><p class="line862">The <tt>ldapurl(1)</tt> tool is useful for constructing correct LDAP URLs. <span class="anchor" id="line-439"></span><span class="anchor" id="line-440"></span></p><p class="line862">Some
 legacy LDAP clients do not support the StartTLS operation, but are able
 to use LDAPS (LDAP over SSL) on port 636. To support such clients, add <tt>ldaps:///</tt> to the <tt>SLAPD_SERVICES</tt> list in <tt>/etc/default/slapd</tt>. <span class="anchor" id="line-441"></span><span class="anchor" id="line-442"></span></p><p class="line867"><span class="anchor" id="line-443"></span><span class="anchor" id="line-444"></span></p><pre><span class="anchor" id="line-1-35"></span>SLAPD_SERVICES="ldap:/// ldapi:/// ldaps:///"</pre><span class="anchor" id="line-445"></span><span class="anchor" id="line-446"></span><p class="line867">
</p><h3 id="Symptoms:">Symptoms:</h3>
<span class="anchor" id="line-447"></span><p class="line862">In <tt>slapd</tt> debug output: <span class="anchor" id="line-448"></span><span class="anchor" id="line-449"></span><span class="anchor" id="line-450"></span></p><pre><span class="anchor" id="line-1-36"></span>[...] TLS: could not set cipher list HIGH:MEDIUM:-SSLv2.  (or similar)</pre><span class="anchor" id="line-451"></span><p class="line874">In /var/log/syslog: <span class="anchor" id="line-452"></span><span class="anchor" id="line-453"></span><span class="anchor" id="line-454"></span></p><pre><span class="anchor" id="line-1-37"></span>[...] main: TLS init def ctx failed: -1</pre><span class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><p class="line867">
</p><h4 id="Diagnosis:">Diagnosis:</h4>
<span class="anchor" id="line-457"></span><p class="line862">If you try to install the OpenLDAP server (<tt>slapd</tt>) with Debian Lenny, it comes compiled against the GnuTLS library. It means you cannot use an OpenSSL style directive like <tt>TLSCipherSuite&nbsp;HIGH:MEDIUM:-SSLv2</tt> in <tt>slapd.conf</tt>. <span class="anchor" id="line-458"></span><span class="anchor" id="line-459"></span></p><p class="line867">
</p><h4 id="Cure:">Cure:</h4>
<span class="anchor" id="line-460"></span><p class="line862">In <tt>/etc/ldap/slapd.conf</tt>, either comment out <tt class="backtick">TLSCipherSuite</tt> option to let gnutls choose rather sane default for you, or use something like: <span class="anchor" id="line-461"></span><span class="anchor" id="line-462"></span><span class="anchor" id="line-463"></span></p><pre><span class="anchor" id="line-1-38"></span>TLSCipherSuite NORMAL</pre><span class="anchor" id="line-464"></span><p class="line874">To get all the supported GnuTLS cipher suite names: <span class="anchor" id="line-465"></span><span class="anchor" id="line-466"></span><span class="anchor" id="line-467"></span><span class="anchor" id="line-468"></span></p><pre><span class="anchor" id="line-1-39"></span># aptitude install gnutls-bin
<span class="anchor" id="line-2-18"></span># man gnutls-cli</pre><span class="anchor" id="line-469"></span><p class="line862">And skip to <tt class="backtick">TLS/SSL&nbsp;control&nbsp;options</tt> section of man page. <span class="anchor" id="line-470"></span><span class="anchor" id="line-471"></span></p><p class="line874">To use only 256 bit cyphers, use this (paranoiac?) setting: <span class="anchor" id="line-472"></span><span class="anchor" id="line-473"></span><span class="anchor" id="line-474"></span></p><pre><span class="anchor" id="line-1-40"></span>TLSCipherSuite SECURE256:!AES-128-CBC:!ARCFOUR-128:!CAMELLIA-128-CBC:!3DES-CBC:!CAMELLIA-128-CBC</pre><span class="anchor" id="line-475"></span><span class="anchor" id="line-476"></span><p class="line862">Another useful tool to test server-supported TLS options is to use <tt class="backtick">gnutls-cli-debug</tt>. First add <tt class="backtick">ldaps:///</tt> string to the <tt class="backtick">SLAPD_SERVICES</tt> option in <tt class="backtick">/etc/default/slapd</tt>, restart <tt class="backtick">slapd</tt> and then run <span class="anchor" id="line-477"></span><span class="anchor" id="line-478"></span><span class="anchor" id="line-479"></span></p><pre><span class="anchor" id="line-1-41"></span>gnutls-cli-debug -p 636 &lt;fqdn_of_you_ldap_host&gt;</pre><span class="anchor" id="line-480"></span><p class="line874">That will show you cryptographic suits your LDAP server supports. <span class="anchor" id="line-481"></span><span class="anchor" id="line-482"></span><span class="anchor" id="line-483"></span></p><p class="line867">
</p><h3 id="Symptoms_.28round_2.29">Symptoms (round 2)</h3>
<span class="anchor" id="line-484"></span><p class="line874">If you are getting messages such as <span class="anchor" id="line-485"></span><span class="anchor" id="line-486"></span><span class="anchor" id="line-487"></span></p><pre><span class="anchor" id="line-1-42"></span>slapd TLS: can't connect: A TLS packet with unexpected length was received..</pre><span class="anchor" id="line-488"></span><p class="line874">or <span class="anchor" id="line-489"></span><span class="anchor" id="line-490"></span><span class="anchor" id="line-491"></span></p><pre><span class="anchor" id="line-1-43"></span>Could not negotiate a supported cipher suite.</pre><span class="anchor" id="line-492"></span><p class="line874">take a wander by this. <span class="anchor" id="line-493"></span><span class="anchor" id="line-494"></span></p><p class="line867">
</p><h4 id="Diagnosis:-1">Diagnosis:</h4>
<span class="anchor" id="line-495"></span><p class="line874">How did you
 generate your certificates?  If you generated them using OpenSSL, 
you're going to run into problems.  Debian switched over to using gnutls
 a while ago, and it doesn't play nice with OpenSSL certificates.  So, 
to fix this, check out the next section. <span class="anchor" id="line-496"></span><span class="anchor" id="line-497"></span></p><p class="line874">NOTE: On Debian Squeeze openldap is linked with gnutls as well, but works just fine with certificate generated by openssl. <span class="anchor" id="line-498"></span><span class="anchor" id="line-499"></span></p><p class="line862">NOTE
 about the above note: I don't find it to be the case, except for the CA
 cert. I ended up having to generate a new key &amp; csr to sign with 
gnutls's certtool and then signing it with my existing openssl created 
CA like so: <span class="anchor" id="line-500"></span><span class="anchor" id="line-501"></span><span class="anchor" id="line-502"></span><span class="anchor" id="line-503"></span></p><pre><span class="anchor" id="line-1-44"></span>certtool --generate-privkey --outfile ldap.gnutls.key
<span class="anchor" id="line-2-19"></span>certtool --generate-certificate --load-privkey ldap.gnutls.key --outfile ldap.gnutls.crt --load-ca-certificate ca.crt --load-ca-privkey ca.key</pre><span class="anchor" id="line-504"></span><p class="line874">Again, this allows you to keep your existing OpenSSL CA. <span class="anchor" id="line-505"></span><span class="anchor" id="line-506"></span><span class="anchor" id="line-507"></span></p><p class="line867">
</p><h4 id="Procedure:">Procedure:</h4>
<span class="anchor" id="line-508"></span><p class="line862">You're going to need the gnutls certificate generator: <a class="http" href="http://www.gnu.org/software/gnutls/manual/html_node/The-certtool-application.html">certtool</a> available in <a class="interwiki" href="https://packages.debian.org/gnutls-bin" title="DebPkg">gnutls-bin</a> <span class="anchor" id="line-509"></span><span class="anchor" id="line-510"></span></p><p class="line874">Run these two commands to generate a new self-signed key (into the current working directory): <span class="anchor" id="line-511"></span><span class="anchor" id="line-512"></span><span class="anchor" id="line-513"></span><span class="anchor" id="line-514"></span></p><pre><span class="anchor" id="line-1-45"></span>certtool --generate-privkey --outfile ca-key.pem
<span class="anchor" id="line-2-20"></span>certtool --generate-self-signed --load-privkey ca-key.pem --outfile ca-cert.pem</pre><span class="anchor" id="line-515"></span><span class="anchor" id="line-516"></span><p class="line862">Then, update your certificate locations in /etc/ldap/slapd.conf (<tt>TLSCertificateFile</tt> points to ca-cert.pem and <tt>TLSCertificateKeyFile</tt> points to ca-key.pem), comment out <tt>TLSCACertificateFile</tt>, and change <tt>TLSVerifyClient</tt> to <tt>never</tt>. <span class="anchor" id="line-517"></span><span class="anchor" id="line-518"></span></p><p class="line862">In /etc/ldap/ldap.conf, comment out <tt>TLS_CACERT</tt> and change <tt>TLS_REQCERT</tt> to <tt>never</tt>. <span class="anchor" id="line-519"></span><span class="anchor" id="line-520"></span></p><p class="line862">Since the certificate is self-signed, we can't have gnutls trying to verify it (hence the <tt>never</tt>), otherwise it will never run. <span class="anchor" id="line-521"></span><span class="anchor" id="line-522"></span></p><p class="line874">Then restart your services, and you're good (assuming all your links point properly to ldaps://url/). <span class="anchor" id="line-523"></span><span class="anchor" id="line-524"></span></p><p class="line867">
</p><h2 id="Configuring_MirrorMode_LDAP_Sync_Replication_.28syncrepl.29">Configuring MirrorMode LDAP Sync Replication (syncrepl)</h2>
<span class="anchor" id="line-525"></span><p class="line862">See <a class="http" href="http://www.openldap.org/doc/admin24/replication.html">http://www.openldap.org/doc/admin24/replication.html</a>
 for a clear explanation of OpenLDAP Replication. Several types of 
replication are possible, this section focusses on how to configure 
MirrorMode Replication. <span class="anchor" id="line-526"></span><span class="anchor" id="line-527"></span></p><p class="line867">
</p><h3 id="with_slapd.conf-3">with slapd.conf</h3>
<span class="anchor" id="line-528"></span><p class="line862">See the aforementioned <a class="http" href="http://www.openldap.org/doc/admin24/replication.html">http://www.openldap.org/doc/admin24/replication.html</a>
 for a clear explanation on how to configure MirrorMode LDAP Sync 
Replication (syncrepl) using the old slapd.conf syntax. No need to 
repeat this here. <span class="anchor" id="line-529"></span><span class="anchor" id="line-530"></span></p><p class="line867">
</p><h3 id="with_cn.3Dconfig-3">with cn=config</h3>
<span class="anchor" id="line-531"></span><p class="line867">MirrorMode LDAP Sync Replication (syncrepl) is achieved by following the seven small steps below. <span class="anchor" id="line-532"></span><span class="anchor" id="line-533"></span></p><p class="line867">
</p><h4 id="A1:_Create_a_special_user_for_the_replication_of_the_data.">1: Create a special user for the replication of the data.</h4>
<span class="anchor" id="line-534"></span><p class="line862">This by 
default can't be done using the SASL/EXTERNAL authentication, since you 
will get a 'no write access to parent' error. Please use a basedn suited
 to your situation, in example change the "dc=nodomain" to the basedn 
for your server. Please see step 7 for the password chosen and use <tt>slappasswd</tt> command to format it. <span class="anchor" id="line-535"></span><span class="anchor" id="line-536"></span><span class="anchor" id="line-537"></span><span class="anchor" id="line-538"></span><span class="anchor" id="line-539"></span><span class="anchor" id="line-540"></span><span class="anchor" id="line-541"></span><span class="anchor" id="line-542"></span><span class="anchor" id="line-543"></span><span class="anchor" id="line-544"></span><span class="anchor" id="line-545"></span><span class="anchor" id="line-546"></span><span class="anchor" id="line-547"></span><span class="anchor" id="line-548"></span><span class="anchor" id="line-549"></span></p><pre><span class="anchor" id="line-1-46"></span>$ ldapmodify -D "cn=admin,dc=nodomain" -W&lt;&lt;EOT
<span class="anchor" id="line-2-21"></span>&gt; dn: cn=mirrormode,dc=nodomain
<span class="anchor" id="line-3-16"></span>&gt; changetype: add
<span class="anchor" id="line-4-15"></span>&gt; objectClass: simpleSecurityObject
<span class="anchor" id="line-5-12"></span>&gt; objectClass: organizationalRole
<span class="anchor" id="line-6-10"></span>&gt; cn: mirrormode
<span class="anchor" id="line-7-9"></span>&gt; description: Syncrepl user for mirrormode operation
<span class="anchor" id="line-8-5"></span>&gt; userPassword: e1NTSEF9SktNQmpPV29zOEtPSCtaWmdDeTVUa056U3c5NWF5bis=
<span class="anchor" id="line-9-5"></span>&gt; EOT
<span class="anchor" id="line-10-5"></span>Enter LDAP Password:
<span class="anchor" id="line-11-4"></span>adding new entry "cn=mirrormode,dc=nodomain"
<span class="anchor" id="line-12-4"></span>
<span class="anchor" id="line-13-3"></span>$</pre><span class="anchor" id="line-550"></span><span class="anchor" id="line-551"></span><p class="line862">All the other steps can easily be done using the SASL/EXTERNAL authentication as explained in <a class="https" href="https://wiki.debian.org/LDAP/OpenLDAPSetup#Missing_slapd.conf.3F">Missing slapd.conf</a>. Just save the given information in a file and load it with: $ ldapmodify -Y EXTERNAL -H ldapi:/// -f &lt;file.ldif&gt; <span class="anchor" id="line-552"></span><span class="anchor" id="line-553"></span></p><p class="line867">
</p><h4 id="A2:_Load_the_syncrepl_module">2: Load the syncrepl module</h4>
<span class="anchor" id="line-554"></span><p class="line867"><span class="anchor" id="line-555"></span><span class="anchor" id="line-556"></span><span class="anchor" id="line-557"></span><span class="anchor" id="line-558"></span><span class="anchor" id="line-559"></span></p><pre><span class="anchor" id="line-1-47"></span>dn: cn=module{0},cn=config
<span class="anchor" id="line-2-22"></span>changetype: modify
<span class="anchor" id="line-3-17"></span>add: olcModuleLoad
<span class="anchor" id="line-4-16"></span>olcModuleLoad: syncprov</pre><span class="anchor" id="line-560"></span><span class="anchor" id="line-561"></span><span class="anchor" id="line-562"></span><p class="line867">
</p><h4 id="A3:_Set_up_replicator_privileges">3: Set up replicator privileges</h4>
<span class="anchor" id="line-563"></span><p class="line874">Make sure the newly created replication user can read the data to be replicated: <span class="anchor" id="line-564"></span><span class="anchor" id="line-565"></span><span class="anchor" id="line-566"></span><span class="anchor" id="line-567"></span><span class="anchor" id="line-568"></span><span class="anchor" id="line-569"></span><span class="anchor" id="line-570"></span><span class="anchor" id="line-571"></span><span class="anchor" id="line-572"></span><span class="anchor" id="line-573"></span></p><pre><span class="anchor" id="line-1-48"></span>dn: olcDatabase={1}hdb,cn=config
<span class="anchor" id="line-2-23"></span>changetype: modify
<span class="anchor" id="line-3-18"></span>delete: olcAccess
<span class="anchor" id="line-4-17"></span>olcAccess: {0}to attrs=userPassword,shadowLastChange by self write by anonymous auth by dn="cn=admin,dc=nodomain" write by * none
<span class="anchor" id="line-5-13"></span>-
<span class="anchor" id="line-6-11"></span>add: olcAccess
<span class="anchor" id="line-7-10"></span>olcAccess: {0}to attrs=userPassword,shadowLastChange by self write by anonymous auth by dn="cn=admin,dc=nodomain" write by dn="cn=mirrormode,dc=nodomain" read by * none
<span class="anchor" id="line-8-6"></span>-</pre><span class="anchor" id="line-574"></span><span class="anchor" id="line-575"></span><p class="line867">
</p><h4 id="A4:_Set_up_the_provider_slapd">4: Set up the provider slapd</h4>
<span class="anchor" id="line-576"></span><p class="line867"><span class="anchor" id="line-577"></span><span class="anchor" id="line-578"></span><span class="anchor" id="line-579"></span><span class="anchor" id="line-580"></span><span class="anchor" id="line-581"></span><span class="anchor" id="line-582"></span><span class="anchor" id="line-583"></span><span class="anchor" id="line-584"></span></p><pre><span class="anchor" id="line-1-49"></span>dn: olcOverlay=syncprov,olcDatabase={1}hdb,cn=config
<span class="anchor" id="line-2-24"></span>changeType: add
<span class="anchor" id="line-3-19"></span>objectClass: olcOverlayConfig
<span class="anchor" id="line-4-18"></span>objectClass: olcSyncProvConfig
<span class="anchor" id="line-5-14"></span>olcOverlay: syncprov
<span class="anchor" id="line-6-12"></span>olcSpCheckpoint: 100 10
<span class="anchor" id="line-7-11"></span>olcSpSessionLog: 100</pre><span class="anchor" id="line-585"></span><span class="anchor" id="line-586"></span><p class="line867">
</p><h4 id="A5:_Set_up_indexing_for_entryUUID">5: Set up indexing for entryUUID</h4>
<span class="anchor" id="line-587"></span><p class="line874">Note that 
using the session log requires searching on the entryUUID attribute. 
Setting an eq index on this attribute will greatly benefit the 
performance of the session log on the provider: <span class="anchor" id="line-588"></span><span class="anchor" id="line-589"></span><span class="anchor" id="line-590"></span><span class="anchor" id="line-591"></span><span class="anchor" id="line-592"></span><span class="anchor" id="line-593"></span><span class="anchor" id="line-594"></span><span class="anchor" id="line-595"></span><span class="anchor" id="line-596"></span><span class="anchor" id="line-597"></span></p><pre><span class="anchor" id="line-1-50"></span>dn: olcDatabase={1}hdb,cn=config
<span class="anchor" id="line-2-25"></span>changeType: modify
<span class="anchor" id="line-3-20"></span>delete: olcDbIndex
<span class="anchor" id="line-4-19"></span>olcDbIndex: objectClass eq
<span class="anchor" id="line-5-15"></span>-
<span class="anchor" id="line-6-13"></span>add: olcDbIndex
<span class="anchor" id="line-7-12"></span>olcDbIndex: objectClass,entryCSN,entryUUID eq
<span class="anchor" id="line-8-7"></span>-</pre><span class="anchor" id="line-598"></span><span class="anchor" id="line-599"></span><p class="line867">
</p><h4 id="A6:_Set_the_server_ID.">6: Set the server ID.</h4>
<span class="anchor" id="line-600"></span><p class="line874">Make sure you use different ID's for different servers, in example 0, 1, etc...: <span class="anchor" id="line-601"></span><span class="anchor" id="line-602"></span><span class="anchor" id="line-603"></span><span class="anchor" id="line-604"></span><span class="anchor" id="line-605"></span><span class="anchor" id="line-606"></span><span class="anchor" id="line-607"></span></p><pre><span class="anchor" id="line-1-51"></span>dn: cn=config
<span class="anchor" id="line-2-26"></span>changeType: modify
<span class="anchor" id="line-3-21"></span>add: olcServerID
<span class="anchor" id="line-4-20"></span>olcServerID: 0
<span class="anchor" id="line-5-16"></span>-</pre><span class="anchor" id="line-608"></span><span class="anchor" id="line-609"></span><p class="line867">
</p><h4 id="A7:_Enable_the_replication.">7: Enable the replication.</h4>
<span class="anchor" id="line-610"></span><p class="line874">Make sure 
you use the correct IP number for each ldap server and make sure they 
point to each other! Also, the credentials are just an example. Choose a
 password of your own of course: <span class="anchor" id="line-611"></span><span class="anchor" id="line-612"></span><span class="anchor" id="line-613"></span><span class="anchor" id="line-614"></span><span class="anchor" id="line-615"></span><span class="anchor" id="line-616"></span><span class="anchor" id="line-617"></span><span class="anchor" id="line-618"></span><span class="anchor" id="line-619"></span><span class="anchor" id="line-620"></span></p><pre><span class="anchor" id="line-1-52"></span>dn: olcDatabase={1}hdb,cn=config
<span class="anchor" id="line-2-27"></span>changeType: modify
<span class="anchor" id="line-3-22"></span>add: olcSyncrepl
<span class="anchor" id="line-4-21"></span>olcSyncrepl: rid=001 provider=ldap://172.16.42.74:389 bindmethod=simple binddn="cn=mirrormode,dc=nodomain" credentials=_ei7N8o.gh=o44 searchbase="dc=nodomain" schemachecking=on type=refreshAndPersist retry="60 +"
<span class="anchor" id="line-5-17"></span>-
<span class="anchor" id="line-6-14"></span>add: olcMirrorMode
<span class="anchor" id="line-7-13"></span>olcMirrorMode: TRUE
<span class="anchor" id="line-8-8"></span>-</pre><span class="anchor" id="line-621"></span><span class="anchor" id="line-622"></span><p class="line874">And
 you're up and running. Try adding something to one of the LDAP servers 
and see it appear automagically at the other. Well done my friend! <span class="anchor" id="line-623"></span><span class="anchor" id="line-624"></span></p><p class="line867"></p><hr><p class="line874"> <span class="anchor" id="line-625"></span><a href="https://wiki.debian.org/CategorySystemAdministration">CategorySystemAdministration</a> <span class="anchor" id="line-626"></span><span class="anchor" id="bottom"></span></p></div><div id="pagebottom"></div>
</div>


<div id="footer">
<p id="pageinfo" class="info" dir="ltr" lang="zh">LDAP/OpenLDAPSetup  (<a class="nbinfo" href="https://wiki.debian.org/LDAP/OpenLDAPSetup?action=info" rel="nofollow">最后修改时间 2020-05-04 02:32:18</a>)</p>

<ul id="credits">
<li><a href="https://www.debian.org/legal/privacy">Debian privacy policy</a><br></li><li><a href="https://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="https://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li>Debian Wiki <a href="https://wiki.debian.org/Teams/DebianWiki">team</a>, <a href="https://bugs.debian.org/wiki.debian.org">bugs</a> and <a href="https://salsa.debian.org/debian/wiki.debian.org">config</a> available.</li><li>Hosting provided by <a href="https://www.man-da.de/">Metropolitan Area Network Darmstadt</a></li>
</ul>


</div>



</body></html>