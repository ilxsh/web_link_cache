
<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin" />
    <meta property="og:description" content="环境 系统版本:centos7.4 openldap版本2.4 安装和配置 安装并启动服务 安装: 拷贝数据库配置文件 DB_CONIFG中主要是关于Berkeley DB的相关的一些配置 启动Ope" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>Centos7安装OpenLDAP - 差点点温柔 - 博客园</title>
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=sqi5FxOybx6gjGoG6Zfy1wD-0AwznLNLYOVx7Y9tIN0" />
    <link id="MainCss" rel="stylesheet" href="/skins/simplememory/bundle-simplememory.min.css?v=h-hNL0OecmJJJBSDulvE8iy08VWrYSL9CnbTmAQnC3Q" />
    <link type="text/css" rel="stylesheet" href="https://www.cnblogs.com/blog/customcss/286971.css?v=UyLfF3F9bawhGvJBXurvNtKeakg=" />
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/SimpleMemory/bundle-SimpleMemory-mobile.min.css" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/zhaijunming5/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/zhaijunming5/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/zhaijunming5/wlwmanifest.xml" />
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=W8J2DYaUeAZPX2Lx1iRh00kAY9PXrT8UdrrPQB3gEXU"></script>
    <script>
        var currentBlogId = 286971;
        var currentBlogApp = 'zhaijunming5';
        var cb_enable_mathjax = false;
        var isLogined = false;
    </script>
    
    
    
</head>
<body>
    <a name="top"></a>
    
    
<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/zhaijunming5/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/zhaijunming5/">差点点温柔</a>
</h1>
<h2>

</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li>
</li>
<li>

</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
</li>
<li>

<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			
			<span id="stats_post_count">随笔 - 
97&nbsp; </span>
<span id="stats_article_count">文章 - 
0&nbsp; </span>
<span id="stats-comment_count">评论 - 
19</span>

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class = "postTitle">
                
<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/zhaijunming5/p/9522756.html">Centos7安装OpenLDAP</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                
<div id="cnblogs_post_body" class="blogpost-body ">
    <h3>环境</h3>
<p>系统版本:centos7.4</p>
<p>openldap版本2.4</p>
<h3>安装和配置</h3>
<p><strong>安装并启动服务</strong></p>
<p>安装:</p>
<div class="cnblogs_code">
<pre>yum install openldap openldap-servers openldap-clients</pre>
</div>
<p>拷贝数据库配置文件</p>
<div class="cnblogs_code">
<pre>cp /usr/share/openldap-servers/DB_CONFIG.example /<span style="color: #0000ff;">var</span>/lib/ldap/<span style="color: #000000;">DB_CONFIG
chown ldap:ldap </span>/<span style="color: #0000ff;">var</span>/lib/ldap/DB_CONFIG</pre>
</div>
<blockquote>
<p>&nbsp;<code class="highlighter-rouge">DB_CONIFG</code>中主要是关于Berkeley DB的相关的一些配置</p>
</blockquote>
<p>&nbsp;启动OpenLDAP Server:</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">systemctl start slapd 
systemctl enable slapd
systemctl status slapd</span></pre>
</div>
<blockquote>
<p>slapd即standard alone ldap daemon，该进程默认监听389端口</p>
</blockquote>
<p><strong>设置root用户密码</strong></p>
<p>先用一个命令生成一个LDAP管理用户root密码:</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">slappasswd
New password:
Re</span>-enter <span style="color: #0000ff;">new</span><span style="color: #000000;"> password:
{SSHA}krOGXDmiCdSXuXocOf10F96LJO5ijdXo  #记住这个,下面会用到</span></pre>
</div>
<p>新建一个rootpwd.ldif(名称是自定义的)的文件:</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">vi rootpwd.ldif

dn: olcDatabase</span>={<span style="color: #800080;">0</span>}config,cn=<span style="color: #000000;">config
changetype: modify
add: olcRootPW
olcRootPW: {SSHA}krOGXDmiCdSXuXocOf10F96LJO5ijdXo</span></pre>
</div>
<ul>
<li>ldif即LDAP Data Interchange Format，是LDAP中数据交换的一种文件格式。文件内容采用的是key-value形式，注意value后面不能有空格。</li>
<li>上面内容中dn即distingush name</li>
<li>olc即Online Configuration，表示写入LDAP后不需要重启即可生效</li>
<li>changetype: modify表示修改一个entry，changetype的值可以是add,delete, modify等。</li>
<li>add: olcRootPW表示对这个entry新增了一个olcRootPW的属性</li>
<li>olcRootPW: {SSHA}krOGXDmiCdSXuXocOf10F96LJO5ijdXo指定了属性值</li>
</ul>
<p>下面使用ldapadd命令将上面的rootpwd.ldif文件写入LDAP:</p>
<div class="cnblogs_code">
<pre>ldapadd -Y EXTERNAL -H ldapi:<span style="color: #808080;">///</span><span style="color: #008000;"> -f rootpwd.ldif</span>
SASL/<span style="color: #000000;">EXTERNAL authentication started
SASL username: gidNumber</span>=<span style="color: #800080;">0</span>+uidNumber=<span style="color: #800080;">0</span>,cn=peercred,cn=external,cn=<span style="color: #000000;">auth
SASL SSF: </span><span style="color: #800080;">0</span><span style="color: #000000;">
modifying entry </span><span style="color: #800000;">"</span><span style="color: #800000;">olcDatabase={0}config,cn=config</span><span style="color: #800000;">"</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>导入schema</strong></p>
<p>导入schema，schema包含为了支持特殊场景相关的属性，可根据选择导入，这里先全部导入:</p>
<div class="cnblogs_code">
<pre>ls /etc/openldap/schema<span style="color: #008000;">/*</span><span style="color: #008000;">.ldif | while read f; do ldapadd -Y EXTERNAL -H ldapi:/// -f $f; done</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>设定默认域</strong></p>
<p>先使用slappasswd生成一个密码:</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">slappasswd
New password:
Re</span>-enter <span style="color: #0000ff;">new</span><span style="color: #000000;"> password:
{SSHA}OpMcf0c</span>+pEqFLZm3i+YiI2qhId1G/yM3</pre>
</div>
<p>新建一个domain.ldif的文件:</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">vi domain.ldif

dn: olcDatabase</span>={<span style="color: #800080;">1</span>}monitor,cn=<span style="color: #000000;">config
changetype: modify
replace: olcAccess
olcAccess: {</span><span style="color: #800080;">0</span>}to * by dn.<span style="color: #0000ff;">base</span>=<span style="color: #800000;">"</span><span style="color: #800000;">gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><span style="color: #800000;">"</span><span style="color: #000000;">
  read by dn.</span><span style="color: #0000ff;">base</span>=<span style="color: #800000;">"</span><span style="color: #800000;">cn=Manager,dc=zhidaoauto,dc=com</span><span style="color: #800000;">"</span> read by *<span style="color: #000000;"> none

dn: olcDatabase</span>={<span style="color: #800080;">2</span>}hdb,cn=<span style="color: #000000;">config
changetype: modify
replace: olcSuffix
olcSuffix: dc</span>=zhidaoauto,dc=<span style="color: #000000;">com

dn: olcDatabase</span>={<span style="color: #800080;">2</span>}hdb,cn=<span style="color: #000000;">config
changetype: modify
replace: olcRootDN
olcRootDN: cn</span>=Manager,dc=zhidaoauto,dc=<span style="color: #000000;">com


dn: olcDatabase</span>={<span style="color: #800080;">2</span>}hdb,cn=<span style="color: #000000;">config
changetype: modify
add: olcRootPW
olcRootPW: {SSHA}OpMcf0c</span>+pEqFLZm3i+YiI2qhId1G/<span style="color: #000000;">yM3 #替换上面生成的密码


dn: olcDatabase</span>={<span style="color: #800080;">2</span>}hdb,cn=<span style="color: #000000;">config
changetype: modify
add: olcAccess
olcAccess: {</span><span style="color: #800080;">0</span>}to attrs=<span style="color: #000000;">userPassword,shadowLastChange by
  dn</span>=<span style="color: #800000;">"</span><span style="color: #800000;">cn=Manager,dc=zhidaoauto,dc=com</span><span style="color: #800000;">"</span> write by anonymous auth by self write by *<span style="color: #000000;"> none
olcAccess: {</span><span style="color: #800080;">1</span>}to dn.<span style="color: #0000ff;">base</span>=<span style="color: #800000;">""</span> by *<span style="color: #000000;"> read
olcAccess: {</span><span style="color: #800080;">2</span>}to * by dn=<span style="color: #800000;">"</span><span style="color: #800000;">cn=Manager,dc=zhidaoauto,dc=com</span><span style="color: #800000;">"</span> write by * read</pre>
</div>
<ul>
<li><code class="highlighter-rouge">olcAccess</code>即access，该key用于指定目录的ACL即谁有什么权限可以存取什么</li>
<li><code class="highlighter-rouge">olcRootDN</code>设定管理员root用户的distingush name</li>
<li>注意替换上面文件内容中cn为具体的域信息</li>
<li>olcRootPW用上面新生成的密码替换</li>
</ul>
<p>写入:</p>
<div class="cnblogs_code">
<pre>ldapmodify -Y EXTERNAL -H ldapi:<span style="color: #808080;">///</span><span style="color: #008000;"> -f domain.ldif</span>
SASL/<span style="color: #000000;">EXTERNAL authentication started
SASL username: gidNumber</span>=<span style="color: #800080;">0</span>+uidNumber=<span style="color: #800080;">0</span>,cn=peercred,cn=external,cn=<span style="color: #000000;">auth
SASL SSF: </span><span style="color: #800080;">0</span><span style="color: #000000;">
modifying entry </span><span style="color: #800000;">"</span><span style="color: #800000;">olcDatabase={1}monitor,cn=config</span><span style="color: #800000;">"</span><span style="color: #000000;">

modifying entry </span><span style="color: #800000;">"</span><span style="color: #800000;">olcDatabase={2}hdb,cn=config</span><span style="color: #800000;">"</span><span style="color: #000000;">

modifying entry </span><span style="color: #800000;">"</span><span style="color: #800000;">olcDatabase={2}hdb,cn=config</span><span style="color: #800000;">"</span><span style="color: #000000;">

modifying entry </span><span style="color: #800000;">"</span><span style="color: #800000;">olcDatabase={2}hdb,cn=config</span><span style="color: #800000;">"</span><span style="color: #000000;">

modifying entry </span><span style="color: #800000;">"</span><span style="color: #800000;">olcDatabase={2}hdb,cn=config</span><span style="color: #800000;">"</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>添加基本目录</strong></p>
<p>新建一个basedomain.ldif的文件:</p>
<div class="cnblogs_code">
<pre>dn: dc=zhidaoauto,dc=<span style="color: #000000;">com
objectClass: top
objectClass: dcObject
objectclass: organization
o: zhidaoauto com
dc: zhidaoauto

dn: cn</span>=Manager,dc=zhidaoauto,dc=<span style="color: #000000;">com
objectClass: organizationalRole
cn: Manager
description: Directory Manager

dn: ou</span>=People,dc=zhidaoauto,dc=<span style="color: #000000;">com
objectClass: organizationalUnit
ou: People

dn: ou</span>=Group,dc=zhidaoauto,dc=<span style="color: #000000;">com
objectClass: organizationalUnit
ou: Group</span></pre>
</div>
<ul>
<li>注意替换上面文件内容中dn为具体的域信息</li>
<li>理解dn,cn,dc
<ul>
<li>DC即Domain Component，LDAP目录类似文件系统目录<code class="highlighter-rouge">dc=zhidaoauto,dc=com</code>相当于<code class="highlighter-rouge">/com/zhidaoauto</code></li>
<li>CN即Common Name，CN有可能代表一个用户名，例如<code class="highlighter-rouge">cn=Manager,dc=zhidaoauto,dc=com</code>表示在<code class="highlighter-rouge">/com/zhidaoauto</code>域下的管理员用户Manager</li>
<li>OU即Organizational Unit，例如<code class="highlighter-rouge">ou=People,dc=zhidaoauto,dc=com</code>表示在<code class="highlighter-rouge">/com/zhidaoauto</code>域下的一个组织单元<code class="highlighter-rouge">People</code></li>
</ul>
</li>
</ul>
<p>&nbsp;写入:</p>
<div class="cnblogs_code">
<pre>ldapadd -x -D cn=Manager,dc=zhidaoauto,dc=com -W -<span style="color: #000000;">f basedomain.ldif
Enter LDAP Password:
adding </span><span style="color: #0000ff;">new</span> entry <span style="color: #800000;">"</span><span style="color: #800000;">dc=zhidaoauto,dc=com</span><span style="color: #800000;">"</span><span style="color: #000000;">

adding </span><span style="color: #0000ff;">new</span> entry <span style="color: #800000;">"</span><span style="color: #800000;">cn=Manager,dc=zhidaoauto,dc=com</span><span style="color: #800000;">"</span><span style="color: #000000;">

adding </span><span style="color: #0000ff;">new</span> entry <span style="color: #800000;">"</span><span style="color: #800000;">ou=People,dc=zhidaoauto,dc=com</span><span style="color: #800000;">"</span><span style="color: #000000;">

adding </span><span style="color: #0000ff;">new</span> entry <span style="color: #800000;">"</span><span style="color: #800000;">ou=Group,dc=zhidaoauto,dc=com</span><span style="color: #800000;">"</span></pre>
</div>
<p>&nbsp;</p>
<p>测试:</p>
<div class="cnblogs_code">
<pre>ldapsearch -LLL -W -x -D <span style="color: #800000;">"</span><span style="color: #800000;">cn=Manager,dc=zhidaoauto,dc=com</span><span style="color: #800000;">"</span> -H ldap:<span style="color: #008000;">//</span><span style="color: #008000;">localhost -b "dc=zhidaoauto,dc=com"</span>
<span style="color: #000000;">Enter LDAP Password:
dn: dc</span>=zhidaoauto,dc=<span style="color: #000000;">com
objectClass: top
objectClass: dcObject
objectClass: organization
o: zhidaoauto com
dc: zhidaoauto

dn: cn</span>=Manager,dc=zhidaoauto,dc=<span style="color: #000000;">com
objectClass: organizationalRole
cn: Manager
description: Directory Manager

dn: ou</span>=People,dc=zhidaoauto,dc=<span style="color: #000000;">com
objectClass: organizationalUnit
ou: People

dn: ou</span>=Group,dc=zhidaoauto,dc=<span style="color: #000000;">com
objectClass: organizationalUnit
ou: Group</span></pre>
</div>
<p>&nbsp;</p>
<h3>管理工具</h3>
<p>可以在局域网内的windows电脑上下载<a href="http://www.ldapadmin.org/download/ldapadmin.html">ldapadmin</a>作为管理工具</p>
<p><img src="https://images2018.cnblogs.com/blog/929849/201808/929849-20180823112236524-1497601162.png" alt="" /></p>
<h3>知识点:</h3>
<p><img src="https://images2018.cnblogs.com/blog/929849/201808/929849-20180823142220780-1812279293.png" alt="" /></p>
<p><strong>登录账号为:</strong></p>
<p>登录ldap的用户dn为:cn=Manager,dc=zhidaoauto,dc=com</p>
<p><strong>ou=Group和ou=People的区别:</strong></p>
<p>从ou=Group里创建的是组,从ou=People创建的是用户</p>
<p><strong>ou=People里的用户怎么加入到ou=Group下边的组呢:</strong></p>
<p>右键"yunwei"组--&gt;properties</p>
<p><img src="https://images2018.cnblogs.com/blog/929849/201808/929849-20180823142831635-732394881.png" alt="" /></p>
<p>&nbsp;</p>
<p><img src="https://images2018.cnblogs.com/blog/929849/201808/929849-20180823142936115-1749932246.png" alt="" /></p>
<p>&nbsp;</p>
<p><img src="https://images2018.cnblogs.com/blog/929849/201808/929849-20180823142955360-1055982200.png" alt="" /></p>
<p>这样就把ou=People里"zhaijunming"用户添加到ou=Group里的"yunwei"组了</p>
<h3>参考文章</h3>
<p>https://blog.frognew.com/2017/05/openldap-install-notes.html#ldapadmin</p>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2018-08-23 11:24</span>&nbsp;<a href="https://www.cnblogs.com/zhaijunming5/">差点点温柔</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>) <a href="https://i.cnblogs.com/EditPosts.aspx?postid=9522756" rel="nofollow"> 编辑</a> <a href="javascript:void(0)" onclick="AddToWz(9522756); return false;">收藏</a>
</div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>
<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 286971, cb_blogApp = 'zhaijunming5', cb_blogUserGuid = '0177deed-c9fb-e511-9fc1-ac853d9f53cc';
    var cb_entryId = 9522756, cb_entryCreatedDate = '2018-08-23 11:24', cb_postType = 1; 
    loadViewCount(cb_entryId);
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>

<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
    </script>
    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot("/1090369/C1", [300, 250], "div-gpt-ad-1546353474406-0").addService(googletag.pubads());
            googletag.defineSlot("/1090369/C2", [468, 60], "div-gpt-ad-1539008685004-0").addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;"></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;">
            <script>
                if (new Date() >= new Date(2018, 9, 13)) {
                    googletag.cmd.push(function () { googletag.display("div-gpt-ad-1539008685004-0"); });
                }
            </script>
        </div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
        deliverAdT2();
        deliverAdC1();
        deliverAdC2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>
	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			


			<div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright &copy; 2019 差点点温柔
<br /><span id="poweredby">Powered by .NET Core 3.0.0-preview9-19423-09 on Linux</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    
</body>
</html>
