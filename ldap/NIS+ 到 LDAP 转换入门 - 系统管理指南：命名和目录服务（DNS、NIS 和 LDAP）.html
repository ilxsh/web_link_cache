<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-CN">
<head>
<!-- GenHTML revision 25226-->
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>NIS+ 到 LDAP 转换入门 - 系统管理指南：命名和目录服务（DNS、NIS 和 LDAP）</title>
<meta http-equiv="content-language" content="zh-CN">
<meta name="robots" content="index,follow">
<meta name="language" content="zh">
<meta name="collection" content="reference">
<meta name="keywords" content="">
<meta name="description" content="《系统管理指南：命名和目录服务（DNS、NIS 和 LDAP）》介绍了有关设置和管理 DNS、NIS 和 LDAP 的内容。">
<meta name="date" content="2011-01-01">
<link rel="stylesheet" type="text/css" title="screen" href="css/default.css">
<link rel="stylesheet" type="text/css" title="screen" href="css/pagelayout.css">
<link rel="alternate stylesheet" type="text/css" title="print" href="css/print.css">
<link rel="stylesheet" type="text/css" title="screen" href="css/advanced.css">
<link rel="stylesheet" type="text/css" title="screen" href="css/search.css">

<script type="text/javascript" src="css/util.js"></script>

<script type="text/javascript">

function SubmitSearch() {
	var form = document.getElementById("SearchForm");
	var searchterm = document.getElementById("searchterm");
	var q = document.getElementById("q");
	var scope;
	var library;
	var path;

	for (var i=0; i < form.scope.length; i++) {
		if (form.scope[i].checked) {
			scope = form.scope[i].value;
		}
	}

	if (searchterm.value.length == 0) {
		alert("search field is empty");
		return false;
	}
	
	path = "docs/cd/E24847_01/html/E22302";
	if (scope == "doc") {
		q.value = searchterm.value + " url:/" + path;
	}
	else {
		library = path.match(/docs.cd.[A-Z][0-9,_]*/);    // This is a regular expressions -- . is used in place of / for path separators
		if (library == null) {
			library = path;
		}
		q.value = searchterm.value + " url:/" + library;
	}

	form.action = "http://search.oracle.com/search/search";
	form.method = "get";
	form.target = "_top";
	form.submit();
}
</script>

<noscript>
	JavaScript is required to for searching.
</noscript>

<script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script><script src='/en/dcommon/js/disclaimer.js' defer></script></head>


<body>

<div class="MastheadPane">
	<table class="MastheadTable" width="100%">
		<tr class="skipnavigation">
			<td>
				<a href="#content">跳过导航链接</a>
			</td>
		</tr>

		<tr class="closeprintview">
			<td align="right">
				<a href="#" onclick="setActiveStyleSheet('screen')">退出打印视图</a>
			</td>
		</tr>

		
		<tr class="titlebar">
			<td class="smallLogo"><a href="http://www.oracle.com/cn"><img alt="链接到 oracle.com" src="graphics/smallOracleLogo.gif"></a>
			</td>

			<td class="contentpage-doctitle"><a href="toc.html">系统管理指南：命名和目录服务（DNS、NIS 和 LDAP） </a><span class="shortContext">&nbsp;&nbsp;&nbsp;&nbsp;Oracle Solaris 10 8/11 Information Library (简体中文)</span>
			</td>
		</tr>
	</table>
</div>


<div class="ButtonPane">
           <div class="ButtonArea1">
               <div class="Button">
                  <a href="http://www.oracle.com/technetwork/cn/index.html" >
                      <img border="0" src="graphics/btn_otn.png" alt="Oracle 技术网" title="Oracle 技术网">
                  </a>
               </div>

               <div class="Button">
                  <a href="../../index.html
" >
                      <img border="0" src="graphics/btn_library.png" alt="文档库" title="文档库">
                  </a>
               </div>
           </div>
           
           <div class="ButtonArea2">

               <div class="Button">
		  
                  <a href="../../pdf/E22302.pdf"  target="table4" onclick="openPopup('','table4',550,550,'yes',0,0,0,0,0,0); return true;">
                      <img border="0" src="graphics/btn_pdf.png" alt="PDF" title="PDF">
                  </a>
		  <!--
		  <img class="grayout" border="0" src="graphics/btn_pdf.png" alt="PDF" title="PDF">
		  -->
               </div>
               
               <div class="Button">
                  <a href="#" onclick="setActiveStyleSheet('print')">
                      <img border="0" src="graphics/btn_print-view.png" alt="打印视图" title="打印视图">
                  </a>
               </div>
               
               <!-- Feedback button -->
               <div class="Button">
                  <a href="http://www.oracle.com/goto/docfeedback" target="new">
                      <img border="0" src="graphics/btn_feedback.png" alt="反馈" title="反馈">
                  </a>
               </div>

           </div>


               <div style="WIDTH: 173px; FLOAT: right; clear: right; margin-right: 30px">
                  <div class="search_position" id="img5">
                     <form id="SearchForm" name="SearchForm" onsubmit="SubmitSearch()">
                         <input name="q" id="q" value="" type="hidden">

                         <div id="serch_txtbox">
                            <div class="search_text">
                               <a  onclick="mvqMOv('panelDiv_search','img5');" href="#"><img alt="search filter icon" src="graphics/search-filter-btn.png" /></a>
                            </div>

                            <div class="textbg">
                               <input title="搜索" id="searchterm" name="searchterm" class="textcnt" value="搜索"
                                      onClick="javascript:if(!isUserInput) {document.SearchForm.searchterm.value='';}"
                                      onKeyDown="javascript:isUserInput=true;" 
                                      onMouseDown="javascript:if(!isUserInput) {document.SearchForm.searchterm.value='';}" />
                               <input type="hidden" name="keyword" value="" id="keyword"/>
                            </div>

                            <div class="search_button">
                               <a onClick="SubmitSearch()"><img alt="search icon" src="graphics/search-icon.gif" /></a>
                            </div>
                         </div><!--start sugession -->

                         <div id="panelDiv_search" onMouseOver="mvqMOv('panelDiv_search','img5');" onMouseOut="mvqMOu('panelDiv_search')";>
                            <div class="TopleftCurv"></div>
                               <div class="centerTop"></div>
                                  <div class="ToprightCurv"></div>
                                     <div class="contentBg">&#160;<strong>搜索范围:</strong>
                                     <div style="padding-bottom:5px; *padding-bottom:1px;"></div>
                                     <ul>
                                        <li><input id="radio_doc" value="doc" type="radio" name="scope" onclick="mvqMOu('panelDiv_search')"/><label for="radio_doc">&#160;&#160;本文档</label></li>
                                        <li><input id="radio_lib" value="library" type="radio" name="scope" onclick="mvqMOu('panelDiv_search')" /><label for="radio_lib">&#160;&#160;整个文档库</label></li>
                                     </ul>
                                  </div>
                               <div class="BottomleftCurv"></div>
                            <div class="centerBottom"></div>
                            <div class="BottomrightCurv"></div>
                          </div>
			  <input type="hidden" name="group" value="Documentation" id="group"/>
                     </form>
                  </div>
               </div>
               

</div>


<div class="TOCPane">
	<p class="toc level1"><a href="docinfo.html#scrolltoc">文档信息</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html#scrolltoc">前言</a></p>
<p class="toc level1 tocsp"><a href="intro-1.html#scrolltoc">第&#160;1&#160;部分关于命名和目录服务</a></p>
<p class="toc level2"><a href="intro2ns-2.html#scrolltoc">1.&#160;&#160;命名和目录服务（概述）</a></p>
<p class="toc level2"><a href="a12swit-86415.html#scrolltoc">2.&#160;&#160;名称服务转换器（概述）</a></p>
<p class="toc level1 tocsp"><a href="dnsadmin-1.html#scrolltoc">第&#160;2&#160;部分DNS 设置和管理</a></p>
<p class="toc level2"><a href="dnsref-1.html#scrolltoc">3.&#160;&#160;DNS 设置和管理（参考）</a></p>
<p class="toc level1 tocsp"><a href="nissetup-1.html#scrolltoc">第&#160;3&#160;部分NIS 设置和管理</a></p>
<p class="toc level2"><a href="anis1-25461.html#scrolltoc">4.&#160;&#160;网络信息服务 (Network Information Service, NIS)（概述）</a></p>
<p class="toc level2"><a href="cnis1-25208.html#scrolltoc">5.&#160;&#160;设置和配置 NIS 服务</a></p>
<p class="toc level2"><a href="anis2-22217.html#scrolltoc">6.&#160;&#160;管理 NIS（任务）</a></p>
<p class="toc level2"><a href="abtrbl-18694.html#scrolltoc">7.&#160;&#160;NIS 疑难解答</a></p>
<p class="toc level1 tocsp"><a href="ldapsetup-1.html#scrolltoc">第&#160;4&#160;部分LDAP 命名服务的设置和管理</a></p>
<p class="toc level2"><a href="overview-1.html#scrolltoc">8.&#160;&#160;LDAP 命名服务介绍（概述/参考）</a></p>
<p class="toc level2"><a href="ldapsecure-1.html#scrolltoc">9.&#160;&#160;LDAP 基本组件和概念（概述）</a></p>
<p class="toc level2"><a href="planldap-1.html#scrolltoc">10.&#160;&#160;LDAP 命名服务的规划要求（任务）</a></p>
<p class="toc level2"><a href="sundssetup-13.html#scrolltoc">11.&#160;&#160;为使用 LDAP 客户机设置 Sun Java System Directory Server（任务）</a></p>
<p class="toc level2"><a href="clientsetup-1.html#scrolltoc">12.&#160;&#160;设置 LDAP 客户机（任务）</a></p>
<p class="toc level2"><a href="setupproblems-1.html#scrolltoc">13.&#160;&#160;LDAP 疑难解答（参考）</a></p>
<p class="toc level2"><a href="schemas-1.html#scrolltoc">14.&#160;&#160;LDAP 一般参考（参考）</a></p>
<p class="toc level2"><a href="nis2ldap-34.html#scrolltoc">15.&#160;&#160;从 NIS 转换为 LDAP（概述/任务）</a></p>
<p class="toc level2"><a href="nisplus2ldap-1.html#scrolltoc">16.&#160;&#160;从 NIS+ 转换为 LDAP</a></p>
<p class="toc level3"><a href="nisplus2ldap-2.html#scrolltoc">NIS+ 到 LDAP 的转换概述</a></p>
<p class="toc level4"><a href="nisplus2ldap-2.html#nisplus2ldap-3"><tt>rpc.nisd</tt> 配置文件</a></p>
<p class="toc level4"><a href="nisplus2ldap-2.html#nisplus2ldap-66">NIS+ 到 LDAP 转换工具和服务管理工具</a></p>
<p class="toc level5"><a href="nisplus2ldap-2.html#nisplus2ldap-150">何时不使用 SMF 进行 NIS+ 到 LDAP 转换</a></p>
<p class="toc level5"><a href="nisplus2ldap-2.html#nisplus2ldap-160">修改 <tt>/lib/svc/method/nisplus</tt> 文件</a></p>
<p class="toc level4 tocsp"><a href="nisplus2ldap-2.html#nisplus2ldap-4">创建属性和对象类</a></p>
<div id="scrolltoc" class="onpage">
<p class="toc level3 tocsp"><a href="#scrolltoc">NIS+ 到 LDAP 转换入门</a></p>
<p class="toc level4"><a href="#nisplus2ldap-6"><tt>/etc/default/rpc.nisd</tt> 文件</a></p>
<p class="toc level5"><a href="#nisplus2ldap-7">常规配置</a></p>
<p class="toc level5"><a href="#nisplus2ldap-8">来自 LDAP 的配置数据</a></p>
<p class="toc level5"><a href="#nisplus2ldap-9">服务器选择</a></p>
<p class="toc level5"><a href="#nisplus2ldap-10">验证和安全性</a></p>
<p class="toc level5"><a href="#nisplus2ldap-11">LDAP 和 NIS+ 中的缺省位置</a></p>
<p class="toc level5"><a href="#nisplus2ldap-12">LDAP 通信的超时/大小限制和引用操作</a></p>
<p class="toc level5"><a href="#nisplus2ldap-13">错误操作</a></p>
<p class="toc level5"><a href="#nisplus2ldap-14">常规 LDAP 操作控制</a></p>
<p class="toc level4 tocsp"><a href="#nisplus2ldap-15"><tt>/var/nis/NIS+LDAPmapping</tt> 文件</a></p>
<p class="toc level5"><a href="#nisplus2ldap-16"><tt>nisplusLDAPdatabaseIdMapping</tt> 属性</a></p>
<p class="toc level5"><a href="#nisplus2ldap-17"><tt>nisplusLDAPentryTtl</tt> 属性</a></p>
<p class="toc level5"><a href="#nisplus2ldap-18"><tt>nisplusLDAPobjectDN</tt> 属性</a></p>
<p class="toc level5"><a href="#nisplus2ldap-19"><tt>nisplusLDAPattributeFromColumn</tt> 属性</a></p>
<p class="toc level5"><a href="#nisplus2ldap-20"><tt>nisplusLDAPcolumnFromAttribute</tt> 属性</a></p>
<p class="toc level4 tocsp"><a href="#nisplus2ldap-21">NIS+ 到 LDAP 迁移方案</a></p>
<p class="toc level5"><a href="#nisplus2ldap-proc-22">如何通过一步操作将所有的 NIS+ 数据转换为 LDAP</a></p>
<p class="toc level5"><a href="#nisplus2ldap-proc-25">如何通过一步操作将所有的 LDAP 数据转换为 NIS+</a></p>
<p class="toc level4 tocsp"><a href="#nisplus2ldap-28">合并 NIS+ 数据和 LDAP 数据</a></p>
<p class="toc level5"><a href="#nisplus2ldap-proc-29">如何合并 NIS+ 数据和 LDAP 数据</a></p>
</div>
<p class="toc level3 tocsp"><a href="nisplus2ldap-41.html#scrolltoc">主服务器和副本服务器（从 NIS+ 转换为 LDAP）</a></p>
<p class="toc level4"><a href="nisplus2ldap-41.html#nisplus2ldap-42">复制时间标记</a></p>
<p class="toc level3 tocsp"><a href="nisplus2ldap-43.html#scrolltoc">目录服务器（从 NIS+ 转换为 LDAP）</a></p>
<p class="toc level4"><a href="nisplus2ldap-43.html#nisplus2ldap-44">配置 Sun Java System Directory Server</a></p>
<p class="toc level4"><a href="nisplus2ldap-43.html#nisplus2ldap-45">指定服务器地址和端口号</a></p>
<p class="toc level4"><a href="nisplus2ldap-43.html#nisplus2ldap-46">安全性和验证</a></p>
<p class="toc level5"><a href="nisplus2ldap-43.html#nisplus2ldap-47">使用 SSL</a></p>
<p class="toc level4 tocsp"><a href="nisplus2ldap-43.html#nisplus2ldap-48">性能和索引</a></p>
<p class="toc level3 tocsp"><a href="nisplus2ldap-49.html#scrolltoc">映射表项以外的 NIS+ 对象</a></p>
<p class="toc level3"><a href="nisplus2ldap-50.html#scrolltoc">NIS+ 项的所有者、组、访问权限和 TTL</a></p>
<p class="toc level4"><a href="nisplus2ldap-50.html#nisplus2ldap-proc-51">如何将其他项属性存储到 LDAP 中</a></p>
<p class="toc level3 tocsp"><a href="nisplus2ldap-56.html#scrolltoc">主体名和网络名（从 NIS+ 转换为 LDAP）</a></p>
<p class="toc level3"><a href="nisplus2ldap-57.html#scrolltoc"><tt>client_info</tt> 和 <tt>timezone</tt> 表（从 NIS+ 转换为 LDAP）</a></p>
<p class="toc level4"><a href="nisplus2ldap-57.html#nisplus2ldap-58"><tt>client_info</tt> 属性和对象类</a></p>
<p class="toc level4"><a href="nisplus2ldap-57.html#nisplus2ldap-59"><tt>timezone</tt> 属性和对象类</a></p>
<p class="toc level3 tocsp"><a href="nisplus2ldap-60.html#scrolltoc">添加新的对象映射（从 NIS+ 转换为 LDAP）</a></p>
<p class="toc level4"><a href="nisplus2ldap-60.html#nisplus2ldap-proc-61">如何映射非项对象</a></p>
<p class="toc level4"><a href="nisplus2ldap-60.html#nisplus2ldap-69">添加项对象</a></p>
<p class="toc level3 tocsp"><a href="nisplus2ldap-70.html#scrolltoc">将配置信息存储到 LDAP 中</a></p>
<p class="toc level1 tocsp"><a href="whatsnew-1.html#scrolltoc">A.&#160;&#160;Solaris 10 软件中对 DNS、NIS 和 LDAP 的更新</a></p>
<p class="toc level2"><a href="whatsnew-5.html#scrolltoc">服务管理工具的更改</a></p>
<p class="toc level2"><a href="whatsnew-2.html#scrolltoc">DNS BIND</a></p>
<p class="toc level2"><a href="schemas-290.html#scrolltoc"><tt>pam_ldap</tt> 更改</a></p>
<p class="toc level2"><a href="whatsnew-3.html#scrolltoc">文档错误</a></p>
<p class="toc level1 tocsp"><a href="aagloss-87604.html#scrolltoc">词汇表</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html#scrolltoc">索引</a></p>

</div>

<a name="SYSADV5content"></a><a name="content"></a>
<div class="ContentPane">
	



<a name="SYSADV5nisplus2ldap-5"></a><a name="nisplus2ldap-5"></a><h2>NIS+ 到 LDAP 转换入门</h2>


<p>有关开始为 NIS+ 数据使用 LDAP 系统信息库所需的配置的介绍，请参见 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN4nis-plus-ldapmapping-4"><tt>NIS+LDAPmapping</tt>(4)</a>。本节中的其余部分更详细地介绍配置文件的组织结构。</p>



<a name="SYSADV5nisplus2ldap-6"></a><a name="nisplus2ldap-6"></a><h3><tt>/etc/default/rpc.nisd</tt> 文件</h3>


<p><tt>/etc/default/rpc.nisd</tt> 文件中所有的赋值均为 <tt>attributeName=value</tt> 类型。</p>



<a name="SYSADV5nisplus2ldap-7"></a><a name="nisplus2ldap-7"></a><h4>常规配置</h4>
<a name="SYSADV5indexterm-595"></a><a name="indexterm-595"></a>

<p>下列属性控制 <tt>rpc.nisd</tt> 的常规配置，无论 LDAP 映射是否有效，这些属性都处于活动状态。通常情况下，应保留其缺省值。有关更多信息，请参见 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN4rpc.nisd-4"><tt>rpc.nisd</tt>(4)</a>。</p>
<ul><li>

<p><tt>nisplusNumberOfServiceThreads</tt></p></li>
<li>

<p><tt>nisplusThreadCreationErrorAction</tt></p></li>
<li>

<p><tt>nisplusThreadCreationErrorAttempts</tt></p></li>
<li>

<p><tt>nisplusThreadCreationErrorTimeout</tt></p></li>
<li>

<p><tt>nisplusDumpErrorAction</tt></p></li>
<li>

<p><tt>nisplusDumpErrorAttempts</tt></p></li>
<li>

<p><tt>nisplusDumpErrorTimeout</tt></p></li>
<li>

<p><tt>nisplusResyncService</tt></p></li>
<li>

<p><tt>nisplusUpdateBatching</tt></p></li>
<li>

<p><tt>nisplusUpdateBatchingTimeout</tt></p></li></ul>




<a name="SYSADV5nisplus2ldap-8"></a><a name="nisplus2ldap-8"></a><h4>来自 LDAP 的配置数据</h4>


<p>下列属性控制如何从 LDAP 读取其他配置属性。这些属性本身不能驻留在 LDAP 中。它们只能从命令行或配置文件中读取。有关更多信息，请参见 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN4rpc.nisd-4"><tt>rpc.nisd</tt>(4)</a>。</p>
<ul><li>

<p><tt>nisplusLDAPconfigDN</tt></p></li>
<li>

<p><tt>nisplusLDAPconfigPreferredServerList</tt></p></li>
<li>

<p><tt>nisplusLDAPconfigAuthenticationMethod</tt></p></li>
<li>

<p><tt>nisplusLDAPconfigTLS</tt></p></li>
<li>

<p><tt>nisplusLDAPconfigTLSCertificateDBPath</tt></p></li>
<li>

<p><tt>nisplusLDAPconfigProxyUser</tt></p></li>
<li>

<p><tt>nisplusLDAPconfigProxyPassword</tt></p></li></ul>




<a name="SYSADV5nisplus2ldap-9"></a><a name="nisplus2ldap-9"></a><h4>服务器选择</h4>

<ul><li>

<p><tt>preferredServerList</tt></p>

<p>指定 LDAP 服务器和端口号。</p><pre># LDAP server can be found at port 389
# LDAP server can be found at port 389
on the local machine
# preferredServerList=127.0.0.1
# Could also be written
# preferredServerList=127.0.0.0.1:389
LDAP server on the machine at IP
# address "1.2.3.4", at port 65042
# preferredServerList=1.2.3.4:65042</pre></li></ul>




<a name="SYSADV5nisplus2ldap-10"></a><a name="nisplus2ldap-10"></a><h4>验证和安全性</h4>

<ul><li>

<p><tt>authenticationMethod</tt></p></li>
<li>

<p><tt>nisplusLDAPproxyUser</tt></p></li>
<li>

<p><tt>nisplusLDAPproxyPassword</tt></p></li></ul>


<p>指定验证方法，在适用于所选方法的情况下，还可指定要在 <tt>rpc.nisd</tt> 守护进程和 LDAP 服务器之间使用的代理用户（绑定的标识名 (distinguished name, DN)）和口令（密钥或其他共享秘密）。有关更多信息，请参见<a href="nisplus2ldap-43.html#nisplus2ldap-46">安全性和验证</a>。</p>
<ul><li>

<p><tt>nisplusLDAPTLS</tt></p></li>
<li>

<p><tt>nisplusLDAPTLSCertificateDBPath</tt></p></li></ul>


<p>可以选择使用 SSL，并指定证书文件的位置。有关更多信息，请参见<a href="nisplus2ldap-43.html#nisplus2ldap-47">使用 SSL</a>。</p>



<a name="SYSADV5nisplus2ldap-11"></a><a name="nisplus2ldap-11"></a><h4>LDAP 和 NIS+ 中的缺省位置</h4>

<ul><li>

<p><tt>defaultSearchBase</tt></p>

<p>LDAP DIT 中用于存放 RFC 2307 样式的命名服务数据的位置。当未在单独的容器 DN 中指定完整的搜索库时，会使用此缺省位置。有关更多信息，请参见<a href="#nisplus2ldap-18"><tt>nisplusLDAPobjectDN</tt> 属性</a>。</p></li>
<li>

<p><tt>nisplusLDAPbaseDomain</tt></p>

<p>当 NIS+ 对象规范（请参见<a href="#nisplus2ldap-16"><tt>nisplusLDAPdatabaseIdMapping</tt> 属性</a>）未完全限定时使用的缺省 NIS+ 域名。</p></li></ul>




<a name="SYSADV5nisplus2ldap-12"></a><a name="nisplus2ldap-12"></a><h4>LDAP 通信的超时/大小限制和引用操作</h4>

<ul><li>

<p><tt>nisplusLDAPbindTimeout</tt></p></li>
<li>

<p><tt>nisplusLDAPmodifyTimeout</tt></p></li>
<li>

<p><tt>nisplusLDAPaddTimeout</tt></p></li>
<li>

<p><tt>nisplusLDAPdeleteTimeout</tt></p></li></ul>


<p>以上参数分别是 <tt>ldap</tt> <tt>bind</tt>、<tt>modify</tt>、<tt>add</tt> 和 <tt>delete</tt> 操作的超时参数。通常情况下，应保留其缺省值。</p>
<ul><li>

<p><tt>nisplusLDAPsearchTimeout</tt></p></li>
<li>

<p><tt>nisplusLDAPsearchTimeLimit</tt></p></li></ul>


<p>以上第一个参数用于设置 LDAP 搜索操作的超时值，第二个参数用于请求服务器端的搜索时间限制。由于 <tt>nisplusLDAPsearchTimeLimit </tt> 将控制 LDAP 服务器花在搜索请求上的时间，因此请确保 <tt>nisplusLDAPsearchTimeLimit</tt> 不小于 <tt>nisplusLDAPsearchTimeout</tt>。根据 NIS+ 服务器、LDAP
服务器以及二者之间连接的性能，您可能需要在缺省值的基础上增大搜索限制的值。请查看 <tt>rpc.nisd</tt> 的超时系统日志消息，并根据消息提示来增大这些值。</p>
<ul><li>

<p><tt>nisplusLDAPsearchSizeLimit</tt></p>

<p>以上参数请求 LDAP 搜索请求所返回的 LDAP 数据量的限制值。缺省值为请求无限制。这是服务器端的限制。LDAP 服务器可能会对最大值施加限制，并且这些限制可能会绑定到所使用的代理用户（绑定 DN）。请确保 LDAP 服务器允许 <tt>rpc.nisd</tt> 传送足以置备最大容器（具体取决于站点设置，通常是指用于 <tt>passwd.org_dir</tt>、<tt>mail_aliases.org_dir</tt> 或 <tt>netgroup.org_dir</tt> 的容器）的数据。有关更多信息，请查阅 LDAP 服务器文档。</p></li>
<li>

<p><tt>nisplusLDAPfollowReferral</tt></p>

<p>以上参数用于定义当 LDAP 操作导致需要引用其他 LDAP 服务器时要执行的操作。缺省值为<b>不</b>遵循引用。如果您希望或者需要遵循引用，请启用&#8220;遵循引用&#8221;。请记住，尽管引用会带来方便，但是它们也会使 <tt>rpc.nisd</tt> 对于每个请求都与多台 LDAP 服务器通信，从而降低操作速度。<tt>rpc.nisd</tt> 通常应当直接指向能够处理 <tt>rpc.nisd</tt> 可能发出的任何 LDAP 请求的 LDAP 服务器。</p></li></ul>




<a name="SYSADV5nisplus2ldap-13"></a><a name="nisplus2ldap-13"></a><h4>错误操作</h4>


<p>下列参数定义当 LDAP 操作过程中出现错误时要执行的操作。通常情况下，应保留其缺省值。有关更多信息，请参见<a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN4rpc.nisd-4"><tt>rpc.nisd</tt>(4)</a>。</p>
<ul><li>

<p><tt>nisplusLDAPinitialUpdateAction</tt></p></li>
<li>

<p><tt>nisplusLDAPinitialUpdateOnly</tt></p></li>
<li>

<p><tt>nisplusLDAPretrieveErrorAction</tt></p></li>
<li>

<p><tt>nisplusLDAPretrieveErrorAttempts</tt></p></li>
<li>

<p><tt>nisplusLDAPretrieveErrorTimeout</tt></p></li>
<li>

<p><tt>nisplusLDAPstoreErrorAction</tt></p></li>
<li>

<p><tt>nisplusLDAPstoreErrorAttempts</tt></p></li>
<li>

<p><tt>nisplusLDAPstoreErrorTimeout</tt></p></li>
<li>

<p><tt>nisplusLDAPrefreshErrorAction</tt></p></li>
<li>

<p><tt>nisplusLDAPrefreshErrorAttempts</tt></p></li>
<li>

<p><tt>nisplusLDAPrefreshErrorTimeout</tt></p></li></ul>




<a name="SYSADV5nisplus2ldap-14"></a><a name="nisplus2ldap-14"></a><h4>常规 LDAP 操作控制</h4>

<ul><li>

<p><tt>nisplusLDAPmatchFetchAction</tt></p>

<p>以上参数用于确定是否应当为 NIS+ 匹配操作预先提取 LDAP 数据。在大多数情况下，应保留其缺省值。有关更多信息，请参见<a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN4rpc.nisd-4"><tt>rpc.nisd</tt>(4)</a>。</p></li></ul>




<a name="SYSADV5nisplus2ldap-15"></a><a name="nisplus2ldap-15"></a><h3><tt>/var/nis/NIS+LDAPmapping</tt> 文件</h3>


<p>缺省的 <tt>NIS+LDAPmapping</tt> 文件充当 NIS+/LDAP 映射的主转换器。</p>

<p>如果您使用非缺省映射文件，则必须编辑<tt> /lib/svc/method/nisplus</tt> 脚本，以在 <tt>rpc.nisd</tt> 行中使用 <tt>-m</tt> <var>mappingfile</var> 选项指定映射文件的名称。有关更多信息，请参见<a href="nisplus2ldap-2.html#nisplus2ldap-66">NIS+ 到 LDAP 转换工具和服务管理工具</a>。</p>

<p>对于应当映射到 LDAP 或从 LDAP 映射的每个 NIS+ 对象，<tt>NIS+LDAPmapping</tt> 文件将指定两到五个属性，具体取决于该对象以及缺省值是否满足需要。</p>



<a name="SYSADV5nisplus2ldap-16"></a><a name="nisplus2ldap-16"></a><h4><tt>nisplusLDAPdatabaseIdMapping</tt> 属性</h4>


<p>您必须设置一个要在其他映射属性中使用的别名。如果 NIS+ 对象名不是全限定名（不以点结尾），则将附加 <tt>nisplusLDAPbaseDomain</tt> 值。</p>

<p>例如，</p><pre>nisplusLDAPdatabaseIdMapping    rpc:rpc.org_dir</pre>

<p>将数据库 ID <tt>rpc</tt> 定义为 NIS+ <tt>rpc.org_dir</tt> 表的别名。</p>

<p>请注意，NIS+ 表对象可能会针对表对象（如果该对象应当映射到 LDAP）和表项分别出现一次，只是两种情况下的数据库 ID 不同。例如，</p><pre>nisplusLDAPdatabaseIdMapping    rpc_table:rpc.org_dir
nisplusLDAPdatabaseIdMapping    rpc:rpc.org_dir</pre>

<p>将数据库 ID <tt>rpc_table</tt> 和 <tt>rpc</tt> 定义为 <tt>rpc.org_dir</tt> 表的别名。后面的定义清楚表明将 <tt>rpc_table</tt> 用于 <tt>rpc.org_dir</tt> 表对象，将
<tt>rpc</tt> 用于该表中的各项。</p>



<a name="SYSADV5nisplus2ldap-17"></a><a name="nisplus2ldap-17"></a><h4><tt>nisplusLDAPentryTtl</tt> 属性</h4>


<p>由于 <tt>rpc.nisd</tt> 守护进程的本地数据库（位于内存中和磁盘上）充当 LDAP 数据的高速缓存，因此可使用 <tt>nisplusLDAPentryTtl</tt> 属性来设置该高速缓存中各项的生存时间 (time-to-live, TTL) 值。每个数据库 ID 都有三个
TTL。前两个 TTL 用于控制当 <tt>rpc.nisd</tt> 首次从磁盘装入对应的 NIS+ 对象数据时的初始 TTL，第三个 TTL 将在从 LDAP 中读取或刷新对象时指定给该对象。</p>

<p>例如，通过以下语句，<tt>rpc.org_dir</tt> 表对象可获取一个在 21600 秒到 43200 秒的范围内随机选择的初始 TTL。</p><pre>nisplusLDAPentryTtl    rpc_table:21600:43200:43200</pre>

<p>如果初始 TTL 过期并从 LDAP 中刷新了表对象，则该 TTL 将设置为 43200 秒。</p>

<p>同样，使用以下语句，可在首次装入 <tt>rpc.org_dir</tt> 表时向该表中的各项指定一个介于 1800 秒和 3600 秒之间的初始 TTL。</p><pre>nisplusLDAPentryTtl    rpc:1800:3600:3600</pre>

<p>每项都会获取各自在指定范围内随机选择的 TTL。如果某个表项过期并已刷新，则该 TTL 将设置为 3600 秒。</p>

<p>选择 TTL 值时，需要综合考虑性能和一致性。如果由 <tt>rpc.nisd</tt> 高速缓存的 LDAP 数据所使用的 TTL 非常长，则性能与 <tt>rpc.nisd</tt> 根本未从 LDAP
映射数据时一样。但是，如果 LDAP 数据被 <tt>rpc.nisd</tt> 以外的某个实体更改，则所做的更改也可能会在很长时间之后才显示在 NIS+ 中。</p>

<p>相反，如果选择非常短（或者甚至为零）的 TTL，则意味着对 LDAP 数据进行的更改会迅速显示在 NIS+ 中，但这也可能会大大降低性能。通常，对于会同时从 LDAP 中读取数据或向 LDAP 中写入数据的 NIS+ 操作而言，所需的时间将至少为没有
LDAP 通信时执行同一操作所需时间的两到三倍（而且还会带来额外的 LDAP 查找开销）。尽管性能会因为硬件资源而大不相同，但是，扫描大型 LDAP 容器（具有几万或几十万个项）以确定应当刷新的 NIS+ 项可能会需要很长时间。<tt>rpc.nisd</tt> 守护进程在后台执行扫描操作，从而可在运行时继续为可能过时的数据提供服务，但是后台扫描仍然会占用 NIS+ 服务器中的 CPU
和内存。</p>

<p>请仔细考虑保持 NIS+ 数据与 LDAP 密切同步的重要性，并选择每个 NIS+ 对象都可接受的最长 TTL。缺省值（未指定 <tt>nisplusLDAPentryTtl</tt> 时的值）是 1 小时。对于表项以外的对象，模板映射文件
<tt>/var/nis/NIS+LDAPmapping.template</tt> 会将该值更改为 12 小时。但是，系统无法自动识别非项对象，因此，如果要为非项对象添加映射，TTL 的缺省值将为 1 小时。</p>
<div class="sgnote"><hr><p><b>注 - </b>不存在的对象没有 TTL。因此，无论哪些 TTL 对于 NIS+ 表中的 LDAP 映射项有效，请求 NIS+ 中不存在的项时都将在 LDAP 中查询该项。</p>
<hr></div>




<a name="SYSADV5nisplus2ldap-18"></a><a name="nisplus2ldap-18"></a><h4><tt>nisplusLDAPobjectDN</tt> 属性</h4>


<p>对于每个映射的 NIS+ 对象，<tt>nisplusLDAPobjectDN</tt> 都会设置对象数据在 LDAP DIT 中所处的位置。它还允许指定在删除 LDAP 项之后要执行的操作。每个 <tt>nisplusLDAPobjectDN</tt> 值都有三部分。第一部分指定从何处读取 LDAP
数据，第二部分指定将 LDAP 数据写入何处，第三部分指定在删除 LDAP 数据时应当发生的情况。请参阅以下示例：</p><pre>nisplusLDAPobjectDN    rpc_table:\
           cn=rpc,ou=nisPlus,?base?\
              objectClass=nisplusObjectContainer:\
           cn=rpc,ou=nisPlus,?base?\
              objectClass=nisplusObjectContainer,\
              objectClass=top</pre>

<p>以上示例说明应当从 DN <tt>cn=rpc,ou=nisPlus</tt> 读取 <tt>rpc.org_dir</tt> 表对象（由于该值以逗号结尾，附加了 <tt>defaultSearchBase</tt> 属性的值），搜索范围为 <tt>base</tt>，<tt>ObjectClass</tt> 属性的值为 <tt>nisplusObjectContainer</tt> 的项处于选中状态。</p>

<p>表对象被写入同一位置。缺少删除规范，这意味着将执行缺省操作，如下所示。如果该 NIS+ 表对象被删除，整个 LDAP 项也应当被删除。</p>

<p>如果应从 LDAP 读取数据，而不应向其中写入数据，请忽略写入部分（以及用于将写入部分与读取部分分开的冒号）。</p><pre>nisplusLDAPobjectDN    rpc_table:\
              cn=rpc,ou=nisPlus,?base?\
              objectClass=nisplusObjectContainer</pre>

<p>请注意，<tt>nisplusObjectContainer</tt> 对象类不属于 RFC 2307。要使用它，您必须按照<a href="nisplus2ldap-49.html#scrolltoc">映射表项以外的 NIS+ 对象</a>中的详细说明配置 LDAP 服务器。</p>

<p>对于 <tt>rpc.org_dir</tt> 表项，您可以使用以下示例：</p><pre>nisplusLDAPobjectDN rpc:ou=Rpc,?one?objectClass=oncRpc:\
              ou=Rpc,?one?objectClass=onRpc,objectClass=top</pre>

<p>以上示例显示了从基本 <tt>ou=Rpc</tt> 中读取表项和向其中写入表项。而且，结尾的逗号还会附加 <tt>defaultSearchBase</tt> 值。选择 <tt>objectClass</tt> 属性的值为 <tt>oncRpc</tt> 的项。当在 LDAP 中的 <tt>ou=Rpc</tt>
容器中创建项时，您还必须将 <tt>top</tt> 指定为 <tt>objectClass</tt> 值。</p>

<p>请考虑以下示例中说明的非缺省删除规范：</p><pre>nisplusLDAPobjectDN    user_attr:\
              ou=People,?one?objectClass=SolarisUserAttr,\
                 solarisAttrKeyValue=*:\
              ou=People,?one?objectClass=SolarisUserAttr:\
                 dbid=user_attr_del</pre>

<p><tt>user_attr.org_dir</tt> 数据驻留在 <tt>ou=People</tt> LDAP 容器中，该容器由这些数据和来自其他源（如 <tt>passwd.org_dir</tt> NIS+ 表）的帐户信息共享。</p>

<p>在该容器中选择具有 <tt>solarisAttrKeyValue</tt> 属性的项，因为只有这些项才包含 <tt>user_attr.org_dir</tt> 数据。<tt>nisplusLDAPobjectDN</tt> 的 <tt>dbid=user_attr_del</tt> 部分说明在删除 <tt>user_attr.org_dir</tt> NIS+ 表中的某个项时，应当按照 <tt>user_attr_del</tt>
数据库 ID 所标识的规则集合内的规则删除对应的 LDAP 项（如果有的话）。有关更多信息，请参见<a href="#nisplus2ldap-20"><tt>nisplusLDAPcolumnFromAttribute</tt> 属性</a>。</p>



<a name="SYSADV5nisplus2ldap-19"></a><a name="nisplus2ldap-19"></a><h4><tt>nisplusLDAPattributeFromColumn</tt> 属性</h4>


<p><tt>nisplusLDAPattributeFromColumn</tt> 指定用于将 NIS+ 数据映射到 LDAP 的规则。其他方向的映射规则由 <tt>nisplusLDAPcolumnFromAttribute</tt> 控制。</p>



<a name="SYSADV5nisplus2ldap-20"></a><a name="nisplus2ldap-20"></a><h4><tt>nisplusLDAPcolumnFromAttribute</tt> 属性</h4>


<p><tt>nisplusLDAPcolumnFromAttribute</tt> 指定用于将 LDAP 数据映射到 NIS+ 的规则。</p>

<p>完整的项映射语法可以在<a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN4nis-plus-ldapmapping-4"><tt>NIS+LDAPmapping</tt>(4)</a>中找到。但是，通过几个示例可以更清楚地理解映射语法。</p>

<p>NIS+ <tt>rpc.org_dir</tt> 表中包含四个名为 <tt>cname</tt>、<tt>name</tt>、<tt>numbe</tt> 和 <tt>comment</tt> 的列。因此，NIS+ RPC 程序号 (100300) 的标准名称为 <tt>nisd</tt>、别名为
<tt>rpc.nisd</tt> 和 <tt>nisplusd</tt> 的项可以由 <tt>rpc.org_dir</tt> 中的下列 NIS+ 项表示：</p><pre>nisd nisd 100300    NIS+ server
nisd rpc.nisd 100300    NIS+ server
nisd nisplusd 100300    NIS+ server</pre>

<p>假定 <tt>defaultSearchBase</tt> 值为 <tt>dc=some,dc=domain</tt>，对应的 LDAP 项（列在 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN1ldapsearch-1"><tt>ldapsearch</tt>(1)</a> 中）将如下所示：</p><pre>dn: cn=nisd,ou=Ppc,dc=some,dc=domain
cn: nisd
cn: rpc.nsid
cn: nisplusd
oncRpcNumber: 100300
description: NIS+ server
objectClass: oncRpc</pre>

<p>这有助于在 NIS+ 数据和 LDAP 数据之间建立简单的一一映射的关系，而从 NIS+ 到 LDAP 的对应映射属性值如下所示：</p><pre>nisplusLDAPattributeFromColumn \
rpc:        dn=("cn=%s,", name), \
                cn=cname, \
                cn=name, \
                oncRpcNumber=number, \
                description=comment</pre>

<p>这会使该项的 DN 为 <tt>cn=%s</tt>，并用 <tt>cname</tt> 列的值替换 <tt>%s</tt>。</p><pre>cn=nisd,</pre>

<p>由于该值以逗号结尾，因此将附加从 <tt>nisplusObjectDN</tt> 读取的基值，结果如下所示：</p><pre>cn=nisd,ou=Rpc,dc=some,dc=domain</pre>

<p><tt>oncRpcNumber</tt> 和 <tt>description</tt> 属性值只是对应的 NIS+ 列的简单赋值。<tt>rpc.nisd</tt> 会将多个 NIS+ 项收集到一个 LDAP 项中，并用多个 <tt>cn</tt>
值来表示不同的 <tt>name</tt> 列值。</p>

<p>同样，从 LDAP 到 NIS+ 的映射将如下所示：</p><pre>nisplusLDAPcolumnFromAttribute \
       rpc:      cname=cn, \
                 (name)=(cn), \
                 number=oncRpcNumber, \
                 comment=description</pre>

<p>以上示例会将 <tt>oncRpcNumber</tt> 和 <tt>description</tt> 值指定给对应的 NIS+ 列。多值 <tt>cn</tt>（由 <tt>(cn)</tt> 表示）映射到多个 <tt>name</tt> 列值（由
<tt>(name)</tt> 表示）。由于 <tt>name</tt> 列不能具有多值，因此 <tt>rpc.nisd</tt> 会为每个 <tt>cn</tt> 值创建一个 NIS+ 项。</p>

<p>最后，<tt>nisplusLDAPattributeFromColumn</tt> 值是一个用于删除操作的规则集合的示例。</p><pre>nisplusLDAPattributeFromColumn \
user_attr_del:    dn=("uid=%s,", name), \
           SolarisUserQualifier=, \
           SolarisAttrReserved1=, \
           SolarisAttrReserved2=, \
           SolarisAttrKeyValue=</pre>

<p>而且，<tt>user_attr.org_dir</tt> 数据与其他帐户信息（来自 <tt>passwd.org_dir</tt> 和其他表）共享 <tt>ou=People</tt> 容器。如果 <tt>user_attr.org_dir</tt> 表中的一项被删除，您可能不希望整个 <tt>ou=People</tt> 项被删除。相反，以上删除项假设当 <tt>user_attr.org_dir</tt> 项被删除时，<tt>SolarisUserQualifier</tt>、<tt>SolarisAttrReserved1</tt>、<tt>SolarisAttrReserved2</tt>
和 <tt>SolarisAttrKeyValue</tt> 属性（如果有的话）会从以下规则所指定的 <tt>ou=People</tt> 项中删除：</p><pre>dn=("uid=%s,", name)</pre>

<p>LDAP 项的其余部分保持不变。</p>



<a name="SYSADV5nisplus2ldap-21"></a><a name="nisplus2ldap-21"></a><h3>NIS+ 到 LDAP 迁移方案</h3>


<p>以下列出了从 NIS+ 迁移到 LDAP 时可能的迁移方案：</p>
<ul><li>

<p><b>通过一步操作将所有的 NIS+ 客户机转换为使用 LDAP。</b>您可以使用 <tt>rpc.nisd</tt> 守护进程上载 LDAP 中尚不存在的任何 NIS+ 数据。请参见<a href="#nisplus2ldap-proc-22">如何通过一步操作将所有的 NIS+ 数据转换为 LDAP</a>。</p></li>
<li>

<p><b>从 NIS+ 逐步迁移到 LDAP。</b>首先将 NIS+ 数据转换为 LDAP（请参见<a href="#nisplus2ldap-proc-22">如何通过一步操作将所有的 NIS+ 数据转换为 LDAP</a>）。您可以让 NIS+ 客户机和 LDAP 客户机共享相同的命名服务数据，并使 <tt>rpc.nisd</tt> 自动保持 NIS+ 数据和 LDAP 数据的同步。NIS+ 最初可能是权威的命名服务，LDAP 服务器则维护 NIS+ 数据的副本以便于 LDAP 客户机使用。在适当的时候，可以使 LDAP 成为权威的命名服务，并逐步取消 NIS+ 服务，直到不再有 NIS+ 客户机。</p></li>
<li>

<p>已经使用了 LDAP 作为命名服务，因此您需要合并 NIS+ 数据和 LDAP 数据。有三种可能的方法来执行此合并。</p>
<ul><li>

<p><b>将 NIS+ 数据添加到 LDAP 中。</b>将 NIS+ 中存在而 LDAP 中不存在的项添加到 LDAP 中。NIS+ 和 LDAP 中均存在但所含数据不同的项最终将保留 NIS+ 数据。请参见<a href="#nisplus2ldap-proc-22">如何通过一步操作将所有的 NIS+ 数据转换为 LDAP</a>。</p></li>
<li>

<p><b>使用 LDAP 数据覆写 NIS+ 数据。</b>如果某些项在 NIS+ 中存在，而在 LDAP 中不存在，它们将从 NIS+ 中删除。对于在 NIS+ 和 LDAP 中均存在的项，将保留 LDAP 数据。请参见<a href="#nisplus2ldap-proc-25">如何通过一步操作将所有的 LDAP 数据转换为 NIS+</a>。</p></li>
<li>

<p><b>合并 NIS+ 数据和 LDAP 数据并逐一解决冲突。</b>请参见<a href="#nisplus2ldap-28">合并 NIS+ 数据和 LDAP 数据</a>。</p></li></ul>
</li></ul>






<a name="SYSADV5nisplus2ldap-proc-22"></a><a name="nisplus2ldap-proc-22"></a><h3 class="sgtasktitle3">如何通过一步操作将所有的 NIS+ 数据转换为 LDAP</h3>
<ul>
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-23"></a><a name="nisplus2ldap-step-23"></a><b>使用 <tt>rpc.nisd</tt> 上载 LDAP 中尚不存在的任何 NIS+ 数据。</b><p>使用以下命令（假设已在缺省位置 (<tt>/var/nis/NIS+LDAPmapping</tt>) 建立了所有 NIS+/LDAP 数据映射）：</p><pre># <b>/usr/sbin/rpc.nisd -D \</b> 
 <b>-x nisplusLDAPinitialUpdateAction=to_ldap \</b>
 <b>-x nisplusLDAPinitialUpdateOnly=yes</b></pre><p>以上命令会指示 <tt>rpc.nisd</tt> 将数据上载到 LDAP，然后退出。NIS+ 数据将不会受到此操作的影响。</p><p>请参见 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN4rpc.nisd-4"><tt>rpc.nisd</tt>(4)</a> 的 <tt>nisplusLDAPinitialUpdateAction</tt> 属性。</p></li></ul>





<a name="SYSADV5nisplus2ldap-proc-25"></a><a name="nisplus2ldap-proc-25"></a><h3 class="sgtasktitle3">如何通过一步操作将所有的 LDAP 数据转换为 NIS+</h3>
<ul>
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-26"></a><a name="nisplus2ldap-step-26"></a><b>使用 <tt>rpc.nisd</tt> 将所有的 LDAP 数据下载到 NIS+，覆写现有的 NIS+ 数据。</b><p>使用以下命令（假设已在缺省位置 (<tt>/var/nis/NIS+LDAPmapping</tt>) 建立了所有 NIS+/LDAP 数据映射）：</p><pre># <b>/usr/sbin/rpc.nisd -D \</b>
<b>-x nisplusLDAPinitialUpdateAction=from_ldap \</b>
<b>-x nisplusLDAPinitialUpdateOnly=yes</b></pre><p>以上命令会指示 <tt>rpc.nisd</tt> 守护进程从 LDAP 下载数据，然后退出。LDAP 数据将不会受到此操作的影响。</p><p>请参见 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN4rpc.nisd-4"><tt>rpc.nisd</tt>(4)</a> 的 <tt>nisplusLDAPinitialUpdateAction</tt> 属性。</p></li></ul>



<a name="SYSADV5nisplus2ldap-28"></a><a name="nisplus2ldap-28"></a><h3>合并 NIS+ 数据和 LDAP 数据</h3>


<p><a href="#nisplus2ldap-21">NIS+ 到 LDAP 迁移方案</a>说明了当应该让 NIS+ 数据或 LDAP 数据成为权威数据以解决 NIS+ 数据和 LDAP 数据之间的冲突时，如何对 NIS+ 数据和 LDAP
数据进行同步。合并数据需要更复杂的过程。</p>

<p>本节中的示例过程做出了以下假定：</p>
<ul><li>

<p>您将 NIS+ 数据的备份放在 <tt>/nisbackup</tt> 目录中。</p></li>
<li>

<p><tt>/etc/default/rpc.nisd</tt> 和 <tt>/var/nis/tmpmap</tt> 中已经存在有效的映射配置（对于应当合并的表）。</p></li>
<li>

<p>合并之前的 NIS+ 数据的平面文件形式存储在 <tt>/before</tt> 中，合并之后的平面文件形式存储在 <tt>/after</tt> 中。</p></li>
<li>

<p><tt>niscat</tt> 用于转储以平面文件形式表示的不受 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN1Mnisaddent-1m"><tt>nisaddent</tt>(1M)</a> 支持的定制 NIS+ 表。您可以使用自己的命令或脚本，从 NIS+ 装入这样的定制表或者将这些表转储到 NIS+ 中。如果是这样，这些命令/脚本应当优先于 <tt>niscat</tt> 使用，因为后者没有能够将数据方便地重新装入 NIS+ 的相应命令。</p>

<p>如果您不得不使用 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN1niscat-1"><tt>niscat</tt>(1)</a> 转储数据，可以使用 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN1nistbladm-1"><tt>nistbladm</tt>(1)</a> 将项逐个重新装入到 NIS+ 中。</p></li>
<li>

<p>您的命令路径中包括 <tt>/usr/lib/nis</tt>（这是 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN1Mnisaddent-1m"><tt>nisaddent</tt>(1M)</a> 所在的位置）。</p></li></ul>






<a name="SYSADV5nisplus2ldap-proc-29"></a><a name="nisplus2ldap-proc-29"></a><h3 class="sgtasktitle3">如何合并 NIS+ 数据和 LDAP 数据</h3>
<div clas="sgcaution">
<hr>
<table datatable="0" class="sgcautiontable"><tr><td><img border="0" src="graphics/caution.gif"alt="注意"title="注意"></td><td><p><b>注意 - </b>如果 LDAP 数据在步骤 4 的下载和步骤 10 的上载操作之间发生变化，则上载过程可能会覆写这些更改。因此，应当尽量避免在该过程期间修改 LDAP 数据。有关更多信息，请查阅 LDAP 服务器文档。</p>
</td></tr></table>
<hr></div>
<ol class="sgprocedure">
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-30"></a><a name="nisplus2ldap-step-30"></a><b>使用 <tt>nisbackup</tt> 命令备份所有的 NIS+ 数据。</b><pre># <b>nisbackup -a /nisbackup</b></pre></li>
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-31"></a><a name="nisplus2ldap-step-31"></a><b>标识那些包含必须与 LDAP 合并的数据的 NIS+ 表。将这些表的内容转储到平面文件中。例如，使用 <tt>nisaddent</tt>，按以下方式转储 <tt>group.org_dir</tt> 的内容：</b><pre># <b>nisaddent -d group | sort > /before/group</b></pre><p>将 <tt>nisaddent</tt> 输出传输到 <tt>sort</tt> 将便于稍后进行比较。</p></li>
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-33"></a><a name="nisplus2ldap-step-33"></a><b>将 LDAP 数据下载到 NIS+ 中。</b><pre># <b>/usr/sbin/rpc.nisd -D -m tmpmap \</b>
<b>-x nisplusLDAPinitialUpdateAction=from_ldap \</b>
<b>-x nisplusLDAPinitialUpdateOnly=yes</b></pre></li>
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-34"></a><a name="nisplus2ldap-step-34"></a><b>启动 NIS+ 服务。</b><pre># <b>svcadm enable network/rpc/nisplus:default</b></pre><p><tt>rpc.nisd</tt> 守护进程现在将为从 LDAP 下载的数据提供服务。如果要解决的冲突很严重，以至于不应让 NIS+ 客户机面对这种冲突，请确保在活动 NIS+ 客户机很少（最好没有）时执行此步骤和后面的几步。</p></li>
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-35"></a><a name="nisplus2ldap-step-35"></a><b>转储受影响的表中的 NIS+ 数据。</b><p>以下示例使用 <tt>group.org_dir</tt> 表。</p><pre># <b>nisaddent -d group | sort > /after/group</b></pre></li>
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-36"></a><a name="nisplus2ldap-step-36"></a><b>创建这些表的合并版本。</b><p>使用您选择的文件合并过程生成合并的表。如果没有其他工具可用，可以使用 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN1diff-1"><tt>diff</tt>(1)</a> 收集 <tt>/before</tt> 和 <tt>/after</tt> 文件之间存在差异的部分，然后用文本编辑器手动合并。</p><p>以下示例假定合并结果位于 <tt>/after</tt> 中。</p></li>
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-37"></a><a name="nisplus2ldap-step-37"></a><b>将合并后的数据装入到 NIS+ 中。以下示例使用 <tt>group</tt> 表。</b><pre># <b>nisaddent -m -f /after/group group</b></pre></li>
<li class="sgstep"><a name="SYSADV5nisplus2ldap-step-38"></a><a name="nisplus2ldap-step-38"></a><b>删除在合并之后不应当存在的 LDAP 项。</b><p>A. 如果某些 LDAP 项在（现在合并的）NIS+ 数据中不存在，但是在上载之后不应当在 LDAP 中存在，则必须删除这些 LDAP 项。</p><p>LDAP 服务器可能会提供一种用于删除多项的方便方法，如用于删除容器中所有项的方法。如果不属于这种情况，则可以使用<a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN1ldapsearch-1"><tt>ldapsearch</tt>(1)</a> 来为每个容器生成一系列项。例如，要生成 <tt>ou=Rpc</tt> 容器中所有项的列表，请按以下方式使用 <a href="http://www.oracle.com/pls/topic/lookup?ctx=E23823&id=REFMAN1ldapsearch-1"><tt>ldapsearch</tt>(1)</a>。</p><pre># <b>ldapsearch -h <var>server-address</var> -D <var>bind-DN</var> -w <var>password</var> \</b>
 <b>-b ou=Rpc,<var>search-base</var> 'objectClass=*' dn | \</b>
<b>grep -i ou=Rpc | grep -v -i \^ou=Rpc > /tmp/delete-dn</b></pre><p>有关元参数（例如，<var>server-address</var> 和 <var>bind-DN</var>）的说明，请参见<a href="nisplus2ldap-43.html#nisplus2ldap-48">性能和索引</a>。</p><p>B. 现在您可以编辑结果文件 (<tt>/tmp/delete-dn</tt>)，仅指定应当删除的项。或者，为了删除该容器中的所有项，可以按原样使用该文件，并依赖 NIS+ 上载功能恢复 LDAP 数据。无论使用哪种方法，都应当先备份 LDAP 数据，然后再执行下面的 <tt>ldapdelete</tt> 操作。</p><p>C. 使用 <tt>ldapdelete</tt> 删除 LDAP 项，将 <tt>stdout</tt>（通常是每个删除的项对应一个空行）重定向到 <tt>/dev/null</tt>。</p><pre># <b>ldapdelete</b> <tt>-h</tt> <b><var>server-address</var></b> <tt>-D</tt> <b><var>bind-DN</var></b> <tt>-w</tt> <b><var>password</var> \</b>
<b></b><tt>/tmp/delete-dn</tt> <b>/dev/null</b></pre><p>D. 对每个包含至少一个必删项的容器，重复上述过程。</p></li></ol>
</div>

<div class="BottomPageControlPane">
	<table class="pagecontrol">
		<tr>
			<td>
				<div class="pagefooterlinks">
					版权所有 &#169; 2002, 2010, Oracle 和/或其附属公司。 保留所有权利。 <a href="docinfo.html#scrolltoc">法律声明</a>
				</div>
			</td>
			<td class="pagenavlinks">
				<a href="nisplus2ldap-2.html#scrolltoc"><img src="graphics/leftButton.png" border="0" alt="上一页" title="上一页"></a>
				<a href="nisplus2ldap-41.html#scrolltoc"><img src="graphics/rightButton.png" border="0" alt="下一页" title="下一页"></a>
			</td>
		</tr>
	</table>
	
</div>






</body>
</html>

