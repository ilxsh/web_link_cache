<!DOCTYPE html><html><head><meta charSet="UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><title>Centos7.2下针对LDAP的完整部署记录 - 云+社区 - 腾讯云</title><meta name="keywords" content="数据处理,Linux,CentOS"/><meta name="description" content="LDAP中，将数据组织成一个树形结构，这与现实生活中的很多数据结构可以对应起来，而不像设计关系型数据库的表，需要进行多种变化。可通过程序代码向目录数据库中添加数据，也可使用OpenLDAP客户端工具ldapadd命令来完成添加数据的操作，该命令可将一个LDIF文件中的条目添加到目录。以上输入内容中，第1行查找需要修改的条目，第2行设置修改模式，第3行设置需要替换的属性sn，第4行给属性sn重新设置一个值，替换该属性原有的值。"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover"/><meta name="format-detection" content="telephone=no"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/portal/css/global-20199171625.css?max_age=31536000"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/community-pc/build/AskDialog/AskDialog-201906131103.css"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/community-pc/build/base/base-20199161611.css?max_age=31536000"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/community-pc/build/Column/Column-20199161611.css?max_age=31536000"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/portal/css/markdown-201810241044.css?max_age=31536000"/><link rel="stylesheet" href="//imgcache.qq.com/qcloud/draft-master/dist/draft-master-v1.3.33.css?max_age=31536000"/><style media="screen">@supports (padding:max(0px)){.set-safe-area .com-main{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-main-simple-sec{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-main-sec{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-m-footer{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-mobile-body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}}@supports (padding:max(0px)){.set-safe-area .support-wrap,.set-safe-area div.body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-responsive-no-ft div.body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}}</style></head><body><div id="react-root"><div class=""><div class="J-header c-nav-wrap c-nav com-2-nav"><div class="c-nav-mod c-nav-mod-pc c-nav-white"><div id="qcTopNavFstLevel" class="J-headerTop c-nav-top" data-nosearch="1" data-nolang="1"><a href="javascript:;" id="qcLeftNavSwitcher" class="c-nav-all-trigger" role="button" hotrep="community.header.trigger"><i class="c-nav-all-trigger-icon"></i><span class="c-nav-all-trigger-text" role="button">菜单</span></a><i class="c-nav-top-divider"></i><a href="/" class="c-nav-bg-logo" hotrep="community.header.cloud_portal"><i>腾讯云</i></a><div class="c-nav-top-operation"><div class="c-nav-top-ctrl"><div class="c-nav-top-links"><a href="/product/ba" class="link-item" hotrep="community.header.ba">备案</a><a href="https://console.cloud.tencent.com" class="link-item" role="button" hotrep="community.header.console">控制台</a></div></div></div></div><div class="J-headerBottom c-nav-bottom responsive"><a href="/developer" class="c-nav-project-logo" hotrep="community.header.logo.community"><i class="c-nav-project-bg-logo">云+社区</i></a><div class="c-nav-bm-categories"><ul class="c-nav-list"><li class="presentation curr"><a href="/developer/column" role="button" hotrep="community.header.nav.column">专栏</a></li><li class="presentation"><a href="/developer/ask" role="button" hotrep="community.header.nav.ask">问答</a></li><li class="presentation"><a href="/developer/salon" role="button" hotrep="community.header.nav.salon">沙龙</a></li><li class="presentation"><a href="/developer/news" role="button" hotrep="community.header.nav.news">快讯</a></li><li class="presentation"><a href="/developer/teams" role="button" hotrep="community.header.nav.teams">团队主页</a></li><li class="presentation"><a href="/developer/devdocs" role="button" hotrep="community.header.nav.devdocs">开发者手册</a></li><li class="presentation"><a href="/developer/timl" role="button" hotrep="community.header.nav.timl">智能钛AI</a></li><li class="presentation split-item"></li><li class="presentation"><a href="/edu/learning?ADTAG=sq.bar" target="_blank" role="button" hotrep="community.header.nav.edu">在线学习中心</a></li><li class="presentation"><a href="/tvp" target="_blank" role="button" hotrep="community.header.nav.tvp">TVP</a></li></ul></div><div class="J-headerBottomRight c-nav-bm-right"><div class="c-nav-bm-search-wrap"><a href="javascript:;" class="c-nav-bm-search-btn" role="button" hotrep="community.header.opensearch.search_icon"><i class="nav-search-icon"></i> 搜索</a><div class="c-nav-bm-search search-icon-rt" role="button" hotrep="community.header.opensearch.search_bar"><input type="text" placeholder="找文章 / 找答案 / 找技术大牛" readonly="" style="cursor:pointer"/><i class="nav-search-icon"></i></div><div class="com-3-nav-search-wrap"><div class="com-search-bar"><label class="com-search"><input type="text" class="search-input" value="" placeholder="找文章 / 找答案 / 找技术大牛" autoComplete="off"/><button type="submit" class="search-btn" hotrep="community.header.search.search_btn">搜索</button><button type="button" class="close-btn" hotrep="community.header.search.close_btn">关闭</button></label></div></div></div><div class="c-nav-bm-btns"><a href="javascript:;" class="c-btn c-nav-bm-btn" hotrep="community.header.bm_btns.write_article">写文章</a><a href="javascript:;" class="c-btn c-nav-bm-btn-hole" hotrep="community.header.bm_btns.ask">提问</a></div><div class="c-nav-bm-text-btns"><a href="javascript:;" class="c-nav-bm-text-btn" hotrep="community.header.login">登录</a><i class="c-nav-divider-dot"></i><a href="/register" target="_blank" class="c-nav-bm-text-btn" hotrep="community.header.register">注册</a></div></div><div class="c-nav-pro-mask" style="display:none"></div></div></div></div><div class="com-header subsite"><div class="header-main"><a href="javascript:;" class="header-menu-trigger" hotrep="community.header.menu_trigger">展开</a><h1 class="header-main-title"></h1></div><div class="header-logo-wrap"><div class="header-logo"><i class="logo-icon logo-community"></i><h1 class="header-title">腾讯云·社区</h1></div></div><nav class="header-extra"><a href="/developer/search" class="header-extra-icon search-entry" hotrep="community.header.search_btn"></a><a href="javascript:;" hotrep="community.header.login">登录</a></nav></div><div class="com-m-side-mask hidden"></div><section class="com-m-side com-2-m-side hidden"><header class="com-m-side-hd"><div class="header-logo-wrap"><a href="/developer" class="header-logo" hotrep="community.header.drawer.home"><i class="logo-icon logo-community"></i><h1 class="header-title">云+社区</h1></a></div><div class="com-m-side-hd-extra"><a href="javascript:;" class="com-m-side-link only-icon"><div class="icon-back"></div></a></div></header><div class="com-m-side-bd"><ul class="com-m-side-nav"><li class="com-m-side-nav-item"><a href="/developer" class="com-m-side-nav-link"><i class="icon-home"></i>首页</a></li><li class="com-m-side-nav-item"><a href="/developer/column" class="com-m-side-nav-link"><i class="icon-column"></i>专栏</a></li><li class="com-m-side-nav-item"><a href="/developer/ask" class="com-m-side-nav-link"><i class="icon-ask"></i>问答</a></li><li class="com-m-side-nav-item"><a href="/developer/salon" class="com-m-side-nav-link"><i class="icon-salon"></i>沙龙</a></li><li class="com-m-side-nav-item"><a href="/developer/news" class="com-m-side-nav-link"><i class="icon-news"></i>快讯</a></li><li class="com-m-side-nav-item"><a href="/developer/teams" class="com-m-side-nav-link"><i class="icon-nonstop"></i>团队主页</a></li><li class="com-m-side-nav-item"><a href="/developer/devdocs" class="com-m-side-nav-link"><i class="icon-devdoc"></i>开发者手册</a></li><li class="com-m-side-nav-item"><a href="/developer/timl" class="com-m-side-nav-link"><i class="icon-ai"></i>智能钛AI</a></li><li class="com-m-side-nav-item split"></li><li class="com-m-side-nav-item"><a href="/edu/learning?ADTAG=sq.sidebar" class="com-m-side-nav-link"><i class="icon-college"></i>在线学习中心</a></li><li class="com-m-side-nav-item"><a href="/tvp" class="com-m-side-nav-link"><i class="icon-tvp"></i>TVP</a></li></ul><div class="com-m-side-idx-link-wrap"><a href="/" class="com-m-side-idx-link">返回腾讯云官网</a></div></div></section><div class="J-body col-body pg-article"><div class="com-sticky-header col-sticky-header hidden"><div class="com-inner"><div class="com-sticky-header-main"><h2 title="Centos7.2下针对LDAP的完整部署记录" class="com-sticky-header-title">Centos7.2下针对LDAP的完整部署记录</h2></div><div class="com-sticky-header-extra"><a href="javascript:;" class="c-btn" hotrep="community.article-detail.sticky-bar.write_article">写文章</a></div></div></div><h1 class="col-article-title J-articleTitle">Centos7.2下针对LDAP的完整部署记录</h1><div class="col-article-author"><a href="/developer/user/1207996" class="col-avatar author-avatar" style="background-image:url(https://ask.qcloudimg.com/avatar/1207996/pdrwwi0a37.png?imageView2/2/w/72)"></a><a href="/developer/user/1207996" class="author-name">用户1207996</a><span>发表于</span><span class="column-wrap"><a href="/developer/column/1819" class="column-name">散尽浮华</a></span><div class="extra-part"><div class="com-operations"><span class="com-opt-link dark" title="浏览次数"><i class="com-i-view"></i><span class="text">6.6K</span></span></div></div></div><section class="col-article"><div class="c-markdown J-articleContent"><p><strong>一、LDAP究竟是什么？</strong>
LDAP是轻量目录访问协议，英文全称是Lightweight Directory Access Protocol，一般都简称为LDAP。它是基于X.500标准的，但是简单多了并且可以根据需要定制。与X.500不同，LDAP支持TCP/IP，这对访问Internet是必须的。LDAP的核心规范在RFC中都有定义，所有与LDAP相关的RFC都可以在LDAPman RFC网页中找到。简单说来，LDAP是一个得到关于人或者资源的集中、静态数据的快速方式。 LDAP是一个用来发布目录信息到许多不同资源的协议。通常它都作为一个集中的地址本使用，不过根据组织者的需要，它可以做得更加强大。</p><p>现在市场上有关LDAP的产品已有很多，各大软件公司都在他们的产品中集成了LDAP服务，如Microsoft的ActiveDirectory、Lotus的Domino Directory、IBM的WebSphere中也集成了LDAP服务。<strong>LDAP的开源实现是OpenLDAP</strong>，它比商业产品一点也不差，而且源码开放。</p><p>OpenLDAP 是最常用的目录服务之一，它是一个由开源社区及志愿者开发和管理的一个开源项目，提供了目录服务的所有功能，包括目录搜索、身份认证、安全通道、过滤器等等。大多数的 Linux 发行版里面都带有 OpenLDAP 的安装包。OpenLDAP 服务默认使用非加密的 TCP/IP 协议来接收服务的请求，并将查询结果传回到客户端。由于大多数目录服务都是用于系统的安全认证部分比如：用户登录和身份验证，所以它也支持使用基于 SSL/TLS 的加密协议来保证数据传送的保密性和完整性。OpenLDAP 是使用 OpenSSL 来实现 SSL/TLS 加密通信的。 </p><p><strong>1.1   LDAP协议简单介绍</strong>
目录是一组具有类似属性、以一定逻辑和层次组合的信息。常见的例子是通讯簿，由以字母顺序排列的名字、地址和电话号码组成。
目录服务是一种在分布式环境中发现目标的方法。目录具有两个主要组成部分：
 第一部分是数据库，数据库是分布式的，且拥有一个描述数据的规划。
第二部分则是访问和处理数据的各种协议。</p><p>录服务其实也是一种数据库系统，只是这种数据库是一种树形结构，而不是通常使用的关系数据库。目录服务与关系数据库之间的主要区别在于：二者都允许对存储数据进行访问，只是目录主要用于读取，其查询的效率很高，而关系数据库则是为读写而设计的。
<strong>温馨提示：目录服务不适于进行频繁的更新，属于典型的分布式结构。</strong> 
LDAP是一个目录服务协议，目前存在众多版本的LDAP，而最常见的则是V2和V3两个版本，它们分别于1995年和1997年首次发布。</p><p><strong>1.2   LDAP的基本模型</strong>
LDAP的基本模型是建立在&quot;条目&quot;（Entry）的基础上。一个条目是一个或多个属性的集合，并且具有一个全局唯一的&quot;可区分名称&quot;（用dn表示）。与关系型数据（后面简称数据库）进行类比，一个条目相当于数据库中的一条记录，而dn相当于数据库中记录的关键字，属性相当于数据库中的字段。
<strong>温馨提示：dn必须是全局唯一的。</strong> 
LDAP中，将数据组织成一个树形结构，这与现实生活中的很多数据结构可以对应起来，而不像设计关系型数据库的表，需要进行多种变化。如下图所展示的就是一个树形结构的数据。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="https://ask.qcloudimg.com/http-save/yehe-1207996/aa6r5dk1mg.jpeg"></span></div></figure><p>在上图所示的树形结构中，树的根结点是一个组织的域名（dlw.com），其下分为3个部分，分别是managers、people和group，可将这3个组看作组织中的3个部门：如managers用来管理所有管理人员，people用来管理登录系统的用户，group用来管理系统中的用户组。当然，在该图中还可继续增加其他分支。
对于图中所示的树形结构，使用关系数据库来保存数据的话，需要设置多个表，一层一层分别保存，当需要查找某个信息时，再逐层进行查询，最终得到结果。
若使用目录来保存该图中的数据，则更直观。图中每个结点用一个条目来保存，不同类型的结点需要保存的数据可能不同，在LDAP中通过一个称为objectClass的类型来控制不同结点需要的数据（称为属性）。</p><p>对于目录中的数据怎样进行引用呢？前面提到过，每一个条目都有一个dn，因为dn是唯一的，因此就可找到需要结点的数据。dn的构造方式如下：
首先得到条目自己的名称（rdn，称为相对dn），然后开始向上逐级查找父结点，一直到根项为止。例如，对于图1-1中最右下方的结点，其dn为：</p><pre class="prism-token token language-javascript">dn: cn=ldap, ou=group, o=dlw.com </pre><p>通过这样的方式，即可唯一标识每一个结点。在现实生活中，有很多这种树形结构的数据，如计算机文件系统的目录结构、Internet中的域名等。这些类型的数据，只要不需要频繁的更新，都适合用目录来保存。</p><p><strong>LDAP主要的简称含义：</strong>
<strong>o</strong>-&gt;   organization（组织-公司）
<strong>ou</strong>-&gt; organization unit（组织单元-部门）
<strong>c</strong>-&gt;   countryName（国家）
<strong>dc</strong>-&gt; domainComponent（域名）
<strong>sn</strong>-&gt;  suer name（真实名称）
<strong>cn</strong>-&gt; common name（常用名称）</p><p><strong>1.3   LDAP的功能</strong>
在LDAP的功能模型中定义了一系列利用LDAP协议的操作，主要包含以下4部分：
<strong>查询操作</strong>：允许查询目录和取得数据，其查询性能比关系数据库好。
<strong>更新操作</strong>：目录的更新操作没关系数据库方便，更新性能较差，但也同样允许进行添加、删除、修改等操作。
<strong>复制操作</strong>：前面也提到过，LDAP是一种典型的分布式结构，提供复制操作，可将主服务器的数据的更新复制到设置的从服务器中。
<strong>认证和管理操作</strong>：允许客户端在目录中识别自己，并且能够控制一个会话的性质。</p><p><strong>1.4   LDAP协议的特点</strong>
LDAP是一种目录服务，保存在特殊的数据库中，数据的读取速度远高于写入速度。
LDAP对查询做了优化，读取速度优于普通关系数据库。
LDAP不支持事务、不能进行回滚，需要进行这些操作的应用只有选择关系数据库。
LDAP采用服务器/客户端模式，支持分布式结构。
LDAP中的条目以树形结构组织和存储。
LDAP基于Internet协议，直接运行在简单和通用的TCP/IP或其他可靠的传输协议层上，使连接的建立和包的处理简单、快捷，对于互联网和企业网应用都很方便。
LDAP协议简单，通过使用查找操作实现列表操作和读操作。
LDAP通过引用机制实现分布式访问，通过客户端API实现分布式操作（对于应用透明），平衡了负载。
LDAP实现具有低费用、易配置和易管理的特点，并提供了满足应用程序对目录服务所需求的特性。</p><p><strong>二、管理LDAP</strong></p><p>启动OpenLDAP服务器程序之后，接下来的操作就是通过客户端程序对目录进行操作，包括添加、修改、删除和搜索数据等操作。</p><p><strong>2.1   了解schema</strong>
对于LDAP目录中保存的信息，可以使用LDIF（LDAP Interchange Format）格式来保存。这是一种标准文本文件格式，使用这种格式保存得的LDAP服务器数据库中的数据可方便读取和修改，这也是其他大多数服务配置文件所采取的格式。</p><p>LDIF文件常用来向目录导入或更改记录信息，这些信息需要按照LDAP中schema的格式进行组织，并会接受schema的检查，不符合其要求的格式将会出现报错信息。有关LDIF文件的格式和创建将在第4章进行介绍，这里简单介绍一下组织LDAP数据格式的schema文件。</p><p>在LDAP中，schema用来指定一个目录中所包含的对象（objects）的类型（objectClass），以及每一个类型（objectClass）中必须提供的属性（Atrribute）和可选的属性。可将schema理解为面向对象程序设计中的类，通过类定义一个具体的对象。LDIF中的数据条目可理解为是一个具体的对象，是通过schema来规划创建的。因此，schema是一个数据模型，用来决定数据按什么方式存储，并定义存储在不同的条目（Entry）下的数据之间的关系。schema需要在主配置文件slapd.conf中指定，以用来决定在目录中可以使用哪些objectClass。</p><p>在/etc/openldap/schema/目录中提供了许多schema文件，只需要在配置文件slapd.conf中使用include命令将需要使用的schema包含即可。例如，配置文件默认包含了以下schema文件：</p><pre class="prism-token token language-javascript">include /etc/openldap/schema/core.schema
include /etc/openldap/schema/cosine.schema
include /etc/openldap/schema/inetorgperson.schema
include /etc/openldap/schema/nis.schema</pre><p><strong>温馨提示：通常使用系统提供的schema就可解决大部分应用。管理员也可以自己设计制定schema，一般包括属性定义（AttributeDefinition）、类定义（ClassDefinition）以及语法定义（SyntaxDefinition）等部分。这里就不介绍具体的设计方法了。</strong></p><p><strong>2.2   向目录数据库中添加数据</strong>
初始状态下，LDAP是一个空目录，即没有任何数据。可通过程序代码向目录数据库中添加数据，也可使用OpenLDAP客户端工具ldapadd命令来完成添加数据的操作，该命令可将一个LDIF文件中的条目添加到目录。因此，需要首先创建一个LDIF文件，然后再进行添加操作。
1）LDIF文本条目格式
LDIF用文本格式表示目录数据库的信息，以方便用户创建、阅读和修改。在LDIF文件中，一个条目的基本格式如下：</p><pre class="prism-token token language-javascript"># 注释
dn: 条目名
属性描述: 值
属性描述: 值
属性描述: 值
... ...</pre><p>dn行类似于关系数据库中一条记录的关键字，不能与其他dn重复。一个LDIF文件中可以包含多个条目，每个条目之间用一个空行分隔。
例如，以下内容组成一个条目：</p><pre class="prism-token token language-javascript">1: dn: dc=dlw, dc=com
2: objectclass: top
3: objectclass: dcobject
4: objectclass: organization
5: dc: dlw
6: o: dlw,Inc.</pre><p>在以上文本中，各行含义如下：
第1行的dn定义该条目的标识。
第2～4行定义该条目的objectcCass，可以定义多个属性，如上面代码中定义了3个objectClass。条目的属性根据objectClass的不同而不同，有的objectClass有必须设置的属性。在2～4行的3个objectClass中，top没有必须定义的属性，dcobject必须定义属性dc，用来表示一个域名的部分，而organization必须定义属性o，用来表示一个组织的名称。
根据objectClass的要求，第5、6行分别定义属性dc和属性o的值。</p><p><strong>2.3   了解objectClass</strong>
LDAP中，一个条目必须包含一个objectClass属性，且需要赋予至少一个值。每一个值将用作一条LDAP条目进行数据存储的模板；模板中包含了一个条目必须被赋值的属性和可选的属性。
objectClass有着严格的等级之分，最顶层是top和alias。例如，organizationalPerson这个objectClass就隶属于person，而person又隶属于top。
objectClass可分为以下3类：
结构型（Structural）：如person和organizationUnit；
辅助型（Auxiliary）：如extensibeObject；
抽象型（Abstract）：如top，抽象型的objectClass不能直接使用。
在OpenLDAP的schema中定义了很多objectClass，下面列出部分常用的objectClass的名称。
  ● account
  ● alias
  ● dcobject
  ● domain
  ● ipHost
  ● organization
  ● organizationalRole
  ● organizationalUnit
  ● person
  ● organizationalPerson
  ● inetOrgPerson
  ● residentialPerson
  ● posixAccount
  ● posixGroup</p><p><strong>2.4   了解Attribute</strong>
属性（Attribute）类似于程序设计中的变量，可以被赋值。在OpenLDAP中声明了许多常用的Attribute（用户也可自己定义Attribute）。常见的Attribute含义如下：
● c：国家。
● cn：common name，指一个对象的名字。如果指人，需要使用其全名。
● dc：domain Component，常用来指一个域名的一部分。
● givenName：指一个人的名字，不能用来指姓。
● l：指一个地名，如一个城市或者其他地理区域的名字。
● mail：电子信箱地址。
● o：organizationName，指一个组织的名字。
● ou：organizationalUnitName，指一个组织单元的名字。
● sn：surname，指一个人的姓。
● telephoneNumber：电话号码，应该带有所在的国家的代码。
● uid：userid，通常指某个用户的登录名，与Linux系统中用户的uid不同。</p><p><strong>温馨提示：objectClass是一种特殊的Attribute，它包含其他用到的Attribute以及其自身。</strong></p><p>对于不同的objectClass，通常具有一些必设属性值和一些可选属性值。例如，可使用person这个objectClass来表示系统中一个用户的条目，对于系统中用户通常需要有这样一些信息：姓名、电话、密码、描述等。如下图所示，对于person，通过cn和sn设置用户的名和姓，这是必须设置的，而其他属性则是可选的。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="https://ask.qcloudimg.com/http-save/yehe-1207996/iv5emkl401.jpeg"></span></div></figure><p>下面列出部分常用objectClass要求必设的属性。
● account：userid。
● organization：o。
● person：cn和sn。
● organizationalPerson：与person相同。
● organizationalRole：cn。
● organizationUnit：ou。
● posixGroup：cn、gidNumber。
● posixAccount：cn、gidNumber、homeDirectory、uid、uidNumber。</p><p><strong>2.5   创建LDIF文件</strong>
对以上内容有一定了解之后，就可以编写输入LDIF文件，编辑需要向目录数据库添加的条目了。
下面根据如下图所示的结构，创建LDIF文件dlw.com.ldif。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="https://ask.qcloudimg.com/http-save/yehe-1207996/lz1nhbmttg.jpeg"></span></div></figure><p>对上图进行分析，该目录结构分为3层，有4个结点。根据上图可创建LDIF文件如下：
<strong>温馨提示：每个结点可用一个dn表示，对于每个结点，又可继续添加新的结点。如在根结点中可添加其他部门ou，在ou=managers结点也可继续添加其他管理人员的信息。</strong></p><pre class="prism-token token language-javascript">1: dn:dc=dlw,dc=com
2: objectclass:top
3: objectclass:dcobject
4: objectclass:organization
5: dc:dlw
6: o:dlw,Inc.
7: 
8: dn:ou=managers, dc=dlw, dc=com
9: ou:managers
10: objectclass:organizationalUnit
11:
12: dn:cn=dlw,ou=managers,dc=dlw,dc=com
13: cn:dlw
14: sn:dongliwei
15: objectclass:person
16: 
17: dn:cn=test,ou=managers,dc=dlw,dc=com
18: cn:test
19: sn:Test User
20: objectclass:person</pre><p>以上文件中各行的含义如下：
第1～6行创建根结点，这部分在前面也有介绍，就不再重复了。
第7、11、16行为空行，用来分隔4个dn条目（4个结点）。
第8～10行定义cn=managers结点的条目，该条目的objectClass为organizationalUnit，因此需要用ou属性定义组织名称。
第12～15行定义cn=dlw结点的条目，该条目使用的objectClass为person，因此需设置cn和sn两个属性值。
第17～20行与第12～15行的意义相同。</p><p>在以上LDIF文件中，第1、8、12、17行以dn开头，这部分内容必须唯一，并且在向目录数据库添加这些数据时，也要确保这些数据不能与目录数据库中已有数据相同，否则，添加操作将中断。</p><p><strong>2.6   从LDIF文件添加到目录数据库</strong>
使用OpenLDAP客户端工具ldapadd命令，可将LDIF文件中的条目添加到目录数据库中，该命令的格式如下：
# ldappadd  选项  LDIF文件 </p><p>在ldappadd命令中常用的选项如下：
<strong>-x</strong>：进行简单认证。
<strong>-D</strong>：用来绑定服务器的dn。
<strong>-h</strong>：目录服务的地址。
<strong>-w</strong>：绑定dn的密码。
<strong>-f</strong>：使用LDIF文件进行条目添加的文件。</p><p>将前面编写的LDIF文件的条目数据添加到目录数据库中。
具体操作步骤如下：
1）检查dlw.com.ldif文件中的内容，需要注意的是，每个冒号后面都需要空一格，而每行结束处不能留有空格字符。 
2）使用以下命令将dlw.com.ldif文件中的条目添加到目录中：</p><pre class="prism-token token language-javascript"># ldapadd -x -D &quot;cn=root,dc=dlw,dc=com&quot; -w secret -f dlw.com.ldif</pre><p><strong>温馨提示：如果以上命令执行不成功，需要逐个字符检查dlw.com.ldif文件中的内容，特别注意空格的问题。</strong></p><p><strong>2.7   查询</strong>
添加到目录中的条目被保存在目录数据库，在Linux命令界面下，可使用OpenLDAP客户端工具ldapsearch命令来进行查询。该命令的格式如下：
# ldapsearch  选项  过滤  属性值</p><p>常用的选项有以下几个:
<strong>-x</strong>：进行简单认证。
<strong>-D</strong>：用来绑定服务器的dn。
<strong>-w</strong>：绑定dn的密码。
<strong>-b</strong>：指定要查询的根节点。
<strong>-H</strong>：制定要查询的服务器。</p><p>使用ldapsearch命令查询“dc=dlw, dc=com”下的所有条目，可使用以下命令：</p><pre class="prism-token token language-javascript"># ldapsearch -x -b &quot;dc=dlw,dc=com&quot;  </pre><p>而如果使用以下命令，将查询显示sn中以字符wu开头的条目，将得到如下图所示的查询结果，只找到一个条目。</p><pre class="prism-token token language-javascript"># ldapsearch -x -b &#x27;dc=dlw,dc=com&#x27; &#x27;sn=wu*&#x27;  </pre><p><strong>2.8   修改条目</strong>
使用OpenLDAP客户端工具ldapmodify命令可对目录数据库中的条目进行修改。该命令的格式如下：
# ldapmodify  选项</p><p>该命令的选项也很多，常用选项与ldapadd类似，这里就不再列出了。
<strong>温馨提示：使用ldapmodify命令不能修改条目的dn，但可以修改其他属性值。</strong>
使用ldapmodify命令修改条目信息可以有两种方式：一种是交互式进行修改，另一种是通过文件进行修改。</p><p>1) 交互式修改
修改前面创建的条目&quot;cn=test, ou=managers, dc=dlw, dc=com&quot;，将其sn属性修改为&quot;Test User Modify&quot;，并添加一个description属性，设置其值为&quot;add Attribute&quot;。
首先输入以下命令，进行修改状态：</p><pre class="prism-token token language-javascript"># ldapmodify -x -D &quot;cn=root,dc=dlw,dc=com&quot; -W secret  </pre><p>执行以上命令后，终端将等候用户输入需要修改条目的dn，输入以下内容：</p><pre class="prism-token token language-javascript">dn: cn=test, ou=managers, dc=dlw, dc=com  
changetype: modify  
replace: sn  
sn: Test User Modify</pre><p>以上输入内容中，第1行查找需要修改的条目，第2行设置修改模式，第3行设置需要替换的属性sn，第4行给属性sn重新设置一个值，替换该属性原有的值。
输入完以上内容之后再按Enter键，程序将按以上设置更新数据，然后按Ctrl+C键退出修改命令。</p><p>使用以上命令修改条目的数据之后，可使用以下命令查看是否修改成功：</p><pre class="prism-token token language-javascript"># ldapsearch -x -b &#x27;dc=dlw,dc=com&#x27; &#x27;cn=test&#x27;</pre><p>2) 通过文件修改
通过前面的方式对条目进行修改时，很不方便，如果在交互方式时输错了某个字符，只能中断命令后重新进行修改。因此，更好的修改方法是首先将修改时输入的文字保存到一个文件中，然后以该文件作为输入进行修改。用这种方式进行操作，首先需要创建一个临时文件，用来保存需要进行的修改操作，下面演示这种方式的修改过程。</p><p><strong>【例子】通过修改命令将前面LDAP数据库中的信息还原，即将sn属性由“Test User Modify”修改为“Test User”</strong>。
具体操作步骤如下：
[1]  使用vi编辑器创建一个文件modify，在其中输入以下内容：</p><pre class="prism-token token language-javascript">dn: cn=test,ou=managers,dc=dlw,dc=com  
changetype: modify  
replace: sn  
sn: Test User</pre><p>从以上输入内容可看到，与在交互式时输入的内容完全相同。
技巧：使用文件方式修改条目，可方便修改和检查，若某个地方有输入错误，可修改后再调用ldapmodify进行修改，减少输入量。</p><p>[2] 使用以下命令调用modify的内容进行修改：</p><pre class="prism-token token language-javascript"># ldapmodify -x -D &quot;cn=root,dc=dlw,dc=com&quot; -w secret -f modify  </pre><p><strong>2.9   删除条目</strong>
对于目录数据库中不用的条目，也可使用ldapdelete命令将其删除。该命令的格式如下：
# ldapdelete  选项  删除条目</p><p>该命令使用的选项与ldapadd类似，就不再列出来了。
删除目录数据库中的“cn=test,ou=managers,dc=dlw,dc=com”条目，具体命令如下：</p><pre class="prism-token token language-javascript"># ldapdelete -x -D &quot;cn=root,dc=dlw,dc=com&quot; -w secret &quot;cn=test,ou=managers,dc=dlw,dc=com&quot;  </pre><p>顺利执行以上命令后，终端上将不会有任何信息输出，表示完成了删除操作。
使用ldapdelete命令只能删除树形结构中的叶结点条目，如果删除非叶结点条目，将出现错误提示。例如，执行以下命令删除根结点“dc=dlw,dc=com”，由于根结点下面还有结点，将显示如下图所示的错误提示信息：</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="https://ask.qcloudimg.com/http-save/yehe-1207996/74yac0ap70.jpeg"></span></div></figure><p>应该使用命令：</p><pre class="prism-token token language-javascript"># ldapdelete -x -D &quot;cn=root,dc=dlw,dc=com&quot; -w secret &quot;dc=dlw,dc=com&quot;  </pre><p><strong>2.10   数据导出</strong>
通过ldapadd命令可向目录数据库中添加数据，在某些情况下，可能还需要进行反向操作，即将目录数据库中的数据导出。
使用ldapsearch命令对目录数据库进行搜索，然后通过重定向将搜索结果保存到一个文件中，可达到导出数据的目的。另外，导出数据更常用的是slapcat命令，该命令的格式如下：
# slapcat  选项</p><p><strong>最常用的选项就是-l，表示导出为LDIF文件格式</strong>。
如将前面例子中创建的目录数据库导出为export.ldif文件，可使用以下命令：</p><pre class="prism-token token language-javascript"># slapcat -l export.ldif </pre><p><strong>温馨提示：从导出结果可看出，除了使用ldapadd命令添加到目录数据库中的条目数据外，还导出了很多其他信息，包括条目录UUID、时间戳等信息。</strong></p><p><strong>2.11   设置主从LDAP服务器</strong>
在某些时候，为了对LDAP服务器进行负载均衡，可能希望设置多台LDAP服务器。对于设置多台LDAP服务器的关键问题是数据的同步问题，使用slurpd进程可进行主LDAP服务器向从LDAP服务器复制数据的操作。下面将介绍架设主从LDAP服务器的过程</p><p><strong>2.12   多台LDAP服务器工作过程</strong>
对于多台LDAP服务器，可设置一台为主服务器，其他的为从服务器。本节介绍一台从服务器的配置，若是多台从服务器也可按此步骤进行操作。
注意：在进行配置之前应首先确保每个LDAP服务器都已安装好OpenLDAP服务器程序，并能正确工作。 </p><p>配置好主从LDAP服务器之后，在主服务器运行slurpd进程，该进程使用LDAP协议从主服务器的数据库更新从服务器的数据，具体操作过程如下：
1）LDAP客户端向从服务器提交一个LDAP修改请求。
2）从服务器给LDAP客户端返回一个指向主服务器的引用。
3）LDAP客户端向主服务器提交LDAP修改请求。
4）主服务器对数据库中的数据进行修改，并将改变写入本机的日志文件。
5）在主服务器运行的slurpd进程检查到日志中有新内容，通过日志的信息将改变发送给从服务器。
6）从服务器接收slurpd发来的信息，对本地数据进行修改。</p><p>以上过程就是使用slurpd进程进行数据复制的过程。从以上过程可看出，需要在主服务器的配置文件中设置要向哪些从服务器发送复制信息、主服务器还要设置一个记录数据改变的日志文件，而从服务器需要设置一个指向主服务器的链接。</p><p><strong>2.13   复制数据库</strong>
首先，把主从服务器关闭。然后通过以下三步操作静态同步主从服务器上的数据：
把主服务器上/var/lib/ldap目录下的所有数据库文件全部拷贝到从服务器的同目录中，覆盖原有文件。
把主服务器上的/etc/ldap/schema目录下的所有schema文件拷贝到从服务器的同目录中，覆盖原有文件。
把主服务器上/etc/ldap/slapd.conf文件拷贝到从服务器的同目录中，覆盖原有文件。</p><p><strong>三、Centos7下完整部署LDAP的操作记录</strong></p><p><strong>3.1   服务器环境介绍</strong>
Centos7.2系统，64 bit,下面的操作都是在root账号下执行的（下面OpenLDAP部署机test-vm002的ip地址是172.16.220.133）</p><p><strong>3.2  OpenLDAP服务部署过程</strong></p><p>1) 安装ldap服务 </p><pre class="prism-token token language-javascript">[root@test-vm002 ～]# vim /root/ldap_install.sh 
#!/bin/bash
echo &quot;install ldap rpm&quot;
wget http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
rpm -ivh epel-release-latest-7.noarch.rpm
yum install -y openldap openldap-clients openldap-servers migrationtools openldap-devel compat-openldap
cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG
chown ldap. /var/lib/ldap/DB_CONFIG
systemctl start slapd
systemctl enable slapd

[root@test-vm002 ～]# sh -x ldap_install.sh </pre><p>默认情况下，slapd服务监听的是389端口</p><pre class="prism-token token language-javascript">[root@test-vm002 ～]# lsof -i:389
COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
slapd   2940 ldap    8u  IPv4  23618      0t0  TCP *:ldap (LISTEN)
slapd   2940 ldap    9u  IPv6  23619      0t0  TCP *:ldap (LISTEN)</pre><p>2) 配置ldap服务</p><p>首先要设置ldap的管理员密码。生成经处理后的明文密码(这里我输入明文密码admin@123)
其中 {SSHA}xxxxxxxxxxxxxxxxxxxxxxxx 就是加密处理后的明文密码，之后会用到这个密码。</p><pre class="prism-token token language-javascript">[root@test-vm002 ~]# slappasswd
New password: 
Re-enter new password: 
{SSHA}wfYgDRZdRyxTuwVg1bzpXjjgAWGNYeN3</pre><p>导入chrootpw.ldif文件</p><pre class="prism-token token language-javascript">[root@test-vm002 ~]# cd /etc/openldap/
[root@test-vm002 openldap]# vim chrootpw.ldif 
# specify the password generated above for &quot;olcRootPW&quot; section
dn: olcDatabase={0}config,cn=config
changetype: modify
add: olcRootPW
olcRootPW: {SSHA}wfYgDRZdRyxTuwVg1bzpXjjgAWGNYeN3

[root@test-vm002 openldap]# ldapadd -Y EXTERNAL -H ldapi:/// -f chrootpw.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry &quot;olcDatabase={0}config,cn=config&quot;</pre><p>导入基本Schema模式</p><pre class="prism-token token language-javascript">[root@test-vm002 openldap]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif 
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
adding new entry &quot;cn=cosine,cn=schema,cn=config&quot;

[root@test-vm002 openldap]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
adding new entry &quot;cn=nis,cn=schema,cn=config&quot;

[root@test-vm002 openldap]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
adding new entry &quot;cn=inetorgperson,cn=schema,cn=config&quot;</pre><p><strong>温馨提示：可以有选择的导入下面的Schema模式。这里只选择导入上面三个模式：</strong></p><pre class="prism-token token language-javascript">-----------------------------------------------------------------------------------------------
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/cosine.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/nis.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/collective.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/corba.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/core.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/duaconf.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/dyngroup.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/inetorgperson.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/java.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/misc.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/openldap.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/pmi.ldif 
ldapadd -Y EXTERNAL -H ldapi:/// -D &quot;cn=config&quot; -f /etc/openldap/schema/ppolicy.ldif
-----------------------------------------------------------------------------------------------</pre><p>在ldap的DB中设置域名
下面输入的明文密码仍是admin@123</p><pre class="prism-token token language-javascript">[root@test-vm002 openldap]# slappasswd 
New password: 
Re-enter new password: 
{SSHA}cm/LXtPjAlGzPWta+Yn3mKiDH53rVfMD</pre><p>导入chdomain.ldif文件，这里我使用的域名是huanqiu.com</p><pre class="prism-token token language-javascript">[root@test-vm002 openldap]# vim chdomain.ldif 
# replace to your own domain name for &quot;dc=***,dc=***&quot; section
# specify the password generated above for &quot;olcRootPW&quot; section
 dn: olcDatabase={1}monitor,cn=config
changetype: modify
replace: olcAccess
olcAccess: {0}to * by dn.base=&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth&quot;
  read by dn.base=&quot;cn=Manager,dc=huanqiu,dc=com&quot; read by * none

dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcSuffix
olcSuffix: dc=huanqiu,dc=com

dn: olcDatabase={2}hdb,cn=config
changetype: modify
replace: olcRootDN
olcRootDN: cn=Manager,dc=huanqiu,dc=com

dn: olcDatabase={2}hdb,cn=config
changetype: modify
add: olcRootPW
olcRootPW: {SSHA}cm/LXtPjAlGzPWta+Yn3mKiDH53rVfMD

dn: olcDatabase={2}hdb,cn=config
changetype: modify
add: olcAccess
olcAccess: {0}to attrs=userPassword,shadowLastChange by
  dn=&quot;cn=Manager,dc=huanqiu,dc=com&quot; write by anonymous auth by self write by * none
olcAccess: {1}to dn.base=&quot;&quot; by * read
olcAccess: {2}to * by dn=&quot;cn=Manager,dc=huanqiu,dc=com&quot; write by * read

[root@test-vm002 openldap]# ldapmodify -Y EXTERNAL -H ldapi:/// -f chdomain.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;

modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;

modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;

modifying entry &quot;olcDatabase={2}hdb,cn=config&quot;</pre><p>然后导入basedomain.ldif文件</p><pre class="prism-token token language-javascript">[root@test-vm002 openldap]# vim basedomain.ldif
# replace to your own domain name for &quot;dc=***,dc=***&quot; section
 dn: dc=srv,dc=world
objectClass: top
objectClass: dcObject
objectclass: organization
o: Server Com
dc: Huanqiu

dn: cn=Manager,dc=huanqiu,dc=com
objectClass: organizationalRole
cn: Manager
description: Directory Manager

dn: ou=People,dc=huanqiu,dc=com
objectClass: organizationalUnit
ou: People

dn: ou=Group,dc=huanqiu,dc=com
objectClass: organizationalUnit
ou: Group

如下导入basedomain.ldif文件时需要输入的密码是admin@123
[root@test-vm002 openldap]# ldapadd -x -D cn=Manager,dc=huanqiu,dc=com -W -f basedomain.ldif
Enter LDAP Password:                                
adding new entry &quot;dc=huanqiu,dc=com&quot;

adding new entry &quot;cn=Manager,dc=huanqiu,dc=com&quot;

adding new entry &quot;ou=People,dc=huanqiu,dc=com&quot;

adding new entry &quot;ou=Group,dc=huanqiu,dc=com&quot;</pre><p>3）关闭防火墙（或开启防火墙，开放389端口访问）</p><pre class="prism-token token language-javascript">[root@test-vm002 openldap]# systemctl stop firewalld
[root@test-vm002 openldap]# systemctl disable firewalld
[root@test-vm002 openldap]# setenforce 0</pre><p>4）添加一个ldap用户(如下，添加用户kevin)</p><pre class="prism-token token language-javascript">仍然输入明文密码admin@123
[root@test-vm002 openldap]# slappasswd
New password: 
Re-enter new password: 
{SSHA}NKGiugr+3ceSiv3tkgKYU5w5ywpDy/bP

[root@test-vm002 openldap]# vim ldapuser.ldif
# create new
# replace to your own domain name for &quot;dc=***,dc=***&quot; section
dn: uid=kevin,ou=People,dc=huanqiu,dc=com
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: shadowAccount
cn: Kevin
sn: Linux
userPassword: {SSHA}NKGiugr+3ceSiv3tkgKYU5w5ywpDy/bP
loginShell: /bin/bash
uidNumber: 1000
gidNumber: 1000
homeDirectory: /home/kevin

dn: cn=kevin,ou=Group,dc=huanqiu,dc=com
objectClass: posixGroup
cn: Kevin
gidNumber: 1000
memberUid: kevin

如下导入ldapuser.ldif文件时的需要输入的密码是上面的admin@123
[root@test-vm002 openldap]# ldapadd -x -D cn=Manager,dc=huanqiu,dc=com -W -f ldapuser.ldif
Enter LDAP Password: 
adding new entry &quot;uid=kevin,ou=People,dc=huanqiu,dc=com&quot;

adding new entry &quot;cn=kevin,ou=Group,dc=huanqiu,dc=com&quot;</pre><p>添加本机的系统用户和群组到ldap目录</p><pre class="prism-token token language-javascript">[root@test-vm002 openldap]# vim ldapuser.sh 
# extract local users and groups who have 1000-9999 digit UID
# replace &quot;SUFFIX=***&quot; to your own domain name
# this is an example
 #!/bin/bash

SUFFIX=&#x27;dc=huanqiu,dc=com&#x27;
LDIF=&#x27;ldapuser.ldif&#x27;

echo -n &gt; $LDIF
GROUP_IDS=()
grep &quot;x:[1-9][0-9][0-9][0-9]:&quot; /etc/passwd | (while read TARGET_USER
do
    USER_ID=&quot;$(echo &quot;$TARGET_USER&quot; | cut -d&#x27;:&#x27; -f1)&quot;

    USER_NAME=&quot;$(echo &quot;$TARGET_USER&quot; | cut -d&#x27;:&#x27; -f5 | cut -d&#x27; &#x27; -f1,2)&quot;
    [ ! &quot;$USER_NAME&quot; ] &amp;&amp; USER_NAME=&quot;$USER_ID&quot;

    LDAP_SN=&quot;$(echo &quot;$USER_NAME&quot; | cut -d&#x27; &#x27; -f2)&quot;
    [ ! &quot;$LDAP_SN&quot; ] &amp;&amp; LDAP_SN=&quot;$USER_NAME&quot;

    LASTCHANGE_FLAG=&quot;$(grep &quot;${USER_ID}:&quot; /etc/shadow | cut -d&#x27;:&#x27; -f3)&quot;
    [ ! &quot;$LASTCHANGE_FLAG&quot; ] &amp;&amp; LASTCHANGE_FLAG=&quot;0&quot;

    SHADOW_FLAG=&quot;$(grep &quot;${USER_ID}:&quot; /etc/shadow | cut -d&#x27;:&#x27; -f9)&quot;
    [ ! &quot;$SHADOW_FLAG&quot; ] &amp;&amp; SHADOW_FLAG=&quot;0&quot;

    GROUP_ID=&quot;$(echo &quot;$TARGET_USER&quot; | cut -d&#x27;:&#x27; -f4)&quot;
    [ ! &quot;$(echo &quot;${GROUP_IDS[@]}&quot; | grep &quot;$GROUP_ID&quot;)&quot; ] &amp;&amp; GROUP_IDS=(&quot;${GROUP_IDS[@]}&quot; &quot;$GROUP_ID&quot;)

    echo &quot;dn: uid=$USER_ID,ou=People,$SUFFIX&quot; &gt;&gt; $LDIF
    echo &quot;objectClass: inetOrgPerson&quot; &gt;&gt; $LDIF
    echo &quot;objectClass: posixAccount&quot; &gt;&gt; $LDIF
    echo &quot;objectClass: shadowAccount&quot; &gt;&gt; $LDIF
    echo &quot;sn: $LDAP_SN&quot; &gt;&gt; $LDIF
    echo &quot;givenName: $(echo &quot;$USER_NAME&quot; | awk &#x27;{print $1}&#x27;)&quot; &gt;&gt; $LDIF
    echo &quot;cn: $USER_NAME&quot; &gt;&gt; $LDIF
    echo &quot;displayName: $USER_NAME&quot; &gt;&gt; $LDIF
    echo &quot;uidNumber: $(echo &quot;$TARGET_USER&quot; | cut -d&#x27;:&#x27; -f3)&quot; &gt;&gt; $LDIF
    echo &quot;gidNumber: $(echo &quot;$TARGET_USER&quot; | cut -d&#x27;:&#x27; -f4)&quot; &gt;&gt; $LDIF
    echo &quot;userPassword: {crypt}$(grep &quot;${USER_ID}:&quot; /etc/shadow | cut -d&#x27;:&#x27; -f2)&quot; &gt;&gt; $LDIF
    echo &quot;gecos: $USER_NAME&quot; &gt;&gt; $LDIF
    echo &quot;loginShell: $(echo &quot;$TARGET_USER&quot; | cut -d&#x27;:&#x27; -f7)&quot; &gt;&gt; $LDIF
    echo &quot;homeDirectory: $(echo &quot;$TARGET_USER&quot; | cut -d&#x27;:&#x27; -f6)&quot; &gt;&gt; $LDIF
    echo &quot;shadowExpire: $(passwd -S &quot;$USER_ID&quot; | awk &#x27;{print $7}&#x27;)&quot; &gt;&gt; $LDIF
    echo &quot;shadowFlag: $SHADOW_FLAG&quot; &gt;&gt; $LDIF
    echo &quot;shadowWarning: $(passwd -S &quot;$USER_ID&quot; | awk &#x27;{print $6}&#x27;)&quot; &gt;&gt; $LDIF
    echo &quot;shadowMin: $(passwd -S &quot;$USER_ID&quot; | awk &#x27;{print $4}&#x27;)&quot; &gt;&gt; $LDIF
    echo &quot;shadowMax: $(passwd -S &quot;$USER_ID&quot; | awk &#x27;{print $5}&#x27;)&quot; &gt;&gt; $LDIF
    echo &quot;shadowLastChange: $LASTCHANGE_FLAG&quot; &gt;&gt; $LDIF
    echo &gt;&gt; $LDIF
done

for TARGET_GROUP_ID in &quot;${GROUP_IDS[@]}&quot;
do
    LDAP_CN=&quot;$(grep &quot;:${TARGET_GROUP_ID}:&quot; /etc/group | cut -d&#x27;:&#x27; -f1)&quot;

    echo &quot;dn: cn=$LDAP_CN,ou=Group,$SUFFIX&quot; &gt;&gt; $LDIF
    echo &quot;objectClass: posixGroup&quot; &gt;&gt; $LDIF
    echo &quot;cn: $LDAP_CN&quot; &gt;&gt; $LDIF
    echo &quot;gidNumber: $TARGET_GROUP_ID&quot; &gt;&gt; $LDIF

    for MEMBER_UID in $(grep &quot;:${TARGET_GROUP_ID}:&quot; /etc/passwd | cut -d&#x27;:&#x27; -f1,3)
    do
        UID_NUM=$(echo &quot;$MEMBER_UID&quot; | cut -d&#x27;:&#x27; -f2)
        [ $UID_NUM -ge 1000 -a $UID_NUM -le 9999 ] &amp;&amp; echo &quot;memberUid: $(echo &quot;$MEMBER_UID&quot; | cut -d&#x27;:&#x27; -f1)&quot; &gt;&gt; $LDIF
    done
    echo &gt;&gt; $LDIF
done
)

[root@test-vm002 openldap]# chmod 755 ldapuser.sh
[root@test-vm002 openldap]# sh ldapuser.sh

下面输入的密码仍然是admin@123
[root@test-vm002 openldap]# ldapadd -x -D cn=Manager,dc=huanqiu,dc=com -W -f ldapuser.ldif
Enter LDAP Password: 
adding new entry &quot;uid=admin,ou=People,dc=huanqiu,dc=com&quot;
adding new entry &quot;uid=wangshibo,ou=People,dc=huanqiu,dc=com&quot;
adding new entry &quot;uid=devs,ou=People,dc=huanqiu,dc=com&quot;
adding new entry &quot;uid=huihui,ou=People,dc=huanqiu,dc=com&quot;
adding new entry &quot;cn=admin,ou=Group,dc=huanqiu,dc=com&quot;
adding new entry &quot;cn=wangshibo,ou=Group,dc=huanqiu,dc=com&quot;
adding new entry &quot;cn=devs,ou=Group,dc=huanqiu,dc=com&quot;
adding new entry &quot;cn=huihui,ou=Group,dc=huanqiu,dc=com&quot;</pre><p>5）安装phpLDAPadmin来web配置LDAP</p><p>安装和配置httpd</p><pre class="prism-token token language-javascript">[root@test-vm002 ~]# yum -y install httpd
[root@test-vm002 ~]# rm -f /etc/httpd/conf.d/welcome.conf
[root@test-vm002 ~]# vim /etc/httpd/conf/httpd.conf         //修改下面几行内容
ServerName www.example.com:80                               //第96行
AllowOverride All                                           //第151行
DirectoryIndex index.html index.cgi index.php               //第164行
# add follows to the end                                    //添加这几行
# server&#x27;s response header
ServerTokens Prod
# keepalive is ON
KeepAlive On

[root@test-vm002 ~]# systemctl start httpd
[root@test-vm002 ~]# systemctl enable httpd
Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.
[root@test-vm002 ~]# vim /var/www/html/index.html
this is test page for httpd!!!</pre><p>访问<a data-from="10680" href="http://172.16.220.133/" target="_blank" rel="nofollow noopener noreferrer">http://172.16.220.133/</a></p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="https://ask.qcloudimg.com/http-save/yehe-1207996/voles4z8o4.jpeg"></span></div></figure><p>安装php</p><pre class="prism-token token language-javascript">[root@test-vm002 ~]# yum -y install php php-mbstring php-pear
[root@test-vm002 ~]# vim /etc/php.ini
date.timezone = &quot;Asia/Shanghai&quot;       //第878行

[root@test-vm002 ~]# systemctl restart httpd

[root@test-vm002 ~]# vim /var/www/html/index.php
&lt;?php
phpinfo();
?&gt;</pre><p>访问<a data-from="10680" href="http://172.16.220.133/index.php" target="_blank" rel="nofollow noopener noreferrer">http://172.16.220.133/index.php</a></p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="https://ask.qcloudimg.com/http-save/yehe-1207996/e49vc3baku.jpeg"></span></div></figure><p>安装phpLDAP admin</p><pre class="prism-token token language-javascript">[root@test-vm002 ~]# wget http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
[root@test-vm002 ~]# rpm -ivh epel-release-latest-7.noarch.rpm
[root@test-vm002 ~]# yum repolist                     #检查是否已添加至源列表
[root@test-vm002 ~]# yum --enablerepo=epel -y install phpldapadmin
 
登陆设置
[root@test-vm002 ~]# vim /etc/phpldapadmin/config.php
$servers-&gt;setValue(&#x27;login&#x27;,&#x27;attr&#x27;,&#x27;dn&#x27;);                    //第387行，打开这行的注释.使用用户名登陆
// $servers-&gt;setValue(&#x27;login&#x27;,&#x27;attr&#x27;,&#x27;uid&#x27;);                //注释掉这行。禁止使用uid登陆

[root@test-vm002 ~]# cat /etc/httpd/conf.d/phpldapadmin.conf
#
#  Web-based tool for managing LDAP servers
#

Alias /phpldapadmin /usr/share/phpldapadmin/htdocs
Alias /ldapadmin /usr/share/phpldapadmin/htdocs

&lt;Directory /usr/share/phpldapadmin/htdocs&gt;
  &lt;IfModule mod_authz_core.c&gt;
    # Apache 2.4
    Require local
    Require ip 172.16.220.0/8                 //添加访问权限，由于我本地ip是172.16.220.19，所以这里设置这个网段的访问权限
  &lt;/IfModule&gt;
  &lt;IfModule !mod_authz_core.c&gt;
    # Apache 2.2
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
    Allow from ::1
  &lt;/IfModule&gt;
&lt;/Directory&gt;

[root@test-vm002 ~]# systemctl restart httpd
[root@test-vm002 share]# ps -ef|grep httpd
root       4150      1  0 01:13 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache     4151   4150  0 01:13 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache     4152   4150  0 01:13 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache     4153   4150  0 01:13 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache     4154   4150  0 01:13 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache     4155   4150  0 01:13 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache     4177   4150  0 01:13 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
apache     4184   4150  0 01:13 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
root       4188   3000  0 01:14 pts/1    00:00:00 grep --color=auto httpd
 
[root@test-vm002 share]# chown -R apache.apache /usr/share/phpldapadmin</pre><p>访问<a data-from="10680" href="http://172.16.220.133/ldapadmin" target="_blank" rel="nofollow noopener noreferrer">http://172.16.220.133/ldapadmin</a>
登陆用户名：cn=Manager,dc=huanqiu,dc=com     
密码是上面的admin@123</p></div><div class="col-article-source"><p>本文参与<a href="/developer/support-plan" class="com-link">腾讯云自媒体分享计划</a>，欢迎正在阅读的你也加入，一起分享。</p></div><div class="col-article-time"><span>发表于 <time dateTime="2018-01-22 16:16:33" title="2018-01-22 16:16:33"> 2018-01-22<span class="com-v-box">2018-01-22 16:16:33</span></time></span></div><div class="col-article-tags"><nav class="col-tags"><a href="/developer/tag/10805?entry=article" class="col-tag">数据处理</a><a href="/developer/tag/10308?entry=article" class="col-tag">Linux</a><a href="/developer/tag/10312?entry=article" class="col-tag">CentOS</a></nav><div class="extra-part"><div class="com-operations"><a href="javascript:;" class="com-opt-link link-warn"><i class="com-i-warn"></i>举报</a></div></div></div><div class="com-widget-operations" style="visibility:hidden"><div class="main-cnt"><a href="javascript:;" class="com-opt-link link-like"><i class="com-i-like"></i><span class="text">13</span></a><a href="javascript:;" class="com-opt-link link-bookmark"><i class="com-i-bookmark"></i><span class="text">0</span></a></div><div class="extra-cnt"><span class="com-opt-text share-text">分享</span><ul class="com-share-options"><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon wechat"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><div class="qr-img"></div><p class="qr-txt">分享文章到朋友圈</p></div></div></div></li><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon qq"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><span>分享文章到 QQ</span></div></div></div></li><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon weibo"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><span>分享文章到微博</span></div></div></div></li><li><div class="c-bubble-trigger"><a class="opt-item" href="javascript:;"><i class="opt-icon copy"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><span>复制文章链接到剪贴板</span></div></div></div></li></ul><div class="c-bubble-trigger com-widget-qr"><button class="scan-btn" hotrep="community.edge-widget.follow-oa">扫描二维码</button><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><div class="qr-img"><img src="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/portal/css/img/wechat-qr.jpg" alt=""/></div><p class="qr-txt">扫码关注云+社区</p><p class="qr-txt">领取腾讯云代金券</p></div></div></div></div></div></section><div class="com-media col-column-media shortcut"><header class="col-column-media-hd"><a href="/developer/column/1819" class="com-avatar" style="background-image:url(https://imgcache.qq.com/qcloud/developer/images/release/column-icons/5.png)"></a><h3 class="com-media-title"><a href="/developer/column/1819">散尽浮华</a></h3><div class="col-column-media-datas"><span class="col-column-media-data">543<!-- --> 篇文章</span><span class="com-split dot"></span><span class="col-column-media-data">114<!-- --> 人订阅</span></div></header><div class="col-column-media-bd"><ul class="col-2-disorder-list"><li><a href="/developer/article/1026297">linux系统root密码遗忘的情况下的解决办法</a></li><li><a href="/developer/article/1026295">centos7下部署iptables环境纪录（关闭默认的firewalle）</a></li><li><a href="/developer/article/1026286">Centos下部署DRBD+NFS+Keepalived高可用环境记录</a></li><li><a href="/developer/article/1026308">kvm虚拟化关闭虚拟网卡virbr0的方法</a></li><li><a href="/developer/article/1026310">Linux下selinux简单梳理</a></li></ul></div></div><section class="col-group group-comments"><div class="com-comment-single-edit"><header class="edit-hd"><h3 class="edit-title"><i class="edit-icon"></i>我来说两句</h3><div class="edit-count"><span class="edit-count-num">0</span> 条评论</div></header><div class="edit-body"><div class="edit-textarea"></div><div class="edit-tip"><a href="javascript:;">登录</a> 后参与评论</div></div></div><section class="com-comment-popup v2"><div class="popup-bd"></div></section></section><ul class="col-slibing-articles"><li><a href="/developer/article/1026303" hotrep="community.column.article-detail.prev">上一篇：无法启用数据库中的 Service Broker，因为已存在启用的具有相同 ID 的 Service Broker。</a></li><li><a href="/developer/article/1026305" hotrep="community.column.article-detail.next">下一篇：.NET Core 已经实现了PHP JIT，现在PHP是.NET上的一门开发语言</a></li></ul><section class="col-group"><header class="col-group-hd"><h2 class="col-group-title">相关文章</h2></header><div class="col-group-bd"><div class="col-article-list"><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/1601" class="column-name" target="_blank" hotrep="">开发与安全</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1008802" target="_blank" hotrep="" style="display:inline">linux网络编程之socket（九）：使用select函数改进客户端/服务器端程序</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1008802" target="_blank" hotrep="">一、当我们使用单进程单连接且使用readline修改后的客户端程序，去连接使用readline修改后的服务器端程序，会出现一个有趣的现象，先来看输出：
先运行服...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">507</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">0</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1008802" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1147827/g7vmjd84fh.png?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/2644" class="column-name" target="_blank" hotrep="">JetpropelledSnake</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1194143" target="_blank" hotrep="" style="display:inline">RESTful源码学习笔记之RPC和Restful深入理解</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1194143" target="_blank" hotrep="">RPC 即远程过程调用（Remote Procedure Call Protocol，简称RPC），像调用本地服务(方法)一样调用服务器的服务(方法)。通常的实...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">112</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">3</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/2708" class="column-name" target="_blank" hotrep="">北京马哥教育</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1116028" target="_blank" hotrep="" style="display:inline">万字长文为你深入解读 Linux 用户及用户组管理</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1116028" target="_blank" hotrep="">
运维行业正在变革，推荐阅读：30万年薪Linux运维工程师成长魔法
无论是出于 Linux 本身的多用户多任务分时操作系统的性质，还是出于系统安全的考虑， L...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">425</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">5</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1116028" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1751832/6ypyuiww5f.png?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/5096" class="column-name" target="_blank" hotrep="">Java修行之道</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1199729" target="_blank" hotrep="" style="display:inline">常用数据库连接池 (DBCP、c3p0、Druid) 配置说明</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1199729" target="_blank" hotrep="">数据库连接是一种关键的有限的昂贵的资源，这一点在多用户的网页应用程序中体现得尤为突出。对数据库连接的管理能显著影响到整个应用程序的伸缩性和健壮性，影响到程序的性...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">346</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">4</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/5017" class="column-name" target="_blank" hotrep="">Java架构师历程</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1347104" target="_blank" hotrep="" style="display:inline">ssh工作原理</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1347104" target="_blank" hotrep="">1.通过Configuration().configure();读取并解析hibernate.cfg.xml配置文件</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">152</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">3</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/2132" class="column-name" target="_blank" hotrep="">Java帮帮-微信公众号-技术文章全总结</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1369997" target="_blank" hotrep="" style="display:inline">c3p0,DBPC,Druid三大连接池的区别/性能【面试+工作】</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1369997" target="_blank" hotrep=""></a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">274</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">2</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/2144" class="column-name" target="_blank" hotrep="">晓晨的专栏</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1151282" target="_blank" hotrep="" style="display:inline">使用 JMeter 进行压力测试</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1151282" target="_blank" hotrep=""></a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">422</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">2</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/2671" class="column-name" target="_blank" hotrep="">友弟技术工作室</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1108097" target="_blank" hotrep="" style="display:inline">lvm</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1108097" target="_blank" hotrep="">逻辑卷管理LVM是一个多才多艺的硬盘系统工具。无论在Linux或者其他类似的系统，都是非常的好用。传统分区使用固定大小分区，重新调整大小十分麻烦。但是，LVM可...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">425</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">7</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1108097" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1731659/l48jnxwn09.png?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/2006" class="column-name" target="_blank" hotrep="">FreeBuf</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1171214" target="_blank" hotrep="" style="display:inline">从NTDS.dit获取密码hash的三种方法</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1171214" target="_blank" hotrep="">本文我将为大家介绍一些取证工具，这些工具在渗透测试中将会对我们起到很大的帮助。例如当你提取到了大量的主机内部文件时，你可会发现其中包含如NTDS.dit和系统h...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">200</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">3</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1171214" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1268449/0ivw8v7ksu.jpeg?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/4408" class="column-name" target="_blank" hotrep="">C/C++基础</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1177407" target="_blank" hotrep="" style="display:inline">C++实现简易log日志系统</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1177407" target="_blank" hotrep="">在软件开发周期中，不管是前台还是后台，系统一般会采用一个持久化的日志系统来记录运行情况。</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">715</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">2</span></a><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-bookmark"></i><span class="text">0</span></a></div></div></section></div></div></section></div><div class="J-footer com-2-footer large-width" style="position:fixed;width:100%;bottom:0;visibility:hidden"><div class="com-2-footer-inner"><div class="com-2-footer-main"><div class="com-2-footer-main-ctn"><div class="com-2-footer-main-inner"><div class="com-2-footer-website"><ul class="com-2-footer-website-group"><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">社区</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="/developer/column" hotrep="community.footer.community.article">专栏文章</a></li><li class="com-2-footer-website-item"><a href="/developer/ask" hotrep="community.footer.community.ask">互动问答</a></li><li class="com-2-footer-website-item"><a href="/developer/salon" hotrep="community.footer.community.salon">技术沙龙</a></li><li class="com-2-footer-website-item"><a href="/developer/news" hotrep="community.footer.community.news">技术快讯</a></li><li class="com-2-footer-website-item"><a href="/developer/teams" hotrep="community.footer.community.teams">团队主页</a></li><li class="com-2-footer-website-item"><a href="/developer/devdocs" hotrep="community.footer.community.devdocs">开发者手册</a></li><li class="com-2-footer-website-item"><a href="/developer/timl" hotrep="community.footer.community.timl">智能钛AI</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">活动</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="/developer/original-sharing" hotrep="community.footer.activity.original-sharing">原创分享计划</a></li><li class="com-2-footer-website-item"><a href="/developer/support-plan" hotrep="community.footer.activity.support-plan">自媒体分享计划</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">资源</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="/edu/learning?ADTAG=sq.bott" target="_blank" hotrep="community.footer.resource.edu">在线学习中心</a></li><li class="com-2-footer-website-item"><a href="/developer/specials" hotrep="community.footer.resource.specials">技术周刊</a></li><li class="com-2-footer-website-item"><a href="/developer/tags" hotrep="community.footer.resource.tags">社区标签</a></li><li class="com-2-footer-website-item"><a href="/developer/labs" target="_blank" hotrep="community.footer.resource.labs">开发者实验室</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">关于</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1006434" hotrep="community.footer.about.spec">社区规范</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1006435" hotrep="community.footer.about.disclaimer">免责声明</a></li><li class="com-2-footer-website-item"><a href="mailto:yunjia_community@tencent.com" hotrep="community.footer.about.contact">联系我们</a></li></ul></div></li><li class="com-2-footer-website-column com-v-box"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">归档</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="/developer/ask/archives.html">问题归档</a></li><li class="com-2-footer-website-item"><a href="/developer/column/archives.html">专栏文章归档</a></li><li class="com-2-footer-website-item"><a href="/developer/news/archives.html">快讯文章归档</a></li><li class="com-2-footer-website-item"><a href="/developer/information/all.html">关键词归档</a></li><li class="com-2-footer-website-item"><a href="/developer/devdocs/archives.html">开发者手册归档</a></li><li class="com-2-footer-website-item"><a href="/developer/devdocs/sections_p1.html">开发者手册 Section 归档</a></li></ul></div></li></ul></div><div class="com-2-footer-copyright"><div class="com-2-footer-logo"><i class="com-2-footer-logo-icon"></i></div><div class="com-2-footer-qr"><div class="com-2-footer-qr-object"><img class="com-2-footer-qr-image" src="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/portal/css/img/wechat-qr.jpg" alt=""/></div><p class="com-2-footer-qr-info"><span class="com-2-footer-qr-text">扫码关注云+社区</span></p><p class="com-2-footer-qr-info"><span class="com-2-footer-qr-text">领取腾讯云代金券</span></p></div><p class="com-2-footer-copyright-text"><span>Copyright © 2013-2019</span><span>Tencent Cloud. All Rights Reserved.</span><span>腾讯云 版权所有 <a href="http://www.beian.miit.gov.cn" target="_blank" hotrep="community.footer.link.miitbeian">京ICP备11018762号</a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802020287" hotrep="community.footer.link.beian" target="_blank">京公网安备 11010802020287</a></span></p></div></div></div></div></div></div></div><div class="com-widget-global"><div style="position:relative;z-index:8088"><div class="c-bubble-trigger com-widget-qr"><button class="scan-btn" hotrep="community.edge-widget.follow-oa">扫描二维码</button><div class="c-bubble c-bubble-right "><div class="c-bubble-inner"><div class="qr-img"><img src="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/portal/css/img/wechat-qr.jpg" alt=""/></div><p class="qr-txt">扫码关注云+社区</p><p class="qr-txt">领取腾讯云代金券</p></div></div></div></div></div><div id="dialog-root"></div></div><script>window.isServerContext = false; window.isClientContext = true;</script><script>window.$serverTime = 1569391719168; window.$clientTime = Date.now();</script><script>window.$ua = {"ua":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36","browser":{"name":"Chrome","version":"75.0.3770.142","major":"75"},"engine":{"name":"WebKit","version":"537.36"},"os":{"name":"Linux","version":"x86_64"},"device":{},"cpu":{"architecture":"amd64"}};</script><script src="//imgcache.qq.com/qcloud/developer/scripts/release/base.18719486f5.js?max_age=31536000"></script><script src="//imgcache.qq.com/qcloud/draft-master/dist/draft-master-v1.3.33.js?max_age=31536000"></script><script src="https://cloud.tencent.com/qccomponent/login/api.js"></script><script src="//imgcache.qq.com/qcloud/main/scripts/release/common/deps/wechatJsSdk.js?version=1_0_1&amp;max_age=31536000"></script><script src="//imgcache.qq.com/qcloud/developer/scripts/release/common.738e983889.js?max_age=31536000"></script><script src="//imgcache.qq.com/qcloud/developer/scripts/release/column/article-detail.71ef37369c.js?max_age=31536000"></script><script>
window.$render({"articleDetail":{"id":1026304,"articleId":1026304,"title":"Centos7.2下针对LDAP的完整部署记录","content":"entityMap|0|type|IMAGE|mutability|IMMUTABLE|data|imageUrl|https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1207996\u002Faa6r5dk1mg.jpeg|imageAlt|1|https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1207996\u002Fiv5emkl401.jpeg|2|https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1207996\u002Flz1nhbmttg.jpeg|3|https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1207996\u002F74yac0ap70.jpeg|4|LINK|MUTABLE|url|http:\u002F\u002F172.16.220.133\u002F|5|https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1207996\u002Fvoles4z8o4.jpeg|6|http:\u002F\u002F172.16.220.133\u002Findex.php|7|https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1207996\u002Fe49vc3baku.jpeg|8|http:\u002F\u002F172.16.220.133\u002Fldapadmin|blocks|key|6279u|text|一、LDAP究竟是什么？\nLDAP是轻量目录访问协议，英文全称是Lightweight+Directory+Access+Protocol，一般都简称为LDAP。它是基于X.500标准的，但是简单多了并且可以根据需要定制。与X.500不同，LDAP支持TCP\u002FIP，这对访问Internet是必须的。LDAP的核心规范在RFC中都有定义，所有与LDAP相关的RFC都可以在LDAPman+RFC网页中找到。简单说来，LDAP是一个得到关于人或者资源的集中、静态数据的快速方式。+LDAP是一个用来发布目录信息到许多不同资源的协议。通常它都作为一个集中的地址本使用，不过根据组织者的需要，它可以做得更加强大。|unstyled|depth|inlineStyleRanges|offset|length|style|BOLD|entityRanges|1l3do|现在市场上有关LDAP的产品已有很多，各大软件公司都在他们的产品中集成了LDAP服务，如Microsoft的ActiveDirectory、Lotus的Domino+Directory、IBM的WebSphere中也集成了LDAP服务。LDAP的开源实现是OpenLDAP，它比商业产品一点也不差，而且源码开放。|corum|OpenLDAP+是最常用的目录服务之一，它是一个由开源社区及志愿者开发和管理的一个开源项目，提供了目录服务的所有功能，包括目录搜索、身份认证、安全通道、过滤器等等。大多数的+Linux+发行版里面都带有+OpenLDAP+的安装包。OpenLDAP+服务默认使用非加密的+TCP\u002FIP+协议来接收服务的请求，并将查询结果传回到客户端。由于大多数目录服务都是用于系统的安全认证部分比如：用户登录和身份验证，所以它也支持使用基于+SSL\u002FTLS+的加密协议来保证数据传送的保密性和完整性。OpenLDAP+是使用+OpenSSL+来实现+SSL\u002FTLS+加密通信的。+|62c06|1.1+ +LDAP协议简单介绍\n目录是一组具有类似属性、以一定逻辑和层次组合的信息。常见的例子是通讯簿，由以字母顺序排列的名字、地址和电话号码组成。\n目录服务是一种在分布式环境中发现目标的方法。目录具有两个主要组成部分：\n+第一部分是数据库，数据库是分布式的，且拥有一个描述数据的规划。\n第二部分则是访问和处理数据的各种协议。|mqsf|录服务其实也是一种数据库系统，只是这种数据库是一种树形结构，而不是通常使用的关系数据库。目录服务与关系数据库之间的主要区别在于：二者都允许对存储数据进行访问，只是目录主要用于读取，其查询的效率很高，而关系数据库则是为读写而设计的。\n温馨提示：目录服务不适于进行频繁的更新，属于典型的分布式结构。+\nLDAP是一个目录服务协议，目前存在众多版本的LDAP，而最常见的则是V2和V3两个版本，它们分别于1995年和1997年首次发布。|4c1h6|1.2+ +LDAP的基本模型\nLDAP的基本模型是建立在\"条目\"（Entry）的基础上。一个条目是一个或多个属性的集合，并且具有一个全局唯一的\"可区分名称\"（用dn表示）。与关系型数据（后面简称数据库）进行类比，一个条目相当于数据库中的一条记录，而dn相当于数据库中记录的关键字，属性相当于数据库中的字段。\n温馨提示：dn必须是全局唯一的。+\nLDAP中，将数据组织成一个树形结构，这与现实生活中的很多数据结构可以对应起来，而不像设计关系型数据库的表，需要进行多种变化。如下图所展示的就是一个树形结构的数据。|f66uq|?|atomic|7afgq|在上图所示的树形结构中，树的根结点是一个组织的域名（dlw.com），其下分为3个部分，分别是managers、people和group，可将这3个组看作组织中的3个部门：如managers用来管理所有管理人员，people用来管理登录系统的用户，group用来管理系统中的用户组。当然，在该图中还可继续增加其他分支。\n对于图中所示的树形结构，使用关系数据库来保存数据的话，需要设置多个表，一层一层分别保存，当需要查找某个信息时，再逐层进行查询，最终得到结果。\n若使用目录来保存该图中的数据，则更直观。图中每个结点用一个条目来保存，不同类型的结点需要保存的数据可能不同，在LDAP中通过一个称为objectClass的类型来控制不同结点需要的数据（称为属性）。|23u9e|对于目录中的数据怎样进行引用呢？前面提到过，每一个条目都有一个dn，因为dn是唯一的，因此就可找到需要结点的数据。dn的构造方式如下：\n首先得到条目自己的名称（rdn，称为相对dn），然后开始向上逐级查找父结点，一直到根项为止。例如，对于图1-1中最右下方的结点，其dn为：|5hk9b|dn:+cn=ldap,+ou=group,+o=dlw.com+|code-block|syntax|javascript|5ou54|通过这样的方式，即可唯一标识每一个结点。在现实生活中，有很多这种树形结构的数据，如计算机文件系统的目录结构、Internet中的域名等。这些类型的数据，只要不需要频繁的更新，都适合用目录来保存。|2osae|LDAP主要的简称含义：\no-\u003E+ +organization（组织-公司）\nou-\u003E+organization+unit（组织单元-部门）\nc-\u003E+ +countryName（国家）\ndc-\u003E+domainComponent（域名）\nsn-\u003E++suer+name（真实名称）\ncn-\u003E+common+name（常用名称）|33k72|1.3+ +LDAP的功能\n在LDAP的功能模型中定义了一系列利用LDAP协议的操作，主要包含以下4部分：\n查询操作：允许查询目录和取得数据，其查询性能比关系数据库好。\n更新操作：目录的更新操作没关系数据库方便，更新性能较差，但也同样允许进行添加、删除、修改等操作。\n复制操作：前面也提到过，LDAP是一种典型的分布式结构，提供复制操作，可将主服务器的数据的更新复制到设置的从服务器中。\n认证和管理操作：允许客户端在目录中识别自己，并且能够控制一个会话的性质。|fqcci|1.4+ +LDAP协议的特点\nLDAP是一种目录服务，保存在特殊的数据库中，数据的读取速度远高于写入速度。\nLDAP对查询做了优化，读取速度优于普通关系数据库。\nLDAP不支持事务、不能进行回滚，需要进行这些操作的应用只有选择关系数据库。\nLDAP采用服务器\u002F客户端模式，支持分布式结构。\nLDAP中的条目以树形结构组织和存储。\nLDAP基于Internet协议，直接运行在简单和通用的TCP\u002FIP或其他可靠的传输协议层上，使连接的建立和包的处理简单、快捷，对于互联网和企业网应用都很方便。\nLDAP协议简单，通过使用查找操作实现列表操作和读操作。\nLDAP通过引用机制实现分布式访问，通过客户端API实现分布式操作（对于应用透明），平衡了负载。\nLDAP实现具有低费用、易配置和易管理的特点，并提供了满足应用程序对目录服务所需求的特性。|8ogg0|二、管理LDAP|10qb0|启动OpenLDAP服务器程序之后，接下来的操作就是通过客户端程序对目录进行操作，包括添加、修改、删除和搜索数据等操作。|2d58n|2.1+ +了解schema\n对于LDAP目录中保存的信息，可以使用LDIF（LDAP+Interchange+Format）格式来保存。这是一种标准文本文件格式，使用这种格式保存得的LDAP服务器数据库中的数据可方便读取和修改，这也是其他大多数服务配置文件所采取的格式。|2hgnq|LDIF文件常用来向目录导入或更改记录信息，这些信息需要按照LDAP中schema的格式进行组织，并会接受schema的检查，不符合其要求的格式将会出现报错信息。有关LDIF文件的格式和创建将在第4章进行介绍，这里简单介绍一下组织LDAP数据格式的schema文件。|u89|在LDAP中，schema用来指定一个目录中所包含的对象（objects）的类型（objectClass），以及每一个类型（objectClass）中必须提供的属性（Atrribute）和可选的属性。可将schema理解为面向对象程序设计中的类，通过类定义一个具体的对象。LDIF中的数据条目可理解为是一个具体的对象，是通过schema来规划创建的。因此，schema是一个数据模型，用来决定数据按什么方式存储，并定义存储在不同的条目（Entry）下的数据之间的关系。schema需要在主配置文件slapd.conf中指定，以用来决定在目录中可以使用哪些objectClass。|pjfj|在\u002Fetc\u002Fopenldap\u002Fschema\u002F目录中提供了许多schema文件，只需要在配置文件slapd.conf中使用include命令将需要使用的schema包含即可。例如，配置文件默认包含了以下schema文件：|7436u|include+\u002Fetc\u002Fopenldap\u002Fschema\u002Fcore.schema\ninclude+\u002Fetc\u002Fopenldap\u002Fschema\u002Fcosine.schema\ninclude+\u002Fetc\u002Fopenldap\u002Fschema\u002Finetorgperson.schema\ninclude+\u002Fetc\u002Fopenldap\u002Fschema\u002Fnis.schema|3mc60|温馨提示：通常使用系统提供的schema就可解决大部分应用。管理员也可以自己设计制定schema，一般包括属性定义（AttributeDefinition）、类定义（ClassDefinition）以及语法定义（SyntaxDefinition）等部分。这里就不介绍具体的设计方法了。|eqo8s|2.2+ +向目录数据库中添加数据\n初始状态下，LDAP是一个空目录，即没有任何数据。可通过程序代码向目录数据库中添加数据，也可使用OpenLDAP客户端工具ldapadd命令来完成添加数据的操作，该命令可将一个LDIF文件中的条目添加到目录。因此，需要首先创建一个LDIF文件，然后再进行添加操作。\n1）LDIF文本条目格式\nLDIF用文本格式表示目录数据库的信息，以方便用户创建、阅读和修改。在LDIF文件中，一个条目的基本格式如下：|fbs46|#+注释\ndn:+条目名\n属性描述:+值\n属性描述:+值\n属性描述:+值\n...+...|88qng|dn行类似于关系数据库中一条记录的关键字，不能与其他dn重复。一个LDIF文件中可以包含多个条目，每个条目之间用一个空行分隔。\n例如，以下内容组成一个条目：|4405e|1:+dn:+dc=dlw,+dc=com\n2:+objectclass:+top\n3:+objectclass:+dcobject\n4:+objectclass:+organization\n5:+dc:+dlw\n6:+o:+dlw,Inc.|d8sfi|在以上文本中，各行含义如下：\n第1行的dn定义该条目的标识。\n第2～4行定义该条目的objectcCass，可以定义多个属性，如上面代码中定义了3个objectClass。条目的属性根据objectClass的不同而不同，有的objectClass有必须设置的属性。在2～4行的3个objectClass中，top没有必须定义的属性，dcobject必须定义属性dc，用来表示一个域名的部分，而organization必须定义属性o，用来表示一个组织的名称。\n根据objectClass的要求，第5、6行分别定义属性dc和属性o的值。|64kc8|2.3+ +了解objectClass\nLDAP中，一个条目必须包含一个objectClass属性，且需要赋予至少一个值。每一个值将用作一条LDAP条目进行数据存储的模板；模板中包含了一个条目必须被赋值的属性和可选的属性。\nobjectClass有着严格的等级之分，最顶层是top和alias。例如，organizationalPerson这个objectClass就隶属于person，而person又隶属于top。\nobjectClass可分为以下3类：\n结构型（Structural）：如person和organizationUnit；\n辅助型（Auxiliary）：如extensibeObject；\n抽象型（Abstract）：如top，抽象型的objectClass不能直接使用。\n在OpenLDAP的schema中定义了很多objectClass，下面列出部分常用的objectClass的名称。\n++●+account\n++●+alias\n++●+dcobject\n++●+domain\n++●+ipHost\n++●+organization\n++●+organizationalRole\n++●+organizationalUnit\n++●+person\n++●+organizationalPerson\n++●+inetOrgPerson\n++●+residentialPerson\n++●+posixAccount\n++●+posixGroup|e67ro|2.4+ +了解Attribute\n属性（Attribute）类似于程序设计中的变量，可以被赋值。在OpenLDAP中声明了许多常用的Attribute（用户也可自己定义Attribute）。常见的Attribute含义如下：\n●+c：国家。\n●+cn：common+name，指一个对象的名字。如果指人，需要使用其全名。\n●+dc：domain+Component，常用来指一个域名的一部分。\n●+givenName：指一个人的名字，不能用来指姓。\n●+l：指一个地名，如一个城市或者其他地理区域的名字。\n●+mail：电子信箱地址。\n●+o：organizationName，指一个组织的名字。\n●+ou：organizationalUnitName，指一个组织单元的名字。\n●+sn：surname，指一个人的姓。\n●+telephoneNumber：电话号码，应该带有所在的国家的代码。\n●+uid：userid，通常指某个用户的登录名，与Linux系统中用户的uid不同。|4kgmt|温馨提示：objectClass是一种特殊的Attribute，它包含其他用到的Attribute以及其自身。|89phi|对于不同的objectClass，通常具有一些必设属性值和一些可选属性值。例如，可使用person这个objectClass来表示系统中一个用户的条目，对于系统中用户通常需要有这样一些信息：姓名、电话、密码、描述等。如下图所示，对于person，通过cn和sn设置用户的名和姓，这是必须设置的，而其他属性则是可选的。|9kpnj|7l374|下面列出部分常用objectClass要求必设的属性。\n●+account：userid。\n●+organization：o。\n●+person：cn和sn。\n●+organizationalPerson：与person相同。\n●+organizationalRole：cn。\n●+organizationUnit：ou。\n●+posixGroup：cn、gidNumber。\n●+posixAccount：cn、gidNumber、homeDirectory、uid、uidNumber。|3frco|2.5+ +创建LDIF文件\n对以上内容有一定了解之后，就可以编写输入LDIF文件，编辑需要向目录数据库添加的条目了。\n下面根据如下图所示的结构，创建LDIF文件dlw.com.ldif。|diofv|bognj|对上图进行分析，该目录结构分为3层，有4个结点。根据上图可创建LDIF文件如下：\n温馨提示：每个结点可用一个dn表示，对于每个结点，又可继续添加新的结点。如在根结点中可添加其他部门ou，在ou=managers结点也可继续添加其他管理人员的信息。|77k1p|1:+dn:dc=dlw,dc=com\n2:+objectclass:top\n3:+objectclass:dcobject\n4:+objectclass:organization\n5:+dc:dlw\n6:+o:dlw,Inc.\n7:+\n8:+dn:ou=managers,+dc=dlw,+dc=com\n9:+ou:managers\n10:+objectclass:organizationalUnit\n11:\n12:+dn:cn=dlw,ou=managers,dc=dlw,dc=com\n13:+cn:dlw\n14:+sn:dongliwei\n15:+objectclass:person\n16:+\n17:+dn:cn=test,ou=managers,dc=dlw,dc=com\n18:+cn:test\n19:+sn:Test+User\n20:+objectclass:person|ebbpd|以上文件中各行的含义如下：\n第1～6行创建根结点，这部分在前面也有介绍，就不再重复了。\n第7、11、16行为空行，用来分隔4个dn条目（4个结点）。\n第8～10行定义cn=managers结点的条目，该条目的objectClass为organizationalUnit，因此需要用ou属性定义组织名称。\n第12～15行定义cn=dlw结点的条目，该条目使用的objectClass为person，因此需设置cn和sn两个属性值。\n第17～20行与第12～15行的意义相同。|6rqcl|在以上LDIF文件中，第1、8、12、17行以dn开头，这部分内容必须唯一，并且在向目录数据库添加这些数据时，也要确保这些数据不能与目录数据库中已有数据相同，否则，添加操作将中断。|dj6l1|2.6+ +从LDIF文件添加到目录数据库\n使用OpenLDAP客户端工具ldapadd命令，可将LDIF文件中的条目添加到目录数据库中，该命令的格式如下：\n#+ldappadd++选项++LDIF文件+|35c9t|在ldappadd命令中常用的选项如下：\n-x：进行简单认证。\n-D：用来绑定服务器的dn。\n-h：目录服务的地址。\n-w：绑定dn的密码。\n-f：使用LDIF文件进行条目添加的文件。|84t57|将前面编写的LDIF文件的条目数据添加到目录数据库中。\n具体操作步骤如下：\n1）检查dlw.com.ldif文件中的内容，需要注意的是，每个冒号后面都需要空一格，而每行结束处不能留有空格字符。+\n2）使用以下命令将dlw.com.ldif文件中的条目添加到目录中：|30epb|#+ldapadd+-x+-D+\"cn=root,dc=dlw,dc=com\"+-w+secret+-f+dlw.com.ldif|ee0nm|温馨提示：如果以上命令执行不成功，需要逐个字符检查dlw.com.ldif文件中的内容，特别注意空格的问题。|bj21q|2.7+ +查询\n添加到目录中的条目被保存在目录数据库，在Linux命令界面下，可使用OpenLDAP客户端工具ldapsearch命令来进行查询。该命令的格式如下：\n#+ldapsearch++选项++过滤++属性值|dvsri|常用的选项有以下几个:\n-x：进行简单认证。\n-D：用来绑定服务器的dn。\n-w：绑定dn的密码。\n-b：指定要查询的根节点。\n-H：制定要查询的服务器。|eqs9t|使用ldapsearch命令查询“dc=dlw,+dc=com”下的所有条目，可使用以下命令：|5v979|#+ldapsearch+-x+-b+\"dc=dlw,dc=com\"++|bpjm3|而如果使用以下命令，将查询显示sn中以字符wu开头的条目，将得到如下图所示的查询结果，只找到一个条目。|87dgu|#+ldapsearch+-x+-b+'dc=dlw,dc=com'+'sn=wu*'++|6bjfe|2.8+ +修改条目\n使用OpenLDAP客户端工具ldapmodify命令可对目录数据库中的条目进行修改。该命令的格式如下：\n#+ldapmodify++选项|12lmn|该命令的选项也很多，常用选项与ldapadd类似，这里就不再列出了。\n温馨提示：使用ldapmodify命令不能修改条目的dn，但可以修改其他属性值。\n使用ldapmodify命令修改条目信息可以有两种方式：一种是交互式进行修改，另一种是通过文件进行修改。|em7bf|1)+交互式修改\n修改前面创建的条目\"cn=test,+ou=managers,+dc=dlw,+dc=com\"，将其sn属性修改为\"Test+User+Modify\"，并添加一个description属性，设置其值为\"add+Attribute\"。\n首先输入以下命令，进行修改状态：|sret|#+ldapmodify+-x+-D+\"cn=root,dc=dlw,dc=com\"+-W+secret++|b6tgg|执行以上命令后，终端将等候用户输入需要修改条目的dn，输入以下内容：|ffupt|dn:+cn=test,+ou=managers,+dc=dlw,+dc=com++\nchangetype:+modify++\nreplace:+sn++\nsn:+Test+User+Modify|2qpk4|以上输入内容中，第1行查找需要修改的条目，第2行设置修改模式，第3行设置需要替换的属性sn，第4行给属性sn重新设置一个值，替换该属性原有的值。\n输入完以上内容之后再按Enter键，程序将按以上设置更新数据，然后按Ctrl%2BC键退出修改命令。|9o4m5|使用以上命令修改条目的数据之后，可使用以下命令查看是否修改成功：|4ivij|#+ldapsearch+-x+-b+'dc=dlw,dc=com'+'cn=test'|3gp47|2)+通过文件修改\n通过前面的方式对条目进行修改时，很不方便，如果在交互方式时输错了某个字符，只能中断命令后重新进行修改。因此，更好的修改方法是首先将修改时输入的文字保存到一个文件中，然后以该文件作为输入进行修改。用这种方式进行操作，首先需要创建一个临时文件，用来保存需要进行的修改操作，下面演示这种方式的修改过程。|4vei2|【例子】通过修改命令将前面LDAP数据库中的信息还原，即将sn属性由“Test+User+Modify”修改为“Test+User”。\n具体操作步骤如下：\n[1]+ 使用vi编辑器创建一个文件modify，在其中输入以下内容：|5jnkh|dn:+cn=test,ou=managers,dc=dlw,dc=com++\nchangetype:+modify++\nreplace:+sn++\nsn:+Test+User|8jgge|从以上输入内容可看到，与在交互式时输入的内容完全相同。\n技巧：使用文件方式修改条目，可方便修改和检查，若某个地方有输入错误，可修改后再调用ldapmodify进行修改，减少输入量。|2jj3p|[2]+使用以下命令调用modify的内容进行修改：|pfkd|#+ldapmodify+-x+-D+\"cn=root,dc=dlw,dc=com\"+-w+secret+-f+modify++|4hnf|2.9+ +删除条目\n对于目录数据库中不用的条目，也可使用ldapdelete命令将其删除。该命令的格式如下：\n#+ldapdelete++选项++删除条目|cuvkl|该命令使用的选项与ldapadd类似，就不再列出来了。\n删除目录数据库中的“cn=test,ou=managers,dc=dlw,dc=com”条目，具体命令如下：|ff8lb|#+ldapdelete+-x+-D+\"cn=root,dc=dlw,dc=com\"+-w+secret+\"cn=test,ou=managers,dc=dlw,dc=com\"++|4hm1l|顺利执行以上命令后，终端上将不会有任何信息输出，表示完成了删除操作。\n使用ldapdelete命令只能删除树形结构中的叶结点条目，如果删除非叶结点条目，将出现错误提示。例如，执行以下命令删除根结点“dc=dlw,dc=com”，由于根结点下面还有结点，将显示如下图所示的错误提示信息：|fqigs|1mf5o|应该使用命令：|40sj6|#+ldapdelete+-x+-D+\"cn=root,dc=dlw,dc=com\"+-w+secret+\"dc=dlw,dc=com\"++|6ndic|2.10+ +数据导出\n通过ldapadd命令可向目录数据库中添加数据，在某些情况下，可能还需要进行反向操作，即将目录数据库中的数据导出。\n使用ldapsearch命令对目录数据库进行搜索，然后通过重定向将搜索结果保存到一个文件中，可达到导出数据的目的。另外，导出数据更常用的是slapcat命令，该命令的格式如下：\n#+slapcat++选项|2d8qr|最常用的选项就是-l，表示导出为LDIF文件格式。\n如将前面例子中创建的目录数据库导出为export.ldif文件，可使用以下命令：|12a57|#+slapcat+-l+export.ldif+|59a4b|温馨提示：从导出结果可看出，除了使用ldapadd命令添加到目录数据库中的条目数据外，还导出了很多其他信息，包括条目录UUID、时间戳等信息。|5vutm|2.11+ +设置主从LDAP服务器\n在某些时候，为了对LDAP服务器进行负载均衡，可能希望设置多台LDAP服务器。对于设置多台LDAP服务器的关键问题是数据的同步问题，使用slurpd进程可进行主LDAP服务器向从LDAP服务器复制数据的操作。下面将介绍架设主从LDAP服务器的过程|9t5nf|2.12+ +多台LDAP服务器工作过程\n对于多台LDAP服务器，可设置一台为主服务器，其他的为从服务器。本节介绍一台从服务器的配置，若是多台从服务器也可按此步骤进行操作。\n注意：在进行配置之前应首先确保每个LDAP服务器都已安装好OpenLDAP服务器程序，并能正确工作。+|9gigp|配置好主从LDAP服务器之后，在主服务器运行slurpd进程，该进程使用LDAP协议从主服务器的数据库更新从服务器的数据，具体操作过程如下：\n1）LDAP客户端向从服务器提交一个LDAP修改请求。\n2）从服务器给LDAP客户端返回一个指向主服务器的引用。\n3）LDAP客户端向主服务器提交LDAP修改请求。\n4）主服务器对数据库中的数据进行修改，并将改变写入本机的日志文件。\n5）在主服务器运行的slurpd进程检查到日志中有新内容，通过日志的信息将改变发送给从服务器。\n6）从服务器接收slurpd发来的信息，对本地数据进行修改。|6nj1d|以上过程就是使用slurpd进程进行数据复制的过程。从以上过程可看出，需要在主服务器的配置文件中设置要向哪些从服务器发送复制信息、主服务器还要设置一个记录数据改变的日志文件，而从服务器需要设置一个指向主服务器的链接。|1j222|2.13+ +复制数据库\n首先，把主从服务器关闭。然后通过以下三步操作静态同步主从服务器上的数据：\n把主服务器上\u002Fvar\u002Flib\u002Fldap目录下的所有数据库文件全部拷贝到从服务器的同目录中，覆盖原有文件。\n把主服务器上的\u002Fetc\u002Fldap\u002Fschema目录下的所有schema文件拷贝到从服务器的同目录中，覆盖原有文件。\n把主服务器上\u002Fetc\u002Fldap\u002Fslapd.conf文件拷贝到从服务器的同目录中，覆盖原有文件。|9rova|三、Centos7下完整部署LDAP的操作记录|89nv7|3.1+ +服务器环境介绍\nCentos7.2系统，64+bit,下面的操作都是在root账号下执行的（下面OpenLDAP部署机test-vm002的ip地址是172.16.220.133）|3jdtj|3.2+ OpenLDAP服务部署过程|1ms68|1)+安装ldap服务 |a9g2o|[root@test-vm002+～]#+vim+\u002Froot\u002Fldap_install.sh+\n#!\u002Fbin\u002Fbash\necho+\"install+ldap+rpm\"\nwget+http:\u002F\u002Fdl.fedoraproject.org\u002Fpub\u002Fepel\u002Fepel-release-latest-7.noarch.rpm\nrpm+-ivh+epel-release-latest-7.noarch.rpm\nyum+install+-y+openldap+openldap-clients+openldap-servers+migrationtools+openldap-devel+compat-openldap\ncp+\u002Fusr\u002Fshare\u002Fopenldap-servers\u002FDB_CONFIG.example+\u002Fvar\u002Flib\u002Fldap\u002FDB_CONFIG\nchown+ldap.+\u002Fvar\u002Flib\u002Fldap\u002FDB_CONFIG\nsystemctl+start+slapd\nsystemctl+enable+slapd\n\n[root@test-vm002+～]#+sh+-x+ldap_install.sh+|1ikg9|默认情况下，slapd服务监听的是389端口|4v61i|[root@test-vm002+～]#+lsof+-i:389\nCOMMAND++PID+USER+++FD+++TYPE+DEVICE+SIZE\u002FOFF+NODE+NAME\nslapd+++2940+ldap++++8u++IPv4++23618++++++0t0++TCP+*:ldap+(LISTEN)\nslapd+++2940+ldap++++9u++IPv6++23619++++++0t0++TCP+*:ldap+(LISTEN)|e68c7|2)+配置ldap服务|d9b5l|首先要设置ldap的管理员密码。生成经处理后的明文密码(这里我输入明文密码admin@123)\n其中+{SSHA}xxxxxxxxxxxxxxxxxxxxxxxx+就是加密处理后的明文密码，之后会用到这个密码。|fatha|[root@test-vm002+~]#+slappasswd\nNew+password:+\nRe-enter+new+password:+\n{SSHA}wfYgDRZdRyxTuwVg1bzpXjjgAWGNYeN3|6hi5j|导入chrootpw.ldif文件|3k710|[root@test-vm002+~]#+cd+\u002Fetc\u002Fopenldap\u002F\n[root@test-vm002+openldap]#+vim+chrootpw.ldif+\n#+specify+the+password+generated+above+for+\"olcRootPW\"+section\ndn:+olcDatabase={0}config,cn=config\nchangetype:+modify\nadd:+olcRootPW\nolcRootPW:+{SSHA}wfYgDRZdRyxTuwVg1bzpXjjgAWGNYeN3\n\n[root@test-vm002+openldap]#+ldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-f+chrootpw.ldif\nSASL\u002FEXTERNAL+authentication+started\nSASL+username:+gidNumber=0%2BuidNumber=0,cn=peercred,cn=external,cn=auth\nSASL+SSF:+0\nmodifying+entry+\"olcDatabase={0}config,cn=config\"|2qo22|导入基本Schema模式|q1o4|[root@test-vm002+openldap]#+ldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fcosine.ldif+\nSASL\u002FEXTERNAL+authentication+started\nSASL+username:+gidNumber=0%2BuidNumber=0,cn=peercred,cn=external,cn=auth\nSASL+SSF:+0\nadding+new+entry+\"cn=cosine,cn=schema,cn=config\"\n\n[root@test-vm002+openldap]#+ldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fnis.ldif\nSASL\u002FEXTERNAL+authentication+started\nSASL+username:+gidNumber=0%2BuidNumber=0,cn=peercred,cn=external,cn=auth\nSASL+SSF:+0\nadding+new+entry+\"cn=nis,cn=schema,cn=config\"\n\n[root@test-vm002+openldap]#+ldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Finetorgperson.ldif\nSASL\u002FEXTERNAL+authentication+started\nSASL+username:+gidNumber=0%2BuidNumber=0,cn=peercred,cn=external,cn=auth\nSASL+SSF:+0\nadding+new+entry+\"cn=inetorgperson,cn=schema,cn=config\"|ck7gh|温馨提示：可以有选择的导入下面的Schema模式。这里只选择导入上面三个模式：|3bm1p|-----------------------------------------------------------------------------------------------\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fcosine.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fnis.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fcollective.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fcorba.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fcore.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fduaconf.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fdyngroup.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Finetorgperson.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fjava.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fmisc.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fopenldap.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fpmi.ldif+\nldapadd+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-D+\"cn=config\"+-f+\u002Fetc\u002Fopenldap\u002Fschema\u002Fppolicy.ldif\n-----------------------------------------------------------------------------------------------|789kp|在ldap的DB中设置域名\n下面输入的明文密码仍是admin@123|cjkmn|[root@test-vm002+openldap]#+slappasswd+\nNew+password:+\nRe-enter+new+password:+\n{SSHA}cm\u002FLXtPjAlGzPWta%2BYn3mKiDH53rVfMD|2e79v|导入chdomain.ldif文件，这里我使用的域名是huanqiu.com|dcuq2|[root@test-vm002+openldap]#+vim+chdomain.ldif+\n#+replace+to+your+own+domain+name+for+\"dc=***,dc=***\"+section\n#+specify+the+password+generated+above+for+\"olcRootPW\"+section\n+dn:+olcDatabase={1}monitor,cn=config\nchangetype:+modify\nreplace:+olcAccess\nolcAccess:+{0}to+*+by+dn.base=\"gidNumber=0%2BuidNumber=0,cn=peercred,cn=external,cn=auth\"\n++read+by+dn.base=\"cn=Manager,dc=huanqiu,dc=com\"+read+by+*+none\n\ndn:+olcDatabase={2}hdb,cn=config\nchangetype:+modify\nreplace:+olcSuffix\nolcSuffix:+dc=huanqiu,dc=com\n\ndn:+olcDatabase={2}hdb,cn=config\nchangetype:+modify\nreplace:+olcRootDN\nolcRootDN:+cn=Manager,dc=huanqiu,dc=com\n\ndn:+olcDatabase={2}hdb,cn=config\nchangetype:+modify\nadd:+olcRootPW\nolcRootPW:+{SSHA}cm\u002FLXtPjAlGzPWta%2BYn3mKiDH53rVfMD\n\ndn:+olcDatabase={2}hdb,cn=config\nchangetype:+modify\nadd:+olcAccess\nolcAccess:+{0}to+attrs=userPassword,shadowLastChange+by\n++dn=\"cn=Manager,dc=huanqiu,dc=com\"+write+by+anonymous+auth+by+self+write+by+*+none\nolcAccess:+{1}to+dn.base=\"\"+by+*+read\nolcAccess:+{2}to+*+by+dn=\"cn=Manager,dc=huanqiu,dc=com\"+write+by+*+read\n\n[root@test-vm002+openldap]#+ldapmodify+-Y+EXTERNAL+-H+ldapi:\u002F\u002F\u002F+-f+chdomain.ldif\nSASL\u002FEXTERNAL+authentication+started\nSASL+username:+gidNumber=0%2BuidNumber=0,cn=peercred,cn=external,cn=auth\nSASL+SSF:+0\nmodifying+entry+\"olcDatabase={2}hdb,cn=config\"\n\nmodifying+entry+\"olcDatabase={2}hdb,cn=config\"\n\nmodifying+entry+\"olcDatabase={2}hdb,cn=config\"\n\nmodifying+entry+\"olcDatabase={2}hdb,cn=config\"|7vhfc|然后导入basedomain.ldif文件|e4v27|[root@test-vm002+openldap]#+vim+basedomain.ldif\n#+replace+to+your+own+domain+name+for+\"dc=***,dc=***\"+section\n+dn:+dc=srv,dc=world\nobjectClass:+top\nobjectClass:+dcObject\nobjectclass:+organization\no:+Server+Com\ndc:+Huanqiu\n\ndn:+cn=Manager,dc=huanqiu,dc=com\nobjectClass:+organizationalRole\ncn:+Manager\ndescription:+Directory+Manager\n\ndn:+ou=People,dc=huanqiu,dc=com\nobjectClass:+organizationalUnit\nou:+People\n\ndn:+ou=Group,dc=huanqiu,dc=com\nobjectClass:+organizationalUnit\nou:+Group\n\n如下导入basedomain.ldif文件时需要输入的密码是admin@123\n[root@test-vm002+openldap]#+ldapadd+-x+-D+cn=Manager,dc=huanqiu,dc=com+-W+-f+basedomain.ldif\nEnter+LDAP+Password:++++++++++++++++++++++++++++++++\nadding+new+entry+\"dc=huanqiu,dc=com\"\n\nadding+new+entry+\"cn=Manager,dc=huanqiu,dc=com\"\n\nadding+new+entry+\"ou=People,dc=huanqiu,dc=com\"\n\nadding+new+entry+\"ou=Group,dc=huanqiu,dc=com\"|5q78b|3）关闭防火墙（或开启防火墙，开放389端口访问）|aujbi|[root@test-vm002+openldap]#+systemctl+stop+firewalld\n[root@test-vm002+openldap]#+systemctl+disable+firewalld\n[root@test-vm002+openldap]#+setenforce+0|98um|4）添加一个ldap用户(如下，添加用户kevin)|dj7cu|仍然输入明文密码admin@123\n[root@test-vm002+openldap]#+slappasswd\nNew+password:+\nRe-enter+new+password:+\n{SSHA}NKGiugr%2B3ceSiv3tkgKYU5w5ywpDy\u002FbP\n\n[root@test-vm002+openldap]#+vim+ldapuser.ldif\n#+create+new\n#+replace+to+your+own+domain+name+for+\"dc=***,dc=***\"+section\ndn:+uid=kevin,ou=People,dc=huanqiu,dc=com\nobjectClass:+inetOrgPerson\nobjectClass:+posixAccount\nobjectClass:+shadowAccount\ncn:+Kevin\nsn:+Linux\nuserPassword:+{SSHA}NKGiugr%2B3ceSiv3tkgKYU5w5ywpDy\u002FbP\nloginShell:+\u002Fbin\u002Fbash\nuidNumber:+1000\ngidNumber:+1000\nhomeDirectory:+\u002Fhome\u002Fkevin\n\ndn:+cn=kevin,ou=Group,dc=huanqiu,dc=com\nobjectClass:+posixGroup\ncn:+Kevin\ngidNumber:+1000\nmemberUid:+kevin\n\n如下导入ldapuser.ldif文件时的需要输入的密码是上面的admin@123\n[root@test-vm002+openldap]#+ldapadd+-x+-D+cn=Manager,dc=huanqiu,dc=com+-W+-f+ldapuser.ldif\nEnter+LDAP+Password:+\nadding+new+entry+\"uid=kevin,ou=People,dc=huanqiu,dc=com\"\n\nadding+new+entry+\"cn=kevin,ou=Group,dc=huanqiu,dc=com\"|dud2d|添加本机的系统用户和群组到ldap目录|eqq6d|[root@test-vm002+openldap]#+vim+ldapuser.sh+\n#+extract+local+users+and+groups+who+have+1000-9999+digit+UID\n#+replace+\"SUFFIX=***\"+to+your+own+domain+name\n#+this+is+an+example\n+#!\u002Fbin\u002Fbash\n\nSUFFIX='dc=huanqiu,dc=com'\nLDIF='ldapuser.ldif'\n\necho+-n+\u003E+$LDIF\nGROUP_IDS=()\ngrep+\"x:[1-9][0-9][0-9][0-9]:\"+\u002Fetc\u002Fpasswd+%7C+(while+read+TARGET_USER\ndo\n++++USER_ID=\"$(echo+\"$TARGET_USER\"+%7C+cut+-d':'+-f1)\"\n\n++++USER_NAME=\"$(echo+\"$TARGET_USER\"+%7C+cut+-d':'+-f5+%7C+cut+-d'+'+-f1,2)\"\n++++[+!+\"$USER_NAME\"+]+&&+USER_NAME=\"$USER_ID\"\n\n++++LDAP_SN=\"$(echo+\"$USER_NAME\"+%7C+cut+-d'+'+-f2)\"\n++++[+!+\"$LDAP_SN\"+]+&&+LDAP_SN=\"$USER_NAME\"\n\n++++LASTCHANGE_FLAG=\"$(grep+\"${USER_ID}:\"+\u002Fetc\u002Fshadow+%7C+cut+-d':'+-f3)\"\n++++[+!+\"$LASTCHANGE_FLAG\"+]+&&+LASTCHANGE_FLAG=\"0\"\n\n++++SHADOW_FLAG=\"$(grep+\"${USER_ID}:\"+\u002Fetc\u002Fshadow+%7C+cut+-d':'+-f9)\"\n++++[+!+\"$SHADOW_FLAG\"+]+&&+SHADOW_FLAG=\"0\"\n\n++++GROUP_ID=\"$(echo+\"$TARGET_USER\"+%7C+cut+-d':'+-f4)\"\n++++[+!+\"$(echo+\"${GROUP_IDS[@]}\"+%7C+grep+\"$GROUP_ID\")\"+]+&&+GROUP_IDS=(\"${GROUP_IDS[@]}\"+\"$GROUP_ID\")\n\n++++echo+\"dn:+uid=$USER_ID,ou=People,$SUFFIX\"+\u003E\u003E+$LDIF\n++++echo+\"objectClass:+inetOrgPerson\"+\u003E\u003E+$LDIF\n++++echo+\"objectClass:+posixAccount\"+\u003E\u003E+$LDIF\n++++echo+\"objectClass:+shadowAccount\"+\u003E\u003E+$LDIF\n++++echo+\"sn:+$LDAP_SN\"+\u003E\u003E+$LDIF\n++++echo+\"givenName:+$(echo+\"$USER_NAME\"+%7C+awk+'{print+$1}')\"+\u003E\u003E+$LDIF\n++++echo+\"cn:+$USER_NAME\"+\u003E\u003E+$LDIF\n++++echo+\"displayName:+$USER_NAME\"+\u003E\u003E+$LDIF\n++++echo+\"uidNumber:+$(echo+\"$TARGET_USER\"+%7C+cut+-d':'+-f3)\"+\u003E\u003E+$LDIF\n++++echo+\"gidNumber:+$(echo+\"$TARGET_USER\"+%7C+cut+-d':'+-f4)\"+\u003E\u003E+$LDIF\n++++echo+\"userPassword:+{crypt}$(grep+\"${USER_ID}:\"+\u002Fetc\u002Fshadow+%7C+cut+-d':'+-f2)\"+\u003E\u003E+$LDIF\n++++echo+\"gecos:+$USER_NAME\"+\u003E\u003E+$LDIF\n++++echo+\"loginShell:+$(echo+\"$TARGET_USER\"+%7C+cut+-d':'+-f7)\"+\u003E\u003E+$LDIF\n++++echo+\"homeDirectory:+$(echo+\"$TARGET_USER\"+%7C+cut+-d':'+-f6)\"+\u003E\u003E+$LDIF\n++++echo+\"shadowExpire:+$(passwd+-S+\"$USER_ID\"+%7C+awk+'{print+$7}')\"+\u003E\u003E+$LDIF\n++++echo+\"shadowFlag:+$SHADOW_FLAG\"+\u003E\u003E+$LDIF\n++++echo+\"shadowWarning:+$(passwd+-S+\"$USER_ID\"+%7C+awk+'{print+$6}')\"+\u003E\u003E+$LDIF\n++++echo+\"shadowMin:+$(passwd+-S+\"$USER_ID\"+%7C+awk+'{print+$4}')\"+\u003E\u003E+$LDIF\n++++echo+\"shadowMax:+$(passwd+-S+\"$USER_ID\"+%7C+awk+'{print+$5}')\"+\u003E\u003E+$LDIF\n++++echo+\"shadowLastChange:+$LASTCHANGE_FLAG\"+\u003E\u003E+$LDIF\n++++echo+\u003E\u003E+$LDIF\ndone\n\nfor+TARGET_GROUP_ID+in+\"${GROUP_IDS[@]}\"\ndo\n++++LDAP_CN=\"$(grep+\":${TARGET_GROUP_ID}:\"+\u002Fetc\u002Fgroup+%7C+cut+-d':'+-f1)\"\n\n++++echo+\"dn:+cn=$LDAP_CN,ou=Group,$SUFFIX\"+\u003E\u003E+$LDIF\n++++echo+\"objectClass:+posixGroup\"+\u003E\u003E+$LDIF\n++++echo+\"cn:+$LDAP_CN\"+\u003E\u003E+$LDIF\n++++echo+\"gidNumber:+$TARGET_GROUP_ID\"+\u003E\u003E+$LDIF\n\n++++for+MEMBER_UID+in+$(grep+\":${TARGET_GROUP_ID}:\"+\u002Fetc\u002Fpasswd+%7C+cut+-d':'+-f1,3)\n++++do\n++++++++UID_NUM=$(echo+\"$MEMBER_UID\"+%7C+cut+-d':'+-f2)\n++++++++[+$UID_NUM+-ge+1000+-a+$UID_NUM+-le+9999+]+&&+echo+\"memberUid:+$(echo+\"$MEMBER_UID\"+%7C+cut+-d':'+-f1)\"+\u003E\u003E+$LDIF\n++++done\n++++echo+\u003E\u003E+$LDIF\ndone\n)\n\n[root@test-vm002+openldap]#+chmod+755+ldapuser.sh\n[root@test-vm002+openldap]#+sh+ldapuser.sh\n\n下面输入的密码仍然是admin@123\n[root@test-vm002+openldap]#+ldapadd+-x+-D+cn=Manager,dc=huanqiu,dc=com+-W+-f+ldapuser.ldif\nEnter+LDAP+Password:+\nadding+new+entry+\"uid=admin,ou=People,dc=huanqiu,dc=com\"\nadding+new+entry+\"uid=wangshibo,ou=People,dc=huanqiu,dc=com\"\nadding+new+entry+\"uid=devs,ou=People,dc=huanqiu,dc=com\"\nadding+new+entry+\"uid=huihui,ou=People,dc=huanqiu,dc=com\"\nadding+new+entry+\"cn=admin,ou=Group,dc=huanqiu,dc=com\"\nadding+new+entry+\"cn=wangshibo,ou=Group,dc=huanqiu,dc=com\"\nadding+new+entry+\"cn=devs,ou=Group,dc=huanqiu,dc=com\"\nadding+new+entry+\"cn=huihui,ou=Group,dc=huanqiu,dc=com\"|84jpq|5）安装phpLDAPadmin来web配置LDAP|ebpk4|安装和配置httpd|ehg15|[root@test-vm002+~]#+yum+-y+install+httpd\n[root@test-vm002+~]#+rm+-f+\u002Fetc\u002Fhttpd\u002Fconf.d\u002Fwelcome.conf\n[root@test-vm002+~]#+vim+\u002Fetc\u002Fhttpd\u002Fconf\u002Fhttpd.conf+++++++++\u002F\u002F修改下面几行内容\nServerName+www.example.com:80+++++++++++++++++++++++++++++++\u002F\u002F第96行\nAllowOverride+All+++++++++++++++++++++++++++++++++++++++++++\u002F\u002F第151行\nDirectoryIndex+index.html+index.cgi+index.php+++++++++++++++\u002F\u002F第164行\n#+add+follows+to+the+end++++++++++++++++++++++++++++++++++++\u002F\u002F添加这几行\n#+server's+response+header\nServerTokens+Prod\n#+keepalive+is+ON\nKeepAlive+On\n\n[root@test-vm002+~]#+systemctl+start+httpd\n[root@test-vm002+~]#+systemctl+enable+httpd\nCreated+symlink+from+\u002Fetc\u002Fsystemd\u002Fsystem\u002Fmulti-user.target.wants\u002Fhttpd.service+to+\u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fhttpd.service.\n[root@test-vm002+~]#+vim+\u002Fvar\u002Fwww\u002Fhtml\u002Findex.html\nthis+is+test+page+for+httpd!!!|31clo|访问http:\u002F\u002F172.16.220.133\u002F|f222q|9lks0|安装php|5caqg|[root@test-vm002+~]#+yum+-y+install+php+php-mbstring+php-pear\n[root@test-vm002+~]#+vim+\u002Fetc\u002Fphp.ini\ndate.timezone+=+\"Asia\u002FShanghai\"+++++++\u002F\u002F第878行\n\n[root@test-vm002+~]#+systemctl+restart+httpd\n\n[root@test-vm002+~]#+vim+\u002Fvar\u002Fwww\u002Fhtml\u002Findex.php\n\u003C?php\nphpinfo();\n?\u003E|eh9l1|访问http:\u002F\u002F172.16.220.133\u002Findex.php|75dsu|7v4l4|安装phpLDAP+admin|b8ok0|[root@test-vm002+~]#+wget+http:\u002F\u002Fdl.fedoraproject.org\u002Fpub\u002Fepel\u002Fepel-release-latest-7.noarch.rpm\n[root@test-vm002+~]#+rpm+-ivh+epel-release-latest-7.noarch.rpm\n[root@test-vm002+~]#+yum+repolist+++++++++++++++++++++#检查是否已添加至源列表\n[root@test-vm002+~]#+yum+--enablerepo=epel+-y+install+phpldapadmin\n+\n登陆设置\n[root@test-vm002+~]#+vim+\u002Fetc\u002Fphpldapadmin\u002Fconfig.php\n$servers-\u003EsetValue('login','attr','dn');++++++++++++++++++++\u002F\u002F第387行，打开这行的注释.使用用户名登陆\n\u002F\u002F+$servers-\u003EsetValue('login','attr','uid');++++++++++++++++\u002F\u002F注释掉这行。禁止使用uid登陆\n\n[root@test-vm002+~]#+cat+\u002Fetc\u002Fhttpd\u002Fconf.d\u002Fphpldapadmin.conf\n#\n#++Web-based+tool+for+managing+LDAP+servers\n#\n\nAlias+\u002Fphpldapadmin+\u002Fusr\u002Fshare\u002Fphpldapadmin\u002Fhtdocs\nAlias+\u002Fldapadmin+\u002Fusr\u002Fshare\u002Fphpldapadmin\u002Fhtdocs\n\n\u003CDirectory+\u002Fusr\u002Fshare\u002Fphpldapadmin\u002Fhtdocs\u003E\n++\u003CIfModule+mod_authz_core.c\u003E\n++++#+Apache+2.4\n++++Require+local\n++++Require+ip+172.16.220.0\u002F8+++++++++++++++++\u002F\u002F添加访问权限，由于我本地ip是172.16.220.19，所以这里设置这个网段的访问权限\n++\u003C\u002FIfModule\u003E\n++\u003CIfModule+!mod_authz_core.c\u003E\n++++#+Apache+2.2\n++++Order+Deny,Allow\n++++Deny+from+all\n++++Allow+from+127.0.0.1\n++++Allow+from+::1\n++\u003C\u002FIfModule\u003E\n\u003C\u002FDirectory\u003E\n\n[root@test-vm002+~]#+systemctl+restart+httpd\n[root@test-vm002+share]#+ps+-ef%7Cgrep+httpd\nroot+++++++4150++++++1++0+01:13+?++++++++00:00:00+\u002Fusr\u002Fsbin\u002Fhttpd+-DFOREGROUND\napache+++++4151+++4150++0+01:13+?++++++++00:00:00+\u002Fusr\u002Fsbin\u002Fhttpd+-DFOREGROUND\napache+++++4152+++4150++0+01:13+?++++++++00:00:00+\u002Fusr\u002Fsbin\u002Fhttpd+-DFOREGROUND\napache+++++4153+++4150++0+01:13+?++++++++00:00:00+\u002Fusr\u002Fsbin\u002Fhttpd+-DFOREGROUND\napache+++++4154+++4150++0+01:13+?++++++++00:00:00+\u002Fusr\u002Fsbin\u002Fhttpd+-DFOREGROUND\napache+++++4155+++4150++0+01:13+?++++++++00:00:00+\u002Fusr\u002Fsbin\u002Fhttpd+-DFOREGROUND\napache+++++4177+++4150++0+01:13+?++++++++00:00:00+\u002Fusr\u002Fsbin\u002Fhttpd+-DFOREGROUND\napache+++++4184+++4150++0+01:13+?++++++++00:00:00+\u002Fusr\u002Fsbin\u002Fhttpd+-DFOREGROUND\nroot+++++++4188+++3000++0+01:14+pts\u002F1++++00:00:00+grep+--color=auto+httpd\n+\n[root@test-vm002+share]#+chown+-R+apache.apache+\u002Fusr\u002Fshare\u002Fphpldapadmin|1qmvc|访问http:\u002F\u002F172.16.220.133\u002Fldapadmin\n登陆用户名：cn=Manager,dc=huanqiu,dc=com+++++\n密码是上面的admin@123^0|0|C|0|3A|I|0|0|0|G|0|38|V|0|0|F|4B|G|0|0|1|0|0|0|0|0|0|0|C|D|1|13|2|1Z|1|2L|2|3A|2|3W|2|0|0|D|1I|4|2D|4|3Q|4|5E|7|0|0|F|0|0|8|0|0|0|E|0|0|0|0|0|0|3Y|0|0|H|0|0|0|0|0|0|J|0|0|H|0|0|1J|0|0|0|1|1|0|0|0|E|0|0|1|2|0|15|2A|0|0|0|0|0|L|0|L|2|W|2|1B|2|1N|2|1Z|2|0|0|0|0|1I|0|0|8|0|C|2|N|2|12|2|1E|2|1S|2|0|0|0|0|0|0|A|0|Z|14|0|0|0|0|0|0|0|0|0|0|1U|0|0|0|0|0|0|A|0|0|0|0|0|1|3|0|0|0|0|B|0|0|O|0|0|0|1Z|0|0|I|0|0|K|0|0|0|0|C|0|0|N|0|0|D|0|0|J|0|0|0|0|0|0|0|0|0|0|0|0|0|13|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|2|M|4|0|0|1|5|0|0|0|2|V|6|0|0|1|7|0|0|0|2|V|8^^$0|$1|$2|3|4|5|6|$7|8|9|-4]]|A|$2|3|4|5|6|$7|B|9|-4]]|C|$2|3|4|5|6|$7|D|9|-4]]|E|$2|3|4|5|6|$7|F|9|-4]]|G|$2|H|4|I|6|$J|K]]|L|$2|3|4|5|6|$7|M|9|-4]]|N|$2|H|4|I|6|$J|O]]|P|$2|3|4|5|6|$7|Q|9|-4]]|R|$2|H|4|I|6|$J|S]]]|T|@$U|V|W|X|2|Y|Z|7T|10|@$11|7U|12|7V|13|14]]|15|@]|6|$]]|$U|16|W|17|2|Y|Z|7W|10|@$11|7X|12|7Y|13|14]]|15|@]|6|$]]|$U|18|W|19|2|Y|Z|7Z|10|@]|15|@]|6|$]]|$U|1A|W|1B|2|Y|Z|80|10|@$11|81|12|82|13|14]]|15|@]|6|$]]|$U|1C|W|1D|2|Y|Z|83|10|@$11|84|12|85|13|14]]|15|@]|6|$]]|$U|1E|W|1F|2|Y|Z|86|10|@$11|87|12|88|13|14]|$11|89|12|8A|13|14]]|15|@]|6|$]]|$U|1G|W|1H|2|1I|Z|8B|10|@]|15|@$11|8C|12|8D|U|8E]]|6|$]]|$U|1J|W|1K|2|Y|Z|8F|10|@]|15|@]|6|$]]|$U|1L|W|1M|2|Y|Z|8G|10|@]|15|@]|6|$]]|$U|1N|W|1O|2|1P|Z|8H|10|@]|15|@]|6|$1Q|1R]]|$U|1S|W|1T|2|Y|Z|8I|10|@]|15|@]|6|$]]|$U|1U|W|1V|2|Y|Z|8J|10|@$11|8K|12|8L|13|14]|$11|8M|12|8N|13|14]|$11|8O|12|8P|13|14]|$11|8Q|12|8R|13|14]|$11|8S|12|8T|13|14]|$11|8U|12|8V|13|14]|$11|8W|12|8X|13|14]]|15|@]|6|$]]|$U|1W|W|1X|2|Y|Z|8Y|10|@$11|8Z|12|90|13|14]|$11|91|12|92|13|14]|$11|93|12|94|13|14]|$11|95|12|96|13|14]|$11|97|12|98|13|14]]|15|@]|6|$]]|$U|1Y|W|1Z|2|Y|Z|99|10|@$11|9A|12|9B|13|14]]|15|@]|6|$]]|$U|20|W|21|2|Y|Z|9C|10|@$11|9D|12|9E|13|14]]|15|@]|6|$]]|$U|22|W|23|2|Y|Z|9F|10|@]|15|@]|6|$]]|$U|24|W|25|2|Y|Z|9G|10|@$11|9H|12|9I|13|14]]|15|@]|6|$]]|$U|26|W|27|2|Y|Z|9J|10|@]|15|@]|6|$]]|$U|28|W|29|2|Y|Z|9K|10|@]|15|@]|6|$]]|$U|2A|W|2B|2|Y|Z|9L|10|@]|15|@]|6|$]]|$U|2C|W|2D|2|1P|Z|9M|10|@]|15|@]|6|$1Q|1R]]|$U|2E|W|2F|2|Y|Z|9N|10|@$11|9O|12|9P|13|14]]|15|@]|6|$]]|$U|2G|W|2H|2|Y|Z|9Q|10|@$11|9R|12|9S|13|14]]|15|@]|6|$]]|$U|2I|W|2J|2|1P|Z|9T|10|@]|15|@]|6|$1Q|1R]]|$U|2K|W|2L|2|Y|Z|9U|10|@]|15|@]|6|$]]|$U|2M|W|2N|2|1P|Z|9V|10|@]|15|@]|6|$1Q|1R]]|$U|2O|W|2P|2|Y|Z|9W|10|@]|15|@]|6|$]]|$U|2Q|W|2R|2|Y|Z|9X|10|@$11|9Y|12|9Z|13|14]]|15|@]|6|$]]|$U|2S|W|2T|2|Y|Z|A0|10|@$11|A1|12|A2|13|14]]|15|@]|6|$]]|$U|2U|W|2V|2|Y|Z|A3|10|@$11|A4|12|A5|13|14]]|15|@]|6|$]]|$U|2W|W|2X|2|Y|Z|A6|10|@]|15|@]|6|$]]|$U|2Y|W|1H|2|1I|Z|A7|10|@]|15|@$11|A8|12|A9|U|AA]]|6|$]]|$U|2Z|W|30|2|Y|Z|AB|10|@]|15|@]|6|$]]|$U|31|W|32|2|Y|Z|AC|10|@$11|AD|12|AE|13|14]]|15|@]|6|$]]|$U|33|W|1H|2|1I|Z|AF|10|@]|15|@$11|AG|12|AH|U|AI]]|6|$]]|$U|34|W|35|2|Y|Z|AJ|10|@$11|AK|12|AL|13|14]]|15|@]|6|$]]|$U|36|W|37|2|1P|Z|AM|10|@]|15|@]|6|$1Q|1R]]|$U|38|W|39|2|Y|Z|AN|10|@]|15|@]|6|$]]|$U|3A|W|3B|2|Y|Z|AO|10|@]|15|@]|6|$]]|$U|3C|W|3D|2|Y|Z|AP|10|@$11|AQ|12|AR|13|14]]|15|@]|6|$]]|$U|3E|W|3F|2|Y|Z|AS|10|@$11|AT|12|AU|13|14]|$11|AV|12|AW|13|14]|$11|AX|12|AY|13|14]|$11|AZ|12|B0|13|14]|$11|B1|12|B2|13|14]]|15|@]|6|$]]|$U|3G|W|3H|2|Y|Z|B3|10|@]|15|@]|6|$]]|$U|3I|W|3J|2|1P|Z|B4|10|@]|15|@]|6|$1Q|1R]]|$U|3K|W|3L|2|Y|Z|B5|10|@$11|B6|12|B7|13|14]]|15|@]|6|$]]|$U|3M|W|3N|2|Y|Z|B8|10|@$11|B9|12|BA|13|14]]|15|@]|6|$]]|$U|3O|W|3P|2|Y|Z|BB|10|@$11|BC|12|BD|13|14]|$11|BE|12|BF|13|14]|$11|BG|12|BH|13|14]|$11|BI|12|BJ|13|14]|$11|BK|12|BL|13|14]]|15|@]|6|$]]|$U|3Q|W|3R|2|Y|Z|BM|10|@]|15|@]|6|$]]|$U|3S|W|3T|2|1P|Z|BN|10|@]|15|@]|6|$1Q|1R]]|$U|3U|W|3V|2|Y|Z|BO|10|@]|15|@]|6|$]]|$U|3W|W|3X|2|1P|Z|BP|10|@]|15|@]|6|$1Q|1R]]|$U|3Y|W|3Z|2|Y|Z|BQ|10|@$11|BR|12|BS|13|14]]|15|@]|6|$]]|$U|40|W|41|2|Y|Z|BT|10|@$11|BU|12|BV|13|14]]|15|@]|6|$]]|$U|42|W|43|2|Y|Z|BW|10|@]|15|@]|6|$]]|$U|44|W|45|2|1P|Z|BX|10|@]|15|@]|6|$1Q|1R]]|$U|46|W|47|2|Y|Z|BY|10|@]|15|@]|6|$]]|$U|48|W|49|2|1P|Z|BZ|10|@]|15|@]|6|$1Q|1R]]|$U|4A|W|4B|2|Y|Z|C0|10|@]|15|@]|6|$]]|$U|4C|W|4D|2|Y|Z|C1|10|@]|15|@]|6|$]]|$U|4E|W|4F|2|1P|Z|C2|10|@]|15|@]|6|$1Q|1R]]|$U|4G|W|4H|2|Y|Z|C3|10|@]|15|@]|6|$]]|$U|4I|W|4J|2|Y|Z|C4|10|@$11|C5|12|C6|13|14]]|15|@]|6|$]]|$U|4K|W|4L|2|1P|Z|C7|10|@]|15|@]|6|$1Q|1R]]|$U|4M|W|4N|2|Y|Z|C8|10|@]|15|@]|6|$]]|$U|4O|W|4P|2|Y|Z|C9|10|@]|15|@]|6|$]]|$U|4Q|W|4R|2|1P|Z|CA|10|@]|15|@]|6|$1Q|1R]]|$U|4S|W|4T|2|Y|Z|CB|10|@$11|CC|12|CD|13|14]]|15|@]|6|$]]|$U|4U|W|4V|2|Y|Z|CE|10|@]|15|@]|6|$]]|$U|4W|W|4X|2|1P|Z|CF|10|@]|15|@]|6|$1Q|1R]]|$U|4Y|W|4Z|2|Y|Z|CG|10|@]|15|@]|6|$]]|$U|50|W|1H|2|1I|Z|CH|10|@]|15|@$11|CI|12|CJ|U|CK]]|6|$]]|$U|51|W|52|2|Y|Z|CL|10|@]|15|@]|6|$]]|$U|53|W|54|2|1P|Z|CM|10|@]|15|@]|6|$1Q|1R]]|$U|55|W|56|2|Y|Z|CN|10|@$11|CO|12|CP|13|14]]|15|@]|6|$]]|$U|57|W|58|2|Y|Z|CQ|10|@$11|CR|12|CS|13|14]]|15|@]|6|$]]|$U|59|W|5A|2|1P|Z|CT|10|@]|15|@]|6|$1Q|1R]]|$U|5B|W|5C|2|Y|Z|CU|10|@$11|CV|12|CW|13|14]]|15|@]|6|$]]|$U|5D|W|5E|2|Y|Z|CX|10|@$11|CY|12|CZ|13|14]]|15|@]|6|$]]|$U|5F|W|5G|2|Y|Z|D0|10|@$11|D1|12|D2|13|14]]|15|@]|6|$]]|$U|5H|W|5I|2|Y|Z|D3|10|@]|15|@]|6|$]]|$U|5J|W|5K|2|Y|Z|D4|10|@]|15|@]|6|$]]|$U|5L|W|5M|2|Y|Z|D5|10|@$11|D6|12|D7|13|14]]|15|@]|6|$]]|$U|5N|W|5O|2|Y|Z|D8|10|@$11|D9|12|DA|13|14]]|15|@]|6|$]]|$U|5P|W|5Q|2|Y|Z|DB|10|@$11|DC|12|DD|13|14]]|15|@]|6|$]]|$U|5R|W|5S|2|Y|Z|DE|10|@$11|DF|12|DG|13|14]]|15|@]|6|$]]|$U|5T|W|5U|2|Y|Z|DH|10|@]|15|@]|6|$]]|$U|5V|W|5W|2|1P|Z|DI|10|@]|15|@]|6|$1Q|1R]]|$U|5X|W|5Y|2|Y|Z|DJ|10|@]|15|@]|6|$]]|$U|5Z|W|60|2|1P|Z|DK|10|@]|15|@]|6|$1Q|1R]]|$U|61|W|62|2|Y|Z|DL|10|@]|15|@]|6|$]]|$U|63|W|64|2|Y|Z|DM|10|@]|15|@]|6|$]]|$U|65|W|66|2|1P|Z|DN|10|@]|15|@]|6|$1Q|1R]]|$U|67|W|68|2|Y|Z|DO|10|@]|15|@]|6|$]]|$U|69|W|6A|2|1P|Z|DP|10|@]|15|@]|6|$1Q|1R]]|$U|6B|W|6C|2|Y|Z|DQ|10|@]|15|@]|6|$]]|$U|6D|W|6E|2|1P|Z|DR|10|@]|15|@]|6|$1Q|1R]]|$U|6F|W|6G|2|Y|Z|DS|10|@$11|DT|12|DU|13|14]]|15|@]|6|$]]|$U|6H|W|6I|2|1P|Z|DV|10|@]|15|@]|6|$1Q|1R]]|$U|6J|W|6K|2|Y|Z|DW|10|@]|15|@]|6|$]]|$U|6L|W|6M|2|1P|Z|DX|10|@]|15|@]|6|$1Q|1R]]|$U|6N|W|6O|2|Y|Z|DY|10|@]|15|@]|6|$]]|$U|6P|W|6Q|2|1P|Z|DZ|10|@]|15|@]|6|$1Q|1R]]|$U|6R|W|6S|2|Y|Z|E0|10|@]|15|@]|6|$]]|$U|6T|W|6U|2|1P|Z|E1|10|@]|15|@]|6|$1Q|1R]]|$U|6V|W|6W|2|Y|Z|E2|10|@]|15|@]|6|$]]|$U|6X|W|6Y|2|1P|Z|E3|10|@]|15|@]|6|$1Q|1R]]|$U|6Z|W|70|2|Y|Z|E4|10|@]|15|@]|6|$]]|$U|71|W|72|2|1P|Z|E5|10|@]|15|@]|6|$1Q|1R]]|$U|73|W|74|2|Y|Z|E6|10|@]|15|@]|6|$]]|$U|75|W|76|2|1P|Z|E7|10|@]|15|@]|6|$1Q|1R]]|$U|77|W|78|2|Y|Z|E8|10|@]|15|@]|6|$]]|$U|79|W|7A|2|Y|Z|E9|10|@]|15|@]|6|$]]|$U|7B|W|7C|2|1P|Z|EA|10|@]|15|@]|6|$1Q|1R]]|$U|7D|W|7E|2|Y|Z|EB|10|@]|15|@$11|EC|12|ED|U|EE]]|6|$]]|$U|7F|W|1H|2|1I|Z|EF|10|@]|15|@$11|EG|12|EH|U|EI]]|6|$]]|$U|7G|W|7H|2|Y|Z|EJ|10|@]|15|@]|6|$]]|$U|7I|W|7J|2|1P|Z|EK|10|@]|15|@]|6|$1Q|1R]]|$U|7K|W|7L|2|Y|Z|EL|10|@]|15|@$11|EM|12|EN|U|EO]]|6|$]]|$U|7M|W|1H|2|1I|Z|EP|10|@]|15|@$11|EQ|12|ER|U|ES]]|6|$]]|$U|7N|W|7O|2|Y|Z|ET|10|@]|15|@]|6|$]]|$U|7P|W|7Q|2|1P|Z|EU|10|@]|15|@]|6|$1Q|1R]]|$U|7R|W|7S|2|Y|Z|EV|10|@]|15|@$11|EW|12|EX|U|EY]]|6|$]]]]","plain":"一、LDAP究竟是什么？\nLDAP是轻量目录访问协议，英文全称是Lightweight Directory Access Protocol，一般都简称为LDAP。它是基于X.500标准的，但是简单多了并且可以根据需要定制。与X.500不同，LDAP支持TCP\u002FIP，这对访问Internet是必须的。LDAP的核心规范在RFC中都有定义，所有与LDAP相关的RFC都可以在LDAPman RFC网页中找到。简单说来，LDAP是一个得到关于人或者资源的集中、静态数据的快速方式。 LDAP是一个用来发布目录信息到许多不同资源的协议。通常它都作为一个集中的地址本使用，不过根据组织者的需要，它可以做得更加强大。\n现在市场上有关LDAP的产品已有很多，各大软件公司都在他们的产品中集成了LDAP服务，如Microsoft的ActiveDirectory、Lotus的Domino Directory、IBM的WebSphere中也集成了LDAP服务。LDAP的开源实现是OpenLDAP，它比商业产品一点也不差，而且源码开放。\nOpenLDAP 是最常用的目录服务之一，它是一个由开源社区及志愿者开发和管理的一个开源项目，提供了目录服务的所有功能，包括目录搜索、身份认证、安全通道、过滤器等等。大多数的 Linux 发行版里面都带有 OpenLDAP 的安装包。OpenLDAP 服务默认使用非加密的 TCP\u002FIP 协议来接收服务的请求，并将查询结果传回到客户端。由于大多数目录服务都是用于系统的安全认证部分比如：用户登录和身份验证，所以它也支持使用基于 SSL\u002FTLS 的加密协议来保证数据传送的保密性和完整性。OpenLDAP 是使用 OpenSSL 来实现 SSL\u002FTLS 加密通信的。 \n1.1   LDAP协议简单介绍\n目录是一组具有类似属性、以一定逻辑和层次组合的信息。常见的例子是通讯簿，由以字母顺序排列的名字、地址和电话号码组成。\n目录服务是一种在分布式环境中发现目标的方法。目录具有两个主要组成部分：\n 第一部分是数据库，数据库是分布式的，且拥有一个描述数据的规划。\n第二部分则是访问和处理数据的各种协议。\n录服务其实也是一种数据库系统，只是这种数据库是一种树形结构，而不是通常使用的关系数据库。目录服务与关系数据库之间的主要区别在于：二者都允许对存储数据进行访问，只是目录主要用于读取，其查询的效率很高，而关系数据库则是为读写而设计的。\n温馨提示：目录服务不适于进行频繁的更新，属于典型的分布式结构。 \nLDAP是一个目录服务协议，目前存在众多版本的LDAP，而最常见的则是V2和V3两个版本，它们分别于1995年和1997年首次发布。\n1.2   LDAP的基本模型\nLDAP的基本模型是建立在\"条目\"（Entry）的基础上。一个条目是一个或多个属性的集合，并且具有一个全局唯一的\"可区分名称\"（用dn表示）。与关系型数据（后面简称数据库）进行类比，一个条目相当于数据库中的一条记录，而dn相当于数据库中记录的关键字，属性相当于数据库中的字段。\n温馨提示：dn必须是全局唯一的。 \nLDAP中，将数据组织成一个树形结构，这与现实生活中的很多数据结构可以对应起来，而不像设计关系型数据库的表，需要进行多种变化。如下图所展示的就是一个树形结构的数据。\n?\n在上图所示的树形结构中，树的根结点是一个组织的域名（dlw.com），其下分为3个部分，分别是managers、people和group，可将这3个组看作组织中的3个部门：如managers用来管理所有管理人员，people用来管理登录系统的用户，group用来管理系统中的用户组。当然，在该图中还可继续增加其他分支。\n对于图中所示的树形结构，使用关系数据库来保存数据的话，需要设置多个表，一层一层分别保存，当需要查找某个信息时，再逐层进行查询，最终得到结果。\n若使用目录来保存该图中的数据，则更直观。图中每个结点用一个条目来保存，不同类型的结点需要保存的数据可能不同，在LDAP中通过一个称为objectClass的类型来控制不同结点需要的数据（称为属性）。\n对于目录中的数据怎样进行引用呢？前面提到过，每一个条目都有一个dn，因为dn是唯一的，因此就可找到需要结点的数据。dn的构造方式如下：\n首先得到条目自己的名称（rdn，称为相对dn），然后开始向上逐级查找父结点，一直到根项为止。例如，对于图1-1中最右下方的结点，其dn为：\ndn: cn=ldap, ou=group, o=dlw.com \n通过这样的方式，即可唯一标识每一个结点。在现实生活中，有很多这种树形结构的数据，如计算机文件系统的目录结构、Internet中的域名等。这些类型的数据，只要不需要频繁的更新，都适合用目录来保存。\nLDAP主要的简称含义：\no-\u003E   organization（组织-公司）\nou-\u003E organization unit（组织单元-部门）\nc-\u003E   countryName（国家）\ndc-\u003E domainComponent（域名）\nsn-\u003E  suer name（真实名称）\ncn-\u003E common name（常用名称）\n1.3   LDAP的功能\n在LDAP的功能模型中定义了一系列利用LDAP协议的操作，主要包含以下4部分：\n查询操作：允许查询目录和取得数据，其查询性能比关系数据库好。\n更新操作：目录的更新操作没关系数据库方便，更新性能较差，但也同样允许进行添加、删除、修改等操作。\n复制操作：前面也提到过，LDAP是一种典型的分布式结构，提供复制操作，可将主服务器的数据的更新复制到设置的从服务器中。\n认证和管理操作：允许客户端在目录中识别自己，并且能够控制一个会话的性质。\n1.4   LDAP协议的特点\nLDAP是一种目录服务，保存在特殊的数据库中，数据的读取速度远高于写入速度。\nLDAP对查询做了优化，读取速度优于普通关系数据库。\nLDAP不支持事务、不能进行回滚，需要进行这些操作的应用只有选择关系数据库。\nLDAP采用服务器\u002F客户端模式，支持分布式结构。\nLDAP中的条目以树形结构组织和存储。\nLDAP基于Internet协议，直接运行在简单和通用的TCP\u002FIP或其他可靠的传输协议层上，使连接的建立和包的处理简单、快捷，对于互联网和企业网应用都很方便。\nLDAP协议简单，通过使用查找操作实现列表操作和读操作。\nLDAP通过引用机制实现分布式访问，通过客户端API实现分布式操作（对于应用透明），平衡了负载。\nLDAP实现具有低费用、易配置和易管理的特点，并提供了满足应用程序对目录服务所需求的特性。\n二、管理LDAP\n启动OpenLDAP服务器程序之后，接下来的操作就是通过客户端程序对目录进行操作，包括添加、修改、删除和搜索数据等操作。\n2.1   了解schema\n对于LDAP目录中保存的信息，可以使用LDIF（LDAP Interchange Format）格式来保存。这是一种标准文本文件格式，使用这种格式保存得的LDAP服务器数据库中的数据可方便读取和修改，这也是其他大多数服务配置文件所采取的格式。\nLDIF文件常用来向目录导入或更改记录信息，这些信息需要按照LDAP中schema的格式进行组织，并会接受schema的检查，不符合其要求的格式将会出现报错信息。有关LDIF文件的格式和创建将在第4章进行介绍，这里简单介绍一下组织LDAP数据格式的schema文件。\n在LDAP中，schema用来指定一个目录中所包含的对象（objects）的类型（objectClass），以及每一个类型（objectClass）中必须提供的属性（Atrribute）和可选的属性。可将schema理解为面向对象程序设计中的类，通过类定义一个具体的对象。LDIF中的数据条目可理解为是一个具体的对象，是通过schema来规划创建的。因此，schema是一个数据模型，用来决定数据按什么方式存储，并定义存储在不同的条目（Entry）下的数据之间的关系。schema需要在主配置文件slapd.conf中指定，以用来决定在目录中可以使用哪些objectClass。\n在\u002Fetc\u002Fopenldap\u002Fschema\u002F目录中提供了许多schema文件，只需要在配置文件slapd.conf中使用include命令将需要使用的schema包含即可。例如，配置文件默认包含了以下schema文件：\ninclude \u002Fetc\u002Fopenldap\u002Fschema\u002Fcore.schema\ninclude \u002Fetc\u002Fopenldap\u002Fschema\u002Fcosine.schema\ninclude \u002Fetc\u002Fopenldap\u002Fschema\u002Finetorgperson.schema\ninclude \u002Fetc\u002Fopenldap\u002Fschema\u002Fnis.schema\n温馨提示：通常使用系统提供的schema就可解决大部分应用。管理员也可以自己设计制定schema，一般包括属性定义（AttributeDefinition）、类定义（ClassDefinition）以及语法定义（SyntaxDefinition）等部分。这里就不介绍具体的设计方法了。\n2.2   向目录数据库中添加数据\n初始状态下，LDAP是一个空目录，即没有任何数据。可通过程序代码向目录数据库中添加数据，也可使用OpenLDAP客户端工具ldapadd命令来完成添加数据的操作，该命令可将一个LDIF文件中的条目添加到目录。因此，需要首先创建一个LDIF文件，然后再进行添加操作。\n1）LDIF文本条目格式\nLDIF用文本格式表示目录数据库的信息，以方便用户创建、阅读和修改。在LDIF文件中，一个条目的基本格式如下：\n# 注释\ndn: 条目名\n属性描述: 值\n属性描述: 值\n属性描述: 值\n... ...\ndn行类似于关系数据库中一条记录的关键字，不能与其他dn重复。一个LDIF文件中可以包含多个条目，每个条目之间用一个空行分隔。\n例如，以下内容组成一个条目：\n1: dn: dc=dlw, dc=com\n2: objectclass: top\n3: objectclass: dcobject\n4: objectclass: organization\n5: dc: dlw\n6: o: dlw,Inc.\n在以上文本中，各行含义如下：\n第1行的dn定义该条目的标识。\n第2～4行定义该条目的objectcCass，可以定义多个属性，如上面代码中定义了3个objectClass。条目的属性根据objectClass的不同而不同，有的objectClass有必须设置的属性。在2～4行的3个objectClass中，top没有必须定义的属性，dcobject必须定义属性dc，用来表示一个域名的部分，而organization必须定义属性o，用来表示一个组织的名称。\n根据objectClass的要求，第5、6行分别定义属性dc和属性o的值。\n2.3   了解objectClass\nLDAP中，一个条目必须包含一个objectClass属性，且需要赋予至少一个值。每一个值将用作一条LDAP条目进行数据存储的模板；模板中包含了一个条目必须被赋值的属性和可选的属性。\nobjectClass有着严格的等级之分，最顶层是top和alias。例如，organizationalPerson这个objectClass就隶属于person，而person又隶属于top。\nobjectClass可分为以下3类：\n结构型（Structural）：如person和organizationUnit；\n辅助型（Auxiliary）：如extensibeObject；\n抽象型（Abstract）：如top，抽象型的objectClass不能直接使用。\n在OpenLDAP的schema中定义了很多objectClass，下面列出部分常用的objectClass的名称。\n  ● account\n  ● alias\n  ● dcobject\n  ● domain\n  ● ipHost\n  ● organization\n  ● organizationalRole\n  ● organizationalUnit\n  ● person\n  ● organizationalPerson\n  ● inetOrgPerson\n  ● residentialPerson\n  ● posixAccount\n  ● posixGroup\n2.4   了解Attribute\n属性（Attribute）类似于程序设计中的变量，可以被赋值。在OpenLDAP中声明了许多常用的Attribute（用户也可自己定义Attribute）。常见的Attribute含义如下：\n● c：国家。\n● cn：common name，指一个对象的名字。如果指人，需要使用其全名。\n● dc：domain Component，常用来指一个域名的一部分。\n● givenName：指一个人的名字，不能用来指姓。\n● l：指一个地名，如一个城市或者其他地理区域的名字。\n● mail：电子信箱地址。\n● o：organizationName，指一个组织的名字。\n● ou：organizationalUnitName，指一个组织单元的名字。\n● sn：surname，指一个人的姓。\n● telephoneNumber：电话号码，应该带有所在的国家的代码。\n● uid：userid，通常指某个用户的登录名，与Linux系统中用户的uid不同。\n温馨提示：objectClass是一种特殊的Attribute，它包含其他用到的Attribute以及其自身。\n对于不同的objectClass，通常具有一些必设属性值和一些可选属性值。例如，可使用person这个objectClass来表示系统中一个用户的条目，对于系统中用户通常需要有这样一些信息：姓名、电话、密码、描述等。如下图所示，对于person，通过cn和sn设置用户的名和姓，这是必须设置的，而其他属性则是可选的。\n?\n下面列出部分常用objectClass要求必设的属性。\n● account：userid。\n● organization：o。\n● person：cn和sn。\n● organizationalPerson：与person相同。\n● organizationalRole：cn。\n● organizationUnit：ou。\n● posixGroup：cn、gidNumber。\n● posixAccount：cn、gidNumber、homeDirectory、uid、uidNumber。\n2.5   创建LDIF文件\n对以上内容有一定了解之后，就可以编写输入LDIF文件，编辑需要向目录数据库添加的条目了。\n下面根据如下图所示的结构，创建LDIF文件dlw.com.ldif。\n?\n对上图进行分析，该目录结构分为3层，有4个结点。根据上图可创建LDIF文件如下：\n温馨提示：每个结点可用一个dn表示，对于每个结点，又可继续添加新的结点。如在根结点中可添加其他部门ou，在ou=managers结点也可继续添加其他管理人员的信息。\n1: dn:dc=dlw,dc=com\n2: objectclass:top\n3: objectclass:dcobject\n4: objectclass:organization\n5: dc:dlw\n6: o:dlw,Inc.\n7: \n8: dn:ou=managers, dc=dlw, dc=com\n9: ou:managers\n10: objectclass:organizationalUnit\n11:\n12: dn:cn=dlw,ou=managers,dc=dlw,dc=com\n13: cn:dlw\n14: sn:dongliwei\n15: objectclass:person\n16: \n17: dn:cn=test,ou=managers,dc=dlw,dc=com\n18: cn:test\n19: sn:Test User\n20: objectclass:person\n以上文件中各行的含义如下：\n第1～6行创建根结点，这部分在前面也有介绍，就不再重复了。\n第7、11、16行为空行，用来分隔4个dn条目（4个结点）。\n第8～10行定义cn=managers结点的条目，该条目的objectClass为organizationalUnit，因此需要用ou属性定义组织名称。\n第12～15行定义cn=dlw结点的条目，该条目使用的objectClass为person，因此需设置cn和sn两个属性值。\n第17～20行与第12～15行的意义相同。\n在以上LDIF文件中，第1、8、12、17行以dn开头，这部分内容必须唯一，并且在向目录数据库添加这些数据时，也要确保这些数据不能与目录数据库中已有数据相同，否则，添加操作将中断。\n2.6   从LDIF文件添加到目录数据库\n使用OpenLDAP客户端工具ldapadd命令，可将LDIF文件中的条目添加到目录数据库中，该命令的格式如下：\n# ldappadd  选项  LDIF文件 \n在ldappadd命令中常用的选项如下：\n-x：进行简单认证。\n-D：用来绑定服务器的dn。\n-h：目录服务的地址。\n-w：绑定dn的密码。\n-f：使用LDIF文件进行条目添加的文件。\n将前面编写的LDIF文件的条目数据添加到目录数据库中。\n具体操作步骤如下：\n1）检查dlw.com.ldif文件中的内容，需要注意的是，每个冒号后面都需要空一格，而每行结束处不能留有空格字符。 \n2）使用以下命令将dlw.com.ldif文件中的条目添加到目录中：\n# ldapadd -x -D \"cn=root,dc=dlw,dc=com\" -w secret -f dlw.com.ldif\n温馨提示：如果以上命令执行不成功，需要逐个字符检查dlw.com.ldif文件中的内容，特别注意空格的问题。\n2.7   查询\n添加到目录中的条目被保存在目录数据库，在Linux命令界面下，可使用OpenLDAP客户端工具ldapsearch命令来进行查询。该命令的格式如下：\n# ldapsearch  选项  过滤  属性值\n常用的选项有以下几个:\n-x：进行简单认证。\n-D：用来绑定服务器的dn。\n-w：绑定dn的密码。\n-b：指定要查询的根节点。\n-H：制定要查询的服务器。\n使用ldapsearch命令查询“dc=dlw, dc=com”下的所有条目，可使用以下命令：\n# ldapsearch -x -b \"dc=dlw,dc=com\"  \n而如果使用以下命令，将查询显示sn中以字符wu开头的条目，将得到如下图所示的查询结果，只找到一个条目。\n# ldapsearch -x -b 'dc=dlw,dc=com' 'sn=wu*'  \n2.8   修改条目\n使用OpenLDAP客户端工具ldapmodify命令可对目录数据库中的条目进行修改。该命令的格式如下：\n# ldapmodify  选项\n该命令的选项也很多，常用选项与ldapadd类似，这里就不再列出了。\n温馨提示：使用ldapmodify命令不能修改条目的dn，但可以修改其他属性值。\n使用ldapmodify命令修改条目信息可以有两种方式：一种是交互式进行修改，另一种是通过文件进行修改。\n1) 交互式修改\n修改前面创建的条目\"cn=test, ou=managers, dc=dlw, dc=com\"，将其sn属性修改为\"Test User Modify\"，并添加一个description属性，设置其值为\"add Attribute\"。\n首先输入以下命令，进行修改状态：\n# ldapmodify -x -D \"cn=root,dc=dlw,dc=com\" -W secret  \n执行以上命令后，终端将等候用户输入需要修改条目的dn，输入以下内容：\ndn: cn=test, ou=managers, dc=dlw, dc=com  \nchangetype: modify  \nreplace: sn  \nsn: Test User Modify\n以上输入内容中，第1行查找需要修改的条目，第2行设置修改模式，第3行设置需要替换的属性sn，第4行给属性sn重新设置一个值，替换该属性原有的值。\n输入完以上内容之后再按Enter键，程序将按以上设置更新数据，然后按Ctrl+C键退出修改命令。\n使用以上命令修改条目的数据之后，可使用以下命令查看是否修改成功：\n# ldapsearch -x -b 'dc=dlw,dc=com' 'cn=test'\n2) 通过文件修改\n通过前面的方式对条目进行修改时，很不方便，如果在交互方式时输错了某个字符，只能中断命令后重新进行修改。因此，更好的修改方法是首先将修改时输入的文字保存到一个文件中，然后以该文件作为输入进行修改。用这种方式进行操作，首先需要创建一个临时文件，用来保存需要进行的修改操作，下面演示这种方式的修改过程。\n【例子】通过修改命令将前面LDAP数据库中的信息还原，即将sn属性由“Test User Modify”修改为“Test User”。\n具体操作步骤如下：\n[1]  使用vi编辑器创建一个文件modify，在其中输入以下内容：\ndn: cn=test,ou=managers,dc=dlw,dc=com  \nchangetype: modify  \nreplace: sn  \nsn: Test User\n从以上输入内容可看到，与在交互式时输入的内容完全相同。\n技巧：使用文件方式修改条目，可方便修改和检查，若某个地方有输入错误，可修改后再调用ldapmodify进行修改，减少输入量。\n[2] 使用以下命令调用modify的内容进行修改：\n# ldapmodify -x -D \"cn=root,dc=dlw,dc=com\" -w secret -f modify  \n2.9   删除条目\n对于目录数据库中不用的条目，也可使用ldapdelete命令将其删除。该命令的格式如下：\n# ldapdelete  选项  删除条目\n该命令使用的选项与ldapadd类似，就不再列出来了。\n删除目录数据库中的“cn=test,ou=managers,dc=dlw,dc=com”条目，具体命令如下：\n# ldapdelete -x -D \"cn=root,dc=dlw,dc=com\" -w secret \"cn=test,ou=managers,dc=dlw,dc=com\"  \n顺利执行以上命令后，终端上将不会有任何信息输出，表示完成了删除操作。\n使用ldapdelete命令只能删除树形结构中的叶结点条目，如果删除非叶结点条目，将出现错误提示。例如，执行以下命令删除根结点“dc=dlw,dc=com”，由于根结点下面还有结点，将显示如下图所示的错误提示信息：\n?\n应该使用命令：\n# ldapdelete -x -D \"cn=root,dc=dlw,dc=com\" -w secret \"dc=dlw,dc=com\"  \n2.10   数据导出\n通过ldapadd命令可向目录数据库中添加数据，在某些情况下，可能还需要进行反向操作，即将目录数据库中的数据导出。\n使用ldapsearch命令对目录数据库进行搜索，然后通过重定向将搜索结果保存到一个文件中，可达到导出数据的目的。另外，导出数据更常用的是slapcat命令，该命令的格式如下：\n# slapcat  选项\n最常用的选项就是-l，表示导出为LDIF文件格式。\n如将前面例子中创建的目录数据库导出为export.ldif文件，可使用以下命令：\n# slapcat -l export.ldif \n温馨提示：从导出结果可看出，除了使用ldapadd命令添加到目录数据库中的条目数据外，还导出了很多其他信息，包括条目录UUID、时间戳等信息。\n2.11   设置主从LDAP服务器\n在某些时候，为了对LDAP服务器进行负载均衡，可能希望设置多台LDAP服务器。对于设置多台LDAP服务器的关键问题是数据的同步问题，使用slurpd进程可进行主LDAP服务器向从LDAP服务器复制数据的操作。下面将介绍架设主从LDAP服务器的过程\n2.12   多台LDAP服务器工作过程\n对于多台LDAP服务器，可设置一台为主服务器，其他的为从服务器。本节介绍一台从服务器的配置，若是多台从服务器也可按此步骤进行操作。\n注意：在进行配置之前应首先确保每个LDAP服务器都已安装好OpenLDAP服务器程序，并能正确工作。 \n配置好主从LDAP服务器之后，在主服务器运行slurpd进程，该进程使用LDAP协议从主服务器的数据库更新从服务器的数据，具体操作过程如下：\n1）LDAP客户端向从服务器提交一个LDAP修改请求。\n2）从服务器给LDAP客户端返回一个指向主服务器的引用。\n3）LDAP客户端向主服务器提交LDAP修改请求。\n4）主服务器对数据库中的数据进行修改，并将改变写入本机的日志文件。\n5）在主服务器运行的slurpd进程检查到日志中有新内容，通过日志的信息将改变发送给从服务器。\n6）从服务器接收slurpd发来的信息，对本地数据进行修改。\n以上过程就是使用slurpd进程进行数据复制的过程。从以上过程可看出，需要在主服务器的配置文件中设置要向哪些从服务器发送复制信息、主服务器还要设置一个记录数据改变的日志文件，而从服务器需要设置一个指向主服务器的链接。\n2.13   复制数据库\n首先，把主从服务器关闭。然后通过以下三步操作静态同步主从服务器上的数据：\n把主服务器上\u002Fvar\u002Flib\u002Fldap目录下的所有数据库文件全部拷贝到从服务器的同目录中，覆盖原有文件。\n把主服务器上的\u002Fetc\u002Fldap\u002Fschema目录下的所有schema文件拷贝到从服务器的同目录中，覆盖原有文件。\n把主服务器上\u002Fetc\u002Fldap\u002Fslapd.conf文件拷贝到从服务器的同目录中，覆盖原有文件。\n三、Centos7下完整部署LDAP的操作记录\n3.1   服务器环境介绍\nCentos7.2系统，64 bit,下面的操作都是在root账号下执行的（下面OpenLDAP部署机test-vm002的ip地址是172.16.220.133）\n3.2  OpenLDAP服务部署过程\n1) 安装ldap服务 \n[root@test-vm002 ～]# vim \u002Froot\u002Fldap_install.sh \n#!\u002Fbin\u002Fbash\necho \"install ldap rpm\"\nwget http:\u002F\u002Fdl.fedoraproject.org\u002Fpub\u002Fepel\u002Fepel-release-latest-7.noarch.rpm\nrpm -ivh epel-release-latest-7.noarch.rpm\nyum install -y openldap openldap-clients openldap-servers migrationtools openldap-devel compat-openldap\ncp \u002Fusr\u002Fshare\u002Fopenldap-servers\u002FDB_CONFIG.example \u002Fvar\u002Flib\u002Fldap\u002FDB_CONFIG\nchown ldap. \u002Fvar\u002Flib\u002Fldap\u002FDB_CONFIG\nsystemctl start slapd\nsystemctl enable slapd\n\n[root@test-vm002 ～]# sh -x ldap_install.sh \n默认情况下，slapd服务监听的是389端口\n[root@test-vm002 ～]# lsof -i:389\nCOMMAND  PID USER   FD   TYPE DEVICE SIZE\u002FOFF NODE NAME\nslapd   2940 ldap    8u  IPv4  23618      0t0  TCP *:ldap (LISTEN)\nslapd   2940 ldap    9u  IPv6  23619      0t0  TCP *:ldap (LISTEN)\n2) 配置ldap服务\n首先要设置ldap的管理员密码。生成经处理后的明文密码(这里我输入明文密码admin@123)\n其中 {SSHA}xxxxxxxxxxxxxxxxxxxxxxxx 就是加密处理后的明文密码，之后会用到这个密码。\n[root@test-vm002 ~]# slappasswd\nNew password: \nRe-enter new password: \n{SSHA}wfYgDRZdRyxTuwVg1bzpXjjgAWGNYeN3\n导入chrootpw.ldif文件\n[root@test-vm002 ~]# cd \u002Fetc\u002Fopenldap\u002F\n[root@test-vm002 openldap]# vim chrootpw.ldif \n# specify the password generated above for \"olcRootPW\" section\ndn: olcDatabase={0}config,cn=config\nchangetype: modify\nadd: olcRootPW\nolcRootPW: {SSHA}wfYgDRZdRyxTuwVg1bzpXjjgAWGNYeN3\n\n[root@test-vm002 openldap]# ldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -f chrootpw.ldif\nSASL\u002FEXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\nmodifying entry \"olcDatabase={0}config,cn=config\"\n导入基本Schema模式\n[root@test-vm002 openldap]# ldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fcosine.ldif \nSASL\u002FEXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\nadding new entry \"cn=cosine,cn=schema,cn=config\"\n\n[root@test-vm002 openldap]# ldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fnis.ldif\nSASL\u002FEXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\nadding new entry \"cn=nis,cn=schema,cn=config\"\n\n[root@test-vm002 openldap]# ldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -f \u002Fetc\u002Fopenldap\u002Fschema\u002Finetorgperson.ldif\nSASL\u002FEXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\nadding new entry \"cn=inetorgperson,cn=schema,cn=config\"\n温馨提示：可以有选择的导入下面的Schema模式。这里只选择导入上面三个模式：\n-----------------------------------------------------------------------------------------------\nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fcosine.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fnis.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fcollective.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fcorba.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fcore.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fduaconf.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fdyngroup.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Finetorgperson.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fjava.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fmisc.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fopenldap.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fpmi.ldif \nldapadd -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -D \"cn=config\" -f \u002Fetc\u002Fopenldap\u002Fschema\u002Fppolicy.ldif\n-----------------------------------------------------------------------------------------------\n在ldap的DB中设置域名\n下面输入的明文密码仍是admin@123\n[root@test-vm002 openldap]# slappasswd \nNew password: \nRe-enter new password: \n{SSHA}cm\u002FLXtPjAlGzPWta+Yn3mKiDH53rVfMD\n导入chdomain.ldif文件，这里我使用的域名是huanqiu.com\n[root@test-vm002 openldap]# vim chdomain.ldif \n# replace to your own domain name for \"dc=***,dc=***\" section\n# specify the password generated above for \"olcRootPW\" section\n dn: olcDatabase={1}monitor,cn=config\nchangetype: modify\nreplace: olcAccess\nolcAccess: {0}to * by dn.base=\"gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\"\n  read by dn.base=\"cn=Manager,dc=huanqiu,dc=com\" read by * none\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcSuffix\nolcSuffix: dc=huanqiu,dc=com\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcRootDN\nolcRootDN: cn=Manager,dc=huanqiu,dc=com\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nadd: olcRootPW\nolcRootPW: {SSHA}cm\u002FLXtPjAlGzPWta+Yn3mKiDH53rVfMD\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nadd: olcAccess\nolcAccess: {0}to attrs=userPassword,shadowLastChange by\n  dn=\"cn=Manager,dc=huanqiu,dc=com\" write by anonymous auth by self write by * none\nolcAccess: {1}to dn.base=\"\" by * read\nolcAccess: {2}to * by dn=\"cn=Manager,dc=huanqiu,dc=com\" write by * read\n\n[root@test-vm002 openldap]# ldapmodify -Y EXTERNAL -H ldapi:\u002F\u002F\u002F -f chdomain.ldif\nSASL\u002FEXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\nmodifying entry \"olcDatabase={2}hdb,cn=config\"\n\nmodifying entry \"olcDatabase={2}hdb,cn=config\"\n\nmodifying entry \"olcDatabase={2}hdb,cn=config\"\n\nmodifying entry \"olcDatabase={2}hdb,cn=config\"\n然后导入basedomain.ldif文件\n[root@test-vm002 openldap]# vim basedomain.ldif\n# replace to your own domain name for \"dc=***,dc=***\" section\n dn: dc=srv,dc=world\nobjectClass: top\nobjectClass: dcObject\nobjectclass: organization\no: Server Com\ndc: Huanqiu\n\ndn: cn=Manager,dc=huanqiu,dc=com\nobjectClass: organizationalRole\ncn: Manager\ndescription: Directory Manager\n\ndn: ou=People,dc=huanqiu,dc=com\nobjectClass: organizationalUnit\nou: People\n\ndn: ou=Group,dc=huanqiu,dc=com\nobjectClass: organizationalUnit\nou: Group\n\n如下导入basedomain.ldif文件时需要输入的密码是admin@123\n[root@test-vm002 openldap]# ldapadd -x -D cn=Manager,dc=huanqiu,dc=com -W -f basedomain.ldif\nEnter LDAP Password:                                \nadding new entry \"dc=huanqiu,dc=com\"\n\nadding new entry \"cn=Manager,dc=huanqiu,dc=com\"\n\nadding new entry \"ou=People,dc=huanqiu,dc=com\"\n\nadding new entry \"ou=Group,dc=huanqiu,dc=com\"\n3）关闭防火墙（或开启防火墙，开放389端口访问）\n[root@test-vm002 openldap]# systemctl stop firewalld\n[root@test-vm002 openldap]# systemctl disable firewalld\n[root@test-vm002 openldap]# setenforce 0\n4）添加一个ldap用户(如下，添加用户kevin)\n仍然输入明文密码admin@123\n[root@test-vm002 openldap]# slappasswd\nNew password: \nRe-enter new password: \n{SSHA}NKGiugr+3ceSiv3tkgKYU5w5ywpDy\u002FbP\n\n[root@test-vm002 openldap]# vim ldapuser.ldif\n# create new\n# replace to your own domain name for \"dc=***,dc=***\" section\ndn: uid=kevin,ou=People,dc=huanqiu,dc=com\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\nobjectClass: shadowAccount\ncn: Kevin\nsn: Linux\nuserPassword: {SSHA}NKGiugr+3ceSiv3tkgKYU5w5ywpDy\u002FbP\nloginShell: \u002Fbin\u002Fbash\nuidNumber: 1000\ngidNumber: 1000\nhomeDirectory: \u002Fhome\u002Fkevin\n\ndn: cn=kevin,ou=Group,dc=huanqiu,dc=com\nobjectClass: posixGroup\ncn: Kevin\ngidNumber: 1000\nmemberUid: kevin\n\n如下导入ldapuser.ldif文件时的需要输入的密码是上面的admin@123\n[root@test-vm002 openldap]# ldapadd -x -D cn=Manager,dc=huanqiu,dc=com -W -f ldapuser.ldif\nEnter LDAP Password: \nadding new entry \"uid=kevin,ou=People,dc=huanqiu,dc=com\"\n\nadding new entry \"cn=kevin,ou=Group,dc=huanqiu,dc=com\"\n添加本机的系统用户和群组到ldap目录\n[root@test-vm002 openldap]# vim ldapuser.sh \n# extract local users and groups who have 1000-9999 digit UID\n# replace \"SUFFIX=***\" to your own domain name\n# this is an example\n #!\u002Fbin\u002Fbash\n\nSUFFIX='dc=huanqiu,dc=com'\nLDIF='ldapuser.ldif'\n\necho -n \u003E $LDIF\nGROUP_IDS=()\ngrep \"x:[1-9][0-9][0-9][0-9]:\" \u002Fetc\u002Fpasswd | (while read TARGET_USER\ndo\n    USER_ID=\"$(echo \"$TARGET_USER\" | cut -d':' -f1)\"\n\n    USER_NAME=\"$(echo \"$TARGET_USER\" | cut -d':' -f5 | cut -d' ' -f1,2)\"\n    [ ! \"$USER_NAME\" ] && USER_NAME=\"$USER_ID\"\n\n    LDAP_SN=\"$(echo \"$USER_NAME\" | cut -d' ' -f2)\"\n    [ ! \"$LDAP_SN\" ] && LDAP_SN=\"$USER_NAME\"\n\n    LASTCHANGE_FLAG=\"$(grep \"${USER_ID}:\" \u002Fetc\u002Fshadow | cut -d':' -f3)\"\n    [ ! \"$LASTCHANGE_FLAG\" ] && LASTCHANGE_FLAG=\"0\"\n\n    SHADOW_FLAG=\"$(grep \"${USER_ID}:\" \u002Fetc\u002Fshadow | cut -d':' -f9)\"\n    [ ! \"$SHADOW_FLAG\" ] && SHADOW_FLAG=\"0\"\n\n    GROUP_ID=\"$(echo \"$TARGET_USER\" | cut -d':' -f4)\"\n    [ ! \"$(echo \"${GROUP_IDS[@]}\" | grep \"$GROUP_ID\")\" ] && GROUP_IDS=(\"${GROUP_IDS[@]}\" \"$GROUP_ID\")\n\n    echo \"dn: uid=$USER_ID,ou=People,$SUFFIX\" \u003E\u003E $LDIF\n    echo \"objectClass: inetOrgPerson\" \u003E\u003E $LDIF\n    echo \"objectClass: posixAccount\" \u003E\u003E $LDIF\n    echo \"objectClass: shadowAccount\" \u003E\u003E $LDIF\n    echo \"sn: $LDAP_SN\" \u003E\u003E $LDIF\n    echo \"givenName: $(echo \"$USER_NAME\" | awk '{print $1}')\" \u003E\u003E $LDIF\n    echo \"cn: $USER_NAME\" \u003E\u003E $LDIF\n    echo \"displayName: $USER_NAME\" \u003E\u003E $LDIF\n    echo \"uidNumber: $(echo \"$TARGET_USER\" | cut -d':' -f3)\" \u003E\u003E $LDIF\n    echo \"gidNumber: $(echo \"$TARGET_USER\" | cut -d':' -f4)\" \u003E\u003E $LDIF\n    echo \"userPassword: {crypt}$(grep \"${USER_ID}:\" \u002Fetc\u002Fshadow | cut -d':' -f2)\" \u003E\u003E $LDIF\n    echo \"gecos: $USER_NAME\" \u003E\u003E $LDIF\n    echo \"loginShell: $(echo \"$TARGET_USER\" | cut -d':' -f7)\" \u003E\u003E $LDIF\n    echo \"homeDirectory: $(echo \"$TARGET_USER\" | cut -d':' -f6)\" \u003E\u003E $LDIF\n    echo \"shadowExpire: $(passwd -S \"$USER_ID\" | awk '{print $7}')\" \u003E\u003E $LDIF\n    echo \"shadowFlag: $SHADOW_FLAG\" \u003E\u003E $LDIF\n    echo \"shadowWarning: $(passwd -S \"$USER_ID\" | awk '{print $6}')\" \u003E\u003E $LDIF\n    echo \"shadowMin: $(passwd -S \"$USER_ID\" | awk '{print $4}')\" \u003E\u003E $LDIF\n    echo \"shadowMax: $(passwd -S \"$USER_ID\" | awk '{print $5}')\" \u003E\u003E $LDIF\n    echo \"shadowLastChange: $LASTCHANGE_FLAG\" \u003E\u003E $LDIF\n    echo \u003E\u003E $LDIF\ndone\n\nfor TARGET_GROUP_ID in \"${GROUP_IDS[@]}\"\ndo\n    LDAP_CN=\"$(grep \":${TARGET_GROUP_ID}:\" \u002Fetc\u002Fgroup | cut -d':' -f1)\"\n\n    echo \"dn: cn=$LDAP_CN,ou=Group,$SUFFIX\" \u003E\u003E $LDIF\n    echo \"objectClass: posixGroup\" \u003E\u003E $LDIF\n    echo \"cn: $LDAP_CN\" \u003E\u003E $LDIF\n    echo \"gidNumber: $TARGET_GROUP_ID\" \u003E\u003E $LDIF\n\n    for MEMBER_UID in $(grep \":${TARGET_GROUP_ID}:\" \u002Fetc\u002Fpasswd | cut -d':' -f1,3)\n    do\n        UID_NUM=$(echo \"$MEMBER_UID\" | cut -d':' -f2)\n        [ $UID_NUM -ge 1000 -a $UID_NUM -le 9999 ] && echo \"memberUid: $(echo \"$MEMBER_UID\" | cut -d':' -f1)\" \u003E\u003E $LDIF\n    done\n    echo \u003E\u003E $LDIF\ndone\n)\n\n[root@test-vm002 openldap]# chmod 755 ldapuser.sh\n[root@test-vm002 openldap]# sh ldapuser.sh\n\n下面输入的密码仍然是admin@123\n[root@test-vm002 openldap]# ldapadd -x -D cn=Manager,dc=huanqiu,dc=com -W -f ldapuser.ldif\nEnter LDAP Password: \nadding new entry \"uid=admin,ou=People,dc=huanqiu,dc=com\"\nadding new entry \"uid=wangshibo,ou=People,dc=huanqiu,dc=com\"\nadding new entry \"uid=devs,ou=People,dc=huanqiu,dc=com\"\nadding new entry \"uid=huihui,ou=People,dc=huanqiu,dc=com\"\nadding new entry \"cn=admin,ou=Group,dc=huanqiu,dc=com\"\nadding new entry \"cn=wangshibo,ou=Group,dc=huanqiu,dc=com\"\nadding new entry \"cn=devs,ou=Group,dc=huanqiu,dc=com\"\nadding new entry \"cn=huihui,ou=Group,dc=huanqiu,dc=com\"\n5）安装phpLDAPadmin来web配置LDAP\n安装和配置httpd\n[root@test-vm002 ~]# yum -y install httpd\n[root@test-vm002 ~]# rm -f \u002Fetc\u002Fhttpd\u002Fconf.d\u002Fwelcome.conf\n[root@test-vm002 ~]# vim \u002Fetc\u002Fhttpd\u002Fconf\u002Fhttpd.conf         \u002F\u002F修改下面几行内容\nServerName www.example.com:80                               \u002F\u002F第96行\nAllowOverride All                                           \u002F\u002F第151行\nDirectoryIndex index.html index.cgi index.php               \u002F\u002F第164行\n# add follows to the end                                    \u002F\u002F添加这几行\n# server's response header\nServerTokens Prod\n# keepalive is ON\nKeepAlive On\n\n[root@test-vm002 ~]# systemctl start httpd\n[root@test-vm002 ~]# systemctl enable httpd\nCreated symlink from \u002Fetc\u002Fsystemd\u002Fsystem\u002Fmulti-user.target.wants\u002Fhttpd.service to \u002Fusr\u002Flib\u002Fsystemd\u002Fsystem\u002Fhttpd.service.\n[root@test-vm002 ~]# vim \u002Fvar\u002Fwww\u002Fhtml\u002Findex.html\nthis is test page for httpd!!!\n访问http:\u002F\u002F172.16.220.133\u002F\n?\n安装php\n[root@test-vm002 ~]# yum -y install php php-mbstring php-pear\n[root@test-vm002 ~]# vim \u002Fetc\u002Fphp.ini\ndate.timezone = \"Asia\u002FShanghai\"       \u002F\u002F第878行\n\n[root@test-vm002 ~]# systemctl restart httpd\n\n[root@test-vm002 ~]# vim \u002Fvar\u002Fwww\u002Fhtml\u002Findex.php\n\u003C?php\nphpinfo();\n?\u003E\n访问http:\u002F\u002F172.16.220.133\u002Findex.php\n?\n安装phpLDAP admin\n[root@test-vm002 ~]# wget http:\u002F\u002Fdl.fedoraproject.org\u002Fpub\u002Fepel\u002Fepel-release-latest-7.noarch.rpm\n[root@test-vm002 ~]# rpm -ivh epel-release-latest-7.noarch.rpm\n[root@test-vm002 ~]# yum repolist                     #检查是否已添加至源列表\n[root@test-vm002 ~]# yum --enablerepo=epel -y install phpldapadmin\n \n登陆设置\n[root@test-vm002 ~]# vim \u002Fetc\u002Fphpldapadmin\u002Fconfig.php\n$servers-\u003EsetValue('login','attr','dn');                    \u002F\u002F第387行，打开这行的注释.使用用户名登陆\n\u002F\u002F $servers-\u003EsetValue('login','attr','uid');                \u002F\u002F注释掉这行。禁止使用uid登陆\n\n[root@test-vm002 ~]# cat \u002Fetc\u002Fhttpd\u002Fconf.d\u002Fphpldapadmin.conf\n#\n#  Web-based tool for managing LDAP servers\n#\n\nAlias \u002Fphpldapadmin \u002Fusr\u002Fshare\u002Fphpldapadmin\u002Fhtdocs\nAlias \u002Fldapadmin \u002Fusr\u002Fshare\u002Fphpldapadmin\u002Fhtdocs\n\n\u003CDirectory \u002Fusr\u002Fshare\u002Fphpldapadmin\u002Fhtdocs\u003E\n  \u003CIfModule mod_authz_core.c\u003E\n    # Apache 2.4\n    Require local\n    Require ip 172.16.220.0\u002F8                 \u002F\u002F添加访问权限，由于我本地ip是172.16.220.19，所以这里设置这个网段的访问权限\n  \u003C\u002FIfModule\u003E\n  \u003CIfModule !mod_authz_core.c\u003E\n    # Apache 2.2\n    Order Deny,Allow\n    Deny from all\n    Allow from 127.0.0.1\n    Allow from ::1\n  \u003C\u002FIfModule\u003E\n\u003C\u002FDirectory\u003E\n\n[root@test-vm002 ~]# systemctl restart httpd\n[root@test-vm002 share]# ps -ef|grep httpd\nroot       4150      1  0 01:13 ?        00:00:00 \u002Fusr\u002Fsbin\u002Fhttpd -DFOREGROUND\napache     4151   4150  0 01:13 ?        00:00:00 \u002Fusr\u002Fsbin\u002Fhttpd -DFOREGROUND\napache     4152   4150  0 01:13 ?        00:00:00 \u002Fusr\u002Fsbin\u002Fhttpd -DFOREGROUND\napache     4153   4150  0 01:13 ?        00:00:00 \u002Fusr\u002Fsbin\u002Fhttpd -DFOREGROUND\napache     4154   4150  0 01:13 ?        00:00:00 \u002Fusr\u002Fsbin\u002Fhttpd -DFOREGROUND\napache     4155   4150  0 01:13 ?        00:00:00 \u002Fusr\u002Fsbin\u002Fhttpd -DFOREGROUND\napache     4177   4150  0 01:13 ?        00:00:00 \u002Fusr\u002Fsbin\u002Fhttpd -DFOREGROUND\napache     4184   4150  0 01:13 ?        00:00:00 \u002Fusr\u002Fsbin\u002Fhttpd -DFOREGROUND\nroot       4188   3000  0 01:14 pts\u002F1    00:00:00 grep --color=auto httpd\n \n[root@test-vm002 share]# chown -R apache.apache \u002Fusr\u002Fshare\u002Fphpldapadmin\n访问http:\u002F\u002F172.16.220.133\u002Fldapadmin\n登陆用户名：cn=Manager,dc=huanqiu,dc=com     \n密码是上面的admin@123","brief":"一、LDAP究竟是什么？\nLDAP是轻量目录访问协议，英文全称是Lightweight Directory Access Protocol，一般都简称为LDAP...","summary":"一、LDAP究竟是什么？\nLDAP是轻量目录访问协议，英文全称是Lightweight Directory Access Protocol，一般都简称为LDAP...","abstract":"一、LDAP究竟是什么？\nLDAP是轻量目录访问协议，英文全称是Lightweight Directory Access Protocol，一般都简称为LDAP...","description":"LDAP中，将数据组织成一个树形结构，这与现实生活中的很多数据结构可以对应起来，而不像设计关系型数据库的表，需要进行多种变化。可通过程序代码向目录数据库中添加数据，也可使用OpenLDAP客户端工具ldapadd命令来完成添加数据的操作，该命令可将一个LDIF文件中的条目添加到目录。以上输入内容中，第1行查找需要修改的条目，第2行设置修改模式，第3行设置需要替换的属性sn，第4行给属性sn重新设置一个值，替换该属性原有的值。","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1207996\u002Flz1nhbmttg.jpeg","coverImageUrl":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1207996\u002Flz1nhbmttg.jpeg","sourceType":99,"sourceDetail":{},"channelType":2,"channelDetail":{"source":"cnblogs","originalTime":"2016-08-15 18:24"},"authorId":1207996,"columnId":1819,"writeTime":1516608993,"updateTime":1516608993,"viewCount":6600,"likeCount":13,"commentCount":1,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[10805,10308,10312],"tags":[{"id":10805,"tagId":10805,"name":"数据处理","tagName":"数据处理","articleCount":0,"disable":0},{"id":10308,"tagId":10308,"name":"Linux","tagName":"Linux","articleCount":0,"disable":0},{"id":10312,"tagId":10312,"name":"CentOS","tagName":"CentOS","articleCount":0,"disable":0}],"isCommentEnable":true,"author":{"id":1207996,"name":"用户1207996","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1207996\u002Fpdrwwi0a37.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10308,10244,10245,10312,10315],"specialities":[],"gender":1,"trade":"cloud","growthLevel":0,"isProfessionVerified":false,"status":1,"badgeInfo":{},"fromInfo":{}},"column":{"id":1819,"name":"散尽浮华","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F5.png","background":"","status":2,"creatorId":1207996,"memberCount":1,"articleCount":543,"followCount":114,"createdTime":1515031145,"creator":{"id":1207996,"name":"用户1207996","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1207996\u002Fpdrwwi0a37.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10308,10244,10245,10312,10315],"specialities":[],"gender":1,"trade":"cloud","growthLevel":0,"isProfessionVerified":false,"status":1}},"translator":{},"textLinks":[{"text":"关系型数据库","link":"https:\u002F\u002Fcloud.tencent.com\u002Fproduct\u002Fcdb-overview","mark":"13_1026304"},{"text":"负载均衡","link":"https:\u002F\u002Fcloud.tencent.com\u002Fproduct\u002Fclb","mark":"15_1026304"}],"developerSpreadBanner":{"id":0,"title":"","desc":"","buttonText":"立即抢购","spreadUrl":""}},"articleAuditInfo":null,"commentsData":{"fetchStatus":"none","pageNumber":1,"pageSize":10,"total":0,"list":[]},"sameColumnArticles":[{"id":1026297,"articleId":1026297,"title":"linux系统root密码遗忘的情况下的解决办法","content":"","plain":"","brief":"","summary":"","abstract":"","description":"linux系统root密码遗忘的情况下的解决办法。没办法，只能开机进入“单用户模式”进行密码重置了，记录如下： 1）重启服务器，等到Booting CentOS界面。3）在 root（hd0,0）界面选择第二项 kernel 项，按下e键；进入单用户模式后，输入passwd root密码输入二次密码即可 --\u003E然后reboot进入3模式","picture":"","coverImageUrl":"","sourceType":99,"sourceDetail":{},"channelType":2,"channelDetail":{},"authorId":1207996,"columnId":1819,"writeTime":1516608941,"updateTime":1516608941,"viewCount":226,"likeCount":7,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[10308,10766],"tags":[],"isCommentEnable":true},{"id":1026295,"articleId":1026295,"title":"centos7下部署iptables环境纪录（关闭默认的firewalle）","content":"","plain":"","brief":"","summary":"","abstract":"","description":"centos7下部署iptables环境纪录（关闭默认的firewalle）。由于习惯了用iptables作为防火墙，所以在安装好centos7系统后，会将默认的firewall关闭，并另安装iptables进行防火墙规则设定 [root@localhost ~]# systemctl stop firewalld.service \u002F\u002F停止firewall -A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT [root@localhost ~]# vim \u002Fetc\u002Fselinux\u002Fconfig [root@localhost ~]# setenforce 0 \u002F\u002F使配置立即生效","picture":"","coverImageUrl":"","sourceType":99,"sourceDetail":{},"channelType":2,"channelDetail":{},"authorId":1207996,"columnId":1819,"writeTime":1516608920,"updateTime":1516608920,"viewCount":272,"likeCount":5,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[125],"tags":[],"isCommentEnable":true},{"id":1026286,"articleId":1026286,"title":"Centos下部署DRBD+NFS+Keepalived高可用环境记录","content":"","plain":"","brief":"","summary":"","abstract":"","description":"当Primary主机的故障恢复时，会再次变为DRBD的主节点，并重新夺回VIP资源。如下，DRBD已完成挂载，挂载目录是\u002Fdata inet6 ::1\u002F128 scope host -----------Secondary主机的keepalived.conf配置 ###若重启nfs服务后，仍不正常 根据监控脚本，会主动去启动nfs，只要当启动失败时，才会强制由DRBD的主节点降为备份节点，并关闭keepalived。在上面的主从故障切换过程中，对于客户端来说，挂载NFS不影响使用，只是会有一点的延迟。","picture":"","coverImageUrl":"","sourceType":99,"sourceDetail":{},"channelType":2,"channelDetail":{},"authorId":1207996,"columnId":1819,"writeTime":1516608818,"updateTime":1516608818,"viewCount":1323,"likeCount":5,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true},{"id":1026308,"articleId":1026308,"title":"kvm虚拟化关闭虚拟网卡virbr0的方法","content":"","plain":"","brief":"","summary":"","abstract":"","description":"kvm虚拟化关闭虚拟网卡virbr0的方法。这是由于安装和启用了libvirt服务后生成的，libvirt在服务器（host）上生成一个 virtual network switch (virbr0)，host上所有的虚拟机（guests）通过这个 virbr0 连起来。3）最后重启libvirtd让设置生效 lo Link encap:Local Loopback  RX packets:0 errors:0 dropped:0 overruns:0 frame:0 [root@kvmserver ~]# virsh net-undefine default  再次ifconfig查看，发现virtbr0网卡已经消失了！","picture":"","coverImageUrl":"","sourceType":99,"sourceDetail":{},"channelType":2,"channelDetail":{},"authorId":1207996,"columnId":1819,"writeTime":1516609034,"updateTime":1516609034,"viewCount":202,"likeCount":11,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[10780],"tags":[],"isCommentEnable":true},{"id":1026310,"articleId":1026310,"title":"Linux下selinux简单梳理","content":"","plain":"","brief":"","summary":"","abstract":"","description":"在linux环境下执行某些程序时，偶尔会遇到来一个关于selinux的强制模式不可执行的情况，这种情况下需要关闭selinux或者将enforcing改为permissive模式后才能进行执行。同时，由selinux关闭 (disable) 的状态到开启的状态也需要重新开机！如果你要启动selinux的话，请将上述的selinux=enforcing设定妥当，并且指定selinuxTYPE=targeted 这一个设定，并且到\u002Fboot\u002Fgrub\u002Fmenu.lst这个文件去，看看核心有无关闭selinux。","picture":"","coverImageUrl":"","sourceType":99,"sourceDetail":{},"channelType":2,"channelDetail":{},"authorId":1207996,"columnId":1819,"writeTime":1516609046,"updateTime":1516609046,"viewCount":311,"likeCount":6,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[10308],"tags":[],"isCommentEnable":true}],"adjacentArticles":{"prevArticle":{"id":1026303,"articleId":1026303,"title":"无法启用数据库中的 Service Broker，因为已存在启用的具有相同 ID 的 Service Broker。","content":"","plain":"","brief":"","summary":"","abstract":"","description":"无法启用数据库中的 Service Broker，因为已存在启用的具有相同 ID 的 Service Broker。sql2005数据库，假如名为db1,启用了Service Broker，把db1备份，然后再恢复成db2(即相当于db2就是db1的一次完整镜像备份)，然后用 想启用Broker时，出现以下错误: 解决办法: alter database db2 set NEW_BROKER 然后再运行 ALTER DATABASE db2 set ENABLE_BROKER --验证是否能启用 Select DATABASEpRoPERTYEX('db2','IsBrokerEnabled') ","picture":"","coverImageUrl":"","sourceType":99,"sourceDetail":{},"channelType":2,"channelDetail":{},"authorId":1177036,"columnId":1747,"writeTime":1516608990,"updateTime":1516608990,"viewCount":198,"likeCount":9,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[10244,10253],"tags":[],"isCommentEnable":true},"nextArticle":{"id":1026305,"articleId":1026305,"title":".NET Core 已经实现了PHP JIT，现在PHP是.NET上的一门开发语言","content":"","plain":"","brief":"","summary":"","abstract":"","description":"JIT 可以使程序运行更快。该项目的目标是将遗留的PHP代码编译成可移植的类库，使开发人员能够快速，轻松地为Microsoft平台构建跨平台的应用程序和库。他们已经为Peachpie 上线了商业网站http:\u002F\u002Fwww.peachpiestudio.com\u002F ，为Peachpie的发展提供商业服务支持，你可以在Peachpie编译器平台上找到商业工具和服务，你可以通过Visual Studio\u002FVisual studio code上进行代码的开发。Peachpie使用他们的WordPress版本作为PHP编译为.","picture":"","coverImageUrl":"","sourceType":99,"sourceDetail":{},"channelType":2,"channelDetail":{},"authorId":410847,"columnId":1223,"writeTime":1516609011,"updateTime":1516609011,"viewCount":241,"likeCount":10,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[10180,10167],"tags":[],"isCommentEnable":true}},"relatedArticles":[{"id":1008802,"articleId":1008802,"title":"linux网络编程之socket（九）：使用select函数改进客户端\u002F服务器端程序","content":"","plain":"","brief":"","summary":"一、当我们使用单进程单连接且使用readline修改后的客户端程序，去连接使用readline修改后的服务器端程序，会出现一个有趣的现象，先来看输出：\n先运行服...","abstract":"一、当我们使用单进程单连接且使用readline修改后的客户端程序，去连接使用readline修改后的服务器端程序，会出现一个有趣的现象，先来看输出：\n先运行服...","description":"","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1147827\u002Fg7vmjd84fh.png","coverImageUrl":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1147827\u002Fg7vmjd84fh.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"csdn","originalTime":"2013-06-10 19:45"},"authorId":1147827,"columnId":1601,"writeTime":0,"updateTime":0,"viewCount":507,"likeCount":0,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":1147827,"name":"s1mba","label":"Security engineer and developer","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1147827\u002Fhwzwnwy2xk.jpg","province":"1213","city":"1216","company":"腾讯","title":"高级安全工程师","school":"暨南大学","major":"电子与通信工程","homePage":"https:\u002F\u002Fgithub.com\u002FJnuSimba","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10308,10166,10244,10169,10245],"specialities":[],"gender":1,"trade":"website_new","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":1601,"name":"开发与安全","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F13.png","background":"","status":2,"creatorId":1147827,"memberCount":1,"articleCount":249,"followCount":68,"createdTime":1512964444}},{"id":1194143,"articleId":1194143,"title":"RESTful源码学习笔记之RPC和Restful深入理解","content":"","plain":"","brief":"","summary":"RPC 即远程过程调用（Remote Procedure Call Protocol，简称RPC），像调用本地服务(方法)一样调用服务器的服务(方法)。通常的实...","abstract":"RPC 即远程过程调用（Remote Procedure Call Protocol，简称RPC），像调用本地服务(方法)一样调用服务器的服务(方法)。通常的实...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"cnblogs","originalTime":"2018-08-13 15:08"},"authorId":1729674,"columnId":2644,"writeTime":0,"updateTime":0,"viewCount":112,"likeCount":3,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":1729674,"name":"用户1729674","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1729674\u002Fz9u5ln1lle.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10169,10266,10253,10308,10539],"specialities":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":2644,"name":"JetpropelledSnake","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F18.png","background":"","status":2,"creatorId":1729674,"memberCount":1,"articleCount":428,"followCount":48,"createdTime":1524461937}},{"id":1116028,"articleId":1116028,"title":"万字长文为你深入解读 Linux 用户及用户组管理","content":"","plain":"","brief":"","summary":"\n运维行业正在变革，推荐阅读：30万年薪Linux运维工程师成长魔法\n无论是出于 Linux 本身的多用户多任务分时操作系统的性质，还是出于系统安全的考虑， L...","abstract":"\n运维行业正在变革，推荐阅读：30万年薪Linux运维工程师成长魔法\n无论是出于 Linux 本身的多用户多任务分时操作系统的性质，还是出于系统安全的考虑， L...","description":"","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1751832\u002F6ypyuiww5f.png","coverImageUrl":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1751832\u002F6ypyuiww5f.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2018-02-06","author":"外星人","nickName":"马哥Linux运维","userName":"gh_904f08561055","alias":"magedu-Linux"},"authorId":1751832,"columnId":2708,"writeTime":0,"updateTime":0,"viewCount":425,"likeCount":5,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":1751832,"name":"北京马哥教育","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1751832\u002Frfz4k0r5nf.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10308,10169,10244,10539,10245],"specialities":[],"gender":1,"trade":"education","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":2708,"name":"北京马哥教育","desc":"","icon":"https:\u002F\u002Fask.qcloudimg.com\u002Fcolumn-icons\u002F2708\u002F1751832\u002Fxe8n1v95wo.jpg","background":"","status":2,"creatorId":1751832,"memberCount":2,"articleCount":1673,"followCount":141,"createdTime":1524800738}},{"id":1199729,"articleId":1199729,"title":"常用数据库连接池 (DBCP、c3p0、Druid) 配置说明","content":"","plain":"","brief":"","summary":"数据库连接是一种关键的有限的昂贵的资源，这一点在多用户的网页应用程序中体现得尤为突出。对数据库连接的管理能显著影响到整个应用程序的伸缩性和健壮性，影响到程序的性...","abstract":"数据库连接是一种关键的有限的昂贵的资源，这一点在多用户的网页应用程序中体现得尤为突出。对数据库连接的管理能显著影响到整个应用程序的伸缩性和健壮性，影响到程序的性...","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"cnblogs","originalTime":"2016-03-19 11:51"},"authorId":2409797,"columnId":5096,"writeTime":0,"updateTime":0,"viewCount":346,"likeCount":4,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":2409797,"name":"用户2409797","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F2409797\u002Fjz2btq9nxn.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10323,10244,10262,10310,10164],"specialities":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":5096,"name":"Java修行之道","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F20.png","background":"","status":2,"creatorId":2409797,"memberCount":1,"articleCount":50,"followCount":13,"createdTime":1534837672}},{"id":1347104,"articleId":1347104,"title":"ssh工作原理","content":"","plain":"","brief":"","summary":"1.通过Configuration().configure();读取并解析hibernate.cfg.xml配置文件","abstract":"1.通过Configuration().configure();读取并解析hibernate.cfg.xml配置文件","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"mushiming","originalTime":"2017年2月24日"},"authorId":2939711,"columnId":5017,"writeTime":0,"updateTime":0,"viewCount":152,"likeCount":3,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":2939711,"name":"Java架构师历程","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F2939711\u002Fjnv7c3h0bz.jpeg","province":"1017","city":"1018","company":"","title":"","school":"","major":"","homePage":"http:\u002F\u002Fmushiming.top","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10164,10244,10620,10245,10253],"specialities":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":5017,"name":"Java架构师历程","desc":"","icon":"https:\u002F\u002Fask.qcloudimg.com\u002Fcolumn-icons\u002F5017\u002F2939711\u002Fgm433n4hjg.png","background":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-bgs\u002F5.svg","status":2,"creatorId":2939711,"memberCount":1,"articleCount":143,"followCount":43,"createdTime":1534467688}},{"id":1369997,"articleId":1369997,"title":"c3p0,DBPC,Druid三大连接池的区别\u002F性能【面试+工作】","content":"","plain":"","brief":"","summary":"","abstract":"","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2018-11-06","author":"奋斗蒙","nickName":"Java帮帮","userName":"gh_76ba8ad799db","alias":"javahelp"},"authorId":1345101,"columnId":2132,"writeTime":0,"updateTime":0,"viewCount":274,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":1345101,"name":"奋斗蒙","label":"全国领先的IT新媒体，每天发布前沿技术，解答你工作中最实际的技术问题，更新学习教程，让你时时刻刻学习技术，掌握技术。官方网站www.javahelp.com.cn","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1345101\u002F4wyvx5oizs.png","province":"1029","city":"1036","company":"","title":"","school":"","major":"","homePage":"http:\u002F\u002Fwww.javahelp.com.cn","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10164,10244,10539,10323,10245],"specialities":[],"gender":1,"trade":"website_new","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":2132,"name":"Java帮帮-微信公众号-技术文章全总结","desc":"技术改变生活，能力决定未来！\n免费资源网 http:\u002F\u002Fwww.javahelp.com.cn","icon":"https:\u002F\u002Fask.qcloudimg.com\u002Fcolumn-icons\u002F2132\u002F1345101\u002Fyiovzfdn63.png","background":"","status":2,"creatorId":1345101,"memberCount":1,"articleCount":773,"followCount":109,"createdTime":1518274450}},{"id":1151282,"articleId":1151282,"title":"使用 JMeter 进行压力测试","content":"","plain":"","brief":"","summary":"","abstract":"","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"cnblogs","originalTime":"2018-05-06 11:59"},"authorId":1112474,"columnId":2144,"writeTime":0,"updateTime":0,"viewCount":422,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":1112474,"name":"晓晨","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1112474\u002Fquqqju2z1k.jpg","province":"1257","city":"1258","company":"","title":"微软最有价值专家（Microsoft MVP）","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10185,10180,10292,10318,10244],"specialities":[],"gender":1,"trade":"website","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":2144,"name":"晓晨的专栏","desc":"","icon":"https:\u002F\u002Fask.qcloudimg.com\u002Fcolumn-icons\u002F2144\u002F1112474\u002Fsal8z6lln4.jpg","background":"","status":2,"creatorId":1112474,"memberCount":1,"articleCount":171,"followCount":48,"createdTime":1519399273}},{"id":1108097,"articleId":1108097,"title":"lvm","content":"","plain":"","brief":"","summary":"逻辑卷管理LVM是一个多才多艺的硬盘系统工具。无论在Linux或者其他类似的系统，都是非常的好用。传统分区使用固定大小分区，重新调整大小十分麻烦。但是，LVM可...","abstract":"逻辑卷管理LVM是一个多才多艺的硬盘系统工具。无论在Linux或者其他类似的系统，都是非常的好用。传统分区使用固定大小分区，重新调整大小十分麻烦。但是，LVM可...","description":"","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1731659\u002Fl48jnxwn09.png","coverImageUrl":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1731659\u002Fl48jnxwn09.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"jianshu","originalTime":"2017.09.16 10:06"},"authorId":1731659,"columnId":2671,"writeTime":0,"updateTime":0,"viewCount":425,"likeCount":7,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":1731659,"name":"若与","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1731659\u002Fuvjs2s3kve.png","province":"1213","city":"1216","company":"","title":"后端工程师","school":"湖南工业大学","major":"通信工程","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10244,10138,10796,10174,10169],"specialities":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":2671,"name":"友弟技术工作室","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F20.png","background":"","status":2,"creatorId":1731659,"memberCount":1,"articleCount":123,"followCount":37,"createdTime":1524539142}},{"id":1171214,"articleId":1171214,"title":"从NTDS.dit获取密码hash的三种方法","content":"","plain":"","brief":"","summary":"本文我将为大家介绍一些取证工具，这些工具在渗透测试中将会对我们起到很大的帮助。例如当你提取到了大量的主机内部文件时，你可会发现其中包含如NTDS.dit和系统h...","abstract":"本文我将为大家介绍一些取证工具，这些工具在渗透测试中将会对我们起到很大的帮助。例如当你提取到了大量的主机内部文件时，你可会发现其中包含如NTDS.dit和系统h...","description":"","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1268449\u002F0ivw8v7ksu.jpeg","coverImageUrl":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1268449\u002F0ivw8v7ksu.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2018-07-14","author":"secist","nickName":"FreeBuf","userName":"gh_7524f20253aa","alias":"freebuf"},"authorId":1268449,"columnId":2006,"writeTime":0,"updateTime":0,"viewCount":200,"likeCount":3,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":1268449,"name":"FB客服","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1268449\u002Fflvc0hl3bd.jpeg","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10308,10216,10151,10244,10169],"specialities":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":2006,"name":"FreeBuf","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F12.png","background":"","status":2,"creatorId":1268449,"memberCount":1,"articleCount":3547,"followCount":198,"createdTime":1516779728}},{"id":1177407,"articleId":1177407,"title":"C++实现简易log日志系统","content":"","plain":"","brief":"","summary":"在软件开发周期中，不管是前台还是后台，系统一般会采用一个持久化的日志系统来记录运行情况。","abstract":"在软件开发周期中，不管是前台还是后台，系统一般会采用一个持久化的日志系统来记录运行情况。","description":"","picture":"","coverImageUrl":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"csdn","originalTime":"2015年07月16日 10:46:11"},"authorId":2609282,"columnId":4408,"writeTime":0,"updateTime":0,"viewCount":715,"likeCount":2,"commentCount":0,"favorCount":0,"weight":0,"status":2,"draftId":0,"tagIds":[],"tags":[],"isCommentEnable":true,"author":{"id":2609282,"name":"Dabelv","label":"向一名优秀的程序员迈进","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F2609282\u002Ffktdybnp21.png","province":"1213","city":"1216","company":"腾讯","title":"后台开发工程师","school":"华南理工大学","major":"软件工程","homePage":"https:\u002F\u002Fdablelv.github.io\u002Fdablelvweb\u002Fhome.html","region":1,"jobType":1,"graduationDate":"","education":0,"specialityIds":[10539,10151,10308,10245,10309],"specialities":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":true,"status":1},"column":{"id":4408,"name":"C\u002FC++基础","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F2.png","background":"","status":2,"creatorId":2609282,"memberCount":1,"articleCount":472,"followCount":39,"createdTime":1531276041}}],"anchorToCommentsArea":false,"isFromOriginalSharing":false,"isCampusAmabassdor":false,"hasColumnArticleRecommendRight":false,"env":"production","documentBaseTitle":"云+社区 - 腾讯云","cdnDomain":"imgcache.qq.com","cssDomain":"imgcache.qq.com","session":{"isLogined":false,"isQcloudUser":false,"isOwner":false,"nickname":"","accountInfoCompleted":false,"profile":{}},"fromMiniProgram":false,"route":{"url":"\u002Fdeveloper\u002Farticle\u002F1026304","path":"\u002Fdeveloper\u002Farticle\u002F1026304","pathname":"\u002Fdeveloper\u002Farticle\u002F1026304","search":"","query":{},"segments":["developer","article","1026304"]}});
</script><script src="https://cloud.tencent.com/qccomponent/loader.js" async=""></script><script src="//imgcache.qq.com/qcloud/main/scripts/release/common/qcloudStatApi.js" async=""></script></body></html>