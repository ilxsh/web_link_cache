define("wkview:widget/common_toc_reader/reader_txt/lib/view.js",function(e,t,i){var n=e("wkcommon:widget/lib/tangram/base/base.js"),r=e("wkcommon:widget/ui/lib/jquery/jquery.js"),o=n.lang.createClass(function(e){this.config=e},{type:"txt_reader_view"}).extend({init:function(){this.$el=r(this.config.container)},render:function(e){this.$el.html(e),this.$el.css("height","auto"),n.event.fire(window,"resize"),n.lang.eventCenter.dispatchEvent("v:renderAfter"),r(window).trigger("firstRender")},getPageNoByTop:function(e){if(0>=e)return 1;var t=this.config.totalPageNum,i=Math.floor(e/(this.$el.height()/t))+1;return i>t?t:i},scale:function(e){var t=.02,i=20*e/600+"px",n=40*e/600+"px",o=parseInt(t*e,10);r(".p-txt").css({"font-size":o+"px","line-height":1.4,margin:'"'+i+" "+n+'"'})}});i.exports=o});
;define("wkview:widget/common_toc_reader/reader_txt/lib/model.js",function(e,a,t){var r=e("wkcommon:widget/lib/tangram/base/base.js"),n=e("wkcommon:widget/ui/lib/jquery/jquery.js"),o=e("wkcommon:widget/lib/fis/data/data.js"),i=r.lang.createClass(function(e){this.config=e},{type:"txt_reader_model"}).extend({requestUrl:"/browse/getrequest",proxyUrl:"//wkretype.bdimg.com/retype/text/",docInfoUrl:"//wenku.baidu.com/api/doc/getdocinfo",paragraph:[],init:function(){var e=new n.Deferred;return e.resolve(),e.promise()},getDocInfo:function(){var e=this.config.docInfoUrl||this.docInfoUrl;return n.ajax({url:e,dataType:"jsonp",jsonpCallback:"cb",data:{doc_id:this.config.doc_id,t:(new Date).getTime()}})},getData:function(e,a){a=a||{},e=a.start||0,this.currentStart=e;var t=this;this.getDocInfo().then(function(e){var r=e.md5sum.substring(1),o=e.docInfo||{},i=1!==+o.isPaymentDoc||o.ispaied?o.totalPageNum:o.freepagenum,c=t.hidePrivateInfo("&");n.ajax({url:t.proxyUrl+t.config.doc_id+"?"+r+c,data:{pn:1,rn:i,type:"txt",rsign:e.rsign},dataType:"jsonp",jsonpCallback:"cb",jsonp:"callback",success:function(e){var r="",n=t.config.apn;if(n)r=e[n-1].parags[0].c,t.format(r,a);else{for(var o=0;o<e.length;o++){var i=o>=3?"hidden-doc-banner":"";r=['<div class="reader-page-wrap '+i+'" id="reader-pageNo-'+(o+1)+'">',t.format(e[o].parags[0].c),"</div>"].join(""),t.paragraph+=r}a.silent||t.fire("reset")}}})})},hidePrivateInfo:function(e){e=e||"";var a="",t=o.get("WkInfo").DocInfo,r=t.isPrivate||!1,n=19===parseInt(t.flag||0,10);return(r||n)&&(a=e+"spr=1"),a},format:function(e){var a="p-txt";return e=e.replace(/</g,"&lt").replace(/>/g,"&gt").replace(/"/g,"&quot;"),e='<p class="'+a+'">'+e.replace(/\n/g,'</p>\n<p class="'+a+'">')+"</p>"}});t.exports=i});
;define("wkview:widget/common_toc_reader/reader_txt/lib/factory.js",function(e,i,t){var n=e("wkcommon:widget/lib/tangram/base/base.js"),o=e("wkcommon:widget/ui/lib/jquery/jquery.js"),r=e("wkview:widget/common_toc_reader/reader_txt/lib/view.js"),a=e("wkview:widget/common_toc_reader/reader_txt/lib/model.js"),d=n.lang.createClass(function(e){this.config=e,this.init()},{type:"txt_reader"}).extend({View:r,Model:a,init:function(){var e=this;e.model=new e.Model(this.config),e.view=new e.View(this.config),o.when(e.view.init(),e.model.init()).then(function(){e.model.getData()}),e.bindEvent()},bindEvent:function(){var e=this;e.model.on("reset",function(){e.view.render(e.model.paragraph),e.fire("resize")})},getPageNoByTop:function(e){return this.view.getPageNoByTop(e)}});t.exports=d});
;define("wkview:widget/common_toc_reader/reader_txt/index.js",function(e,o,t){var i=e("wkcommon:widget/ui/lib/jquery/jquery.js"),n=e("wkcommon:widget/ui/js_core/log/log.js"),r=e("wkcommon:widget/lib/fis/data/data.js"),a=e("wkcommon:widget/ui/js_core/util/util.js"),s=e("wkcommon:widget/ui/js_core/widget/widget.js").widget,d=e("wkview:widget/common_item/topMessage/topMessage.js").topMessage,c=e("wkview:widget/common_item/setting/setting.js").setting,w=e("wkview:widget/common_item/autofixed/autofixed.js").autofixed,g=e("wkview:widget/ui/util/util.js"),l=e("wkview:widget/common_toc_reader/reader_txt/lib/factory.js"),m=e("wkview:widget/common_toc_toolbar/config.js").config,p=e("wkview:widget/common_toc_toolbar/item/fullScreen/fullScreenTxt.js").fullScreen,f=e("wkview:widget/common_toc_toolbar/item/page/page.js").page,h=e("wkview:widget/common_toc_toolbar/item/zoom/zoom_txt.js").zoom,u=e("wkview:widget/common_toc_toolbar/toolbar/toolbar.js").toolbar,v=e("wkview:widget/common_toc_toolbar/item/coreBtns/coreBtns.js").coreBtns,_=e("wkview:widget/common_toc_toolbar/item/favo/favo.js").favo,b=e("wkview:widget/common_toc_toolbar/item/appraise/appraise.js").appraise,j=e("wkview:widget/common_toc_toolbar/item/share/share.js").share,k=e("wkview:widget/common_toc_toolbar/item/praise/praise.js").praise,P=e("wkview:widget/model/vipData.js"),x=e("wkview:widget/common_toc_toolbar/item/wangpan/wangpan.js").wangpan,y=e("wkcommon:widget/ui/lib/cookie/cookie.js"),C=e("wkcommon:widget/performance/performance.js"),B=0,z=r.get("WkInfo"),E=z.DocInfo||{},S=(z.UserInfo||{},s({options:{},_init:function(){i("body").addClass("newTools"),m.doc_id=m.doc_id||this.options.doc_id,this.reader=new l(this.options),c.currentPage=this.toPage,P.run(i.proxy(this.render,this),i.proxy(this.render,this)),n.xsend(1,100923)},render:function(){this.toolsBar=new u({readerContainer:this,reader:this.reader,items:this.getToolsBarItems()}),this.fullScreen=new p({readerContainer:this,toolsBar:this.toolsBar,reader:this.reader,status:"disabled"}),T.dom.addClass(this.fullScreen.el,"top-right-fullScreen"),this.el.appendChild(this.fullScreen.el),(!T.browser.ie||T.browser.ie>7)&&(this.autofixed=new w({el:T.g("fixed-box")})),this.secondClassify=z.DocInfo.cid3||"",m=a.mix(m,this.options,!0),m.shareElId=this.shareElId,this.resize(),T.lang.eventCenter.dispatchEvent("xreaderResizeRight"),this.bindEvent()},bindEvent:function(){var e=this;T.lang.eventCenter.addEventListener("Reader.zoomChange",T.fn.bind(e.resize,e)),T.lang.eventCenter.addEventListener("v:renderAfter",function(){e.toPage>1&&setTimeout(function(){e.gotoPage(e.toPage);var o=new d({toolsBar:e.toolsBar,readerContainer:e});o.render()},200),e.getPageByPosition()}),T.lang.eventCenter.addEventListener("Reader.zoomChange",function(){e.getPageByPosition()}),i(window).on("firstRender",function(){C.sendPerformanceLog({index:"txt",item:"firstRender"})});var o=a.debounce(function(){var o=i(window).scrollTop();o!==B&&(B=o,e.getPageByPosition(o))},100);T.event.on(window,"scroll",o),T.event.on(window,"onbeforeunload",function(){var o=c.currentPage,t=0;g.saveViewedPage(e.doc_id,o,t)}),this.wangpanDialog()},getToolsBarItems:function(){var e=this,o=[];return o="1"===E.can_dump?[p,h,k,_,b,e.isPrivate?null:j,x,f,v]:[p,h,k,_,b,e.isPrivate?null:j,f,v]},getPageByPosition:function(e){var o=i(window).scrollTop(),t=T.dom.getPosition(this.el).top;this.createPagesTop(),e=e&&e-t+22||o-t+22;var r=this.pageTops.concat([]);r.push(e),r.sort(function(e,o){return o>e?-1:1});var a=T.array.indexOf(r,e);0>=a&&(a=1),c.currentPage=a,a!==this.prevPn&&n.xsend(1,100037,{secondClassify:this.secondClassify,pn:a,out:0}),this.prevPn=a,T.lang.eventCenter.dispatchEvent("Reader.scroll",{currentPage:c.currentPage})},gotoPage:function(e){var o=T.dom.g("reader-pageNo-"+e),t=T.dom.getPosition(o).top-20;window.scrollTo(0,t),c.currentPage=e},createPagesTop:function(){for(var e=i(".reader-page-wrap"),o=[],t=T.dom.getPosition(this.el).top,n=0;n<e.length;n++){var r=e.eq(n);if(r.is(":hidden"))break;var a=r.offset().top-t;a=0>a?0:a,o.push(a)}this.pageList=e,this.pageTops=o},resize:function(){var e=this;e.toolsBar.resize({readerWidth:e.el.offsetWidth,bodyElWidth:T.dom.query(m.bodySelector)[0].offsetWidth})},wangpanDialog:function(){y.get("wangpanTipShow")||i(".wangpan-tip").show(),i(document).on("click",".wangpan-tip .btn-close",function(){i(".wangpan-tip").hide(),y.set("wangpanTipShow",1,{expires:864e5})})}}));t.exports=S});
;define("wkview:widget/common_toc_reader/reader_txt/js/fullScreen.js",function(e,t,n){var l=e("wkcommon:widget/lib/tangram/base/base.js"),o=e("wkcommon:widget/ui/js_core/widget/widget.js").widget,i=e("wkcommon:widget/ui/js_core/util/util.js"),r=e("wkview:widget/common_toc_toolbar/config.js").config,d=e("wkview:widget/common_item/setting/setting.js").setting,s=i.uniqueId(),c=e("wkcommon:widget/ui/js_core/log/log.js"),a=964,u=o({Options:{position:"left",zoomLevel:1},_init:function(){var e=['<a class="ic reader-fullScreen xllDownloadLayerHit_left" href="javascript:;" title="\u5168\u5c4f\u663e\u793a"','data-toolsBar-log="fullscreen"  alog-action="htmltoolbar.fullscreen">',"</a>"].join("");this.el=i.createDom(e),this.placeholder=i.createDom('<div class="reader-placeholder" id="reader-placeholder-'+s+'"></div>'),this.bindEvent(),this.isFullScreen=d.isFullScreen},bindEvent:function(){var e=this;l.lang.eventCenter.on("fullScreen",l.fn.bind(e.doFullScreen,e)),l.lang.eventCenter.on("inFullScreen",l.fn.bind(e.doInFullScreen,e)),l.event.on(this.el,"click",function(t){if(d.isFullScreen)e.inFullScreen();else{e.fullScreen();var n="";($(".newTools").length>0||$(".flowPPt").length>0)&&(n="newtools"),c.xsend(1,101487,{pcViewChange:n})}l.event.preventDefault(t)}),l.event.on(document.body,"keyup",function(t){var n=l.event.getKeyCode(t);d.isFullScreen&&27===n&&e.inFullScreen()}),l.event.on(window,"resize",l.fn.bind(function(){d.isFullScreen?(l.lang.eventCenter.dispatchEvent("Reader.fullScreenResize"),e.resizePlaceholder(),e.fullScreenResize()):l.lang.eventCenter.dispatchEvent("Reader.windowResize")},e))},resizePlaceholder:function(){var e=this,t=e.placeholder,n=e.readerContainer.el.offsetHeight,o=t.parentNode?l.dom.getPosition(t.parentNode).top:0;t.parentNode&&l.dom.setStyle(e.placeholder,"height",n-o+"px")},fullScreen:function(){l.lang.eventCenter.dispatchEvent("fullScreen")},doFullScreen:function(){var e=l.dom.query(r.aside)[0],t=this.readerContainer.el,n=l.dom.getPosition(t.parentNode).top;if(d.isFullScreen||(a=t.offsetWidth,l.lang.eventCenter.dispatchEvent("InFullScreen.before"),l.dom.addClass(t,"fullScreen-container"),l.dom.insertAfter(this.placeholder,t),this.fullScreenResize()),l.dom.addClass(this.el,"isFullScreen"),l.dom.setAttr(this.el,"title","\u6062\u590d\u7a97\u53e3"),l.dom.hide(e),l.dom.setStyles("doc",{overflow:"hidden"}),!d.isFullScreen){document.body.appendChild(t),l.dom.setStyles(t,{position:"absolute",top:0,left:0,"z-index":1003}),l.dom.show(this.placeholder),document.documentElement.style.overflowX="hidden",l.lang.eventCenter.dispatchEvent("InFullScreen.after");var o=t.offsetHeight;l.dom.setStyle(this.placeholder,"height",o-n+"px")}d.isFullScreen=!0},inFullScreen:function(){l.lang.eventCenter.dispatchEvent("inFullScreen")},doInFullScreen:function(){var e=l.dom.query(r.aside)[0],t=this.readerContainer.el;d.isFullScreen&&(l.lang.eventCenter.dispatchEvent("OutFullScreen.before"),l.dom.setStyle(t,"width",a+"px"),l.dom.removeClass(t,"fullScreen-container")),l.dom.removeClass(this.el,"isFullScreen"),l.dom.setAttr(this.el,"title","\u5168\u5c4f\u663e\u793a"),l.dom.show(e),l.dom.setStyle("doc","overflow","hidden"),d.isFullScreen&&(l.dom.insertBefore(t,this.placeholder),l.dom.removeStyle(t,"top"),l.dom.removeStyle(t,"left"),l.dom.removeStyle(t,"position"),l.dom.removeStyle(t,"z-index"),l.dom.hide(this.placeholder),document.documentElement.style.overflowX="",l.lang.eventCenter.dispatchEvent("OutFullScreen.after")),d.isFullScreen=!1},fullScreenResize:function(){var e=this.readerContainer.el,t=l.page.getViewWidth();980>t?(e.style.width="980px",this.reader.view.scale(980)):(e.style.width=t+"px",this.reader.view.scale(t))}});n.exports.fullScreen=u});