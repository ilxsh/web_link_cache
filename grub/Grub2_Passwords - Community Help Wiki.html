<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>Grub2/Passwords - Community Help Wiki</title>
<script type="text/javascript" src="/moin_static198/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static198/light/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/moin_static198/light/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/moin_static198/light/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/moin_static198/light/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static198/light/css/msie.css">
<![endif]-->


<link rel="alternate" title="Community Help Wiki: Grub2/Passwords" href="/community/Grub2/Passwords?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=Grub2%2FPasswords&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="/community/CommunityHelpWiki">
<link rel="Alternate" title="Wiki Markup" href="/community/Grub2/Passwords?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/community/Grub2/Passwords?action=print">
<link rel="Up" href="/community/Grub2">
<link rel="Appendix" title="g2_grub.pbkdf2.png" href="/community/Grub2/Passwords?action=AttachFile&amp;do=view&amp;target=g2_grub.pbkdf2.png">
<link rel="Appendix" title="g2_password_menu.png" href="/community/Grub2/Passwords?action=AttachFile&amp;do=view&amp;target=g2_password_menu.png">
<link rel="Appendix" title="important.png" href="/community/Grub2/Passwords?action=AttachFile&amp;do=view&amp;target=important.png">
<link rel="Appendix" title="info.png" href="/community/Grub2/Passwords?action=AttachFile&amp;do=view&amp;target=info.png">
<link rel="Search" href="/community/FindPage">
<link rel="Index" href="/community/TitleIndex">
<link rel="Glossary" href="/community/WordIndex">
<link rel="Help" href="/community/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">


    <div id="leftbanner">
    </div>
    <div id="rightbanner">
    </div>
    <div id="container">
        <div id="container-inner">
	    <div id="mothership">
		<ul>
	            <li><a href="https://partners.ubuntu.com">Partners</a> </li>
        	    <li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
        	    <li><a href="https://community.ubuntu.com">Community</a></li>
        	    <li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
	        </ul>
	    </div>
            <div id="header">
                <h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
                <ul id="main-menu">
                    <li><a href="https://help.ubuntu.com/">Official Documentation</a></li>
                    <li><a class="main-menu-item current" href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
                    <li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
                </ul>
            </div>
            <div id="menu-search">
                <div id="subheader"> 
                    <div class="subheader-menu"> 
                        <div id="second-nav">
<ul id="username"><li><a class="nbinfo" href="/community/Grub2/Passwords?action=info" rel="nofollow">Page History</a></li><li><a href="/community/Grub2/Passwords?action=login&amp;login=1" id="login" rel="nofollow">Login to edit</a></li></ul>
 </div> 
    <div id="user-info"> 
    </div>
 

                            
                        </div> 
                    </div> 


                    <div id="search-box">

<noscript>
 <form action="http://www.google.com/cse" id="cse-search-box">
   <div>
     <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq" />
     <input type="hidden" name="ie" value="UTF-8" />
     <input type="text" name="q" size="21" />
     <input type="submit" name="sa" value="Search" />
   </div>
 </form>
</noscript>

<script>
 document.write('<form action="https://help.ubuntu.com/search.html" id="cse-search-box">');
 document.write('  <div>');
 document.write('    <input type="hidden" name="cof" value="FORID:9" />');
 document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq" />');
 document.write('    <input type="hidden" name="ie" value="UTF-8" />');
 document.write('    <input type="text" name="q" size="21" />');
 document.write('    <input type="submit" name="sa" value="Search" />');
 document.write('  </div>');
 document.write('</form>');
</script>


                    </div>
                </div>
                <div id="title"><h1>
<span id="pagelocation"><span class="pagepath"><a href="/community/Grub2">Grub2</a></span><span class="sep">/</span><a href="/community/Grub2/Passwords">Passwords</a></span>
</h1>
                </div>
            <div id="cwt-nav3">

 <hr class="clear" />
            </div>
                <div id="cwt-content" class="clearfix content-area">

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><div><table style="float:right;  font-size:0.9em;  width:40%;  background:#F1F1ED;  margin: 0 0 1em 1em;"><tbody><tr>  <td style="padding:0.5em;"><p class="line891"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Grub_2_Password_Protection">Grub 2 Password Protection</a></li><li>
<a href="#GRUB_2_Password_Protection_Notes">GRUB 2 Password Protection Notes</a></li><li>
<a href="#How_It_Works">How It Works</a></li><li>
<a href="#Warnings_.26_Cautions">Warnings &amp; Cautions</a></li><li>
<a href="#Setting_Up_Password_Protection">Setting Up Password Protection</a><ol><li>
<a href="#Superuser_.26_Password_Designation_.28Required.29">Superuser &amp; Password Designation (Required)</a></li><li>
<a href="#Other_Users_.28Optional.29">Other Users (Optional)</a></li><li>
<a href="#Protecting_Menuentries">Protecting Menuentries</a><ol><li>
<a href="#Adding_Protection_to_Ubuntu_Entries">Adding Protection to Ubuntu Entries</a></li><li>
<a href="#Adding_Protection_to_Other_Entries">Adding Protection to Other Entries</a></li><li>
<a href="#Protect_the_Windows_Recovery_Partition">Protect the Windows Recovery Partition</a></li></ol></li></ol></li><li>
<a href="#Password_Encryption">Password Encryption</a></li><li>
<a href="#Links">Links</a></li></ol></div></td>
</tr>
</tbody></table></div><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
<h1 id="Grub_2_Password_Protection">Grub 2 Password Protection</h1>
<span class="anchor" id="line-4"></span><p class="line874">GRUB 2 offers basic password protection for its menu and terminal. The user can set up passwords to protect the entire menu or specific menuentries. Passwords can be required for all users or only for selected users. The passwords can be stored in encrypted or unencrypted format. This page will detail the procedures necessary to establish and use the GRUB 2 password option. <span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><ul><li style="list-style-type:none"><p class="line891"><img alt="g2_password_menu.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=g2_password_menu.png" title="g2_password_menu.png" /> <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span></li></ul><p class="line862">In this guide, when the term "GRUB" is used it refers to GRUB 2, version 1.99 or later. Some features such as encrypted passwords may not be available in earlier versions. Users can check the version of GRUB they are using with <strong><tt class="backtick">grub-install&nbsp;-V</tt></strong> <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line867"><img alt="important.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=important.png" title="important.png" /> Note: The password security available with GRUB 2 provides basic protection to prevent an unauthorized user from gaining access to the operating system(s) via the GRUB 2 menu. Persons with physical access to the computer can gain access to the files via other methods which GRUB 2 cannot prevent. <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line867">
<h1 id="GRUB_2_Password_Protection_Notes">GRUB 2 Password Protection Notes</h1>
<span class="anchor" id="line-13"></span><p class="line874">Grub 2 can establish password requirements on: <span class="anchor" id="line-14"></span><ul><li>All menuentries <span class="anchor" id="line-15"></span></li><li>Specific menuentries <span class="anchor" id="line-16"></span></li><li>For specific users <span class="anchor" id="line-17"></span><ul><li>For example, user "Jane" can access Ubuntu but not the Windows recovery mode, which is only accessible by "John", the superuser. <span class="anchor" id="line-18"></span></li></ul></li><li>The administrator must enable password protection manually by editing the GRUB 2 system files. <span class="anchor" id="line-19"></span></li><li><p class="line862">Users and passwords should be identified in the <em>/etc/grub.d/00_header</em> or another GRUB 2 script file. <span class="anchor" id="line-20"></span></li><li>Unless universal protection of all menuentries is is desired, the specific entries must be identified: <span class="anchor" id="line-21"></span><ul><li><p class="line862">Manually by editing the Grub 2 <em>/etc/grub.d/</em> scripts such as <em>10_linux</em> and <em>30_os-prober</em> <span class="anchor" id="line-22"></span></li><li>Manually by editing a custom configuration file created by the user. <span class="anchor" id="line-23"></span></li></ul><ul><li><p class="line862">Either of the above methods enables GRUB 2 to automatically add the password requirement to the the configuration file (<em>grub.cfg</em>) whenever <strong><tt class="backtick">update-grub</tt></strong> is executed. <span class="anchor" id="line-24"></span></li><li><p class="line862">Manually by editing <em>/boot/grub/grub.cfg</em>. Edits to this file will be removed when <strong><tt class="backtick">update-grub</tt></strong> is run and password protection will be lost. <span class="anchor" id="line-25"></span></li></ul></li><li><p class="line862">If any form of GRUB 2 password protection is enabled, the <em>superuser's</em> name and password are required to gain access to the GRUB 2 command line and menu-editing modes. <span class="anchor" id="line-26"></span></li><li>The username and/or password do not have to be the same as the Ubuntu logon name/password. <span class="anchor" id="line-27"></span></li><li><p class="line862">Unless GRUB 2's password encryption feature is used, the password is stored as plain text in a readable file. See the <a href="/community/Grub2/Passwords#Password_Encryption">Password Encryption</a> section for guidance on using this feature. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span></li></ul><p class="line867">
<h1 id="How_It_Works">How It Works</h1>
<span class="anchor" id="line-30"></span><p class="line862">Once a <em>superuser</em> and password are identified, the password feature is enabled the GRUB 2 menu will appear as it does normally. When a menu item requiring a password is selected, the user will be prompted to enter the correct username and password. If entered correctly, the selected menuentry will continue to boot. If incorrect, the user will be returned to the GRUB 2 menu. <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><p class="line874">If GRUB 2 is set up to boot directly to a password-protected menuentry without displaying a menu, the username/password prompt will appear and booting will not occur until they are correctly entered. <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line874">With at least one user/password identified, access to the GRUB 2 terminal and menuentry editing is restricted to the superuser. <span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><p class="line874">To enable password protection, GRUB 2 requires <span class="anchor" id="line-37"></span><ul><li><p class="line862">A <em>superuser</em> <span class="anchor" id="line-38"></span></li><li><p class="line862">The <em>superuser's</em> password <span class="anchor" id="line-39"></span><ul><li>With only this information, GRUB 2 will prevent menu editing and access to its terminal. <span class="anchor" id="line-40"></span></li></ul></li><li>Optionally, additional users/passwords may be added to limit access to specific items. <span class="anchor" id="line-41"></span></li></ul><p class="line874">To protect one or more menu items: <span class="anchor" id="line-42"></span><ul><li>Each menuentry to be protected must include information on its title line as to which users should be granted access. <span class="anchor" id="line-43"></span></li><li>In Ubuntu Precise or earlier, if no user(s) are designated for a specific menuentry, access to that entry will be given to all users. <span class="anchor" id="line-44"></span></li><li>In Ubuntu Quantal or later, if no user(s) are designated for a specific menuentry, access to that entry will be limited to the superuser. <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span></li></ul><p class="line867">
<h1 id="Warnings_.26_Cautions">Warnings &amp; Cautions</h1>
<span class="anchor" id="line-47"></span><ul><li>Errors in creating a password-protected GRUB 2 menu may result in an unbootable system. To restore a system with broken passwords, access and edit the GRUB 2 configuration files using the LiveCD or another OS. <span class="anchor" id="line-48"></span></li><li><p class="line862">If password protection is enabled, only the designated superuser can edit a Grub 2 menu item by pressing "<strong>e</strong>" or access the GRUB 2 command line by pressing "<strong>c</strong>". <span class="anchor" id="line-49"></span></li><li>If GRUB 2 is set up to boot automatically to a password-protected menuentry the user has no option to back out of the password prompt to select another menuentry. Holding the SHIFT key will not display the menu in this case. The user must enter the correct username and password. If unable, the configuration files will have to be edited via the LiveCD or other means to fix the problem.  <span class="anchor" id="line-50"></span></li><li>Users experimenting with GRUB 2 passwords should keep at least one non-protected menuentry and set the timeout to at least 1 second until testing is complete. This will allow booting to correct problematic settings. <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span></li></ul><p class="line867">
<h1 id="Setting_Up_Password_Protection">Setting Up Password Protection</h1>
<span class="anchor" id="line-53"></span><p class="line862">There are three steps to enabling Grub 2 password protection. The authorized users must be identified, their passwords must be designated, and menu items to be protected must be identified. Users and passwords are manually added to the <em>/etc/grub.d/00_header</em> file *. The file must be edited by an Ubuntu user with administrative authority (root) since it is a system file. The user/password information is automatically added to the GRUB 2 menu configuration file (<em>grub.cfg</em>) when <strong><tt class="backtick">update-grub</tt></strong> is run.  <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line862">To edit the <em>/etc/grub.d/00_header</em>*, <em>/etc/grub.d/10_linux</em>, and <em>/etc/grub.d/30_os-prober</em> files, open them as root with a text editor (such as <em>gedit</em>): <span class="anchor" id="line-56"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><pre><span class="anchor" id="line-1"></span>gksu gedit /etc/grub.d/00_header /etc/grub.d/10_linux /etc/grub.d/30_os-prober</pre><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span></li></ul><p class="line867"><em>*</em> The <em>superuser/user</em> information and password do not <em>have</em> to be contained in the <em>/etc/grub.d/00_header</em> file. The information can be placed in any <em>/etc/grub.d</em> file as long as that file is incorporated into <em>grub.cfg</em>. The user may prefer to enter this data into a custom file, such as <em>/etc/grub.d/40_custom</em> so it is not overwritten should the Grub package be updated. If placing the information in a custom file, do <em>not</em> include the "cat &lt;&lt; EOF" and "EOF" lines as the content is automatically added from these files. <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line867">
<h2 id="Superuser_.26_Password_Designation_.28Required.29">Superuser &amp; Password Designation (Required)</h2>
<span class="anchor" id="line-64"></span><p class="line874">A superuser must be designated. This user can select all menuentries, edit any items in the GRUB 2 menu during the boot process, and access the GRUB 2 terminal. <span class="anchor" id="line-65"></span><ul><li>The superuser is identifed on its own line: <span class="anchor" id="line-66"></span><ul><li style="list-style-type:none"><p class="line891"><strong>set superusers="user1"</strong>   Example: set supersusers="John" <span class="anchor" id="line-67"></span></li></ul></li><li>The format for adding the superuser password and any additional users and passwords: <span class="anchor" id="line-68"></span><ul><li style="list-style-type:none"><p class="line891"><strong>password &lt;user&gt; &lt;password&gt;</strong>  Example:  password John foo <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span></li></ul></li></ul><p class="line867"><img alt="important.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=important.png" title="important.png" /> Note: GRUB 2 1.99 in 12.04 LTS doesn't protect submenu, ie. command line, entry editing and access to entries is not protected! See <a class="https" href="https://bugs.launchpad.net/ubuntu/+source/grub2/+bug/718670">bug 718670</a>. The workaround is to export superusers variable by adding to the above <tt>export&nbsp;superusers</tt>. The above example would look like: <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><p class="line867"><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><pre><span class="anchor" id="line-1-1"></span>set superusers="John"
<span class="anchor" id="line-2"></span>password John foo
<span class="anchor" id="line-3"></span>export superusers</pre><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line867"><img alt="important.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=important.png" title="important.png" /> GRUB 2 passwords are stored as plain text in readable files. GRUB 2 can encrypt the password using grub-mkpasswd-pbkdf2. See the <a href="/community/Grub2/Passwords#Password_Encryption">Password Encryption</a> section for details. <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><ol type="1"><li><p class="line862">Open <em>/etc/grub.d/00_header</em> and add the following at the bottom of the file. <span class="anchor" id="line-81"></span><ul><li style="list-style-type:none"><div><table style="width: 85%"><tbody><tr>  <td style="width: 50%"><p class="line891"><strong>Generic Entry - Superuser Only:</strong> </td>
  <td><p class="line891"><strong>Example of actual entry:</strong></td>
</tr>
<tr>  <td><span class="anchor" id="line-82"></span><p class="line862">cat &lt;&lt; EOF</td>
  <td><p class="line862">cat &lt;&lt; EOF</td>
</tr>
<tr>  <td><span class="anchor" id="line-83"></span><p class="line862"> set superusers="user1"</td>
  <td><p class="line862">set superusers="John"</td>
</tr>
<tr>  <td><span class="anchor" id="line-84"></span><p class="line862"> password user1 password1</td>
  <td><p class="line862">password John 1234</td>
</tr>
<tr>  <td><span class="anchor" id="line-85"></span><p class="line862"> EOF </td>
  <td><p class="line862">EOF </td>
</tr>
</tbody></table></div><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span></li></ul></li></ol><p class="line867">
<h2 id="Other_Users_.28Optional.29">Other Users (Optional)</h2>
<span class="anchor" id="line-88"></span><ul><li style="list-style-type:none">Other users can be identified and given a password. A designated user can access unprotected and any to which he is specifically assigned.  <span class="anchor" id="line-89"></span><ul><li><p class="line862">Add the following non-bold text to the bottom of <em>/etc/grub.d/00_header</em> <span class="anchor" id="line-90"></span></li><li>Use this entry rather than the previous example. <span class="anchor" id="line-91"></span><div><table style="width: 85%"><tbody><tr>  <td style="width: 50%"><p class="line891"><strong>Generic Entry:</strong> - Superuser + <strong>1</strong> </td>
  <td><p class="line891"><strong>Example of actual entry:</strong></td>
</tr>
<tr>  <td><span class="anchor" id="line-92"></span><p class="line862">cat &lt;&lt; EOF</td>
  <td><p class="line862">cat &lt;&lt; EOF</td>
</tr>
<tr>  <td><span class="anchor" id="line-93"></span><p class="line862"> set superusers="user1"</td>
  <td><p class="line862">set superusers="John"</td>
</tr>
<tr>  <td><span class="anchor" id="line-94"></span><p class="line862"> password user1 password1</td>
  <td><p class="line862">password John 1234</td>
</tr>
<tr>  <td><span class="anchor" id="line-95"></span><p class="line862"> password user2 password2</td>
  <td><p class="line862">password Jane 5678</td>
</tr>
<tr>  <td><span class="anchor" id="line-96"></span><p class="line862"> password user3 password3</td>
  <td><p class="line862">password Sergio 9012</td>
</tr>
<tr>  <td><span class="anchor" id="line-97"></span><p class="line862"> EOF </td>
  <td><p class="line862">EOF </td>
</tr>
</tbody></table></div><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span></li></ul></li></ul><p class="line862">With only the information above entered into the <em>/etc/grub.d/00_header</em> file the GRUB 2 menu and terminal can only be accessed by the superuser. All menu items can be accessed by all users. To password-protect one or more menuentries, continue with the next section. <span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><p class="line867">
<h2 id="Protecting_Menuentries">Protecting Menuentries</h2>
<span class="anchor" id="line-102"></span><p class="line874">The GRUB 2 menu can contain protected and unprotected items. The format for protecting a menu item consists of adding the user access information to the menuentry title line. <span class="anchor" id="line-103"></span><ul><li><p class="line862">The presence of <em>--unrestricted</em> disables password protection. <span class="anchor" id="line-104"></span></li><li><p class="line862">The presence of <em>--users</em> enables password protection for the specified users. The superuser always has access. <span class="anchor" id="line-105"></span><ul><li><p class="line891"><em>--users ""</em> authorizes <strong>only</strong> the superuser <span class="anchor" id="line-106"></span></li></ul></li><li><p class="line891"><em>--users "Jane"</em> authorizes the superuser <strong>and</strong> "Jane" <span class="anchor" id="line-107"></span></li><li><p class="line891"><em>--users Jane</em>,<em>Sergio</em> authorizes the superuser <strong>and</strong> "Jane" <strong>and</strong> "Sergio" <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span></li></ul><p class="line874">Examples: <span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><ul><li style="list-style-type:none"><div><table><tbody><tr>  <td><p class="line862">All Users (No menuentry protection): </td>
  <td><p class="line862">menuentry 'Ubuntu, with Linux 3.2.0-24-generic' --class ubuntu -class os --unrestricted {</td>
</tr>
<tr>  <td><span class="anchor" id="line-112"></span><p class="line862">Superuser Only:</td>
  <td><p class="line862">menuentry 'Ubuntu, with Linux 3.2.0-24-generic' --class ubuntu -class os <strong>--users "" </strong>{</td>
</tr>
<tr>  <td><span class="anchor" id="line-113"></span><p class="line862">Superuser + Jane:</td>
  <td><p class="line862">menuentry 'Ubuntu, with Linux 3.2.0-24-generic' --class ubuntu -class os <strong>--users Jane</strong> {</td>
</tr>
<tr>  <td><span class="anchor" id="line-114"></span><p class="line862">Superuser + Jane + Sergio:</td>
  <td><p class="line862">menuentry 'Ubuntu, with Linux 3.2.0-24-generic' --class ubuntu -class os <strong>--users Jane,Sergio</strong> {</td>
</tr>
</tbody></table></div><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span></li></ul><p class="line867">
<h3 id="Adding_Protection_to_Ubuntu_Entries">Adding Protection to Ubuntu Entries</h3>
<span class="anchor" id="line-118"></span><p class="line862">There is currently no automated method of adding users or designating menu items to be protected. The user must manually edit the GRUB 2 scripts. The GRUB 2 menu is a compilation of the inputs of several scripts. The <em>/etc/grub.d/10_linux</em> file is responsible for adding the default Ubuntu OS to the GRUB 2 menu. The instructions below will automatically add password protection to all entries in the <em>10_linux</em> section of the GRUB 2 menu. The majority of these sections are devoted to editing the default scripts located in the <em>/etc/grub.d/</em> folder. <span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><p class="line867"><img alt="info.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=info.png" title="info.png" /> Another option is to create a custom menu, add the menu items you wish (including those you want to protect), and disable the standard scripts. The users and passwords can be included in this file rather than in the <em>00_header</em> file. This may be an easier method of assigning password protection - especially if only some of the menu items will be protected. The formatting is the same as described on this page, except the "cat &lt;&lt; EOF" and "EOF" entries are not used. For more information on how to set us a custom menu, refer to <a class="https" href="https://help.ubuntu.com/community/Grub2/CustomMenus">Grub 2/CustomMenus</a>. <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line867"><img alt="important.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=important.png" title="important.png" /> Before making these changes, it is recommended to save a copy of the <em>/etc/grub.d/10_linux</em> file to another location to serve as a backup. Do not leave the copy in the <em>/etc/grub.d/</em> folder to ensure it is not run during updates. <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><p class="line862">In <em>/etc/grub.d/10_linux</em>, find the following line: <span class="anchor" id="line-125"></span><ul><li style="list-style-type:none">printf "menuentry '${title}' ${CLASS} {\n" "${os}" "${version}" <span class="anchor" id="line-126"></span></li></ul><p class="line862">Add <strong>--users <tt>''</tt></strong> : <span class="anchor" id="line-127"></span><ul><li style="list-style-type:none"><p class="line862">printf "menuentry '${title}' ${CLASS} <strong>--users <tt>''</tt></strong> {\n" "${os}" "${version}" <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span></li></ul><p class="line874">Save the file, then run: <span class="anchor" id="line-130"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><pre><span class="anchor" id="line-1-2"></span>      sudo update-grub</pre><span class="anchor" id="line-133"></span></li></ul><p class="line862">The <strong>--users <tt>''</tt></strong> tag will be added to every menuentry located in the "10_linux" section of <em>grub.cfg</em>. <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><p class="line867"><img alt="important.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=important.png" title="important.png" /> Note: <br>
 <span class="anchor" id="line-136"></span>This document previously stated that you should add <strong>--users ""</strong> (with quotes instead of apostrophes) to the printf line above: <span class="anchor" id="line-137"></span><ul><li style="list-style-type:none"><p class="line862">printf "menuentry '${title}' ${CLASS} <strong>--users ""</strong> {\n" "${os}" "${version}" <span class="anchor" id="line-138"></span></li></ul><p class="line874">However, doing so causes grub.cfg to be generated without the quotes after --users, which may cause GRUB to fail with a cryptic "alloc magic is broken" error message. <span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><p class="line867">
<h3 id="Adding_Protection_to_Other_Entries">Adding Protection to Other Entries</h3>
<span class="anchor" id="line-141"></span><p class="line862">The GRUB 2 menu includes selections for operating systems other than the default Ubuntu OS via the <em>/etc/grub.d/30_os-prober</em> script.  The instructions below will automatically add password protection to all entries in the <em>30_os-prober</em> section of the GRUB 2 menu. This would include other Ubuntu and Linux installations, Windows, etc. <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line862">The <em>30_os-prober</em> script looks for specific types of operating systems. The user can make the changes for all of the OS's via a single command, or individually by OS type as documented below. <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line867"><img alt="important.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=important.png" title="important.png" /> Before making any changes the user should save a copy of the <em>/etc/grub.d/30_os-prober</em> file to another location to serve as a backup. Do not leave the copy in the <em>/etc/grub.d/</em> folder to ensure it is not run during updates. <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line867"><strong>All 30_os=prober Entries:</strong> <span class="anchor" id="line-148"></span>The user can add password protection to all entries generated by <em>/etc/grub.d/30_os-prober</em> by running the following command which adds <strong>--users</strong> to each menuentry found by the script. Alternatively, the user can use the expanded entries to change only specific operating systems as detailed below. <span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><p class="line862">To back up and then alter the <em>/etc/grub.d/30_os-prober</em> to add password protection to all entries: <span class="anchor" id="line-151"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><pre><span class="anchor" id="line-1-3"></span>sudo cp /etc/grub.d/30_os-prober /root/Desktop/30_os-prober
<span class="anchor" id="line-2-1"></span>sudo sed 's/--class os /--class os --users /' -i /etc/grub.d/30_os-prober</pre><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span></li></ul><p class="line867"><strong>Select OS Entries:</strong> <span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><p class="line862">To enable password protection only on a specific type of operating system add <strong>--users</strong> immediately following "--class os". <span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><p class="line862">OSX Example:  menuentry "${LONGNAME} (${2}-bit) (on ${DEVICE})" --class osx --class darwin --class os <strong>--users</strong> { <span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><ul><li style="list-style-type:none">OSX: <span class="anchor" id="line-164"></span><ul><li style="list-style-type:none">menuentry "${LONGNAME} (${2}-bit) (on ${DEVICE})" --class osx --class darwin --class os { <span class="anchor" id="line-165"></span></li></ul>Windows: <span class="anchor" id="line-166"></span><ul><li style="list-style-type:none">menuentry "${LONGNAME} (on ${DEVICE})" --class windows --class os { <span class="anchor" id="line-167"></span></li></ul>Linux/Ubuntu: <span class="anchor" id="line-168"></span><ul><li style="list-style-type:none">menuentry "${LLABEL} (on ${DEVICE})" --class gnu-linux --class gnu --class os { <span class="anchor" id="line-169"></span></li></ul>Hurd: <span class="anchor" id="line-170"></span><ul><li style="list-style-type:none">menuentry "${LONGNAME} (on ${DEVICE})" --class hurd --class gnu --class os { <span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span></li></ul></li></ul><p class="line874">Save the file, then run: <span class="anchor" id="line-173"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><pre><span class="anchor" id="line-1-4"></span>      sudo update-grub</pre><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span></li></ul><p class="line867">
<h3 id="Protect_the_Windows_Recovery_Partition">Protect the Windows Recovery Partition</h3>
<span class="anchor" id="line-178"></span><p class="line862">It is possible to provide password protection only to a specific partition. One obvious example would be the Windows recovery partition. While the concept could also be applied to other OS sections in the <em>30_os-prober</em> file or even the <em>10_linux</em> script, only the lines which search for the Windows OS will be described. Any Windows partition could be protected in the same manner by designating the partition. <span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><p class="line874">Note: This technique will work only if the GRUB 2 menu identifies multiple Windows partitions and one of them is the recovery partition. If only one Windows partition is identified by GRUB due to Windows chainloading it's menus, only Windows in its entirety could be protected. <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><p class="line874">If the user would like only to place password protection on a Windows recovery partition, follow the previous guidance and then: <span class="anchor" id="line-183"></span><ol type="1"><li><p class="line862">Determine the Windows Recovery partition (sda1, sda2, etc). Change sd<strong>XY</strong> to the correct values. <span class="anchor" id="line-184"></span></li><li><p class="line862">In the <em>/etc/grub.d/30_os-prober</em> file: <span class="anchor" id="line-185"></span><ul><li style="list-style-type:none">Change: <span class="anchor" id="line-186"></span><ul><li style="list-style-type:none"><div><table><tbody><tr>  <td><p class="line862">cat &lt;&lt; EOF</td>
</tr>
<tr>  <td><span class="anchor" id="line-187"></span><p class="line862">menuentry "${LONGNAME} (on ${DEVICE})" --class windows --class os {</td>
</tr>
<tr>  <td><span class="anchor" id="line-188"></span><p class="line862">EOF</td>
</tr>
</tbody></table></div></li></ul>To: <span class="anchor" id="line-190"></span><ul><li style="list-style-type:none"><div><table><tbody><tr>  <td><p class="line862">if [ ${DEVICE} = "/dev/sd<strong>XY</strong>" ]; then</td>
</tr>
<tr>  <td><span class="anchor" id="line-191"></span><p class="line862">cat &lt;&lt; EOF</td>
</tr>
<tr>  <td><span class="anchor" id="line-192"></span><p class="line862">menuentry "${LONGNAME} (on ${DEVICE})" <strong>--users ""</strong> {</td>
</tr>
<tr>  <td><span class="anchor" id="line-193"></span><p class="line862">EOF</td>
</tr>
<tr>  <td><span class="anchor" id="line-194"></span><p class="line862">else</td>
</tr>
<tr>  <td><span class="anchor" id="line-195"></span><p class="line862">cat &lt;&lt; EOF</td>
</tr>
<tr>  <td><span class="anchor" id="line-196"></span><p class="line862">menuentry "${LONGNAME} (on ${DEVICE})" {</td>
</tr>
<tr>  <td><span class="anchor" id="line-197"></span><p class="line862">EOF</td>
</tr>
<tr>  <td><span class="anchor" id="line-198"></span><p class="line862">fi</td>
</tr>
</tbody></table></div><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span></li></ul></li></ul></li><li class="gap">Save the file, then run: <span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><pre><span class="anchor" id="line-1-5"></span>      sudo update-grub</pre><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span></li></ol><p class="line867">
<h1 id="Password_Encryption">Password Encryption</h1>
<span class="anchor" id="line-207"></span><p class="line867"><strong>grub-mkpasswd-pbkdf2</strong> <span class="anchor" id="line-208"></span>Encrypted password protection has been available in all versions of Grub 2 but was improved in GRUB 1.99. <span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><p class="line862">One of the drawbacks of the password setup discussed so far is that the passwords are entered in plain text in the GRUB 2 files. The degree of security can be greatly enhanced by using Grub 2's <em>grub-mkpasswd-pbkdf2</em> command. This command converts your desired password into a very long alphanumeric code which is placed in the GRUB 2 files. Your actual password is no longer visible in the Grub 2 scripts. While physical access to a computer can bypass the GRUB 2 menu, encryption makes it much more difficult for the casual hacker to determine your menu passwords. <span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><p class="line867"><img alt="important.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=important.png" title="important.png" /> It is worth repeating: Users experimenting with GRUB 2 passwords should keep at least one non-protected menuentry and set the timeout to at least 1 second until testing is complete. This will allow booting a menuentry without a password to correct problematic settings. <span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><p class="line867"><img alt="g2_grub.pbkdf2.png" class="attachment" src="/community/Grub2/Passwords?action=AttachFile&amp;do=get&amp;target=g2_grub.pbkdf2.png" title="g2_grub.pbkdf2.png" /> <span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><ul><li>To generate an encrypted password, open a terminal and run the following command: <span class="anchor" id="line-217"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><pre><span class="anchor" id="line-1-6"></span>grub-mkpasswd-pbkdf2</pre><span class="anchor" id="line-220"></span></li></ul></li><li>Enter the desired password and reenter it when prompted. <span class="anchor" id="line-221"></span><ul><li>Copy the resulting code. In a terminal, highlight the code and CTRL-SHIFT-c to place it in memory. If highlighting the output with a mouse, it may be automatically stored in memory and be pasted by clicking the middle mouse button. <span class="anchor" id="line-222"></span></li><li>Paste the code after the username(s). Pasting can be accomplished in a text editor by either CTRL-v or middle mouse click. <span class="anchor" id="line-223"></span></li><li>The format for an encrypted password entry in /etc/grub.d/00_header would look similar to the following (shortened in the example): <span class="anchor" id="line-224"></span><ul><li style="list-style-type:none"><div><table><tbody><tr>  <td><p class="line862">set superusers="John"</td>
</tr>
<tr>  <td><span class="anchor" id="line-225"></span><p class="line862">password_pbkdf2 John grub.pbkdf2.sha512.10000.FC58373BCA15A797C418C1EA7FFB007BF5A5 </td>
</tr>
</tbody></table></div><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span></li></ul></li></ul></li></ul><p class="line867">
<h1 id="Links">Links</h1>
<span class="anchor" id="line-229"></span><p class="line867"><a class="https" href="https://help.ubuntu.com/community/Grub2">Grub2</a> <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><p class="line867"><a class="https" href="https://help.ubuntu.com/community/Grub2/Installing">Grub2/Installing</a> <span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><p class="line867"><a class="https" href="https://help.ubuntu.com/community/Grub2/Troubleshooting">Grub2/Troubleshooting</a> <span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><p class="line867"><a class="https" href="https://help.ubuntu.com/community/Grub2/Upgrading">Grub2/Upgrading</a> <span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><p class="line874">External Links: <span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><p class="line867"><a class="http" href="http://www.gnu.org/software/grub/manual/grub.html">GNU GRUB Manual</a> <span class="anchor" id="line-240"></span><hr /><p class="line874"> <span class="anchor" id="line-241"></span><a href="/community/CategoryBootAndPartition">CategoryBootAndPartition</a>  <span class="anchor" id="line-242"></span><span class="anchor" id="bottom"></span></div><div id="pagebottom"></div>
</div>


            </div>
<p id="pageinfo" class="info" lang="en" dir="ltr">Grub2/Passwords  (last edited 2015-08-29 22:23:43 by <span title="heintzmann-eric @ sim31-3-78-226-144-120.fbx.proxad.net[78.226.144.120]"><a class="interwiki" href="https://launchpad.net/~heintzmann-eric" title="heintzmann-eric @ sim31-3-78-226-144-120.fbx.proxad.net[78.226.144.120]">heintzmann-eric</a></span>)</p>

</div>
            
            <div id="footer">
		<p>
		The material on this wiki is available under a free license, see <a href="https://help.ubuntu.com/community/
		License">Copyright / License</a> for details<br /><b>You</b> can contribute to this wiki, see 
		<a href="https://help.ubuntu.com/community/WikiGuide">Wiki Guide</a> for details
		</p>
            </div>

        </div></body>
</html>

