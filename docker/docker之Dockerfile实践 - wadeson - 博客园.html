<!DOCTYPE html>
<!-- saved from url=(0045)https://www.cnblogs.com/jsonhc/p/7767669.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="referrer" content="origin">
    <title>docker之Dockerfile实践 - wadeson - 博客园</title>
<meta property="og:description" content="上一篇介绍了Dockerfile中使用的指令，现在开始进行指令实践 先查看下本地的镜像，选一个作为base image： 在某一个目录下面创建一个专门存放此demo的目录，也就是Dockerfile所">
    <link type="text/css" rel="stylesheet" href="./docker之Dockerfile实践 - wadeson - 博客园_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./docker之Dockerfile实践 - wadeson - 博客园_files/bundle-sea.css">
<link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./docker之Dockerfile实践 - wadeson - 博客园_files/bundle-sea-mobile.css">
    <link title="RSS" type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/jsonhc/rss">
    <link title="RSD" type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/jsonhc/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/jsonhc/wlwmanifest.xml">
    <script src="./docker之Dockerfile实践 - wadeson - 博客园_files/amp4ads-host-v0.js.download"></script><script src="./docker之Dockerfile实践 - wadeson - 博客园_files/pubads_impl_rendering_2019051301.js.download"></script><script async="" src="./docker之Dockerfile实践 - wadeson - 博客园_files/analytics.js.download"></script><script type="text/javascript" src="./docker之Dockerfile实践 - wadeson - 博客园_files/encoder.js.download"></script><script src="./docker之Dockerfile实践 - wadeson - 博客园_files/jquery-2.2.0.min.js.download"></script>
    <script>var currentBlogId=358609;var currentBlogApp='jsonhc',cb_enable_mathjax=false;var isLogined=false;</script>
    <script src="./docker之Dockerfile实践 - wadeson - 博客园_files/blog-common.js.download" type="text/javascript"></script>
<link rel="preload" href="./docker之Dockerfile实践 - wadeson - 博客园_files/f.txt" as="script"><script type="text/javascript" src="./docker之Dockerfile实践 - wadeson - 博客园_files/f.txt"></script><script src="./docker之Dockerfile实践 - wadeson - 博客园_files/pubads_impl_2019051301.js.download" async=""></script><link rel="prefetch" href="https://tpc.googlesyndication.com/safeframe/1-0-33/html/container.html"></head>
<body>
<a name="top"></a>

<!--PageBeginHtml Block Begin-->



    
        
        
        
        <title>打赏</title>
    
    <script>
        window.tctipConfig = {
            staticPrefix: "http://static.tctip.com",
            buttonImageId: 5,
            //zanzhu--博客园右边出现"赞助"二字
            //buttonTip: "zanzhu",
            //dashang--博客园右边出现"打赏"二字
            buttonTip: "dashang",
            list: {
                alipay: {
                    //修改一：修改支付宝收款码地址
                    qrimg: "https://files.cnblogs.com/files/jsonhc/zhifubao.bmp"
                },
                weixin: {
                    //修改二：修改微信收款码地址
                    qrimg: "https://files.cnblogs.com/files/jsonhc/weixin.bmp"
                },
            }
        };
    </script>
    <script src="./docker之Dockerfile实践 - wadeson - 博客园_files/tctip.min.js.download"></script>

    


<!--PageBeginHtml Block End-->

<!--done-->
<div id="header">
	
<!--done-->
<div class="header">
	<div class="headerText">
		<a id="Header1_HeaderTitle" class="headermaintitle" href="https://www.cnblogs.com/jsonhc/">wadeson</a><br>
		github：https://github.com/jsonhc/
	</div>
</div>

</div>

<div id="mytopmenu">
	
		<div id="mylinks"><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">博客园</a> &nbsp;
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/jsonhc/">首页</a> &nbsp;
<a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a> &nbsp;
<a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/wadeson">联系</a> &nbsp;
<a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/jsonhc/rss">订阅</a><a id="blog_nav_rss_image" href="https://www.cnblogs.com/jsonhc/rss"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/xml.gif" alt="订阅"></a>&nbsp;
<a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a>
</div>
		<div id="mystats"><div id="blog_stats">
随笔-101&nbsp;
评论-25&nbsp;
文章-0&nbsp;
<!--trackbacks-0-->
</div></div>
	
</div>
<div id="centercontent">
	
        <div id="post_detail">
<div class="post">
	<h1 class="postTitle"><a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/jsonhc/p/7767669.html">docker之Dockerfile实践</a></h1>
	<div id="cnblogs_post_body" class="blogpost-body"><p>上一篇介绍了Dockerfile中使用的指令，现在开始进行指令实践</p>
<p>先查看下本地的镜像，选一个作为base image：</p>
<div class="cnblogs_code">
<pre>[root@docker ~<span style="color: #000000;">]# docker images
REPOSITORY             TAG                 IMAGE ID            CREATED             SIZE
wadeson</span>/centos_nginx   v1                  210a202d37b8        <span style="color: #800080;">2</span><span style="color: #000000;"> hours ago         464MB
nginx                  latest              c59f17fe53b0        </span><span style="color: #800080;">4</span><span style="color: #000000;"> days ago          108MB
ubuntu                 latest              747cb2d60bbe        </span><span style="color: #800080;">3</span><span style="color: #000000;"> weeks ago         122MB
centos                 latest              196e0ce0c9fb        </span><span style="color: #800080;">6</span> weeks ago         197MB</pre>
</div>
<p>在某一个目录下面创建一个专门存放此demo的目录，也就是Dockerfile所在的context：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>[root@docker ~]# <span style="color: #0000ff;">mkdir</span><span style="color: #000000;"> docker_demo
[root@docker </span>~]# cd docker_demo/<span style="color: #000000;">
[root@docker docker_demo]# </span><span style="color: #0000ff;">touch</span><span style="color: #000000;"> Dockerfile
[root@docker docker_demo]# </span><span style="color: #0000ff;">pwd</span>
/root/<span style="color: #000000;">docker_demo
[root@docker docker_demo]# ll
total </span><span style="color: #800080;">0</span>
-rw-r--r--. <span style="color: #800080;">1</span> root root <span style="color: #800080;">0</span> Nov  <span style="color: #800080;">1</span> <span style="color: #800080;">04</span>:<span style="color: #800080;">34</span> Dockerfile</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>接下来就开始编写Dockerfile文件了（注意Dockerfile的D需要大写）</p>
<p>这里以编译nginx提供web服务来构建新的镜像</p>
<p>1、下载nginx源码包到docker_demo这个目录下：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[root@docker docker_demo]# ll
total </span><span style="color: #800080;">960</span>
-rw-r--r--. <span style="color: #800080;">1</span> root root      <span style="color: #800080;">0</span> Nov  <span style="color: #800080;">1</span> <span style="color: #800080;">04</span>:<span style="color: #800080;">34</span><span style="color: #000000;"> Dockerfile
</span>-rw-r--r--. <span style="color: #800080;">1</span> root root <span style="color: #800080;">981687</span> Oct <span style="color: #800080;">17</span> <span style="color: #800080;">09</span>:<span style="color: #800080;">20</span> nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz</pre>
</div>
<p>2、以下是编写好的Dockerfile v1版：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<p>[root@docker docker_demo]# cat Dockerfile <br># base image<br>FROM centos</p>
<p># MAINTAINER<br>MAINTAINER json_hc@163.com</p>
<p># put nginx-1.12.2.tar.gz into /usr/local/src and unpack nginx<br>ADD nginx-1.12.2.tar.gz /usr/local/src</p>
<p># running required command<br>RUN yum install -y gcc gcc-c++ glibc make autoconf openssl openssl-devel <br>RUN yum install -y libxslt-devel -y gd gd-devel GeoIP GeoIP-devel pcre pcre-devel<br>RUN useradd -M -s /sbin/nologin nginx</p>
<p># change dir to /usr/local/src/nginx-1.12.2<br>WORKDIR /usr/local/src/nginx-1.12.2</p>
<p># execute command to compile nginx<br>RUN ./configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-file-aio  --with-http_ssl_module  --with-http_realip_module    --with-http_addition_module    --with-http_xslt_module   --with-http_image_filter_module    --with-http_geoip_module  --with-http_sub_module  --with-http_dav_module --with-http_flv_module    --with-http_mp4_module --with-http_gunzip_module  --with-http_gzip_static_module  --with-http_auth_request_module  --with-http_random_index_module   --with-http_secure_link_module   --with-http_degradation_module   --with-http_stub_status_module &amp;&amp; make &amp;&amp; make install</p>
<p>EXPOSE 80</p>






<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>3、查看docker_demo目录情况：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[root@docker docker_demo]# ll
total </span><span style="color: #800080;">964</span>
-rw-r--r--. <span style="color: #800080;">1</span> root root   <span style="color: #800080;">1112</span> Nov  <span style="color: #800080;">1</span> <span style="color: #800080;">04</span>:<span style="color: #800080;">58</span><span style="color: #000000;"> Dockerfile
</span>-rw-r--r--. <span style="color: #800080;">1</span> root root <span style="color: #800080;">981687</span> Oct <span style="color: #800080;">17</span> <span style="color: #800080;">09</span>:<span style="color: #800080;">20</span> nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz</pre>
</div>
<p>4、执行docker build进行构建：</p>
<div class="cnblogs_code">
<pre>docker build -t centos_nginx:v1 .</pre>
</div>
<p>后面的.代表的是相对路径的当前目录，如果需要全路径则为/root/docker_demo（就是找到Dockerfile文件）</p>
<p>构建成功后，查看新构建的镜像：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #000000;">[root@docker docker_demo]# docker images         
REPOSITORY             TAG                 IMAGE ID            CREATED             SIZE
centos_nginx           v1                  78d18f16e757        </span><span style="color: #800080;">4</span><span style="color: #000000;"> hours ago         464MB
wadeson</span>/centos_nginx   v1                  210a202d37b8        <span style="color: #800080;">7</span><span style="color: #000000;"> hours ago         464MB
nginx                  latest              c59f17fe53b0        </span><span style="color: #800080;">4</span><span style="color: #000000;"> days ago          108MB
ubuntu                 latest              747cb2d60bbe        </span><span style="color: #800080;">3</span><span style="color: #000000;"> weeks ago         122MB
centos                 latest              196e0ce0c9fb        </span><span style="color: #800080;">6</span> weeks ago         197MB</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>5、然后使用构建的镜像启动一个container并开启nginx服务：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker run -d centos_nginx:v1 /usr/local/nginx/sbin/nginx -g <span style="color: #800000;">"</span><span style="color: #800000;">daemon off;</span><span style="color: #800000;">"</span><span style="color: #000000;">
ea5af922378356a5ebff60992f000b186b09d1e8d6a4915b0b8ccf997ca12404</span></pre>
</div>
<p>然后查看启动的container是否在运行：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker <span style="color: #0000ff;">ps</span> -<span style="color: #000000;">l
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
ea5af9223783        centos_nginx:v1     </span><span style="color: #800000;">"</span><span style="color: #800000;">/usr/local/nginx/...</span><span style="color: #800000;">"</span>   <span style="color: #800080;">7</span> seconds ago       Up <span style="color: #800080;">6</span> seconds        <span style="color: #800080;">80</span>/tcp              flamboyant_carson</pre>
</div>
<p>虽然nginx服务开启了，但是port并没有进行映射到本机host，所以这个container并不能进行访问，重新启动一个进行了映射端口的容器</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker run -d -p80:<span style="color: #800080;">80</span> centos_nginx:v1 /usr/local/nginx/sbin/nginx -g <span style="color: #800000;">"</span><span style="color: #800000;">daemon off;</span><span style="color: #800000;">"</span><span style="color: #000000;">
e4b6e4846dedc6f130e028701c84828a635f3b367c0d500ebd947de16b1be0b2</span></pre>
</div>
<p>再次查看端口映射信息：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[root@docker docker_demo]# docker port e4b6e4846ded
</span><span style="color: #800080;">80</span>/tcp -&gt; <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">80</span></pre>
</div>
<p>于是进行访问：</p>
<p><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/1168897-20171101214944701-2097058657.png" alt=""></p>
<p>于是基于Dockerfile的一个简单实例构建完成，现在基于这个Dockerfile文件依次添加其他的指令进行构建</p>
<p>添加ENV环境变量指令：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>[root@docker docker_demo]# <span style="color: #0000ff;">cat</span><span style="color: #000000;"> Dockerfile 
# base image
FROM centos

# MAINTAINER
MAINTAINER json_hc@</span><span style="color: #800080;">163</span><span style="color: #000000;">.com

# put nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz into /usr/local/<span style="color: #000000;">src and unpack nginx
ADD nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz /usr/local/<span style="color: #000000;">src

# running required command
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y <span style="color: #0000ff;">gcc</span> <span style="color: #0000ff;">gcc</span>-c++ glibc <span style="color: #0000ff;">make</span> autoconf openssl openssl-<span style="color: #000000;">devel 
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y libxslt-devel -y gd gd-devel GeoIP GeoIP-devel pcre pcre-<span style="color: #000000;">devel
RUN useradd </span>-M -s /sbin/<span style="color: #000000;">nologin nginx

# change </span><span style="color: #0000ff;">dir</span> to /usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">
WORKDIR </span>/usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">

# execute command to compile nginx
RUN .</span>/configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-<span style="color: #0000ff;">file</span>-aio  --with-http_ssl_module  --with-http_realip_module    --with-http_addition_module    --with-http_xslt_module   --with-http_image_filter_module    --with-http_geoip_module  --with-http_sub_module  --with-http_dav_module --with-http_flv_module    --with-http_mp4_module --with-http_gunzip_module  --with-http_gzip_static_module  --with-http_auth_request_module  --with-http_random_index_module   --with-http_secure_link_module   --with-http_degradation_module   --with-http_stub_status_module &amp;&amp; <span style="color: #0000ff;">make</span> &amp;&amp; <span style="color: #0000ff;">make</span> <span style="color: #0000ff;">install</span><span style="color: #000000;">

ENV PATH </span>/usr/local/nginx/<span style="color: #000000;">sbin:$PATH

EXPOSE </span><span style="color: #800080;">80</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>然后进行构建：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>[root@docker docker_demo]# docker build -<span style="color: #000000;">t centos_nginx:v2 .
Sending build context to Docker daemon  </span><span style="color: #800080;">985</span><span style="color: #000000;">.6kB
Step </span><span style="color: #800080;">1</span>/<span style="color: #800080;">10</span><span style="color: #000000;"> : FROM centos
 </span>---&gt;<span style="color: #000000;"> 196e0ce0c9fb
Step </span><span style="color: #800080;">2</span>/<span style="color: #800080;">10</span> : MAINTAINER json_hc@<span style="color: #800080;">163</span><span style="color: #000000;">.com
 </span>---&gt;<span style="color: #000000;"> Using cache
 </span>---&gt;<span style="color: #000000;"> cde1d7830106
Step </span><span style="color: #800080;">3</span>/<span style="color: #800080;">10</span> : ADD nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz /usr/local/<span style="color: #000000;">src
 </span>---&gt;<span style="color: #000000;"> Using cache
 </span>---&gt;<span style="color: #000000;"> 1e4d16340af0
Step </span><span style="color: #800080;">4</span>/<span style="color: #800080;">10</span> : RUN <span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y <span style="color: #0000ff;">gcc</span> <span style="color: #0000ff;">gcc</span>-c++ glibc <span style="color: #0000ff;">make</span> autoconf openssl openssl-<span style="color: #000000;">devel
 </span>---&gt;<span style="color: #000000;"> Using cache
 </span>---&gt;<span style="color: #000000;"> 405835ad9b0b
Step </span><span style="color: #800080;">5</span>/<span style="color: #800080;">10</span> : RUN <span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y libxslt-devel -y gd gd-devel GeoIP GeoIP-devel pcre pcre-<span style="color: #000000;">devel
 </span>---&gt;<span style="color: #000000;"> Using cache
 </span>---&gt;<span style="color: #000000;"> 4002738cf7a6
Step </span><span style="color: #800080;">6</span>/<span style="color: #800080;">10</span> : RUN useradd -M -s /sbin/<span style="color: #000000;">nologin nginx
 </span>---&gt;<span style="color: #000000;"> Using cache
 </span>---&gt;<span style="color: #000000;"> 02961c5c564d
Step </span><span style="color: #800080;">7</span>/<span style="color: #800080;">10</span> : WORKDIR /usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>
 ---&gt;<span style="color: #000000;"> Using cache
 </span>---&gt;<span style="color: #000000;"> f1da71a93c5e
Step </span><span style="color: #800080;">8</span>/<span style="color: #800080;">10</span> : RUN ./configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-<span style="color: #0000ff;">file</span>-aio  --with-http_ssl_module  --with-http_realip_module    --with-http_addition_module    --with-http_xslt_module   --with-http_image_filter_module    --with-http_geoip_module  --with-http_sub_module  --with-http_dav_module --with-http_flv_module    --with-http_mp4_module --with-http_gunzip_module  --with-http_gzip_static_module  --with-http_auth_request_module  --with-http_random_index_module   --with-http_secure_link_module   --with-http_degradation_module   --with-http_stub_status_module &amp;&amp; <span style="color: #0000ff;">make</span> &amp;&amp; <span style="color: #0000ff;">make</span> <span style="color: #0000ff;">install</span>
 ---&gt;<span style="color: #000000;"> Using cache
 </span>---&gt;<span style="color: #000000;"> cd2ad4c45004
Step </span><span style="color: #800080;">9</span>/<span style="color: #800080;">10</span> : ENV PATH /usr/local/nginx/<span style="color: #000000;">sbin:$PATH
 </span>---&gt; Running <span style="color: #0000ff;">in</span><span style="color: #000000;"> 07ba2f7129bc
 </span>---&gt;<span style="color: #000000;"> 9588fa1058aa
Removing intermediate container 07ba2f7129bc
Step </span><span style="color: #800080;">10</span>/<span style="color: #800080;">10</span> : EXPOSE <span style="color: #800080;">80</span>
 ---&gt; Running <span style="color: #0000ff;">in</span><span style="color: #000000;"> 473cd847154a
 </span>---&gt;<span style="color: #000000;"> 2031faf8894a
Removing intermediate container 473cd847154a
Successfully built 2031faf8894a
Successfully tagged centos_nginx:v2</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>由于在构建的过程中docker会采用缓存的机制，上面的构建过程中包含很多using cache，所以这次构建非常快，如果需要重新构建，不想使用cache需要添加--no-cache</p>
<p>--no-cache&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Do not use cache when building the image</p>
<p>查看v2版本的镜像：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[root@docker docker_demo]# docker images
REPOSITORY             TAG                 IMAGE ID            CREATED             SIZE
centos_nginx           v2                  2031faf8894a        </span><span style="color: #800080;">2</span> minutes ago       464MB</pre>
</div>
<p>使用v2版本的镜像启动一个container：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker run -d -p81:<span style="color: #800080;">80</span> centos_nginx:v2 nginx -g <span style="color: #800000;">"</span><span style="color: #800000;">daemon off;</span><span style="color: #800000;">"</span><span style="color: #000000;">
da48b465b1b1a14824497d724eee52b8408270b3b5223c5dd7094b7c0cef211d</span></pre>
</div>
<p>查看container运行状态：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker <span style="color: #0000ff;">ps</span> -<span style="color: #000000;">l
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES
da48b465b1b1        centos_nginx:v2     </span><span style="color: #800000;">"</span><span style="color: #800000;">nginx -g 'daemon ...</span><span style="color: #800000;">"</span>   <span style="color: #800080;">23</span> seconds ago      Up <span style="color: #800080;">22</span> seconds       <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">81</span>-&gt;<span style="color: #800080;">80</span>/tcp   determined_neumann</pre>
</div>
<p>进行访问：</p>
<p><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/1168897-20171101215815091-474688798.png" alt=""></p>
<p>上述启动容器的过程中使用的命令docker run -d -p81:80 centos_nginx:v2 nginx -g "daemon off;"为什么这里使用的nginx而不是</p>
<p>/usr/local/nginx/sbin/nginx，因为在Dockerfile文化中执行了PATH=/usr/local/nginx/sbin:$PATH，添加到了环境变量</p>
<p>&nbsp;</p>
<p>添加指令CMD：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>[root@docker docker_demo]# <span style="color: #0000ff;">cat</span><span style="color: #000000;"> Dockerfile 
# base image
FROM centos

# MAINTAINER
MAINTAINER json_hc@</span><span style="color: #800080;">163</span><span style="color: #000000;">.com

# put nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz into /usr/local/<span style="color: #000000;">src and unpack nginx
ADD nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz /usr/local/<span style="color: #000000;">src

# running required command
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y <span style="color: #0000ff;">gcc</span> <span style="color: #0000ff;">gcc</span>-c++ glibc <span style="color: #0000ff;">make</span> autoconf openssl openssl-<span style="color: #000000;">devel 
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y libxslt-devel -y gd gd-devel GeoIP GeoIP-devel pcre pcre-<span style="color: #000000;">devel
RUN useradd </span>-M -s /sbin/<span style="color: #000000;">nologin nginx

# change </span><span style="color: #0000ff;">dir</span> to /usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">
WORKDIR </span>/usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">

# execute command to compile nginx
RUN .</span>/configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-<span style="color: #0000ff;">file</span>-aio  --with-http_ssl_module  --with-http_realip_module    --with-http_addition_module    --with-http_xslt_module   --with-http_image_filter_module    --with-http_geoip_module  --with-http_sub_module  --with-http_dav_module --with-http_flv_module    --with-http_mp4_module --with-http_gunzip_module  --with-http_gzip_static_module  --with-http_auth_request_module  --with-http_random_index_module   --with-http_secure_link_module   --with-http_degradation_module   --with-http_stub_status_module &amp;&amp; <span style="color: #0000ff;">make</span> &amp;&amp; <span style="color: #0000ff;">make</span> <span style="color: #0000ff;">install</span><span style="color: #000000;">

ENV PATH </span>/usr/local/nginx/<span style="color: #000000;">sbin:$PATH

EXPOSE </span><span style="color: #800080;">80</span><span style="color: #000000;">

CMD </span>/bin/<span style="color: #0000ff;">sh</span> -c <span style="color: #800000;">'</span><span style="color: #800000;">nginx -g "daemon off;"</span><span style="color: #800000;">'</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>然后进行构建：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker build -t centos_nginx:v3 .</pre>
</div>
<p>查看v3版本的镜像：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[root@docker docker_demo]# docker images
REPOSITORY             TAG                 IMAGE ID            CREATED             SIZE
centos_nginx           v3                  0e49a2c0562f        </span><span style="color: #800080;">11</span> seconds ago      464MB</pre>
</div>
<p>然后基于v3版本的镜像启动一个container：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker run -d -p82:<span style="color: #800080;">80</span><span style="color: #000000;"> centos_nginx:v3 
d988c04d04f49b909f28e7b664be3959a0d51b951f1c1b04fcf5c716552b7c41</span></pre>
</div>
<p>查看启动的容器状态：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker <span style="color: #0000ff;">ps</span> -<span style="color: #000000;">l
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES
d988c04d04f4        centos_nginx:v3     </span><span style="color: #800000;">"</span><span style="color: #800000;">/bin/sh -c '/bin/...</span><span style="color: #800000;">"</span>   <span style="color: #800080;">6</span> seconds ago       Up <span style="color: #800080;">5</span> seconds        <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">82</span>-&gt;<span style="color: #800080;">80</span>/tcp   optimistic_saha</pre>
</div>
<p>最后进行访问：</p>
<p><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/1168897-20171101220437310-328967201.png" alt=""></p>
<p>新增加的CMD /bin/sh -c 'nginx -g "daemon off;"'表示</p>
<p>当启动一个container时默认运行的命令，如果在启动container时赋予了command的化，那么</p>
<p>定义的CMD中的命令将不会被执行，而会去执行command的命令</p>
<p>&nbsp;</p>
<p>添加entrypoint指令：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>[root@docker docker_demo]# <span style="color: #0000ff;">cat</span><span style="color: #000000;"> Dockerfile 
# base image
FROM centos

# MAINTAINER
MAINTAINER json_hc@</span><span style="color: #800080;">163</span><span style="color: #000000;">.com

# put nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz into /usr/local/<span style="color: #000000;">src and unpack nginx
ADD nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz /usr/local/<span style="color: #000000;">src

# running required command
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y <span style="color: #0000ff;">gcc</span> <span style="color: #0000ff;">gcc</span>-c++ glibc <span style="color: #0000ff;">make</span> autoconf openssl openssl-<span style="color: #000000;">devel 
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y libxslt-devel -y gd gd-devel GeoIP GeoIP-devel pcre pcre-<span style="color: #000000;">devel
RUN useradd </span>-M -s /sbin/<span style="color: #000000;">nologin nginx

# change </span><span style="color: #0000ff;">dir</span> to /usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">
WORKDIR </span>/usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">

# execute command to compile nginx
RUN .</span>/configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-<span style="color: #0000ff;">file</span>-aio  --with-http_ssl_module  --with-http_realip_module    --with-http_addition_module    --with-http_xslt_module   --with-http_image_filter_module    --with-http_geoip_module  --with-http_sub_module  --with-http_dav_module --with-http_flv_module    --with-http_mp4_module --with-http_gunzip_module  --with-http_gzip_static_module  --with-http_auth_request_module  --with-http_random_index_module   --with-http_secure_link_module   --with-http_degradation_module   --with-http_stub_status_module &amp;&amp; <span style="color: #0000ff;">make</span> &amp;&amp; <span style="color: #0000ff;">make</span> <span style="color: #0000ff;">install</span><span style="color: #000000;">

ENV PATH </span>/usr/local/nginx/<span style="color: #000000;">sbin:$PATH

EXPOSE </span><span style="color: #800080;">80</span><span style="color: #000000;">

ENTRYPOINT [</span><span style="color: #800000;">"</span><span style="color: #800000;">nginx</span><span style="color: #800000;">"</span><span style="color: #000000;">]

CMD [</span><span style="color: #800000;">"</span><span style="color: #800000;">-g</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">daemon off;</span><span style="color: #800000;">"</span>]</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>当ENTRYPOINT和CMD连用时，CMD的命令是ENTRYPOINT命令的参数，两者连用相当于nginx -g "daemon off;"</p>
<p>而当一起连用的时候命令格式最好一致（这里选择的都是json格式的是成功的，如果都是sh模式可以试一下）</p>
<p>开始进行构建v4版本：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker build -t centos_nginx:v4 .</pre>
</div>
<p>查看新建的镜像：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[root@docker docker_demo]# docker images
REPOSITORY             TAG                 IMAGE ID            CREATED             SIZE
centos_nginx           v4                  6c5128aaff05        </span><span style="color: #800080;">4</span> minutes ago       464MB</pre>
</div>
<p>为v4版本的镜像启动一个container：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker run -d -p83:<span style="color: #800080;">80</span><span style="color: #000000;"> centos_nginx:v4 
6933c78255f3cebe44d4d5d080caf8a2fde45ded2f9b333ec01cdfe98cd5f417</span></pre>
</div>
<p>然后查看容器状态：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker <span style="color: #0000ff;">ps</span> -<span style="color: #000000;">l
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES
6933c78255f3        centos_nginx:v4     </span><span style="color: #800000;">"</span><span style="color: #800000;">nginx -g 'daemon ...</span><span style="color: #800000;">"</span>   <span style="color: #800080;">6</span> seconds ago       Up <span style="color: #800080;">5</span> seconds        <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">83</span>-&gt;<span style="color: #800080;">80</span>/tcp   zealous_euclid</pre>
</div>
<p>最后进行访问：</p>
<p><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/1168897-20171101222146232-1534714177.png" alt=""></p>
<p>这里增加一个案例，如果Dockerfile修改成下面：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>[root@docker docker_demo]# <span style="color: #0000ff;">cat</span><span style="color: #000000;"> Dockerfile 
# base image
FROM centos

# MAINTAINER
MAINTAINER json_hc@</span><span style="color: #800080;">163</span><span style="color: #000000;">.com

# put nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz into /usr/local/<span style="color: #000000;">src and unpack nginx
ADD nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz /usr/local/<span style="color: #000000;">src

# running required command
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y <span style="color: #0000ff;">gcc</span> <span style="color: #0000ff;">gcc</span>-c++ glibc <span style="color: #0000ff;">make</span> autoconf openssl openssl-<span style="color: #000000;">devel 
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y libxslt-devel -y gd gd-devel GeoIP GeoIP-devel pcre pcre-<span style="color: #000000;">devel
RUN useradd </span>-M -s /sbin/<span style="color: #000000;">nologin nginx

# change </span><span style="color: #0000ff;">dir</span> to /usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">
WORKDIR </span>/usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">

# execute command to compile nginx
RUN .</span>/configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-<span style="color: #0000ff;">file</span>-aio  --with-http_ssl_module  --with-http_realip_module    --with-http_addition_module    --with-http_xslt_module   --with-http_image_filter_module    --with-http_geoip_module  --with-http_sub_module  --with-http_dav_module --with-http_flv_module    --with-http_mp4_module --with-http_gunzip_module  --with-http_gzip_static_module  --with-http_auth_request_module  --with-http_random_index_module   --with-http_secure_link_module   --with-http_degradation_module   --with-http_stub_status_module &amp;&amp; <span style="color: #0000ff;">make</span> &amp;&amp; <span style="color: #0000ff;">make</span> <span style="color: #0000ff;">install</span><span style="color: #000000;">

ENV PATH </span>/usr/local/nginx/<span style="color: #000000;">sbin:$PATH

EXPOSE </span><span style="color: #800080;">80</span><span style="color: #000000;">

ENTRYPOINT [</span><span style="color: #800000;">"</span><span style="color: #800000;">nginx</span><span style="color: #800000;">"</span><span style="color: #000000;">]

CMD [</span><span style="color: #800000;">"</span><span style="color: #800000;">-g</span><span style="color: #800000;">","daemon on;"</span>]</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>CMD的命令修改为了后台，我们知道如果容器内的进程在后台运行那么容器将不会运行，现在以此构建v5版本镜像：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker build -t centos_nginx:v5 .</pre>
</div>
<p>查看v5版本的新镜像：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">[root@docker docker_demo]# docker images
REPOSITORY             TAG                 IMAGE ID            CREATED             SIZE
centos_nginx           v5                  5c1131306686        </span><span style="color: #800080;">29</span> seconds ago      464MB</pre>
</div>
<p>现在利用v5版本镜像启动一个container，但是在启动的时候添加后面的command：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker run -d -p85:<span style="color: #800080;">80</span> centos_nginx:v5 -g <span style="color: #800000;">"</span><span style="color: #800000;">daemon off;</span><span style="color: #800000;">"</span><span style="color: #000000;">
5e11edbbd2a0e184f1766c435c0d9b01ef5d74b57e2e2c3a1efed0cf2a2e037b</span></pre>
</div>
<p>可以看见在后面新增了-g "daemon off;"，前面说过如果增加了命令那么Dockerfile中的CMD中的命令将不会生效</p>
<p>查看容器运行状态：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker <span style="color: #0000ff;">ps</span> -<span style="color: #000000;">l
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES
5e11edbbd2a0        centos_nginx:v5     </span><span style="color: #800000;">"</span><span style="color: #800000;">nginx -g 'daemon ...</span><span style="color: #800000;">"</span>   <span style="color: #800080;">3</span> seconds ago       Up <span style="color: #800080;">3</span> seconds        <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">85</span>-&gt;<span style="color: #800080;">80</span>/tcp   nifty_bartik</pre>
</div>
<p>可以看见容器的运行丝毫没有问题，于是nginx的服务依然还是在前台运行，没有被CMD影响，而新增加的command（-g "daemon off;"）</p>
<p>将作为ENTRYPOINT的新的参数以此为准，于是进行访问端口85</p>
<p><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/1168897-20171101222929201-743437922.png" alt=""></p>
<p>&nbsp;添加VOLUME指令：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #000000;">[root@docker docker_demo]# cat Dockerfile 
# </span><span style="color: #0000ff;">base</span><span style="color: #000000;"> image
FROM centos

# MAINTAINER
MAINTAINER json_hc@</span><span style="color: #800080;">163</span><span style="color: #000000;">.com

# put nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.tar.gz into /usr/local/<span style="color: #000000;">src and unpack nginx
ADD nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.tar.gz /usr/local/<span style="color: #000000;">src

# running required command
RUN yum install </span>-y gcc gcc-c++ glibc make autoconf openssl openssl-<span style="color: #000000;">devel 
RUN yum install </span>-y libxslt-devel -y gd gd-devel GeoIP GeoIP-devel pcre pcre-<span style="color: #000000;">devel
RUN useradd </span>-M -s /sbin/<span style="color: #000000;">nologin nginx

# mount a dir to container
VOLUME [</span><span style="color: #800000;">"</span><span style="color: #800000;">/data</span><span style="color: #800000;">"</span><span style="color: #000000;">]

# change dir to </span>/usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">
WORKDIR </span>/usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">

# execute command to compile nginx
RUN .</span>/configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-file-aio  --with-http_ssl_module  --with-http_realip_module    --with-http_addition_module    --with-http_xslt_module   --with-http_image_filter_module    --with-http_geoip_module  --with-http_sub_module  --with-http_dav_module --with-http_flv_module    --with-http_mp4_module --with-http_gunzip_module  --with-http_gzip_static_module  --with-http_auth_request_module  --with-http_random_index_module   --with-http_secure_link_module   --with-http_degradation_module   --with-http_stub_status_module &amp;&amp; make &amp;&amp;<span style="color: #000000;"> make install

# setup PATH
ENV PATH </span>/usr/local/nginx/<span style="color: #000000;">sbin:$PATH

# EXPOSE
EXPOSE </span><span style="color: #800080;">80</span><span style="color: #000000;">

# the command of entrypoint
ENTRYPOINT [</span><span style="color: #800000;">"</span><span style="color: #800000;">nginx</span><span style="color: #800000;">"</span><span style="color: #000000;">]

CMD [</span><span style="color: #800000;">"</span><span style="color: #800000;">-g</span><span style="color: #800000;">"</span>]</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>开始进行构建：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker build -t centos_nginx:v6 .</pre>
</div>
<p>查看v6版本的镜像：</p>
<div class="cnblogs_code">
<pre>[root@docker ~<span style="color: #000000;">]# docker images
REPOSITORY             TAG                 IMAGE ID            CREATED             SIZE
centos_nginx           v6                  959fdf4d4288        </span><span style="color: #800080;">35</span> seconds ago      464MB</pre>
</div>
<p>利用该镜像启动一个container：</p>
<div class="cnblogs_code">
<pre>[root@docker ~]# docker run -d -p <span style="color: #800080;">86</span>:<span style="color: #800080;">80</span> --name=nginx6 centos_nginx:v6 -g <span style="color: #800000;">"</span><span style="color: #800000;">daemon off;</span><span style="color: #800000;">"</span><span style="color: #000000;">
6c15a9e93fb1421bdb7eddaabe439996e97415e85a003f80c1d8b4b2c5ee3ffa</span></pre>
</div>
<p>查看启动的容器状态：</p>
<div class="cnblogs_code">
<pre>[root@docker ~]# docker <span style="color: #0000ff;">ps</span> -<span style="color: #000000;">l
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES
6c15a9e93fb1        centos_nginx:v6     </span><span style="color: #800000;">"</span><span style="color: #800000;">nginx -g 'daemon ...</span><span style="color: #800000;">"</span>   <span style="color: #800080;">4</span> seconds ago       Up <span style="color: #800080;">4</span> seconds        <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">86</span>-&gt;<span style="color: #800080;">80</span>/tcp   nginx6</pre>
</div>
<p>利用docker exec进入到container中，查看是否存在卷/data：</p>
<div class="cnblogs_code">
<pre>[root@6c15a9e93fb1 /<span style="color: #000000;">]# ll
total </span><span style="color: #800080;">16</span>
-rw-r--r--.   <span style="color: #800080;">8</span> root root <span style="color: #800080;">15836</span> Sep <span style="color: #800080;">11</span> <span style="color: #800080;">15</span>:<span style="color: #800080;">53</span> anaconda-<span style="color: #000000;">post.log
lrwxrwxrwx.   </span><span style="color: #800080;">1</span> root root     <span style="color: #800080;">7</span> Sep <span style="color: #800080;">11</span> <span style="color: #800080;">15</span>:<span style="color: #800080;">51</span> bin -&gt; usr/<span style="color: #000000;">bin
drwxr</span>-xr-x.   <span style="color: #800080;">2</span> root root     <span style="color: #800080;">6</span> Nov  <span style="color: #800080;">2</span> <span style="color: #800080;">01</span>:<span style="color: #800080;">42</span> data</pre>
</div>
<p>这个/data挂载的目录对应本机host的这个目录：</p>
<div class="cnblogs_code">
<pre>[root@docker _data]# <span style="color: #0000ff;">pwd</span>
/var/lib/docker/volumes/3490a9b7f9773b020343e82c1c4236d976b69eb6a80121eb80612d8c39e02820/_data</pre>
</div>
<p>现在在本机host上的这个目录创建一个文件：</p>
<div class="cnblogs_code">
<pre>[root@docker _data]# <span style="color: #0000ff;">touch</span> wadeson.<span style="color: #0000ff;">sh</span><span style="color: #000000;">
[root@docker _data]# ll
total </span><span style="color: #800080;">0</span>
-rw-r--r--. <span style="color: #800080;">1</span> root root <span style="color: #800080;">0</span> Nov  <span style="color: #800080;">1</span> <span style="color: #800080;">21</span>:<span style="color: #800080;">45</span> wadeson.<span style="color: #0000ff;">sh</span></pre>
</div>
<p>然后切换到container中查看是否存在这个文件：</p>
<div class="cnblogs_code">
<pre>[root@6c15a9e93fb1 /]# ll /data/<span style="color: #000000;">
total </span><span style="color: #800080;">0</span>
-rw-r--r--. <span style="color: #800080;">1</span> root root <span style="color: #800080;">0</span> Nov  <span style="color: #800080;">2</span> <span style="color: #800080;">01</span>:<span style="color: #800080;">45</span> wadeson.<span style="color: #0000ff;">sh</span></pre>
</div>
<p>&nbsp;</p>
<p>添加ONBUILD指令：</p>
<p>　　Dockerfile1中base image为A镜像，并在Dockerfile1中定义ONBUILD指令，构建成新镜像B镜像</p>
<p>　　Dockerfile2中base image为B镜像，构建成新镜像C</p>
<p>　　当使用镜像B启动的container1不会执行OBNUILD中定义的内容，而使用C镜像启动的container2则会执行ONBUILD定义的内容</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>[root@docker docker_demo]# <span style="color: #0000ff;">cat</span><span style="color: #000000;"> Dockerfile 
# base image
FROM centos

# MAINTAINER
MAINTAINER json_hc@</span><span style="color: #800080;">163</span><span style="color: #000000;">.com

# put nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz into /usr/local/<span style="color: #000000;">src and unpack nginx
ADD nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>.<span style="color: #0000ff;">tar</span>.gz /usr/local/<span style="color: #000000;">src

# running required command
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y <span style="color: #0000ff;">gcc</span> <span style="color: #0000ff;">gcc</span>-c++ glibc <span style="color: #0000ff;">make</span> autoconf openssl openssl-<span style="color: #000000;">devel 
RUN </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -y libxslt-devel -y gd gd-devel GeoIP GeoIP-devel pcre pcre-<span style="color: #000000;">devel
RUN useradd </span>-M -s /sbin/<span style="color: #000000;">nologin nginx

# </span><span style="color: #0000ff;">mount</span> a <span style="color: #0000ff;">dir</span><span style="color: #000000;"> to container
ONBUILD VOLUME [</span><span style="color: #800000;">"</span><span style="color: #800000;">/data</span><span style="color: #800000;">"</span><span style="color: #000000;">]

# change </span><span style="color: #0000ff;">dir</span> to /usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">
WORKDIR </span>/usr/local/src/nginx-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span><span style="color: #000000;">

# execute command to compile nginx
RUN .</span>/configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-<span style="color: #0000ff;">file</span>-aio  --with-http_ssl_module  --with-http_realip_module    --with-http_addition_module    --with-http_xslt_module   --with-http_image_filter_module    --with-http_geoip_module  --with-http_sub_module  --with-http_dav_module --with-http_flv_module    --with-http_mp4_module --with-http_gunzip_module  --with-http_gzip_static_module  --with-http_auth_request_module  --with-http_random_index_module   --with-http_secure_link_module   --with-http_degradation_module   --with-http_stub_status_module &amp;&amp; <span style="color: #0000ff;">make</span> &amp;&amp; <span style="color: #0000ff;">make</span> <span style="color: #0000ff;">install</span><span style="color: #000000;">

# setup PATH
ENV PATH </span>/usr/local/nginx/<span style="color: #000000;">sbin:$PATH

# EXPOSE
EXPOSE </span><span style="color: #800080;">80</span><span style="color: #000000;">

# the command of entrypoint
ENTRYPOINT [</span><span style="color: #800000;">"</span><span style="color: #800000;">nginx</span><span style="color: #800000;">"</span><span style="color: #000000;">]

CMD [</span><span style="color: #800000;">"</span><span style="color: #800000;">-g</span><span style="color: #800000;">"</span>]</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>使用上面Dockerfile构建镜像版本v7：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker run -d -p <span style="color: #800080;">87</span>:<span style="color: #800080;">80</span> --name=nginx7 centos_nginx:v7 -g <span style="color: #800000;">"</span><span style="color: #800000;">daemon off;</span><span style="color: #800000;">"</span><span style="color: #000000;">   
48f1fe5c71aefc0f9513e8085af8f5b7cdf14fa986fb3b11f2050f18ceefd26e</span></pre>
</div>
<p>现在进入到容器内查看是否存在/data：</p>
<div class="cnblogs_code">
<pre>[root@docker ~]# docker exec -it nginx7 /bin/<span style="color: #000000;">bash
[root@48f1fe5c71ae nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>]# ll /<span style="color: #000000;">data
</span><span style="color: #0000ff;">ls</span>: cannot access /data: No such <span style="color: #0000ff;">file</span> or directory</pre>
</div>
<p>现在修改上面Dockerfile的FROM基于的base image：</p>
<div class="cnblogs_code">
<p>[root@docker docker_demo]# cat Dockerfile<br># base image<br>FROM centos_nginx:v7</p>
<p># MAINTAINER<br>MAINTAINER json_hc@163.com</p>
</div>
<p>利用此Dockerfile构建镜像v8：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>[root@docker docker_demo]# docker build -<span style="color: #000000;">t centos_nginx:v8 .
Sending build context to Docker daemon  </span><span style="color: #800080;">986</span><span style="color: #000000;">.6kB
Step </span><span style="color: #800080;">1</span>/<span style="color: #800080;">2</span><span style="color: #000000;"> : FROM centos_nginx:v7
# Executing </span><span style="color: #800080;">1</span><span style="color: #000000;"> build trigger...
Step </span><span style="color: #800080;">1</span>/<span style="color: #800080;">1</span> : VOLUME /<span style="color: #000000;">data
 </span>---&gt; Running <span style="color: #0000ff;">in</span><span style="color: #000000;"> a6187867513d
 </span>---&gt;<span style="color: #000000;"> 5ac07930be4c
Removing intermediate container a6187867513d
Step </span><span style="color: #800080;">2</span>/<span style="color: #800080;">2</span> : MAINTAINER json_hc@<span style="color: #800080;">163</span><span style="color: #000000;">.com
 </span>---&gt; Running <span style="color: #0000ff;">in</span><span style="color: #000000;"> e02dbf8219cf
 </span>---&gt;<span style="color: #000000;"> 6f792dc07c35
Removing intermediate container e02dbf8219cf
Successfully built 6f792dc07c35
Successfully tagged centos_nginx:v8</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./docker之Dockerfile实践 - wadeson - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>可以看见卷/data已经执行了操作，现在启动一个container：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker run -d -p <span style="color: #800080;">88</span>:<span style="color: #800080;">80</span> --name=nginx8 centos_nginx:v8 -g <span style="color: #800000;">"</span><span style="color: #800000;">daemon off;</span><span style="color: #800000;">"</span><span style="color: #000000;">   
6c2a847c5f6b59b02f91afecadbfc15c88d1217a477c0421a424bce6e5eb317a</span></pre>
</div>
<p>查看容器状态，并进入到容器验证/data目录：</p>
<div class="cnblogs_code">
<pre>[root@docker docker_demo]# docker <span style="color: #0000ff;">ps</span> -<span style="color: #000000;">l
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES
6c2a847c5f6b        centos_nginx:v8     </span><span style="color: #800000;">"</span><span style="color: #800000;">nginx -g 'daemon ...</span><span style="color: #800000;">"</span>   <span style="color: #800080;">37</span> seconds ago      Up <span style="color: #800080;">37</span> seconds       <span style="color: #800080;">0.0</span>.<span style="color: #800080;">0.0</span>:<span style="color: #800080;">88</span>-&gt;<span style="color: #800080;">80</span>/<span style="color: #000000;">tcp   nginx8
[root@docker docker_demo]# docker exec </span>-it nginx8 /bin/<span style="color: #000000;">bash
[root@6c2a847c5f6b nginx</span>-<span style="color: #800080;">1.12</span>.<span style="color: #800080;">2</span>]# ll /data/<span style="color: #000000;">
total </span><span style="color: #800080;">0</span></pre>
</div>
<p>由此可见镜像v8包含了v7 的所有内容，并且增加了ONBUILD的内容</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"><a href="https://www.cnblogs.com/jsonhc/p/7766841.html" class="p_n_p_prefix">« </a> 上一篇：<a href="https://www.cnblogs.com/jsonhc/p/7766841.html" title="发布于2017-11-01 15:46">docker之Dockerfile指令介绍</a><br><a href="https://www.cnblogs.com/jsonhc/p/7777811.html" class="p_n_p_prefix">» </a> 下一篇：<a href="https://www.cnblogs.com/jsonhc/p/7777811.html" title="发布于2017-11-03 13:42">docker之数据卷管理</a><br></div>
</div>


	<div class="postDesc">posted on <span id="post-date">2017-11-01 17:50</span> <a href="https://www.cnblogs.com/jsonhc/">wadeson</a> 阅读(<span id="post_view_count">101733</span>) 评论(<span id="post_comment_count">9</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=7767669" rel="nofollow">编辑</a> <a href="https://www.cnblogs.com/jsonhc/p/7767669.html#" onclick="AddToWz(7767669);return false;">收藏</a></div>
</div>
<script type="text/javascript">var allowComments=true,cb_blogId=358609,cb_entryId=7767669,cb_blogApp=currentBlogApp,cb_blogUserGuid='a9b70db3-edc1-4255-cb7a-08d49c352df2',cb_entryCreatedDate='2017/11/1 17:50:00';loadViewCount(cb_entryId);var cb_postType=1;var isMarkdown=false;</script>

</div><a name="!comments"></a><div id="blog-comments-placeholder"><div id="comments_pager_top"></div>
<!--done-->
<br>
<b>评论:</b>
<div class="feedbackNoItems"></div>
	

		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
			<a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4149637" class="layer">#1楼</a><a name="4149637" id="comment_anchor_4149637"></a>
				 <span class="comment_date">2018-12-27 10:34</span> | <a id="a_comment_author_4149637" href="https://www.cnblogs.com/itchenfirst/" target="_blank">来自IT国的猴子</a> <a href="http://msg.cnblogs.com/send/%E6%9D%A5%E8%87%AAIT%E5%9B%BD%E7%9A%84%E7%8C%B4%E5%AD%90" title="发送站内短消息" class="sendMsg2This">&nbsp;</a><br>
				<div align="left"><div id="comment_body_4149637" class="blog_comment_body">ADD的作用<br>添加文件<br>例如：<br><br>ADD my.cnf /etc/mysql<br>1<br>ADD my.cnf /etc/mysql/<br>1<br>以上两条命令均可以将my.cnf文件添加到/etc/mysql文件夹下面。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4149637,&#39;Digg&#39;,this)">支持(1)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4149637,&#39;Bury&#39;,this)">反对(0)</a></div>&nbsp;&nbsp;<span class="comment_actions"></span></div>
			</div>
			
			
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
			<a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4149701" class="layer">#2楼</a><a name="4149701" id="comment_anchor_4149701"></a>
				 <span class="comment_date">2018-12-27 11:09</span> | <a id="a_comment_author_4149701" href="https://www.cnblogs.com/itchenfirst/" target="_blank">来自IT国的猴子</a> <a href="http://msg.cnblogs.com/send/%E6%9D%A5%E8%87%AAIT%E5%9B%BD%E7%9A%84%E7%8C%B4%E5%AD%90" title="发送站内短消息" class="sendMsg2This">&nbsp;</a><br>
				<div align="left"><div id="comment_body_4149701" class="blog_comment_body">-p: 端口映射，格式为：主机(宿主)端口:容器端口</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4149701,&#39;Digg&#39;,this)">支持(1)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4149701,&#39;Bury&#39;,this)">反对(0)</a></div>&nbsp;&nbsp;<span class="comment_actions"></span></div>
			</div>
			
			
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
			<a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4150213" class="layer">#3楼</a><a name="4150213" id="comment_anchor_4150213"></a>
				 <span class="comment_date">2018-12-27 19:33</span> | <a id="a_comment_author_4150213" href="https://www.cnblogs.com/itchenfirst/" target="_blank">来自IT国的猴子</a> <a href="http://msg.cnblogs.com/send/%E6%9D%A5%E8%87%AAIT%E5%9B%BD%E7%9A%84%E7%8C%B4%E5%AD%90" title="发送站内短消息" class="sendMsg2This">&nbsp;</a><br>
				<div align="left"><div id="comment_body_4150213" class="blog_comment_body">Dockerfile v1：<br> 不懂可以参考上一篇博客，Dockerfile里面的步骤都跟上一篇完全一样<br>ADD nginx-1.12.2.tar.gz /usr/local/src    nginx-1.12.2.tar.gz这是自己本地的文件，/usr/local/src 这个路径是镜像centos中的路径了，就是容器里面的路径了<br><br>WORKDIR /usr/local/src/nginx-1.12.2  更换操作的目录，为的就是执行下一句z指令的时候用到，<br>./configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-file-aio  --with-http_ssl_module  --with-http_realip_module    --with-http_addition_module    --with-http_xslt_module   --with-http_image_filter_module    --with-http_geoip_module  --with-http_sub_module  --with-http_dav_module --with-http_flv_module    --with-http_mp4_module --with-http_gunzip_module  --with-http_gzip_static_module  --with-http_auth_request_module  --with-http_random_index_module   --with-http_secure_link_module   --with-http_degradation_module   --with-http_stub_status_module &amp;&amp; make &amp;&amp; make install<br><br>这个一句要在/usr/local/src/nginx-1.12.2这个目录下执行，其他的跟安装nginx相同</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4150213,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4150213,&#39;Bury&#39;,this)">反对(0)</a></div>&nbsp;&nbsp;<span class="comment_actions"></span></div>
			</div>
			
			
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
			<a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4150336" class="layer">#4楼</a><a name="4150336" id="comment_anchor_4150336"></a>
				 <span class="comment_date">2018-12-27 23:05</span> | <a id="a_comment_author_4150336" href="https://www.cnblogs.com/itchenfirst/" target="_blank">来自IT国的猴子</a> <a href="http://msg.cnblogs.com/send/%E6%9D%A5%E8%87%AAIT%E5%9B%BD%E7%9A%84%E7%8C%B4%E5%AD%90" title="发送站内短消息" class="sendMsg2This">&nbsp;</a><br>
				<div align="left"><div id="comment_body_4150336" class="blog_comment_body">ENV PATH /usr/local/nginx/sbin:$PATH</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4150336,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4150336,&#39;Bury&#39;,this)">反对(0)</a></div>&nbsp;&nbsp;<span class="comment_actions"></span></div>
			</div>
			
			
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
			<a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4150337" class="layer">#5楼</a><a name="4150337" id="comment_anchor_4150337"></a>
				 <span class="comment_date">2018-12-27 23:06</span> | <a id="a_comment_author_4150337" href="https://www.cnblogs.com/itchenfirst/" target="_blank">来自IT国的猴子</a> <a href="http://msg.cnblogs.com/send/%E6%9D%A5%E8%87%AAIT%E5%9B%BD%E7%9A%84%E7%8C%B4%E5%AD%90" title="发送站内短消息" class="sendMsg2This">&nbsp;</a><br>
				<div align="left"><div id="comment_body_4150337" class="blog_comment_body">ENV PATH /usr/local/nginx/sbin:$PATH<br>PATH ：系统路径<br>$PATH ：获取原来的系统的路径</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4150337,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4150337,&#39;Bury&#39;,this)">反对(0)</a></div>&nbsp;&nbsp;<span class="comment_actions"></span></div>
			</div>
			
			
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
			<a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4150339" class="layer">#6楼</a><a name="4150339" id="comment_anchor_4150339"></a>
				 <span class="comment_date">2018-12-27 23:09</span> | <a id="a_comment_author_4150339" href="https://www.cnblogs.com/itchenfirst/" target="_blank">来自IT国的猴子</a> <a href="http://msg.cnblogs.com/send/%E6%9D%A5%E8%87%AAIT%E5%9B%BD%E7%9A%84%E7%8C%B4%E5%AD%90" title="发送站内短消息" class="sendMsg2This">&nbsp;</a><br>
				<div align="left"><div id="comment_body_4150339" class="blog_comment_body">ENV PATH /usr/local/nginx/sbin:$PATH<br>PATH ：系统路径，例如/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br>$PATH ：获取原来的系统的路径，就是上面的路径<br>：          :  分割符，相当于windows的；，java配置环境变量时候的path一样<br>说白了就是跟java配置环境变量path一样，格式是：PATH=/usr/CHENQUAN/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br><br>ENV PATH /usr/local/nginx/sbin:$PATH   这一段执行之后PATH 路径就是： /usr/local/nginx/sbin:<b>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</b></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4150339,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4150339,&#39;Bury&#39;,this)">反对(0)</a></div>&nbsp;&nbsp;<span class="comment_actions"></span></div>
			</div>
			
			
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
			<a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4206483" class="layer">#7楼</a><a name="4206483" id="comment_anchor_4206483"></a>
				 <span class="comment_date">2019-03-18 20:58</span> | <a id="a_comment_author_4206483" href="https://www.cnblogs.com/boxker/" target="_blank">波士地盘</a> <a href="http://msg.cnblogs.com/send/%E6%B3%A2%E5%A3%AB%E5%9C%B0%E7%9B%98" title="发送站内短消息" class="sendMsg2This">&nbsp;</a><br>
				<div align="left"><div id="comment_body_4206483" class="blog_comment_body">很详细，感谢博主</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4206483,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4206483,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_4206483_avatar" style="display:none;">http://pic.cnblogs.com/face/1098476/20190309195105.png</span>&nbsp;&nbsp;<span class="comment_actions"></span></div>
			</div>
			
			
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
			<a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4214619" class="layer">#8楼</a><a name="4214619" id="comment_anchor_4214619"></a>
				 <span class="comment_date">2019-03-27 10:53</span> | <a id="a_comment_author_4214619" href="https://www.cnblogs.com/mgw2168/" target="_blank">疯狂的洋芋蛋</a> <a href="http://msg.cnblogs.com/send/%E7%96%AF%E7%8B%82%E7%9A%84%E6%B4%8B%E8%8A%8B%E8%9B%8B" title="发送站内短消息" class="sendMsg2This">&nbsp;</a><br>
				<div align="left"><div id="comment_body_4214619" class="blog_comment_body">写的很好，感谢，又学了不少东西</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4214619,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4214619,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_4214619_avatar" style="display:none;">http://pic.cnblogs.com/face/1464337/20190321173713.png</span>&nbsp;&nbsp;<span class="comment_actions"></span></div>
			</div>
			
			
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
			<a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4255007" class="layer">#9楼</a><a name="4255007" id="comment_anchor_4255007"></a><span id="comment-maxId" style="display:none;">4255007</span><span id="comment-maxDate" style="display:none;">2019/5/13 22:15:59</span>
				 <span class="comment_date">2019-05-13 22:15</span> | <a id="a_comment_author_4255007" href="https://www.cnblogs.com/alinainai/" target="_blank">小白一只726</a> <a href="http://msg.cnblogs.com/send/%E5%B0%8F%E7%99%BD%E4%B8%80%E5%8F%AA726" title="发送站内短消息" class="sendMsg2This">&nbsp;</a><br>
				<div align="left"><div id="comment_body_4255007" class="blog_comment_body">感谢博主！！！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4255007,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4255007,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_4255007_avatar" style="display:none;">http://pic.cnblogs.com/face/1111364/20190130000529.png</span>&nbsp;&nbsp;<span class="comment_actions"></span></div>
			</div>
			
			
		</div>
	



<div id="comments_pager_bottom"></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/jsonhc/p/7767669.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/jsonhc/p/7767669.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"><a href="http://www.ucancode.com/index.htm" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-工控&#39;)">【推荐】超50万C++/C#源码: 大型实时仿真组态图形源码</a><br><a href="https://www.bagevent.com/event/2195041?bag_track=13072958" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-看雪&#39;)">【活动】看雪2019安全开发者峰会，共话安全领域焦点</a><br></div>
<div id="opt_under_post"></div>
<script async="async" src="./docker之Dockerfile实践 - wadeson - 博客园_files/gpt.js.download"></script>
<script>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
</script>
<script>
  googletag.cmd.push(function() {
        googletag.defineSlot('/1090369/C1', [300, 250], 'div-gpt-ad-1546353474406-0').addService(googletag.pubads());
        googletag.defineSlot('/1090369/C2', [468, 60], 'div-gpt-ad-1539008685004-0').addService(googletag.pubads());
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
  });
</script>
<div id="cnblogs_c1" class="c_ad_block">
    <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;" data-google-query-id="CPrjsI-vpeICFQ97iwodSGACMQ"><div id="google_ads_iframe_/1090369/C1_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C1_0" title="3rd party ad content" name="google_ads_iframe_/1090369/C1_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" style="border: 0px; vertical-align: bottom;" data-google-container-id="1" data-load-complete="true" src="./docker之Dockerfile实践 - wadeson - 博客园_files/saved_resource.html"></iframe></div></div>
</div>
<div id="under_post_news" style="display: none;"></div>
<div id="cnblogs_c2" class="c_ad_block">
    <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;" data-google-query-id="CPvjsI-vpeICFQ97iwodSGACMQ"><div id="google_ads_iframe_/1090369/C2_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C2_0" title="3rd party ad content" name="google_ads_iframe_/1090369/C2_0" width="468" height="60" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" style="border: 0px; vertical-align: bottom;" data-google-container-id="2" data-load-complete="true" src="./docker之Dockerfile实践 - wadeson - 博客园_files/saved_resource(1).html"></iframe></div></div>
</div>
<div id="under_post_kb"><div class="itnews c_ad_block"><b>最新新闻</b>：<br> ·  <a href="https://news.cnblogs.com/n/625501/" target="_blank">谷歌内战史</a><br> ·  <a href="https://news.cnblogs.com/n/625500/" target="_blank">华为致信全球客户：保证绝大部分产品仍能继续服务</a><br> ·  <a href="https://news.cnblogs.com/n/625499/" target="_blank">谷歌无人机快递Wing进军芬兰：将送餐馆外卖</a><br> ·  <a href="https://news.cnblogs.com/n/625498/" target="_blank">意识永存：脑机结合让大脑复活</a><br> ·  <a href="https://news.cnblogs.com/n/625497/" target="_blank">7nm Zen2三代锐龙很好很强！但最担心的事情还是发生了</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
 if(enablePostBottom()) {
    codeHighlight();
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverT2();
    deliverC1();
    deliverC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);  
}
</script>
</div>

    
</div>
<div id="leftcontent">
	
		<div id="leftcontentcontainer">
			
<!--done-->
<div class="newsItem">
	<div id="blog-news"><div id="profile_block">昵称：<a href="https://home.cnblogs.com/u/jsonhc/">wadeson</a><br>园龄：<a href="https://home.cnblogs.com/u/jsonhc/" title="入园时间：2017-05-19">1年11个月</a><br>粉丝：<a href="https://home.cnblogs.com/u/jsonhc/followers/">57</a><br>关注：<a href="https://home.cnblogs.com/u/jsonhc/followees/">2</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="follow(&#39;a9b70db3-edc1-4255-cb7a-08d49c352df2&#39;)">+加关注</a></div><script>getFollowStatus('a9b70db3-edc1-4255-cb7a-08d49c352df2')</script></div></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="blog-calendar" style=""><table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2019/04/01&#39;);return false;">&lt;</a></td><td align="center">2019年5月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2019/06/01&#39;);return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" align="center" abbr="日" scope="col">日</th><th class="CalDayHeader" align="center" abbr="一" scope="col">一</th><th class="CalDayHeader" align="center" abbr="二" scope="col">二</th><th class="CalDayHeader" align="center" abbr="三" scope="col">三</th><th class="CalDayHeader" align="center" abbr="四" scope="col">四</th><th class="CalDayHeader" align="center" abbr="五" scope="col">五</th><th class="CalDayHeader" align="center" abbr="六" scope="col">六</th></tr><tr><td class="CalOtherMonthDay" align="center">28</td><td class="CalOtherMonthDay" align="center">29</td><td class="CalOtherMonthDay" align="center">30</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td class="CalWeekendDay" align="center">4</td></tr><tr><td class="CalWeekendDay" align="center">5</td><td align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td align="center">10</td><td class="CalWeekendDay" align="center">11</td></tr><tr><td class="CalWeekendDay" align="center">12</td><td align="center">13</td><td align="center">14</td><td align="center">15</td><td align="center">16</td><td align="center">17</td><td class="CalTodayDay" align="center">18</td></tr><tr><td class="CalWeekendDay" align="center">19</td><td align="center">20</td><td align="center">21</td><td align="center">22</td><td align="center">23</td><td align="center">24</td><td class="CalWeekendDay" align="center">25</td></tr><tr><td class="CalWeekendDay" align="center">26</td><td align="center">27</td><td align="center">28</td><td align="center">29</td><td align="center">30</td><td align="center">31</td><td class="CalOtherMonthDay" align="center">1</td></tr><tr><td class="CalOtherMonthDay" align="center">2</td><td class="CalOtherMonthDay" align="center">3</td><td class="CalOtherMonthDay" align="center">4</td><td class="CalOtherMonthDay" align="center">5</td><td class="CalOtherMonthDay" align="center">6</td><td class="CalOtherMonthDay" align="center">7</td><td class="CalOtherMonthDay" align="center">8</td></tr>
</tbody></table></div><script type="text/javascript">loadBlogDefaultCalendar();</script><br>
			<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block">
<div id="sidebar_search" class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="sidebar_search_box">
<div id="widget_my_zzk" class="div_my_zzk"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk"></div>
<div id="widget_my_google" class="div_my_zzk"><input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event)" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk"></div>
</div>
</div>

</div><div id="sidebar_shortcut" class="sidebar-block">
<h3 class="catListTitle">常用链接</h3>
<ul>
<li><a href="https://www.cnblogs.com/jsonhc/p/" title="我的博客的随笔列表">我的随笔</a></li><li><a href="https://www.cnblogs.com/jsonhc/MyComments.html" title="我发表过的评论列表">我的评论</a></li><li><a href="https://www.cnblogs.com/jsonhc/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li><li><a href="https://www.cnblogs.com/jsonhc/RecentComments.html" title="我的博客的评论列表">最新评论</a></li><li><a href="https://www.cnblogs.com/jsonhc/tag/" title="我的博客的标签列表">我的标签</a></li>
</ul>
<div id="itemListLin_con" style="display:none;">

</div></div><div id="sidebar_toptags" class="sidebar-block">
<h3 class="catListTitle">我的标签</h3>
<div id="MyTag">
<ul>
<li><a href="https://www.cnblogs.com/jsonhc/tag/docker/">docker</a>(18)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/ELK/">ELK</a>(8)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/openstack/">openstack</a>(8)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/python/">python</a>(8)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/tomcat/">tomcat</a>(8)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/saltstack/">saltstack</a>(6)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/nginx/">nginx</a>(5)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/ansible/">ansible</a>(5)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/jenkins/">jenkins</a>(3)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/ftp/">ftp</a>(3)</li><li><a href="https://www.cnblogs.com/jsonhc/tag/">更多</a></li>
</ul>
</div></div><div id="sidebar_categories">
		<h3 class="catListTitle">随笔档案</h3>
		
				<ul class="catList">
			
				<li class="catListItem"> <a id="CatList_LinkList_0_Link_0" class="listitem" href="https://www.cnblogs.com/jsonhc/archive/2018/12.html">2018年12月 (8)</a></li>
			
				<li class="catListItem"> <a id="CatList_LinkList_0_Link_1" class="listitem" href="https://www.cnblogs.com/jsonhc/archive/2018/02.html">2018年2月 (1)</a></li>
			
				<li class="catListItem"> <a id="CatList_LinkList_0_Link_2" class="listitem" href="https://www.cnblogs.com/jsonhc/archive/2018/01.html">2018年1月 (4)</a></li>
			
				<li class="catListItem"> <a id="CatList_LinkList_0_Link_3" class="listitem" href="https://www.cnblogs.com/jsonhc/archive/2017/12.html">2017年12月 (3)</a></li>
			
				<li class="catListItem"> <a id="CatList_LinkList_0_Link_4" class="listitem" href="https://www.cnblogs.com/jsonhc/archive/2017/11.html">2017年11月 (20)</a></li>
			
				<li class="catListItem"> <a id="CatList_LinkList_0_Link_5" class="listitem" href="https://www.cnblogs.com/jsonhc/archive/2017/10.html">2017年10月 (17)</a></li>
			
				<li class="catListItem"> <a id="CatList_LinkList_0_Link_6" class="listitem" href="https://www.cnblogs.com/jsonhc/archive/2017/09.html">2017年9月 (5)</a></li>
			
				<li class="catListItem"> <a id="CatList_LinkList_0_Link_7" class="listitem" href="https://www.cnblogs.com/jsonhc/archive/2017/08.html">2017年8月 (20)</a></li>
			
				<li class="catListItem"> <a id="CatList_LinkList_0_Link_8" class="listitem" href="https://www.cnblogs.com/jsonhc/archive/2017/07.html">2017年7月 (23)</a></li>
			
				</ul>
			
	
</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<h3 class="catListTitle">最新评论</h3>
<div class="RecentComment" id="RecentComments">
	<div id="RecentCommentsBlock"><ul>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4255007">1. Re:docker之Dockerfile实践</a></li>
        <li class="recent_comment_body">感谢博主！！！</li>
        <li class="recent_comment_author">--小白一只726</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4214619">2. Re:docker之Dockerfile实践</a></li>
        <li class="recent_comment_body">写的很好，感谢，又学了不少东西</li>
        <li class="recent_comment_author">--疯狂的洋芋蛋</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/jsonhc/p/7767669.html#4206483">3. Re:docker之Dockerfile实践</a></li>
        <li class="recent_comment_body">很详细，感谢博主</li>
        <li class="recent_comment_author">--波士地盘</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/jsonhc/p/7199295.html#4191514">4. Re:nginx之配置proxy_set_header</a></li>
        <li class="recent_comment_body">我用nginx部署abp项目，然后前端站点的请求转发到abp的后端站点，发现Abp.TenantId这个header没有转发过去导致处理异常，请问这个在nginx中怎么配置到能转发呢。我是使用prox......</li>
        <li class="recent_comment_author">--turingguo</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/jsonhc/p/10195952.html#4153140">5. Re:ELK之kibana6.5</a></li>
        <li class="recent_comment_body">你好， 请教一下： 我装的ELK 是6.3.0的，配置kibana的时候右下角有提示:You cannot use Index Management because your basic licens......</li>
        <li class="recent_comment_author">--zyj522931</li>
</ul>
</div>
</div>
</div></div><div id="sidebar_topviewedposts" class="sidebar-block"><div id="topview_posts_wrap">
<h3 class="catListTitle">阅读排行榜</h3>
<div class="RecentComment" id="TopViewPosts"> 
	<div id="TopViewPostsBlock"><ul><li><a href="https://www.cnblogs.com/jsonhc/p/7767669.html">1. docker之Dockerfile实践(101731)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7199295.html">2. nginx之配置proxy_set_header(43270)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7283620.html">3. python3.6连接oracle数据库(27211)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7811929.html">4. docker-compose初试及命令基础(21663)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7823286.html">5. docker network基础(19109)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topcommentedposts" class="sidebar-block"><div id="topfeedback_posts_wrap">
<h3 class="catListTitle">评论排行榜</h3>
<div class="RecentComment" id="TopCommentsPosts">
	<div id="TopFeedbackPostsBlock"><ul><li><a href="https://www.cnblogs.com/jsonhc/p/7767669.html">1. docker之Dockerfile实践(9)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7692227.html">2. 照着官网来安装openstack pike之environment设置(5)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7372359.html">3. jenkins配置从节点(2)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7199295.html">4. nginx之配置proxy_set_header(2)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7784466.html">5. docker之docker-machine用法(2)</a></li></ul></div>
</div></div></div><div id="sidebar_topdiggedposts" class="sidebar-block"><div id="topdigg_posts_wrap">
<h3 class="catListTitle">推荐排行榜</h3>
<div class="RecentComment">
	<div id="TopDiggPostsBlock"><ul><li><a href="https://www.cnblogs.com/jsonhc/p/7767669.html">1. docker之Dockerfile实践(9)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7823286.html">2. docker network基础(2)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7784466.html">3. docker之docker-machine用法(2)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7199295.html">4. nginx之配置proxy_set_header(2)</a></li><li><a href="https://www.cnblogs.com/jsonhc/p/7754247.html">5. docker基础(2)</a></li></ul></div>
</div></div></div></div><script type="text/javascript">loadBlogSideColumn();</script></div>
	
</div>

<!--done-->
<div class="footer">
	Powered by: <a href="http://www.cnblogs.com/">博客园</a>	模板提供：<a href="http://blog.hjenglish.com/">沪江博客</a>
	Copyright ©2019 wadeson
</div>






</body></html>