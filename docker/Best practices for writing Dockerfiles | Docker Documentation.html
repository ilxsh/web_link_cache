<!-- Page generated 2019-05-08 01:18:47 +0000 -->
<!-- relative link basehrefs -->
<!-- Logic for 'edit this button' -->
<!-- End of logic for 'edit this button' -->
<!DOCTYPE html>
<html lang="en"><head>
	<!-- base href="https://docs.docker.com/develop/develop-images/" -->
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<script type="text/javascript" async="" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/linkid.js"></script><script type="text/javascript" async="" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/analytics.js"></script><script type="text/javascript" async="" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/analytics.js"></script><script type="text/javascript" async="" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/gtm.js"></script><script id="pd-rating-js" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/rating.js"></script><script type="text/javascript" async="" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/analytics_002.js"></script><script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://docs.docker.com/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://docs.docker.com/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="/favicons/docs@2x.ico">
	<!-- metadata -->
	<meta property="og:type" content="website">
	<meta property="og:updated_time" itemprop="dateUpdated" content="2019-05-08T01:18:47+00:00">
	<meta property="og:image" itemprop="image primaryImageOfPage" content="/images/docs@2x.png">
	<meta name="twitter:card" content="summary">
	<meta name="twitter:domain" content="docs.docker.com">
	<meta name="twitter:site" content="@docker_docs">
	<meta name="twitter:url" content="https://twitter.com/docker_docs">
	<meta name="twitter:title" itemprop="title name" content="Best practices for writing Dockerfiles">
	<meta name="twitter:description" property="og:description" itemprop="description" content="This document covers recommended best practices and methods for building efficient images. Docker builds images automatically by reading the instructions from a Dockerfile -- a text file that contains all...">
	<meta name="twitter:image:src" content="/images/docs@2x.png">
	<meta name="twitter:image:alt" content="Docker Documentation">
	<meta property="article:published_time" itemprop="datePublished" content="2019-05-08T01:18:47+00:00">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="parent image, images, dockerfile, best practices, hub, official image">
	<link rel="stylesheet" href="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/font-awesome.css">
	<link rel="stylesheet" href="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/bootstrap.css">
	<link id="pygments" rel="stylesheet" href="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/css.css" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Best practices for writing Dockerfiles | Docker Documentation</title>
<meta property="og:title" content="Best practices for writing Dockerfiles">
<meta property="og:locale" content="en_US">
<meta name="description" content="Hints, tips and guidelines for writing clean, reliable Dockerfiles">
<meta property="og:description" content="Hints, tips and guidelines for writing clean, reliable Dockerfiles">
<link rel="canonical" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">
<meta property="og:url" content="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">
<meta property="og:site_name" content="Docker Documentation">
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Best practices for writing Dockerfiles","description":"Hints, tips and guidelines for writing clean, reliable Dockerfiles","url":"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	</script>
<script charset="utf-8" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/rate.js"></script><script charset="utf-8" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/rating-results.js"></script><style type="text/css" id="pd_popup_holder_style_8453675">#pd_popup_holder_8453675 { position:absolute; display:none; width:175px; height:auto; top:0px; left:0px; z-index:10000; border:solid 1px #CCC; background-color:white; padding:0px 15px;font-family:Arial,Sans;box-shadow: -10px 10px 20px rgba(0, 0, 0, .5);-webkit-box-shadow: 0px 0px 6px rgba(0, 0, 0, .25);-moz-box-shadow: 0px 0px 6px rgba(0, 0, 0, .25); }</style></head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://docs.docker.com/"><img class="logo" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: visible;">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="/search/" style="visibility: visible;">
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="Search the docs" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">Search</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal"><li id="guides" class="active"><a href="https://docs.docker.com/">Guides</a></li>
<li id="manuals"><a href="https://docs.docker.com/ee/">Product manuals</a></li>
<li id="glossary"><a href="https://docs.docker.com/glossary/">Glossary</a></li>
<li id="reference"><a href="https://docs.docker.com/reference/">Reference</a></li>
<li id="samples"><a href="https://docs.docker.com/samples/">Samples</a></li>
</ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: visible;">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v18.09 (current)        <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://docs.docker.com/edge/">Docker edge</a></li><li><a href="https://docs.docker.com/v18.03/">Docker v18.03</a></li><li><a href="https://docs.docker.com/v17.12/">Docker v17.12</a></li><li><a href="https://docs.docker.com/v17.09/">Docker v17.09</a></li><li><a href="https://docs.docker.com/v17.06/">Docker v17.06</a></li><li><a href="https://docs.docker.com/v17.03/">Docker v17.03</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>
	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Best practices for writing Dockerfiles</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">Estimated reading time: </span>
  
  
    30 minutes
  
</span>

							
							
							<p>This document covers recommended best practices and methods for building
efficient images.</p>

<p>Docker builds images automatically by reading the instructions from a
<code class="highlighter-rouge">Dockerfile</code> -- a text file that contains all commands, in order, needed to
build a given image. A <code class="highlighter-rouge">Dockerfile</code> adheres to a specific format and set of
instructions which you can find at <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a>.</p>

<p>A Docker image consists of read-only layers each of which represents a
Dockerfile  instruction. The layers are stacked and each one is a delta of the
changes from the previous layer. Consider this <code class="highlighter-rouge">Dockerfile</code>:</p>

<pre><code class="language-Dockerfile">FROM ubuntu:18.04
COPY . /app
RUN make /app
CMD python /app/app.py
</code></pre>

<p>Each instruction creates one layer:</p>

<ul>
  <li><code class="highlighter-rouge">FROM</code> creates a layer from the <code class="highlighter-rouge">ubuntu:18.04</code> Docker image.</li>
  <li><code class="highlighter-rouge">COPY</code> adds files from your Docker client’s current directory.</li>
  <li><code class="highlighter-rouge">RUN</code> builds your application with <code class="highlighter-rouge">make</code>.</li>
  <li><code class="highlighter-rouge">CMD</code> specifies what command to run within the container.</li>
</ul>

<p>When you run an image and generate a container, you add a new <em>writable layer</em>
(the “container layer”) on top of the underlying layers. All changes made to
the running container, such as writing new files, modifying existing files, and
deleting files, are written to this thin writable container layer.</p>

<p>For more on image layers (and how Docker builds and stores images), see
<a href="https://docs.docker.com/storage/storagedriver/">About storage drivers</a>.</p>

<h2 id="general-guidelines-and-recommendations">General guidelines and recommendations</h2>

<h3 id="create-ephemeral-containers">Create ephemeral containers</h3>

<p>The image defined by your <code class="highlighter-rouge">Dockerfile</code> should generate containers that are as
ephemeral as possible. By “ephemeral”, we mean that the container can be stopped
and destroyed, then rebuilt and replaced with an absolute minimum set up and
configuration.</p>

<p>Refer to <a href="https://12factor.net/processes">Processes</a> under <em>The Twelve-factor App</em>
methodology to get a feel for the motivations of running containers in such a
stateless fashion.</p>

<h3 id="understand-build-context">Understand build context</h3>

<p>When you issue a <code class="highlighter-rouge">docker build</code> command, the current working directory is called
the <em>build context</em>. By default, the Dockerfile is assumed to be located here,
but you can specify a different location with the file flag (<code class="highlighter-rouge">-f</code>). Regardless
of where the <code class="highlighter-rouge">Dockerfile</code> actually lives, all recursive contents of files and
directories in the current directory are sent to the Docker daemon as the build
context.</p>

<blockquote>
  <p>Build context example</p>

  <p>Create a directory for the build context and <code class="highlighter-rouge">cd</code> into it. Write “hello” into
a text file named <code class="highlighter-rouge">hello</code> and create a Dockerfile that runs <code class="highlighter-rouge">cat</code> on it. Build
the image from within the build context (<code class="highlighter-rouge">.</code>):</p>

  <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir myproject <span class="o">&amp;&amp;</span> <span class="nb">cd </span>myproject
<span class="nb">echo</span> <span class="s2">"hello"</span> <span class="o">&gt;</span> hello
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"FROM busybox</span><span class="se">\n</span><span class="s2">COPY /hello /</span><span class="se">\n</span><span class="s2">RUN cat /hello"</span> <span class="o">&gt;</span> Dockerfile
docker build <span class="nt">-t</span> helloapp:v1 <span class="nb">.</span>
</code></pre></div>  </div>

  <p>Move <code class="highlighter-rouge">Dockerfile</code> and <code class="highlighter-rouge">hello</code> into separate directories and build a second
version of the image (without relying on cache from the last build). Use <code class="highlighter-rouge">-f</code>
to point to the Dockerfile and specify the directory of the build context:</p>

  <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir <span class="nt">-p</span> dockerfiles context
mv Dockerfile dockerfiles <span class="o">&amp;&amp;</span> mv hello context
docker build <span class="nt">--no-cache</span> <span class="nt">-t</span> helloapp:v2 <span class="nt">-f</span> dockerfiles/Dockerfile context
</code></pre></div>  </div>
</blockquote>

<p>Inadvertently including files that are not necessary for building an image
results in a larger build context and larger image size. This can increase the
time to build the image, time to pull and push it, and the container runtime
size. To see how big your build context is, look for a message like this when
building your <code class="highlighter-rouge">Dockerfile</code>:</p>

<pre><code class="language-none">Sending build context to Docker daemon  187.8MB
</code></pre>

<h3 id="pipe-dockerfile-through-stdin">Pipe Dockerfile through <code class="highlighter-rouge">stdin</code></h3>

<p>Docker has the ability to build images by piping <code class="highlighter-rouge">Dockerfile</code> through <code class="highlighter-rouge">stdin</code>
with a <em>local or remote build context</em>. Piping a <code class="highlighter-rouge">Dockerfile</code> through <code class="highlighter-rouge">stdin</code>
can be useful to perform one-off builds without writing a Dockerfile to disk,
or in situations where the <code class="highlighter-rouge">Dockerfile</code> is generated, and should not persist
afterwards.</p>

<blockquote>
  <p>The examples in this section use <a href="http://tldp.org/LDP/abs/html/here-docs.html">here documents</a>
for convenience, but any method to provide the <code class="highlighter-rouge">Dockerfile</code> on <code class="highlighter-rouge">stdin</code> can be
used.</p>

  <p>For example, the following commands are equivalent:</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'FROM busybox\nRUN echo "hello world"'</span> | docker build -
</code></pre></div>  </div>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build -<span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
FROM busybox
RUN echo "hello world"
</span><span class="no">EOF
</span></code></pre></div>  </div>

  <p>You can substitute the examples with your preferred approach, or the approach
that best fits your use-case.</p>
</blockquote>

<h4 id="build-an-image-using-a-dockerfile-from-stdin-without-sending-build-context">Build an image using a Dockerfile from stdin, without sending build context</h4>

<p>Use this syntax to build an image using a <code class="highlighter-rouge">Dockerfile</code> from <code class="highlighter-rouge">stdin</code>, without
sending additional files as build context. The hyphen (<code class="highlighter-rouge">-</code>) takes the position
of the <code class="highlighter-rouge">PATH</code>, and instructs Docker to read the build context (which only
contains a <code class="highlighter-rouge">Dockerfile</code>) from <code class="highlighter-rouge">stdin</code> instead of a directory:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="o">[</span>OPTIONS] -
</code></pre></div></div>

<p>The following example builds an image using a <code class="highlighter-rouge">Dockerfile</code> that is passed through
<code class="highlighter-rouge">stdin</code>. No files are sent as build context to the daemon.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> myimage:latest -<span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
FROM busybox
RUN echo "hello world"
</span><span class="no">EOF
</span></code></pre></div></div>

<p>Omitting the build context can be useful in situations where your <code class="highlighter-rouge">Dockerfile</code>
does not require files to be copied into the image, and improves the build-speed,
as no files are sent to the daemon.</p>

<p>If you want to improve the build-speed by excluding <em>some</em> files from the build-
context, refer to <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#exclude-with-dockerignore">exclude with .dockerignore</a>.</p>

<blockquote>
  <p><strong>Note</strong>: Attempting to build a Dockerfile that uses <code class="highlighter-rouge">COPY</code> or <code class="highlighter-rouge">ADD</code> will fail
if this syntax is used. The following example illustrates this:</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create a directory to work in</span>
mkdir example
<span class="nb">cd </span>example

<span class="c"># create an example file</span>
touch somefile.txt

docker build <span class="nt">-t</span> myimage:latest -<span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
FROM busybox
COPY somefile.txt .
RUN cat /somefile.txt
</span><span class="no">EOF

</span><span class="c"># observe that the build fails</span>
...
Step 2/3 : COPY somefile.txt <span class="nb">.</span>
COPY failed: stat /var/lib/docker/tmp/docker-builder249218248/somefile.txt: no such file or directory
</code></pre></div>  </div>
</blockquote>

<h4 id="build-from-a-local-build-context-using-a-dockerfile-from-stdin">Build from a local build context, using a Dockerfile from stdin</h4>

<p>Use this syntax to build an image using files on your local filesystem, but using
a <code class="highlighter-rouge">Dockerfile</code> from <code class="highlighter-rouge">stdin</code>. The syntax uses the <code class="highlighter-rouge">-f</code> (or <code class="highlighter-rouge">--file</code>) option to
specify the <code class="highlighter-rouge">Dockerfile</code> to use, using a hyphen (<code class="highlighter-rouge">-</code>) as filename to instruct
Docker to read the <code class="highlighter-rouge">Dockerfile</code> from <code class="highlighter-rouge">stdin</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="o">[</span>OPTIONS] <span class="nt">-f-</span> PATH
</code></pre></div></div>

<p>The example below uses the current directory (<code class="highlighter-rouge">.</code>) as the build context, and builds
an image using a <code class="highlighter-rouge">Dockerfile</code> that is passed through <code class="highlighter-rouge">stdin</code> using a <a href="http://tldp.org/LDP/abs/html/here-docs.html">here
document</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create a directory to work in</span>
mkdir example
<span class="nb">cd </span>example

<span class="c"># create an example file</span>
touch somefile.txt

<span class="c"># build an image using the current directory as context, and a Dockerfile passed through stdin</span>
docker build <span class="nt">-t</span> myimage:latest <span class="nt">-f-</span> <span class="nb">.</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
FROM busybox
COPY somefile.txt .
RUN cat /somefile.txt
</span><span class="no">EOF
</span></code></pre></div></div>

<h4 id="build-from-a-remote-build-context-using-a-dockerfile-from-stdin">Build from a remote build context, using a Dockerfile from stdin</h4>

<p>Use this syntax to build an image using files from a remote <code class="highlighter-rouge">git</code> repository, 
using a <code class="highlighter-rouge">Dockerfile</code> from <code class="highlighter-rouge">stdin</code>. The syntax uses the <code class="highlighter-rouge">-f</code> (or <code class="highlighter-rouge">--file</code>) option to
specify the <code class="highlighter-rouge">Dockerfile</code> to use, using a hyphen (<code class="highlighter-rouge">-</code>) as filename to instruct
Docker to read the <code class="highlighter-rouge">Dockerfile</code> from <code class="highlighter-rouge">stdin</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="o">[</span>OPTIONS] <span class="nt">-f-</span> PATH
</code></pre></div></div>

<p>This syntax can be useful in situations where you want to build an image from a
repository does not contain a <code class="highlighter-rouge">Dockerfile</code>, or if you want to build with a custom
<code class="highlighter-rouge">Dockerfile</code>, without maintaining your own fork of the repository.</p>

<p>The example below builds an image using a <code class="highlighter-rouge">Dockerfile</code> from <code class="highlighter-rouge">stdin</code>, and adds
the <code class="highlighter-rouge">README.md</code> file from the <a href="https://github.com/docker-library/hello-world">“hello-world” Git repository on GitHub</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> myimage:latest <span class="nt">-f-</span> https://github.com/docker-library/hello-world.git <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
FROM busybox
COPY README.md .
</span><span class="no">EOF
</span></code></pre></div></div>

<blockquote>
  <p><strong>Under the hood</strong></p>

  <p>When building an image using a remote Git repository as build context, Docker 
performs a <code class="highlighter-rouge">git clone</code> of the repository on the local machine, and sends
those files as build context to the daemon. This feature requires <code class="highlighter-rouge">git</code> to be
installed on the host where you run the <code class="highlighter-rouge">docker build</code> command.</p>
</blockquote>

<h3 id="exclude-with-dockerignore">Exclude with .dockerignore</h3>

<p>To exclude files not relevant to the build (without restructuring your source
repository) use a <code class="highlighter-rouge">.dockerignore</code> file. This file supports exclusion patterns
similar to <code class="highlighter-rouge">.gitignore</code> files. For information on creating one, see the
<a href="https://docs.docker.com/engine/reference/builder/#dockerignore-file">.dockerignore file</a>.</p>

<h3 id="use-multi-stage-builds">Use multi-stage builds</h3>

<p><a href="https://docs.docker.com/develop/develop-images/multistage-build/">Multi-stage builds</a> allow you to drastically reduce the
size of your final image, without struggling to reduce the number of intermediate
layers and files.</p>

<p>Because an image is built during the final stage of the build process, you can
minimize image layers by <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#leverage-build-cache">leveraging build cache</a>.</p>

<p>For example, if your build contains several layers, you can order them from the
less frequently changed (to ensure the build cache is reusable) to the more
frequently changed:</p>

<ul>
  <li>
    <p>Install tools you need to build your application</p>
  </li>
  <li>
    <p>Install or update library dependencies</p>
  </li>
  <li>
    <p>Generate your application</p>
  </li>
</ul>

<p>A Dockerfile for a Go application could look like:</p>

<pre><code class="language-Dockerfile">FROM golang:1.11-alpine AS build

# Install tools required for project
# Run `docker build --no-cache .` to update dependencies
RUN apk add --no-cache git
RUN go get github.com/golang/dep/cmd/dep

# List project dependencies with Gopkg.toml and Gopkg.lock
# These layers are only re-built when Gopkg files are updated
COPY Gopkg.lock Gopkg.toml /go/src/project/
WORKDIR /go/src/project/
# Install library dependencies
RUN dep ensure -vendor-only

# Copy the entire project and build it
# This layer is rebuilt when a file changes in the project directory
COPY . /go/src/project/
RUN go build -o /bin/project

# This results in a single layer image
FROM scratch
COPY --from=build /bin/project /bin/project
ENTRYPOINT ["/bin/project"]
CMD ["--help"]
</code></pre>

<h3 id="dont-install-unnecessary-packages">Don’t install unnecessary packages</h3>

<p>To reduce complexity, dependencies, file sizes, and build times, avoid
installing extra or unnecessary packages just because they might be “nice to
have.” For example, you don’t need to include a text editor in a database image.</p>

<h3 id="decouple-applications">Decouple applications</h3>

<p>Each container should have only one concern. Decoupling applications into
multiple containers makes it easier to scale horizontally and reuse containers.
For instance, a web application stack might consist of three separate
containers, each with its own unique image, to manage the web application,
database, and an in-memory cache in a decoupled manner.</p>

<p>Limiting each container to one process is a good rule of thumb, but it is not a
hard and fast rule. For example, not only can containers be
<a href="https://docs.docker.com/engine/reference/run/#specify-an-init-process">spawned with an init process</a>,
some programs might spawn additional processes of their own accord. For
instance, <a href="http://www.celeryproject.org/">Celery</a> can spawn multiple worker
processes, and <a href="https://httpd.apache.org/">Apache</a> can create one process per
request.</p>

<p>Use your best judgment to keep containers as clean and modular as possible. If
containers depend on each other, you can use <a href="https://docs.docker.com/engine/userguide/networking/">Docker container networks</a>
to ensure that these containers can communicate.</p>

<h3 id="minimize-the-number-of-layers">Minimize the number of layers</h3>

<p>In older versions of Docker, it was important that you minimized the number of
layers in your images to ensure they were performant. The following features
were added to reduce this limitation:</p>

<ul>
  <li>
    <p>Only the instructions <code class="highlighter-rouge">RUN</code>, <code class="highlighter-rouge">COPY</code>, <code class="highlighter-rouge">ADD</code> create layers. Other instructions
create temporary intermediate images, and do not increase the size of the build.</p>
  </li>
  <li>
    <p>Where possible, use <a href="https://docs.docker.com/develop/develop-images/multistage-build/">multi-stage builds</a>, and only copy
the artifacts you need into the final image. This allows you to include tools
and debug information in your intermediate build stages without increasing the
size of the final image.</p>
  </li>
</ul>

<h3 id="sort-multi-line-arguments">Sort multi-line arguments</h3>

<p>Whenever possible, ease later changes by sorting multi-line arguments
alphanumerically. This helps to avoid duplication of packages and make the
list much easier to update. This also makes PRs a lot easier to read and
review. Adding a space before a backslash (<code class="highlighter-rouge">\</code>) helps as well.</p>

<p>Here’s an example from the <a href="https://github.com/docker-library/buildpack-deps"><code class="highlighter-rouge">buildpack-deps</code> image</a>:</p>

<pre><code class="language-Dockerfile">RUN apt-get update &amp;&amp; apt-get install -y \
  bzr \
  cvs \
  git \
  mercurial \
  subversion
</code></pre>

<h3 id="leverage-build-cache">Leverage build cache</h3>

<p>When building an image, Docker steps through the instructions in your
<code class="highlighter-rouge">Dockerfile</code>, executing each in the order specified. As each instruction is
examined, Docker looks for an existing image in its cache that it can reuse,
rather than creating a new (duplicate) image.</p>

<p>If you do not want to use the cache at all, you can use the <code class="highlighter-rouge">--no-cache=true</code>
option on the <code class="highlighter-rouge">docker build</code> command. However, if you do let Docker use its
cache, it is important to understand when it can, and cannot, find a matching
image. The basic rules that Docker follows are outlined below:</p>

<ul>
  <li>
    <p>Starting with a parent image that is already in the cache, the next
instruction is compared against all child images derived from that base
image to see if one of them was built using the exact same instruction. If
not, the cache is invalidated.</p>
  </li>
  <li>
    <p>In most cases, simply comparing the instruction in the <code class="highlighter-rouge">Dockerfile</code> with one
of the child images is sufficient. However, certain instructions require more
examination and explanation.</p>
  </li>
  <li>
    <p>For the <code class="highlighter-rouge">ADD</code> and <code class="highlighter-rouge">COPY</code> instructions, the contents of the file(s)
in the image are examined and a checksum is calculated for each file.
The last-modified and last-accessed times of the file(s) are not considered in
these checksums. During the cache lookup, the checksum is compared against the
checksum in the existing images. If anything has changed in the file(s), such
as the contents and metadata, then the cache is invalidated.</p>
  </li>
  <li>
    <p>Aside from the <code class="highlighter-rouge">ADD</code> and <code class="highlighter-rouge">COPY</code> commands, cache checking does not look at the
files in the container to determine a cache match. For example, when processing
a <code class="highlighter-rouge">RUN apt-get -y update</code> command the files updated in the container
are not examined to determine if a cache hit exists.  In that case just
the command string itself is used to find a match.</p>
  </li>
</ul>

<p>Once the cache is invalidated, all subsequent <code class="highlighter-rouge">Dockerfile</code> commands generate new
images and the cache is not used.</p>

<h2 id="dockerfile-instructions">Dockerfile instructions</h2>

<p>These recommendations are designed to help you create an efficient and
maintainable <code class="highlighter-rouge">Dockerfile</code>.</p>

<h3 id="from">FROM</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#from">Dockerfile reference for the FROM instruction</a></p>

<p>Whenever possible, use current official images as the basis for your
images. We recommend the <a href="https://hub.docker.com/_/alpine/">Alpine image</a> as it
is tightly controlled and small in size (currently under 5 MB), while still
being a full Linux distribution.</p>

<h3 id="label">LABEL</h3>

<p><a href="https://docs.docker.com/config/labels-custom-metadata/">Understanding object labels</a></p>

<p>You can add labels to your image to help organize images by project, record
licensing information, to aid in automation, or for other reasons. For each
label, add a line beginning with <code class="highlighter-rouge">LABEL</code> and with one or more key-value pairs.
The following examples show the different acceptable formats. Explanatory comments are included inline.</p>

<blockquote>
  <p>Strings with spaces must be quoted <strong>or</strong> the spaces must be escaped. Inner
quote characters (<code class="highlighter-rouge">"</code>), must also be escaped.</p>
</blockquote>

<pre><code class="language-Dockerfile"># Set one or more individual labels
LABEL com.example.version="0.0.1-beta"
LABEL vendor1="ACME Incorporated"
LABEL vendor2=ZENITH\ Incorporated
LABEL com.example.release-date="2015-02-12"
LABEL com.example.version.is-production=""
</code></pre>

<p>An image can have more than one label. Prior to Docker 1.10, it was recommended
to combine all labels into a single <code class="highlighter-rouge">LABEL</code> instruction, to prevent extra layers
from being created. This is no longer necessary, but combining labels is still
supported.</p>

<pre><code class="language-Dockerfile"># Set multiple labels on one line
LABEL com.example.version="0.0.1-beta" com.example.release-date="2015-02-12"
</code></pre>

<p>The above can also be written as:</p>

<pre><code class="language-Dockerfile"># Set multiple labels at once, using line-continuation characters to break long lines
LABEL vendor=ACME\ Incorporated \
      com.example.is-beta= \
      com.example.is-production="" \
      com.example.version="0.0.1-beta" \
      com.example.release-date="2015-02-12"
</code></pre>

<p>See <a href="https://docs.docker.com/config/labels-custom-metadata/">Understanding object labels</a>
for guidelines about acceptable label keys and values. For information about
querying labels, refer to the items related to filtering in <a href="https://docs.docker.com/config/labels-custom-metadata/#managing-labels-on-objects">Managing labels on
objects</a>. See also
<a href="https://docs.docker.com/engine/reference/builder/#label">LABEL</a> in the Dockerfile reference.</p>

<h3 id="run">RUN</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#run">Dockerfile reference for the RUN instruction</a></p>

<p>Split long or complex <code class="highlighter-rouge">RUN</code> statements on multiple lines separated with
backslashes to make your <code class="highlighter-rouge">Dockerfile</code> more readable, understandable, and
maintainable.</p>

<h4 id="apt-get">apt-get</h4>

<p>Probably the most common use-case for <code class="highlighter-rouge">RUN</code> is an application of <code class="highlighter-rouge">apt-get</code>.
Because it installs packages, the <code class="highlighter-rouge">RUN apt-get</code> command has several gotchas to
look out for.</p>

<p>Avoid <code class="highlighter-rouge">RUN apt-get upgrade</code> and <code class="highlighter-rouge">dist-upgrade</code>, as many of the “essential”
packages from the parent images cannot upgrade inside an
<a href="https://docs.docker.com/engine/reference/run/#security-configuration">unprivileged container</a>. If a package
contained in the parent image is out-of-date, contact its maintainers. If you
know there is a particular package, <code class="highlighter-rouge">foo</code>, that needs to be updated, use
<code class="highlighter-rouge">apt-get install -y foo</code> to update automatically.</p>

<p>Always combine <code class="highlighter-rouge">RUN apt-get update</code> with <code class="highlighter-rouge">apt-get install</code> in the same <code class="highlighter-rouge">RUN</code>
statement. For example:</p>

<pre><code class="language-Dockerfile">RUN apt-get update &amp;&amp; apt-get install -y \
    package-bar \
    package-baz \
    package-foo
</code></pre>

<p>Using <code class="highlighter-rouge">apt-get update</code> alone in a <code class="highlighter-rouge">RUN</code> statement causes caching issues and
subsequent <code class="highlighter-rouge">apt-get install</code> instructions fail. For example, say you have a
Dockerfile:</p>

<pre><code class="language-Dockerfile">FROM ubuntu:18.04
RUN apt-get update
RUN apt-get install -y curl
</code></pre>

<p>After building the image, all layers are in the Docker cache. Suppose you later
modify <code class="highlighter-rouge">apt-get install</code> by adding extra package:</p>

<pre><code class="language-Dockerfile">FROM ubuntu:18.04
RUN apt-get update
RUN apt-get install -y curl nginx
</code></pre>

<p>Docker sees the initial and modified instructions as identical and reuses the
cache from previous steps. As a result the <code class="highlighter-rouge">apt-get update</code> is <em>not</em> executed
because the build uses the cached version. Because the <code class="highlighter-rouge">apt-get update</code> is not
run, your build can potentially get an outdated version of the <code class="highlighter-rouge">curl</code> and
<code class="highlighter-rouge">nginx</code> packages.</p>

<p>Using <code class="highlighter-rouge">RUN apt-get update &amp;&amp; apt-get install -y</code> ensures your Dockerfile
installs the latest package versions with no further coding or manual
intervention. This technique is known as “cache busting”. You can also achieve
cache-busting by specifying a package version. This is known as version pinning,
for example:</p>

<pre><code class="language-Dockerfile">RUN apt-get update &amp;&amp; apt-get install -y \
    package-bar \
    package-baz \
    package-foo=1.3.*
</code></pre>

<p>Version pinning forces the build to retrieve a particular version regardless of
what’s in the cache. This technique can also reduce failures due to unanticipated changes
in required packages.</p>

<p>Below is a well-formed <code class="highlighter-rouge">RUN</code> instruction that demonstrates all the <code class="highlighter-rouge">apt-get</code>
recommendations.</p>

<pre><code class="language-Dockerfile">RUN apt-get update &amp;&amp; apt-get install -y \
    aufs-tools \
    automake \
    build-essential \
    curl \
    dpkg-sig \
    libcap-dev \
    libsqlite3-dev \
    mercurial \
    reprepro \
    ruby1.9.1 \
    ruby1.9.1-dev \
    s3cmd=1.1.* \
 &amp;&amp; rm -rf /var/lib/apt/lists/*
</code></pre>

<p>The <code class="highlighter-rouge">s3cmd</code> argument specifies a version <code class="highlighter-rouge">1.1.*</code>. If the image previously
used an older version, specifying the new one causes a cache bust of <code class="highlighter-rouge">apt-get
update</code> and ensures the installation of the new version. Listing packages on
each line can also prevent mistakes in package duplication.</p>

<p>In addition, when you clean up the apt cache by removing <code class="highlighter-rouge">/var/lib/apt/lists</code> it
reduces the image size, since the apt cache is not stored in a layer. Since the
<code class="highlighter-rouge">RUN</code> statement starts with <code class="highlighter-rouge">apt-get update</code>, the package cache is always
refreshed prior to <code class="highlighter-rouge">apt-get install</code>.</p>

<blockquote>
  <p>Official Debian and Ubuntu images <a href="https://github.com/moby/moby/blob/03e2923e42446dbb830c654d0eec323a0b4ef02a/contrib/mkimage/debootstrap#L82-L105">automatically run <code class="highlighter-rouge">apt-get clean</code></a>,
so explicit invocation is not required.</p>
</blockquote>

<h4 id="using-pipes">Using pipes</h4>

<p>Some <code class="highlighter-rouge">RUN</code> commands depend on the ability to pipe the output of one command into another, using the pipe character (<code class="highlighter-rouge">|</code>), as in the following example:</p>

<pre><code class="language-Dockerfile">RUN wget -O - https://some.site | wc -l &gt; /number
</code></pre>

<p>Docker executes these commands using the <code class="highlighter-rouge">/bin/sh -c</code> interpreter, which only
evaluates the exit code of the last operation in the pipe to determine success.
In the example above this build step succeeds and produces a new image so long
as the <code class="highlighter-rouge">wc -l</code> command succeeds, even if the <code class="highlighter-rouge">wget</code> command fails.</p>

<p>If you want the command to fail due to an error at any stage in the pipe,
prepend <code class="highlighter-rouge">set -o pipefail &amp;&amp;</code> to ensure that an unexpected error prevents the
build from inadvertently succeeding. For example:</p>

<pre><code class="language-Dockerfile">RUN set -o pipefail &amp;&amp; wget -O - https://some.site | wc -l &gt; /number
</code></pre>
<blockquote>
  <p>Not all shells support the <code class="highlighter-rouge">-o pipefail</code> option.</p>

  <p>In cases such as the <code class="highlighter-rouge">dash</code> shell on
Debian-based images, consider using the <em>exec</em> form of <code class="highlighter-rouge">RUN</code> to explicitly
choose a shell that does support the <code class="highlighter-rouge">pipefail</code> option. For example:</p>

  <pre><code class="language-Dockerfile">RUN ["/bin/bash", "-c", "set -o pipefail &amp;&amp; wget -O - https://some.site | wc -l &gt; /number"]
</code></pre>
</blockquote>

<h3 id="cmd">CMD</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#cmd">Dockerfile reference for the CMD instruction</a></p>

<p>The <code class="highlighter-rouge">CMD</code> instruction should be used to run the software contained by your
image, along with any arguments. <code class="highlighter-rouge">CMD</code> should almost always be used in the form
of <code class="highlighter-rouge">CMD ["executable", "param1", "param2"…]</code>. Thus, if the image is for a
service, such as Apache and Rails, you would run something like <code class="highlighter-rouge">CMD
["apache2","-DFOREGROUND"]</code>. Indeed, this form of the instruction is recommended
for any service-based image.</p>

<p>In most other cases, <code class="highlighter-rouge">CMD</code> should be given an interactive shell, such as bash,
python and perl. For example, <code class="highlighter-rouge">CMD ["perl", "-de0"]</code>, <code class="highlighter-rouge">CMD ["python"]</code>, or <code class="highlighter-rouge">CMD
["php", "-a"]</code>. Using this form means that when you execute something like
<code class="highlighter-rouge">docker run -it python</code>, you’ll get dropped into a usable shell, ready to go.
<code class="highlighter-rouge">CMD</code> should rarely be used in the manner of <code class="highlighter-rouge">CMD ["param", "param"]</code> in
conjunction with <a href="https://docs.docker.com/engine/reference/builder/#entrypoint"><code class="highlighter-rouge">ENTRYPOINT</code></a>, unless
you and your expected users are already quite familiar with how <code class="highlighter-rouge">ENTRYPOINT</code>
works.</p>

<h3 id="expose">EXPOSE</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#expose">Dockerfile reference for the EXPOSE instruction</a></p>

<p>The <code class="highlighter-rouge">EXPOSE</code> instruction indicates the ports on which a container listens
for connections. Consequently, you should use the common, traditional port for
your application. For example, an image containing the Apache web server would
use <code class="highlighter-rouge">EXPOSE 80</code>, while an image containing MongoDB would use <code class="highlighter-rouge">EXPOSE 27017</code> and
so on.</p>

<p>For external access, your users can execute <code class="highlighter-rouge">docker run</code> with a flag indicating
how to map the specified port to the port of their choice.
For container linking, Docker provides environment variables for the path from
the recipient container back to the source (ie, <code class="highlighter-rouge">MYSQL_PORT_3306_TCP</code>).</p>

<h3 id="env">ENV</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#env">Dockerfile reference for the ENV instruction</a></p>

<p>To make new software easier to run, you can use <code class="highlighter-rouge">ENV</code> to update the
<code class="highlighter-rouge">PATH</code> environment variable for the software your container installs. For
example, <code class="highlighter-rouge">ENV PATH /usr/local/nginx/bin:$PATH</code> ensures that <code class="highlighter-rouge">CMD ["nginx"]</code>
just works.</p>

<p>The <code class="highlighter-rouge">ENV</code> instruction is also useful for providing required environment
variables specific to services you wish to containerize, such as Postgres’s
<code class="highlighter-rouge">PGDATA</code>.</p>

<p>Lastly, <code class="highlighter-rouge">ENV</code> can also be used to set commonly used version numbers so that
version bumps are easier to maintain, as seen in the following example:</p>

<pre><code class="language-Dockerfile">ENV PG_MAJOR 9.3
ENV PG_VERSION 9.3.4
RUN curl -SL http://example.com/postgres-$PG_VERSION.tar.xz | tar -xJC /usr/src/postgress &amp;&amp; …
ENV PATH /usr/local/postgres-$PG_MAJOR/bin:$PATH
</code></pre>

<p>Similar to having constant variables in a program (as opposed to hard-coding
values), this approach lets you change a single <code class="highlighter-rouge">ENV</code> instruction to
auto-magically bump the version of the software in your container.</p>

<p>Each <code class="highlighter-rouge">ENV</code> line creates a new intermediate layer, just like <code class="highlighter-rouge">RUN</code> commands. This
means that even if you unset the environment variable in a future layer, it
still persists in this layer and its value can be dumped. You can test this by
creating a Dockerfile like the following, and then building it.</p>

<pre><code class="language-Dockerfile">FROM alpine
ENV ADMIN_USER="mark"
RUN echo $ADMIN_USER &gt; ./mark
RUN unset ADMIN_USER
</code></pre>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--rm</span> <span class="nb">test </span>sh <span class="nt">-c</span> <span class="s1">'echo $ADMIN_USER'</span>

mark
</code></pre></div></div>

<p>To prevent this, and really unset the environment variable, use a <code class="highlighter-rouge">RUN</code> command
with shell commands, to set, use, and unset the variable all in a single layer.
You can separate your commands with <code class="highlighter-rouge">;</code> or <code class="highlighter-rouge">&amp;&amp;</code>. If you use the second method,
and one of the commands fails, the <code class="highlighter-rouge">docker build</code> also fails. This is usually a
good idea. Using <code class="highlighter-rouge">\</code> as a line continuation character for Linux Dockerfiles
improves readability. You could also put all of the commands into a shell script
and have the <code class="highlighter-rouge">RUN</code> command just run that shell script.</p>

<pre><code class="language-Dockerfile">FROM alpine
RUN export ADMIN_USER="mark" \
    &amp;&amp; echo $ADMIN_USER &gt; ./mark \
    &amp;&amp; unset ADMIN_USER
CMD sh
</code></pre>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--rm</span> <span class="nb">test </span>sh <span class="nt">-c</span> <span class="s1">'echo $ADMIN_USER'</span>

</code></pre></div></div>

<h3 id="add-or-copy">ADD or COPY</h3>

<ul>
  <li><a href="https://docs.docker.com/engine/reference/builder/#add">Dockerfile reference for the ADD instruction</a></li>
  <li><a href="https://docs.docker.com/engine/reference/builder/#copy">Dockerfile reference for the COPY instruction</a></li>
</ul>

<p>Although <code class="highlighter-rouge">ADD</code> and <code class="highlighter-rouge">COPY</code> are functionally similar, generally speaking, <code class="highlighter-rouge">COPY</code>
is preferred. That’s because it’s more transparent than <code class="highlighter-rouge">ADD</code>. <code class="highlighter-rouge">COPY</code> only
supports the basic copying of local files into the container, while <code class="highlighter-rouge">ADD</code> has
some features (like local-only tar extraction and remote URL support) that are
not immediately obvious. Consequently, the best use for <code class="highlighter-rouge">ADD</code> is local tar file
auto-extraction into the image, as in <code class="highlighter-rouge">ADD rootfs.tar.xz /</code>.</p>

<p>If you have multiple <code class="highlighter-rouge">Dockerfile</code> steps that use different files from your
context, <code class="highlighter-rouge">COPY</code> them individually, rather than all at once. This ensures that
each step’s build cache is only invalidated (forcing the step to be re-run) if
the specifically required files change.</p>

<p>For example:</p>

<pre><code class="language-Dockerfile">COPY requirements.txt /tmp/
RUN pip install --requirement /tmp/requirements.txt
COPY . /tmp/
</code></pre>

<p>Results in fewer cache invalidations for the <code class="highlighter-rouge">RUN</code> step, than if you put the
<code class="highlighter-rouge">COPY . /tmp/</code> before it.</p>

<p>Because image size matters, using <code class="highlighter-rouge">ADD</code> to fetch packages from remote URLs is
strongly discouraged; you should use <code class="highlighter-rouge">curl</code> or <code class="highlighter-rouge">wget</code> instead. That way you can
delete the files you no longer need after they’ve been extracted and you don’t
have to add another layer in your image. For example, you should avoid doing
things like:</p>

<pre><code class="language-Dockerfile">ADD http://example.com/big.tar.xz /usr/src/things/
RUN tar -xJf /usr/src/things/big.tar.xz -C /usr/src/things
RUN make -C /usr/src/things all
</code></pre>

<p>And instead, do something like:</p>

<pre><code class="language-Dockerfile">RUN mkdir -p /usr/src/things \
    &amp;&amp; curl -SL http://example.com/big.tar.xz \
    | tar -xJC /usr/src/things \
    &amp;&amp; make -C /usr/src/things all
</code></pre>

<p>For other items (files, directories) that do not require <code class="highlighter-rouge">ADD</code>’s tar
auto-extraction capability, you should always use <code class="highlighter-rouge">COPY</code>.</p>

<h3 id="entrypoint">ENTRYPOINT</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#entrypoint">Dockerfile reference for the ENTRYPOINT instruction</a></p>

<p>The best use for <code class="highlighter-rouge">ENTRYPOINT</code> is to set the image’s main command, allowing that
image to be run as though it was that command (and then use <code class="highlighter-rouge">CMD</code> as the
default flags).</p>

<p>Let’s start with an example of an image for the command line tool <code class="highlighter-rouge">s3cmd</code>:</p>

<pre><code class="language-Dockerfile">ENTRYPOINT ["s3cmd"]
CMD ["--help"]
</code></pre>

<p>Now the image can be run like this to show the command’s help:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run s3cmd
</code></pre></div></div>

<p>Or using the right parameters to execute a command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run s3cmd <span class="nb">ls </span>s3://mybucket
</code></pre></div></div>

<p>This is useful because the image name can double as a reference to the binary as
shown in the command above.</p>

<p>The <code class="highlighter-rouge">ENTRYPOINT</code> instruction can also be used in combination with a helper
script, allowing it to function in a similar way to the command above, even
when starting the tool may require more than one step.</p>

<p>For example, the <a href="https://hub.docker.com/_/postgres/">Postgres Official Image</a>
uses the following script as its <code class="highlighter-rouge">ENTRYPOINT</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-e</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s1">'postgres'</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>chown <span class="nt">-R</span> postgres <span class="s2">"</span><span class="nv">$PGDATA</span><span class="s2">"</span>

    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="k">$(</span><span class="nb">ls</span> <span class="nt">-A</span> <span class="s2">"</span><span class="nv">$PGDATA</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>gosu postgres initdb
    <span class="k">fi

    </span><span class="nb">exec </span>gosu postgres <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="k">fi

</span><span class="nb">exec</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>

<blockquote>
  <p>Configure app as PID 1</p>

  <p>This script uses <a href="http://wiki.bash-hackers.org/commands/builtin/exec">the <code class="highlighter-rouge">exec</code> Bash command</a>
so that the final running application becomes the container’s PID 1. This
allows the application to receive any Unix signals sent to the container.
For more, see the <a href="https://docs.docker.com/engine/reference/builder/#entrypoint"><code class="highlighter-rouge">ENTRYPOINT</code> reference</a>.</p>
</blockquote>

<p>The helper script is copied into the container and run via <code class="highlighter-rouge">ENTRYPOINT</code> on
container start:</p>

<pre><code class="language-Dockerfile">COPY ./docker-entrypoint.sh /
ENTRYPOINT ["/docker-entrypoint.sh"]
CMD ["postgres"]
</code></pre>

<p>This script allows the user to interact with Postgres in several ways.</p>

<p>It can simply start Postgres:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run postgres
</code></pre></div></div>

<p>Or, it can be used to run Postgres and pass parameters to the server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run postgres postgres <span class="nt">--help</span>
</code></pre></div></div>

<p>Lastly, it could also be used to start a totally different tool, such as Bash:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--rm</span> <span class="nt">-it</span> postgres bash
</code></pre></div></div>

<h3 id="volume">VOLUME</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#volume">Dockerfile reference for the VOLUME instruction</a></p>

<p>The <code class="highlighter-rouge">VOLUME</code> instruction should be used to expose any database storage area,
configuration storage, or files/folders created by your docker container. You
are strongly encouraged to use <code class="highlighter-rouge">VOLUME</code> for any mutable and/or user-serviceable
parts of your image.</p>

<h3 id="user">USER</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#user">Dockerfile reference for the USER instruction</a></p>

<p>If a service can run without privileges, use <code class="highlighter-rouge">USER</code> to change to a non-root
user. Start by creating the user and group in the <code class="highlighter-rouge">Dockerfile</code> with something
like <code class="highlighter-rouge">RUN groupadd -r postgres &amp;&amp; useradd --no-log-init -r -g postgres postgres</code>.</p>

<blockquote>
  <p>Consider an explicit UID/GID</p>

  <p>Users and groups in an image are assigned a non-deterministic UID/GID in that
the “next” UID/GID is assigned regardless of image rebuilds. So, if it’s
critical, you should assign an explicit UID/GID.</p>
</blockquote>

<blockquote>
  <p>Due to an <a href="https://github.com/golang/go/issues/13548">unresolved bug</a> in the
Go archive/tar package’s handling of sparse files, attempting to create a user
with a significantly large UID inside a Docker container can lead to disk
exhaustion because <code class="highlighter-rouge">/var/log/faillog</code> in the container layer is filled with
NULL (\0) characters. A workaround is to pass the <code class="highlighter-rouge">--no-log-init</code> flag to
useradd. The Debian/Ubuntu <code class="highlighter-rouge">adduser</code> wrapper does not support this flag.</p>
</blockquote>

<p>Avoid installing or using <code class="highlighter-rouge">sudo</code> as it has unpredictable TTY and
signal-forwarding behavior that can cause problems. If you absolutely need
functionality similar to <code class="highlighter-rouge">sudo</code>, such as initializing the daemon as <code class="highlighter-rouge">root</code> but
running it as non-<code class="highlighter-rouge">root</code>), consider using <a href="https://github.com/tianon/gosu">“gosu”</a>.</p>

<p>Lastly, to reduce layers and complexity, avoid switching <code class="highlighter-rouge">USER</code> back and forth
frequently.</p>

<h3 id="workdir">WORKDIR</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#workdir">Dockerfile reference for the WORKDIR instruction</a></p>

<p>For clarity and reliability, you should always use absolute paths for your
<code class="highlighter-rouge">WORKDIR</code>. Also, you should use <code class="highlighter-rouge">WORKDIR</code> instead of  proliferating instructions
like <code class="highlighter-rouge">RUN cd … &amp;&amp; do-something</code>, which are hard to read, troubleshoot, and
maintain.</p>

<h3 id="onbuild">ONBUILD</h3>

<p><a href="https://docs.docker.com/engine/reference/builder/#onbuild">Dockerfile reference for the ONBUILD instruction</a></p>

<p>An <code class="highlighter-rouge">ONBUILD</code> command executes after the current <code class="highlighter-rouge">Dockerfile</code> build completes.
<code class="highlighter-rouge">ONBUILD</code> executes in any child image derived <code class="highlighter-rouge">FROM</code> the current image.  Think
of the <code class="highlighter-rouge">ONBUILD</code> command as an instruction the parent <code class="highlighter-rouge">Dockerfile</code> gives
to the child <code class="highlighter-rouge">Dockerfile</code>.</p>

<p>A Docker build executes <code class="highlighter-rouge">ONBUILD</code> commands before any command in a child
<code class="highlighter-rouge">Dockerfile</code>.</p>

<p><code class="highlighter-rouge">ONBUILD</code> is useful for images that are going to be built <code class="highlighter-rouge">FROM</code> a given
image. For example, you would use <code class="highlighter-rouge">ONBUILD</code> for a language stack image that
builds arbitrary user software written in that language within the
<code class="highlighter-rouge">Dockerfile</code>, as you can see in <a href="https://github.com/docker-library/ruby/blob/master/2.4/jessie/onbuild/Dockerfile">Ruby’s <code class="highlighter-rouge">ONBUILD</code> variants</a>.</p>

<p>Images built from <code class="highlighter-rouge">ONBUILD</code> should get a separate tag, for example:
<code class="highlighter-rouge">ruby:1.9-onbuild</code> or <code class="highlighter-rouge">ruby:2.0-onbuild</code>.</p>

<p>Be careful when putting <code class="highlighter-rouge">ADD</code> or <code class="highlighter-rouge">COPY</code> in <code class="highlighter-rouge">ONBUILD</code>. The “onbuild” image
fails catastrophically if the new build’s context is missing the resource being
added. Adding a separate tag, as recommended above, helps mitigate this by
allowing the <code class="highlighter-rouge">Dockerfile</code> author to make a choice.</p>

<h2 id="examples-for-official-images">Examples for Official Images</h2>

<p>These Official Images have exemplary <code class="highlighter-rouge">Dockerfile</code>s:</p>

<ul>
  <li><a href="https://hub.docker.com/_/golang/">Go</a></li>
  <li><a href="https://hub.docker.com/_/perl/">Perl</a></li>
  <li><a href="https://hub.docker.com/_/hylang/">Hy</a></li>
  <li><a href="https://hub.docker.com/_/ruby/">Ruby</a></li>
</ul>

<h2 id="additional-resources">Additional resources:</h2>

<ul>
  <li><a href="https://docs.docker.com/engine/reference/builder/">Dockerfile Reference</a></li>
  <li><a href="https://docs.docker.com/develop/develop-images/baseimages/">More about Base Images</a></li>
  <li><a href="https://docs.docker.com/docker-hub/builds/">More about Automated Builds</a></li>
  <li><a href="https://docs.docker.com/docker-hub/official_images/">Guidelines for Creating Official Images</a></li>
</ul>


							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://docs.docker.com/glossary/?term=parent%20image">parent image</a>, <a href="https://docs.docker.com/glossary/?term=images">images</a>, <a href="https://docs.docker.com/glossary/?term=dockerfile">dockerfile</a>, <a href="https://docs.docker.com/glossary/?term=best%20practices">best practices</a>, <a href="https://docs.docker.com/glossary/?term=hub">hub</a>, <a href="https://docs.docker.com/glossary/?term=official%20image">official image</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/develop/develop-images/dockerfile_best-practices/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color: rgb(185, 194, 204); text-align: center; margin-top: 150px; visibility: visible;">
								<div id="pd_rating_holder_8453675" style="display: inline-block;"><div class="rating-msg" id="PDRTJS_8453675_msg" style="text-align: center; font:normal normal 12px/20px verdana; color: #333333;">Rate this page:</div><p style="padding: 0px; margin: 0px; clear: both;"></p><div class="rating-icons" id="pd_rate_8453675" style="float:left;"><div class="rating-nero-icon" onmouseout="PDRTJS_8453675.rebuild();" onclick="PDRTJS_8453675.rate(1);" onmouseover="PDRTJS_8453675.hover(1);" id="PDRTJS_8453675_nero_1" style="background-size: 32px 32px !important; cursor: pointer; width: 16px; height: 16px;  line-height: 16px; background: url(https://polldaddy.com/images/ratings/nero-hand-sml.png) bottom left; float: left; padding: 0px; margin: 0px; margin: 0px;">&nbsp;</div><div class="rating-nero-value" id="PDRTJS_8453675_msg_1" style="text-align: center; font:normal normal 12px/20px verdana; color: #333333; float:left; padding: 0px 4px;">278</div><div class="rating-nero-icon" onmouseout="PDRTJS_8453675.rebuild();" onclick="PDRTJS_8453675.rate(2);" onmouseover="PDRTJS_8453675.hover(2);" id="PDRTJS_8453675_nero_2" style="background-size: 32px 32px !important; cursor: pointer; width: 16px; height: 16px;  line-height: 16px; background: url(https://polldaddy.com/images/ratings/nero-hand-sml.png) bottom right; float: left; padding: 0px; margin: 0px; margin: 0px;">&nbsp;</div><div class="rating-nero-value" id="PDRTJS_8453675_msg_2" style="text-align: center; font:normal normal 12px/20px verdana; color: #333333; float:left; padding: 0px 4px;">29</div></div><span style="float:left;">&nbsp;</span><div id="rating_info_8453675" style="display:none;float:left;background:url(https://polldaddy.com/images/ratings/info.png) no-repeat 3px 2px;width:16px;height:16px;cursor:pointer; null " onclick="javascript:PDRTJS_8453675.togglePopup();return false;"><span style="display:none;">i</span></div><div class="pd_popup_holder" id="pd_popup_holder_8453675">&nbsp;</div></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "develop/develop-images/dockerfile_best-practices.md",
										"title": "Best practices for writing Dockerfiles",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/develop/develop-images/dockerfile_best-practices.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav"><li><a onclick="navClicked(1)" data-target="#item1" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Get Docker<span class="caret arrow"></span></a><ul class="nav collapse" id="#item1" aria-expanded="false"><li><a href="https://docs.docker.com/install/overview/">Overview of Docker editions</a></li><li><a onclick="navClicked(3)" data-target="#item3" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Docker CE<span class="caret arrow"></span></a><ul class="nav collapse" id="#item3" aria-expanded="false"><li><a href="https://docs.docker.com/install/">About Docker CE</a></li><li><a onclick="navClicked(5)" data-target="#item5" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Cloud<span class="caret arrow"></span></a><ul class="nav collapse" id="#item5" aria-expanded="false"><li><a onclick="navClicked(6)" data-target="#item6" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Docker for AWS<span class="caret arrow"></span></a><ul class="nav collapse" id="#item6" aria-expanded="false"><li><a href="https://docs.docker.com/docker-for-aws/why/">Why Docker for AWS?</a></li><li><a href="https://docs.docker.com/docker-for-aws/">Setup &amp; prerequisites</a></li><li><a href="https://docs.docker.com/docker-for-aws/iam-permissions/">IAM permissions</a></li><li><a href="https://docs.docker.com/docker-for-aws/scaling/">Scaling</a></li><li><a href="https://docs.docker.com/docker-for-aws/upgrade/">Upgrading</a></li><li><a href="https://docs.docker.com/docker-for-aws/deploy/">Deploy your app</a></li><li><a href="https://docs.docker.com/docker-for-aws/persistent-data-volumes/">Persistent data volumes</a></li><li><a href="https://docs.docker.com/docker-for-aws/load-balancer/">Load balancer</a></li><li><a href="https://docs.docker.com/docker-for-aws/faqs/">FAQs</a></li><li><a href="https://docs.docker.com/docker-for-aws/opensource/">Open source licensing</a></li><li><a href="https://docs.docker.com/docker-for-aws/release-notes/">Release notes</a></li><li><a href="https://docs.docker.com/docker-for-aws/archive/">Template archive</a></li></ul></li><li><a onclick="navClicked(19)" data-target="#item19" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Docker for Azure<span class="caret arrow"></span></a><ul class="nav collapse" id="#item19" aria-expanded="false"><li><a href="https://docs.docker.com/docker-for-azure/why/">Why Docker for Azure?</a></li><li><a href="https://docs.docker.com/docker-for-azure/">Setup &amp; prerequisites</a></li><li><a href="https://docs.docker.com/docker-for-azure/upgrade/">Upgrading</a></li><li><a href="https://docs.docker.com/docker-for-azure/deploy/">Deploy your app</a></li><li><a href="https://docs.docker.com/docker-for-azure/persistent-data-volumes/">Persistent data volumes</a></li><li><a href="https://docs.docker.com/docker-for-azure/faqs/">FAQs</a></li><li><a href="https://docs.docker.com/docker-for-azure/opensource/">Open source licensing</a></li><li><a href="https://docs.docker.com/docker-for-azure/release-notes/">Release notes</a></li><li><a href="https://docs.docker.com/docker-for-azure/archive/">Template archive</a></li></ul></li></ul></li><li><a onclick="navClicked(29)" data-target="#item29" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Linux<span class="caret arrow"></span></a><ul class="nav collapse" id="#item29" aria-expanded="false"><li><a href="https://docs.docker.com/install/linux/docker-ce/centos/">CentOS</a></li><li><a href="https://docs.docker.com/install/linux/docker-ce/debian/">Debian</a></li><li><a href="https://docs.docker.com/install/linux/docker-ce/fedora/">Fedora</a></li><li><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">Ubuntu</a></li><li><a href="https://docs.docker.com/install/linux/docker-ce/binaries/">Binaries</a></li><li><a href="https://docs.docker.com/install/linux/linux-postinstall/">Optional Linux post-installation steps</a></li></ul></li><li><a href="https://docs.docker.com/docker-for-mac/install/">MacOS</a></li><li><a href="https://docs.docker.com/docker-for-windows/install/">Microsoft Windows</a></li><li><a onclick="navClicked(38)" data-target="#item38" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Docker Toolbox (legacy)<span class="caret arrow"></span></a><ul class="nav collapse" id="#item38" aria-expanded="false"><li><a href="https://docs.docker.com/toolbox/overview/">Toolbox overview</a></li><li><a href="https://docs.docker.com/toolbox/toolbox_install_mac/">Install Toolbox on Mac</a></li><li><a href="https://docs.docker.com/toolbox/toolbox_install_windows/">Install Toolbox on Windows</a></li><li><a onclick="navClicked(42)" data-target="#item42" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Kitematic<span class="caret arrow"></span></a><ul class="nav collapse" id="#item42" aria-expanded="false"><li><a href="https://docs.docker.com/kitematic/userguide/">Kitematic user guide: intro &amp; overview</a></li><li><a href="https://docs.docker.com/kitematic/nginx-web-server/">Set up an Nginx web server</a></li><li><a href="https://docs.docker.com/kitematic/minecraft-server/">Set up a Minecraft Server</a></li><li><a href="https://docs.docker.com/kitematic/rethinkdb-dev-database/">Creating a local RethinkDB database for development</a></li><li><a href="https://docs.docker.com/kitematic/faq/">Frequently asked questions</a></li><li><a href="https://docs.docker.com/kitematic/known-issues/">Known issues</a></li></ul></li><li><a href="https://docs.docker.com/toolbox/faqs/troubleshoot/">Troubleshooting</a></li></ul></li><li><a href="https://docs.docker.com/engine/release-notes/">Release notes</a></li></ul></li><li><a onclick="navClicked(51)" data-target="#item51" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Docker EE<span class="caret arrow"></span></a><ul class="nav collapse" id="#item51" aria-expanded="false"><li><a href="https://docs.docker.com/ee/supported-platforms/">About Docker EE</a></li><li><a onclick="navClicked(53)" data-target="#item53" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Linux<span class="caret arrow"></span></a><ul class="nav collapse" id="#item53" aria-expanded="false"><li><a href="https://docs.docker.com/install/linux/docker-ee/centos/">CentOS</a></li><li><a href="https://docs.docker.com/install/linux/docker-ee/oracle/">Oracle Linux</a></li><li><a href="https://docs.docker.com/install/linux/docker-ee/rhel/">RHEL</a></li><li><a href="https://docs.docker.com/install/linux/docker-ee/suse/">SLES</a></li><li><a href="https://docs.docker.com/install/linux/docker-ee/ubuntu/">Ubuntu</a></li></ul></li><li><a href="https://docs.docker.com/install/windows/docker-ee/">Microsoft Windows Server</a></li><li><a href="https://docs.docker.com/engine/release-notes/">Release notes</a></li></ul></li><li><a onclick="navClicked(61)" data-target="#item61" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Compatibility between Docker versions<span class="caret arrow"></span></a><ul class="nav collapse" id="#item61" aria-expanded="false"><li><a href="https://docs.docker.com/engine/ce-ee-node-activate/">CE-EE Node Activate</a></li><li><a href="https://docs.docker.com/engine/migration/">Migrate to Docker 1.10</a></li><li><a href="https://docs.docker.com/engine/breaking_changes/">Breaking changes</a></li><li><a href="https://docs.docker.com/engine/deprecated/">Deprecated Docker features</a></li><li><a href="https://docs.docker.com/engine/faq/">FAQ</a></li></ul></li></ul></li><li><a onclick="navClicked(67)" data-target="#item67" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Get started<span class="caret arrow"></span></a><ul class="nav collapse" id="#item67" aria-expanded="false"><li><a onclick="navClicked(68)" data-target="#item68" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Get started with Docker<span class="caret arrow"></span></a><ul class="nav collapse" id="#item68" aria-expanded="false"><li><a href="https://docs.docker.com/get-started/">Part 1: Orientation</a></li><li><a href="https://docs.docker.com/get-started/part2/">Part 2: Containers</a></li><li><a href="https://docs.docker.com/get-started/part3/">Part 3: Services</a></li><li><a href="https://docs.docker.com/get-started/part4/">Part 4: Swarms</a></li><li><a href="https://docs.docker.com/get-started/part5/">Part 5: Stacks</a></li><li><a href="https://docs.docker.com/get-started/part6/">Part 6: Deploy your app</a></li></ul></li><li><a href="https://docs.docker.com/engine/docker-overview/">Docker overview</a></li></ul></li><li><a onclick="navClicked(76)" data-target="#item76" data-toggle="collapse" data-parent="#stacked-menu" aria-expanded="true">Develop with Docker<span class="caret arrow"></span></a><ul class="nav collapse in" id="#item76" aria-expanded="true"><li><a onclick="navClicked(77)" data-target="#item77" data-toggle="collapse" data-parent="#stacked-menu" aria-expanded="true">Develop your apps on Docker<span class="caret arrow"></span></a><ul class="nav collapse in" id="#item77" aria-expanded="true"><li><a href="https://docs.docker.com/develop/">App development overview</a></li><li><a href="https://docs.docker.com/develop/dev-best-practices/">App development best practices</a></li><li><a onclick="navClicked(80)" data-target="#item80" data-toggle="collapse" data-parent="#stacked-menu" aria-expanded="true">Develop images<span class="caret arrow"></span></a><ul class="nav collapse in" id="#item80" aria-expanded="true"><li><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/" class="active currentPage">Best practices for writing Dockerfiles</a></li><li><a href="https://docs.docker.com/develop/develop-images/baseimages/">Create a base image</a></li><li><a href="https://docs.docker.com/develop/develop-images/build_enhancements/">Docker build enhancements for 18.09</a></li><li><a href="https://docs.docker.com/develop/develop-images/multistage-build/">Use multi-stage builds</a></li><li><a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a></li><li><a href="https://docs.docker.com/develop/develop-images/image_management/">Manage images</a></li></ul></li><li><a href="https://docs.docker.com/samples/">Docker app examples</a></li></ul></li><li><a onclick="navClicked(88)" data-target="#item88" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Develop using the Docker Engine SDKs and API<span class="caret arrow"></span></a><ul class="nav collapse" id="#item88" aria-expanded="false"><li><a href="https://docs.docker.com/develop/sdk/">Overview</a></li><li><a href="https://docs.docker.com/develop/sdk/examples/">SDK and API examples</a></li></ul></li></ul></li><li><a onclick="navClicked(91)" data-target="#item91" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Configure networking<span class="caret arrow"></span></a><ul class="nav collapse" id="#item91" aria-expanded="false"><li><a href="https://docs.docker.com/network/">Networking overview</a></li><li><a href="https://docs.docker.com/network/bridge/">Use bridge networks</a></li><li><a href="https://docs.docker.com/network/overlay/">Use overlay networks</a></li><li><a href="https://docs.docker.com/network/host/">Use host networking</a></li><li><a href="https://docs.docker.com/network/macvlan/">Use Macvlan networks</a></li><li><a href="https://docs.docker.com/network/none/">Disable networking for a container</a></li><li><a onclick="navClicked(98)" data-target="#item98" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Networking tutorials<span class="caret arrow"></span></a><ul class="nav collapse" id="#item98" aria-expanded="false"><li><a href="https://docs.docker.com/network/network-tutorial-standalone/">Bridge network tutorial</a></li><li><a href="https://docs.docker.com/network/network-tutorial-host/">Host networking tutorial</a></li><li><a href="https://docs.docker.com/network/network-tutorial-overlay/">Overlay networking tutorial</a></li><li><a href="https://docs.docker.com/network/network-tutorial-macvlan/">Macvlan network tutorial</a></li></ul></li><li><a onclick="navClicked(103)" data-target="#item103" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Configure the daemon and containers<span class="caret arrow"></span></a><ul class="nav collapse" id="#item103" aria-expanded="false"><li><a href="https://docs.docker.com/config/daemon/ipv6/">Configure the daemon for IPv6</a></li><li><a href="https://docs.docker.com/network/iptables/">Docker and iptables</a></li><li><a href="https://docs.docker.com/config/containers/container-networking/">Container networking</a></li><li><a href="https://docs.docker.com/network/proxy/">Configure Docker to use a proxy server</a></li></ul></li><li><a onclick="navClicked(108)" data-target="#item108" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Legacy networking content<span class="caret arrow"></span></a><ul class="nav collapse" id="#item108" aria-expanded="false"><li><a href="https://docs.docker.com/network/links/">(Legacy) Container links</a></li><li><a href="https://docs.docker.com/network/overlay-standalone.swarm/">Overlay networks for Swarm Classic</a></li></ul></li></ul></li><li><a onclick="navClicked(111)" data-target="#item111" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Manage application data<span class="caret arrow"></span></a><ul class="nav collapse" id="#item111" aria-expanded="false"><li><a href="https://docs.docker.com/storage/">Storage overview</a></li><li><a href="https://docs.docker.com/storage/volumes/">Volumes</a></li><li><a href="https://docs.docker.com/storage/bind-mounts/">Bind mounts</a></li><li><a href="https://docs.docker.com/storage/tmpfs/">tmpfs mounts</a></li><li><a href="https://docs.docker.com/storage/troubleshooting_volume_errors/">Troubleshoot volume problems</a></li><li><a onclick="navClicked(117)" data-target="#item117" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Store data within containers<span class="caret arrow"></span></a><ul class="nav collapse" id="#item117" aria-expanded="false"><li><a href="https://docs.docker.com/storage/storagedriver/">About storage drivers</a></li><li><a href="https://docs.docker.com/storage/storagedriver/select-storage-driver/">Select a storage driver</a></li><li><a href="https://docs.docker.com/storage/storagedriver/aufs-driver/">Use the AUFS storage driver</a></li><li><a href="https://docs.docker.com/storage/storagedriver/btrfs-driver/">Use the Btrfs storage driver</a></li><li><a href="https://docs.docker.com/storage/storagedriver/device-mapper-driver/">Use the Device mapper storage driver</a></li><li><a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/">Use the OverlayFS storage driver</a></li><li><a href="https://docs.docker.com/storage/storagedriver/zfs-driver/">Use the ZFS storage driver</a></li><li><a href="https://docs.docker.com/storage/storagedriver/vfs-driver/">Use the VFS storage driver</a></li></ul></li></ul></li><li><a onclick="navClicked(126)" data-target="#item126" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Run your app in production<span class="caret arrow"></span></a><ul class="nav collapse" id="#item126" aria-expanded="false"><li><a onclick="navClicked(127)" data-target="#item127" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Configure all objects<span class="caret arrow"></span></a><ul class="nav collapse" id="#item127" aria-expanded="false"><li><a href="https://docs.docker.com/config/labels-custom-metadata/">Apply custom metadata to objects</a></li><li><a href="https://docs.docker.com/config/pruning/">Prune unused objects</a></li><li><a href="https://docs.docker.com/config/formatting/">Format command and log output</a></li></ul></li><li><a onclick="navClicked(131)" data-target="#item131" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Configure the daemon<span class="caret arrow"></span></a><ul class="nav collapse" id="#item131" aria-expanded="false"><li><a href="https://docs.docker.com/config/daemon/">Configure and run Docker</a></li><li><a href="https://docs.docker.com/config/daemon/systemd/">Control Docker with systemd</a></li><li><a href="https://docs.docker.com/config/labels-custom-metadata/">Apply custom metadata to daemons</a></li><li><a href="https://docs.docker.com/config/containers/logging/configure/">Configuring default drivers</a></li></ul></li><li><a onclick="navClicked(136)" data-target="#item136" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Work with external tools<span class="caret arrow"></span></a><ul class="nav collapse" id="#item136" aria-expanded="false"><li><a href="https://docs.docker.com/config/thirdparty/">Third-party monitoring tools</a></li><li><a href="https://docs.docker.com/config/thirdparty/prometheus/">Collect Docker metrics with Prometheus</a></li></ul></li><li><a onclick="navClicked(139)" data-target="#item139" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Configure containers<span class="caret arrow"></span></a><ul class="nav collapse" id="#item139" aria-expanded="false"><li><a href="https://docs.docker.com/config/containers/start-containers-automatically/">Start containers automatically</a></li><li><a href="https://docs.docker.com/config/containers/live-restore/">Keep containers alive during daemon downtime</a></li><li><a href="https://docs.docker.com/config/containers/multi-service_container/">Run multiple services in a container</a></li><li><a href="https://docs.docker.com/config/containers/runmetrics/">Container runtime metrics</a></li><li><a href="https://docs.docker.com/config/containers/resource_constraints/">Limit a container's resources</a></li><li><a href="https://docs.docker.com/config/labels-custom-metadata/">Apply custom metadata to containers</a></li><li><a href="https://docs.docker.com/config/pruning/">Prune unused containers</a></li><li><a onclick="navClicked(147)" data-target="#item147" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Logging<span class="caret arrow"></span></a><ul class="nav collapse" id="#item147" aria-expanded="false"><li><a href="https://docs.docker.com/config/containers/logging/">View a container's logs</a></li><li><a href="https://docs.docker.com/config/containers/logging/configure/">Configure logging drivers</a></li><li><a href="https://docs.docker.com/config/containers/logging/plugins/">Use a logging driver plugin</a></li><li><a href="https://docs.docker.com/config/containers/logging/log_tags/">Customize log driver output</a></li><li><a onclick="navClicked(152)" data-target="#item152" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Logging driver details<span class="caret arrow"></span></a><ul class="nav collapse" id="#item152" aria-expanded="false"><li><a href="https://docs.docker.com/config/containers/logging/logentries/">Logentries logging driver</a></li><li><a href="https://docs.docker.com/config/containers/logging/json-file/">JSON File logging driver</a></li><li><a href="https://docs.docker.com/config/containers/logging/gelf/">Graylog Extended Format (GELF) logging driver</a></li><li><a href="https://docs.docker.com/config/containers/logging/syslog/">Syslog logging driver</a></li><li><a href="https://docs.docker.com/config/containers/logging/awslogs/">Amazon CloudWatch logs logging driver</a></li><li><a href="https://docs.docker.com/config/containers/logging/etwlogs/">ETW logging driver</a></li><li><a href="https://docs.docker.com/config/containers/logging/fluentd/">Fluentd logging driver</a></li><li><a href="https://docs.docker.com/config/containers/logging/gcplogs/">Google Cloud logging driver</a></li><li><a href="https://docs.docker.com/config/containers/logging/journald/">Journald logging driver</a></li><li><a href="https://docs.docker.com/config/containers/logging/splunk/">Splunk logging driver</a></li></ul></li></ul></li><li><a href="https://docs.docker.com/registry/recipes/mirror/">Run a local registry mirror</a></li><li><a onclick="navClicked(164)" data-target="#item164" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Work with external tools<span class="caret arrow"></span></a><ul class="nav collapse" id="#item164" aria-expanded="false"><li><a href="https://docs.docker.com/config/thirdparty/dsc/">PowerShell DSC usage</a></li><li><a href="https://docs.docker.com/config/thirdparty/ansible/">Ansible</a></li><li><a href="https://docs.docker.com/config/thirdparty/chef/">Chef</a></li><li><a href="https://docs.docker.com/config/thirdparty/puppet/">Puppet</a></li><li><a href="https://docs.docker.com/config/thirdparty/ambassador_pattern_linking/">(Obsolete) Link via an ambassador container</a></li></ul></li><li><a onclick="navClicked(170)" data-target="#item170" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Security<span class="caret arrow"></span></a><ul class="nav collapse" id="#item170" aria-expanded="false"><li><a href="https://docs.docker.com/engine/security/security/">Docker security</a></li><li><a href="https://docs.docker.com/engine/security/non-events/">Docker security non-events</a></li><li><a href="https://docs.docker.com/engine/security/https/">Protect the Docker daemon socket</a></li><li><a href="https://docs.docker.com/engine/security/certificates/">Using certificates for repository client verification</a></li><li><a onclick="navClicked(175)" data-target="#item175" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Use trusted images<span class="caret arrow"></span></a><ul class="nav collapse" id="#item175" aria-expanded="false"><li><a href="https://docs.docker.com/engine/security/trust/content_trust/">Content trust in Docker</a></li><li><a href="https://docs.docker.com/engine/security/trust/trust_automation/">Automation with content trust</a></li><li><a href="https://docs.docker.com/engine/security/trust/trust_delegation/">Delegations for content trust</a></li><li><a href="https://docs.docker.com/engine/security/trust/deploying_notary/">Deploying Notary</a></li><li><a href="https://docs.docker.com/engine/security/trust/trust_key_mng/">Manage keys for content trust</a></li><li><a href="https://docs.docker.com/engine/security/trust/trust_sandbox/">Play in a content trust sandbox</a></li></ul></li><li><a href="https://docs.docker.com/engine/security/antivirus/">Antivirus software and Docker</a></li><li><a href="https://docs.docker.com/engine/security/apparmor/">AppArmor security profiles for Docker</a></li><li><a href="https://docs.docker.com/engine/security/seccomp/">Seccomp security profiles for Docker</a></li><li><a href="https://docs.docker.com/engine/security/userns-remap/">Isolate containers with a user namespace</a></li></ul></li><li><a onclick="navClicked(186)" data-target="#item186" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Scale your app<span class="caret arrow"></span></a><ul class="nav collapse" id="#item186" aria-expanded="false"><li><a href="https://docs.docker.com/engine/swarm/">Swarm mode overview</a></li><li><a href="https://docs.docker.com/engine/swarm/key-concepts/">Swarm mode key concepts</a></li><li><a onclick="navClicked(189)" data-target="#item189" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Get started with swarm mode<span class="caret arrow"></span></a><ul class="nav collapse" id="#item189" aria-expanded="false"><li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/">Set up for the tutorial</a></li><li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/create-swarm/">Create a swarm</a></li><li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/add-nodes/">Add nodes to the swarm</a></li><li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/deploy-service/">Deploy a service</a></li><li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/inspect-service/">Inspect the service</a></li><li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/scale-service/">Scale the service</a></li><li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/delete-service/">Delete the service</a></li><li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/rolling-update/">Apply rolling updates</a></li><li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/drain-node/">Drain a node</a></li><li><a href="https://docs.docker.com/engine/swarm/ingress/">Use swarm mode routing mesh</a></li></ul></li><li><a onclick="navClicked(200)" data-target="#item200" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">How swarm mode works<span class="caret arrow"></span></a><ul class="nav collapse" id="#item200" aria-expanded="false"><li><a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/nodes/">How nodes work</a></li><li><a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/">How services work</a></li><li><a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/pki/">Manage swarm security with PKI</a></li><li><a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/swarm-task-states/">Swarm task states</a></li></ul></li><li><a href="https://docs.docker.com/engine/swarm/swarm-mode/">Run Docker in swarm mode</a></li><li><a href="https://docs.docker.com/engine/swarm/join-nodes/">Join nodes to a swarm</a></li><li><a href="https://docs.docker.com/engine/swarm/manage-nodes/">Manage nodes in a swarm</a></li><li><a href="https://docs.docker.com/engine/swarm/services/">Deploy services to a swarm</a></li><li><a href="https://docs.docker.com/engine/swarm/configs/">Store service configuration data</a></li><li><a href="https://docs.docker.com/engine/swarm/secrets/">Manage sensitive data with Docker secrets</a></li><li><a href="https://docs.docker.com/engine/swarm/swarm_manager_locking/">Lock your swarm</a></li><li><a href="https://docs.docker.com/engine/swarm/networking/">Manage swarm service networks</a></li><li><a href="https://docs.docker.com/engine/swarm/admin_guide/">Swarm administration guide</a></li><li><a href="https://docs.docker.com/engine/swarm/raft/">Raft consensus in swarm mode</a></li></ul></li><li><a onclick="navClicked(215)" data-target="#item215" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Extend Docker<span class="caret arrow"></span></a><ul class="nav collapse" id="#item215" aria-expanded="false"><li><a href="https://docs.docker.com/engine/extend/">Managed plugin system</a></li><li><a href="https://docs.docker.com/engine/extend/plugins_authorization/">Access authorization plugin</a></li><li><a href="https://docs.docker.com/engine/extend/legacy_plugins/">Extending Docker with plugins</a></li><li><a href="https://docs.docker.com/engine/extend/plugins_network/">Docker network driver plugins</a></li><li><a href="https://docs.docker.com/engine/extend/plugins_volume/">Volume plugins</a></li><li><a href="https://docs.docker.com/engine/extend/config/">Plugin configuration</a></li><li><a href="https://docs.docker.com/engine/extend/plugin_api/">Plugins API</a></li></ul></li></ul></li></ul></li><li><a onclick="navClicked(223)" data-target="#item223" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Standards and compliance<span class="caret arrow"></span></a><ul class="nav collapse" id="#item223" aria-expanded="false"><li><a href="https://docs.docker.com/compliance/">Docker standards and compliance</a></li><li><a onclick="navClicked(225)" data-target="#item225" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">NIST<span class="caret arrow"></span></a><ul class="nav collapse" id="#item225" aria-expanded="false"><li><a href="https://docs.docker.com/compliance/nist/800_37/">NIST SP 800-37 (RMF)</a></li><li><a href="https://docs.docker.com/compliance/nist/800_53/">NIST SP 800-53</a></li><li><a href="https://docs.docker.com/compliance/nist/800_190/">NIST SP 800-190</a></li><li><a href="https://docs.docker.com/compliance/nist/fips140_2/">FIPS 140-2</a></li><li><a href="https://docs.docker.com/compliance/nist/nistir_8176/">NISTIR 8176</a></li><li><a href="https://docs.docker.com/compliance/nist/itl_october2017/">NIST ITL Bulletin October 2017</a></li></ul></li><li><a onclick="navClicked(232)" data-target="#item232" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">CIS Benchmarks<span class="caret arrow"></span></a><ul class="nav collapse" id="#item232" aria-expanded="false"><li><a href="https://docs.docker.com/compliance/cis/docker_ee/">Docker EE Benchmark</a></li><li><a href="https://docs.docker.com/compliance/cis/docker_ce/">Docker CE Benchmark</a></li><li><a href="https://docs.docker.com/compliance/cis/k8s/">Kubernetes Benchmark</a></li></ul></li><li><a href="https://docs.docker.com/compliance/fedramp/">FedRAMP</a></li><li><a href="https://docs.docker.com/compliance/fisma/">FISMA</a></li></ul></li><li><a onclick="navClicked(238)" data-target="#item238" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Open source at Docker<span class="caret arrow"></span></a><ul class="nav collapse" id="#item238" aria-expanded="false"><li><a href="https://docs.docker.com/opensource/">Contribute to documentation</a></li><li><a href="https://docs.docker.com/opensource/ways/">Other ways to contribute</a></li></ul></li><li><a onclick="navClicked(241)" data-target="#item241" data-toggle="collapse" data-parent="#stacked-menu" class="collapsed" aria-expanded="false">Documentation archive<span class="caret arrow"></span></a><ul class="nav collapse" id="#item241" aria-expanded="false"><li><a href="https://docs.docker.com/docsarchive/">View the docs archives</a></li><li><a href="https://docs.docker.com/hackathon/">Docs hackathon results</a></li></ul></li></ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: visible;"><a href="https://github.com/docker/docker.github.io/edit/master/develop/develop-images/dockerfile_best-practices.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this page</a></li>
										<li><a href="https://github.com/docker/docker.github.io/issues/new?body=File:%20[develop/develop-images/dockerfile_best-practices.md](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> Request docs changes</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> Get support</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">On this page:</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="#general-guidelines-and-recommendations" class="nomunge">General guidelines and recommendations</a>
    <ul>
      <li><a href="#create-ephemeral-containers" class="nomunge">Create ephemeral containers</a></li>
      <li><a href="#understand-build-context" class="nomunge">Understand build context</a></li>
      <li><a href="#pipe-dockerfile-through-stdin" class="nomunge">Pipe Dockerfile through stdin</a></li>
      <li><a href="#exclude-with-dockerignore" class="nomunge">Exclude with .dockerignore</a></li>
      <li><a href="#use-multi-stage-builds" class="nomunge">Use multi-stage builds</a></li>
      <li><a href="#dont-install-unnecessary-packages" class="nomunge">Don’t install unnecessary packages</a></li>
      <li><a href="#decouple-applications" class="nomunge">Decouple applications</a></li>
      <li><a href="#minimize-the-number-of-layers" class="nomunge">Minimize the number of layers</a></li>
      <li><a href="#sort-multi-line-arguments" class="nomunge">Sort multi-line arguments</a></li>
      <li><a href="#leverage-build-cache" class="nomunge">Leverage build cache</a></li>
    </ul>
  </li>
  <li><a href="#dockerfile-instructions" class="nomunge">Dockerfile instructions</a>
    <ul>
      <li><a href="#from" class="nomunge">FROM</a></li>
      <li><a href="#label" class="nomunge">LABEL</a></li>
      <li><a href="#run" class="nomunge">RUN</a></li>
      <li><a href="#cmd" class="nomunge">CMD</a></li>
      <li><a href="#expose" class="nomunge">EXPOSE</a></li>
      <li><a href="#env" class="nomunge">ENV</a></li>
      <li><a href="#add-or-copy" class="nomunge">ADD or COPY</a></li>
      <li><a href="#entrypoint" class="nomunge">ENTRYPOINT</a></li>
      <li><a href="#volume" class="nomunge">VOLUME</a></li>
      <li><a href="#user" class="nomunge">USER</a></li>
      <li><a href="#workdir" class="nomunge">WORKDIR</a></li>
      <li><a href="#onbuild" class="nomunge">ONBUILD</a></li>
    </ul>
  </li>
  <li><a href="#examples-for-official-images" class="nomunge">Examples for Official Images</a></li>
  <li><a href="#additional-resources" class="nomunge">Additional resources:</a></li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://docs.docker.com/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com/" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com/" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright © 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-google-plus"><a href="https://plus.google.com/u/0/communities/108146856671494713993">Google</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker/docker">Github</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/github.css">
	
	<!-- <script src="/js/anchorlinks.js"></script> -->
	<script defer="defer" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/menu.js"></script>
	<script src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/jquery.js"></script>
	<script src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/bootstrap.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/develop/develop-images/dockerfile_best-practices/';
	</script>
	<script src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/archive.js"></script>
	<script src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/stickyfill.js"></script>
	<script defer="defer" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/metadata.js"></script>
	<script src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/glossary.js"></script>
	<script src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/collections_tocs.js"></script>
	<script defer="defer" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/docs.js"></script>
	<script defer="defer" src="Best%20practices%20for%20writing%20Dockerfiles%20|%20Docker%20Documentation_files/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>



</body></html>