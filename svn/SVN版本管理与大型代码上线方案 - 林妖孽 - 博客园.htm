<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="never" />
    <meta property="og:description" content="第1章 SVN服务实战应用指南 1.1 SVN介绍 1.1.1 什么是SVN（Subversion）？ Svn（subversion）是近年来崛起的非常优秀的版本管理工具，与CVS管理工具一样，SVN" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>SVN版本管理与大型代码上线方案 - 林妖孽 - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="//common.cnblogs.com/favicon.ico?v=20200522" type="image/x-icon" />
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=OkWhT11pACV4T_PiDJL8x9WKPwjvEyWNCWQ475DeMM0" />
    <link id="MainCss" rel="stylesheet" href="/skins/banlieue13/bundle-banlieue13.min.css?v=1J0RP_opHZcWv1yy974pRZewfj9S0p6tTP1QNRnmMiI" />
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/banlieue13/bundle-banlieue13-mobile.min.css?v=ZGsubc7hDckVvdVtOTUuw71XbiY97OUg3ubujVFengI" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/linyaonie/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/linyaonie/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/linyaonie/wlwmanifest.xml" />
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=vV4imX1ebLq2xPxSzhr9B0eW28ml5Xc7CSXMptQoB78"></script>
    <script>
        var currentBlogId = 469064;
        var currentBlogApp = 'linyaonie';
        var cb_enable_mathjax = false;
        var isLogined = false;
        var skinName = 'Banlieue13';
    </script>
    
    
    
</head>
<body>
    <a name="top"></a>
    
    
<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a href="https://www.cnblogs.com/linyaonie/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/linyaonie/">林妖孽</a>
</h1>
<h2>
若不是生活所迫，谁愿意把自己弄的一身才华。
</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="navigator">
			
<ul id="navList">
	<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
	<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/linyaonie/">
首页</a>
</li>
	<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
	<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/%E6%9E%97%E5%A6%96%E5%AD%BD">
联系</a></li>
	<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
	<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/linyaonie/rss/">
订阅</a>
	
<a id="blog_nav_rss_image" href="https://www.cnblogs.com/linyaonie/rss/">
    <img src="/skins/banlieue13/images/xml.gif" alt="订阅" />
</a></li>
</ul>



			<div class="blogStats">
				
				<!--done-->
随笔- 
61&nbsp;
文章- 
0&nbsp;
评论- 
5&nbsp;



				
			</div><!--end: blogStats -->
		</div><!--end: navigator 博客导航栏 -->
		<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class = "postTitle">
			
<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/linyaonie/p/11238272.html">SVN版本管理与大型代码上线方案</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			
<div id="cnblogs_post_body" class="blogpost-body ">
    <h1 id="第1章-svn服务实战应用指南" data-anchor-id="6n80">第1章 SVN服务实战应用指南</h1>
<div class="md-section-divider">&nbsp;</div>
<h2 id="11-svn介绍" data-anchor-id="h3l2">1.1 SVN介绍</h2>
<div class="md-section-divider">&nbsp;</div>
<h3 id="111-什么是svnsubversion" data-anchor-id="33ua">1.1.1 什么是SVN（Subversion）？</h3>
<blockquote class="white-blockquote" data-anchor-id="o6fi">
<ul>
<li>Svn（subversion）是近年来崛起的非常优秀的版本管理工具，与CVS管理工具一样，SVN是一个跨平台的开源的版本控制系统。Svn版本管理工具管理着随时间改变的各种数据。这些数据放置在一个中央资料档案库（repository）中，这个档案库很像一个普通的文件服务器或者FTP服务器，但是，与其他服务器不同的是，SVN会备份并记录每个文件每一次的修改更新变动。这样我们就可以把任意一个时间点的档案恢复到想要的某一个旧的版本，当然也可以直接浏览指定文件的更新历史记录。</li>
<li>为什么会有svn这样一个项目？</li>
<li>官方解释：为了接管CVS的用户基础，确切的说，我们写了一个新的版本控制系统，它和CVS很相似，但是它修正了以前CVS所没有解决的许多问题。问题见SVN官方首页。</li>
<li>SVN是一个非常通用的软件系统，它常被用来管理程序源码，但是它也可以管理任何类型的文件，如文本，视频，图片等等。</li>
</ul>
</blockquote>
<p data-anchor-id="sgtr">SVN相关站点：</p>
<blockquote class="white-blockquote" data-anchor-id="sfd0">
<p>Subversion官网：<span class="Apple-converted-space">&nbsp;<br /><a href="http://subversion.tigris.org/" target="_blank">http://subversion.tigris.org/</a><span class="Apple-converted-space">&nbsp;<br /><a href="http://subversion.apache.org/" target="_blank">http://subversion.apache.org/</a><span class="Apple-converted-space">&nbsp;<br />svn客户端：<a href="http://toroisesvn.net/" target="_blank">http://toroisesvn.net/</a><span class="Apple-converted-space">&nbsp;<br />svn中文网站：<a href="http://www.iusesvn.com/" target="_blank">http://www.iusesvn.com/</a><span class="Apple-converted-space">&nbsp;<br />中文常见问题解答FAQ：<a href="http://subversion.apache.org/faq.zh.html" target="_blank">http://subversion.apache.org/faq.zh.html</a><span class="Apple-converted-space">&nbsp;<br />官方手册：<a href="http://svnbook.red-bean.com/" target="_blank">http://svnbook.red-bean.com/</a><span class="Apple-converted-space">&nbsp;中英都有</span></span></span></span></span></span></span></p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="12-svn与git的区别" data-anchor-id="olk4">1.2 svn与git的区别</h2>
<div class="md-section-divider">&nbsp;</div>
<h3 id="121-svn集中式版本控制系统" data-anchor-id="yf0j">1.2.1 svn集中式版本控制系统</h3>
<blockquote class="white-blockquote" data-anchor-id="gb05">
<p>svn版本控制系统是集中式的数据管理，存在一个中央版本库，所有开发人员本地开发所使用的代码都是来自于这个版本库，提交代码也都必须提交到这个中央版本库。</p>

</blockquote>
<p data-anchor-id="wm9j">svn版本控制系统工作流程如下：</p>
<blockquote class="white-blockquote" data-anchor-id="jpxb"><ol>
<li>
<p>在中央库上创建或从主干复制一个分支</p>

</li>
<li>
<p>从中央库check out 下这个分支的代码</p>

</li>
<li>
<p>增加自己的代码文件，修改现存的代码或删除代码文件</p>

</li>
<li>
<p>commit(提交)代码，假设有人在刚刚的分支上提交了代码，你就会被提示代码过期，你得先up你的代码后再提交。up代码的时候如果出现冲突，需要解决好冲突后再进行提交。</p>

</li>

</ol></blockquote>
<p data-anchor-id="70b1">缺点</p>
<blockquote class="white-blockquote" data-anchor-id="zpzu">
<p>当无法连接到中央版本库的环境下，你无法提交代码，将代码加入版本控制；<span class="Apple-converted-space">&nbsp;<br />你无法查看代码的历史版本以及版本的变化过程。提交到版本控制系统中的代码我们都默认通过自测可运行的，如果某个模块的代码比较复杂，不能短时间内实现为可测试的功能，那么你需要等很长的时间才能提交自己的代码，由于代码库集中管理，因此，需要对中央版本库的存储做备份。这点分布式的版本控制系统要好一些。Svn的备份要备份所有代码数据以及所有更改的版本记录。</span></p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="122-git分布式的版本控制" data-anchor-id="u9qw">1.2.2 git分布式的版本控制</h3>
<blockquote class="white-blockquote" data-anchor-id="30hi">
<ul>
<li>git是由Linus开发的，所以很自然的git和Linux文件系统结合的比较紧密，以至于在windows上你必须使用cygwin才能使其完美的工作。</li>
<li>那git凭啥叫做分布式的版本控制系统呢？还是从其工作模式讲起把。</li>
<li>git中没有了中央版本库的说法了，但是为了开发小组的代码共享，我们通常还是会搭建一个远程的git仓库。</li>
<li>但是和svn不同的是，开发者本地也包含了一个完整的git仓库，从某种程度上说本地的仓库和远程的仓库在身份上是等价的，没有主从之分。</li>
<li>
<p>如果你的项目是闭源项目，或者你习惯于以往的集中式的管理模式的话，那么在git下你也可以像svn那样的工作，只是流程中可能会增加一些步骤。</p>
<ol>
<li>
<p>你本地创建一个git库，并将其add到远程git库中。</p>

</li>
<li>
<p>你在本地添加或者删除文件，然后commit，当然commit操作都是提交到本地的git库中了。（嗯，其实是提交到git目录下的objects目录中去了）</p>

</li>
<li>
<p>将本地git库的分支push到远程git库的分支，如果这个时候远程git库中已经有别人push过，那么远程git库将不允许你push，这时候你需要先pull，然后如果有冲突，处理好冲突，commit到本地git库后，再push到远程git库。</p>

</li>

</ol></li>

</ul>
<p>从上面的描述我们可以看到，我们每个开发人员的本地都会有一个git库，我们可以随时进行commit而不需要联网，可以随时查看历史版本，当某一个功能点开发完了之后我们可以将commit后的内容push到远程git库了，如果远程git库的版本在你上次clone或者pull之后变化了，那么你需要进行pull并处理冲突，提交之后，再push到远程git库。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="13-企业应用场景" data-anchor-id="35pw">1.3 企业应用场景</h2>
<blockquote class="white-blockquote" data-anchor-id="yl3v">
<p>svn仍是当前企业的主流。git正在发展，也许未来也会成为主流，但现在还不是。如果有精力，能同时掌握更好。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="14-运维人员掌握版本管理" data-anchor-id="2uzp">1.4 运维人员掌握版本管理</h2>
<div class="md-section-divider">&nbsp;</div>
<h3 id="对于版本管理系统运维人员需要掌握的技术点" data-anchor-id="oien">对于版本管理系统，运维人员需要掌握的技术点</h3>
<blockquote class="white-blockquote" data-anchor-id="xjxh"><ol>
<li>
<p>安装，部署，维护，排障。</p>

</li>
<li>
<p>简单使用，很多公司都是由开发来管理，包括建立新仓库和添加删除账号</p>

</li>
<li>
<p>对于版本控制系统，运维人员相当于开发商，开发人员是业主，运维搭建的系统为开发人员服务的。</p>

</li>

</ol></blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="15-svn服务运行模式与访问方式" data-anchor-id="w2tp">1.5 SVN服务运行模式与访问方式</h2>
<div class="md-section-divider">&nbsp;</div>
<h3 id="151-svn服务端运行方式" data-anchor-id="iiq2">1.5.1 SVN服务端运行方式</h3>
<p data-anchor-id="ldoi">svn服务常见的运行访问方式有3种：</p>
<p data-anchor-id="kum5">（1）独立服务器访问<span class="Apple-converted-space">&nbsp;<br />访问地址如：svn：//svn.yunjisuan.org/sadoc;</span></p>
<p data-anchor-id="zvhn">（2）借助apache等http服务<span class="Apple-converted-space">&nbsp;<br />访问地址如：<a href="http://svn.yunjisuan.com/sadoc" target="_blank">http://svn.yunjisuan.com/sadoc</a>;</span></p>
<p data-anchor-id="v8pr">a,单独安装apache+svn（不要用）<span class="Apple-converted-space">&nbsp;<br />b,CSVN（apache+svn）是一个单独的整合的软件，带web界面管理的SVN软件</span></p>
<p data-anchor-id="ckoh">（3）本地直接访问（例如：file://application/svndata/sadoc）</p>
<p data-anchor-id="sugx"><img title="" src="http://static.zybuluo.com/WBQ729/m18s9357yi0lktr4qltubwdn/image_1cri3b2ur6rv17vp1mkd1q855k1p.png" alt="image_1cri3b2ur6rv17vp1mkd1q855k1p.png-101.4kB" /></p>
<blockquote class="white-blockquote" data-anchor-id="uuft">
<p>在这里，主要介绍第一种方式以及第二种方式中的CSVN web管理方式</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="152-svn客户端访问方式" data-anchor-id="hgqo">1.5.2 SVN客户端访问方式</h3>
<blockquote class="white-blockquote" data-anchor-id="zira">
<p>SVN客户端可以通过多种方式访问服务器端，例如：本地磁盘访问，或各种各样不同的网络协议访问，但一个版本库地址永远都是一个URL，URL反映了访问方法。</p>

</blockquote>
<p data-anchor-id="39ei"><img title="" src="http://static.zybuluo.com/WBQ729/z56pbh46khz4n10h4irn2pc5/image_1cri3cjpfrju1361php1ih07s346.png" alt="image_1cri3cjpfrju1361php1ih07s346.png-28.3kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="16-svn档案库数据格式" data-anchor-id="cstj">1.6 SVN档案库数据格式</h2>
<blockquote class="white-blockquote" data-anchor-id="dirp">
<p>svn存储版本数据有2种方式：BDB（一种事务安全型表类型）和FSFS（一种不需要数据库的存储系统）。因为BDB方式在服务器中断时，有可能锁住数据，所以还是FSFS方式更安全一点。</p>

</blockquote>
<ul data-anchor-id="7wzs">
<li>
<p>BDB：</p>
<blockquote class="white-blockquote">
<p>伯克利DB（Berkeley DB），版本库可以使用的一种经过充分测试的后台数据库实现，不能在通过网络共享的文件系统上使用，伯克利DB是Subversion 1.2版本以前的缺省版本库格式</p>

</blockquote>

</li>
<li>
<p>FSFS：</p>
<blockquote class="white-blockquote">
<p>一个专用于Subversion版本库的文件系统后端，可以使用网络文件系统（例如 NFS 或 SMBFS）。是1.2版本及其后的缺省版本库格式。</p>

</blockquote>

</li>

</ul>
<div class="md-section-divider">&nbsp;</div>
<h3 id="171-svn-集中式版本管理系统" data-anchor-id="d0ic">1.7.1 SVN 集中式版本管理系统</h3>
<blockquote class="white-blockquote" data-anchor-id="fdvw">
<p>Svn是一种集中式文件版本管理系统。集中式管理的工作流程如下图：</p>

</blockquote>
<p data-anchor-id="4i73"><img title="" src="http://static.zybuluo.com/linyaonie/3394enzuazs6oeqx9c7euy3h/image_1d9jcv77ijkdul91q5lbvs9p.png" alt="image_1d9jcv77ijkdul91q5lbvs9p.png-299.5kB" /></p>
<blockquote class="white-blockquote" data-anchor-id="ska3">
<p>集中式代码管理的核心是SVN服务器，所有开发者在开始新一天的工作之前必须从服务器获取代码，然后进行开发，最后解决冲突，提交。所有的版本信息都放在SVN服务器上。因此如果脱离了服务器，开发者就无法进行提交代码工作。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="172-开发者利用svn版本管理系统工作过程" data-anchor-id="ly9c">1.7.2 开发者利用SVN版本管理系统工作过程</h3>
<p data-anchor-id="e857">下面举例说明：</p>
<p data-anchor-id="xhl0">开始新一天的工作：</p>
<blockquote class="white-blockquote" data-anchor-id="0zm3"><ol>
<li>
<p>首先从SVN服务器下载项目组最新代码。</p>

</li>
<li>
<p>进入自己的分支，进行开发工作，每隔一小时向服务器上自己的分支提交一次代码（很多程序员都有这个习惯。因为有时候自己对代码改来改去，最后又想还原到新一个小时的版本，或者看看前一个小时自己修改了哪些代码，就需要这样做了）。</p>

</li>
<li>
<p>下班时间快到了，把自己的分支合并到服务器主分支上，一天的工作完成，并反映给服务器。</p>

</li>

</ol></blockquote>
<p data-anchor-id="zms3">优点：</p>
<blockquote class="white-blockquote" data-anchor-id="itu3"><ol>
<li>
<p>管理方便，逻辑清晰明确，符合一般人思维习惯。</p>

</li>
<li>
<p>易于管理，集中式svn服务器更能保证数据安全性。</p>

</li>
<li>
<p>代码一致性非常高。</p>

</li>
<li>
<p>适合开发人数不多的项目开发。</p>

</li>
<li>
<p>普及度高，大部分软件配置管理的大学教材都是使用svn和vss。</p>

</li>

</ol></blockquote>
<div class="md-section-divider">&nbsp;</div>
<h1 id="第2章-搭建svn服务端" data-anchor-id="e3z9">第2章 搭建SVN服务端</h1>
<div class="md-section-divider">&nbsp;</div>
<h2 id="21-安装配置svn服务" data-anchor-id="gmi2">2.1 安装配置SVN服务</h2>
<div class="md-section-divider">&nbsp;</div>
<h2 id="检查环境" data-anchor-id="wvju">检查环境</h2>
<blockquote class="white-blockquote" data-anchor-id="x8mt">
<p>cat /etc/redhat-release</p>
<p>uname -r</p>

</blockquote>
<p data-anchor-id="0c3c"><img title="" src="http://static.zybuluo.com/linyaonie/lgap2lpb7hkjs4p8n7wxxfo2/image_1ct2ro5j856817hr98h1fml13h59.png" alt="image_1ct2ro5j856817hr98h1fml13h59.png-16.8kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="光盘yum安装svn" data-anchor-id="folv">光盘yum安装svn</h2>
<blockquote class="white-blockquote" data-anchor-id="giog">
<p>yum -y install subversion</p>
<p>rpm -qa subversion</p>

</blockquote>
<p data-anchor-id="b92j"><img title="" src="http://static.zybuluo.com/linyaonie/aso5dbpfo5k13nry2ujscszd/image_1ct2rqqa6sfkvt10g7vp1l0rm.png" alt="image_1ct2rqqa6sfkvt10g7vp1l0rm.png-33kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h1 id="建立svn版本库数据存储根目录svndata及用户密码权限目录svnpasswd" data-anchor-id="8cmb">建立svn版本库数据存储根目录（svndata）及用户，密码权限目录（svnpasswd）</h1>
<blockquote class="white-blockquote" data-anchor-id="6yy9">
<p>mkdir -p /application/svndata ---&gt;数据存储根目录</p>
<p>mkdir -p /application/svnpasswd ---&gt;用户，密码权限目录</p>

</blockquote>
<p data-anchor-id="dagd"><img title="" src="http://static.zybuluo.com/linyaonie/f5cch7x9emsvkemnm8sa1tp5/image_1ct2rs3ip1ie810q4v988dr1gm813.png" alt="image_1ct2rs3ip1ie810q4v988dr1gm813.png-28.6kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="22-建立项目版本库" data-anchor-id="arh6">2.2 建立项目版本库</h2>
<blockquote class="white-blockquote" data-anchor-id="8niz">
<p>创建一个新的Subversion项目yunjisuan，其实，类似yunjisuan这样的项目可以创建多个，每个项目对应不同的代码，这里只是以创建一个项目为例演示：</p>
<p>svnadmin create /application/svndata/yunjisuan</p>
<p>tree /application/svndata/yunjisuan/ ---&gt;没有tree则需要yum安装</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="str">/application/<span class="pln">svndata<span class="pun">/<span class="pln">yunjisuan<span class="pun">/</span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">|--<span class="pln"> README<span class="pun">.<span class="pln">txt</span></span></span></span></code></li>
<li class="L2"><code><span class="pun">|--<span class="pln"> conf</span></span></code></li>
<li class="L3"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> authz</span></span></span></span></code></li>
<li class="L4"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> passwd</span></span></span></span></code></li>
<li class="L5"><code><span class="pun">|<span class="pln">   <span class="str">`-- svnserve.conf</span></span></span></code></li>
<li class="L6"><code><span class="str">|-- db</span></code></li>
<li class="L7"><code><span class="str">|   |-- current</span></code></li>
<li class="L8"><code><span class="str">|   |-- format</span></code></li>
<li class="L9"><code><span class="str">|   |-- fs-type</span></code></li>
<li class="L0"><code><span class="str">|   |-- fsfs.conf</span></code></li>
<li class="L1"><code><span class="str">|   |-- min-unpacked-rev</span></code></li>
<li class="L2"><code><span class="str">|   |-- rep-cache.db</span></code></li>
<li class="L3"><code><span class="str">|   |-- revprops</span></code></li>
<li class="L4"><code><span class="str">|   |   `<span class="pun">--<span class="pln"> <span class="lit">0</span></span></span></span></code></li>
<li class="L5"><code><span class="pun">|<span class="pln">   <span class="pun">|<span class="pln">       <span class="str">`-- 0</span></span></span></span></span></code></li>
<li class="L6"><code><span class="str">|   |-- revs</span></code></li>
<li class="L7"><code><span class="str">|   |   `<span class="pun">--<span class="pln"> <span class="lit">0</span></span></span></span></code></li>
<li class="L8"><code><span class="pun">|<span class="pln">   <span class="pun">|<span class="pln">       <span class="str">`-- 0</span></span></span></span></span></code></li>
<li class="L9"><code><span class="str">|   |-- transactions</span></code></li>
<li class="L0"><code><span class="str">|   |-- txn-current</span></code></li>
<li class="L1"><code><span class="str">|   |-- txn-current-lock</span></code></li>
<li class="L2"><code><span class="str">|   |-- txn-protorevs</span></code></li>
<li class="L3"><code><span class="str">|   |-- uuid</span></code></li>
<li class="L4"><code><span class="str">|   `<span class="pun">--<span class="pln"> write<span class="pun">-<span class="kwd">lock</span></span></span></span></span></code></li>
<li class="L5"><code><span class="pun">|--<span class="pln"> format</span></span></code></li>
<li class="L6"><code><span class="pun">|--<span class="pln"> hooks</span></span></code></li>
<li class="L7"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> post<span class="pun">-<span class="pln">commit<span class="pun">.<span class="pln">tmpl</span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> post<span class="pun">-<span class="kwd">lock<span class="pun">.<span class="pln">tmpl</span></span></span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> post<span class="pun">-<span class="pln">revprop<span class="pun">-<span class="pln">change<span class="pun">.<span class="pln">tmpl</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> post<span class="pun">-<span class="pln">unlock<span class="pun">.<span class="pln">tmpl</span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> pre<span class="pun">-<span class="pln">commit<span class="pun">.<span class="pln">tmpl</span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> pre<span class="pun">-<span class="kwd">lock<span class="pun">.<span class="pln">tmpl</span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> pre<span class="pun">-<span class="pln">revprop<span class="pun">-<span class="pln">change<span class="pun">.<span class="pln">tmpl</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pun">|<span class="pln">   <span class="pun">|--<span class="pln"> pre<span class="pun">-<span class="pln">unlock<span class="pun">.<span class="pln">tmpl</span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pun">|<span class="pln">   <span class="str">`-- start-commit.tmpl</span></span></span></code></li>
<li class="L6"><code><span class="str">`<span class="pun">--<span class="pln"> locks</span></span></span></code></li>
<li class="L7"><code><span class="pln">    <span class="pun">|--<span class="pln"> db<span class="pun">-<span class="pln">logs<span class="pun">.<span class="kwd">lock</span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pln">    <span class="str">`-- db.lock</span></span></code></li>
<li class="L9"><code><span class="str">10 directories, 28 files</span></code></li>
<li class="L0"><code></code></li>
<li class="L1"><code><span class="str">     目录详解</span></code></li>
<li class="L2"><code></code></li>
<li class="L3"><code><span class="str">conf    ---&gt;配置文件目录</span></code></li>
<li class="L4"><code></code></li>
<li class="L5"><code><span class="str">authz   ---&gt;用户认证</span></code></li>
<li class="L6"><code></code></li>
<li class="L7"><code><span class="str">db      ---&gt;数据目录</span></code></li>
<li class="L8"><code></code></li>
<li class="L9"><code><span class="str">hooks   ---&gt;钩子脚本目录</span></code></li>
<li class="L0"><code></code></li>
<li class="L1"><code><span class="str">locks   ---&gt;代码锁目录</span></code></li>

</ol>
<p data-anchor-id="u5ba"><img title="" src="http://static.zybuluo.com/linyaonie/yckv4j913i166npvf2ni0atl/image_1ct2s1mfvumavfn1iv91f9itg21g.png" alt="image_1ct2s1mfvumavfn1iv91f9itg21g.png-56.1kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="23-编辑svn配置文件" data-anchor-id="4ptp">2.3 编辑svn配置文件</h2>
<blockquote class="white-blockquote" data-anchor-id="693l">
<p>cd /application/svndata/yunjisuan/conf/</p>
<p>ls</p>
<p>cp svnserve.conf{,.bak}</p>
<p>vim svnserve.conf</p>

</blockquote>
<p data-anchor-id="1quf"><img title="" src="http://static.zybuluo.com/linyaonie/2kb58yvgh686trru83so6y6z/image_1ct2svfs1od91bp4um412361q071t.png" alt="image_1ct2svfs1od91bp4um412361q071t.png-18.6kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="修改配置文件的如下信息" data-anchor-id="cay3">修改配置文件的如下信息</h2>
<blockquote class="white-blockquote" data-anchor-id="xofl">
<p>cat -n /application/svndata/yunjisuan/conf/svnserve.conf.bak | sed -n '12p;13p;20p;27p'</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">    <span class="lit">12<span class="pln">  <span class="com"># anon-access = read</span></span></span></span></code></li>
<li class="L1"><code><span class="pln">    <span class="lit">13<span class="pln">  <span class="com"># auth-access = write</span></span></span></span></code></li>
<li class="L2"><code><span class="pln">    <span class="lit">20<span class="pln">  <span class="com"># password-db = passwd</span></span></span></span></code></li>
<li class="L3"><code><span class="pln">    <span class="lit">27<span class="pln">  <span class="com"># authz-db = authz</span></span></span></span></code></li>

</ol>
<p data-anchor-id="gi0e"><img title="" src="http://static.zybuluo.com/linyaonie/bm6zktj6ym8n2rplyc99f2y2/image_1ct2t263nguvko71s0r1qmu9v02a.png" alt="image_1ct2t263nguvko71s0r1qmu9v02a.png-20.4kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="将配置文件代码修改为如下所示" data-anchor-id="l8p1">将配置文件代码修改为如下所示：</h2>
<blockquote class="white-blockquote" data-anchor-id="bj1u">
<p>cat -n /application/svndata/yunjisuan/conf/svnserve.conf | sed -n '12p;13p;20p;27p'</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">    <span class="lit">12<span class="pln">  anon<span class="pun">-<span class="pln">access <span class="pun">=<span class="pln"> none                          <span class="com">#禁止匿名访问</span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">    <span class="lit">13<span class="pln">  auth<span class="pun">-<span class="pln">access <span class="pun">=<span class="pln"> write                         <span class="com">#验证访问可写</span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">    <span class="lit">20<span class="pln">  password<span class="pun">-<span class="pln">db <span class="pun">=<span class="pln"> <span class="str">/application/<span class="pln">svnpasswd<span class="pun">/<span class="pln">passwd <span class="com">#密码文件位置</span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">    <span class="lit">27<span class="pln">  authz<span class="pun">-<span class="pln">db <span class="pun">=<span class="pln"> <span class="str">/application/<span class="pln">svnpasswd<span class="pun">/<span class="pln">authz     <span class="com">#验证文件位置</span></span></span></span></span></span></span></span></span></span></span></span></code></li>

</ol>
<p data-anchor-id="9chf"><img title="" src="http://static.zybuluo.com/linyaonie/fnahvja42c1gso2kmux24rfp/image_1ct2t59aicc7r7h2cs1po012oh3n.png" alt="image_1ct2t59aicc7r7h2cs1po012oh3n.png-24.3kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="特别提示" data-anchor-id="ekt2">特别提示：</h2>
<blockquote class="white-blockquote" data-anchor-id="2d8b">
<p>此配置文件里的每条配置代码必须顶格写，不能有空格。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="24-将authz文件和passwd文件拷贝到applicationsvnpasswd下" data-anchor-id="ufrh">2.4 将authz文件和passwd文件拷贝到/application/svnpasswd下</h2>
<blockquote class="white-blockquote" data-anchor-id="j5qs">
<p>cp /application/svndata/yunjisuan/conf/authz /application/svnpasswd/</p>
<p>cp /application/svndata/yunjisuan/conf/passwd /application/svnpasswd/</p>
<p>ll /application/svnpasswd/</p>

</blockquote>
<p data-anchor-id="n6y3"><img title="" src="http://static.zybuluo.com/linyaonie/iq2h8urdsgst4aap2df4kwik/image_1ct2tsmul1gmk1ctc1dve150v162p44.png" alt="image_1ct2tsmul1gmk1ctc1dve150v162p44.png-20.3kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="25-svn启动命令帮助" data-anchor-id="w8fp">2.5 svn启动命令帮助</h2>
<blockquote class="white-blockquote" data-anchor-id="cxvk">
<p>svnserve --help ---&gt;svn启动命令帮助</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">svnserve<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> cannot <span class="kwd">set<span class="pln"> LC_CTYPE locale</span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">svnserve<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> environment variable LANG <span class="kwd">is<span class="pln"> en</span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">svnserve<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> please check that your locale name <span class="kwd">is<span class="pln"> correct</span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">usage<span class="pun">:<span class="pln"> svnserve <span class="pun">[-<span class="pln">d <span class="pun">|<span class="pln"> <span class="pun">-<span class="pln">i <span class="pun">|<span class="pln"> <span class="pun">-<span class="pln">t <span class="pun">|<span class="pln"> <span class="pun">-<span class="pln">X<span class="pun">]<span class="pln"> <span class="pun">[<span class="pln">options<span class="pun">]</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="typ">Valid<span class="pln"> options<span class="pun">:</span></span></span></code></li>
<li class="L5"><code><span class="pln">  <span class="pun">-<span class="pln">d <span class="pun">[--<span class="pln">daemon<span class="pun">]<span class="pln">            <span class="pun">:<span class="pln"> daemon mode        <span class="com">#守护进程启动（后台）</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pln">  <span class="pun">-<span class="pln">i <span class="pun">[--<span class="pln">inetd<span class="pun">]<span class="pln">             <span class="pun">:<span class="pln"> inetd mode</span></span></span></span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="pln">  <span class="pun">-<span class="pln">t <span class="pun">[--<span class="pln">tunnel<span class="pun">]<span class="pln">            <span class="pun">:<span class="pln"> tunnel mode</span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pln">  <span class="pun">-<span class="pln">X <span class="pun">[--<span class="pln">listen<span class="pun">-<span class="pln">once<span class="pun">]<span class="pln">       <span class="pun">:<span class="pln"> listen<span class="pun">-<span class="pln">once mode <span class="pun">(<span class="pln">useful <span class="kwd">for<span class="pln"> debugging<span class="pun">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pln">  <span class="pun">-<span class="pln">r <span class="pun">[--<span class="pln">root<span class="pun">]<span class="pln"> ARG          <span class="pun">:<span class="pln"> root of directory to serve <span class="com">#指定根目录</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pln">  <span class="pun">-<span class="pln">R <span class="pun">[--<span class="pln">read<span class="pun">-<span class="pln">only<span class="pun">]<span class="pln">         <span class="pun">:<span class="pln"> force read only<span class="pun">,<span class="pln"> overriding repository config file</span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">  <span class="pun">--<span class="pln">config<span class="pun">-<span class="pln">file ARG        <span class="pun">:<span class="pln"> read configuration <span class="kwd">from<span class="pln"> file ARG</span></span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">  <span class="pun">--<span class="pln">listen<span class="pun">-<span class="pln">port ARG        <span class="pun">:<span class="pln"> listen port        <span class="com">#监听端口默认3690</span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">                             <span class="pun">[<span class="pln">mode<span class="pun">:<span class="pln"> daemon<span class="pun">,<span class="pln"> listen<span class="pun">-<span class="pln">once<span class="pun">]</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">  <span class="pun">--<span class="pln">listen<span class="pun">-<span class="pln">host ARG        <span class="pun">:<span class="pln"> listen hostname <span class="kwd">or<span class="pln"> IP address  <span class="com">#监听IP</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">                             <span class="pun">[<span class="pln">mode<span class="pun">:<span class="pln"> daemon<span class="pun">,<span class="pln"> listen<span class="pun">-<span class="pln">once<span class="pun">]</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pln">  <span class="pun">-<span class="pln">T <span class="pun">[--<span class="pln">threads<span class="pun">]<span class="pln">           <span class="pun">:<span class="pln"> <span class="kwd">use<span class="pln"> threads instead of fork <span class="pun">[<span class="pln">mode<span class="pun">:<span class="pln"> daemon<span class="pun">]</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="pln">  <span class="pun">--<span class="pln">foreground             <span class="pun">:<span class="pln"> run <span class="kwd">in<span class="pln"> foreground <span class="pun">(<span class="pln">useful <span class="kwd">for<span class="pln"> debugging<span class="pun">)</span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pln">                             <span class="pun">[<span class="pln">mode<span class="pun">:<span class="pln"> daemon<span class="pun">]</span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pln">  <span class="pun">--<span class="pln">log<span class="pun">-<span class="pln">file ARG           <span class="pun">:<span class="pln"> svnserve log file</span></span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pln">  <span class="pun">--<span class="pln">pid<span class="pun">-<span class="pln">file ARG           <span class="pun">:<span class="pln"> write server process ID to file ARG</span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">                             <span class="pun">[<span class="pln">mode<span class="pun">:<span class="pln"> daemon<span class="pun">,<span class="pln"> listen<span class="pun">-<span class="pln">once<span class="pun">]</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">  <span class="pun">--<span class="pln">tunnel<span class="pun">-<span class="pln">user ARG        <span class="pun">:<span class="pln"> tunnel username <span class="pun">(<span class="kwd">default<span class="pln"> <span class="kwd">is<span class="pln"> current uids name<span class="pun">)</span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">                             <span class="pun">[<span class="pln">mode<span class="pun">:<span class="pln"> tunnel<span class="pun">]</span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">  <span class="pun">-<span class="pln">h <span class="pun">[--<span class="pln">help<span class="pun">]<span class="pln">              <span class="pun">:<span class="pln"> display <span class="kwd">this<span class="pln"> help</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">  <span class="pun">--<span class="pln">version                <span class="pun">:<span class="pln"> show program version information</span></span></span></span></span></code></li>

</ol>
<p data-anchor-id="bzin"><img title="" src="http://static.zybuluo.com/linyaonie/pvx5qtwbvj7w6o8sdj9z04ct/image_1ct2tt8n8j3me42bqj5pm1iho4h.png" alt="image_1ct2tt8n8j3me42bqj5pm1iho4h.png-61.6kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="启动svn服务" data-anchor-id="lm0a">启动svn服务</h2>
<blockquote class="white-blockquote" data-anchor-id="47hc">
<p>svnserve -d -r /application/svndata/</p>
<p>netstat -antup | grep 3690</p>

</blockquote>
<p data-anchor-id="geqc"><img title="" src="http://static.zybuluo.com/linyaonie/m8by6mxtj740ymspal3a0ci1/image_1ct2tu9o5kov1d9o12qrer31f704u.png" alt="image_1ct2tu9o5kov1d9o12qrer31f704u.png-17kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="26-解决svnserve启动时的警告问题" data-anchor-id="ixot">2.6 解决svnserve启动时的警告问题</h2>
<blockquote class="white-blockquote" data-anchor-id="oo0y">
<p>source /etc/sysconfig/i18n ---&gt;启用中文字符集</p>
<p>cat /etc/sysconfig/i18n</p>
<p>svnserve -d -r /application/svndata/ ---&gt;有中文字符集启动没有警告了</p>

</blockquote>
<p data-anchor-id="9pun"><img title="" src="http://static.zybuluo.com/linyaonie/16t1z4l9qxqlkjijyuri19uc/image_1ct2u56t91tjs6mfom110ls1bvi68.png" alt="image_1ct2u56t91tjs6mfom110ls1bvi68.png-11.8kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="27-passwd文件及密码设置" data-anchor-id="de23">2.7 passwd文件及密码设置</h2>
<blockquote class="white-blockquote" data-anchor-id="xeq1">
<p>vim /application/svnpasswd/passwd</p>
<p>在/application/svnpasswd/passwd文件末尾追加内容</p>
<p>tail -4 /application/svnpasswd/passwd</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">yunjisuan <span class="pun">=<span class="pln"> <span class="lit">123123<span class="pln">      <span class="com">#设置账号密码</span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">benet     <span class="pun">=<span class="pln"> <span class="lit">123123<span class="pln">      <span class="com">#设置账号密码</span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">stu001    <span class="pun">=<span class="pln"> <span class="lit">123<span class="pln">         <span class="com">#设置账号密码</span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">stu002    <span class="pun">=<span class="pln"> <span class="lit">456<span class="pln">         <span class="com">#设置账号密码</span></span></span></span></span></span></code></li>

</ol>
<p data-anchor-id="1qcb"><img title="" src="http://static.zybuluo.com/linyaonie/qbks3koz1zvk63sw3fu779k7/image_1ct2ujgudvpa17oc1gh4rpp15f675.png" alt="image_1ct2ujgudvpa17oc1gh4rpp15f675.png-17.7kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="28-authz的授权" data-anchor-id="8x69">2.8 authz的授权</h2>
<p data-anchor-id="bcma">注意</p>
<blockquote class="white-blockquote" data-anchor-id="akfx">
<p>1，权限配置文件中出现的用户名必须已在用户配置文件中定义</p>
<p>2，对权限配置文件的修改立即生效，不必重启svn</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="权限配置说明" data-anchor-id="skag">权限配置说明</h2>
<div class="md-section-divider">&nbsp;</div>
<h3 id="用户组格式" data-anchor-id="312a">用户组格式</h3>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pun">【<span class="pln">groups<span class="pun">】</span></span></span></code></li>
<li class="L1"><code><span class="pun">=，</span></code></li>
<li class="L2"><code><span class="pun">其中，<span class="lit">1<span class="pun">个用户组可以包含<span class="lit">1<span class="pun">个或多个用过户，用户间以逗号分隔。</span></span></span></span></span></code></li>
<li class="L3"><code><span class="pun">例如：<span class="pln">harry\_<span class="kwd">and<span class="pln">\_sally <span class="pun">=<span class="pln"> harry<span class="pun">,<span class="pln">sally     <span class="com">#==&gt;用户组 = 用户1，用户2</span></span></span></span></span></span></span></span></span></code></li>

</ol>
<div class="md-section-divider">&nbsp;</div>
<h3 id="版本库目录格式" data-anchor-id="cioq">版本库目录格式</h3>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pun">[&lt;版本库&gt;：/项目/目录]<span class="pln">  <span class="com">#例如：[repository:/baz/fuz]</span></span></span></code></li>
<li class="L1"><code><span class="pun">@&lt;用户组名&gt;<span class="pln"> <span class="pun">=<span class="pln"> <span class="pun">&lt;权限&gt;<span class="pln">    <span class="com">#例如：@harry\_and\_sally = rw</span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pun">&lt;用户名&gt;<span class="pln"> <span class="pun">=<span class="pln"> <span class="pun">&lt;权限&gt;<span class="pln">       <span class="com">#例如：harry = rw</span></span></span></span></span></span></span></code></li>
<li class="L3"><code></code></li>
<li class="L4"><code><span class="pln">     <span class="pun">其中，方框号内部分可以有多种写法：</span></span></code></li>
<li class="L5"><code></code></li>
<li class="L6"><code><span class="pun">[<span class="str">/],表示根目录及以下，根目录是svnserve启动时指定的，我们指定为/<span class="pln">application<span class="pun">/<span class="pln">svndata<span class="pun">，[/]就是表示对全部版本库设置权限。</span></span></span></span></span></span></code></li>
<li class="L7"><code></code></li>
<li class="L8"><code><span class="pun">[<span class="pln">repos<span class="pun">:/]，表示对版本库<span class="pln">repos<span class="pun">设置权限。</span></span></span></span></span></code></li>
<li class="L9"><code></code></li>
<li class="L0"><code><span class="pun">[<span class="pln">repos<span class="pun">:/<span class="pln">yunjisuan<span class="pun">]，表示对版本库<span class="pln">repos<span class="pun">中的<span class="pln">yunjisuan<span class="pun">项目设置权限。</span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code></code></li>
<li class="L2"><code><span class="pun">[<span class="pln">repos<span class="pun">:<span class="str">/yunjisuan/<span class="pln">benet<span class="pun">]，表示对版本库<span class="pln">repos<span class="pun">中的<span class="pln">yunjisuan<span class="pun">项目的<span class="pln">benet<span class="pun">目录设置权限。</span></span></span></span></span></span></span></span></span></span></span></span></code></li>

</ol>
<p data-anchor-id="xpux"><code>权限主体可以是用户组，用户或*，用户组在前面加@，*表示全部用户。</code></p>
<p data-anchor-id="h5cu"><code>权限可以是w，r，wr和空，空表示没有任何权限。</code></p>
<p data-anchor-id="rsho"><code>authz中每个参数都要顶格写，开头不能有空格。</code></p>
<p data-anchor-id="kab1"><code>对于组，要以@开头，用户不需要@开头。</code></p>
<div class="md-section-divider">&nbsp;</div>
<h3 id="编辑authz配置文件进行授权在authz末尾加入以下几句代码" data-anchor-id="rp3m">编辑authz配置文件进行授权，在authz末尾加入以下几句代码</h3>
<blockquote class="white-blockquote" data-anchor-id="xj3f">
<p>vim /application/svnpasswd/authz</p>
<p>egrep -v "#|^$" /application/svnpasswd/authz</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pun">[<span class="pln">aliases<span class="pun">]</span></span></span></code></li>
<li class="L1"><code><span class="pun">[<span class="pln">groups<span class="pun">]</span></span></span></code></li>
<li class="L2"><code><span class="pln">sagroup <span class="pun">=<span class="pln"> stu001<span class="pun">,<span class="pln">stu002         <span class="com">#新增本行，定义组名</span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pun">[<span class="pln">yunjisuan<span class="pun">:/]<span class="pln">                   <span class="com">#定义授权的范围</span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">yunjisuan <span class="pun">=<span class="pln"> rw                  <span class="com">#用户单独授权</span></span></span></span></code></li>
<li class="L5"><code><span class="pln">benet <span class="pun">=<span class="pln"> r                       <span class="com">#用户单独授权</span></span></span></span></code></li>
<li class="L6"><code><span class="lit">@sagroup<span class="pln"> <span class="pun">=<span class="pln"> r                    <span class="com">#组用户授权</span></span></span></span></span></code></li>

</ol>
<p data-anchor-id="4xqm"><img title="" src="http://static.zybuluo.com/linyaonie/4ydk2l2hntqrvuazs5dr5v7o/image_1ct2vhaofkq94no3bqat4171c7i.png" alt="image_1ct2vhaofkq94no3bqat4171c7i.png-22.7kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h3 id="authz配置文件" data-anchor-id="boij">authz配置文件</h3>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pun">[<span class="pln">game<span class="pun">:/<span class="pln">server<span class="pun">]</span></span></span></span></span></code></li>
<li class="L1"><code><span class="lit">@server<span class="pun">=<span class="pln">rw </span></span></span></code></li>
<li class="L2"><code><span class="pun">这个含义是<span class="pln">server<span class="pun">用户可以多<span class="pln">svn<span class="pun">的<span class="pln">game<span class="pun">下面的<span class="pln">server<span class="pun">目录有读写权限</span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code></code></li>
<li class="L4"><code><span class="pun">[<span class="pln">groups<span class="pun">]</span></span></span></code></li>
<li class="L5"><code><span class="com">#管理组</span></code></li>
<li class="L6"><code><span class="pln">manager <span class="pun">=<span class="pln"> boss</span></span></span></code></li>
<li class="L7"><code><span class="com">#服务端用户组</span></code></li>
<li class="L8"><code><span class="pln">server <span class="pun">=<span class="pln"> server1<span class="pun">,<span class="pln">server2</span></span></span></span></span></code></li>
<li class="L9"><code><span class="com">#客户端用户组</span></code></li>
<li class="L0"><code><span class="pln">client <span class="pun">=<span class="pln"> client1<span class="pun">,<span class="pln">client2</span></span></span></span></span></code></li>
<li class="L1"><code><span class="com">#美术组</span></code></li>
<li class="L2"><code><span class="pln">art <span class="pun">=<span class="pln"> art1<span class="pun">,<span class="pln">art2</span></span></span></span></span></code></li>
<li class="L3"><code><span class="com">#策划组</span></code></li>
<li class="L4"><code><span class="pln">design<span class="pun">=<span class="pln">design1<span class="pun">,<span class="pln">design2</span></span></span></span></span></code></li>
<li class="L5"><code><span class="pun">[<span class="pln">game<span class="pun">:/]</span></span></span></code></li>
<li class="L6"><code><span class="lit">@manager<span class="pun">=<span class="pln">rw</span></span></span></code></li>
<li class="L7"><code><span class="pun">[<span class="pln">game<span class="pun">:/<span class="pln">server<span class="pun">]</span></span></span></span></span></code></li>
<li class="L8"><code><span class="lit">@server<span class="pun">=<span class="pln">rw</span></span></span></code></li>
<li class="L9"><code><span class="pun">[<span class="pln">game<span class="pun">:/<span class="pln">client<span class="pun">]</span></span></span></span></span></code></li>
<li class="L0"><code><span class="lit">@client<span class="pun">=<span class="pln">rw</span></span></span></code></li>
<li class="L1"><code><span class="lit">@design<span class="pun">=<span class="pln">r</span></span></span></code></li>
<li class="L2"><code><span class="lit">@art<span class="pun">=<span class="pln">r</span></span></span></code></li>
<li class="L3"><code><span class="pun">[<span class="pln">game<span class="pun">:/<span class="pln">art<span class="pun">]</span></span></span></span></span></code></li>
<li class="L4"><code><span class="lit">@design<span class="pun">=<span class="pln">rw</span></span></span></code></li>
<li class="L5"><code><span class="lit">@art<span class="pun">=<span class="pln">rw</span></span></span></code></li>
<li class="L6"><code><span class="lit">@client<span class="pun">=<span class="pln">r</span></span></span></code></li>
<li class="L7"><code><span class="pun">[<span class="pln">game<span class="pun">:/<span class="pln">design<span class="pun">]</span></span></span></span></span></code></li>
<li class="L8"><code><span class="lit">@design<span class="pun">=<span class="pln">rw</span></span></span></code></li>
<li class="L9"><code><span class="lit">@server<span class="pun">=<span class="pln">r</span></span></span></code></li>
<li class="L0"><code><span class="lit">@client<span class="pun">=<span class="pln">r</span></span></span></code></li>
<li class="L1"><code><span class="lit">@art<span class="pun">=<span class="pln">r</span></span></span></code></li>

</ol>
<div class="md-section-divider">&nbsp;</div>
<h2 id="29-重启动svnserve可以不用重启" data-anchor-id="kq1r">2.9 重启动svnserve(可以不用重启)</h2>
<blockquote class="white-blockquote" data-anchor-id="zybk">
<p>ps -ef | grep svn | grep -v grep</p>
<p>kill 1062</p>
<p>ps -ef | grep svn | grep -v grep</p>
<p>svnserve -d -r /application/svndata/</p>

</blockquote>
<p data-anchor-id="tq06"><img title="" src="http://static.zybuluo.com/linyaonie/oq1aarpqtvrbxrwnhvteglq6/image_1ct2vjseji8j1765jlv10d01jmn7v.png" alt="image_1ct2vjseji8j1765jlv10d01jmn7v.png-29.6kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="centos7开机自启动svn" data-anchor-id="pq97">centos7开机自启动svn</h2>
<blockquote class="white-blockquote" data-anchor-id="fbmy">
<p>vim /etc/sysconfig/svnserve<span class="Apple-converted-space">&nbsp;<br />---&gt;修改成svn仓库的路径</span></p>
<p>systemctl enable svnserve.service<span class="Apple-converted-space">&nbsp;<br />---&gt;开机启动</span></p>
<p>systemctl status svnserve<span class="Apple-converted-space">&nbsp;<br />----&gt;查看状态</span></p>

</blockquote>
<p data-anchor-id="exgb"><img title="" src="http://static.zybuluo.com/linyaonie/6zdb61wjvkqx4qy1l2v8qco2/image_1dbjnr8vg1iullg21e7fbm9gpv9.png" alt="image_1dbjnr8vg1iullg21e7fbm9gpv9.png-13.9kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h1 id="第3章-搭建svn客户端" data-anchor-id="fe60">第3章 搭建SVN客户端</h1>
<div class="md-section-divider">&nbsp;</div>
<h2 id="31-使用svn客户端windows版" data-anchor-id="e7mb">3.1 使用svn客户端（windows版）</h2>
<div class="md-section-divider">&nbsp;</div>
<h3 id="311-软件版本选择" data-anchor-id="d9ov">3.1.1 软件版本选择</h3>
<blockquote class="white-blockquote" data-anchor-id="2bw2">
<p>推荐：TortoiseSVN-1.9.7.27907-x64-svn-1.9.7<span class="Apple-converted-space">&nbsp;<br />注意：32位系统要用32位软件版本</span></p>
<p>下载链接<span class="Apple-converted-space">&nbsp;<br />链接：<a href="https://pan.baidu.com/s/1dKq_JVJN3tFxY_AvMKKTcA" target="_blank">https://pan.baidu.com/s/1dKq_JVJN3tFxY_AvMKKTcA</a><span class="Apple-converted-space">&nbsp;<br />提取码：kn9z</span></span></p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="312-svn客户端软件安装" data-anchor-id="en3z">3.1.2 svn客户端软件安装</h3>
<blockquote class="white-blockquote" data-anchor-id="8d63">
<p>一路yes即可</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="313-svn客户端软件的使用" data-anchor-id="b2y9">3.1.3 svn客户端软件的使用</h3>
<div class="md-section-divider">&nbsp;</div>
<h4 id="1先在本地创建一个目录起名任意比如data" data-anchor-id="ciao">（1）先在本地创建一个目录，起名任意，比如data</h4>
<p data-anchor-id="htat"><img title="" src="http://static.zybuluo.com/linyaonie/pgvzyiwp8f0xe5pvm6dh4t2n/image_1ct30pf5c1e638qu69pthpqbe8c.png" alt="image_1ct30pf5c1e638qu69pthpqbe8c.png-42.4kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="2鼠标右键点击data目录" data-anchor-id="vueu">（2）鼠标右键点击data目录</h4>
<blockquote class="white-blockquote" data-anchor-id="8se9">
<p>svn://192.168.200.69/yunjisuan</p>
<p>选择右键菜单里的SVN Checkout，出现下图：</p>

</blockquote>
<p data-anchor-id="hu4l"><img title="" src="http://static.zybuluo.com/linyaonie/dfwxvcho50357sukv5161iei/image_1ct30s4n63ma1k9rkup15medsl8p.png" alt="image_1ct30s4n63ma1k9rkup15medsl8p.png-25.3kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="特别提示-1" data-anchor-id="popy">特别提示</h4>
<blockquote class="white-blockquote" data-anchor-id="k55d">
<p>如果连接不通，请检查Linux虚拟机的iptables是否关闭</p>
<p>点击OK后，出现下图：</p>

</blockquote>
<p data-anchor-id="ceny"><img title="" src="http://static.zybuluo.com/linyaonie/xcvijzpmuapzzbw0znxqc70j/image_1ct30u16gpss1a9eoi5hhh1agn96.png" alt="image_1ct30u16gpss1a9eoi5hhh1agn96.png-35.6kB" /></p>
<blockquote class="white-blockquote" data-anchor-id="capv">
<p>再次点击OK以后，结束。此时目录里多了一个隐藏的目录，表示此目录已经和svn服务器连通</p>

</blockquote>
<p data-anchor-id="kxe5"><img title="" src="http://static.zybuluo.com/linyaonie/v14yhf9eo0luogagpbhmp0fu/image_1ct311diq1kfc8i65ul117k1nr59j.png" alt="image_1ct311diq1kfc8i65ul117k1nr59j.png-51.4kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="命令说明" data-anchor-id="asub">命令说明</h4>
<blockquote class="white-blockquote" data-anchor-id="8bwf">
<p>（1）SVN Checkout:相当于下载，第一次连接svn服务器的时候需要和服务器的对应存储目录进行数据同步，如果服务器的对应目录里有数据文件，那么就会下载到你的本地对应目录里。</p>
<p>（2）SVN Update：更新数据，检查服务器端svn存储目录里是否和本地svn存储目录数据不一致，如果不一致，那么下载改变或新增的部分到本地svn目录里。（不会删除本地目录内容）</p>
<p>（3）SVN Commit：提交数据到svn服务器端存储目录。本地svn存储目录会和服务器端存储目录进行比对校验。会把本地改变的部分和新增的部分同步上传至服务器端。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="314-svn客户端使用测试" data-anchor-id="5nha">3.1.4 svn客户端使用测试</h3>
<div class="md-section-divider">&nbsp;</div>
<h4 id="1向windows的svn存储目录data里放一个空文件" data-anchor-id="o7d0">（1）向windows的svn存储目录data里放一个空文件</h4>
<p data-anchor-id="vc7h"><img title="" src="http://static.zybuluo.com/linyaonie/ydlz2ovuglgkgobiulr3qqry/image_1ct31345op61griri7i710moa0.png" alt="image_1ct31345op61griri7i710moa0.png-41.3kB" /></p>
<hr />
<div class="md-section-divider">&nbsp;</div>
<h4 id="2右键点击data目录选择svn-commit" data-anchor-id="qux8">（2）右键点击data目录，选择SVN Commit</h4>
<p data-anchor-id="w589"><img title="" src="http://static.zybuluo.com/linyaonie/zfiy5zn16z8116v3esu8zw63/image_1ct316ok116pln8crerbti13p2ad.png" alt="image_1ct316ok116pln8crerbti13p2ad.png-49.3kB" /></p>
<p data-anchor-id="g7rg"><img title="" src="http://static.zybuluo.com/linyaonie/o73fuehhvqrenedbh04dlfpl/image_1ct31784h1k3386oph42nfa6caq.png" alt="image_1ct31784h1k3386oph42nfa6caq.png-36.2kB" /></p>
<hr />
<div class="md-section-divider">&nbsp;</div>
<h4 id="3打开本地data目录里的文件随便写点内容后再次进行svn-commit" data-anchor-id="jepk">（3）打开本地data目录里的文件，随便写点内容后，再次进行SVN commit</h4>
<p data-anchor-id="e3kh"><img title="" src="http://static.zybuluo.com/linyaonie/b8i7ckttl5d63jptswpqzkx3/image_1ct31fc0oueq7ubj6010pv1d1eb7.png" alt="image_1ct31fc0oueq7ubj6010pv1d1eb7.png-53.8kB" /></p>
<p data-anchor-id="o2mi"><img title="" src="http://static.zybuluo.com/linyaonie/7g4htdtkgx9oh8qpm3dcvvmc/image_1ct31fs1b86auensuk98b34obk.png" alt="image_1ct31fs1b86auensuk98b34obk.png-34.6kB" /></p>
<hr />
<div class="md-section-divider">&nbsp;</div>
<h4 id="4直接从本地查看服务器端的数据内容" data-anchor-id="3b2u">（4）直接从本地查看服务器端的数据内容</h4>
<blockquote class="white-blockquote" data-anchor-id="az7l">
<p>右键点击本地svn存储目录data，选择TortoiseSVN ===&gt;Repo-browser后出现下图</p>

</blockquote>
<p data-anchor-id="30dv"><img title="" src="http://static.zybuluo.com/linyaonie/yb17pts4o5oumhzuzj6y05hc/image_1ct31ksme1afr6s5nv9egthq6c1.png" alt="image_1ct31ksme1afr6s5nv9egthq6c1.png-59.9kB" /></p>
<blockquote class="white-blockquote" data-anchor-id="vjh6">
<p>双击文件可以直接远程打开文件，可以看到里面刚刚被修改后的内容已经更新至服务器端。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h4 id="5删除本地svn存储目录data里的文件后选择svn-update" data-anchor-id="ixzk">（5）删除本地svn存储目录data里的文件，后选择SVN Update</h4>
<blockquote class="white-blockquote" data-anchor-id="sd4b">
<p>会发现，刚刚删除的文件又重新下载回来了。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h4 id="6继续删除本地svn存储目录data里的文件后选择svn-commit" data-anchor-id="djtk">（6）继续删除本地svn存储目录data里的文件，后选择SVN Commit</h4>
<p data-anchor-id="0lzg"><img title="" src="http://static.zybuluo.com/linyaonie/9y75cbnad95i5zk4zer2ouef/image_1ct31r8rhme8mihkvf10sb17mhce.png" alt="image_1ct31r8rhme8mihkvf10sb17mhce.png-58.9kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="7再次查看服务器端存储目录里发现文件已经被删除了" data-anchor-id="j2o5">（7）再次查看服务器端存储目录里，发现文件已经被删除了</h4>
<p data-anchor-id="kyki"><img title="" src="http://static.zybuluo.com/linyaonie/4lvemhtb0h4sazs2ojr7q5lk/image_1ct31smed1a3vvia1bh718bv1578cr.png" alt="image_1ct31smed1a3vvia1bh718bv1578cr.png-56.5kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h2 id="32-svn的管理命令linux" data-anchor-id="oj6i">3.2 SVN的管理命令（Linux）</h2>
<blockquote class="white-blockquote" data-anchor-id="4bpg">
<p>svn --help</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">usage<span class="pun">:<span class="pln"> svn <span class="str">&lt;subcommand&gt;<span class="pln"> <span class="pun">[<span class="pln">options<span class="pun">]<span class="pln"> <span class="pun">[<span class="pln">args<span class="pun">]</span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="typ">Subversion<span class="pln"> command<span class="pun">-<span class="pln">line client<span class="pun">,<span class="pln"> version <span class="lit">1.6<span class="pun">.<span class="lit">11.</span></span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="typ">Type<span class="pln"> <span class="str">'svn help &lt;subcommand&gt;'<span class="pln"> <span class="kwd">for<span class="pln"> help on a specific subcommand<span class="pun">.</span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="typ">Type<span class="pln"> <span class="str">'svn --version'<span class="pln"> to see the program version <span class="kwd">and<span class="pln"> RA modules</span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">  <span class="kwd">or<span class="pln"> <span class="str">'svn --version --quiet'<span class="pln"> to see just the version number<span class="pun">.</span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="typ">Most<span class="pln"> subcommands take file <span class="kwd">and<span class="pun">/<span class="kwd">or<span class="pln"> directory arguments<span class="pun">,<span class="pln"> recursing</span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pln">on the directories<span class="pun">.<span class="pln">  <span class="typ">If<span class="pln"> <span class="kwd">no<span class="pln"> arguments are supplied to such a</span></span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="pln">command<span class="pun">,<span class="pln"> it recurses on the current directory <span class="pun">(<span class="pln">inclusive<span class="pun">)<span class="pln"> <span class="kwd">by<span class="pln"> <span class="kwd">default<span class="pun">.</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="typ">Available<span class="pln"> subcommands<span class="pun">:</span></span></span></code></li>
<li class="L9"><code><span class="pln">   add</span></code></li>
<li class="L0"><code><span class="pln">   blame <span class="pun">(<span class="pln">praise<span class="pun">,<span class="pln"> annotate<span class="pun">,<span class="pln"> ann<span class="pun">)</span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">   cat</span></code></li>
<li class="L2"><code><span class="pln">   changelist <span class="pun">(<span class="pln">cl<span class="pun">)</span></span></span></span></code></li>
<li class="L3"><code><span class="pln">   checkout <span class="pun">(<span class="pln">co<span class="pun">)<span class="pln">        <span class="com">#下载数据</span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">   cleanup</span></code></li>
<li class="L5"><code><span class="pln">   commit <span class="pun">(<span class="pln">ci<span class="pun">)<span class="pln">          <span class="com">#提交数据</span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pln">   copy <span class="pun">(<span class="pln">cp<span class="pun">)</span></span></span></span></code></li>
<li class="L7"><code><span class="pln">   <span class="kwd">delete<span class="pln"> <span class="pun">(<span class="kwd">del<span class="pun">,<span class="pln"> remove<span class="pun">,<span class="pln"> rm<span class="pun">)</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pln">   diff <span class="pun">(<span class="pln">di<span class="pun">)</span></span></span></span></code></li>
<li class="L9"><code><span class="pln">   <span class="kwd">export</span></span></code></li>
<li class="L0"><code><span class="pln">   help <span class="pun">(?,<span class="pln"> h<span class="pun">)</span></span></span></span></code></li>
<li class="L1"><code><span class="pln">   <span class="kwd">import</span></span></code></li>
<li class="L2"><code><span class="pln">   info</span></code></li>
<li class="L3"><code><span class="pln">   list <span class="pun">(<span class="pln">ls<span class="pun">)<span class="pln">            <span class="com">#显示服务器端内容</span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">   <span class="kwd">lock</span></span></code></li>
<li class="L5"><code><span class="pln">   log</span></code></li>
<li class="L6"><code><span class="pln">   merge</span></code></li>
<li class="L7"><code><span class="pln">   mergeinfo</span></code></li>
<li class="L8"><code><span class="pln">   mkdir</span></code></li>
<li class="L9"><code><span class="pln">   move <span class="pun">(<span class="pln">mv<span class="pun">,<span class="pln"> rename<span class="pun">,<span class="pln"> ren<span class="pun">)</span></span></span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pln">   propdel <span class="pun">(<span class="pln">pdel<span class="pun">,<span class="pln"> pd<span class="pun">)</span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">   propedit <span class="pun">(<span class="pln">pedit<span class="pun">,<span class="pln"> pe<span class="pun">)</span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">   propget <span class="pun">(<span class="pln">pget<span class="pun">,<span class="pln"> pg<span class="pun">)</span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">   proplist <span class="pun">(<span class="pln">plist<span class="pun">,<span class="pln"> pl<span class="pun">)</span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">   propset <span class="pun">(<span class="pln">pset<span class="pun">,<span class="pln"> ps<span class="pun">)</span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">   resolve</span></code></li>
<li class="L6"><code><span class="pln">   resolved</span></code></li>
<li class="L7"><code><span class="pln">   revert</span></code></li>
<li class="L8"><code><span class="pln">   status <span class="pun">(<span class="pln">stat<span class="pun">,<span class="pln"> st<span class="pun">)</span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pln">   <span class="kwd">switch<span class="pln"> <span class="pun">(<span class="pln">sw<span class="pun">)</span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pln">   unlock</span></code></li>
<li class="L1"><code><span class="pln">   update <span class="pun">(<span class="pln">up<span class="pun">)<span class="pln">                  <span class="com">#更新数据</span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="typ">Subversion<span class="pln"> <span class="kwd">is<span class="pln"> a tool <span class="kwd">for<span class="pln"> version control<span class="pun">.</span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="typ">For<span class="pln"> additional information<span class="pun">,<span class="pln"> see http<span class="pun">:<span class="com">//subversion.tigris.org/</span></span></span></span></span></span></code></li>

</ol>
<p data-anchor-id="u0hj"><img title="" src="http://static.zybuluo.com/linyaonie/dtsz744c2vrx0yrjxvfgqnem/image_1ct31ts1r1nad15kua661kk315ved8.png" alt="image_1ct31ts1r1nad15kua661kk315ved8.png-53.2kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h3 id="321-从svn库提取数据" data-anchor-id="m1jr">3.2.1 从SVN库提取数据</h3>
<blockquote class="white-blockquote" data-anchor-id="ragm">
<p>将文件checkout到本地目录<span class="Apple-converted-space">&nbsp;<br />svn checkout（co） remotepath localpath</span></p>
<p>mkdir yunjisuan</p>
<p>cd yunjisuan/</p>
<p>pwd</p>

</blockquote>
<p data-anchor-id="kwrp"><img title="" src="http://static.zybuluo.com/linyaonie/08a30tllttw5xgr7smj0ceve/image_1ct3226kl1g8o16ot4031nfm1rk8dl.png" alt="image_1ct3226kl1g8o16ot4031nfm1rk8dl.png-10.3kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="下载服务器端数据到linux本地目录" data-anchor-id="5ghp">下载服务器端数据到Linux本地目录</h4>
<blockquote class="white-blockquote" data-anchor-id="e23q">
<p>svn co svn://192.168.200.69/yunjisuan/ /root/yunjisuan/ --username=benet --password=123123</p>
<p>ll</p>

</blockquote>
<p data-anchor-id="y3wl"><img title="" src="http://static.zybuluo.com/linyaonie/12acc9cc9mygrzvjsysjanyc/image_1ct325t3l1bgafuvo6e90rlie2.png" alt="image_1ct325t3l1bgafuvo6e90rlie2.png-24.4kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h3 id="322-查看svn版本库中的数据" data-anchor-id="e1gp">3.2.2 查看SVN版本库中的数据</h3>
<blockquote class="white-blockquote" data-anchor-id="p4t8">
<p>svn list file:///application/svndata/yunjisuan</p>

</blockquote>
<p data-anchor-id="w4in"><img title="" src="http://static.zybuluo.com/linyaonie/utuggtwxe2lck2q6zhx08oxs/image_1ct327l8f7qmio6jf1dimal6ef.png" alt="image_1ct327l8f7qmio6jf1dimal6ef.png-10.2kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h3 id="323-提交数据到svn版本库" data-anchor-id="26l8">3.2.3 提交数据到SVN版本库</h3>
<div class="md-section-divider">&nbsp;</div>
<h4 id="1一次失败的提交" data-anchor-id="dvbo">(1)一次失败的提交</h4>
<blockquote class="white-blockquote" data-anchor-id="i81b">
<p>pwd</p>
<p>mkdir [1..5]</p>
<p>ll</p>
<p>svn add * ---&gt;提交前需要先把要提交的内容做标记A(相当于windows上勾对号)</p>
<p>svn ci -m "message" ---&gt;提交时需要同时-m指定一段话作为备注</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">A         <span class="lit">1</span></span></code></li>
<li class="L1"><code><span class="pln">A         <span class="lit">2</span></span></code></li>
<li class="L2"><code><span class="pln">A         <span class="lit">3</span></span></code></li>
<li class="L3"><code><span class="pln">A         <span class="lit">4</span></span></code></li>
<li class="L4"><code><span class="pln">A         <span class="lit">5</span></span></code></li>
<li class="L5"><code><span class="pln">svn<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> <span class="str">'666.txt.txt'<span class="pln"> <span class="kwd">is<span class="pln"> already under version control  <span class="pun">---&gt;这个文件已经标记过了</span></span></span></span></span></span></span></span></span></span></code></li>

</ol>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">svn<span class="pun">:<span class="pln"> <span class="typ">Commit<span class="pln"> failed <span class="pun">(<span class="pln">details follow<span class="pun">):</span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">svn<span class="pun">:<span class="pln"> <span class="typ">Authorization<span class="pln"> failed                       <span class="com">#提交失败，账户没有写权限，认证失败</span></span></span></span></span></span></code></li>

</ol>
<p data-anchor-id="9lxr"><img title="" src="http://static.zybuluo.com/linyaonie/cx5hvxss3y8dfu92n9xwnauk/image_1ct32o0521vjcdhc1576d191i4kes.png" alt="image_1ct32o0521vjcdhc1576d191i4kes.png-53.5kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="2换账户重新checkout" data-anchor-id="dus9">（2）换账户重新Checkout</h4>
<blockquote class="white-blockquote" data-anchor-id="g11q">
<p>svn co svn://192.168.200.69/yunjisuan/ /root/yunjisuan/ --username=yunjisuan --password=123123<span class="Apple-converted-space">&nbsp;<br />换拥有写入权限的账户checkout</span></p>
<p>Store password unencrypted (yes/no)? yes ---&gt;是否作为目录的新账户和密码</p>
<p>ll</p>

</blockquote>
<p data-anchor-id="h8t9"><img title="" src="http://static.zybuluo.com/linyaonie/vo1ika5msvidg5ywrp9oky2t/image_1ct330onc1khn1bbo1meiuj21p3mf9.png" alt="image_1ct330onc1khn1bbo1meiuj21p3mf9.png-75.3kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="重新提交" data-anchor-id="42m6">重新提交</h4>
<blockquote class="white-blockquote" data-anchor-id="7a7v">
<p>svn add *</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">svn<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> <span class="str">'1'<span class="pln"> <span class="kwd">is<span class="pln"> already under version control</span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">svn<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> <span class="str">'2'<span class="pln"> <span class="kwd">is<span class="pln"> already under version control</span></span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">svn<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> <span class="str">'3'<span class="pln"> <span class="kwd">is<span class="pln"> already under version control</span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">svn<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> <span class="str">'4'<span class="pln"> <span class="kwd">is<span class="pln"> already under version control</span></span></span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">svn<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> <span class="str">'5'<span class="pln"> <span class="kwd">is<span class="pln"> already under version control</span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">svn<span class="pun">:<span class="pln"> warning<span class="pun">:<span class="pln"> <span class="str">'666.txt.txt'<span class="pln"> <span class="kwd">is<span class="pln"> already under version control  <span class="pun">---&gt;这些文件已经标记过了</span></span></span></span></span></span></span></span></span></span></code></li>

</ol>
<blockquote class="white-blockquote" data-anchor-id="6ltm">
<p>svn ci -m "message" ---&gt;重新提交</p>

</blockquote>
<p data-anchor-id="apom"><img title="" src="http://static.zybuluo.com/linyaonie/hmp1ztp52nafwprtj4ev4e2j/image_1ct3327iu1ff4oqj1mils271p4ifm.png" alt="image_1ct3327iu1ff4oqj1mils271p4ifm.png-37.6kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="查看服务器端数据" data-anchor-id="cxp0">查看服务器端数据</h4>
<blockquote class="white-blockquote" data-anchor-id="20pa">
<p>svn list file:///application/svndata/yunjisuan/</p>

</blockquote>
<p data-anchor-id="b5kh"><img title="" src="http://static.zybuluo.com/linyaonie/rmee0mbeaqbr9rifo07csxbk/image_1ct333plk1v5cosgscjo31luvg3.png" alt="image_1ct333plk1v5cosgscjo31luvg3.png-13.8kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h1 id="第4章-svn钩子脚本" data-anchor-id="0evb">第4章 SVN钩子脚本</h1>
<div class="md-section-divider">&nbsp;</div>
<h2 id="41-钩子脚本简介" data-anchor-id="jqev">4.1 钩子脚本简介</h2>
<blockquote class="white-blockquote" data-anchor-id="qwmi">
<ul>
<li>
<p>钩子脚本的具体写法就是操作系统中shell脚本程序的写法，可根据自己的SVN所在的操作系统和shell程序进行相应的开发。</p>

</li>
<li>
<p>钩子脚本就是被某些版本库事件触发的程序，例如：创建新版本或修改未被版本控制的属性。每个钩子都能掌管足够的信息来了解发生了什么事件，操作对象是什么以及触发事件用户的账号。</p>

</li>
<li>
<p>根据钩子的输出或返回状态，钩子程序能够以某种方式控制该动作继续执行，停止或挂起。</p>

</li>

</ul>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="默认情况下钩子的子目录中包含各种版本库钩子模板" data-anchor-id="ojcx">默认情况下，钩子的子目录中包含各种版本库钩子模板</h3>
<blockquote class="white-blockquote" data-anchor-id="8ovj">
<p>ls -l /application/svndata/yunjisuan/hooks/</p>
<ul>
<li>
<p>对每种Subversion版本库支持的钩子都有一个模板，通过查看这些脚本的内容，你能看到是什么事件触发了脚本及如何给传脚本传递数据。</p>

</li>
<li>
<p>同时，这些模板也是如何使用这些脚本，结合Subversion支持的工具来完成有用任务的例子。</p>

</li>
<li>
<p>要实际安装一个可用的钩子，你需要在repos/hooks目录下安装一些与钩子同名（如start-commit或者post-commit）的可执行程序或脚本，注意，去掉模板的扩展名。</p>

</li>

</ul>

</blockquote>
<p data-anchor-id="5c3s"><img title="" src="http://static.zybuluo.com/linyaonie/az4yjb16dof6ecw8a6d9ud9i/image_1ct33gcri1ma7boo20n1k6m124qgg.png" alt="image_1ct33gcri1ma7boo20n1k6m124qgg.png-41.8kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h3 id="重要提示" data-anchor-id="51ad">重要提示</h3>
<blockquote class="white-blockquote" data-anchor-id="fmws">
<p>由于安全原因，Subversion版本库在一个空环境中执行钩子脚本就是没有任何环境变量，甚至没有$PATH或%PATH%。由于这个原因，许多管理员会感到很困惑，他们的钩子脚本手工运行时正常，可在Subversion中却不能运行。要注意，必须在你的钩子中设置好环境变量或为你的程序指定好绝对路径。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="42-svn的hooks模板" data-anchor-id="kwj0">4.2 SVN的hooks模板</h2>
<div class="md-section-divider">&nbsp;</div>
<h3 id="421-常用钩子脚本" data-anchor-id="qggr">4.2.1 常用钩子脚本</h3>
<p data-anchor-id="pdyp"><img title="" src="http://static.zybuluo.com/WBQ729/r9tclk32nna44gvfzohgzy4v/image_1crjn8s8lkqc14mlr3fo441t7q62.png" alt="image_1crjn8s8lkqc14mlr3fo441t7q62.png-29.9kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h3 id="422-非常用钩子脚本" data-anchor-id="4793">4.2.2 非常用钩子脚本</h3>
<blockquote class="white-blockquote" data-anchor-id="qpij"><ol>
<li>
<p>pre-revprop-change:在修改revision属性之前，执行该脚本</p>

</li>
<li>
<p>post-revprop-change:在修改revision属性之后，执行该脚本。因为修改稿已经完成，不可更改，因此本脚本的返回值被忽略（不过实际上的实现似乎是该脚本的正确执行与否影响属性修改）</p>

</li>
<li>
<p>pre-unlock:对文件进行解锁操作之前执行该脚本</p>

</li>
<li>
<p>post-unlock:对文件进行解锁操作之后执行该脚本</p>

</li>
<li>
<p>pre-lock:对文件进行加锁操作之前执行该脚本</p>

</li>
<li>
<p>post-lock：对文件进行加锁操作之后执行该脚本。</p>

</li>

</ol></blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="423-利用钩子脚本触发同步数据的注意事项" data-anchor-id="1j2p">4.2.3 利用钩子脚本触发同步数据的注意事项</h3>
<blockquote class="white-blockquote" data-anchor-id="ih6l">
<p>（1）一定要定义变量，主要是用过的命令的路径。因为SVN的考虑的安全问题，没有调用系统变量，如果手动执行是没有问题，但SVN自动执行就会无法执行了。</p>
<p>（2）SVN的同步目录在 update之前一定要先checkout一份出来，还有这里一定要添加用户和密码。</p>
<p>（3）加上了对前一个命令的判断，如果update的时候出了问题，程序没有退出的话还会继续同步代码到Web服务器上，这样会造成代码有问题。</p>
<p>（4）建议最好记录日志，出错的时候可以很快的排错</p>
<p>（5）最后是数据同步，rsync的相关参数一定要清楚。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="43-svn钩子生产应用场景举例" data-anchor-id="rqql">4.3 svn钩子生产应用场景举例</h2>
<blockquote class="white-blockquote" data-anchor-id="1v63">
<ul>
<li>
<p>pre-commit:<span class="Apple-converted-space">&nbsp;<br />限制上传文件扩展名及大小，控制提交要输入的信息等。</span></p>

</li>
<li>
<p>post-commit:<span class="Apple-converted-space">&nbsp;<br />SVN更新自动通知，MSN，邮件或短信通知。<span class="Apple-converted-space">&nbsp;<br />SVN更新触发checkout程序，然后实时rsync推送到服务器等。</span></span></p>

</li>

</ul>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="44-svn钩子生产应用实战" data-anchor-id="ejaa">4.4 svn钩子生产应用实战</h2>
<div class="md-section-divider">&nbsp;</div>
<h3 id="441-rsync与svn钩子结合实现数据实时同步某企业小案例" data-anchor-id="6p9e">4.4.1 rsync与svn钩子结合实现数据实时同步某企业小案例</h3>
<div class="md-section-divider">&nbsp;</div>
<h4 id="1建立同步web目录" data-anchor-id="w0qx">（1）建立同步WEB目录</h4>
<p data-anchor-id="ljac"><code>mkdir -p /data/www</code></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="2将svn中内容checkout到web目录一份" data-anchor-id="0a1a">（2）将SVN中内容checkout到WEB目录一份。</h4>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pun">[<span class="pln">root@localhost yunjisuan<span class="pun">]#<span class="pln"> mkdir <span class="pun">-<span class="pln">p <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">[<span class="pln">root@localhost yunjisuan<span class="pun">]#<span class="pln"> svn checkout svn<span class="pun">:<span class="com">//192.168.0.220/yunjisuan /data/www --username=yunjisuan --password=123123</span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="pln">xxxx</span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">111</span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">120</span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">112</span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">113</span></span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">114</span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="pln">ffff<span class="pun">.<span class="pln">txt</span></span></span></span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">115</span></span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">116</span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">117</span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">118</span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">A    <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="lit">119</span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="typ">Checked<span class="pln"> <span class="kwd">out<span class="pln"> revision <span class="lit">7.</span></span></span></span></span></code></li>
<li class="L5"><code><span class="pun">[<span class="pln">root@localhost yunjisuan<span class="pun">]#<span class="pln"> ll <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/</span></span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pln">total <span class="lit">44</span></span></code></li>
<li class="L7"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">111</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">112</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">113</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">114</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">115</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">116</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">117</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">118</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">119</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> <span class="lit">120</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="pun">-<span class="pln">rw<span class="pun">-<span class="pln">r<span class="pun">--<span class="pln">r<span class="pun">--.<span class="pln"> <span class="lit">1<span class="pln"> root root   <span class="lit">30<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> ffff<span class="pun">.<span class="pln">txt</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pun">-<span class="pln">rw<span class="pun">-<span class="pln">r<span class="pun">--<span class="pln">r<span class="pun">--.<span class="pln"> <span class="lit">1<span class="pln"> root root    <span class="lit">0<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">21<span class="pun">:<span class="lit">32<span class="pln"> xxxx</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>

</ol>
<div class="md-section-divider">&nbsp;</div>
<h4 id="3制作钩子脚本post-commit" data-anchor-id="v0k2">（3）制作钩子脚本，post-commit</h4>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">root@localhost yunjisuan<span class="pun">]#<span class="pln"> cd <span class="pun">/<span class="pln">application<span class="pun">/<span class="pln">svndata<span class="pun">/<span class="pln">yunjisuan<span class="pun">/<span class="pln">hooks<span class="pun">/</span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">[<span class="pln">root@localhost hooks<span class="pun">]#<span class="pln"> cp post<span class="pun">-<span class="pln">commit<span class="pun">.<span class="pln">tmpl post<span class="pun">-<span class="pln">commit <span class="com">#复制模板一份</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pun">[<span class="pln">root@localhost hooks<span class="pun">]#<span class="pln"> egrep <span class="pun">-<span class="pln">v <span class="str">"#|^$"<span class="pln"> post<span class="pun">-<span class="pln">commit     <span class="com">#模板原始内容</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">REPOS<span class="pun">=<span class="str">"$1"</span></span></span></code></li>
<li class="L4"><code><span class="pln">REV<span class="pun">=<span class="str">"$2"</span></span></span></code></li>
<li class="L5"><code><span class="pln">mailer<span class="pun">.<span class="pln">py commit <span class="str">"$REPOS"<span class="pln"> <span class="str">"$REV"<span class="pln"> <span class="pun">/<span class="pln">path<span class="pun">/<span class="pln">to<span class="pun">/<span class="pln">mailer<span class="pun">.<span class="pln">conf</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pun">[<span class="pln">root@localhost hooks<span class="pun">]#<span class="pln"> vim post<span class="pun">-<span class="pln">commit         <span class="com">#修改post-commit脚本</span></span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="pun">[<span class="pln">root@localhost hooks<span class="pun">]#<span class="pln"> egrep <span class="pun">-<span class="pln">v <span class="str">"#|^$"<span class="pln"> post<span class="pun">-<span class="pln">commit</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pln">REPOS<span class="pun">=<span class="str">"$1"<span class="pln">                  <span class="com">#传参（未用上）</span></span></span></span></span></code></li>
<li class="L9"><code><span class="pln">REV<span class="pun">=<span class="str">"$2"<span class="pln">                    <span class="com">#传参（未用上）</span></span></span></span></span></code></li>
<li class="L0"><code><span class="typ">SvnIP<span class="pun">=<span class="str">"192.168.200.69"<span class="pln">       <span class="com">#svn服务端的IP地址</span></span></span></span></span></code></li>
<li class="L1"><code><span class="typ">ProjectName<span class="pun">=<span class="str">"yunjisuan"<span class="pln">     <span class="com">#svn服务端的项目库名称</span></span></span></span></span></code></li>
<li class="L2"><code><span class="typ">UserName<span class="pun">=<span class="str">"yunjisuan"<span class="pln">        <span class="com">#账户姓名</span></span></span></span></span></code></li>
<li class="L3"><code><span class="typ">PassWord<span class="pun">=<span class="str">"123123"<span class="pln">           <span class="com">#账户密码</span></span></span></span></span></code></li>
<li class="L4"><code><span class="typ">LocalPath<span class="pun">=<span class="str">"/data/www"<span class="pln">       <span class="com">#位于svn本地的共享目录</span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">SVN<span class="pun">=<span class="str">/usr/<span class="pln">bin<span class="pun">/<span class="pln">svn            <span class="com">#svn命令的绝对路径</span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="kwd">export<span class="pln"> LC_CTYPE<span class="pun">=<span class="str">"en_US.UTF-8"<span class="pln">   <span class="com">#中文字符集支持</span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="kwd">export<span class="pln"> LC_ALL<span class="pun">=</span></span></span></code></li>
<li class="L8"><code><span class="kwd">if<span class="pln"> <span class="pun">[<span class="pln"> <span class="pun">!<span class="pln"> <span class="pun">-<span class="pln">d $<span class="pun">{<span class="typ">LocalPath<span class="pun">}<span class="pln"> <span class="pun">];<span class="kwd">then</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pln">	mkdir <span class="pun">-<span class="pln">p $<span class="pun">{<span class="typ">LocalPaht<span class="pun">}</span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pln">    $SVN checkout svn<span class="pun">:<span class="com">//${SvnIP}/${ProjectName} ${LocalPath} --username=${UserName} --password=${PassWord}       #新创建目录需要先经过checkout才能update</span></span></span></code></li>
<li class="L1"><code><span class="kwd">else</span></code></li>
<li class="L2"><code><span class="pln">    $SVN update <span class="pun">--<span class="pln">username yunjisuan <span class="pun">--<span class="pln">password <span class="lit">123123<span class="pln"> <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www        <span class="com">#更新共享目录内容</span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="kwd">fi</span></code></li>
<li class="L4"><code><span class="kwd">if<span class="pln"> <span class="pun">[<span class="pln"> $<span class="pun">?<span class="pln"> <span class="pun">-<span class="pln">eq <span class="lit">0<span class="pln"> <span class="pun">];<span class="kwd">then</span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">    <span class="pun">/<span class="pln">usr<span class="pun">/<span class="pln">bin<span class="pun">/<span class="pln">rsync <span class="pun">-<span class="pln">az <span class="pun">--<span class="kwd">delete<span class="pln"> <span class="str">/data/<span class="pln">www <span class="pun">/<span class="pln">tmp<span class="pun">/<span class="pln">         <span class="com">#数据同步推送到本地/tmp目录下（生产环境可以直接同步推送到Web测试服务器）</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="kwd">fi</span></code></li>

</ol>
<div class="md-section-divider">&nbsp;</div>
<h4 id="4进行钩子脚本同步测试" data-anchor-id="glf3">（4）进行钩子脚本同步测试</h4>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="com">#删除之前的测试记录</span></code></li>
<li class="L1"><code><span class="pun">[<span class="pln">root@localhost hooks<span class="pun">]#<span class="pln"> rm <span class="pun">-<span class="pln">rf <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pun">[<span class="pln">root@localhost hooks<span class="pun">]#<span class="pln"> ll <span class="pun">-<span class="pln">d <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www</span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">ls<span class="pun">:<span class="pln"> cannot access <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">:<span class="pln"> <span class="typ">No<span class="pln"> such file <span class="kwd">or<span class="pln"> directory</span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pun">[<span class="pln">root@localhost hooks<span class="pun">]#<span class="pln"> rm <span class="pun">-<span class="pln">rf <span class="pun">/<span class="pln">tmp<span class="com">/*</span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="com">[root@localhost hooks]# ll /tmp/</span></code></li>
<li class="L6"><code><span class="com">total 0</span></code></li>
<li class="L7"><code><span class="com">[root@localhost hooks]# chmod 700 post-commit   #给钩子脚本可执行权限</span></code></li>

</ol>
<div class="md-section-divider">&nbsp;</div>
<h4 id="特别提示-2" data-anchor-id="yvh5">特别提示</h4>
<blockquote class="white-blockquote" data-anchor-id="947y">
<p>当用户通过svn更新钩子post-commit所在的项目库时，在更新完毕之后会自动触发钩子脚本</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h4 id="模拟更新项目库版本" data-anchor-id="9gci">模拟更新项目库版本</h4>
<p data-anchor-id="mm8u"><img title="" src="http://static.zybuluo.com/WBQ729/1lqcisbrs1ab4aq89zhaxc1q/image_1crjndtsv1ld9jru1lnc1tq517pk6v.png" alt="image_1crjndtsv1ld9jru1lnc1tq517pk6v.png-46.1kB" /></p>
<hr />
<p data-anchor-id="1op1"><img title="" src="http://static.zybuluo.com/WBQ729/bk67im0sx1u9o5k680vxnhll/image_1crjne5m61gah1d0j3e711od16av7c.png" alt="image_1crjne5m61gah1d0j3e711od16av7c.png-37.7kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="查看svn服务器端钩子脚本执行情况" data-anchor-id="3pek">查看svn服务器端钩子脚本执行情况</h4>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pun">[<span class="pln">root@localhost hooks<span class="pun">]#<span class="pln"> ll <span class="pun">/<span class="pln">data<span class="pun">/<span class="pln">www<span class="pun">/<span class="pln">                   <span class="com">#svn服务器端本地共享目录</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pln">total <span class="lit">28</span></span></code></li>
<li class="L2"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">111</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">112</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">113</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">116</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">117</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">118</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pun">-<span class="pln">rw<span class="pun">-<span class="pln">r<span class="pun">--<span class="pln">r<span class="pun">--.<span class="pln"> <span class="lit">1<span class="pln"> root root    <span class="lit">0<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> test<span class="pun">.<span class="pln">txt</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pun">-<span class="pln">rw<span class="pun">-<span class="pln">r<span class="pun">--<span class="pln">r<span class="pun">--.<span class="pln"> <span class="lit">1<span class="pln"> root root    <span class="lit">9<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> xxx<span class="pun">.<span class="pln">txt</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pun">-<span class="pln">rw<span class="pun">-<span class="pln">r<span class="pun">--<span class="pln">r<span class="pun">--.<span class="pln"> <span class="lit">1<span class="pln"> root root    <span class="lit">0<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> xxxx</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">[<span class="pln">root@localhost hooks<span class="pun">]#<span class="pln"> ll <span class="pun">/<span class="pln">tmp<span class="pun">/<span class="pln">www<span class="pun">/<span class="pln">                    <span class="com">#推送后的数据目录</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code><span class="pln">total <span class="lit">28</span></span></code></li>
<li class="L3"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">111</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">112</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">113</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">116</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">117</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pln">drwxr<span class="pun">-<span class="pln">xr<span class="pun">-<span class="pln">x<span class="pun">.<span class="pln"> <span class="lit">3<span class="pln"> root root <span class="lit">4096<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> <span class="lit">118</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pun">-<span class="pln">rw<span class="pun">-<span class="pln">r<span class="pun">--<span class="pln">r<span class="pun">--.<span class="pln"> <span class="lit">1<span class="pln"> root root    <span class="lit">0<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> test<span class="pun">.<span class="pln">txt</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pun">-<span class="pln">rw<span class="pun">-<span class="pln">r<span class="pun">--<span class="pln">r<span class="pun">--.<span class="pln"> <span class="lit">1<span class="pln"> root root    <span class="lit">9<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> xxx<span class="pun">.<span class="pln">txt</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">-<span class="pln">rw<span class="pun">-<span class="pln">r<span class="pun">--<span class="pln">r<span class="pun">--.<span class="pln"> <span class="lit">1<span class="pln"> root root    <span class="lit">0<span class="pln"> <span class="typ">Sep<span class="pln"> <span class="lit">13<span class="pln"> <span class="lit">23<span class="pun">:<span class="lit">07<span class="pln"> xxxx</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L2"><code></code></li>
<li class="L3"><code><span class="pun">&gt;<span class="pln"> <span class="pun">综上，<span class="pln">post<span class="pun">-<span class="pln">commit<span class="pun">钩子脚本测试成功。</span></span></span></span></span></span></span></code></li>

</ol>
<div class="md-section-divider">&nbsp;</div>
<h3 id="442-通过pre-commit的钩子脚本还可以对用户上传的内容进行大小和扩展名的限制" data-anchor-id="ernu">4.4.2 通过pre-commit的钩子脚本还可以对用户上传的内容进行大小和扩展名的限制</h3>
<blockquote class="white-blockquote" data-anchor-id="rb0e">
<p>因为并不常用，这部分内容，我们略过</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h1 id="第5章-大中小型企业上线解决方案" data-anchor-id="mspn">第5章 大中小型企业上线解决方案</h1>
<div class="md-section-divider">&nbsp;</div>
<h2 id="51-svn-上线解决方案说明" data-anchor-id="sgwv">5.1 SVN 上线解决方案说明</h2>
<div class="md-section-divider">&nbsp;</div>
<h3 id="511-小型公司代码上线案例十几台服务器" data-anchor-id="yzsy">5.1.1 小型公司代码上线案例（十几台服务器）</h3>
<p data-anchor-id="fjsd"><img title="" src="http://static.zybuluo.com/WBQ729/8eeuce3c68bvsm1piswjk9lk/image_1crjnfpf41l2a1ces5at1j741bi67p.png" alt="image_1crjnfpf41l2a1ces5at1j741bi67p.png-163.1kB" /></p>
<blockquote class="white-blockquote" data-anchor-id="kwuj">
<p>开发每次修改完代码就直接提交，然后通过FTP直接更新到Web服务器网页目录；没有专门的测试人员，完全是由用户来进行测试体验。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="小型企业现状" data-anchor-id="05ke">小型企业现状</h3>
<blockquote class="white-blockquote" data-anchor-id="dg1q">
<p>小型公司一般只有几个开发人员，网站核心程序大多数都是PHP语言开发，为了方便，会直接通过FTP直接上传程序代码到线上服务器，随时随地上线更新。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="上述上线方案的特点和问题" data-anchor-id="no0v">上述上线方案的特点和问题</h3>
<blockquote class="white-blockquote" data-anchor-id="840a"><ol>
<li>
<p>发布快，及时，随时随地就可以发布代码。</p>

</li>
<li>
<p>开发人员发布的代码不经过测试人员的测试，且用户访问页面刷新后页面即改变，也可能刷新瞬间程序在更新，到时无法访问，对网站用户的体验比较差，如果开发写错了代码，造成的影响就更大了，这是拿用户作为测试的上线方案。</p>

</li>
<li>
<p>据统计，网站中大概50%以上的故障是和开发程序代码有关的，（比如：开发写错了一个循环代码，导致了死循环，此时大量用户访问这个程序，就能把服务器资源耗尽，搞死服务器）</p>

</li>
<li>
<p>在中小公司网站出了问题一般是运维人员的问题（例如网站宕机），但这种情况下，问题大多可能由开发人员或代码引起的，这里比较好的策略是开发项目负责制思想。</p>

</li>

</ol></blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="小型企业上线架构方案建议" data-anchor-id="a48w">小型企业上线架构方案建议</h3>
<blockquote class="white-blockquote" data-anchor-id="orqs"><ol>
<li>
<p>开发人员需在个人电脑搭建LAMP环境测试开发好的网站代码，并且在办公室或IDC机房的测试环境测试通过，最好有专职测试人员。</p>

</li>
<li>
<p>程序代码上线规定时间，例如，三天上线一次，如网站需经常更新可每天下午17点上线，这个看网站业务性质而定，原则就是影响用户体验最小。</p>

</li>
<li>
<p>代码上线之前需备份，网站程序出了问题方便回退，另外，网站程序出了问题方便回退，另外，从上线技巧上讲，上传代码时尽可能先传到服务器网站临时目录，传完整后一步mv过去，或者通过ln做软连接。（线上更新代码思路）</p>

</li>
<li>
<p>务必由运维人员管理上线，对于代码的功能性，开发人员更在意，而对于代码的性能和服务的稳定，运维更在意，因此，如果网站问题归运维管，就要让运维上线这样更规范科学。否则，开发随意更新，出了问题运维负责，这样就错了。</p>

</li>

</ol></blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="512-中型企业上线解决方案" data-anchor-id="v5c2">5.1.2 中型企业上线解决方案</h3>
<blockquote class="white-blockquote" data-anchor-id="4lym">
<p>中型企业上线，一般是规范运维人员操作步骤，制定统一的上线操作脚本，备份文件名称，备份文件路径。使操作人性化，统一化，自动化。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="web代码的上线流程演示图" data-anchor-id="v203">Web代码的上线流程演示图</h3>
<p data-anchor-id="vkzr"><img title="" src="http://static.zybuluo.com/WBQ729/e62jmady3pdrtuijjhf0d9ty/image_1crjniail1gdttrp1ptoi2svq886.png" alt="image_1crjniail1gdttrp1ptoi2svq886.png-38.6kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h3 id="513-大型企业上线解决方案" data-anchor-id="a38v">5.1.3 大型企业上线解决方案</h3>
<blockquote class="white-blockquote" data-anchor-id="z4te">
<p>大型企业上线一般制度和流程控制较多，比较严谨，下面是某大型企业上线解决方案架构：</p>

</blockquote>
<p data-anchor-id="qqzp"><img title="" src="http://static.zybuluo.com/linyaonie/eb7g6e4u90k2g8jem6hz27ae/image_1d9jh8btrni1io811qu1so71glc1c.png" alt="image_1d9jh8btrni1io811qu1so71glc1c.png-502.8kB" /></p>
<blockquote class="white-blockquote" data-anchor-id="psns">
<p>SVN里的内容：<span class="Apple-converted-space">&nbsp;<br />1，程序代码<span class="Apple-converted-space">&nbsp;<br />2，服务的配置<span class="Apple-converted-space">&nbsp;<br />3，项目文档，设计文档，运维部署优化文档</span></span></span></p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="门户大型网站架构环境代码上线具体方案" data-anchor-id="shar">门户大型网站架构环境代码上线具体方案</h3>
<blockquote class="white-blockquote" data-anchor-id="39lz"><ol>
<li>
<p>本地开发人员从SVN中取代码。当天上线的提交到trunk，否则，长期项目单开分支开发，然后在合并主线（trunk）</p>

</li>
<li>
<p>办公内网开发测试时，由开发人员或配置管理员通过部署平台jenkins实现统一部署，（即在部署平台上控制开发机器从SVN取代码，编译，打包，发布到开发机器，包名如idc_dep.war）</p>

</li>
<li>
<p>开发人员通知或和测试人员一起测试程序，没有问题后，打上新的tag标记。</p>

</li>
<li>
<p>配置管理员，根据上步的tag标记，checkout出上线代码，并配置好IDC测试环境的所有配置，执行编译，打包（mvn，ant）（php不需要），然后发布到IDC内的统一分发服务器，这里要注意，不同环境的配置文件是随代码同时发布的。</p>

</li>
<li>
<p>配置管理员或SA上线人员，把分发的程序代码内容推送到相关测试服务器（包名如idc_test.war）,然后通知开发及测试人员进行测试。如果有问题向上回退，继续修改。</p>

</li>
<li>
<p>如果测试没有问题，继续打好tag标记，此时，配置管理员，根据上步的tag标记，checkout出测试好的代码，并配置好IDC正式环境的所有配置，执行编译，打包（mvn，ant）（php不需要），然后发布到IDC内的统一分发服务器主机，准备批量发布。</p>

</li>
<li>
<p>配置管理员或SA上线人员，把分发的内容推送到相关正式服务器（包名如idc_product.war），然后通知开发及测试人员进行测试。如果有问题直接发布回滚指令。</p>

</li>

</ol>
<p>IDC正式上线的过程对于JAVA程序，可以是AB分组上线的思路，即平滑下线一半的服务器，然后发布更新代码测试，无问题后，挂上服务器，同时在平滑下线另一半的服务器，然后发布更新代码测试（或者直接发布后就挂上线）</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="php程序代码上线的具体方案" data-anchor-id="zxgh">PHP程序代码上线的具体方案</h3>
<blockquote class="white-blockquote" data-anchor-id="8d2h">
<p>对于PHP上线方法：发布代码时（也需要测试流程）可以直接发布到正式线临时目录，然后mv或更改link的方式发布到正式线目录，不需要重启http服务。这是sina，ganji的上线方案。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="java程序代码上线的具体方案" data-anchor-id="wv4j">JAVA程序代码上线的具体方案</h3>
<blockquote class="white-blockquote" data-anchor-id="4u32">
<p>对于java上线方法：较大公司需要分组平滑上线，例如，首先从负载均衡器上摘掉一半的服务器，发布代码后，重启服务器测试，没问题后，挂上经过测试的这一半，再下另外一半。如果前端有DNS智能解析，上线还可以分地区上线若干服务器，逐渐普及到全国的服务器，这个被称为灰度发布。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h3 id="514-更多大型代码上线解决方案案例" data-anchor-id="bzfq">5.1.4 更多大型代码上线解决方案案例</h3>
<div class="md-section-divider">&nbsp;</div>
<h4 id="sina网的代码发布流程逻辑图" data-anchor-id="2pir">SINA网的代码发布流程逻辑图</h4>
<p data-anchor-id="41b8"><img title="" src="http://static.zybuluo.com/WBQ729/in5e2x7ytvv35pvixn5tyhln/image_1crjnlp8b13ch1o9i1n6rj3sgb9g.png" alt="image_1crjnlp8b13ch1o9i1n6rj3sgb9g.png-73kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="2和讯案例" data-anchor-id="v2ll">（2）和讯案例</h4>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">ABCD <span class="lit">12<span class="pun">:<span class="lit">33<span class="pun">:<span class="lit">24</span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">我们这里代码发布都不太标准，全部都是开发自己搞</span></code></li>
<li class="L2"><code><span class="typ">Mr<span class="pun">.<span class="pln">chen <span class="lit">12<span class="pun">：<span class="lit">35<span class="pun">：<span class="lit">14</span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pun">目前是什么个方式呢</span></code></li>
<li class="L4"><code><span class="pun">说下现状即可。</span></code></li>
<li class="L5"><code><span class="pln">ABCD <span class="lit">12<span class="pun">:<span class="lit">36<span class="pun">:<span class="lit">04</span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pun">就是很传统，开发有权限可以上机器，我们就把应用部署好，他们随便折腾。</span></code></li>
<li class="L7"><code><span class="pln">ABCD <span class="lit">12<span class="pun">:<span class="lit">41<span class="pun">:<span class="lit">05</span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pun">源代码是<span class="pln">svn<span class="pun">，静态内容都是同步分发</span></span></span></code></li>

</ol>
<div class="md-section-divider">&nbsp;</div>
<h4 id="3小米案例" data-anchor-id="lx9e">（3）小米案例</h4>
<div class="md-section-divider">&nbsp;</div>
<ol class="linenums">
<li class="L0"><code><span class="pln">XYZ <span class="lit">13<span class="pun">:<span class="lit">36<span class="pun">:<span class="lit">49</span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">代码上线都是开发上，我们运维这边没有流程...如果代码发布导致了问题，就是开发的问题。</span></code></li>
<li class="L2"><code><span class="pln">XYZ <span class="lit">13<span class="pun">:<span class="lit">37<span class="pun">:<span class="lit">55</span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pun">服务器上面有一个客户端，开发自己在页面上点发布，客户端就去拉代码了。</span></code></li>
<li class="L4"><code><span class="pun">就是这么个额流程，就像你以前说的，项目责任制，谁的项目出问题了。找开发和运维</span></code></li>
<li class="L5"><code><span class="typ">Mr<span class="pun">.<span class="pln">chen <span class="lit">13<span class="pun">:<span class="lit">49<span class="pun">:<span class="lit">08</span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code><span class="pun">不需要重启服务器么？还有直接拉到站点目录么？</span></code></li>
<li class="L7"><code><span class="pln">XYZ <span class="lit">13<span class="pun">:<span class="lit">49<span class="pun">:<span class="lit">17</span></span></span></span></span></span></code></li>
<li class="L8"><code><span class="pun">嗯，都是自动的</span></code></li>
<li class="L9"><code><span class="pun">他们有个管理系统</span></code></li>
<li class="L0"><code><span class="typ">Mr<span class="pun">.<span class="pln">chen <span class="lit">13<span class="pun">:<span class="lit">49<span class="pun">:<span class="lit">49</span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">如何保证不影响用户呢？</span></code></li>
<li class="L2"><code><span class="pun">还有怎么回滚的。</span></code></li>
<li class="L3"><code><span class="pln">XYZ <span class="lit">13<span class="pun">:<span class="lit">50<span class="pun">:<span class="lit">12</span></span></span></span></span></span></code></li>
<li class="L4"><code><span class="pun">还没有做到这点把</span></code></li>
<li class="L5"><code><span class="pun">那个管理系统可以回滚的，好像</span></code></li>
<li class="L6"><code><span class="pun">平时把客户的部署上去，再把机器加入到那个系统中</span></code></li>
<li class="L7"><code><span class="pun">他们就可以发了。</span></code></li>
<li class="L8"><code><span class="pln">XYZ <span class="lit">13<span class="pun">:<span class="lit">58<span class="pun">:<span class="lit">16</span></span></span></span></span></span></code></li>
<li class="L9"><code><span class="pun">运维这边就管添加机器和安装客户端，也有发布权限，项目上线后很少发。一教就会没有在这块搞过太多，那个程序和版本管理结合的。实现原理应该就是客户端收到服务器发来的<span class="pln">clone<span class="pun">命令和路径，就去执行了。</span></span></span></code></li>

</ol>
<div class="md-section-divider">&nbsp;</div>
<h4 id="什么是配置管理员呢" data-anchor-id="jmo8">什么是配置管理员呢</h4>
<blockquote class="white-blockquote" data-anchor-id="v31i">
<p>就是在开发和运维中间起一个连接纽带的一个职位，这个职位一般在大公司里会设置，负责SVN的管理，上线管理，申请，协调等工作。</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="52-自动化部署和上线代码管理" data-anchor-id="k2mr">5.2 自动化部署和上线代码管理</h2>
<blockquote class="white-blockquote" data-anchor-id="w591">
<p>对于门户网站或重视规范或开发能力较强的公司也许会结合系统服务和WEB界面管理来更科学更自动的进行上线代码管理，如开发一个自动化代码上线部署平台，其实就是一个web管理界面（界面底层调用相关脚本实现分发推送代码以及重启服务器），然后普通的初级上线人员就可以在平台里实现仅仅点鼠标，敲回车，就能实现平滑上线和平滑回滚代码了，当然，自动化和完善的程度也许没我们说的这么好，但是，思路是这样的。下面就是管理平台的一个图例：</p>

</blockquote>
<p data-anchor-id="x7ef"><img title="" src="http://static.zybuluo.com/WBQ729/aszghy2qkfsxf9eh1v52h0xu/image_1crjnn859g1a13evhv7dia18sjad.png" alt="image_1crjnn859g1a13evhv7dia18sjad.png-102.1kB" /></p>
<div class="md-section-divider">&nbsp;</div>
<h4 id="开发自动化部署平台的思路很多例如我们可以通过nagios的被动模式实现上线管理平台原理思路" data-anchor-id="jz10">开发自动化部署平台的思路很多，例如：我们可以通过nagios的被动模式实现上线管理平台原理思路</h4>
<blockquote class="white-blockquote" data-anchor-id="jnbk">
<p>实际上就是生成配置在分发服务器上执行命令请求，应用服务器，然后脚本在应用服务器处理完毕后回传结果到web界面显示：</p>
<p>例如：check_nrpe -h 10.0.0.178 -c check_load</p>

</blockquote>
<div class="md-section-divider">&nbsp;</div>
<h2 id="53-开发人员和运维人员业务变更管理平台" data-anchor-id="i3xi">5.3 开发人员和运维人员业务变更管理平台</h2>
<div class="md-section-divider">&nbsp;</div>
<h4 id="业务变更管理平台优点" data-anchor-id="lj37">业务变更管理平台优点</h4>
<blockquote class="white-blockquote" data-anchor-id="dq2y">
<p>(1)变更管理制度流程有利于业务稳定。</p>
<p>(2)保留变更业务历史，便于核查发现的问题。</p>
<p>(3)故障跟踪平台，有利于跟踪问题的解决进度，而不是半途而废。</p>
<p>(4)相关常用软件（有时间最好研究一下）<span class="Apple-converted-space">&nbsp;<br />JIRA 用于缺陷跟踪，客户服务，需求收集，流程审批，任务跟踪，项目跟踪和敏捷管理等工作领域。<span class="Apple-converted-space">&nbsp;<br />Mantis是一款PHP开源Bug跟踪系统，比较适合中小型项目的管理及跟踪，具有多特性。包括：易于安装，易于操作，基于Web，支持任何可运行PHP的平台（Windows，Linux，Mac，Solaris，AS400/i5等），已经被翻译成68种语言，支持多个项目，为每一个项目设置不同的用户访问级别，跟踪缺陷变更历史，定制我的视图页面，提供全文搜索功能，内置报表生成功能（包括图形报表），通过Email报告缺陷，用户可以监视特殊的Bug，附件可以保存在web服务器上或数据库中（还可以备份到FTP服务器上），自定义缺陷处理工作流，支持输出格式包括csv，MicrosoftExcel，MicrosoftWord，集成源代码控制（SVN与CVS），集成wiki知识库与聊天工具（可选/可不选），支持多种数据库（MySQL，MSSQL，PostgreSQ，Oracle，DB2），提供WebService（SOAP）接口，提供Wap访问。</span></span></p>

</blockquote>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
		</div>
		<div class="postDesc">posted @ 
<span id="post-date">2019-07-24 15:27</span>&nbsp;
<a href="https://www.cnblogs.com/linyaonie/">林妖孽</a>&nbsp;
阅读(<span id="post_view_count">...</span>)&nbsp;
评论(<span id="post_comment_count">...</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=11238272" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(11238272);return false;">收藏</a></div>
	</div>
	
	
</div><!--end: topics 文章、评论容器-->
<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 469064, cb_blogApp = 'linyaonie', cb_blogUserGuid = 'aa27bda3-fa9b-4bcc-8953-08d61efd54a3';
    var cb_entryId = 11238272, cb_entryCreatedDate = '2019-07-24 15:27', cb_postType = 1; 
    loadViewCount(cb_entryId);
    loadSideColumnAd();
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>

<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
    </script>
    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot("/1090369/C1", [300, 250], "div-gpt-ad-1546353474406-0").addService(googletag.pubads());
            googletag.defineSlot("/1090369/C2", [468, 60], "div-gpt-ad-1539008685004-0").addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;"></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;"></div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);        deliverAdT2();
        deliverAdC1();
        deliverAdC2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div></div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>

<div id="sidebar_ad"></div>
			<div id="calendar"><div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script></div>
			
			<DIV id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
			</DIV>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright &copy; 2020 林妖孽
<br /><span id="poweredby">Powered by .NET Core on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    
</body>
</html>
