<!DOCTYPE html>
<!-- saved from url=(0078)http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus -->
<html lang="en" dir="ltr" class="client-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>A simple design with Wishbone bus - ArmadeusWiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"A_simple_design_with_Wishbone_bus","wgTitle":"A simple design with Wishbone bus","wgCurRevisionId":12025,"wgRevisionId":12025,"wgArticleId":1695,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["FPGA"],"wgBreakFrames":!1,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"A_simple_design_with_Wishbone_bus","wgRelevantArticleId":1695,"wgIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],"egMapsDebugJS":!1,"egMapsAvailableServices":[
"googlemaps3","openlayers","leaflet"],"wgWikiEditorEnabledModules":{"toolbar":!1,"dialogs":!1,"preview":!1,"publish":!1},"wgCategoryTreePageCategoryOptions":"{\"mode\":0,\"hideprefix\":20,\"showcount\":true,\"namespaces\":false}"});mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits"]);
} );</script>
<link rel="stylesheet" href="./A simple design with Wishbone bus - ArmadeusWiki_files/load.php">
<!--[if IE 6]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]-->
<style>
.mw-collapsible-toggle{float:right;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}  .mw-content-ltr .mw-collapsible-toggle,.mw-content-rtl .mw-content-ltr .mw-collapsible-toggle{float:right} .mw-content-rtl .mw-collapsible-toggle,.mw-content-ltr .mw-content-rtl .mw-collapsible-toggle{float:left}.mw-customtoggle,.mw-collapsible-toggle{cursor:pointer} caption .mw-collapsible-toggle,.mw-content-ltr caption .mw-collapsible-toggle,.mw-content-rtl caption .mw-collapsible-toggle,.mw-content-rtl .mw-content-ltr caption .mw-collapsible-toggle,.mw-content-ltr .mw-content-rtl caption .mw-collapsible-toggle{float:none} li .mw-collapsible-toggle,.mw-content-ltr li .mw-collapsible-toggle,.mw-content-rtl li .mw-collapsible-toggle,.mw-content-rtl .mw-content-ltr li .mw-collapsible-toggle,.mw-content-ltr .mw-content-rtl li .mw-collapsible-toggle{float:none} .mw-collapsible-toggle-li{list-style:none}
.suggestions{overflow:hidden;position:absolute;top:0;left:0;width:0;border:none;z-index:1099;padding:0;margin:-1px 0 0 0}.suggestions-special{position:relative;background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0;margin-top:-2px;display:none;padding:0.25em 0.25em;line-height:1.25em}.suggestions-results{background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0}.suggestions-result{color:black;margin:0;line-height:1.5em;padding:0.01em 0.25em;text-align:left; overflow:hidden;-o-text-overflow:ellipsis; text-overflow:ellipsis;white-space:nowrap}.suggestions-result-current{background-color:#4C59A6;color:white}.suggestions-special .special-label{color:gray;text-align:left}.suggestions-special .special-query{color:black;font-style:italic;text-align:left}.suggestions-special .special-hover{background-color:silver}.suggestions-result-current .special-label,.suggestions-result-current .special-query{color:white}.highlight{font-weight:bold}
# Style for APF bash scripts:pre tags with class "apf" pre.apf{background-color:black;color:grey;font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace}
.postedit-container{margin:0 auto;position:fixed;top:0;height:0;left:50%;z-index:1000;font-size:13px}.postedit-container:hover{cursor:pointer}.postedit{position:relative;top:0.6em;left:-50%;padding:.6em 3.6em .6em 1.1em;line-height:1.5625em;color:#626465;background-color:#f4f4f4;border:1px solid #dcd9d9;text-shadow:0 0.0625em 0 rgba(255,255,255,0.5);border-radius:5px;box-shadow:0 2px 5px 0 #ccc;-webkit-transition:all 0.25s ease-in-out;-moz-transition:all 0.25s ease-in-out;-ms-transition:all 0.25s ease-in-out;-o-transition:all 0.25s ease-in-out;transition:all 0.25s ease-in-out}.skin-monobook .postedit{top:6em !important}.postedit-faded{opacity:0}.postedit-icon{padding-left:41px;  line-height:25px;background-repeat:no-repeat;background-position:8px 50%}.postedit-icon-checkmark{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABblBMVEUAAAD///////9PfTf///80aRdTgjn///9Feij///////////9Rfzf///////////9PfjZRgDh1o1xOfTb///////+bwYqLtnj///////9PfTa82K////9WhT6YxIL///9QgDdTgzr////////j7uDl7eLq8efi693k7OH///////9UhjuBr2rp9uRUhjr///9YljVKgir///9WiTlYjT3////9/v57vFlbkT5PjC9dlD/5/fhuq09stUTs9uhxuElctCpfnT1huDFloEZloUZmpENmvDZpvDxpvTxqvjxrvT5rvT9rwTxsqktswD5uwkBvuUdxw0NztFBztU9ztVBzwkp0tlJ1xkd2t1R3uVR4w1F4xk54x014yE15uVZ5v1R5xVB6v1R7yFJ8wVh9xVl9yFR9yVd9ylN+xVh+yFd/x1l/yFeAylmEx1+Ny2uY0Hqe04Wj1Ymv3Ze33qLD47TJ5L3O6cPU7Mrq9eb2+/Q4j37OAAAAQHRSTlMAAQIEBAUFBQwPFB4fJCUoKiosQEhJS01RUlZZXmdydXaChYuSlJSWmJmoq6uur8LExcvM19fg5ejt8fX2+Pr7SljgewAAAKpJREFUGBkFwQNCAwAAAMDLtl3LtrG4rWXbtvX77gAgZ6grFwC0bhwNVgKgdPZx8b0dgLi+s7Wn0VoAqpfOI9+BNADZI7fLrz2pSEwGHZuH+78lSK8ZLkLezF3ooyUG3VPXq2USei9WngeyoG195yBYWDF3E/2pAhl1e9Gr8bGT+bfOFCC2fnvh4X7rcqIAQNNu+HT6sxkAjceTL/2ZAIhv+PorBwBJxfkA//dFHSCBy/UTAAAAAElFTkSuQmCC);background-image:url(http://www.armadeus.org/wiki/resources/src/mediawiki.action/images/green-checkmark.png?9048a)!ie;background-position:left}.postedit-close{position:absolute;padding:0 .8em;right:0;top:0;font-size:1.25em;font-weight:bold;line-height:2.3em;color:black;text-shadow:0 0.0625em 0 white;text-decoration:none;opacity:0.2;filter:alpha(opacity=20)}.postedit-close:hover{color:black;text-decoration:none;opacity:0.4;filter:alpha(opacity=40)}</style><style>
.suggestions a.mw-searchSuggest-link,.suggestions a.mw-searchSuggest-link:hover,.suggestions a.mw-searchSuggest-link:active,.suggestions a.mw-searchSuggest-link:focus{color:black;text-decoration:none}.suggestions-result-current a.mw-searchSuggest-link,.suggestions-result-current a.mw-searchSuggest-link:hover,.suggestions-result-current a.mw-searchSuggest-link:active,.suggestions-result-current a.mw-searchSuggest-link:focus{color:white}.suggestions a.mw-searchSuggest-link .special-query{ overflow:hidden;-o-text-overflow:ellipsis; text-overflow:ellipsis;white-space:nowrap}</style><meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="./A simple design with Wishbone bus - ArmadeusWiki_files/load(1).php">
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}</style>
<script async="" src="./A simple design with Wishbone bus - ArmadeusWiki_files/load(2).php"></script>
<meta name="generator" content="MediaWiki 1.26.3">
<link rel="shortcut icon" href="http://www.armadeus.org/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="http://www.armadeus.org/wiki/opensearch_desc.php" title="ArmadeusWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="http://www.armadeus.org/wiki/api.php?action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArmadeusWiki Atom feed" href="http://www.armadeus.org/wiki/index.php?title=Special:RecentChanges&amp;feed=atom">
<script src="./A simple design with Wishbone bus - ArmadeusWiki_files/load(3).php"></script></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-A_simple_design_with_Wishbone_bus skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">A simple design with Wishbone bus</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From ArmadeusWiki</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#column-one">navigation</a>, <a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p><br>
This article is intended to explain how to design Wishbone compatible components with simple example. 
The VHDL source code can be found in firmware/wishbone_example from  <a rel="nofollow" class="external text" href="http://sourceforge.net/p/armadeus/code">our sourceforge GIT repository</a>.
</p><p>Description of the Wishbone structure for Armadeus APF boards can be found <a href="http://www.armadeus.org/wiki/index.php?title=FpgaArchitecture#Le_bus_Wishbone" title="FpgaArchitecture"> here</a> (in french).
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2><span class="toctoggle">&nbsp;[<a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#" id="togglelink">hide</a>]&nbsp;</span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#General_structure"><span class="tocnumber">1</span> <span class="toctext">General structure</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Wrapper"><span class="tocnumber">1.1</span> <span class="toctext">Wrapper</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Intercon"><span class="tocnumber">1.2</span> <span class="toctext">Intercon</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Wishbone_slave_application_components"><span class="tocnumber">2</span> <span class="toctext">Wishbone slave application components</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#irq_manager"><span class="tocnumber">2.1</span> <span class="toctext">irq manager</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#wb_led"><span class="tocnumber">2.2</span> <span class="toctext">wb_led</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#wb_button"><span class="tocnumber">2.3</span> <span class="toctext">wb_button</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Components_drivers"><span class="tocnumber">3</span> <span class="toctext">Components drivers</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#irq_manager_2"><span class="tocnumber">3.1</span> <span class="toctext">irq manager</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#LED"><span class="tocnumber">3.2</span> <span class="toctext">LED</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#button"><span class="tocnumber">3.3</span> <span class="toctext">button</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Using_the_design"><span class="tocnumber">4</span> <span class="toctext">Using the design</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Make_the_FPGA_bitstream"><span class="tocnumber">4.1</span> <span class="toctext">Make the FPGA bitstream</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Compile_Linux_drivers"><span class="tocnumber">4.2</span> <span class="toctext">Compile Linux drivers</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Play_with_button_and_LED"><span class="tocnumber">4.3</span> <span class="toctext">Play with button and LED</span></a>
<ul>
<li class="toclevel-3 tocsection-16"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Load_modules"><span class="tocnumber">4.3.1</span> <span class="toctext">Load modules</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Device_access"><span class="tocnumber">4.3.2</span> <span class="toctext">Device access</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Test_LED"><span class="tocnumber">4.3.3</span> <span class="toctext">Test LED</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Test_Button"><span class="tocnumber">4.3.4</span> <span class="toctext">Test Button</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus#Switching_LED_with_button"><span class="tocnumber">4.3.5</span> <span class="toctext">Switching LED with button</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="General_structure">General structure</span></h2>
<p>The main functionality of this component is to allow to switch-on a LED when a button is pressed.
</p><p>When button is pressed, the component <i>button</i> send interrupt signal to
<i>irq_mngr</i>. <i>irq_mngr</i> will toggle a flag and send interruption to
<b>i.MX</b> processor. A Linux driver on <b>i.MX</b> will read <i>irq_mngr</i> and
acknowledge irq by writing '1' on the corresponding register. And finally, Linux driver will
toggle LED value by writing in <i>led</i> register.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:702px;"><a href="http://www.armadeus.org/wiki/index.php?title=File:Wb_buttonled_top.png" class="image"><img alt="" src="./A simple design with Wishbone bus - ArmadeusWiki_files/700px-Wb_buttonled_top.png" width="700" height="351" class="thumbimage" srcset="/wiki/images/thumb/7/7e/Wb_buttonled_top.png/1050px-Wb_buttonled_top.png 1.5x, /wiki/images/7/7e/Wb_buttonled_top.png 2x"></a>  <div class="thumbcaption"><div class="magnify"><a href="http://www.armadeus.org/wiki/index.php?title=File:Wb_buttonled_top.png" class="internal" title="Enlarge"></a></div><b>figure 1</b> - <i>Schematics of wishbone example. /!\ Bus signals are wrong for the APF51 because addr and data are multiplexed.</i></div></div></div></div>
<p><i>imx_wrapper</i>, <i>syscon</i> and <i>irq_mngr</i> are standards
ARMadeus-Wishbone IPs that just been instantiated in our design.
</p><p><i>button</i> and <i>led</i> are simple slave component we want to integrate in the FPGA.
</p><p>All these components are connected together with the 'glue logic' component <i>intercon</i>.
</p>
<h3><span class="mw-headline" id="Wrapper">Wrapper</span></h3>
<p>The <a rel="nofollow" class="external text" href="http://armadeus.git.sourceforge.net/git/gitweb.cgi?p=armadeus/armadeus;a=blob;f=firmware/wishbone_example/src/wishbone_wrapper.vhd;h=d23110bac06cb121677e551c9eb5efc36b9e5981;hb=HEAD">wrapper</a> is used to convert i.MX interface signals into Wishbone signals.
</p>
<h3><span class="mw-headline" id="Intercon">Intercon</span></h3>
<p>The <a rel="nofollow" class="external text" href="http://armadeus.git.sourceforge.net/git/gitweb.cgi?p=armadeus/armadeus;a=blob;f=firmware/wishbone_example/src/intercon.vhd;h=dfa98f69ee2263a715945173e138c846e186981c;hb=HEAD">intercon</a> is a component used to manage signals between Wishbone master and slave components. This component decode Wishbone-master addresses and dispatch them to Wishbone-slave components.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:502px;"><a href="http://www.armadeus.org/wiki/index.php?title=File:Wb_intercon.png" class="image"><img alt="" src="./A simple design with Wishbone bus - ArmadeusWiki_files/500px-Wb_intercon.png" width="500" height="382" class="thumbimage" srcset="/wiki/images/2/20/Wb_intercon.png 1.5x, /wiki/images/2/20/Wb_intercon.png 2x"></a>  <div class="thumbcaption"><div class="magnify"><a href="http://www.armadeus.org/wiki/index.php?title=File:Wb_intercon.png" class="internal" title="Enlarge"></a></div><b>figure 2</b> - <i>Intercon internal structure</i></div></div></div></div>
<h2><span class="mw-headline" id="Wishbone_slave_application_components">Wishbone slave application components</span></h2>
<p>In this example there are 3 Wishbone-slave components&nbsp;:
</p>
<h3><span class="mw-headline" id="irq_manager">irq manager</span></h3>
<p>Some components (here, only <i>button</i>) generate interrupts, <a rel="nofollow" class="external text" href="http://armadeus.git.sourceforge.net/git/gitweb.cgi?p=armadeus/armadeus;a=blob;f=firmware/wishbone_example/src/irq_mngr.vhd;h=014735fb81478b668091beac08af358d6c61240c;hb=HEAD">irq manager</a> is used to mux these interrupts for i.MX. The irq_mngr can manage up to 16 internal interrupts. 
</p><p>IRQ manager component has tree registers, one to enable interrupts, one for flags/acknowledge interrupts and one identification register&nbsp;:
</p>
<table align="center" border="1" cellpadding="5" cellspacing="0" summary="irq_mgr registers">

<tbody><tr style="background:#efefef;" align="center">
<th> register </th>
<th> function
</th></tr>
<tr>
<td> mask
</td>
<td> write '1' to allow irq
</td></tr>
<tr>
<td> ack/pend
</td>
<td> read for pending irq, write to acknowledge irq
</td></tr>
<tr>
<td> id
</td>
<td> identification register
</td></tr></tbody></table>
<h3><span class="mw-headline" id="wb_led">wb_led</span></h3>
<div style="border:1px solid blue;background-color:#d9d9f9;padding:3px;">
<table border="0" cellspacing="0">

<tbody><tr style="background-color:#d9d9f9;">
<td> <a href="http://www.armadeus.org/wiki/index.php?title=File:Notice.png" class="image" title="Note"><img alt="Note" src="./A simple design with Wishbone bus - ArmadeusWiki_files/Notice.png" width="40" height="40"></a> </td>
<td> <b>Note:</b>  On apf9328_devfull and on apf27_dev a LED is already soldered on fpga. <br> <b>For apf27_dev the FPGA bank1 must be powered with 3.3V</b> (connect pin 39 and pin 1 on J20 header (near Ethernet one)). For <b>apf51Dev</b> don't forget to power banks with jumper FPGA_Bank3 and FPGA_Bank1
</td></tr></tbody></table></div>
<p><br>
This component is a simple 16-bit Wishbone slave output port, from <a rel="nofollow" class="external text" href="http://cdn.opencores.org/downloads/wbspec_b3.pdf">wishbone specification example</a> (p110).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:602px;"><a href="http://www.armadeus.org/wiki/index.php?title=File:Wbs_led.png" class="image"><img alt="" src="./A simple design with Wishbone bus - ArmadeusWiki_files/600px-Wbs_led.png" width="600" height="341" class="thumbimage" srcset="/wiki/images/6/66/Wbs_led.png 1.5x, /wiki/images/6/66/Wbs_led.png 2x"></a>  <div class="thumbcaption"><div class="magnify"><a href="http://www.armadeus.org/wiki/index.php?title=File:Wbs_led.png" class="internal" title="Enlarge"></a></div><b>figure 3</b> - <i>LED internal structure</i></div></div></div></div>
<p>It is a simple register, that can be read and write. The LED is controlled with register pin 0.
</p><p>The two registers are&nbsp;:
</p>
<table align="center" border="1" cellpadding="5" cellspacing="0" summary="wb_led registers">

<tbody><tr style="background:#efefef;" align="center">
<th> register name </th>
<th> (relative) address </th>
<th> function
</th></tr>
<tr>
<td> LED </td>
<td> 0x00 </td>
<td> Write '1' in LSB to shutdown LED
</td></tr>
<tr>
<td> id </td>
<td> 0x02 </td>
<td> read identification number
</td></tr></tbody></table>
<h3><span class="mw-headline" id="wb_button">wb_button</span></h3>
<p>Wb_button component, is like <i>led</i> but in read only and with an edge detector to rise irq.
</p>
<div style="border:1px solid blue;background-color:#d9d9f9;padding:3px;">
<table border="0" cellspacing="0">

<tbody><tr style="background-color:#d9d9f9;">
<td> <a href="http://www.armadeus.org/wiki/index.php?title=File:Notice.png" class="image" title="Note"><img alt="Note" src="./A simple design with Wishbone bus - ArmadeusWiki_files/Notice.png" width="40" height="40"></a> </td>
<td> <b>Note:</b>  On <a href="http://www.armadeus.org/wiki/index.php?title=APF27Dev" title="APF27Dev">APF27Dev</a> and <a href="http://www.armadeus.org/wiki/index.php?title=APF51Dev" title="APF51Dev">APF51Dev</a> a button is already soldered to a FPGA pin. Just don't forget to power corresponding FPGA bank.<br> For <a href="http://www.armadeus.org/wiki/index.php?title=APF9328DevFull" title="APF9328DevFull">APF9328DevFull</a> a button must be connected to IO_L01N_0 FPGA pin (connector X7/FPGA2, pin 1)
</td></tr></tbody></table></div>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:502px;"><a href="http://www.armadeus.org/wiki/index.php?title=File:Wbs_button.png" class="image"><img alt="" src="./A simple design with Wishbone bus - ArmadeusWiki_files/500px-Wbs_button.png" width="500" height="325" class="thumbimage" srcset="/wiki/images/thumb/c/c0/Wbs_button.png/750px-Wbs_button.png 1.5x, /wiki/images/c/c0/Wbs_button.png 2x"></a>  <div class="thumbcaption"><div class="magnify"><a href="http://www.armadeus.org/wiki/index.php?title=File:Wbs_button.png" class="internal" title="Enlarge"></a></div><b>figure 4</b> - <i>Button internal structure</i></div></div></div></div>
<p>The two registers are:
</p>
<table align="center" border="1" cellpadding="5" cellspacing="0" summary="wb_button registers">

<tbody><tr style="background:#efefef;" align="center">
<th> register </th>
<th> (relative) address </th>
<th> function
</th></tr>
<tr>
<td> id </td>
<td> 0x00 </td>
<td> read identification number
</td></tr>
<tr>
<td> Button </td>
<td> 0x02 </td>
<td> read LSB to know button state
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Components_drivers">Components drivers</span></h2>
<p>Each component is driven by a Linux driver described above. All driver code is in armadeus directory in <a rel="nofollow" class="external text" href="http://armadeus.svn.sourceforge.net/viewvc/armadeus/trunk/target/linux/modules/fpga/wishbone_example/">target/linux/module/fpga/wishbone_example/</a>.
</p><p>Each component has an identification register with unique number. This number is used by driver when modprobed to unsure that device is present.
</p>
<h3><span class="mw-headline" id="irq_manager_2">irq manager</span></h3>
<p>The description of IRQ management module is available <a href="http://www.armadeus.org/wiki/index.php?title=POD_Interrupt_handler" title="POD Interrupt handler"> here</a>. The module's source code can be found <a rel="nofollow" class="external text" href="http://armadeus.svn.sourceforge.net/viewvc/armadeus/trunk/target/linux/modules/fpga/wishbone_example/wb_irq_mngr/main.c?view=markup">here</a>.
</p>
<h3><span class="mw-headline" id="LED">LED</span></h3>
<p>LED driver is seen in Linux like a character driver. Writing in a <i>/dev</i> file will enable or disable the LED.
</p><p>The driver is composed of two modules&nbsp;:
</p>
<ul><li> <b>led_ocore</b>&nbsp;: this module implement generic LED driver mechanisms.</li>
<li> <b>wb_example_led</b>&nbsp;: This module describe specific datas for each LED-component available in design. These datas are described in structure <i>plat_led_port</i> and <i>plat_led_device</i>. The module will register each LED with <i>platform_device_register()</i> function. When a <i>plat_led_port</i> device is registered, <i>led_ocore</i> driver will detect it and will probe it with <i>led_probe</i> function.</li></ul>
<h3><span class="mw-headline" id="button">button</span></h3>
<p>Button driver is seen in Linux like a character driver. When a process want to read value in button register, the driver will block reading until an interrupt occur.
</p><p>Structure of button driver is similar to LED driver (two modules)&nbsp;:
</p>
<ul><li> <b>button_ocore</b>&nbsp;: This module implements generic button driver mechanisms.</li>
<li> <b>wb_example_button</b>&nbsp;: Like LED module, this module describes specific data for each button-component available in design.</li></ul>
<h2><span class="mw-headline" id="Using_the_design">Using the design</span></h2>
<p>All code for this design is available in ARMadeus tree, <a rel="nofollow" class="external text" href="http://armadeus.svn.sourceforge.net/viewvc/armadeus/trunk/firmware/wishbone_example/">firmware</a> (VHDL) and <a rel="nofollow" class="external text" href="http://armadeus.svn.sourceforge.net/viewvc/armadeus/trunk/target/linux/modules/fpga/wishbone_example/">software</a> (Linux drivers).
</p>
<h3><span class="mw-headline" id="Make_the_FPGA_bitstream">Make the FPGA bitstream</span></h3>
<p>ISE Webpack is mandatory to generate the bitstream, so <a href="http://www.armadeus.org/wiki/index.php?title=ISE_WebPack_installation_on_Linux" title="ISE WebPack installation on Linux"> its installation is required</a>. Once bitstream has been generated, it can be downloaded in FPGA with <a href="http://www.armadeus.org/wiki/index.php?title=Target_Software_Installation#FPGA_firmware_installation" title="Target Software Installation"> U-Boot</a> or <a href="http://www.armadeus.org/wiki/index.php?title=FPGA_loader" title="FPGA loader"> Linux</a>.
For <b>apf51</b>, bitstream is under the directory <b>firmware/wishbone_example/wishbone_example51/binaries/top_wishbone_example51_lx9.bin</b>. For apf27 and apf9328 bitstream can be found in <b>firmware/wishbone_example/wishbone_example9328_27/bin/</b>.
</p>
<h3><span class="mw-headline" id="Compile_Linux_drivers">Compile Linux drivers</span></h3>
<p>To compile the drivers for this design select them in Linux menuconfig:
</p>
<pre class="host"> $ make linux-menuconfig
</pre>
<pre class="config">    Device Drivers ---&gt;
        Armadeus specific drivers ---&gt;
            FPGA Drivers ---&gt;
                [*]   Board designs
                [*]     board drivers for wishbone example
                &lt;M&gt;       board Button
                &lt;M&gt;       board Led
                &lt;M&gt;       board irq
</pre>
<p>and compile them:
</p>
<pre class="host">$ make linux &amp;&amp; make
</pre>
<p>Then reflash <a href="http://www.armadeus.org/wiki/index.php?title=Target_Software_Installation#Linux_kernel_installation" title="Target Software Installation"> Linux</a> and  <a href="http://www.armadeus.org/wiki/index.php?title=Target_Software_Installation#rootfs_installation" title="Target Software Installation"> rootfs</a> images.
</p>
<h3><span class="mw-headline" id="Play_with_button_and_LED">Play with button and LED</span></h3>
<h4><span class="mw-headline" id="Load_modules">Load modules</span></h4>
<p>Modules must be loaded in right order with <i>modprobe</i> command&nbsp;:
</p>
<ul><li> IRQ manager&nbsp;:</li></ul>
<pre class="apf"># modprobe irq_ocore
# modprobe wb_example_irq_mngr
</pre>
<ul><li> Button generic module must be loaded before board module:</li></ul>
<pre class="apf"># modprobe button_ocore
# modprobe wb_example_buttons
button button.0: BUTTON0: MAJOR: 249 MINOR: 0
BUTTON0 loaded
</pre>
<ul><li> LED generic module must be loaded before board module:</li></ul>
<pre class="apf"># modprobe led_ocore
# modprobe wb_example_led
LED0: MAJOR: 248 MINOR: 0
LED module LED0 insered
</pre>
<h4><span class="mw-headline" id="Device_access">Device access</span></h4>
<p>Devices access are done with special caracters file. These file must be created <b>with major and minor number given when modules are loaded</b> (see <i>Load modules</i> above)&nbsp;:
</p>
<ul><li> Make LED access&nbsp;:</li></ul>
<pre class="apf"># mknod /dev/led0 c LED_MAJOR_NUMBER 0
</pre>
<ul><li> Make button access&nbsp;:</li></ul>
<pre class="apf"># mknod /dev/button0 c BUTTON_MAJOR_NUMBER 0
</pre>
<p>Replace <b>LED_MAJOR_NUMBER</b> and <b>BUTTON_MAJOR_NUMBER</b> with correct major number given when modprobe is done.
</p>
<h4><span class="mw-headline" id="Test_LED">Test LED</span></h4>
<p>A test program is available in module directory:
</p>
<pre class="host">target/linux/modules/fpga/board_designs/wishbone_example/wb_led/
</pre>
<p>simply compile it with arm-linux-gcc compiler&nbsp;:
</p>
<pre class="host">$ make test
</pre>
<p>Download <i>testled</i> binary on your APF, then test it&nbsp;:
</p>
<pre class="apf"># ./testled /dev/led0 
Testing led driver
Read 1
Write 0
Read 0
Write 1
Read 1
Write 0
Read 0
</pre>
<p>LED is blinking slowly.
</p>
<h4><span class="mw-headline" id="Test_Button">Test Button</span></h4>
<p>A test program is available in directory:
</p>
<pre class="host">target/linux/modules/fpga/board_designs/wishbone_example/wb_button/
</pre>
<p>simply compile it in the directory with command:
</p>
<pre class="host">$ make test
</pre>
<p>copy the <i>testbutton</i> binary in your target then launch it:
</p>
<pre class="apf"># ./testbutton /dev/button0
Testing button driver
Read 1
Read 0
Read 1
Read 0
Read 1
Read 0
Read 0
Read 1
Read 0
Read 1
</pre>
<p>Each time button is pushed or released, button state is printed out.
</p>
<h4><span class="mw-headline" id="Switching_LED_with_button">Switching LED with button</span></h4>
<p>A simple program is available in wishbone example directory:
</p>
<pre class="host">target/linux/modules/fpga/board_designs/wishbone_example/
</pre>
<p>to switch on the LED when button is pressed.
</p><p>To compile&nbsp;:
</p>
<pre class="host">$ make test
</pre>
<p>To use it, simply type (after downloaded it under your target):
</p>
<pre class="apf"># ./push-led /dev/button0 /dev/led0 
Blink a led pushing button
</pre>
<p>Push the button to switch on/off the LED.
</p>
<!-- 
NewPP limit report
Cached time: 20190318170800
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.063 seconds
Real time usage: 0.208 seconds
Preprocessor visited node count: 228/1000000
Preprocessor generated node count: 472/1000000
Postâ€expand include size: 905/2097152 bytes
Template argument size: 517/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    3.604      1 - -total
 93.34%    3.364      2 - Template:Note
-->

<!-- Saved in parser cache with key armadeuswikidb:pcache:idhash:1695-0!*!0!!en!5!* and timestamp 20190318170800 and revision id 12025
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus&amp;oldid=12025">http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus&amp;oldid=12025</a>"</div>
					<div id="catlinks" class="catlinks"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="http://www.armadeus.org/wiki/index.php?title=Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="http://www.armadeus.org/wiki/index.php?title=Category:FPGA" title="Category:FPGA">FPGA</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus" title="View the content page [alt-shift-c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="http://www.armadeus.org/wiki/index.php?title=Talk:A_simple_design_with_Wishbone_bus&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [alt-shift-t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus&amp;action=edit" title="This page is protected.
You can view its source [alt-shift-e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus&amp;action=history" title="Past revisions of this page [alt-shift-h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-login"><a href="http://www.armadeus.org/wiki/index.php?title=Special:UserLogin&amp;returnto=A+simple+design+with+Wishbone+bus" title="You are encouraged to log in; however, it is not mandatory [alt-shift-o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="http://www.armadeus.org/wiki/index.php?title=Main_Page" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-Navigation" role="navigation">
		<h3>Navigation</h3>
		<div class="pBody">
							<ul>
											<li id="n-mainpage"><a href="http://www.armadeus.org/wiki/index.php?title=Main_Page" title="Visit the main page [alt-shift-z]" accesskey="z">Main Page</a></li>
											<li id="n-Browse-categories"><a href="http://www.armadeus.org/wiki/index.php?title=Special:Categories">Browse categories</a></li>
											<li id="n-recentchanges"><a href="http://www.armadeus.org/wiki/index.php?title=Special:RecentChanges" title="A list of recent changes in the wiki [alt-shift-r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="http://www.armadeus.org/wiki/index.php?title=Special:Random" title="Load a random page [alt-shift-x]" accesskey="x">Random page</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-Support.2Fcommunity" role="navigation">
		<h3>Support/community</h3>
		<div class="pBody">
							<ul>
											<li id="n-FAQ"><a href="http://www.armadeus.org/wiki/index.php?title=FAQ">FAQ</a></li>
											<li id="n-help"><a href="http://www.armadeus.org/wiki/index.php?title=Help:Contents" title="The place to find out">Help</a></li>
											<li id="n-Mailing-list"><a href="https://lists.sourceforge.net/lists/listinfo/armadeus-forum" rel="nofollow">Mailing list</a></li>
											<li id="n-portal"><a href="http://sourceforge.net/projects/armadeus" rel="nofollow" title="About the project, what you can do, where to find things">Community portal</a></li>
											<li id="n-currentevents"><a href="http://www.armadeus.org/wiki/index.php?title=ArmadeusWiki:Current_events" title="Find background information on current events">Current events</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-Development" role="navigation">
		<h3>Development</h3>
		<div class="pBody">
							<ul>
											<li id="n-Bug-tracker"><a href="http://sourceforge.net/tracker/?group_id=122057&amp;atid=692259" rel="nofollow">Bug tracker</a></li>
											<li id="n-Get-latest-release"><a href="http://sourceforge.net/project/showfiles.php?group_id=122057" rel="nofollow">Get latest release</a></li>
											<li id="n-Browse-GIT-repository"><a href="http://sourceforge.net/p/armadeus/code/ci/master/tree/" rel="nofollow">Browse GIT repository</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="http://www.armadeus.org/wiki/index.php" id="searchform">
					<input type="hidden" name="title" value="Special:Search">
					<input type="search" name="search" placeholder="Search" title="Search ArmadeusWiki [alt-shift-f]" accesskey="f" id="searchInput" autocomplete="off">
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton">&nbsp;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton">
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="http://www.armadeus.org/wiki/index.php?title=Special:WhatLinksHere/A_simple_design_with_Wishbone_bus" title="A list of all wiki pages that link here [alt-shift-j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="http://www.armadeus.org/wiki/index.php?title=Special:RecentChangesLinked/A_simple_design_with_Wishbone_bus" title="Recent changes in pages linked from this page [alt-shift-k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="http://www.armadeus.org/wiki/index.php?title=Special:SpecialPages" title="A list of all special pages [alt-shift-q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus&amp;printable=yes" rel="alternate" title="Printable version of this page [alt-shift-p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus&amp;oldid=12025" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="http://www.armadeus.org/wiki/index.php?title=A_simple_design_with_Wishbone_bus&amp;action=info" title="More information about this page">Page information</a></li>
					<li id="t-cite"><a href="http://www.armadeus.org/wiki/index.php?title=Special:CiteThisPage&amp;page=A_simple_design_with_Wishbone_bus&amp;id=12025" title="Information on how to cite this page">Cite this page</a></li>				</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="http://www.gnu.org/copyleft/fdl.html"><img src="./A simple design with Wishbone bus - ArmadeusWiki_files/gnu-fdl.png" alt="GNU Free Documentation License 1.2" width="88" height="31"></a>
							</div>
					<div id="f-poweredbyico">
									<a href="http://www.mediawiki.org/"><img src="./A simple design with Wishbone bus - ArmadeusWiki_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/wiki/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /wiki/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 4 September 2013, at 17:01.</li>
									<li id="copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.2</a> unless otherwise noted.</li>
									<li id="privacy"><a href="http://www.armadeus.org/wiki/index.php?title=ArmadeusWiki:Privacy_policy" title="ArmadeusWiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="http://www.armadeus.org/wiki/index.php?title=ArmadeusWiki:About" title="ArmadeusWiki:About">About ArmadeusWiki</a></li>
									<li id="disclaimer"><a href="http://www.armadeus.org/wiki/index.php?title=ArmadeusWiki:General_disclaimer" title="ArmadeusWiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"]);
} );</script><script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgBackendResponseTime":305});
} );</script>
<div class="suggestions" style="display: none; font-size: 11.4617px;"><div class="suggestions-results"></div><div class="suggestions-special"></div></div></body></html>