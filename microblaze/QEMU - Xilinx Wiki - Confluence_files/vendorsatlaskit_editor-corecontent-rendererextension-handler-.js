(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"4CAG":function(t,e,r){"use strict";(function(e){
/*!
Copyright (C) 2015-2017 Andrea Giammarchi - @WebReflection

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
function r(t){var e,r,i,o,s,a,u=Object.create(null);if(this[c]=u,t)if("string"==typeof t)for("?"===t.charAt(0)&&(t=t.slice(1)),s=0,a=(o=t.split("&")).length;s<a;s++)-1<(e=(i=o[s]).indexOf("="))?f(u,h(i.slice(0,e)),h(i.slice(e+1))):i.length&&f(u,h(i),"");else if(n(t))for(s=0,a=t.length;s<a;s++)f(u,(i=t[s])[0],i[1]);else for(r in t)f(u,r,t[r])}var n=Array.isArray,i=r.prototype,o=/[!'\(\)~]|%20|%00/g,s=/\+/g,a={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},u=function(t){return a[t]},c="__URLSearchParams__:"+Math.random();function f(t,e,r){e in t?t[e].push(""+r):t[e]=n(r)?r:[""+r]}function h(t){return decodeURIComponent(t.replace(s," "))}function l(t){return encodeURIComponent(t).replace(o,u)}i.append=function(t,e){f(this[c],t,e)},i.delete=function(t){delete this[c][t]},i.get=function(t){var e=this[c];return t in e?e[t][0]:null},i.getAll=function(t){var e=this[c];return t in e?e[t].slice(0):[]},i.has=function(t){return t in this[c]},i.set=function(t,e){this[c][t]=[""+e]},i.forEach=function(t,e){var r=this[c];Object.getOwnPropertyNames(r).forEach(function(n){r[n].forEach(function(r){t.call(e,r,n,this)},this)},this)},i.toJSON=function(){return{}},i.toString=function(){var t,e,r,n,i=this[c],o=[];for(e in i)for(r=l(e),t=0,n=i[e];t<n.length;t++)o.push(r+"="+l(n[t]));return o.join("&")},function(t){var e=function(){try{return!!Symbol.iterator}catch(t){return!1}}();"forEach"in t||(t.forEach=function(t,e){var r=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,"=").split("=").forEach(function(n){!n.length||n in r||(r[n]=this.getAll(n)).forEach(function(r){t.call(e,r,n,this)},this)},this)}),"keys"in t||(t.keys=function(){var t=[];this.forEach(function(e,r){t.push(r)});var r={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e&&(r[Symbol.iterator]=function(){return r}),r}),"values"in t||(t.values=function(){var t=[];this.forEach(function(e){t.push(e)});var r={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e&&(r[Symbol.iterator]=function(){return r}),r}),"entries"in t||(t.entries=function(){var t=[];this.forEach(function(e,r){t.push([r,e])});var r={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e&&(r[Symbol.iterator]=function(){return r}),r}),!e||Symbol.iterator in t||(t[Symbol.iterator]=t.entries),"sort"in t||(t.sort=function(){for(var t,e,r,n=this.entries(),i=n.next(),o=i.done,s=[],a=Object.create(null);!o;)e=(r=i.value)[0],s.push(e),e in a||(a[e]=[]),a[e].push(r[1]),o=(i=n.next()).done;for(s.sort(),t=0;t<s.length;t++)this.delete(s[t]);for(t=0;t<s.length;t++)e=s[t],this.append(e,a[e].shift())})}((r=t.exports=e.URLSearchParams||r).prototype)}).call(this,r("fRV1"))},"7EDp":function(t,e,r){"use strict";var n=r("D57K"),i=r("jkms"),o=r("sKxF"),s=r("ktBm"),a=r("jl37"),u=function(t){function e(e,r){var n=t.call(this,e)||this;return n.lastSearchQuery="",n.verifyMentionConfig(r),n.teamMentionConfig=r,n.lastReturnedSearchTeam=0,n}return n.__extends(e,t),e.prototype.filter=function(t,e){if(this.lastSearchQuery=t,t){this.updateActiveSearches(t);var r=this.remoteUserSearch(t,e),n=this.remoteTeamSearch(t,e);this.handleBothRequests(t,r,n)}else this.remoteInitialStateTeamAndUsers(e)},e.prototype.remoteInitialStateTeamAndUsers=function(e){return n.__awaiter(this,void 0,void 0,function(){var r,o,s,a,u;return n.__generator(this,function(n){return r="",o=t.prototype.remoteInitialState.call(this,e),s=this.getQueryParamsOfTeamMentionConfig(e),a={path:"bootstrap",queryParams:s},u=i.b.requestService(this.teamMentionConfig,a),this.handleBothRequests(r,o,u),[2]})})},e.prototype.handleBothRequests=function(e,r,i){return n.__awaiter(this,void 0,void 0,function(){var o,s,u,c,f,h,l,p,d,y=this;return n.__generator(this,function(m){switch(m.label){case 0:o=Date.now(),s={mentions:[],query:e},u=function(r,i){e===y.lastSearchQuery&&(s={mentions:n.__spread(s.mentions,r.mentions),query:e},i?y.notify(o,s,e):t.prototype.notify.call(y,o,s,e))},f=null,h=null,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,r];case 2:return c=m.sent(),u(c,!1),[3,4];case 3:return l=m.sent(),f=l,[3,4];case 4:return m.trys.push([4,6,,7]),[4,i];case 5:return p=m.sent(),u(Array.isArray(p)?this.convertTeamResultToMentionResult(p,e):p,!0),[3,7];case 6:return d=m.sent(),h=d,[3,7];case 7:return f&&h&&(this.notifyError(f,e),Object(a.a)("User mention request fails. ",f),Object(a.a)("Team mention request fails. ",h)),[2]}})})},e.prototype.notify=function(t,e,r){if(t>this.lastReturnedSearchTeam)this.lastReturnedSearchTeam=t,this._notifyListeners(e,{teamMentionDuration:Date.now()-t});else{var n=new Date(t).toISOString().substr(17,6);Object(a.a)("Stale search result, skipping",n,r)}this._notifyAllResultsListeners(e)},e.prototype.getQueryParamsOfTeamMentionConfig=function(t){var e={};return this.teamMentionConfig.containerId&&(e.containerId=this.teamMentionConfig.containerId),this.teamMentionConfig.productId&&(e.productIdentifier=this.teamMentionConfig.productId),n.__assign({},e,t)},e.prototype.remoteUserSearch=function(e,r){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return[2,t.prototype.remoteSearch.call(this,e,r)]})})},e.prototype.remoteTeamSearch=function(t,e){return n.__awaiter(this,void 0,void 0,function(){var r,o;return n.__generator(this,function(s){switch(s.label){case 0:return r={path:"search",queryParams:n.__assign({query:t,limit:20},this.getQueryParamsOfTeamMentionConfig(e))},[4,i.b.requestService(this.teamMentionConfig,r)];case 1:return o=s.sent(),[2,this.convertTeamResultToMentionResult(o,t)]}})})},e.prototype.convertTeamResultToMentionResult=function(t,e){var r=this;return{mentions:t.map(function(t){return{id:r.trimTeamARI(t.id),avatarUrl:t.smallAvatarImageUrl,name:t.displayName,accessLevel:o.b[o.b.CONTAINER],userType:o.c[o.c.TEAM],highlight:t.highlight,context:{members:t.members,includesYou:t.includesYou,memberCount:t.memberCount}}}),query:e}},e.prototype.trimTeamARI=function(t){void 0===t&&(t="");return t.replace("ari:cloud:teams::team/","")},e.prototype.recordSelection=function(e,r){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return t.prototype.recordSelection.call(this,e,r),[2]})})},e}(s.c);e.a=u},RwrK:function(t,e,r){"use strict";var n=r("D57K"),i=r("jl37"),o=r("ktBm"),s=function(){function t(t,e){this.presence=t,this.expiry=Date.now()+e}return t.prototype.expired=function(){return Date.now()>this.expiry},t}(),a=function(t){function e(r){var n=t.call(this)||this;if(!r.url)throw new Error("config.url is a required parameter");if(!r.cloudId)throw new Error("config.cloudId is a required parameter");return n.config=r,n.config.url=e.cleanUrl(r.url),n.presenceCache=r.cache||new u(r.cacheExpiry),n.presenceParser=r.parser||new c,n}return n.__extends(e,t),e.prototype.refreshPresence=function(t){var e=this.presenceCache.getBulk(t);this.notifyListeners(e);var r=this.presenceCache.getMissingUserIds(t);r.length&&this.retrievePresence(r)},e.prototype.retrievePresence=function(t){var e=this;this.queryDirectoryForPresences(t).then(function(t){return e.presenceParser.parse(t)}).then(function(t){e.notifyListeners(t),e.presenceCache.update(t)})},e.prototype.queryDirectoryForPresences=function(t){var e={query:"query getPresenceForMentions($organizationId: String!, $userIds: [String!], $productId: String) {\n                PresenceBulk(organizationId: $organizationId, product: $productId, userIds: $userIds) {\n                  userId\n                  state\n                  stateMetadata\n                }\n              }",variables:{organizationId:this.config.cloudId,userIds:t}};this.config.productId&&(e.variables.productId=this.config.productId);var r={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)};return fetch(this.config.url,r).then(function(t){return t.json()})},e.cleanUrl=function(t){return"/"!==t.substr(-1)&&(t+="/"),t},e}(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.refreshPresence=function(t){throw new Error("not yet implemented.\nParams: userIds="+t)},e.prototype.notifyListeners=function(t){this.changeListeners.forEach(function(e,r){try{e(t)}catch(t){Object(i.a)("error from listener '"+r+"', ignoring",t)}})},e}(o.b)),u=function(){function t(e,r){this.expiryInMillis=e||t.defaultTimeout,this.flushTrigger=r||t.defaultFlushTrigger,this.cache={},this.size=0}return t.prototype._delete=function(t){delete this.cache[t],this.size--},t.prototype._deleteIfExpired=function(t){this.contains(t)&&this.cache[t].expired()&&this._delete(t)},t.prototype._removeExpired=function(){var t=this;Object.keys(this.cache).forEach(function(e){t._deleteIfExpired(e)})},t.prototype.contains=function(t){return this.cache.hasOwnProperty(t)},t.prototype.get=function(t){return this._deleteIfExpired(t),this.contains(t)?this.cache[t].presence:{}},t.prototype.getBulk=function(t){var e,r,i={};try{for(var o=n.__values(t),s=o.next();!s.done;s=o.next()){var a=s.value;this.contains(a)&&(i[a]=this.get(a))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return i},t.prototype.getMissingUserIds=function(t){var e=this;return t.filter(function(t){return!e.contains(t)})},t.prototype.update=function(t){var e=this;this.size>=this.flushTrigger&&this._removeExpired(),Object.keys(t).forEach(function(r){e.cache[r]=new s(t[r],e.expiryInMillis),e.size++})},t.defaultTimeout=2e4,t.defaultFlushTrigger=50,t}(),c=function(){function t(){}return t.prototype.mapState=function(t){return"unavailable"===t?"offline":"available"===t?"online":t},t.prototype.parse=function(e){var r,i,o={};if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("PresenceBulk")){var s=e.data.PresenceBulk;try{for(var a=n.__values(s),u=a.next();!u.done;u=a.next()){var c=u.value;if(c.userId&&c.state){var f=t.extractState(c)||c.state;o[c.userId]={status:this.mapState(f)}}else c.hasOwnProperty("userId")&&c.hasOwnProperty("state")||console.error("Unexpected response from presence service contains keys: "+Object.keys(c))}}catch(t){r={error:t}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}return o},t.extractState=function(e){return t.isFocusState(e)?t.FOCUS_STATE:e.state},t.isFocusState=function(t){if(t.stateMetadata)try{var e=JSON.parse(t.stateMetadata);return e&&!!e.focus}catch(e){console.error("Failed to parse presence's stateMetadata for user with id "+t.userId+": "+t.stateMetadata),console.error(e)}return!1},t.FOCUS_STATE="focus",t}();e.a=a},jkms:function(t,e,r){"use strict";var n={};r.r(n),r.d(n,"requestService",function(){return p});var i=function(t){return t&&t.omitCredentials?"omit":"include"},o=function(){function t(){this.listeners=new Set}return t.prototype.subscribe=function(t){this.listeners.add(t),this.lastResult&&t.result(this.lastResult)},t.prototype.unsubscribe=function(t){this.listeners.delete(t)},t.prototype.notifyResult=function(t){this.listeners.forEach(function(e){e.result(t)})},t.prototype.notifyError=function(t){this.listeners.forEach(function(e){e.error&&e.error(t)})},t.prototype.notifyInfo=function(t){this.listeners.forEach(function(e){e.info&&e.info(t)})},t.prototype.notifyNotReady=function(){this.listeners.forEach(function(t){t.notReady&&t.notReady()})},t}(),s=r("D57K"),a=r("EfWO"),u=r("4CAG"),c=r.n(u),f=c.a.default||c.a,h={},l=function(t,e){if(e)for(var r in e)if({}.hasOwnProperty.call(e,r)){var n=e[r];if(Array.isArray(n))for(var i=0;i<n.length;i++)t.append(r,n[i]);else t.append(r,n)}},p=function(t,e){var r=t.url,n=t.securityProvider,o=t.refreshedSecurityProvider,u=e||h,c=u.path,d=u.queryParams,y=u.requestInit,m=n&&n(),g=function(t,e,r,n){void 0===e&&(e="");var i=new f(a.parse(t).search||void 0);if(t=t.split("?")[0],r)for(var o in r)({}).hasOwnProperty.call(r,o)&&i.append(o,r[o]);if(n&&n.params)for(var o in n.params)if({}.hasOwnProperty.call(n.params,o)){var s=n.params[o];if(Array.isArray(s))for(var u=0;u<s.length;u++)i.append(o,s[u]);else i.append(o,s)}var c="";e&&"/"!==t.substr(-1)&&(c="/");var h=i.toString();return h&&(h="?"+h),""+t+c+e+h}(r,c,d,m),v=function(t,e){var r=new Headers;return l(r,e),t&&l(r,t.headers),r}(m,y&&y.headers),S=i(m),_=s.__assign({},y,{headers:v,credentials:S});return fetch(g,_).then(function(t){return 204===t.status?Promise.resolve():t.ok?t.json():401===t.status&&o?o().then(function(t){return p({url:r,securityProvider:function(){return t}},e)}):Promise.reject({code:t.status,reason:t.statusText})})};r.d(e,"b",function(){return d}),r.d(e,!1,function(){return i}),r.d(e,"a",function(){return o});var d=n},jl37:function(t,e,r){"use strict";r.d(e,"a",function(){return o});var n=r("D57K"),i=!1;function o(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];i&&console.log.apply(console,n.__spread([t],e))}},ktBm:function(t,e,r){"use strict";r.d(e,"b",function(){return u}),r.d(e,"a",function(){return c});var n=r("D57K"),i=r("jkms"),o=r("sKxF"),s=r("jl37"),a=function(){return{params:{},headers:{}}},u=function(){function t(){this.changeListeners=new Map,this.allResultsListeners=new Map,this.errListeners=new Map,this.infoListeners=new Map}return t.prototype.subscribe=function(t,e,r,n,i){e&&this.changeListeners.set(t,e),r&&this.errListeners.set(t,r),n&&this.infoListeners.set(t,n),i&&this.allResultsListeners.set(t,i)},t.prototype.unsubscribe=function(t){this.changeListeners.delete(t),this.errListeners.delete(t),this.infoListeners.delete(t),this.allResultsListeners.delete(t)},t}(),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.shouldHighlightMention=function(t){return!1},e.prototype.filter=function(t){throw new Error("not yet implemented.\nParams: query="+t)},e.prototype.recordMentionSelection=function(t){},e.prototype.isFiltering=function(t){return!1},e.prototype._notifyListeners=function(t,e){Object(s.a)("ak-mention-resource._notifyListeners",t&&t.mentions&&t.mentions.length,this.changeListeners),this.changeListeners.forEach(function(r,n){try{r(t.mentions.slice(0,20),t.query,e)}catch(t){Object(s.a)("error from listener '"+n+"', ignoring",t)}})},e.prototype._notifyAllResultsListeners=function(t){Object(s.a)("ak-mention-resource._notifyAllResultsListeners",t&&t.mentions&&t.mentions.length,this.changeListeners),this.allResultsListeners.forEach(function(e,r){try{e(t.mentions.slice(0,20),t.query)}catch(t){Object(s.a)("error from listener '"+r+"', ignoring",t)}})},e.prototype._notifyErrorListeners=function(t,e){this.errListeners.forEach(function(r,n){try{r(t,e)}catch(t){Object(s.a)("error from listener '"+n+"', ignoring",t)}})},e.prototype._notifyInfoListeners=function(t){this.infoListeners.forEach(function(e,r){try{e(t)}catch(t){Object(s.a)("error from listener '"+r+"', ignoring",t)}})},e}(u),f=function(t){function e(e){var r=t.call(this)||this;return r.verifyMentionConfig(e),r.config=e,r.lastReturnedSearch=0,r.activeSearches=new Set,r}return n.__extends(e,t),e.prototype.shouldHighlightMention=function(t){return!!this.config.shouldHighlightMention&&this.config.shouldHighlightMention(t)},e.prototype.notify=function(t,e,r){if(t>this.lastReturnedSearch)this.lastReturnedSearch=t,this._notifyListeners(e,{duration:Date.now()-t});else{var n=new Date(t).toISOString().substr(17,6);Object(s.a)("Stale search result, skipping",n,r)}this._notifyAllResultsListeners(e)},e.prototype.notifyError=function(t,e){this._notifyErrorListeners(t,e),e&&this.activeSearches.delete(e)},e.prototype.filter=function(t,e){var r=this,n=Date.now();t?(this.activeSearches.add(t),this.search(t,e).mentions.then(function(e){r.notify(n,e,t)},function(e){return r.notifyError(e,t)})):this.initialState(e).then(function(e){return r.notify(n,e,t)},function(e){return r.notifyError(e,t)})},e.prototype.recordMentionSelection=function(t,e){return this.recordSelection(t,e).then(function(){},function(t){return Object(s.a)("error recording mention selection: "+t,t)})},e.prototype.isFiltering=function(t){return this.activeSearches.has(t)},e.prototype.updateActiveSearches=function(t){this.activeSearches.add(t)},e.prototype.verifyMentionConfig=function(t){if(!t.url)throw new Error("config.url is a required parameter");t.securityProvider||(t.securityProvider=a)},e.prototype.initialState=function(t){return this.remoteInitialState(t)},e.prototype.getQueryParams=function(t){var e={};return this.config.containerId&&(e.containerId=this.config.containerId),this.config.productId&&(e.productIdentifier=this.config.productId),n.__assign({},e,t)},e.prototype.remoteInitialState=function(t){var e=this,r={path:"bootstrap",queryParams:this.getQueryParams(t)};return i.b.requestService(this.config,r).then(function(t){return e.transformServiceResponse(t,"")})},e.prototype.search=function(t,e){return{mentions:this.remoteSearch(t,e)}},e.prototype.remoteSearch=function(t,e){var r=this,o={path:"search",queryParams:n.__assign({query:t,limit:100},this.getQueryParams(e))};return i.b.requestService(this.config,o).then(function(e){return r.transformServiceResponse(e,t)})},e.prototype.transformServiceResponse=function(t,e){var r=t.mentions.map(function(t){var r;return Object(o.d)(t)?r=t.userType:Object(o.h)(t)&&(r=t.userType),n.__assign({},t,{lozenge:r,query:e})});return n.__assign({},t,{mentions:r,query:t.query||e})},e.prototype.recordSelection=function(t,e){var r={path:"record",queryParams:n.__assign({selectedUserId:t.id},this.getQueryParams(e)),requestInit:{method:"POST"}};return i.b.requestService(this.config,r)},e}(c);e.c=f},sKxF:function(t,e,r){"use strict";var n,i,o;function s(t){return!!t&&t!==i[i.CONTAINER]}function a(t){return!!t.userType&&t.userType===o[o.SPECIAL]}function u(t){return t.userType&&t.userType===o[o.APP]}function c(t){return t.userType&&t.userType===o[o.TEAM]}function f(t){return t&&("@all"===t||"@here"===t)}r.d(e,"a",function(){return n}),r.d(e,"b",function(){return i}),r.d(e,"c",function(){return o}),r.d(e,"e",function(){return s}),r.d(e,"f",function(){return a}),r.d(e,"d",function(){return u}),r.d(e,"h",function(){return c}),r.d(e,"g",function(){return f}),function(t){t[t.SELF=0]="SELF",t[t.RESTRICTED=1]="RESTRICTED",t[t.DEFAULT=2]="DEFAULT"}(n||(n={})),function(t){t[t.NONE=0]="NONE",t[t.SITE=1]="SITE",t[t.APPLICATION=2]="APPLICATION",t[t.CONTAINER=3]="CONTAINER"}(i||(i={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SPECIAL=1]="SPECIAL",t[t.APP=2]="APP",t[t.TEAM=3]="TEAM",t[t.SYSTEM=4]="SYSTEM"}(o||(o={}))}}]);
//# sourceMappingURL=vendors~@atlaskit_editor-core~content-renderer~extension-handler-details~extension-handler-excerpt~e~34d3110f.d2aff4a97847ccbb69d0-v38.js.map