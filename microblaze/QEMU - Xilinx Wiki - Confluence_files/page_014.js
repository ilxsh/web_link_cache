(window.webpackJsonp=window.webpackJsonp||[]).push([[284],{CzLb:function(e,t,a){"use strict";a.r(t);var n,i=a("uDfI"),o=a("SMqo"),r=a("VrFO"),s=a.n(r),l=a("Y9Ll"),c=a.n(l),u=a("N+ot"),d=a.n(u),p=a("AuHH"),m=a.n(p),f=a("1Pcy"),h=a.n(f),g=a("5Yy7"),v=a.n(g),k=a("KEM+"),y=a.n(k),_=(a("aWzz"),a("ERkP")),b=a.n(_),w=a("Jygk"),C=a.n(w),E=a("IGvV"),x=a("aKlp"),q=a.n(x),O=a("Bcqe"),U=a.n(O),T=a("Xzcx"),j=a("jqY8"),N=3e4,P=6e4,F=2*P,I=function(){function e(t,a){s()(this,e),this.options=q()({min:N,max:P,inactivity:F},a),this._callback=t,this._timer=null,this._lastSeenTimestamp=null,this._setActivityTrigger()}return c()(e,[{key:"_setActivityTrigger",value:function(){var e=this;Object(T.a)("visibilitychange",function(){Object(T.c)().hidden?C.a.clearTimeout(e._timer):e._setActive()}),Object(j.c)().addEventListener("focus",this._setActive),Object(T.a)("click",this._setActive),Object(T.a)("scroll",U()(this._setActive,500))}},{key:"_setActive",value:function(){if(this._timer){var e=this._timeSinceLastSeen()>this.options.inactivity;this._lastSeenTimestamp=this._now(),this.start(e)}}},{key:"_now",value:function(){return(new Date).getTime()}},{key:"_timeSinceLastSeen",value:function(){return this._now()+1-this._lastSeenTimestamp}},{key:"_clamp",value:function(e,t,a){var n=Math.max(Math.min(t,a),e);return isNaN(n)?e:n}},{key:"_intervalMultiplier",value:function(){var e=(Object(T.c)().hidden?3:1)*Math.ceil(this._timeSinceLastSeen()/this.options.inactivity);return this._clamp(1,this.options.max/this.options.min,e)}},{key:"start",value:function(e){var t=this;this._lastSeenTimestamp=this._now(),this.stop(),e&&this._callback();var a=function(){t._callback(),n()},n=function(){t.stop(),t._timer=C.a.setTimeout(a,t.options.min*t._intervalMultiplier())};n()}},{key:"stop",value:function(){this._timer&&(C.a.clearTimeout(this._timer),this._timer=null)}}]),e}(),M=a("97Jx"),L=a.n(M),R=a("Q/r/"),S=a("TTdN"),z=a.n(S),A=a("lr0P"),Q=a.n(A),D=a("L21V"),K=a("zQXw"),B=a("sbiO"),W=a("kSEI"),J=Object(D.g)(n=function(e){function t(e){var a;return s()(this,t),(a=d()(this,m()(t).call(this,e)))._onShowFlag=a._onShowFlag.bind(h()(a)),a._onCloseFlag=a._onCloseFlag.bind(h()(a)),a._getLatestUpdate=a._getLatestUpdate.bind(h()(a)),a}return v()(t,e),c()(t,[{key:"_onShowFlag",value:function(e){this.flagEl=e,this._toggleBindClickEventForReloadLink(e,!0)}},{key:"_onCloseFlag",value:function(e){this._toggleBindClickEventForReloadLink(this.flagEl,!1),e||this.props.resetQuickReload()}},{key:"_toggleBindClickEventForReloadLink",value:function(e,t){var a=e&&e.querySelector(".qr-notice-show");a&&(t?a.addEventListener("click",this._getLatestUpdate):a.removeEventListener("click",this._getLatestUpdate))}},{key:"_getLatestUpdate",value:function(){this.props.refreshContent()}},{key:"_buildFlagBodyMarkup",value:function(){var e=this.props,t=e.users,a=e.intl.formatMessage,n=t.slice(0,8),i=Object(K.a)(n,0),o=Object(K.d)(n),r="";2===o?r=a({id:"quick.reload.edit.one.more"}):o>2&&(r=a({id:"quick.reload.edit.more"},[o-1]));var s=n.map(function(e){return b.a.createElement("span",{className:"qr-author-avatar",key:e.accountId},b.a.createElement(z.a,{src:e.avatarUrl,size:"small"}))});return b.a.createElement("div",null,b.a.createElement("div",{className:"qr-notice-authors"},s),b.a.createElement("div",{className:"qr-notice-summary"},b.a.createElement(Q.a,{type:"link",className:"qr-notice-show aui-button-text"},a({id:"quick.reload.reload"})),b.a.createElement("span",{className:"qr-notice-summary-text"},a({id:"quick.reload.edit.by"})," ",b.a.createElement("a",{href:Object(B.k)(i.accountId),className:"url fn"},i.displayName)," ",b.a.createElement("span",{className:"qr-who-edit"},r))))}},{key:"render",value:function(){var e=this.props,t=e.updatesCount,a=e.users,n=e.intl.formatMessage,i=e.flagDefaultProps,o=e.manyUpdatesTitleI18nKey,r=e.singleUpdateTitleI18nKey;if(Object(K.c)(a))return null;var s=n({id:t>1?o:r},[t]),l=Object(R.renderToStaticMarkup)(this._buildFlagBodyMarkup());return b.a.createElement(W.a,L()({isShowing:!0,title:s,body:l,onClose:this._onCloseFlag,onShow:this._onShowFlag},i))}}]),t}(_.Component))||n;J.displayName="QuickReloadPageFlag";var X,V,Y,H=a("tPAe"),G=a.n(H),Z=Object(E.a)(G.a)((Y=V=function(e){function t(){var e,a;s()(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return a=d()(this,(e=m()(t)).call.apply(e,[this].concat(i))),y()(h()(a),"lastFetchTime",Date.now()),y()(h()(a),"_timer",null),y()(h()(a),"_update",function(){a.props.isNetworkConnected&&(a.props.getQuickReloadUpdates(a.props.contentId,a.lastFetchTime),a.lastFetchTime=Date.now())}),a}return v()(t,e),c()(t,[{key:"componentDidMount",value:function(){this._timer=new I(this._update),this._timer.start(),this.lastFetchTime=Date.now()}},{key:"componentDidUpdate",value:function(e){this.props.blackListedError&&(console.warn("Quick comment reload plugin has been disabled in this page due to a server error: ",this.props.blackListedError,". Please refresh the page to get it back."),this._timer.stop()),this.props.contentId&&this.props.contentId!==e.contentId&&(this.lastFetchTime=Date.now())}},{key:"componentWillUnmount",value:function(){this._timer.stop()}},{key:"_reloadComments",value:function(){C.a.location.reload()}},{key:"render",value:function(){var e=this.props,t=e.newPageUpdatedUsers,a=e.resetQuickReloadEdits,n=e.editUpdatesCount,i=e.newCommentUsers,o=e.commentUpdatesCount,r=e.resetQuickReloadComments,s={close:"manual",type:"info",extraClasses:"qr-flag",fifo:!0,stack:"quickreload"};return b.a.createElement(_.Fragment,null,b.a.createElement(J,{users:t,refreshContent:this._reloadComments,resetQuickReload:a,flagDefaultProps:s,updatesCount:n,manyUpdatesTitleI18nKey:"quick.reload.edits",singleUpdateTitleI18nKey:"quick.reload.edit"}),b.a.createElement(J,{users:i,refreshContent:this._reloadComments,resetQuickReload:r,flagDefaultProps:s,updatesCount:o,manyUpdatesTitleI18nKey:"quick.reload.newcomments",singleUpdateTitleI18nKey:"quick.reload.newpagecomment"}))}}]),t}(_.Component),y()(V,"defaultProps",{editUpdatesCount:0,commentUpdatesCount:0}),X=Y))||X,$=a("hqKg"),ee=Object($.createSelector)([function(e){return e},function(e,t){return t}],function(e,t){return e.filter(function(e){return e.accountId!==t})});t.default=Object(i.connect)(function(e){var t=e.views.viewPage.quickReload;return{newPageUpdatedUsers:t.get("newPageUpdatedUsers"),newCommentUsers:ee(t.get("newCommentUsers"),e.meta.get("atlassian-account-id")),blackListedError:t.get("blackListedError"),editUpdatesCount:t.get("editUpdatesCount"),commentUpdatesCount:t.get("commentUpdatesCount"),isNetworkConnected:e.session.errors.get("isNetworkConnected")}},function(e){return{getQuickReloadUpdates:function(t,a){return e(Object(o.a)({contentId:t,lastFetchTime:a}))},refreshContent:function(){return e(Object(o.c)())},resetQuickReloadEdits:function(){return e(Object(o.e)())},resetQuickReloadComments:function(){return e(Object(o.d)())}}})(Z)},RRuF:function(e,t,a){(e.exports=a("RDo7")(!1)).push([e.i,".qr-flag .qr-author-avatar{margin-right:5px;vertical-align:middle}.qr-flag .qr-notice-authors{padding:5px 0;max-width:300px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.qr-flag .qr-notice-summary{width:317px}.qr-flag .qr-notice-text{line-height:24px}.qr-flag .qr-notice-summary-text{font-size:12px;color:#707070;display:block;width:217px;max-width:217px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.qr-flag .qr-notice-summary-text a{color:#707070}.qr-flag .qr-notice-show{float:right;max-width:100px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.qr-flag .aui-message{padding-top:10px;padding-bottom:10px}.qr-flag .aui-message.closeable .icon-close{top:10px}",""])},TTdN:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(a("ERkP")),i=r(a("aWzz")),o=r(a("O94r"));function r(e){return e&&e.__esModule?e:{default:e}}var s=function(e){var t=e.isProject,a=e.size,i=e.src,r=(0,o.default)("aui-avatar","aui-avatar-"+a,{"aui-avatar-project":!0===t});return n.default.createElement("span",{className:r},n.default.createElement("span",{className:"aui-avatar-inner"},n.default.createElement("img",{src:i})))};s.displayName="AUIAvatar",s.propTypes={src:i.default.string,size:i.default.oneOf(["xsmall","small","medium","large","xlarge","xxlarge","xxxlarge"]),isProject:i.default.bool},t.default=s},lr0P:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=l(a("ERkP")),o=l(a("aWzz")),r=l(a("O94r")),s=l(a("mc6X"));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){var t=e.icon,a=e.type,o=e.disabled,l=e.children,c=e.className,u=function(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}(e,["icon","type","disabled","children","className"]),d=null;t&&(d=i.default.createElement("span",null,i.default.createElement(s.default,{icon:t}),"Â "));var p=void 0;a&&(p="aui-button-"+a);var m=(0,r.default)("aui-button",p,c);return i.default.createElement("button",n({className:m,"aria-disabled":o},u),d,l)};c.displayName="AUIButton",c.defaultProps={className:""},c.propTypes={type:o.default.oneOf(["link","primary","subtle"]),icon:o.default.string,disabled:o.default.bool,children:o.default.oneOfType([o.default.node,o.default.string]),className:o.default.string},t.default=c},mc6X:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(a("ERkP")),i=r(a("aWzz")),o=r(a("O94r"));function r(e){return e&&e.__esModule?e:{default:e}}var s=function(e){var t=void 0,a=void 0,i=e.className,r=e.icon,s=e.size,l=e.style,c=e.useIconFont,u=e.customIcon,d=e.onClick,p=e.onMouseEnter,m=e.onMouseLeave,f=e.children;return r&&(t=c?"aui-iconfont-"+r:"aui-icon-"+r),i=(0,o.default)("aui-icon","aui-icon-"+s,t,i),a=l||{},u&&(a.backgroundImage="url("+u+")"),n.default.createElement("span",{className:i,style:a,onClick:d,onMouseEnter:p,onMouseLeave:m},f)};s.displayName="AUIIcon",s.defaultProps={useIconFont:!0,size:"small"},s.propTypes={children:i.default.oneOfType([i.default.node,i.default.string]),style:i.default.object,size:i.default.oneOf(["small","medium","large"]),icon:i.default.string,customIcon:i.default.string,className:i.default.string,useIconFont:i.default.bool,onClick:i.default.func,onMouseEnter:i.default.func,onMouseLeave:i.default.func},t.default=s},tPAe:function(e,t,a){var n=a("RRuF"),i=a("7l8p");"string"==typeof n&&(n=[[e.i,n,""]]),e.exports=n.locals||{},e.exports._getContent=function(){return n},e.exports._getCss=function(){return n.toString()},e.exports._insertCss=function(e){return i(n,e)}}}]);
//# sourceMappingURL=page.quick-reload.232f8abbe0f3793cd841-v38.js.map