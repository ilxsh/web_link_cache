(window.webpackJsonp=window.webpackJsonp||[]).push([[292],{"96U/":function(e,t,i){"use strict";var n=i("ERkP"),o=i.n(n),s=i("7nmT"),a=i.n(s),r=i("Jygk"),c=i.n(r),l=i("VrFO"),d=i.n(l),h=i("Y9Ll"),m=i.n(h),u=i("N+ot"),g=i.n(u),f=i("AuHH"),p=i.n(f),v=i("1Pcy"),y=i.n(v),C=i("5Yy7"),b=i.n(C),w=i("KEM+"),E=i.n(w),k=i("aWzz"),T=i.n(k),R=i("uDfI"),x=i("kFJ8"),M=i("L21V"),S=i("lZoD"),I=i("kD2R"),P=i("nWyW"),D=i("Z49i"),H=i("JxFu"),$=i("Clud"),_=i("+5ab"),A=i("JPM9"),N=i("vplL"),O=i("c09o"),V=i("OjRD"),L=i("9Ivk"),F=i("uh42"),U=i("HEM+"),z=i("/FQd"),j=i("lPJD"),B=i("qdfj"),G=i("cphC"),q=i("r9hL"),W=i("d3tz"),J=i("gHio"),Q=i.n(J),X=i("7wq/"),Y=i.n(X),K=i("7A9o"),Z=i("KsTJ");function ee(){var e=Y()(["\n  flex: 0 0 auto;\n  appearance: none;\n  background: none;\n  border: none;\n  color: ",";\n  cursor: pointer;\n\n  &:focus {\n    outline: none;\n  }\n"]);return ee=function(){return e},e}function te(){var e=Y()(["\n  flex-grow: 1;\n  color: ",";\n  text-align: center;\n"]);return te=function(){return e},e}function ie(){var e=Y()(["\n  display: flex;\n  background-color: ",";\n  border-radius: 5px;\n  align-items: center;\n  overflow: hidden;\n  height: ","px;\n  transition: height 0.25s linear;\n"]);return ie=function(){return e},e}var ne,oe=Z.default.div(ie(),K.colors.P300,function(e){return e.isOpen?50:0}),se=Z.default.p(te(),"white"),ae=Z.default.button(ee(),"white"),re=function(e){function t(){var e,i;d()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return i=g()(this,(e=p()(t)).call.apply(e,[this].concat(o))),E()(y()(i),"onDismiss",function(e){var t=i.props.onDismiss;e.stopPropagation(),e.preventDefault(),t()}),i}return b()(t,e),m()(t,[{key:"render",value:function(){var e=this.props.isOpen;return o.a.createElement(oe,{isOpen:e},o.a.createElement(se,null,o.a.createElement(M.a,{id:"changeboarding.dnd.pagetree.spacesettings.banner"})),o.a.createElement(ae,{onClick:this.onDismiss},o.a.createElement(Q.a,null)))}}]),t}(n.Component);re.displayName="ReorderPagesBannerComponent";var ce,le=Object(q.b)(W.a.CHANGEBOARDING)(ne=function(e){function t(){var e,i;d()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return i=g()(this,(e=p()(t)).call.apply(e,[this].concat(o))),E()(y()(i),"state",{isOpen:!1}),E()(y()(i),"onDismiss",function(){var e=i.props,t=e.triggerAnalytics,n=e.stop;i.setState({isOpen:!1}),t("reorderpages-banner-dismissed"),n()}),i}return b()(t,e),m()(t,[{key:"componentWillMount",value:function(){this.el=c.a.document.getElementById("reorderpages-changeboarding-react-portal-placeholder")}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState({isOpen:!0})},200)}},{key:"render",value:function(){var e=this.state.isOpen;return this.el?a.a.createPortal(o.a.createElement(re,{isOpen:e,onDismiss:this.onDismiss}),this.el):null}}]),t}(n.Component))||ne,de=Object(G.a)(ce=Object(B.a)(ce=function(e){function t(){var e,i;d()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return i=g()(this,(e=p()(t)).call.apply(e,[this].concat(o))),E()(y()(i),"shouldShowSpaceSettingChangeboarding",function(){return i.isOnReorderPages()}),E()(y()(i),"isOnReorderPages",function(){var e=i.props,t=e.matchRoute,n=e.location,o=t(n.pathname+n.search);return o&&o.name===_.SPACE_SETTINGS_REORDERPAGES.name}),i}return b()(t,e),m()(t,[{key:"render",value:function(){var e=this.props.coordinationClient;return this.shouldShowSpaceSettingChangeboarding()?o.a.createElement(j.a,{client:e,messageId:"confluence-dragdrop-spacesettings-banner"},o.a.createElement(le,null)):null}}]),t}(n.Component))||ce)||ce,he=function(e){function t(){return d()(this,t),g()(this,p()(t).apply(this,arguments))}return b()(t,e),m()(t,[{key:"render",value:function(){return o.a.createElement(z.a,null,function(e){var t=e.featureFlags;return o.a.createElement(de,{featureFlags:t})})}}]),t}(n.Component);he.displayName="DragDropChangeboarding";var me=function(e){function t(){var e,i;d()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return i=g()(this,(e=p()(t)).call.apply(e,[this].concat(o))),E()(y()(i),"state",{}),i}return b()(t,e),m()(t,[{key:"getChildContext",value:function(){return{insertCss:this.props.context.insertCss||function(){}}}},{key:"componentDidMount",value:function(){var e=this,t=this.props.locale;Object(O.a)(t,function(){Object(N.a)({locale:t},function(i,n){e.setState({i18nConfig:{locale:t,messages:n}})})})}},{key:"render",value:function(){if(!this.state.i18nConfig)return null;var e=this.props,t=e.store,i=e.locale;return o.a.createElement(S.b,null,o.a.createElement(x.b,{client:Object(D.a)()},o.a.createElement(R.Provider,{store:t},o.a.createElement(M.d,this.state.i18nConfig,o.a.createElement(H.a,null,o.a.createElement(U.a,{locale:i},o.a.createElement(I.ConnectedRouter,{history:F.a},o.a.createElement(n.Fragment,null,o.a.createElement(A.a,null),o.a.createElement(P.a,null),o.a.createElement($.a,{namedRoutes:_},o.a.createElement(L.a,null,this.props.children,o.a.createElement(V.b,null),o.a.createElement(he,null)))))))))))}}]),t}(n.Component);E()(me,"childContextTypes",{insertCss:T.a.func.isRequired}),me.displayName="ComponentWrapper";var ue=i("AeT/"),ge=Object(ue.a)({isServerRenderedPage:!0});i.e(590).then(i.bind(null,"Al9w")).then(function(e){e.subscribe(ge)});var fe={insertCss:function(e){return e._insertCss()}};t.a=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"string"==typeof t&&(t=c.a.document.getElementById(t)),a.a.render(o.a.createElement(me,{store:ge,context:fe,locale:c.a.__INITIAL_STATE__.i18n.locale,renderAsRoot:i},e),t)}},OjRD:function(e,t,i){"use strict";var n=i("i66J"),o=i("frB3"),s=i("tQaH"),a=i.n(s),r=i("VrFO"),c=i.n(r),l=i("Y9Ll"),d=i.n(l),h=i("N+ot"),m=i.n(h),u=i("AuHH"),g=i.n(u),f=i("5Yy7"),p=i.n(f),v=(i("aWzz"),i("ERkP")),y=i.n(v),C=function(e){function t(){return c()(this,t),m()(this,g()(t).apply(this,arguments))}return p()(t,e),d()(t,[{key:"render",value:function(){var e=this.props,t=e.children,i=e.eventHandlers;return Object(v.cloneElement)(t,a()({},i))}}]),t}(v.Component);C.displayName="Hover",C.defaultProps={eventHandlers:{}},C.displayName="Hover";var b,w=i("97Jx"),E=i.n(w),k=i("1Pcy"),T=i.n(k),R=i("uDfI"),x=(i("0iyY"),i("w0mW")),M=i.n(x),S={HOVER:"hover",NONE:"none"},I=Object(R.connect)()(b=function(e){function t(){var e;return c()(this,t),(e=m()(this,g()(t).call(this)))._refCallback=e._refCallback.bind(T()(e)),e.onMouseEnter=e.onMouseEnter.bind(T()(e)),e.onMouseLeave=e.onMouseLeave.bind(T()(e)),e.onComponentToShowMouseEnter=e.onComponentToShowMouseEnter.bind(T()(e)),e.onComponentToShowMouseLeave=e.onComponentToShowMouseLeave.bind(T()(e)),e.hoverId=M()("hover_"),e}return p()(t,e),d()(t,[{key:"componentDidMount",value:function(){this.props.open&&this._showHoverAfterDelay()}},{key:"componentDidUpdate",value:function(e){var t=this.props.open;e.open!==t&&(t?this._showHoverAfterDelay():this._hideHoverAfterDelay())}},{key:"componentWillUnmount",value:function(){this._hideHover()}},{key:"onMouseLeave",value:function(){this.props.shouldHide&&(this.isHoveringTarget=!1,this.toggleHover())}},{key:"onMouseEnter",value:function(){this.isHoveringTarget=!0,this.toggleHover()}},{key:"onComponentToShowMouseEnter",value:function(){this.isHoveringComponentToShow=!0,this.toggleHover()}},{key:"onComponentToShowMouseLeave",value:function(){this.props.shouldHide&&(this.isHoveringComponentToShow=!1,this.toggleHover())}},{key:"_showHoverAfterDelay",value:function(){var e=this;this.showTimer=setTimeout(function(){e._showHover()},this.props.delayShow)}},{key:"_showHover",value:function(){this.isShowing=!0;var e=this.props,t=e.gravity,i=e.componentToShow,o=e.dispatch,s=e.gap,a=e.zIndex,r=e.fixed,c=e.shouldPersistOnScrollAndResize;this._hoverTarget&&o(Object(n.b)({hoverId:this.hoverId,gravity:t,componentToShow:Object(v.cloneElement)(i,{onMouseEnter:this.onComponentToShowMouseEnter,onMouseLeave:this.onComponentToShowMouseLeave}),gap:s,target:this._hoverTarget,zIndex:a,fixed:r,shouldPersistOnScrollAndResize:c}))}},{key:"_hideHoverAfterDelay",value:function(){var e=this;this.hideTimer=setTimeout(function(){e._hideHover()},this.props.delayHide)}},{key:"_hideHover",value:function(){this.isShowing=!1,(0,this.props.dispatch)(Object(n.a)({hoverId:this.hoverId}))}},{key:"_clearTimers",value:function(){clearTimeout(this.hideTimer),clearTimeout(this.showTimer)}},{key:"isHovering",value:function(){return this.isHoveringTarget||this.isHoveringComponentToShow}},{key:"toggleHover",value:function(){var e=this.isHovering();this._clearTimers(),this.isShowing&&!e?this._hideHoverAfterDelay():!this.isShowing&&e&&this._showHoverAfterDelay()}},{key:"_getEventHandlers",value:function(e){switch(e){case S.HOVER:return{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave};case S.NONE:return{}}}},{key:"_refCallback",value:function(e){this._hoverTarget=e}},{key:"render",value:function(){var e=this.props,t=e.children,i=e.showOn,n=e.className,o=e.style,s=this._getEventHandlers(i),a={className:n,style:o};return y.a.createElement(C,{eventHandlers:s},y.a.createElement(this.props.tagName,E()({ref:this._refCallback},a),t))}}]),t}(v.Component))||b;I.defaultProps={delayHide:150,delayShow:200,gravity:"n",gap:0,showOn:S.HOVER,open:!1,tagName:"div",shouldHide:!0,shouldPersistOnScrollAndResize:!1},I.displayName="ReduxHover";var P=i("TgF9");i.d(t,"b",function(){return o.a}),i.d(t,"a",function(){return C}),i.d(t,"c",function(){return I}),i.d(t,!1,function(){}),i.d(t,!1,function(){return P.a}),i.d(t,!1,function(){})},cphC:function(e,t,i){"use strict";i.d(t,"a",function(){return w});var n=i("97Jx"),o=i.n(n),s=i("VrFO"),a=i.n(s),r=i("Y9Ll"),c=i.n(r),l=i("N+ot"),d=i.n(l),h=i("AuHH"),m=i.n(h),u=i("5Yy7"),g=i.n(u),f=i("KEM+"),p=i.n(f),v=i("ERkP"),y=i.n(v),C=i("C+A9"),b=i("/FQd");function w(e){var t,i;return i=t=function(t){function i(){return a()(this,i),d()(this,m()(i).apply(this,arguments))}return g()(i,t),c()(i,[{key:"render",value:function(){var t=this;return y.a.createElement(b.a,null,function(i){var n=i.cloudId,s=new C.a(n,"/gateway/api");return y.a.createElement(e,o()({},t.props,{coordinationClient:s}))})}}]),i}(v.Component),p()(t,"displayName","withCoordinationClient(".concat(e.displayName||e.name,")")),i}},i8tr:function(e,t,i){"use strict";i.r(t);var n=i("xeH2"),o=i.n(n),s=i("HvGa"),a=i.n(s),r=i("jqY8"),c=i("Jygk"),l=i.n(c),d=i("+frj"),h=i.n(d),m=i("UYEP"),u=i.n(m),g=new(u.a.View.extend({initialize:function(){this.setPageContentElByCSSSelector("#content"),this.pageHeader=null},destroy:function(){this.el&&(this.el.style.minHeight="",this.el.classList.remove("ic-shrink-to-show-sidebar")),this.pageHeader&&this.pageHeader.classList.remove("ic-shrink-to-show-sidebar")},setPageContentElByCSSSelector:function(e){var t=!1;if(e){var i=l.a.document.querySelector(e);i?this.setElement(i):t=!0}else t=!0;if(t){var n=l.a.document.querySelector("#content");this.setElement(n)}},setPageHeaderElByCSSSelector:function(e){this.pageHeader=e?l.a.document.querySelector(e):null},shrinkToShowSideBar:function(){this.el.classList.add("ic-shrink-to-show-sidebar"),this.pageHeader&&this.pageHeader.classList.add("ic-shrink-to-show-sidebar")},updateMinHeight:function(e){var t=e-this.$el.offset().top,i=parseInt(this.el.style.minHeight,10);(t>i||isNaN(i))&&(this.el.style.minHeight="".concat(t,"px"))}})),f=l.a.top,p={INLINE_COMMENTS:a.a.DarkFeatures.isEnabled("confluence-inline-comments"),RESOLVED_INLINE_COMMENTS:a.a.DarkFeatures.isEnabled("confluence-inline-comments-resolved"),RICH_TEXT_EDITOR:a.a.DarkFeatures.isEnabled("confluence-inline-comments-rich-editor"),DANGLING_COMMENT:a.a.DarkFeatures.isEnabled("confluence-inline-comments-dangling-comment"),LIKES_ADMIN_TOGGLE:a.a.DarkFeatures.isEnabled("optional-likes-CONFDEV-53297")},v=["dateautocomplete","confluencemacrobrowser","propertypanel","jiraconnector","dfe"],y=["autoresize","confluenceleavecomment"],C=["code"];function b(e,t,i,n,o){null!=t&&(t.isResolved()?new i({collection:e,focusCommentId:t.get("id"),formatMessage:o}).render():t.isDangling()||u.a.trigger("ic:view",t,"permalink",{isReplyComment:n}))}function w(e){if("number"==typeof e.selectionStart){var t=e.value.length;e.selectionStart=t,e.selectionEnd=t}else if(null!=typeof e.createTextRange){e.focus();var i=e.createTextRange();i.collapse(!1),i.select()}}function E(e){var t=o()(e).closest("a");return t.length||(t=o()(e).find("a")),t}function k(){return!!o()(".ic-sidebar #wysiwygTextarea_ifr").length}function T(e,t,i){i=i||1,e=e||o()(f).scrollTop();var n=o.a.Deferred(),s={duration:100,step:function(e){o()(f).scrollTop(e)},complete:function(){setTimeout(n.resolve,i)}};return o()({scrollTop:e}).animate({scrollTop:t},s),n.promise()}function R(){var e=l.a.frameElement&&l.a.frameElement.getAttribute("name"),t=l.a.frameElement&&"true"===l.a.frameElement.getAttribute("data-is-fallback-mode-iframe");return l.a.top!==l.a.self&&e&&"fallback-mode-iframe"===e||t}var x={overlappedSelection:function(e,t){if(e&&t){var i=o()(e.containingElement);if(i.is(".inline-comment-marker.valid")||(i=o()("<div/>").append(e.html).find(".inline-comment-marker.valid")),i.length>0&&function(e){return e.filter(function(){return o()(this).text().length>0}).length>0}(i)){var n=i.first().data("ref");return t.findWhere({markerRef:n})}}},focusedCommentUrl:function(e){return"".concat(a.a.contextPath(),"/pages/viewpage.action?pageId=").concat(a.a.Meta.get("latest-page-id"),"&focusedCommentId=").concat(e,"#comment-").concat(e)},showFocusedComment:function(e,t,i,n){var s=t.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null!=s){var r="replyToComment"===s[1],c=parseInt(s[2],10);if(e.findWhere){var l=e.findWhere({id:c});null!=l?b(e,l,i,r,n):o.a.ajax({url:"".concat(a.a.contextPath(),"/rest/inlinecomments/1.0/comments/replies/").concat(c,"/commentId")}).done(function(t){l=e.findWhere({id:t}),b(e,l,i,r,n)})}}},getAuthorAvatarUrl:function(){return a.a.Meta.get("current-user-avatar-url")?a.a.contextPath()+a.a.Meta.get("current-user-avatar-url"):"".concat(a.a.Meta.get("static-resource-url-prefix"),"/images/icons/profilepics/anonymous.png")},moveCaretToEnd:function(e){w(e),l.a.setTimeout(function(){w(e)},1)},animateSidebar:function(e,t){var i="webkitAnimationEnd oanimationend msAnimationEnd animationend",n=e.$wikiContent,s=o.a.Deferred();if(t){var a=o()(".inline-comment-marker.active");n.addClass("ic-fade-in-animation"),n.one(i,function(){o()(this).removeClass("ic-fade-in-animation")}),e.$el.addClass("ic-slide-in"),e.$el.one(i,function(){o()(this).removeClass("ic-slide-in"),a.addClass("ic-highlight-pulse"),a.one(i,function(){a.removeClass("ic-highlight-pulse")})}),s.resolve()}else n.bind(i,function(t){"ic-fade-out-animation"==t.originalEvent.animationName?(e.$wikiContent.removeClass("ic-fade-out-animation"),e.$wikiContent.css("opacity","0.5")):"ic-fade-in-animation"==t.originalEvent.animationName&&(e.$wikiContent.css("opacity","1"),e.$wikiContent.removeClass("ic-fade-in-animation"),e.$wikiContent.unbind(i))}),n.addClass("ic-fade-out-animation"),e.$el.addClass("ic-slide-out"),e.$el.on(i,function t(){e.$el.removeClass("ic-slide-out"),e._emptySidebar(),g.destroy(),n.addClass("ic-fade-in-animation"),n.css("position","static"),s.resolve(),e.$el.off(i,t)});return s.promise()},getDarkFeatures:function(){return h.a.clone(p)},getInlineLinks:E,removeInlineLinksDialog:function(e){e.each(function(){var e=E(this);e.length&&e.off("mousemove")})},isAnimationSupported:function(){return void 0!==document.body.style.animation||void 0!==document.body.style.webkitAnimation},showHighlightContent:function(e){e.parents(".expand-content.expand-hidden").each(function(){o()(this).siblings(".expand-control").click()})},getUnsupportedRtePlugins:function(){return h.a.clone(v)},getSupportedRtePlugins:function(){return h.a.clone(y)},confirmProcess:function(e,t){var i=a.a.Rte&&a.a.Rte.getEditor&&a.a.Rte.getEditor();if(!0===t){if(k()&&i&&i.isDirty())return confirm(e({id:"inline.comments.editor.lost"}))}else if(i&&i.isDirty()&&l.a.Confluence.Editor&&!l.a.Confluence.Editor.getContentType)return confirm(e({id:"inline.comments.editor.lost"}));return!0},getAuthorDisplayName:function(){return a.a.Meta.get("user-display-name")||a.a.Meta.get("current-user-fullname")},isKeyboardShortcutsEnable:function(){return a.a.Meta.get("use-keyboard-shortcuts")&&l.a.Confluence.KeyboardShortcuts&&l.a.Confluence.KeyboardShortcuts.enabled},addSidebarHeadingTooltip:function(e){e.$("button.ic-action-hide").tooltip({gravity:"se"}),e.$("#ic-nav-next").tooltip({gravity:"s"}),e.$("#ic-nav-previous").tooltip({gravity:"s"})},hasEditorInSidebar:k,recalculateContentHeight:function(e){var t=e.height(),i=e.offset().top+t;g.updateMinHeight(i)},resizeContentAfterLoadingImages:function(e){e=e.closest(".ic-display-comment-view");var t=this,i=o()(".confluence-embedded-image, .confluence-embedded-file img",e),n=i.length,s=0;n>0&&i.off("load").one("load",function(){++s===n&&t.recalculateContentHeight(e)}).each(function(){this.complete&&o()(this).load()})},scrollToCommentAfterToggleSideBar:function(e,t,i){var n=function(){var i=t&&t.is(":visible");if(e&&i){var n=t.offset().top-e;o()(f).scrollTop(n)}};(i=void 0!==i?i:R())?setTimeout(n,1):n()},getEditorFormat:function(e){var t=o.a.Deferred();return o.a.ajax({url:"".concat(a.a.contextPath(),"/rest/api/content/").concat(e,"?expand=body.editor"),type:"GET",dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(e){var i=e.body.editor.value;t.resolve(i)}).fail(function(e,i,n){t.reject(e,i,n)}),t.promise()},containUnsupportedMacro:function(e){var t=e.closest(".conf-macro");return!1===t.data("hasbody")||e.find('.conf-macro[data-hasbody="false"]').length>0||-1!=C.indexOf(t.data("macro-name"))},containInternalLink:function(e){return e.closest(".user-mention").length>0||e.find(".user-mention").length>0},containUserMetion:function(e){return e.closest("a[href^='/']:not('.user-mention')").length>0||e.find("a[href^='/']:not('.user-mention')").length>0},getCurrentUserInfo:function(){var e={isDefault:!0,path:"".concat(a.a.Meta.get("static-resource-url-prefix"),"/images/icons/profilepics/default.png")};return"/images/icons/profilepics/default.png"!==a.a.Meta.get("current-user-avatar-url")&&(e={isDefault:!1,path:a.a.contextPath()+a.a.Meta.get("current-user-avatar-url")}),{accountId:a.a.Meta.get("atlassian-account-id"),displayName:a.a.Meta.get("current-user-fullname"),profilePicture:e}},getOffsetTopRelativeInWindowCoordinate:function(e){return e.offset().top-o()(f).scrollTop()},scrollToActiveHighlight:function(e,t){var i=o()(f).scrollTop();return T(i,i+e-t)},scrollToTop:function(){return T(null,0,100)},sendMessageToParent:function(e){e.bridgeId="".concat(function(){return l.a.frameElement&&l.a.frameElement.getAttribute("data-bridge-id")}()),l.a.parent.postMessage(e,l.a.location.origin)},isFallbackModeIframe:R,isSPAPage:function(){return o()("#confluence-ui").length>0},getPageContentClassName:function(){return"view-page-body"},getAuthorAccountId:function(){return a.a.Meta.get("atlassian-account-id")}},M=u.a.Model.extend({defaults:{authorDisplayName:x.getAuthorDisplayName(),authorAccountId:a.a.Meta.get("atlassian-account-id"),authorAvatarUrl:a.a.contextPath()+a.a.Meta.get("current-user-avatar-url"),body:"",commentId:"0",hasDeletePermission:!0,hasEditPermission:Boolean(a.a.Meta.get("atlassian-account-id"))},urlRoot:function(){return"".concat(a.a.contextPath(),"/rest/inlinecomments/1.0/comments/").concat(this.get("commentId"),"/replies")},sync:function(e,t,i){return i=i||{},"create"===e&&(i.url="".concat(this.urlRoot(),"?containerId=").concat(a.a.Meta.get("latest-page-id"))),u.a.sync.call(this,e,t,i)},validate:function(){if(!this.get("body"))return!0}}),S=u.a.Collection.extend({model:M}),I=u.a.Model.extend({defaults:{authorDisplayName:x.getAuthorDisplayName(),authorAvatarUrl:a.a.contextPath()+a.a.Meta.get("current-user-avatar-url"),body:"",originalSelection:"",parentCommentId:"0",lastFetchTime:o()("meta[name=confluence-request-time]").attr("content"),hasDeletePermission:!0,hasEditPermission:!0,hasResolvePermission:!0,resolveProperties:{resolved:!1,resolvedTime:0},serializedHighlights:"",deleted:!1},urlRoot:"".concat(a.a.contextPath(),"/rest/inlinecomments/1.0/comments"),initialize:function(e){e=e||{},this._setHighlights(e.markerRef);var t=this;this.replies=new S,this.replies.url=function(){return"".concat(t.url(),"/replies")},this.set({containerId:a.a.Meta.get("latest-page-id")},{silent:!0}),this.set({containerType:a.a.Meta.get("content-type")},{silent:!0}),x.getDarkFeatures().DANGLING_COMMENT&&a.a.Meta.get("page-id")===a.a.Meta.get("latest-page-id")&&this.isDangling()&&!this.isResolved()&&this.resolve(!0,{wait:!0,dangling:!0,success:h.a.bind(function(){u.a.trigger("ic:open:dangled",this)},this),error:h.a.bind(function(){u.a.trigger("ic:resolve:dangled:failed",this)},this)})},validate:function(){if(!this.get("body"))return!0},resolve:function(e,t){t=t||{},this.save({},h.a.extend(t,{url:"".concat(this.urlRoot,"/").concat(this.get("id"),"/resolve/").concat(e,"/dangling/").concat(!0===t.dangling)}))},isResolved:function(){return this.get("resolveProperties").resolved},isDangling:function(){return void 0===this.highlight},isDeleted:function(){return this.get("deleted")},_setHighlights:function(e){var t;0!==(t=void 0!==e?o()("[data-inline-comments-target=true]:first").find('.inline-comment-marker[data-ref="'.concat(e,'"],span[data-reference="').concat(e,'"]')):o()(".ic-current-selection")).length?(this.highlights=t,this.highlight=t.first()):(this.highlights=void 0,this.highlight=void 0)},destroy:function(e){var t=this,i=(e=e?h.a.clone(e):{}).success;return e.success=function(n){i&&i(t,n,e)},function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}}(this,e),this.sync("delete",this,e)}}),P=u.a.Collection.extend({model:I,initialize:function(){this.listenTo(this,"sort",this._removeCachedMarkers)},url:function(){var e=a.a.contextPath(),t=a.a.Meta.get("page-id");return"".concat(e,"/rest/inlinecomments/1.0/comments?")+"containerId=".concat(t)},getResolvedCount:function(){return this.getResolvedComments().length},getUnresolveCount:function(){return this.reject(function(e){return!0===e.isResolved()&&!1===e.isDeleted()}).length},getResolvedComments:function(){return this.filter(function(e){return!0===e.isResolved()&&!1===e.isDeleted()})},getResolvedCommentsDesc:function(){return h.a.sortBy(this.getResolvedComments(),function(e){return 0-e.get("resolveProperties").resolvedTime})},getNextCommentOnPage:function(){return this._getCommentAtRelativeOffset(1)},getPrevCommentOnPage:function(){return this._getCommentAtRelativeOffset(-1)},_getCommentAtRelativeOffset:function(e){var t=this.getCommentsOnPage(),i=this.findWhere({active:!0});if(void 0===i||t.length<=1)return null;var n=h.a.pluck(t,"id");return t[(h.a.indexOf(n,i.get("id"))+e+t.length)%t.length]},getCommentsOnPage:function(){return this.filter(function(e){return!1===e.isResolved()&&!e.isDangling()&&!1===e.isDeleted()||!0===e.get("active")})},getCommentsOnPageCount:function(){return this.getCommentsOnPage().length},getActiveIndexWithinPageComments:function(){var e=h.a.pluck(this.getCommentsOnPage(),"id"),t=this.findWhere({active:!0});if(void 0===t)return null;var i=t.get("id");return h.a.indexOf(e,i)},comparator:function(e,t){return void 0===this.markers&&(this.markers=o()("[data-inline-comments-target=true]:first").find(".inline-comment-marker")),void 0===e.highlight?1:void 0===t.highlight?-1:this.markers.index(e.highlight)-this.markers.index(t.highlight)},_removeCachedMarkers:function(){this.markers=void 0}}),D={};h.a.extend(D,u.a.Events),D.start=function(){!0!==this.running&&(this.running=!0,this.send=function(e,t){a.a.trigger("analytics",{name:e,data:t})},this.listenTo(u.a,"ic:highlight-panel-click",function(){this.send("confluence.highlight.actions.comment.inline")}),this.listenTo(u.a,"ic:view",function(e,t){this.send("confluence.comment.inline.view"),"nav"===t&&this.send("confluence.comment.inline.view.nav"),"permalink"===t&&this.send("confluence.comment.inline.view.permalink")}),this.listenTo(u.a,"ic:overlap",function(){this.send("confluence.comment.inline.overlap")}),this.listenTo(u.a,"ic:edit",function(){this.send("confluence.comment.inline.edit")}),this.listenTo(u.a,"ic:persist",function(){this.send("confluence.comment.inline.create")}),this.listenTo(u.a,"ic:sidebar:close",function(){this.send("confluence.comment.inline.sidebar.close")}),this.listenTo(u.a,"ic:reply:persist",function(){this.send("confluence.comment.inline.reply")}),this.listenTo(u.a,"ic:delete ic:reply:delete",function(){this.send("confluence.comment.inline.delete")}),this.listenTo(u.a,"ic:resolved",function(){this.send("confluence.comment.inline.resolved")}),this.listenTo(u.a,"ic:unresolved",function(){this.send("confluence.comment.inline.unresolved")}),this.listenTo(u.a,"ic:resolved:view",function(e){var t={total:e};this.send("confluence.comment.inline.resolved.view",t)}),this.listenTo(u.a,"ic:resolved:dismiss:recovery",function(){this.send("confluence.comment.inline.resolved.dismiss")}),this.listenTo(u.a,"ic:resolved:show:recovery",function(){this.send("confluence.comment.inline.resolved.discovery")}),this.listenTo(u.a,"ic:open:dangled",function(e){var t={commentId:e.get("id"),pageId:a.a.Meta.get("page-id")};this.send("confluence.comment.inline.open.dangled",t)}),this.listenTo(u.a,"ic:editor:load:fail",function(){var e={pageId:a.a.Meta.get("page-id")};this.send("confluence.comment.inline.editor.load.fail",e)}),this.listenTo(u.a,"ic:resolve:dangled:failed",function(e){var t={commentId:e.get("id"),pageId:a.a.Meta.get("page-id")};this.send("confluence.comment.inline.resolved.dangled.failed",t)}))},D.stop=function(){this.running=!1,this.stopListening()};var H=D,$=(i("wS3D"),"ic-current-selection");function _(){o.a.textHighlighter.createWrapper=function(e){return o()("<span></span>").addClass(e.highlightedClass)},this.$el=o()("[data-inline-comments-target=true]").first(),this.$el.length>0&&this.$el.textHighlighter({highlightedClass:$})}_.prototype.highlight=function(e){if(0!==this.$el.length){var t=o()(this.$el.getHighlighter().doHighlight(e));return this.$el.getHighlighter().serializeHighlights(t)}},_.prototype.removeHighlight=function(){if(0!==this.$el.length)return this.$el.getHighlighter().removeHighlights(),this},_.prototype.deserializeHighlights=function(e,t){if(0!==this.$el.length){var i='<span class="inline-comment-marker" data-ref="'.concat(t,'"></span>');return this.$el.getHighlighter().deserializeHighlights(e,i)}};var A=_;function N(e,t){return'<div class="ic-sidebar-heading"><div id="ic-nav-container">'.concat(1==e.createComment?F({disabled:!0,showIndex:!1},t):"",'</div><div class="ic-right-toolbar">').concat(e.showMenu?function(e,t){return"".concat(e.darkFeatures.INLINE_COMMENTS&&(e.hasDeletePermission||e.hasReplyPermission||e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS)?l.a.aui.buttons.button({type:"subtle",extraClasses:"aui-button-compact aui-dropdown2-trigger-arrowless aui-style-default ic-action-menu",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-more",text:"",dropdown2Target:"ic-menu-items"})+l.a.aui.dropdown2.contents({id:"ic-menu-items",extraClasses:"aui-style-default",content:'<ul class="aui-list-truncate">'.concat(e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?'<li class="ic-action-resolve"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolve"})),"</a></li>"):"").concat(e.hasReplyPermission?'<li class="ic-action-reply"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.reply"})),"</a></li>"):"").concat(e.hasEditPermission?'<li class="ic-action-edit"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.edit"})),"</a></li>"):"").concat(e.hasDeletePermission?'<li class="ic-action-delete"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.delete"})),"</a></li>"):"","</ul>")}):"")}(e,t):"").concat(l.a.aui.buttons.button({type:"text",extraClasses:"aui-button-text ic-action-hide",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-close-dialog",text:"",extraAttributes:{title:t({id:"inline.comments.sidebar.tooltip.close.description"})}}),'</div></div><div class="ic-error"></div>')}function O(e,t){var i=function(e){return"".concat(""==e.authorAccountId?l.a.aui.avatar.avatar({size:e.size,avatarImageUrl:e.authorAvatarUrl,extraClasses:"ic-author-avatar"}):'<a data-account-id="'.concat(l.a.soy.$$escapeHtml(e.authorAccountId),'" href="').concat(l.a.soy.$$escapeHtml("/people"),"/").concat(l.a.soy.$$escapeHtml("".concat(e.authorAccountId,"?ref=confluence")),'" title="" data-user-hover-bound="true">').concat(l.a.aui.avatar.avatar({size:e.size,avatarImageUrl:e.authorAvatarUrl,extraClasses:"ic-author-avatar"}),"</a>"))}({authorAvatarUrl:e.authorAvatarUrl,authorAccountId:e.authorAccountId,size:"small"}),n=function(e){return"".concat(e.accountId&&""!=e.accountId?'<a href="'.concat(function(e){return"".concat(l.a.soy.$$escapeHtml("/people"),"/").concat(l.a.soy.$$escapeHtml("".concat(e.accountId,"?ref=confluence")))}(e),'"').concat(e.canView?'class="url fn confluence-userlink" data-account-id="'.concat(l.a.soy.$$escapeHtml(e.accountId),'"'):'class="url fn"',">").concat(l.a.soy.$$escapeHtml(e.fullName),"</a>"):l.a.soy.$$escapeHtml("Anonymous"))}({canView:!!e.authorAccountId,fullName:e.authorDisplayName,accountId:e.authorAccountId});return'<div class="ic-author">'.concat(i).concat(n,"</div>")}function V(e,t){var i='<div class="ic-container ic-create-comment">'.concat(O(e),'<div class="ic-body"><form class="aui" action="">');if(e.darkFeatures.RICH_TEXT_EDITOR)i+='<div class="loading-container" />';else{var n="".concat("reply"==e.type?l.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"})):l.a.soy.$$escapeHtml(t({id:"inline.comments.create.placeholder"})));i+='<textarea class="textarea ic-textarea" name="body" placeholder="'.concat(l.a.soy.$$escapeHtml(n),'">').concat(l.a.soy.$$escapeHtml(e.text),'</textarea><div class="ic-actions"><ul><li>').concat(l.a.aui.buttons.button({tagName:"button",text:t({id:"inline.comments.sidebar.save"}),type:"link",extraClasses:"ic-action-save",isDisabled:!0}),"</li>").concat("topLevel"!=e.type?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),type:"link",extraClasses:"ic-action-discard"}),"</li>"):"","</ul></div>")}return i+="</form></div></div>"}function L(e,t){return'<div data-comment-id="'.concat(l.a.soy.$$escapeHtml(e.id),'" class="ic-container ic-display-comment">').concat(O(e),'<div class="ic-body wiki-content"><div class="ic-content">').concat(e.resolveProperties.resolved?'<blockquote><span class="ic-resolved-marker">'.concat(l.a.soy.$$escapeHtml(e.originalSelection),"</span></blockquote>"):"").concat(l.a.soy.$$filterNoAutoescape(e.body),"</div></div>").concat(e.resolveProperties.resolved?function(e,t){return"".concat(e.darkFeatures.INLINE_COMMENTS?'<div class="ic-actions"><ul class="aui-list-truncate">'.concat(e.hasResolvePermission&&!e.isDangling?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.resolved.menu.unresolve"}),type:"link",extraClasses:"ic-action-unresolve"}),"</li>"):"",'<li class="hidden">').concat(l.a.aui.buttons.button({type:"link",extraClasses:"ic-action-show-reply"}),"</li>").concat((e.hasReply,"")).concat(e.resolveProperties.resolvedTime>0?'<li class="ic-resolved-message">'.concat(l.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"success"}),"  <span>").concat(U({time:"".concat(e.isDangling&&e.resolveProperties.resolvedByDangling?l.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.dangling.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate})):l.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate}))),commentUrl:e.commentDateUrl}),"</span></li>"):"","</ul></div>"):"")}(e,t):function(e,t){return"".concat(e.darkFeatures.INLINE_COMMENTS?'<div class="ic-actions"><ul class="aui-list-truncate">'.concat(e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.resolve"}),type:"link",extraClasses:"ic-action-resolve"}),"</li>"):"",'<li class="ic-action-like"></li><li class="ic-date">').concat(U({time:e.lastModificationDate,commentUrl:e.commentDateUrl}),"</li></ul></div>"):"")}(e,t),"</div>").concat(!e.resolveProperties.resolved&&e.resolveProperties.resolvedTime>0&&e.resolveProperties.resolvedUser?'<div class="ic-unresolved-message">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.unresolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate})),"</div>"):"")}function F(e,t){return"".concat(l.a.aui.buttons.button({type:"text",id:"ic-nav-next",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-down",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.next.ic.description"})}})).concat(l.a.aui.buttons.button({type:"text",id:"ic-nav-previous",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-up",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.previous.ic.description"})}})).concat(e.showIndex?'<span class="ic-nav-x-out-of-y">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.navigation.index.of"},{0:e.index,1:e.size})),"</span>"):"")}function U(e){return'<a class="ic-date-link" title="'.concat(l.a.soy.$$escapeHtml(e.time),'" href="').concat(l.a.soy.$$escapeHtml("/wiki".concat(e.commentUrl)),'"><span>').concat(l.a.soy.$$escapeHtml(e.time),"</span></a>")}var z={comment:L,commentForm:V,confirmDialog:function(e,t){return'<strong class="ic-confirm-label">'.concat(l.a.soy.$$escapeHtml(e.label),'</strong><div class="ic-confirm-message">').concat(l.a.soy.$$escapeHtml(e.message),'</div><div class="ic-confirm-buttons">').concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),tagName:"button",extraClasses:["ic-action-delete-confirm","aui-button-compact"]})).concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),tagName:"button",type:"link",extraClasses:["ic-action-cancel-confirm","aui-button-compact"]}),"</div>")},createComment:function(e,t){return'<div class="ic-comment-container">'.concat("topLevel"==e.type||"pageComment"==e.type?N({showMenu:!1,createComment:!0,darkFeatures:e.darkFeatures},t):"").concat(V(e,t),"</div>")},deleteComment:function(e){return'<div class="ic-comment-container ic-deleted">'.concat(N({createComment:!1,showMenu:!1},e),'<div class="ic-delete-comment-view"><h2><span class="aui-icon ic-delete-image line">::before</span>').concat(l.a.soy.$$escapeHtml(e({id:"inline.comments.sidebar.deleted"})),"</h2></div></div>")},displayComment:function(e,t){return'<div class="ic-comment-container">'.concat(N({hasDeletePermission:e.hasDeletePermission,hasResolvePermission:e.hasResolvePermission,hasEditPermission:e.hasEditPermission,hasReplyPermission:e.hasReplyPermission,showMenu:e.showMenu&&!e.resolveProperties.resolved,darkFeatures:e.darkFeatures},t)).concat(e.resolveProperties.resolved?function(e,t){return'<div class="ic-resolved-mask"><div class="ic-resolved-mask-content"><h2 class="ic-resolved-icon">'.concat(l.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})).concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolved"})),'</h2></div><div class="resolved-message-container"><div class="resolved-message-sideline"><p>').concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.message"})),"</p>").concat(l.a.aui.buttons.button({text:t({id:"adg3.onboarding.docs.link"}),href:"https://confluence.atlassian.com/display/ConfCloud/Comment+on+pages+and+blog+posts#Commentonpagesandblogposts-Resolveinlinecomments",type:"link",extraAttributes:{target:"_blank"},id:"show-resolved-comments"}),"</div></div></div>")}(0,t):L(e,t),"</div>").concat(e.resolveProperties.resolved?"":'<div class="ic-list"></div><div class="ic-reply-container">'.concat(e.darkFeatures.INLINE_COMMENTS&&e.hasReplyPermission?'<div class="ic-reply-placeholder">'.concat(O({authorAvatarUrl:e.currentAuthorAvatarUrl,authorDisplayName:e.currentAuthorDisplayName,authorAccountId:e.currentAuthorAccountId,isGDPRInlineCommentsEnabled:e.isGDPRInlineCommentsEnabled}),'<div class="ic-body"><form class="aui"><textarea class="textarea ic-textarea" name="body" placeholder="').concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"})),'"></textarea></form></div></div>'):"","</div>"))},highlightTextLink:function(e){return"".concat(l.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"link"}),"<a href='").concat(l.a.soy.$$escapeHtml(e.link),"'>").concat(l.a.soy.$$escapeHtml(e.link),"</a>")},likes:function(e,t){return"".concat(e.showLikeButton?l.a.aui.buttons.button({text:e.isLikedByUser?t({id:"inline.comments.likes.unlike"}):t({id:"inline.comments.likes.like"}),type:"link",extraClasses:"ic-like-button"}):"").concat(e.likesCount>0?'<span class="ic-like-summary"><span class="ic-small-like-icon"></span><a class="ic-likes-count" data-content-id="'.concat(l.a.soy.$$escapeHtml(e.contentId),'"><span class="ic-like-summary">').concat(l.a.soy.$$escapeHtml(e.likesCount),"</span></a></span>"):"")},navigation:F,pageComment:function(e,t){return'<div class="ic-comment-container">'.concat(N({createComment:!1,showMenu:!1},t),'<div class="ic-page-comment-view"><div class="ic-page-comment"><div class="ic-page-comment-content"><h2 class="ic-resolved-icon">').concat(l.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})).concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.saved"})),'</h2></div><div class="ic-page-comment-message-container"><div class="ic-page-comment-message-sideline"><p>').concat(l.a.soy.$$escapeHtml(t({id:"page.comments.saved.dialog.message"})),'</p><button id="show-page-comment" class="aui-button aui-button-link" data-comment-id="').concat(l.a.soy.$$escapeHtml(e.commentId),'">').concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.show.me"})),"</button></div></div></div></div></div>")},renderReply:function(e,t){return"".concat(O(e),'<div class="ic-body wiki-content"><div class="ic-content ic-reply-content">').concat(l.a.soy.$$filterNoAutoescape(e.body),"</div></div>").concat(e.darkFeatures.INLINE_COMMENTS&&!e.resolved?function(e,t){return'<div class="ic-actions"><ul>'.concat(e.hasDeletePermission?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),type:"link",extraClasses:"ic-action-delete-reply"}),"</li>"):"").concat(e.hasEditPermission?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.edit"}),type:"link",extraClasses:"ic-action-edit-reply"}),"</li>"):"",'<li class="ic-action-like-reply"></li><li class="ic-date">').concat(U({time:e.lastModificationDate,commentUrl:e.commentDateUrl}),"</li></ul></div>")}(e,t):"<div>".concat(U({time:e.lastModificationDate,commentUrl:e.commentDateUrl}),"</div>"))},resolvedCommentDialog:function(e,t){return"".concat(l.a.aui.dialog.dialog2({id:"ic-resolved-comment-dialog",removeOnHide:!0,extraClasses:"ic-resolved-comment-dialog-content",modal:!0,titleText:t({id:"inline.comments.resolved.view.menu"}),footerActionContent:"".concat(l.a.aui.buttons.button({id:"resolved-dialog-close-button",text:t({id:"inline.comments.sidebar.close"}),type:"link"})),content:'\x3c!-- Placeholder for error message --\x3e<div id="ic-resolved-comment-dialog-error" />'}))},showmoreReply:function(e,t){return'<div id="ic-showmore-container"><div class="ic-decor-line"/><div class="ic-decor-line"/><div class="ic-collapse-decor-center"><span>'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.expand.replies"},{0:e.totalReplies})),"</span></div></div>")}},j=u.a.View.extend({el:"[data-inline-comments-target=true]:first",events:{"click .inline-comment-marker.valid":"commentClick","click span[data-mark-type=confluenceInlineComment].valid":"commentClick"},initialize:function(){this.collection&&(this.listenTo(this.collection,"sync remove change:deleted",this.render),this.listenTo(this.collection,"change:active",this.setActive)),this.listenTo(u.a,"ic:view ic:overlap ic:sidebar-hidden",this.clearSelection),this.listenTo(u.a,"ic:persist",this.persistComment),this.listenTo(u.a,"ic:delete",this.render),a.a.bind("qr:add-new-highlight-text".concat(".ic-highlight"),this._addQuickReloadMarker)},destroy:function(){a.a.unbind(".ic-highlight"),this.stopListening(),this.undelegateEvents()},render:function(){this.inlineLinks=[],this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment]").removeClass("valid"),this.collection.each(function(e){e.isResolved()||e.get("deleted")||!e.highlights||(e.highlights.addClass("valid"),this._pushToInlineLinks(e.highlights))},this),this._setupLinkDialog(),a.a.trigger("ic-highlight-rendered",this.collection)},_pushToInlineLinks:function(e){var t=this;e.each(function(){x.getInlineLinks(this).each(function(){o()(this).attr("href")&&t.inlineLinks.push(o()(this))})})},_setupLinkDialog:function(){var e={width:200,onHover:!0,noBind:!0,calculatePositions:this._calculatePositions,hideDelay:1e3};o()(this.inlineLinks).each(function(){var t=this;a.a.InlineDialog(t,"inline-comment-link",function(e,i,n){return e.addClass("inline-comment-link"),e.html(z.highlightTextLink({link:t.attr("href")})),n(),!1},e)})},_calculatePositions:function(e,t,i){return{displayAbove:!0,popupCss:{top:t.target.offset().top-e.height()-10,left:i.x-e.width()/2},arrowCss:{top:e.height(),left:e.width()/2-4}}},setActive:function(e){this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment]").removeClass("active");var t=this.$('.inline-comment-marker[data-ref="'.concat(e.get("markerRef"),'"],span[data-reference="').concat(e.get("markerRef"),'"]'));e.get("active")&&t.length&&t.addClass("active")},commentClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.$(e.currentTarget),i=t.parentsUntil(".active",".inline-comment-marker.valid");t.hasClass("active")?u.a.trigger("ic:hide-sidebar",e,!0):i.length>0?this.displayComment(i.last()):this.displayComment(t)},displayComment:function(e,t){var i=e.data("ref")||e.data("reference"),n=this.collection.findWhere({markerRef:i});u.a.trigger("ic:view",n,t)},clearSelection:function(){(new A).removeHighlight()},persistComment:function(e){this.$(".ic-current-selection").removeClass("ic-current-selection").addClass("inline-comment-marker").attr("data-ref",e.get("markerRef")),this.collection.add(e)},_addQuickReloadMarker:function(e,t,i){var n=t.comment;this.$('.inline-comment-marker[data-ref="'.concat(n.dataRef,'"],span[data-reference="').concat(n.dataRef,'"]')).length?i.resolve(t):(new A).deserializeHighlights(n.serializedHighlights,n.dataRef)?i.resolve(t):i.reject(t)}}),B=i("97Jx"),G=i.n(B),q=i("m3Bd"),W=i.n(q),J=i("ERkP"),Q=i.n(J),X=i("96U/"),Y=i("VrFO"),K=i.n(Y),Z=i("Y9Ll"),ee=i.n(Z),te=i("N+ot"),ie=i.n(te),ne=i("AuHH"),oe=i.n(ne),se=i("5Yy7"),ae=i.n(se),re=(i("aWzz"),i("3iG9")),ce=function(e){function t(){return K()(this,t),ie()(this,oe()(t).apply(this,arguments))}return ae()(t,e),ee()(t,[{key:"renderUserLink",value:function(){var e=this.props,t=e.userId,i=W()(e,["userId"]);return Q.a.createElement("a",G()({},i,{"data-account-id":t}),this.props.children)}},{key:"render",value:function(){var e=this.props.userId;return Q.a.createElement(re.a,{userId:e,isAnonymous:!e,canViewProfile:!0,position:"bottom-end"},this.renderUserLink())}}]),t}(J.Component);ce.displayName="InlineCommentHeader";var le=i("FErI"),de=function(e){var t=Array.from(e.el.querySelectorAll(".ic-author")).filter(function(e){return null!==e.querySelector(".confluence-userlink")}).map(function(e){return e.querySelector(".confluence-userlink")});Object(le.a)(t).forEach(function(e){var t=e.props,i=t["data-account-id"],n=W()(t,["data-account-id"]);Object(X.a)(Q.a.createElement(ce,G()({userId:i},n),e.props.children),e.placeholder)})},he=i("1Pcy"),me=i.n(he),ue=i("KEM+"),ge=i.n(ue),fe=i("9Kiz"),pe=function(e){function t(){var e,i;K()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return i=ie()(this,(e=oe()(t)).call.apply(e,[this].concat(o))),ge()(me()(i),"state",{inlineCommentBodyNode:null}),i}return ae()(t,e),ee()(t,[{key:"componentDidMount",value:function(){this._setInlineCommentBodyNode()}},{key:"_setInlineCommentBodyNode",value:function(){this.setState({inlineCommentBodyNode:this.props.node})}},{key:"render",value:function(){var e=this.props.body;return Q.a.createElement(J.Fragment,null,Q.a.createElement("p",{dangerouslySetInnerHTML:{__html:e}}),Q.a.createElement(fe.a,{node:this.state.inlineCommentBodyNode,position:"bottom-end"}))}}]),t}(J.Component);pe.displayName="InlineCommentBody";var ve=function(e){var t=e.el.querySelector(".ic-content");t&&Object(X.a)(Q.a.createElement(pe,{node:t,body:t.innerHTML}),t)},ye=i("LodO");function Ce(){a.a.Confluence.EditorLoader.resourcesLoaded()||this.$form.find(".loading-container").spin("small")}function be(){a.a.Meta.set("content-type","comment"),a.a.Meta.set("use-inline-tasks","false"),a.a.Meta.set("min-editor-height",80)}function we(e){e.$form.find(".loading-container").hide(),e.$form.find("#rte-button-publish").text(this.formatMessage({id:"inline.comments.sidebar.save"})).removeAttr("title"),e.$form.find("#toolbar-hints-draft-status").hide(),this.hideCancelButton&&e.$form.find("#rte-button-cancel").hide(),e.editor.onPostProcess.add(function(e,t){return function i(){l.a.tinymce.DOM.setStyle(l.a.tinymce.DOM.get("".concat(t.id,"_ifr")),"height","80px"),t.execCommand("mceAutoResize",{forceExec:!0}),t[e].remove(i)}}("onPostProcess",e.editor)),l.a.Confluence.Editor&&!l.a.Confluence.Editor.getContentType&&a.a.Confluence.QuickEdit.QuickEditPage.disable(),l.a.Confluence.Editor.removeAllCancelHandlers(),l.a.Confluence.Editor.removeAllSaveHandlers()}var Ee,ke,Te,Re={init:function(e){return this.formatMessage=e.formatMessage,a.a.Confluence.QuickEdit.activateEditor({preActivate:Ce,preInitialise:be,postInitialise:o.a.proxy(we,e),toolbar:!1,$container:e.container,$form:e.form,saveHandler:e.saveHandler,cancelHandler:e.cancelHandler,fetchContent:e.fetchContent(),closeAnyExistingEditor:!0,postDeactivate:e.postDeactivate,plugins:x.getSupportedRtePlugins(),excludePlugins:x.getUnsupportedRtePlugins()})},remove:function(){return a.a.Rte&&a.a.Rte.getEditor()?a.a.Confluence.QuickEdit.deactivateEditor():o.a.Deferred().resolve()},getContent:function(){return a.a.Rte.Content.getHtml()},setEditorBusy:function(e){e?o()(".ic-sidebar #rte-spinner").spin():o()(".ic-sidebar #rte-spinner").spinStop(),o()("#rte-button-publish").prop("disabled",e)}},xe=u.a.View.extend({tagName:"div",className:"ic-create-comment-view",events:{"click .ic-action-save":"saveComment","click .ic-action-discard":"discardComment","keyup .ic-textarea":"onInput","focus .ic-textarea":"onFocus","click #show-page-comment":"showPageComment"},template:z.createComment,initialize:function(e){this.formatMessage=e.formatMessage,this.selection=e.selection,this.type=e.type,this.onFinished=e.onFinished||function(){},this.commentText=e.commentText||"",this.stopFocus=e.stopFocus,this.serializedHighlights=e.serializedHighlights,"edit"!==e.type&&"reply"!==e.type||(this.template=z.commentForm,u.a.trigger("ic:discard-edit"),this.listenTo(u.a,"ic:discard-edit",this.discardComment)),x.isSPAPage()?(this.isTinymceResourceReady="true"===o()(".".concat(x.getPageContentClassName())).attr("data-editor-resource-loaded"),this.isPendingRenderEditor=!1,this.listenTo(u.a,"ic:tinymce-resource-loaded",this.tinymceResourceLoaded)):this.isTinymceResourceReady=!0},tinymceResourceLoaded:function(){this.isTinymceResourceReady=!0,this.isPendingRenderEditor&&(this.isPendingRenderEditor=!1,this.renderEditor())},finish:function(){this.onFinished(),a.a.trigger("ic-jim-async-supported")},render:function(){var e=this._getAuthorObject(),t={type:this.type,text:this.commentText,showMenu:!1,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled},i=h.a.extend({},e,t,{darkFeatures:x.getDarkFeatures()});return this.$el.html(this.template(i,this.formatMessage)),x.getDarkFeatures().RICH_TEXT_EDITOR?this.isTinymceResourceReady?this.renderEditor():(this.$(".loading-container").spin("small"),this.isPendingRenderEditor=!0):this.stopFocus||setTimeout(h.a.bind(this.focusEditor,this),1),"true"===this.options.isUnifiedProfileCardsEnabled&&de(this),x.addSidebarHeadingTooltip(this),this},onInput:function(e){var t=""!==this.$(e.target).val().trim();this._saveDisable(!t)},onFocus:function(){if("edit"===this.type){var e=this.$(".textarea");x.moveCaretToEnd(e[0]),this._saveDisable(""===e.text())}},saveComment:function(e){e.preventDefault(),this._isValid()&&(this._disableForm(),"reply"===this.type?this._addReply():"edit"===this.type?this._saveEdit():this._addComment())},_getAuthorObject:function(){var e,t,i;return"edit"===this.type?(e=this.model.get("authorAvatarUrl"),t=this.model.get("authorDisplayName"),i=this.model.get("authorAccountId")):(e=x.getAuthorAvatarUrl(),t=x.getAuthorDisplayName(),i=x.getAuthorAccountId()),{authorAvatarUrl:e,authorDisplayName:t,authorAccountId:i}},_saveEdit:function(){var e=this._getContent(),t={wait:!0,beforeSend:h.a.bind(this.beforeSendAjax,this),success:h.a.bind(this._onSaveSuccess,this),error:h.a.bind(this._showEditError,this)};this.model.save({body:e},t)},_showEditError:function(e,t){var i;this.showCaptchaError(t)||(i=401===t.status?this.formatMessage({id:"inline.comments.edit.permission"}):this.formatMessage({id:"inline.comments.server.edit.error"}),this._triggerError(i))},_triggerError:function(e,t){u.a.trigger("ic:error",e,t),this._disableForm(!1)},_addReply:function(){new M({body:this._getContent(),commentId:this.model.get("id"),hasDeletePermission:Boolean(a.a.Meta.get("atlassian-account-id"))||this.model.get("hasDeletePermission")}).save(null,{beforeSend:h.a.bind(this.beforeSendAjax,this),success:h.a.bind(this._onSaveSuccess,this),error:h.a.bind(function(e,t){this.showCaptchaError(t)||this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.reply"}))},this)})},_addComment:function(){var e=new I({originalSelection:this.selection.searchText.selectedText.replace(/\n/g,""),body:this._getContent(),matchIndex:this.selection.searchText.index,numMatches:this.selection.searchText.numMatches,serializedHighlights:this.serializedHighlights}),t={callback:this.bindPageReloadLink};e.save(null,{beforeSend:h.a.bind(this.beforeSendAjax,this),success:h.a.bind(this._onSaveSuccess,this),error:h.a.bind(function(e,i){this.showCaptchaError(i)||(409===i.status?this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.stale"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),t):412===i.status?(a.a.trigger("analytics",{name:"confluence.comment.inline.cannot.create"}),this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.create.comment"}))):this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.comment"})))},this)})},_isValid:function(){return"<p><br /></p>"!==o.a.trim(this._getContent())||(u.a.trigger("ic:error",this.formatMessage({id:"inline.comments.sidebar.comment.empty"})),!1)},_onSaveSuccess:function(e){switch(this.type){case"topLevel":e.set("hasDeletePermission",!0),u.a.trigger("ic:persist",e),u.a.trigger("ic:view",e,void 0,{ignoreConfirmDialog:!0});break;case"reply":this.model.replies.push(e),u.a.trigger("ic:reply:persist",e),this.finish();break;case"edit":u.a.trigger("ic:edit"),this.finish()}this.trackAnalyticEvent(e,this.type)},_setEditorIsNotDirty:function(){a.a.Rte.getEditor()&&(a.a.Rte.getEditor().isNotDirty=1)},_disableForm:function(e){void 0===e&&(e=!0),this._saveDisable(e),x.getDarkFeatures().RICH_TEXT_EDITOR||this.$(".ic-action-discard,.ic-textarea").prop("disabled",e).attr("aria-disabled",e)},_saveDisable:function(e){x.getDarkFeatures().RICH_TEXT_EDITOR?(Re.setEditorBusy(e),o()("#rte-button-cancel")[0].disabled=e):this.$(".ic-action-save").prop("disabled",e).attr("aria-disabled",e)},renderEditor:function(){var e=this.$(".ic-body"),t=this.commentText,i=a.a.Confluence.QuickEdit.QuickComment;if(a.a.Confluence.QuickEdit)try{a.a.Confluence.QuickEdit.deactivateEditor()}catch(e){}return Re.init({formatMessage:this.formatMessage,container:e,form:e.find("form.aui"),saveHandler:"pageComment"===this.type?i.createSaveHandler(h.a.bind(this._successCreatePageComment,this),i.saveCommentErrorHandler):h.a.bind(this.saveComment,this),cancelHandler:h.a.bind(this.discardComment,this),fetchContent:function(){var e=new o.a.Deferred;return e.resolve({editorContent:t}),e},postDeactivate:h.a.bind(function(){u.a.trigger("ic:clearError"),this.finish()},this),hideCancelButton:"topLevel"===this.type}).done(h.a.bind(this.renderEditorCompleted,this)).fail(h.a.bind(this.renderEditorFail,this))},showPageComment:function(e){var t=o()(e.target).data("comment-id"),i=o()("#comment-".concat(t));i.addClass("focused"),i.scrollToElement()},_successCreatePageComment:function(e){l.a.Confluence.CommentDisplayManager.addComment(x.getCurrentUserInfo(),e,!1,!1,!0),a.a.trigger("page.commentAddedOrUpdated",{commentId:e.id}),this._setEditorIsNotDirty(),x.getDarkFeatures().RICH_TEXT_EDITOR&&(this.keepSidebar=!0,Re.remove()),this.$el.html(z.pageComment({commentId:e.id},this.formatMessage)),x.addSidebarHeadingTooltip(this)},renderEditorCompleted:function(){u.a.trigger("ic:clearError"),"topLevel"!==this.type&&"pageComment"!==this.type||(this.$("#rte-button-cancel").hide(),"pageComment"===this.type&&(u.a.trigger("ic:error",this.formatMessage({id:"page.comments.sidebar.warning"})),this.focusEditor())),this.captchaManager=new a.a.Confluence.QuickEditCaptchaManager(a.a.Confluence.EditorLoader.getEditorForm())},renderEditorFail:function(){var e={closeable:!0,callback:this.bindPageReloadLink};switch(this.type){case"pageComment":this._setEditorIsNotDirty();break;case"topLevel":this.$(".loading-container").hide(),this.$(".ic-create-comment").hide(),e.closeable=!1;break;case"edit":case"reply":this.finish()}u.a.trigger("ic:error",this.formatMessage({id:"inline.comments.editor.timeout"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),e),u.a.trigger("ic:editor:load:fail")},bindPageReloadLink:function(){o()(".ic-error").off("click",".ic-reload-page").on("click",".ic-reload-page",function(){return l.a.location.reload(),!1})},discardComment:function(e){e&&e.preventDefault(),u.a.trigger("ic:clearError"),this.finish()},_getContent:function(){return x.getDarkFeatures().RICH_TEXT_EDITOR?Re.getContent():this.$("textarea").val()},focusEditor:function(){if(x.getDarkFeatures().RICH_TEXT_EDITOR)if("pageComment"===this.type){var e=o()(a.a.Rte.getEditor()&&a.a.Rte.getEditor().getBody()).find("div")[0];a.a.Rte.getEditor().selection.select(e,1),a.a.Rte.getEditor().selection.collapse(1),e.focus()}else a.a.Rte.getEditor()&&a.a.Rte.getEditor().focus();else this.$(".ic-textarea:visible").focus()},destroy:function(){x.getDarkFeatures().RICH_TEXT_EDITOR&&Re.remove(),this.remove()},beforeSendAjax:function(e){var t=this.captchaManager.getCaptchaData();t&&t.id&&(e.setRequestHeader("X-Atlassian-Captcha-Id",t.id),e.setRequestHeader("X-Atlassian-Captcha-Response",t.response))},showCaptchaError:function(e){return!(404!==e.status||!e.responseText||-1==e.responseText.search(/captcha/i))&&(this.captchaManager.refreshCaptcha(),this._triggerError(this.formatMessage({id:"captcha.response.failed"})),!0)},trackAnalyticEvent:function(e,t){var i,n,s;try{i=e.attributes.id.toString(),n=e.changed.active?null:e.attributes.commentId.toString(),s=o()(".view-page-body").get(0).dataset.spaceId}catch(e){}var r={containerType:"space",containerId:s,source:"viewPageScreen",objectType:"page",objectId:a.a.Meta.get("content-id"),action:"edit"===t?"updated":"created",actionSubject:"comment",actionSubjectId:i,attributes:{commentType:"inline",pageType:a.a.Meta.get("draft-type"),parentCommentId:n}};Object(ye.a)().then(function(e){e.sendTrackEvent(r)})}}),Me=u.a.View.extend({tagName:"div",className:"ic-confirm-container",initialize:function(e){this.formatMessage=e.formatMessage,this.$menuEl=e.$menuEl,this.$bodyEl=e.$bodyEl,this.$menuEl.addClass("ic-action-menu-active"),this.render(),h.a.bindAll(this,"clickOutside"),this.$bodyEl.on("click",this.clickOutside)},events:{"click .ic-action-cancel-confirm":"cancel","click .ic-action-delete-confirm":"confirm"},template:z.confirmDialog,render:function(){return this.$el.html(this.template(this.model.toJSON(),this.formatMessage)),this},clickOutside:function(e){o.a.contains(this.el,e.target)||this.el===e.target||this.cancel()},cancel:function(){this.destroy()},confirm:function(){this.trigger("ic:confirm"),this.destroy()},destroy:function(){this.$bodyEl.off("click",this.clickOutside),this.$menuEl.removeClass("ic-action-menu-active"),this.remove()}}),Se=i("1vxf"),Ie=u.a.View.extend({className:"ic-likes",render:function(){return this.el&&Object(X.a)(Q.a.createElement(Se.a,{contentId:"".concat(this.options.contentId),contentType:"comment",containerId:"".concat(this.options.containerId),containerType:this.options.containerType,isForInlineComment:!0}),this.el),this}}),Pe=u.a.View.extend({tagName:"div",className:"ic-display-reply",template:z.renderReply,events:{"click .ic-action-edit-reply":"editReply","click .ic-action-delete-reply":"confirmDelete"},initialize:function(e){this.formatMessage=e.formatMessage,h.a.bindAll(this,"onEditCallback"),this.$el.attr("data-comment-id",this.model.get("id"))},_renderLikes:function(){var e=this,t=this.el&&this.el.querySelector(".ic-action-like-reply");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(function(i){i?(e.likesView&&e.likesView.remove(),e.likesView=new Ie({contentId:e.model.id,el:t}).render()):t&&t.remove()}):t&&t.remove()},render:function(){var e=h.a.extend(this.model.toJSON(),{resolved:this.options.resolved,darkFeatures:x.getDarkFeatures(),isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled}),t=this.template(e,this.formatMessage);return this.$el.html(t),this._renderLikes(),"true"===this.options.isUnifiedProfileCardsEnabled&&(de(this),ve(this)),this},editReply:function(e){var t=this;x.confirmProcess(this.formatMessage)?x.getEditorFormat(this.model.get("id")).done(function(e){t.editView=new xe({model:t.model,type:"edit",selection:{},onFinished:t.onEditCallback,commentText:e,formatMessage:t.formatMessage,isGDPRInlineCommentsEnabled:t.options.isGDPRInlineCommentsEnabled,isUnifiedProfileCardsEnabled:t.options.isUnifiedProfileCardsEnabled}),t.$el.html(t.editView.$el),t.editView.render()}).fail(function(){u.a.trigger("ic:error",t.formatMessage({id:"inline.comments.server.error.edit.reply"}))}):e&&e.currentTarget.blur()},onEditCallback:function(){this.editView&&this.editView.destroy(),this.editView=null,this.render()},deleteFail:function(e,t){401===t.status?u.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.permission"})):u.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},confirmDelete:function(e){!0===l.a.confirm(this.formatMessage({id:"inline.comments.delete.reply.confirmation.message"}))&&this.deleteReply(e)},deleteReply:function(e){o()(e.target).attr("aria-disabled",!0).prop("disabled",!0),this.model.destroy({wait:!0,error:this.deleteFail,success:function(){u.a.trigger("ic:reply:delete")}})},destroy:function(){this.likesView&&this.likesView.remove(),this.editView&&this.editView.destroy(),this.remove()}}),De=u.a.View.extend({tagName:"div",className:"ic-replies",events:{"click #ic-showmore-container":"forceShowAllReplies"},initialize:function(e){if(this.formatMessage=e.formatMessage,!e.commentModel)throw new Error("Inline Comment Model should be passed as a parameter when init ReplyListView","ReplyListView");this.replyViews=[],this.collection=e.commentModel.replies,this.source=e.source,this.listenTo(this.collection,"add remove",this.render),!0!==this.collection.isFetched&&(this.listenToOnce(this.collection,"sync",this.fetchComplete),this.collection.fetch({reset:!0,cache:!1})),this.expandReplies=!1,this.COMMENT_NUMBER_TO_COLLAPSE=4},fetchComplete:function(){this.collection.isFetched=!0,this.render(),x.resizeContentAfterLoadingImages(this.$el)},render:function(e){return!0!==this.collection.isFetched?this:e&&this.collection.last()===e?void this.appendReply(e):(this.cleanUpReplyViews(),this.$el.empty(),this.collection.length>this.COMMENT_NUMBER_TO_COLLAPSE&&!1===this.expandReplies&&"permalink"!==this.source&&this.options.commentModel&&!this.options.commentModel.isResolved()?this.renderCollapsibleReplies():this.renderFullReplies(),this.trigger("ic:reply-rendered",this.options.commentModel),this._hightlightReply(),a.a.trigger("ic-jim-async-supported"),this)},renderFullReplies:function(){this.collection.each(function(e){this.appendReply(e)},this)},forceShowAllReplies:function(){this.expandReplies=!0,this.render()},renderCollapsibleReplies:function(){this.renderExpendButton();var e=this.collection.last();this.appendReply(e)},appendReply:function(e){var t=this.createReplyView(e);this.replyViews.push(t),this.$el.append(t.render().el)},renderExpendButton:function(){this.$el.append(z.showmoreReply({totalReplies:this.collection.length-1},this.formatMessage))},createReplyView:function(e){return new Pe({formatMessage:this.formatMessage,model:e,resolved:this.options.commentModel.isResolved(),shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled})},_hightlightReply:function(){if("permalink"===this.source){var e=l.a.location.search.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null!=e){var t=parseInt(e[2],10);t&&0!==t&&this.$("[data-comment-id=".concat(t,"]")).addClass("ic-comment-reply-highlight")}}},cleanUpReplyViews:function(){var e;for(e=0;e<this.replyViews.length;e++)this.replyViews[e].destroy(),this.replyViews[e]=null;this.replyViews=[]},destroy:function(){this.cleanUpReplyViews(),this.remove()}}),He=!1,$e=u.a.View.extend({tagName:"div",events:{"click #ic-nav-previous":"showPrevious","click #ic-nav-next":"showNext"},template:z.navigation,initialize:function(e){this.formatMessage=e.formatMessage,this.collection=this.model.collection,this.listenTo(this.collection,"change:resolveProperties",this.onResolveToggle),this.disabled=this.collection.getCommentsOnPageCount()<=1,this.listenTo(u.a,"ic:show-previous",this.showPrevious),this.listenTo(u.a,"ic:show-next",this.showNext)},render:function(){return this.$el.html(this.template({disabled:this.disabled,showIndex:!(this.model.isResolved()||this.model.get("deleted")),index:this.collection.getActiveIndexWithinPageComments()+1,size:this.collection.getCommentsOnPageCount()},this.formatMessage)),this},onResolveToggle:function(){this.disabled=this.collection.getCommentsOnPageCount()<=1,this.render()},showPrevious:function(e){if(!this.disabled&&!He){var t=this.collection.getPrevCommentOnPage();null!=t&&u.a.trigger("ic:view",t,"nav"),e.view||(He=!0,setTimeout(function(){He=!1},500))}},showNext:function(e){if(!this.disabled&&!He){var t=this.collection.getNextCommentOnPage();null!=t&&u.a.trigger("ic:view",t,"nav"),e.view||(He=!0,setTimeout(function(){He=!1},500))}}}),_e=u.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:z.displayComment,events:{"click .ic-action-reply":"replyComment","click .ic-action-resolve":"resolveComment","click .ic-action-edit":"editComment","click #show-resolved-comments":"showResolvedDialogDiscovery","click .ic-reply-placeholder .textarea":"replyComment","focus .ic-reply-container .textarea":"onReplyPlaceholderFocus"},initialize:function(e){this.formatMessage=e.formatMessage,h.a.bindAll(this,"confirm","destroy","deleteFail","replyComment","resolveComment","editComment","renderCommentOnly"),this.model.set("active",!0),this.listenTo(this.model,"change:resolveProperties",this.render),this.listenTo(this.model,"remove",this.destroy),o()("body").on("click",".ic-action-delete a",this.confirm),o()("body").on("click",".ic-action-reply a",this.replyComment),o()("body").on("click",".ic-action-resolve a",this.resolveComment),o()("body").on("click",".ic-action-edit a",this.editComment),this.replyListView=new De({formatMessage:this.formatMessage,commentModel:this.model,source:e.source,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled})},render:function(){return this.$el.html(this.template(h.a.extend(this.model.toJSON(),{showMenu:!0,currentAuthorAvatarUrl:x.getAuthorAvatarUrl(),currentAuthorDisplayName:x.getAuthorDisplayName(),currentAuthorAccountId:x.getAuthorAccountId(),darkFeatures:x.getDarkFeatures(),isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled}),this.formatMessage)),this.model.isResolved()?this.$(".ic-comment-container").addClass("ic-resolved"):this.$(".ic-list").append(this.replyListView.render().el),this._renderNavigation(),this._renderLikes(),x.addSidebarHeadingTooltip(this),"true"===this.options.isUnifiedProfileCardsEnabled&&(de(this),ve(this)),this},_renderNavigation:function(){this.navigationView&&this.navigationView.remove(),this.navigationView=new $e({model:this.model,formatMessage:this.formatMessage}),this.navigationView.render(),this.$("#ic-nav-container").html(this.navigationView.el)},_renderLikes:function(){var e=this,t=this.el&&this.el.querySelector(".ic-action-like");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(function(i){i?(e.likesView&&e.likesView.remove(),e.likesView=new Ie({contentId:e.model.id,containerId:e.model.get("containerId"),containerType:e.model.get("containerType"),el:t}).render()):t&&t.remove()}):t&&t.remove()},editComment:function(e){var t=this;(e.preventDefault(),this.editView)?this.editView.focusEditor():x.confirmProcess(this.formatMessage)&&x.getEditorFormat(this.model.get("id")).done(function(e){t.editView=new xe({model:t.model,type:"edit",selection:{},onFinished:t.renderCommentOnly,commentText:e,formatMessage:t.formatMessage,isGDPRInlineCommentsEnabled:t.options.isGDPRInlineCommentsEnabled,isUnifiedProfileCardsEnabled:t.options.isUnifiedProfileCardsEnabled}),t.$(".ic-display-comment").html(t.editView.$el),t.editView.render()}).fail(function(){u.a.trigger("ic:error",t.formatMessage({id:"inline.comments.server.error.edit.comment"}))})},renderCommentOnly:function(){this.editView&&this.editView.destroy(),this.editView=null;var e=h.a.extend(this.model.toJSON(),{darkFeatures:x.getDarkFeatures()});this.$(".ic-display-comment").html(o()(z.comment(e,this.formatMessage)).children()),this._renderLikes()},replyComment:function(e){e&&e.preventDefault(),this.createReplyView?this.createReplyView.focusEditor():x.confirmProcess(this.formatMessage)?(this.createReplyView=new xe({formatMessage:this.formatMessage,model:this.model,type:"reply",isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,onFinished:h.a.bind(function(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null},this),isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled}),this.$(".ic-reply-container").prepend(this.createReplyView.$el),this.createReplyView.render()):e&&e.currentTarget.blur()},confirm:function(e){if(e.preventDefault(),this.model.replies.length>0)return u.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.with.reply"})),!1;var t=new Me({formatMessage:this.formatMessage,model:new u.a.Model({label:this.formatMessage({id:"inline.comments.sidebar.delete"}),message:this.formatMessage({id:"inline.comments.delete.confirmation.message"})}),$menuEl:o()(".ic-action-menu"),$bodyEl:o()("body")});this.$(".ic-sidebar-heading").append(t.$el),this.listenTo(t,"ic:confirm",this.deleteComment)},deleteComment:function(){var e=this;this.model.destroy({wait:!0,success:function(){e.$el.html(z.deleteComment(e.formatMessage)),e.model.set("deleted",!0),e._renderNavigation(),x.removeInlineLinksDialog(e.model.highlights),x.addSidebarHeadingTooltip(e),u.a.trigger("ic:delete")},error:this.deleteFail})},deleteFail:function(e,t){401===t.status?u.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.permission"})):409===t.status?u.a.trigger("ic:error",t.responseText):u.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},destroy:function(e){o()("body").off("click",".ic-action-delete a",this.confirm),o()("body").off("click",".ic-action-reply a",this.replyComment),o()("body").off("click",".ic-action-resolve a",this.resolveComment),o()("body").off("click",".ic-action-edit a",this.editComment),this.createReplyView&&this.createReplyView.destroy(),this.editView&&this.editView.destroy(),this.replyListView.destroy(),this.navigationView&&this.navigationView.remove(),this.likesView&&this.likesView.remove(),!0!==e&&this.remove()},resolveComment:function(e){e&&e.preventDefault(),x.confirmProcess(this.formatMessage,!0)&&this.model.resolve(!0,{wait:!0,success:h.a.bind(this.onResolveComplete,this),error:this.onResolveFail})},onResolveComplete:function(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null,u.a.trigger("ic:resolved"),x.removeInlineLinksDialog(this.model.highlights)},onResolveFail:function(e,t){401===t.status?u.a.trigger("ic:error",this.formatMessage({id:"inline.comments.resolve.permission"})):u.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},showResolvedDialogDiscovery:function(){u.a.trigger("ic:resolved:show:recovery")},onReplyPlaceholderFocus:function(e){x.getDarkFeatures().RICH_TEXT_EDITOR&&(-1!==navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&e.currentTarget.blur())}}),Ae=u.a.View.extend({tagName:"div",className:"ic-sidebar",events:{"click button.ic-action-hide":function(e){this.hide(e,!0),u.a.trigger("ic:sidebar:close")},"updateYPosition .ic-display-comment-view > .ic-comment-container":function(){this.setSidebarYPos()},"requestInlineCommentsClose .ic-display-comment-view > .ic-comment-container":function(e){var t,i=e.originalEvent.detail;if(null!=this.commentView)t=this.commentView.model.highlight;else{if(null==this.createCommentView)return;t=o()(".ic-current-selection")}i.parentElement.contains(t[0])&&(!1===this.hide(null,!0)?e.preventDefault():u.a.trigger("ic:sidebar:close"))}},initialize:function(e){e=e||{};var t=this;this.shouldSqueeze=e.shouldSqueeze,this.formatMessage=e.formatMessage,this.listenTo(u.a,"ic:view ic:overlap",this.displayComment),this.listenTo(u.a,"ic:create",this.displayCreateComment),this.listenTo(u.a,"ic:error",this.displayError),this.listenTo(u.a,"ic:hide-sidebar",this.hide),this.listenTo(u.a,"ic:clearError",this.clearError),x.getDarkFeatures().RICH_TEXT_EDITOR?a.a.bind("rte-quick-edit-ready".concat(".ic-sidebar"),function(){var e=t.$el.find("#wysiwygTextarea_ifr");0!==e.length?(new MutationObserver(function(){e.resize()}).observe(e[0],{attributes:!0,attributeFilter:["style"]}),a.a.Rte.getEditor().getContent()||t._scrollToEditorView(e)):t.$el.is(":visible")||(t.$wikiContent.css("position","static"),g.destroy())}):a.a.bind("init.rte".concat(".ic-sidebar"),h.a.bind(this.hideInEditMode,this)),this.defaultNavOffset=130,this.defaultPermalinkedCommentOffset=100,this.$wikiContent=e.$wikiContent||o()("[data-inline-comments-target=true]").first(),this.sidebarObserver=new MutationObserver(h.a.bind(this.setSidebarYPos,this)),this.sidebarObserver.observe(this.el,{childList:!0,subtree:!0}),o()(l.a).on("resize".concat(".ic-sidebar"),h.a.debounce(h.a.bind(this.setSidebarYPos,this),100)),a.a.bind("sidebar.expanded sidebar.collapsed".concat(".ic-sidebar"),h.a.debounce(h.a.bind(this.setSidebarYPos,this),50)),o()("#confluence-ui .wrapper-space-view-page").length>0&&this.$el.addClass("ic-is-spa-view-page")},destroy:function(){a.a.unbind(".ic-sidebar"),o()(l.a).off(".ic-sidebar"),this.hide(),this.remove()},displayComment:function(e,t,i){var n=function(){var n=this;if(!e.highlight.is(":hidden")||(x.showHighlightContent(e.highlight),!e.highlight.is(":hidden"))){this.distanceToTop=this.previousHighlightOffset||this.defaultNavOffset,this._emptySidebar(!0),this.commentView=new _e({formatMessage:this.formatMessage,model:e,source:t,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled}),this.show(!0);var o=e.highlight.offset().top-this.$wikiContent.offset().top;this.previousHighlightOffset=o;var s=this.commentView.render().$el;s.css("visibility","hidden"),"nav"===t?x.scrollToActiveHighlight(o,this.distanceToTop):"permalink"===t?x.scrollToActiveHighlight(o,this.defaultPermalinkedCommentOffset).done(function(){i&&i.isReplyComment&&n.commentView.replyComment()}):"quickreload"===t&&this._scrollToQuickReloadComment(e),this.$el.html(s),l.a.Confluence.Binder&&l.a.Confluence.Binder.userHover()}};void 0===i||!1===i.ignoreConfirmDialog?x.confirmProcess(this.formatMessage,!0)&&n.call(this):n.call(this),a.a.trigger("ic-jim-async-supported")},_scrollToQuickReloadComment:function(e){var t=o()(".qr-feedback:first"),i=this.defaultPermalinkedCommentOffset;t.length>0&&(i=t.height()+67);var n=e.highlight.position().top;x.scrollToActiveHighlight(n,i)},_scrollToEditorView:function(e){var t=o()("body, html"),i=this.$(".ic-display-comment-view").position().top,n=e.closest(".ic-create-comment-view").position().top+i;(t.height()<n||t.scrollTop()>n)&&t.animate({scrollTop:n},100)},displayCreateComment:function(e,t,i){var n=this.isOnUnsupportedMacro();this._emptySidebar(!0),this.createCommentView=new xe({formatMessage:this.formatMessage,collection:e,selection:t,type:n?"pageComment":"topLevel",isFocus:!1,stopFocus:!0,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,commentText:n?"<blockquote>".concat(o()("<div/>").text(t.text).html(),"</blockquote> <div/>"):"",onFinished:h.a.bind(function(){this.createCommentView.keepSidebar||this.isShowing&&this.hide()},this),serializedHighlights:i,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled}),this.show(),this.createCommentView.$el.css("visibility","hidden"),this.$el.html(this.createCommentView.$el),this.createCommentView.render()},isOnUnsupportedMacro:function(){var e=o()(".ic-current-selection");return x.containUnsupportedMacro(e)||x.containInternalLink(e)||x.containUserMetion(e)},displayError:function(e,t){t=h.a.extend({closeable:!0},t),this.clearError(),a.a.messages.warning(".ic-error",{body:e,closeable:t.closeable}),t.callback&&t.callback()},clearError:function(){o()(".ic-error").empty()},show:function(e){this.isShowing||(this._toggleSidebar(e),this.isShowing=!0)},hideInEditMode:function(e){"comment"!==a.a.Meta.get("content-type")&&(this.sidebarObserver.disconnect(),this.hide(e))},hide:function(e,t){var i=this;return e&&e.preventDefault(),!!x.confirmProcess(this.formatMessage,!0)&&(!this.isShowing||(this._toggleSidebar(t).done(function(){g.destroy(),u.a.trigger("ic:sidebar-hidden"),i.isShowing=!1}),!0))},_toggleSidebar:function(e){var t,i=o()(".inline-comment-marker.active:first, .ic-current-selection:first");i.length>0&&(t=x.getOffsetTopRelativeInWindowCoordinate(i));var n=o.a.Deferred(),s=n.promise();return this.isShowing?e&&x.isAnimationSupported()?s=x.animateSidebar(this,!1):(g.destroy(),this.$wikiContent.css("position","static"),this._emptySidebar(),n.resolve()):("true"===this.shouldSqueeze&&g.shrinkToShowSideBar(),e&&x.isAnimationSupported()?s=x.animateSidebar(this,!0):n.resolve(),this.$wikiContent.css("position","relative")),s.done(function(){x.scrollToCommentAfterToggleSideBar(t,i)}),s},_emptySidebar:function(e){this.commentView&&(this.commentView.model.unset&&this.commentView.model.unset("active"),this.commentView.destroy(),this.commentView=null),this.createCommentView&&(this.createCommentView.keepSidebar=e,this.createCommentView.destroy(),this.createCommentView=null)},setSidebarYPos:function(){if(this.isShowing){var e,t,i=this.$el.offset().top;if(null!=this.commentView)e=this.commentView.$el,t=this.commentView.model.highlight;else{if(null==this.createCommentView)return;e=this.createCommentView.$el,t=o()(".ic-current-selection")}if(t){var n=this.$(".ic-sidebar-heading").height();e.css({visibility:"visible",position:"absolute",top:"".concat(t.offset().top-i-n,"px")}),x.recalculateContentHeight(e)}}}}),Ne=u.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:z.comment,events:{"click .ic-action-unresolve":"unresolveComment","click .ic-action-show-reply":"showReply"},initialize:function(e){this.formatMessage=e.formatMessage,h.a.bindAll(this,"onUnresolveComplete","destroy"),this.replyListView=new De({formatMessage:this.formatMessage,commentModel:this.model}),this.listenTo(this.replyListView,"ic:reply-rendered",function(){this.renderNumberOfReplies()})},render:function(){var e=this.template(h.a.extend(this.model.toJSON(),{showMenu:!1,isDangling:this.model.isDangling(),darkFeatures:x.getDarkFeatures(),hasReply:this.model.replies.length>0}),this.formatMessage);return this.$el.html(e),this.likesView&&this.likesView.remove(),this.likesView=new Ie({contentId:this.model.id,showLikeButton:!1}).render(),this.$(".ic-action-like").html(this.likesView.el),this.$el.append(this.replyListView.$el.hide()),this.replyListView.render(),this},unresolveComment:function(){u.a.trigger("ic:resolvedClearError"),this.model.resolve(!1,{wait:!0,success:this.onUnresolveComplete,error:this.onUnresolveFail})},onUnresolveComplete:function(){u.a.trigger("ic:unresolved"),this.$el.slideUp(this.destroy)},onUnresolveFail:function(e,t){401===t.status?u.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.resolve.permission"})):u.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.server.error"}))},showReply:function(){this.$(".ic-action-show-reply").parent().remove(),this.$(".ic-replies").slideDown()},renderNumberOfReplies:function(){var e,t=this.model.replies.length,i=this.$(".ic-action-show-reply");t>0?(e=1===t?this.formatMessage({id:"inline.comments.resolved.menu.show.reply"},{0:t}):this.formatMessage({id:"inline.comments.resolved.menu.show.replies"},{0:t}),i.text(e),i.parent().removeClass("hidden")):i.parent().remove()},destroy:function(){this.replyListView.destroy(),this.remove()}}),Oe=u.a.View.extend({events:{"click #resolved-dialog-close-button":"destroy"},template:z.resolvedCommentDialog,initialize:function(e){this.formatMessage=e.formatMessage,h.a.bindAll(this,"render","destroy","_onKeyDown"),this._resolvedCommentViews=[],this.listenTo(this.collection,"change:resolveProperties",this.onResolvedChanged),this.listenTo(u.a,"ic:resolvedError",this.displayError),this.listenTo(u.a,"ic:resolvedClearError",this.clearErrors);var t=o()(this.template(null,this.formatMessage));this.setElement(t),this.dialog=a.a.dialog2(this.$el),o()(l.a.document).bind("keydown",this._onKeyDown),a.a.trigger("remove-bindings.keyboardshortcuts")},render:function(){var e=o()("<div>"),t=this.collection.getResolvedCount();return 0!==t?h.a.each(this.collection.getResolvedCommentsDesc(),function(t){var i=new Ne({formatMessage:this.formatMessage,model:t});this._resolvedCommentViews.push(i),e.append(i.render().$el)},this):this.displayNoCommentMessage(),this.$(".aui-dialog2-content").append(e),this.dialog.show(),this.options.focusCommentId&&this.scrollToComment(this.options.focusCommentId),u.a.trigger("ic:resolved:view",t),a.a.trigger("ic-jim-async-supported"),this},onResolvedChanged:function(){0===this.collection.getResolvedCount()&&this.displayNoCommentMessage()},displayNoCommentMessage:function(){a.a.messages.generic(this.$(".aui-dialog2-content"),{body:this.formatMessage({id:"inline.comments.resolved.dialog.empty"}),closeable:!1})},displayError:function(e){this.clearErrors(),a.a.messages.warning(this.$("#ic-resolved-comment-dialog-error"),{body:e})},clearErrors:function(){this.$("#ic-resolved-comment-dialog-error").empty()},scrollToComment:function(e){var t=this.$(a.a.format("[data-comment-id={0}]",e));return t.length?(t.addClass("focused"),this.$(".aui-dialog2-content").animate({scrollTop:t.parent().position().top},100)):(new o.a.Deferred).reject()},_onKeyDown:function(e){this.$el&&this.$el.is(":visible")&&e.keyCode===a.a.keyCode.ESCAPE&&this.destroy()},destroy:function(){a.a.trigger("add-bindings.keyboardshortcuts"),o()(l.a.document).unbind("keydown",this._onKeyDown),this.dialog.hide(),this.dialog.remove(),h.a.each(this._resolvedCommentViews,function(e){e.destroy()}),this._resolvedCommentViews=null,this.remove()}}),Ve=u.a.Model.extend({}),Le=u.a.Collection.extend({model:Ve,url:"".concat(a.a.contextPath(),"/rest/experimental/webfragment/panels?location=atl.page.content.footer.actions")}),Fe=null,Ue={init:function(e,t){Ee=t,Fe=e.commentCollection;var i=new Promise(function(t){x.getDarkFeatures().LIKES_ADMIN_TOGGLE?(e.webPanelCollection||(e.webPanelCollection=new Le),e.webPanelCollection.fetch({cache:!1}).done(function(e){t(e.length>0)})):t(!0)});e.views.sidebar&&e.views.sidebar.destroy(),e.views.sidebar=new Ae({formatMessage:Ee,$wikiContent:o()("[data-inline-comments-target=true]").first(),shouldShowInlineCommentLikes:i,shouldSqueeze:e.shouldSqueeze,isUnifiedProfileCardsEnabled:e.isUnifiedProfileCardsEnabled,isGDPRInlineCommentsEnabled:e.isGDPRInlineCommentsEnabled}),g.$el.append(e.views.sidebar.$el),e.views.highlight&&e.views.highlight.destroy(),e.views.highlight=new j({collection:Fe}),e.views.highlight.render()},loadSidebarOnClick:function(e){if(x.confirmProcess(Ee)){u.a.trigger("ic:highlight-panel-click"),o()(".inline-comment-marker,span[data-mark-type=confluenceInlineComment]").removeClass("active");var t=x.overlappedSelection(e,Fe);if(t){var i=o()('.inline-comment-marker[data-ref="'.concat(t.get("markerRef"),'"],span[data-reference="').concat(t.get("markerRef"),'"]'));l.a.Confluence.HighlightAction.clearTextSelection(),t.highlight=i,u.a.trigger("ic:overlap",t)}else{var n=(new A).removeHighlight().highlight(e.range);u.a.trigger("ic:create",Fe,e,n)}}},updateResolvedCommentCountInToolsMenu:function(){o()("#view-resolved-comments>span").text(Ee({id:"inline.comments.resolved.view.menu"})+a.a.format(" ({0})",Fe.getResolvedCount()))},afterSyncCommentCollection:function(){var e=this;Fe.once("sync",function(t){e.displayPermalinkedComment(t)}),Fe.on("change:resolveProperties",function(){e.updateResolvedCommentCountInToolsMenu()}),this.updateResolvedCommentCountInToolsMenu()},displayPermalinkedComment:function(e){var t=l.a.location.search;x.showFocusedComment(e,t,Oe,Ee)},createResolvedCommentListView:function(){new Oe({formatMessage:Ee,collection:Fe}).render()}},ze=function(e){return Ue.init(e,Te),Ue};function je(){return Be.firstCaller&&(Be.firstCaller=!1,ke&&ke.isResolved()?ze(Be):(ke=o.a.Deferred()).resolve(ze(Be))),Be.isSidebarLoaded=!1,ke.promise()}var Be={firstCaller:!0,isSidebarLoaded:!1,commentCollection:null,webPanelCollection:null,shouldSqueeze:!1,views:{sidebar:null},init:function(e){e=e||{},Be.firstCaller=!0,Be.isSidebarLoaded=!1,Be.shouldSqueeze=e.shouldSqueeze,Be.isUnifiedProfileCardsEnabled=e.isUnifiedProfileCardsEnabled,Be.isGDPRInlineCommentsEnabled=e.isGDPRInlineCommentsEnabled,Be.commentCollection||(Be.commentCollection=new P),Be.commentCollection.reset(),g.setPageContentElByCSSSelector(e.pageContentCSSSelector),g.setPageHeaderElByCSSSelector(e.pageHeaderCSSSelector),Be.bindDOMEvents(),Be.fetch(),Be.bindQuickReloadEvents(),Be.bindAppEvents(),Be.focusOnComment(),Be.updateResolvedCount(),a.a.bind("ic.force-refetch",Be.fetch)},initAsync:function(){je().done(function(e){e.afterSyncCommentCollection(),e.displayPermalinkedComment(Be.commentCollection)})},destroy:function(){a.a.unbind(".ic-app"),g.destroy()},bindDOMEvents:function(){o()("body").off("click".concat(".ic-app"),"#view-resolved-comments").on("click".concat(".ic-app"),"#view-resolved-comments",function(e){e.preventDefault(),je().done(function(e){e.createResolvedCommentListView()})})},bindAppEvents:function(){var e="ic:resolved.".concat(".ic-app");u.a.listenTo(u.a,e,function(){Be.initAsync()})},fetch:function(){return Be.commentCollection.fetch({cache:!1}).done(function(){Be.commentCollection.getCommentsOnPageCount()>0&&Be.initAsync(),Be.commentCollection.getResolvedCount()>0&&je().done(function(e){e.updateResolvedCommentCountInToolsMenu()}),a.a.trigger("ic-fetch-completed",Be.commentCollection)})},focusOnComment:function(){-1!==l.a.location.search.indexOf("focusedCommentId")&&Be.initAsync()},bindQuickReloadEvents:function(){a.a.unbind("qr:show-new-thread".concat(".ic-app")).bind("qr:show-new-thread".concat(".ic-app"),function(e,t){je().done(function(){!function(e,t){var i=Be.commentCollection.get(t),n=!1;void 0===i&&(i=new I({id:t}),n=!0),i.fetch({success:function(e){e._setHighlights(e.get("markerRef")),n?Be.commentCollection.add(e):i.replies.isFetched=!1,u.a.trigger("ic:view",i,"quickreload")}})}(0,t)})}),a.a.unbind("qr:add-new-highlight".concat(".ic-app")).bind("qr:add-new-highlight",function(e,t,i){je().done(function(){a.a.trigger("qr:add-new-highlight-text",[t,i])})})},updateResolvedCount:function(){o()("#view-resolved-comments>span").text(Te({id:"inline.comments.resolved.view.menu"})+a.a.format(" ({0})",Be.commentCollection.getResolvedCount()))}};function Ge(){o()(".tipsy").remove()}var qe={init:function(e){Te=e.formatMessage,H.start(),Ge(),Be.init(e),l.a.Confluence&&l.a.Confluence.HighlightAction&&l.a.Confluence.HighlightAction.registerButtonHandler("com.atlassian.confluence.plugins.confluence-inline-comments:create-inline-comment",{onClick:function(e){je().done(function(t){Be.isSidebarLoaded||(Be.isSidebarLoaded=!0,t.loadSidebarOnClick(e))})},shouldDisplay:l.a.Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY})},destroy:function(){Ge(),Be.destroy()},notifyEditor:function(){u.a.trigger("ic:tinymce-resource-loaded")}},We=Object(r.d)("skate");if(!x.isSPAPage()){var Je=a.a.Meta.get("page-id"),Qe=a.a.Meta.get("latest-page-id");Je&&Je===Qe&&o()(qe.init)}t.default=function(e){(function(e){return!(!__skate||!__skate.registry)&&void 0!==__skate.registry[e]})(x.getPageContentClassName())||We(x.getPageContentClassName(),{type:We.types.CLASS,attributes:{"data-content-id":{updated:function(e){this._init(e)}},"data-editor-resource-loaded":{updated:function(){qe.notifyEditor()}}},attached:function(e){this._init(e)},detached:function(){qe.destroy()},_init:function(t){var i=t.getAttribute("data-page-content-css-selector"),n=t.getAttribute("data-page-header-css-selector"),o=t.getAttribute("data-content-id"),s=t.getAttribute("data-should-squeeze"),a=t.getAttribute("data-unified-profile-cards"),r=t.getAttribute("data-gdpr-inline-comments");qe.init({formatMessage:e,pageContentCSSSelector:i,pageHeaderCSSSelector:n,contentId:o,shouldSqueeze:s,isUnifiedProfileCardsEnabled:a,isGDPRInlineCommentsEnabled:r})}})}},w0mW:function(e,t,i){var n=i("dw5g"),o=0;e.exports=function(e){var t=++o;return n(e)+t}},wS3D:function(e,t){
/**
 * @license jQuery Text Highlighter
 * Copyright (C) 2011 - 2013 by mirz
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(e,t,i,n){var o={ELEMENT_NODE:1,TEXT_NODE:3},s={name:"textHighlighter"};function a(t,i){this.context=t,this.$context=e(t),this.options=e.extend({},e[s.name].defaults,i),this.init()}a.prototype={init:function(){this.$context.addClass(this.options.contextClass),this.bindEvents()},destroy:function(){this.unbindEvents(),this.$context.removeClass(this.options.contextClass),this.$context.removeData(s.name)},bindEvents:function(){},unbindEvents:function(){},highlightHandler:function(e){e.data.self.doHighlight()},doHighlight:function(t){var i=t||this.getCurrentRange();if(i&&!i.collapsed){var n=i.toString(),o="";if(1==this.options.onBeforeHighlight(i)){var s=e.textHighlighter.createWrapper(this.options),a=this.highlightRange(i,s);o=this.normalizeHighlights(a),this.options.onAfterHighlight(o,n)}return this.removeAllRanges(),o}},getCurrentRange:function(){var e,t=this.getCurrentSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e},removeAllRanges:function(){this.getCurrentSelection().removeAllRanges()},getCurrentSelection:function(){var t,i=this.getCurrentWindow();return i.getSelection?t=i.getSelection():e("iframe").length?e("iframe",top.document).each(function(){if(this.contentWindow===i)return t=rangy.getIframeSelection(this),!1}):t=rangy.getSelection(),t},getCurrentWindow:function(){var e=this.getCurrentDocument();return e.defaultView?e.defaultView:e.parentWindow},getCurrentDocument:function(){return this.context.ownerDocument?this.context.ownerDocument:this.context},highlightRange:function(t,i){if(!t.collapsed){var n=["SCRIPT","STYLE","SELECT","BUTTON","OBJECT","APPLET"],s=t.startContainer,a=t.endContainer,r=t.commonAncestorContainer,c=!0;if(0==t.endOffset){for(;!a.previousSibling&&a.parentNode!=r;)a=a.parentNode;a=a.previousSibling}else a.nodeType==o.TEXT_NODE?t.endOffset<a.nodeValue.length&&a.splitText(t.endOffset):t.endOffset>0&&(a=a.childNodes.item(t.endOffset-1));s.nodeType==o.TEXT_NODE?t.startOffset==s.nodeValue.length?c=!1:t.startOffset>0&&a==(s=s.splitText(t.startOffset)).previousSibling&&(a=s):s=t.startOffset<s.childNodes.length?s.childNodes.item(t.startOffset):s.nextSibling;var l=!1,d=s,h=[];do{if(c&&d.nodeType==o.TEXT_NODE){if(/\S/.test(d.nodeValue)){var m=i.clone(!0).get(0),u=d.parentNode;if(e.contains(this.context,u)||u===this.context){var g=e(d).wrap(m).parent().get(0);h.push(g)}}c=!1}d!=a||a.hasChildNodes()&&c||(l=!0),-1!=e.inArray(d.tagName,n)&&(c=!1),c&&d.hasChildNodes()?d=d.firstChild:null!=d.nextSibling?(d=d.nextSibling,c=!0):(d=d.parentNode,c=!1)}while(!l);return h}},normalizeHighlights:function(t){return this.flattenNestedHighlights(t),this.mergeSiblingHighlights(t),e.map(t,function(e){return void 0!==e.parentElement?null!=e.parentElement?e:null:null!=e.parentNode?e:null})},flattenNestedHighlights:function(t){var n=this;e.each(t,function(o){var s=e(this),a=s.parent(),r=a.prev(),c=a.next();if(n.isHighlight(a))if(a.css("background-color")!=s.css("background-color"))n.isHighlight(r)&&!s.get(0).previousSibling&&r.css("background-color")!=a.css("background-color")&&r.css("background-color")==s.css("background-color")&&s.insertAfter(r),n.isHighlight(c)&&!s.get(0).nextSibling&&c.css("background-color")!=a.css("background-color")&&c.css("background-color")==s.css("background-color")&&s.insertBefore(c),a.is(":empty")&&a.remove();else{var l=i.createTextNode(a.text());a.empty(),a.append(l),e(t[o]).remove()}})},mergeSiblingHighlights:function(t){var i=this;function n(t,n){return!(!n||n.nodeType!=o.ELEMENT_NODE||e(t).css("background-color")!=e(n).css("background-color")||!e(n).hasClass(i.options.highlightedClass))}e.each(t,function(){var t=this.previousSibling,i=this.nextSibling;if(n(this,t)){var o=e(t).text()+e(this).text();e(this).text(o),e(t).remove()}if(n(this,i)){o=e(this).text()+e(i).text();e(this).text(o),e(i).remove()}})},setColor:function(e){this.options.color=e},getColor:function(){return this.options.color},removeHighlights:function(t){var i=void 0!==t?t:this.context,n=this;this.getAllHighlights(i,!0).each(function(){if(1==n.options.onRemoveHighlight(this))(function(t){e(t).contents().unwrap().get(0)})(this)})},getAllHighlights:function(t,i){var n=".".concat(this.options.highlightedClass),o=e(t).find(n);return 1==i&&e(t).hasClass(this.options.highlightedClass)&&(o=o.add(t)),o},isHighlight:function(e){return e.hasClass(this.options.highlightedClass)},serializeHighlights:function(t){var i=t||this.getAllHighlights(this.context),n=this.context,s=[];return i.each(function(t,i){var a=0,r=i.firstChild.length,c=function(t,i){var n=[];do{var o=e.inArray(t,t.parentNode.childNodes);n.unshift(o),t=t.parentNode}while(t!==i);return n}(i,n);e(i).clone().empty().get(0).outerHTML;i.previousSibling&&i.previousSibling.nodeType===o.TEXT_NODE&&(a=i.previousSibling.length),s.push([e(i).text(),c.join(":"),a,r])}),JSON.stringify(s)},deserializeHighlights:function(t,i){try{var n=JSON.parse(t)}catch(e){throw new Error("Can't parse serialized highlights: ".concat(e))}var s=[],a=this,r=!0;return e.each(n,function(t,n){try{!function(t){for(var n=t[0],r=t[1].split(":"),c=t[2],l=t[3],d=r.pop(),h=null,m=a.context;void 0!==(h=r.shift());)m=m.childNodes[h];m.childNodes[d-1]&&m.childNodes[d-1].nodeType===o.TEXT_NODE&&(d-=1);var u=m.childNodes[d].splitText(c);if(u.splitText(l),u.nextSibling&&""==u.nextSibling.nodeValue&&u.parentNode.removeChild(u.nextSibling),u.previousSibling&&""==u.previousSibling.nodeValue&&u.parentNode.removeChild(u.previousSibling),n!==u.nodeValue)throw new Error("Different text");var g=e(u).wrap(i).parent().get(0);s.push(g)}(n)}catch(e){return console&&console.warn&&console.warn("Can't deserialize ".concat(t,"-th descriptor. Cause: ").concat(e)),r=!1,!0}}),r&&s}},e.fn.getHighlighter=function(){return this.data(s.name)},e.fn[s.name]=function(t){return this.each(function(){e.data(this,s.name)||e.data(this,s.name,new a(this,t))})},e.textHighlighter={createWrapper:function(t){return e("<span></span>").css("backgroundColor",t.color).addClass(t.highlightedClass)},defaults:{color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:function(){return!0},onBeforeHighlight:function(){return!0},onAfterHighlight:function(){}}}}(jQuery,window,document)}}]);
//# sourceMappingURL=inline-comments.d3e3ea9941c609098b87-v38.js.map