(window.webpackJsonp=window.webpackJsonp||[]).push([[344],{CzLb:function(e,t,a){"use strict";a.r(t);var n,i=a("uDfI"),r=a("SMqo"),s=a("VrFO"),o=a.n(s),l=a("Y9Ll"),c=a.n(l),u=a("N+ot"),d=a.n(u),p=a("AuHH"),m=a.n(p),h=a("1Pcy"),f=a.n(h),g=a("5Yy7"),v=a.n(g),k=a("KEM+"),_=a.n(k),w=(a("aWzz"),a("ERkP")),y=a.n(w),b=a("Jygk"),x=a.n(b),C=a("IGvV"),q=a("aKlp"),E=a.n(q),U=a("Bcqe"),T=a.n(U),F=a("Xzcx"),j=a("jqY8"),O=3e4,S=6e4,L=2*S,R=function(){function e(t,a){o()(this,e),this.options=E()({min:O,max:S,inactivity:L},a),this._callback=t,this._timer=null,this._lastSeenTimestamp=null,this._setActivityTrigger()}return c()(e,[{key:"_setActivityTrigger",value:function(){var e=this;Object(F.a)("visibilitychange",function(){Object(F.c)().hidden?x.a.clearTimeout(e._timer):e._setActive()}),Object(j.c)().addEventListener("focus",this._setActive),Object(F.a)("click",this._setActive),Object(F.a)("scroll",T()(this._setActive,500))}},{key:"_setActive",value:function(){if(this._timer){var e=this._timeSinceLastSeen()>this.options.inactivity;this._lastSeenTimestamp=this._now(),this.start(e)}}},{key:"_now",value:function(){return(new Date).getTime()}},{key:"_timeSinceLastSeen",value:function(){return this._now()+1-this._lastSeenTimestamp}},{key:"_clamp",value:function(e,t,a){var n=Math.max(Math.min(t,a),e);return isNaN(n)?e:n}},{key:"_intervalMultiplier",value:function(){var e=(Object(F.c)().hidden?3:1)*Math.ceil(this._timeSinceLastSeen()/this.options.inactivity);return this._clamp(1,this.options.max/this.options.min,e)}},{key:"start",value:function(e){var t=this;this._lastSeenTimestamp=this._now(),this.stop(),e&&this._callback();var a=function(){t._callback(),n()},n=function(){t.stop(),t._timer=x.a.setTimeout(a,t.options.min*t._intervalMultiplier())};n()}},{key:"stop",value:function(){this._timer&&(x.a.clearTimeout(this._timer),this._timer=null)}}]),e}(),N=a("97Jx"),P=a.n(N),I=a("Q/r/"),M=a("TTdN"),A=a.n(M),D=a("lr0P"),Q=a.n(D),z=a("L21V"),K=a("/4nh"),B=a("2wFc"),J=a("kSEI"),V=Object(z.g)(n=function(e){function t(e){var a;return o()(this,t),(a=d()(this,m()(t).call(this,e)))._onShowFlag=a._onShowFlag.bind(f()(a)),a._onCloseFlag=a._onCloseFlag.bind(f()(a)),a._getLatestUpdate=a._getLatestUpdate.bind(f()(a)),a}return v()(t,e),c()(t,[{key:"_onShowFlag",value:function(e){this.flagEl=e,this._toggleBindClickEventForReloadLink(e,!0)}},{key:"_onCloseFlag",value:function(e){this._toggleBindClickEventForReloadLink(this.flagEl,!1),e||this.props.resetQuickReload()}},{key:"_toggleBindClickEventForReloadLink",value:function(e,t){var a=e&&e.querySelector(".qr-notice-show");a&&(t?a.addEventListener("click",this._getLatestUpdate):a.removeEventListener("click",this._getLatestUpdate))}},{key:"_getLatestUpdate",value:function(){this.props.refreshContent()}},{key:"_buildFlagBodyMarkup",value:function(){var e=this.props,t=e.users,a=e.intl.formatMessage,n=t.slice(0,8),i=Object(K.a)(n,0),r=Object(K.d)(n),s="";2===r?s=a({id:"quick.reload.edit.one.more"}):r>2&&(s=a({id:"quick.reload.edit.more"},[r-1]));var o=n.map(function(e){return y.a.createElement("span",{className:"qr-author-avatar",key:e.accountId},y.a.createElement(A.a,{src:e.avatarUrl,size:"small"}))});return y.a.createElement("div",null,y.a.createElement("div",{className:"qr-notice-authors"},o),y.a.createElement("div",{className:"qr-notice-summary"},y.a.createElement(Q.a,{type:"link",className:"qr-notice-show aui-button-text"},a({id:"quick.reload.reload"})),y.a.createElement("span",{className:"qr-notice-summary-text"},a({id:"quick.reload.edit.by"})," ",y.a.createElement("a",{href:Object(B.e)(i.accountId),className:"url fn"},i.displayName)," ",y.a.createElement("span",{className:"qr-who-edit"},s))))}},{key:"render",value:function(){var e=this.props,t=e.updatesCount,a=e.users,n=e.intl.formatMessage,i=e.flagDefaultProps,r=e.manyUpdatesTitleI18nKey,s=e.singleUpdateTitleI18nKey;if(Object(K.c)(a))return null;var o=n({id:t>1?r:s},[t]),l=Object(I.renderToStaticMarkup)(this._buildFlagBodyMarkup());return y.a.createElement(J.a,P()({isShowing:!0,title:o,body:l,onClose:this._onCloseFlag,onShow:this._onShowFlag},i))}}]),t}(w.Component))||n;V.displayName="QuickReloadPageFlag";var W,Y,H,G=a("tPAe"),X=a.n(G),Z=Object(C.a)(X.a)((H=Y=function(e){function t(){var e,a;o()(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return a=d()(this,(e=m()(t)).call.apply(e,[this].concat(i))),_()(f()(a),"lastFetchTime",Date.now()),_()(f()(a),"_timer",null),_()(f()(a),"_update",function(){a.props.isNetworkConnected&&(a.props.getQuickReloadUpdates(a.props.contentId,a.lastFetchTime),a.lastFetchTime=Date.now())}),a}return v()(t,e),c()(t,[{key:"componentDidMount",value:function(){this._timer=new R(this._update),this._timer.start(),this.lastFetchTime=Date.now()}},{key:"componentDidUpdate",value:function(e){this.props.blackListedError&&(console.warn("Quick comment reload plugin has been disabled in this page due to a server error: ",this.props.blackListedError,". Please refresh the page to get it back."),this._timer.stop()),this.props.contentId&&this.props.contentId!==e.contentId&&(this.lastFetchTime=Date.now())}},{key:"componentWillUnmount",value:function(){this._timer.stop()}},{key:"_reloadComments",value:function(){x.a.location.reload()}},{key:"render",value:function(){var e=this.props,t=e.newPageUpdatedUsers,a=e.resetQuickReloadEdits,n=e.editUpdatesCount,i=e.newCommentUsers,r=e.commentUpdatesCount,s=e.resetQuickReloadComments,o={close:"manual",type:"info",extraClasses:"qr-flag",fifo:!0,stack:"quickreload"};return y.a.createElement(w.Fragment,null,y.a.createElement(V,{users:t,refreshContent:this._reloadComments,resetQuickReload:a,flagDefaultProps:o,updatesCount:n,manyUpdatesTitleI18nKey:"quick.reload.edits",singleUpdateTitleI18nKey:"quick.reload.edit"}),y.a.createElement(V,{users:i,refreshContent:this._reloadComments,resetQuickReload:s,flagDefaultProps:o,updatesCount:r,manyUpdatesTitleI18nKey:"quick.reload.newcomments",singleUpdateTitleI18nKey:"quick.reload.newpagecomment"}))}}]),t}(w.Component),_()(Y,"defaultProps",{editUpdatesCount:0,commentUpdatesCount:0}),W=H))||W,$=a("hqKg"),ee=Object($.createSelector)([function(e){return e},function(e,t){return t}],function(e,t){return e.filter(function(e){return e.accountId!==t})});t.default=Object(i.connect)(function(e){var t=e.views.viewPage.quickReload;return{newPageUpdatedUsers:t.get("newPageUpdatedUsers"),newCommentUsers:ee(t.get("newCommentUsers"),e.meta.get("atlassian-account-id")),blackListedError:t.get("blackListedError"),editUpdatesCount:t.get("editUpdatesCount"),commentUpdatesCount:t.get("commentUpdatesCount"),isNetworkConnected:e.session.errors.get("isNetworkConnected")}},function(e){return{getQuickReloadUpdates:function(t,a){return e(Object(r.a)({contentId:t,lastFetchTime:a}))},refreshContent:function(){return e(Object(r.c)())},resetQuickReloadEdits:function(){return e(Object(r.e)())},resetQuickReloadComments:function(){return e(Object(r.d)())}}})(Z)},RRuF:function(e,t,a){(e.exports=a("RDo7")(!1)).push([e.i,".qr-flag .qr-author-avatar{margin-right:5px;vertical-align:middle}.qr-flag .qr-notice-authors{padding:5px 0;max-width:300px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.qr-flag .qr-notice-summary{width:317px}.qr-flag .qr-notice-text{line-height:24px}.qr-flag .qr-notice-summary-text{font-size:12px;color:#707070;display:block;width:217px;max-width:217px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.qr-flag .qr-notice-summary-text a{color:#707070}.qr-flag .qr-notice-show{float:right;max-width:100px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.qr-flag .aui-message{padding-top:10px;padding-bottom:10px}.qr-flag .aui-message.closeable .icon-close{top:10px}",""])},TTdN:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(a("ERkP")),i=s(a("aWzz")),r=s(a("O94r"));function s(e){return e&&e.__esModule?e:{default:e}}var o=function(e){var t=e.isProject,a=e.size,i=e.src,s=(0,r.default)("aui-avatar","aui-avatar-"+a,{"aui-avatar-project":!0===t});return n.default.createElement("span",{className:s},n.default.createElement("span",{className:"aui-avatar-inner"},n.default.createElement("img",{src:i})))};o.displayName="AUIAvatar",o.propTypes={src:i.default.string,size:i.default.oneOf(["xsmall","small","medium","large","xlarge","xxlarge","xxxlarge"]),isProject:i.default.bool},t.default=o},tPAe:function(e,t,a){var n=a("RRuF"),i=a("7l8p");"string"==typeof n&&(n=[[e.i,n,""]]),e.exports=n.locals||{},e.exports._getContent=function(){return n},e.exports._getCss=function(){return n.toString()},e.exports._insertCss=function(e){return i(n,e)}}}]);
//# sourceMappingURL=page.quick-reload.131d667138e3ababe6b5-v38.js.map