WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:cql-user-information', location = '/js/cql-user-information.js' */
define("confluence-collaborative-editor-plugin/cql-user-information",["jquery","confluence/meta","confluence/api/constants"],function(l,m,n){function f(a){return a.map(function(b){var a=d.ACCOUNT_IDS[b.accountId||i]||d.USERNAMES[b.username||i]||o,b=Object.assign({},b);b.displayName=a.displayName;b.fullname=a.displayName;b.avatarURL=a.avatarURL;b.sub=b.sub||a.sub;return b})}function j(a){return a.map(function(a){return'"'+a+'"'})}var i="__UNDEFINED_OBJECT_KEY__",k=m.get("static-resource-url-prefix")+
"/images/icons/profilepics/default.png",o={sub:0,avatarURL:k,displayName:"Current User"},e=[],d={ACCOUNT_IDS:{},USERNAMES:{}};return function(a){Array.isArray(a)||(a=[a]);return!a.length?Promise.resolve([]):new Promise(function(b){var c=a.filter(function(a){return a.accountId&&!d.ACCOUNT_IDS[a.accountId]&&"anonymous"!==a.accountId}).map(function(a){return a.accountId}),g=a.filter(function(a){return a.username&&!d.USERNAMES[a.username]&&"anonymous"!==a.username}).map(function(a){return a.username});
if(!c.length&&!g.length)return b(f(a));var h=[];c.length&&h.push("user.accountid in ("+j(c).join(",")+")");g.length&&h.push("user in ("+j(g).join(",")+")");c="?cql="+encodeURIComponent(h.join(" or "));l.ajax({url:n.CONTEXT_PATH+"/rest/api/search"+c,dataType:"json",type:"GET",contentType:"application/json",success:function(c){(c.results||[]).forEach(function(a){var a=(a||{}).user||{},b=e.indexOf(a.accountId);-1===e.indexOf(a.accountId)&&(e.push(a.accountId),b=e.length-1);b={sub:b,displayName:a.displayName||
"anonymous",avatarURL:(a.profilePicture||{}).path||k};a.accountId&&"anonymous"!==a.accountId&&(d.ACCOUNT_IDS[a.accountId]=b);a.username&&"anonymous"!==a.username&&(d.USERNAMES[a.username]=b)});b(f(a))},failure:function(){b(f(a))}})})}});
}catch(e){WRMCB(e)};