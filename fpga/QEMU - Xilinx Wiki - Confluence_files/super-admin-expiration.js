(window.webpackJsonp=window.webpackJsonp||[]).push([[399],{B5Kc:function(e,n,t){"use strict";var i=t("VrFO"),r=t.n(i),a=t("N+ot"),o=t.n(a),s=t("AuHH"),c=t.n(s),u=t("1Pcy"),l=t.n(u),d=t("5Yy7"),f=t.n(d),m=t("KEM+"),p=t.n(m),g=t("ERkP"),h=t.n(g),v=(t("aWzz"),t("L21V")),E=t("kFJ8"),S=t("2srY"),A=t.n(S),y=t("lZoD"),b=t("hcZD"),w=t("bx1d"),_=t("n9CL"),I={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DisableSuperAdmin"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"disableSuperAdmin"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"confluence"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"roles"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isSuperAdmin"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:184,source:{body:"\n  mutation DisableSuperAdmin {\n    disableSuperAdmin {\n      user {\n        id\n        confluence {\n          roles {\n            isSuperAdmin\n          }\n        }\n      }\n    }\n  }\n",name:"GraphQL request",locationOffset:{line:1,column:1}}}};t.d(n,"a",function(){return D});var M=Object(v.f)({disableSuperAdminErrorTitle:{id:"super-admin.disable.super.admin.error.title",defaultMessage:"Something went wrong",description:"Title for the error if disabling Super Admin fails"},disableSuperAdminErrorDescription:{id:"super-admin.disable.super.admin.error.description",defaultMessage:"If this keeps happening, let us know at support.atlassian.com",description:"Description for the error if disabling Super Admin fails"}}),k=function(e){function n(){var e,t;r()(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=o()(this,(e=c()(n)).call.apply(e,[this].concat(a))),p()(l()(t),"handleMutationComplete",function(e){return function(n){var i=t.props.handleMutationCompleteCallback;A()(n,"disableSuperAdmin.user.confluence.roles.isSuperAdmin")||!1?t.handleMutationError(e)():(Object(b.b)(),Object(_.f)(),i().then(function(){return window.location.reload()}))}}),p()(l()(t),"handleMutationError",function(e){return function(){var n=t.props,i=n.intl,r=n.handleMutationErrorCallback;e.showErrorFlag({title:i.formatMessage(M.disableSuperAdminErrorTitle),description:i.formatMessage(M.disableSuperAdminErrorDescription)}),r()}}),p()(l()(t),"render",function(){return h.a.createElement(y.c,{to:[w.a]},function(e){return h.a.createElement(E.c,{mutation:I,onCompleted:t.handleMutationComplete(e),onError:t.handleMutationError(e)},function(n){return t.props.children(n,e)})})}),t}return f()(n,e),n}(g.Component);p()(k,"defaultProps",{handleMutationCompleteCallback:function(){return Promise.resolve()},handleMutationErrorCallback:function(){return Promise.resolve()}});var D=Object(v.g)(k)},IkOR:function(e,n,t){"use strict";t.r(n);var i=t("VrFO"),r=t.n(i),a=t("N+ot"),o=t.n(a),s=t("AuHH"),c=t.n(s),u=t("1Pcy"),l=t.n(u),d=t("5Yy7"),f=t.n(d),m=t("KEM+"),p=t.n(m),g=t("ERkP"),h=t.n(g),v=t("PTiB"),E=(t("aWzz"),t("WlwD")),S=t("tqyq"),A=t("B5Kc"),y=t("Y9Ll"),b=t.n(y),w=t("7wq/"),_=t.n(w),I=t("L21V"),M=t("KsTJ"),k=t("n9CL"),D=function(e){function n(){var e,t;r()(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=o()(this,(e=c()(n)).call.apply(e,[this].concat(a))),p()(l()(t),"state",{countdown:0,interval:void 0}),p()(l()(t),"startCountdown",function(){t.props.initialCountdown>0&&t.setState({countdown:t.props.initialCountdown},function(){return t.setState({interval:setInterval(t.intervalHandler,1e3)})})}),p()(l()(t),"stopCountdown",function(){clearInterval(t.state.interval)}),p()(l()(t),"intervalHandler",function(){t.state.countdown>0?t.decrementCountdown():t.stopCountdown()}),p()(l()(t),"decrementCountdown",function(){t.setState({countdown:t.state.countdown-1})}),t}return f()(n,e),b()(n,[{key:"componentDidMount",value:function(){this.startCountdown()}},{key:"componentWillUnmount",value:function(){this.stopCountdown()}},{key:"render",value:function(){return this.state.countdown}}]),n}(g.Component);function T(){var e=_()(["\n  font-weight: bold;\n  display: inline;\n"]);return T=function(){return e},e}D.displayName="Counter";var C=Object(I.f)({timeoutSuperAdminTitle:{id:"super-admin.timeout.super.admin.title",defaultMessage:"Still there?",description:"Title for the flag for Admin Key expiry notification"},superAdminTimerFlagAction:{id:"super-admin.timer.flag,action",defaultMessage:"Keep using admin key",description:"Text for the action on Super Admin timeout flag"}}),x=M.default.div(T()),O=function(){},F=function(e){function n(){var e,t;r()(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=o()(this,(e=c()(n)).call.apply(e,[this].concat(a))),p()(l()(t),"state",{flagId:void 0}),p()(l()(t),"handleAKTimeout",function(e,n,i){Object(k.b)(Object(k.c)())({beforeNotify:function(){return t.waitFor1Second(function(){i&&t.hideFlag(n),t.handleAKTimeout(e,n,!1)})},afterNotify:function(r){return t.waitFor1Second(function(){i||t.showFlag(n,r),t.handleAKTimeout(e,n,!0)})},afterExpiry:function(){return e()},noTimeout:O})}),p()(l()(t),"waitFor1Second",function(e){setTimeout(e,1e3)}),p()(l()(t),"showFlag",function(e,n){var i=t.props.intl;e.showWarningFlag({title:i.formatMessage(C.timeoutSuperAdminTitle),description:t.renderFlagDescription(n),actions:[{content:i.formatMessage(C.superAdminTimerFlagAction),onClick:t.onClickKeepUsing(e)}]}).then(function(e){return t.setState({flagId:e.id})})}),p()(l()(t),"renderFlagDescription",function(e){return h.a.createElement(I.b,{id:"super-admin.timeout.super.admin.description",defaultMessage:"Due to inactivity, you will be signed out in {counter}.",description:"Description  for the flag for Admin Key expiry notification",values:{counter:h.a.createElement(x,null,h.a.createElement(I.b,{id:"super-admin.timeout.super.admin.description.counter",defaultMessage:"{counter} seconds",description:"Part of description for the flag for Admin Key expiry notification",values:{counter:h.a.createElement(D,{initialCountdown:Object(k.d)(e)})}}))}})}),p()(l()(t),"onClickKeepUsing",function(e){return function(){Object(k.e)(),t.fireAdminKeyExtendedAnalyticsEvent(),t.hideFlag(e)}}),p()(l()(t),"fireAdminKeyExtendedAnalyticsEvent",function(){t.props.createAnalyticsEvent({type:"sendTrackEvent",data:{source:"superAdminExpiration",action:"extended",actionSubject:"adminKeySession"}}).fire()}),t}return f()(n,e),b()(n,[{key:"componentDidMount",value:function(){var e=this.props,n=e.disableSuperAdminTrigger,t=e.flags;this.handleAKTimeout(n,t,!1)}},{key:"hideFlag",value:function(e){void 0!==this.state.flagId&&e.hideFlag(this.state.flagId)}},{key:"render",value:function(){return null}}]),n}(g.Component);F.displayName="SuperAdminExpirationTimerComponent";var R=Object(v.a)()(Object(I.g)(F)),P=Object(I.f)({sessionExpirationTitle:{id:"super-admin.session.expiration.title",defaultMessage:"Access to restricted pages has ended",description:"Title for Super admin session expiration flag"},sessionExpirationDescription:{id:"super-admin.session.expiration.description",defaultMessage:"You’ve been inactive for a while. To keep things secure, we’ve ended your access to restricted pages.",description:"Description for Super admin session expiration flag"}}),K=function(e){function n(){var e,t;r()(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=o()(this,(e=c()(n)).call.apply(e,[this].concat(a))),p()(l()(t),"showFlag",function(){var e=t.props,n=e.flags,i=e.intl;n.showInfoFlag({title:i.formatMessage(P.sessionExpirationTitle),description:i.formatMessage(P.sessionExpirationDescription)})}),t}return f()(n,e),b()(n,[{key:"componentDidMount",value:function(){var e=this;E.a.getAndRemoveItem(S.a.SUPERADMIN_SESSION_EXPIRED).then(function(n){n&&e.showFlag()})}},{key:"render",value:function(){return null}}]),n}(g.Component);K.displayName="SuperAdminExpirationFlagComponent";var N=Object(I.g)(K);t.d(n,"SuperAdminExpiration",function(){return j});var U=function(e){function n(){var e,t;r()(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=o()(this,(e=c()(n)).call.apply(e,[this].concat(a))),p()(l()(t),"fireAdminKeyExpiredAnalyticsEvent",function(){t.props.createAnalyticsEvent({type:"sendTrackEvent",data:{source:"superAdminExpiration",action:"expired",actionSubject:"adminKeySession"}}).fire()}),p()(l()(t),"deleteStoredRestrictedPage",function(){return E.a.removeItem(S.a.RESTRICTED_PAGE_CONFIRMED)}),p()(l()(t),"fireAdminKeyExpiryFailedAnalyticsEvent",function(){return t.props.createAnalyticsEvent({type:"sendTrackEvent",data:{action:"failed",actionSubject:"exitAdminKeySession",source:"superAdminExpiration"}}).fire()}),p()(l()(t),"setAKSessionExpired",function(){return E.a.setItem(S.a.SUPERADMIN_SESSION_EXPIRED,!0,Object(k.a)(new Date,10))}),p()(l()(t),"render",function(){return h.a.createElement(A.a,{handleMutationCompleteCallback:function(){return t.fireAdminKeyExpiredAnalyticsEvent(),Promise.all([t.deleteStoredRestrictedPage(),t.setAKSessionExpired()])},handleMutationErrorCallback:function(){return t.fireAdminKeyExpiryFailedAnalyticsEvent(),Promise.resolve()}},function(e,n){return h.a.createElement(g.Fragment,null,h.a.createElement(R,{flags:n,disableSuperAdminTrigger:e}),h.a.createElement(N,{flags:n}))})}),t}return f()(n,e),n}(g.Component),j=Object(v.a)()(U)},WlwD:function(e,n,t){"use strict";var i=t("GuU3"),r=t.n(i),a=t("LnsA"),o=t("VrFO"),s=t.n(o),c=t("Y9Ll"),u=t.n(c),l=t("KEM+"),d=t.n(l),f=t("/FQd"),m=t("Z49i"),p=function(){function e(n,t,i){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;s()(this,e),d()(this,"initialize",function(){return new Promise(function(e){r._initialized?e(!1):r._storageManager.ready().then(function(){Object(f.b)(Object(m.a)()).then(function(n){r._namespace="".concat(r._prefix,".").concat(n.userId,".").concat(r._id),r._initialized=!0,e(r._initialized)})}).catch(function(e){console.log(e)})})}),d()(this,"getItem",function(e){return r.initialize().then(function(){var n;return r._storageManager.getItem("".concat(r._namespace,".").concat(e)).then(function(t){return(n=r._prefixMatch.exec(t))&&(t=t.replace(n[0],""),+new Date>n[0].replace("#",""))?r._storageManager.removeItem("".concat(r._namespace,".").concat(e)).then(function(){return null}):t})})}),d()(this,"getAndRemoveItem",function(e){return r.getItem(e).then(function(n){return r.removeItem(e).then(function(){return n})})}),d()(this,"getAllItems",function(){return r.initialize().then(function(){var e={};return r._storageManager.iterate(function(n,t){if(t.indexOf("".concat(r._namespace,"."))>-1){var i=t.split("".concat(r._namespace,"."))[1];e[i]=n}}).then(function(){return e})})}),d()(this,"doesContain",function(e){return r.initialize().then(function(){return r.getItem(e).then(function(e){return!!e})})}),d()(this,"getItemAsBoolean",function(e){return r.initialize().then(function(){return r.getItem(e).then(function(e){return"false"!==e&&("true"===e||!!e)})})}),d()(this,"setItem",function(e,n,t){return r.initialize().then(function(){return n="".concat(r._getPrefix(t)).concat(n),r._storageManager.setItem("".concat(r._namespace,".").concat(e),n).then(function(){return n})})}),d()(this,"setItemQuietly",function(e,n,t){try{return r.setItem(e,n,t)}catch(t){console.log("Unable to write to this._storageManager. key: ".concat(e,", value: ").concat(n,", cause: ").concat(t))}}),d()(this,"removeItem",function(e){return r.initialize().then(function(){return r._storageManager.removeItem("".concat(r._namespace,".").concat(e))})}),this._storageManager=n,this._prefix=t,this._id=i,this._delimiter="#",this._prefixMatch=/\d+#/,this._namespace=a?"".concat(t,".").concat(a,".").concat(i):null,this._initialized=!!this._namespace}return u()(e,[{key:"_getPrefix",value:function(e){var n=1e3*(e||0);return n?+new Date+n+this._delimiter:""}}]),e}();t.d(n,"a",function(){return h});var g=r.a.createInstance({name:"sessionStorage"});g.defineDriver(a),g.setDriver(a._driver);var h=new p(r.a.createInstance({name:"localStorage",driver:r.a.LOCALSTORAGE}),"atlassian","frontend");new p(g,"atlassian","frontend")},n9CL:function(e,n,t){"use strict";t.d(n,"d",function(){return r}),t.d(n,"a",function(){return a}),t.d(n,"b",function(){return o}),t.d(n,"c",function(){return s}),t.d(n,"f",function(){return c}),t.d(n,"e",function(){return u});var i="confluence.super.admin.timeout",r=function(e){return Math.round((e-(new Date).getTime())/1e3)},a=function(e,n){return new Date(e.getTime()+1e3*n)},o=function(e){return function(n){var t=n.beforeNotify,i=n.afterNotify,a=n.afterExpiry,o=n.noTimeout;if(e){var s=r(e);return s>0?s<=60?i(e):t(e):a(e)}return o()}},s=function(){return localStorage.getItem(i)},c=function(){localStorage.removeItem(i)},u=function(){!function(e){localStorage.setItem(i,e)}(function(e,n){return a(e,function(e){return 60*e}(n))}(new Date,10).getTime())}},tqyq:function(e,n,t){"use strict";t.d(n,"a",function(){return i});var i={DASHBOARD_ROUTE:"dashboard.route.last.v2",DISCOVER_ROUTE:"discover.route.last",MY_WORK_ROUTE:"my-work.route.last",SPACE_ROUTE:"space.route.last",GLOBAL_SIDEBAR_PANEL:"sidebar.global.panel",TINYMCE_PAGE_JUST_PUBLISHED:"editor.tinyMCE.just.published",EDITOR_SURVEY_LAST_SUBMITTED:"editor.survey.last.submitted",SUPERADMIN_SURVEY_REQUESTED:"superadmin.survey.requested",SUPERADMIN_SURVEY_SUBMITTED:"superadmin.survey.submitted",SUPERADMIN_SESSION_EXPIRED:"superadmin.session.expired",RESTRICTED_PAGE_CONFIRMED:"restricted.page.confirmed"}}}]);
//# sourceMappingURL=super-admin-expiration.c3039e0128147fc484f7-v38.js.map