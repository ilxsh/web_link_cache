(window.webpackJsonp=window.webpackJsonp||[]).push([[431],{dBMn:function(t,e,n){"use strict";n.r(e);var r=n("tQaH"),i=n.n(r),o=n("EfWO"),a=n.n(o),u=n("kD2R"),c=n("pLw3"),s=n.n(c),f=n("r9hL"),l=n("f6W2"),d=n("7LQG"),h=n("bfgX"),v=n("RhWx"),m=n.n(v),p=n("VrFO"),y=n.n(p),b=n("Y9Ll"),g=n.n(b),_=n("KEM+"),E=n.n(_),k=n("Jygk"),S=n.n(k);function w(t){var e=Date.now();return function(t){return t.filter(function(t){var e=null;return j(t.name)?j(t.properties)&&t.properties.constructor!==Object&&(e="properties must be an object with key value pairs."):e="you must provide a name for the event.",null===e||(console.log("WARN: Invalid analytics event detected and ignored, ".concat(e,"\nEvent: ").concat(JSON.stringify(t))),!1)})}(t).map(function(t,n,r){var i;return i=t.time>0?t.time-e:n-r.length,{name:t.name,properties:function(t){if(!t)return null;for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];j(n)&&O(n)||(j(n)&&n.toString?t[e]=n.toString():t[e]="")}return t}(t.properties),timeDelta:i}})}function j(t){return void 0!==t&&null!==t}function O(t){return"number"==typeof t||"string"==typeof t||"boolean"==typeof t}var P,A={},T=window,L=T.document,C="localStorage",I="globalStorage";if(A.disabled=!1,A.set=function(t,e){},A.get=function(t){},A.remove=function(t){},A.clear=function(){},A.transact=function(t,e){var n=A.get(t);void 0===n&&(n={}),e(n),A.set(t,n)},A.serialize=function(t){return JSON.stringify(t)},A.deserialize=function(t){if("string"==typeof t)return JSON.parse(t)},function(){try{return C in T&&T[C]}catch(t){return!1}}())P=T[C],A.set=function(t,e){if(void 0===e)return A.remove(t);P.setItem(t,A.serialize(e))},A.get=function(t){return A.deserialize(P.getItem(t))},A.remove=function(t){P.removeItem(t)},A.clear=function(){P.clear()};else if(function(){try{return I in T&&T[I]&&T[I][T.location.hostname]}catch(t){return!1}}())P=T[I][T.location.hostname],A.set=function(t,e){if(void 0===e)return A.remove(t);P[t]=A.serialize(e)},A.get=function(t){return A.deserialize(P[t]&&P[t].value)},A.remove=function(t){delete P[t]},A.clear=function(){for(var t in P)delete P[t]};else if(L.documentElement.addBehavior){var M,F,J=function(t){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(P),M.appendChild(P),P.addBehavior("#default#userData"),P.load(C);var n=t.apply(A,e);return M.removeChild(P),n}};try{(F=new ActiveXObject("htmlfile")).open(),F.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></frame>'),F.close(),M=F.w.frames[0].document,P=M.createElement("div")}catch(t){P=L.createElement("div"),M=L.body}A.set=J(function(t,e,n){if(void 0===n)return A.remove(e);t.setAttribute(e,A.serialize(n)),t.save(C)}),A.get=J(function(t,e){return A.deserialize(t.getAttribute(e))}),A.remove=J(function(t,e){t.removeAttribute(e),t.save(C)}),A.clear=J(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(C);for(var n,r=0;n=e[r];r++)t.removeAttribute(n.name);t.save(C)})}try{A.set("__storejs__","__storejs__"),"__storejs__"!=A.get("__storejs__")&&(A.disabled=!0),A.remove("__storejs__")}catch(t){A.disabled=!0}var D=A,x=new(function(){function t(e){var n=this,r=e.contextPath,i=e.product,o=e.eventEmitter;if(y()(this,t),E()(this,"_retryCount",0),E()(this,"_scheduledPublish",null),E()(this,"_events",[]),E()(this,"listen",function(){n._eventEmitter.bind("analytics",n._pushEventFromEmitter),n._eventEmitter.bind("analyticsEvent",n._pushEventFromEmitter),S.a.addEventListener("unload",n._addEventsToStore);var t=n._getEventsFromStore();D.remove(n._storageKey),t.length&&(n._addEvents(t),n._debouncedPublish())}),E()(this,"push",function(t){n._addEvents([t]),n._debouncedPublish()}),E()(this,"_pushEventFromEmitter",function(t,e){n.push({name:e.name,properties:e.data})}),E()(this,"_addEventsToStore",function(){var t=n._getEventsFromStore();D.set(n._storageKey,t.concat(n._events))}),!i)throw new Error("You must provide a product when constructing an AnalyticsClient.");this._contextPath=r||"",this._eventEmitter=o,this._storageKey="atlassian-analytics.".concat(i)}return g()(t,[{key:"_getEventsFromStore",value:function(){var t=D.get(this._storageKey);return Array.isArray(t)?t:[]}},{key:"_addEvents",value:function(t){var e=this;t.forEach(function(t){e._events.push({name:t.name,properties:t.properties,time:t.time||Date.now()})})}},{key:"_removeEvents",value:function(t){this._events=this._events.slice(t.length)}},{key:"_debouncedPublish",value:function(){var t=this;null===this._scheduledPublish&&(this._scheduledPublish=S.a.setTimeout(function(){return t._bulkPublish().then(function(e){t._scheduledPublish=null,t._retryCount=e?0:t._retryCount+1,t._events.length&&t._debouncedPublish()})},function(t){return Math.min(5e3*Math.pow(2,t),3e5)}(this._retryCount)))}},{key:"_bulkPublish",value:function(){var t=this,e=m()(this._events),n=w(e);if(!n.length)return this._events.length=0,Promise.resolve(!0);var r=S.a.document.querySelector("meta[name=atlassian-token]");return S.a.fetch("".concat(this._contextPath,"/rest/analytics/1.0/publish/bulk"),{credentials:"include",headers:{atl_token:r?r.content:"","content-type":"application/json"},method:"POST",body:JSON.stringify(n)}).catch(function(){return{ok:!1}}).then(function(n){return n.ok&&t._removeEvents(e),n.ok})}}]),t}())({contextPath:d.a,product:"confluence",eventEmitter:{bind:h.a}});var N,z=function(t){return!0===t.isInitial?function(){return new Promise(function(t,e){var n=S.a.document.getElementById("confluence-server-performance");if(null===n)e();else try{t(JSON.parse(n.innerHTML))}catch(t){e()}})}().then(function(t){return t},function(){return{}}):{serverDuration:0}},q=n("r+Ch"),K=n("T0aG"),U=n.n(K),B=[],R=[];var W=function(t){var e={};B.forEach(function(n){var r=n(t);"object"===U()(r)&&function(t,e){Object.keys(e).forEach(function(n){t[n]=e[n]})}(e,r)});var n={name:"browser.metrics.navigation",properties:e};N.push(n)},X=function(t){var e={};return Object.keys(t).forEach(function(n){var r=t[n];"number"!=typeof r&&"boolean"!=typeof r&&"string"!=typeof r&&null!==r||(e[n]=r)}),e};var G=function(t){if(function(t){return"number"==typeof t.apdex}(t))return{apdex:"".concat(t.apdex)}},H=function(t){return"".concat(Math.floor(t))};var Q=function(t){if(function(t){return"number"==typeof t.firstPaint}(t))return{firstPaint:H(t.firstPaint)}};var Y=function(t){if(function(t){return"boolean"==typeof t.isInitial}(t))return{isInitial:"".concat(t.isInitial)}};var V=function(t){if(function(t){return"string"==typeof t.journeyId}(t))return{journeyId:t.journeyId}};var $=function(t){if(function(t){return"string"==typeof t.key}(t))return{key:t.key}};var Z=function(t){if(function(t){return"number"==typeof t.navigationType}(t))return{navigationType:"".concat(t.navigationType)}};var tt=function(t){if(function(t){return"number"==typeof t.readyForUser}(t))return{readyForUser:H(t.readyForUser)}};var et=function(t){if(function(t){return"number"==typeof t.redirectCount}(t))return{redirectCount:"".concat(t.redirectCount)}};var nt=function(t){if(function(t){return"number"==typeof t.resourceLoadedEnd}(t))return{resourceLoadedEnd:H(t.resourceLoadedEnd)}},rt=function(t,e){Object.keys(t).forEach(function(n){e(n,t[n])})};function it(t){return Object.keys(t).length}var ot=function(){function t(){y()(this,t),this.children={},this.values=[]}return g()(t,[{key:"add",value:function(e,n){0==e.length?this.values.push(n):(this.children.hasOwnProperty(e[0])||(this.children[e[0]]=new t),this.children[e[0]].add(e.substr(1),n))}},{key:"toTrieObject",value:function(){var t={};return rt(this.children,function(e,n){t[e]=n.toTrieObject()}),0===this.values.length?t:0===it(this.children)?this.values:[t,this.values]}},{key:"condensed",value:function(){var e=new t;return e.values=this.values.concat(),rt(this.children,function(t,n){var r=n.condensed();0===r.values.length&&1===it(r.children)?rt(r.children,function(n,r){e.children[t+n]=r}):e.children[t]=r}),e}}]),t}();var at={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5},ut=-1;function ct(t){return(t=Math.floor(t||0))>0?function(t){return t.toString(36)}(t):""}var st=function(t){if(function(t){return Array.isArray(t.resourceTiming)}(t)){var e=new ot;return t.resourceTiming.forEach(function(t){var n=function(t){return R.reduce(function(e,n){var r=n(t);return r.length>e.length?r:e},"")}(t.name);e.add(n||"â˜ ",function(t){return[at[t.initiatorType]||ut,ct(t.startTime),ct(t.responseEnd),ct(t.responseStart),ct(t.requestStart),ct(t.connectEnd),ct(t.secureConnectionStart),ct(t.connectStart),ct(t.domainLookupEnd),ct(t.domainLookupStart),ct(t.redirectEnd),ct(t.redirectStart)].join(",").replace(/,+$/,"")}(t))}),{resourceTiming:JSON.stringify(e.condensed().toTrieObject())}}};var ft=function(t){if(function(t){return"number"==typeof t.threshold}(t))return{threshold:H(t.threshold)}},lt="unloadEventStart,unloadEventEnd,redirectStart,redirectEnd,fetchStart,domainLookupStart,domainLookupEnd,connectStart,connectEnd,secureConnectionStart,requestStart,responseStart,responseEnd,domLoading,domInteractive,domContentLoadedEventStart,domContentLoadedEventEnd,domComplete,loadEventStart,loadEventEnd".split(","),dt=function(t){var e={};return lt.forEach(function(n){"number"==typeof t[n]&&(e[n]=H(t[n]))}),e};var ht=function(t){if(function(t){return"string"==typeof t.userAgent}(t))return{userAgent:t.userAgent}};var vt=function(t){if(function(t){return"object"===U()(t.marks)}(t)){var e={},n={},r={};return t.marks.forEach(function(t){var e="mark.".concat(t.name);n[e]=n[e]||[],n[e].push(Math.floor(t.time))}),rt(n,function(t,n){e[t]=JSON.stringify(n)}),t.measures.forEach(function(t){var e="measure.".concat(t.name);r[e]=r[e]||[],r[e].push([Math.floor(t.startTime),Math.floor(t.duration)])}),rt(r,function(t,n){e[t]=JSON.stringify(n)}),e}};var mt=function(t){if(function(t){return"number"==typeof t.serverDuration}(t))return{serverDuration:"".concat(Math.floor(t.serverDuration))}};n.d(e,"setupAnalytics",function(){return yt}),x.listen(),q.a.addReporter(z),function(t){N=t}(x);var pt=function(t){B.push(t)};function yt(t,e){var n=s.a.fromUrl(location.href);if(!n.isEmpty()){t.dispatch(Object(f.a)("confluence.page.with-atl-origin.viewed",i()({},n.toAnalyticsAttributes())));var r=a.a.parse(s.a.removeFromUrl(location.href)),o=r.pathname,c=r.query,d=r.search,h=r.hash,v=Object(l.a)(t.getState()),m=i()({},v,{pathname:o,search:d,query:c,hash:h});t.dispatch(Object(u.replace)(m))}e("analytics.smoke")&&t.dispatch(Object(f.a)("confluence.spa.analytics.smoke"))}pt(X),pt(G),pt(Q),pt(Y),pt(V),pt($),pt(Z),pt(tt),pt(et),pt(nt),pt(st),pt(ft),pt(dt),pt(ht),pt(vt),pt(mt),q.a.subscribe(function(t){W(t.report)})}}]);
//# sourceMappingURL=setup-analytics.d65e1823737cd27e4b8c-v38.js.map