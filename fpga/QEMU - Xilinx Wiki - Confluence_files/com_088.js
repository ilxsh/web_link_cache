WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:event-edit', location = 'com/atlassian/confluence/extra/calendar3/components/manage-event/event-edit/event-edit-dialog.soy' */
// This file was automatically generated from event-edit-dialog.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.TeamCalendars.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.eventEdit = function(opt_data, opt_ignored) {
  return '<form name="event-edit" class="aui event-edit" method="POST" action="#"><input type="hidden" name="uid" value=""><input type="hidden" name="originalStartDate" value=""><input type="hidden" name="originalSubCalendarId" value=""><input type="hidden" name="originalEventType" value=""><input type="hidden" name="originalCustomEventTypeId" value=""><input type="hidden" name="childSubCalendarId" value=""><div class="event-type subcalendar-event"><div class="aui-message error calendar-error hidden"><p class="title"><span class="aui-icon icon-error"></span><strong>' + soy.$$escapeHtml('Error(s) occurred.') + '</strong></p><div class="error-content"><ul class="error-messages hidden"></ul></div></div><div class="field-group field-group-calendar"><label for="calendar">' + soy.$$escapeHtml('Calendar') + '<span class="aui-icon icon-required"></span></label><select name="calendar" id="calendar" class="sub-calendar-select select"></select><a href="#" id="calendar-tooltip" class="aui-icon icon-help hidden" original-title="show tooltip" title="' + soy.$$escapeHtml('This field is enabled when the field \x22Edit this instance only\x22 is unchecked') + '"></a></div><div class="field-group field-group-event-type"><label for="event-type">' + soy.$$escapeHtml('Event Type') + '<span class="aui-icon icon-required"></span></label><select name="event-type" id="event-type" class="event-type-select select"></select><a href="#" id="calendar-tooltip" class="aui-icon icon-help hidden" original-title="show tooltip" title="' + soy.$$escapeHtml('This field is enabled when the field \x22Edit this instance only\x22 is unchecked') + '"></a><div class="error type-error"></div></div><div id="event-fields-container"></div></form>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.eventEdit.soyTemplateName = 'Confluence.TeamCalendars.Templates.eventEdit';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:event-edit', location = 'com/atlassian/confluence/extra/calendar3/components/manage-event/event-edit/event-fields.soy' */
// This file was automatically generated from event-fields.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.TeamCalendars.Templates.Fields.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }
if (typeof Confluence.TeamCalendars.Templates.Fields == 'undefined') { Confluence.TeamCalendars.Templates.Fields = {}; }


Confluence.TeamCalendars.Templates.Fields.text = function(opt_data, opt_ignored) {
  return '<div class="field-group field-' + soy.$$escapeHtml(opt_data.id) + '" id="field-text-' + soy.$$escapeHtml(opt_data.id) + '"><label for="' + soy.$$escapeHtml(opt_data.id) + '">' + soy.$$escapeHtml(opt_data.label) + ((opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '') + '</label><input type="text" class="text" name="' + soy.$$escapeHtml(opt_data.id) + '" id="' + soy.$$escapeHtml(opt_data.id) + '-text" value="" ' + ((opt_data.readOnly) ? ' readonly="readonly"' : '') + '><div class="error ' + soy.$$escapeHtml(opt_data.id) + '-error"></div></div>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.text.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.text';
}


Confluence.TeamCalendars.Templates.Fields.inforReminderLabel = function(opt_data, opt_ignored) {
  return '<div class="field-group field-' + soy.$$escapeHtml(opt_data.id) + '" id="field-text-' + soy.$$escapeHtml(opt_data.id) + '"><label for="' + soy.$$escapeHtml(opt_data.id) + '">' + soy.$$escapeHtml(opt_data.label) + '</label><div class="bodyInforReminderLabel">' + Confluence.TeamCalendars.Templates.Fields.bodyInforReminderLabel(opt_data) + '</div></div>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.inforReminderLabel.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.inforReminderLabel';
}


Confluence.TeamCalendars.Templates.Fields.bodyInforReminderLabel = function(opt_data, opt_ignored) {
  return '' + ((opt_data.reminderPeriod > 0) ? '<span class="span-label field-value-normal">' + soy.$$filterNoAutoescape(opt_data.reminderPeriodText) + '</span><p/><div class="reminder-info"><div class="reminder-info-icon"><span class="aui-icon aui-icon-small aui-iconfont-info">Info</span></div><div class="reminder-info-text"><span>' + soy.$$filterNoAutoescape('Reminders are inherited from the event type. \x3ca href\x3d\x22#\x22 id\x3d\x22calendar-reminder-setting\x22\x3eEdit event type\x3c/a\x3e') + '</span></div></div>' : '<span class="span-label field-value-normal">' + soy.$$escapeHtml(opt_data.reminderPeriodText) + ' ' + soy.$$filterNoAutoescape('\x3ca href\x3d\x22#\x22 id\x3d\x22calendar-reminder-setting\x22 class\x3d\x22add-reminder-setting\x22\x3eAdd reminder\x3c/a\x3e') + '</span>');
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.bodyInforReminderLabel.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.bodyInforReminderLabel';
}


Confluence.TeamCalendars.Templates.Fields.textarea = function(opt_data, opt_ignored) {
  return '<div class="field-group field-' + soy.$$escapeHtml(opt_data.id) + '" id="field-textarea-' + soy.$$escapeHtml(opt_data.id) + '"><label for="' + soy.$$escapeHtml(opt_data.id) + '">' + soy.$$escapeHtml(opt_data.label) + ((opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '') + '</label><textarea name="' + soy.$$escapeHtml(opt_data.id) + '" id="' + soy.$$escapeHtml(opt_data.id) + '-textarea" class="textarea" rows="' + soy.$$escapeHtml(opt_data.size) + '" ' + ((opt_data.readOnly) ? ' readonly="readonly"' : '') + '></textarea><div class="error ' + soy.$$escapeHtml(opt_data.id) + '-error"></div></div>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.textarea.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.textarea';
}


Confluence.TeamCalendars.Templates.Fields.page = function(opt_data, opt_ignored) {
  return '<div class="field-group field-' + soy.$$escapeHtml(opt_data.id) + ' field-group-eventlink" id="field-page-' + soy.$$escapeHtml(opt_data.id) + '"><label for="' + soy.$$escapeHtml(opt_data.id) + '">' + soy.$$escapeHtml(opt_data.label) + ((opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '') + '</label><input type="text" class="text" name="' + soy.$$escapeHtml(opt_data.id) + '" id="' + soy.$$escapeHtml(opt_data.id) + '-text" value="" ' + ((opt_data.readOnly) ? ' readonly="readonly"' : '') + '><div class="' + soy.$$escapeHtml(opt_data.id) + '-suggestions aui-dd-parent hidden" ><div class="aui-dropdown"></div></div><div class="error ' + soy.$$escapeHtml(opt_data.id) + '-error"></div></div>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.page.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.page';
}


Confluence.TeamCalendars.Templates.Fields.when = function(opt_data, opt_ignored) {
  return '<div id="field-when"><fieldset class="date-select"><legend><span>' + soy.$$escapeHtml('When') + '<span class="aui-icon icon-required"></span></span></legend><div class="field-group"><label for="startDate">' + soy.$$escapeHtml('Start date') + '</label><input class="datepicker-field date-field start text" type="text" name="startDate" id="' + soy.$$escapeHtml(opt_data.id) + '-startDate" size="10" value="" autocomplete="off" ' + ((opt_data.disableStartDateTime) ? ' disabled="disabled"' : '') + '><label for="startTime">' + soy.$$escapeHtml('Start time') + '</label><input type="text" class="time-field text" name="startTime" id="' + soy.$$escapeHtml(opt_data.id) + '-startTime" size="8" ' + ((opt_data.disableStartDateTime) ? ' disabled="disabled"' : '') + '><span>' + soy.$$escapeHtml('to') + '</span><label for="endTime">' + soy.$$escapeHtml('End date') + '</label><input type="text" class="time-field text" name="endTime" id="' + soy.$$escapeHtml(opt_data.id) + '-endTime" size="8" ' + ((opt_data.disableEndDateTime) ? ' disabled="disabled"' : '') + '><label for="endDate">' + soy.$$escapeHtml('End time') + '</label><input class="datepicker-field date-field end text" type="text" name="endDate" id="' + soy.$$escapeHtml(opt_data.id) + '-endDate" size="10" value="" autocomplete="off" ' + ((opt_data.disableEndDateTime) ? ' disabled="disabled"' : '') + '><div class="error when-error"></div></div></fieldset><div class="field-group field-group-allday"><label for="allDayEvent">' + soy.$$escapeHtml('All day event') + '</label><input type="checkbox" class="checkbox" name="allDayEvent" id="' + soy.$$escapeHtml(opt_data.id) + '-allDayEvent" value="true" ' + ((opt_data.disableAllDay) ? ' disabled="disabled"' : '') + '></div></div>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.when.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.when';
}


Confluence.TeamCalendars.Templates.Fields.repeats = function(opt_data, opt_ignored) {
  return '<div id="field-repeats"><input type="hidden" name="freq" value=""><input type="hidden" name="byday" value=""><input type="hidden" name="recurrenceId" value=""><div class="field-group edit-this-instance-only-container hidden"><label for="editthisinstanceonly">' + soy.$$escapeHtml('Edit this instance only') + '</label><input type="checkbox" class="checkbox" name="editthisinstanceonly" id="editthisinstanceonly" value="true" checked="checked"></div><div class="field-group field-group-frequency"><label for="freq-select">' + soy.$$escapeHtml('Repeat') + '</label><select name="freq-select" id="' + soy.$$escapeHtml(opt_data.id) + '-freq-select" class="select"><option value="">' + soy.$$escapeHtml('Doesn\x27t repeat') + '</option><option value="DAILY">' + soy.$$escapeHtml('Daily') + '</option><option value="WEEKLY-BYDAY">' + soy.$$escapeHtml('Weekdays') + '</option><option value="WEEKLY">' + soy.$$escapeHtml('Weekly') + '</option><option value="MONTHLY">' + soy.$$escapeHtml('Monthly') + '</option><option value="YEARLY">' + soy.$$escapeHtml('Yearly') + '</option></select></div><div class="hidden field-group interval-container"><label for="interval">' + soy.$$escapeHtml('Repeat every') + '</label><input type="text" class="text" name="interval" id="' + soy.$$escapeHtml(opt_data.id) + '-interval" maxlength="2"><span class="interval-label"></span><div class="error interval-error"></div></div><fieldset class="date-select recur-ends hidden"><legend><span>' + soy.$$escapeHtml('End repeat') + '</span></legend><div class="field-group"><label for="recur-end-never">' + soy.$$escapeHtml('Never') + '</label><input type="radio" class="radio recur-ends-never" name="recur-end" id="' + soy.$$escapeHtml(opt_data.id) + '-recur-end-never" checked="checked"><span class="label">' + soy.$$escapeHtml('Never') + '</span><label for="recur-end-until">' + soy.$$escapeHtml('On date') + '</label><input type="radio" class="radio recur-ends-until" name="recur-end" id="' + soy.$$escapeHtml(opt_data.id) + '-recur-end-until" disabled="disabled"><span class="label">' + soy.$$escapeHtml('On date') + '</span><input class="datepicker-field date-field text" type="text" class="" name="until" id="' + soy.$$escapeHtml(opt_data.id) + '-until" value="" size="10" disabled="disabled"  autocomplete="off"><div class="error until-error"></div></div></fieldset></div>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.repeats.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.repeats';
}


Confluence.TeamCalendars.Templates.Fields.user = function(opt_data, opt_ignored) {
  return '<div class="field-group field-group-' + soy.$$escapeHtml(opt_data.id) + '" id="field-user-' + soy.$$escapeHtml(opt_data.id) + '"><label for="' + soy.$$escapeHtml(opt_data.id) + '">' + soy.$$escapeHtml(opt_data.label) + ((opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '') + '</label><input type="text" class="text autocomplete-multiuser" name="' + soy.$$escapeHtml(opt_data.id) + '" id="' + soy.$$escapeHtml(opt_data.id) + '-user-picker" value="" data-max="10" data-none-message="' + soy.$$escapeHtml('No users found.') + '"><ul class="invitees hidden"></ul><div class="error ' + soy.$$escapeHtml(opt_data.id) + '-error"></div></div>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.user.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.user';
}


Confluence.TeamCalendars.Templates.Fields.userSelection = function(opt_data, opt_ignored) {
  return '<li class="invitee" title="' + soy.$$escapeHtml(opt_data.displayName) + '"><div class="invitee-left" threedots="' + soy.$$escapeHtml(opt_data.displayName) + '"><img src="' + soy.$$escapeHtml(opt_data.avatarIconUrl) + '"><span class="invitee-name-display">' + soy.$$escapeHtml(opt_data.displayName) + '</span></div><div class="invitee-right"><a class="delete-invitee" title="' + soy.$$escapeHtml('Delete') + '"></a></div><div class="clear"></div></li>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.userSelection.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.userSelection';
}


Confluence.TeamCalendars.Templates.Fields.serverSelector = function(opt_data, opt_ignored) {
  return '<div class="field-group field-group-jira field-group-jira-server" id="field-serverSelector"><label for="tc-jira-server">' + soy.$$escapeHtml('Server') + '<span class="aui-icon icon-required"></span></label><select name="tc-jira-server" class="select tc-jira-server"></select><span class="spinner aui-icon aui-icon-wait"></span><div class="error server-error"></div><div class="error oauth-error hidden"></div></div>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.serverSelector.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.serverSelector';
}


Confluence.TeamCalendars.Templates.Fields.projectSelector = function(opt_data, opt_ignored) {
  return '<div class="field-group field-group-jira field-group-jira-project" id="field-projectSelector"><label for="tc-jira-project">' + soy.$$escapeHtml('Project') + '<span class="aui-icon icon-required"></span></label><select name="tc-jira-project" class="select tc-jira-project"></select><span class="spinner aui-icon aui-icon-wait"></span><div class="error project-error"></div></div>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.Fields.projectSelector.soyTemplateName = 'Confluence.TeamCalendars.Templates.Fields.projectSelector';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:event-edit', location = 'com/atlassian/confluence/extra/calendar3/components/manage-event/event-edit/event-edit-dialog.js' */
define("tc/event-edit-dialog",["jquery","tc/event-field-handlers","tc/event-types","tc-backbone","tc/calendar-util"],function(b,e,i,g,c){var j,h,d,f={};var a=g.View.extend({disableCalSelect:function(){b("select#calendar").attr("disabled",true);if(AJS.Meta.get("build-number")>=4520){b("#event-type").auiSelect2("enable",false)}else{b("#event-type").auiSelect2("disable")}},enableCalSelect:function(){b("select#calendar").attr("disabled",false);if(AJS.Meta.get("build-number")>=4520){b("#event-type").auiSelect2("enable",true)}else{b("#event-type").auiSelect2("enable")}},showToolTip:function(){b("#edit-event-dialog .subcalendar-event select.event-type-select").css("display","none");var l=window.navigator.userAgent;var k=l.indexOf("MSIE ");if(AJS.Meta.get("build-number")<4520||k>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){b("#edit-event-dialog .field-group-event-type .icon-help").css("top","-10px")}b("#calendar-tooltip.icon-help").removeClass("hidden").tooltip({aria:true})},hiddenToolTip:function(){b("#calendar-tooltip.icon-help").addClass("hidden")},getField:function(k,l){return b("input[name='"+l+"']",k)},getSelect:function(k,l){return b("select[name='"+l+"']",k)},getTextSelect:function(k,l){return b("select[name='"+l+"'] option:selected",k).text()},getTextArea:function(k,l){return b("textarea[name='"+l+"']",k)},show:function(){d.show()},hide:function(){d.hide()},remove:function(){d.remove()},getEditEventDialog:function(H,A,p,K){var C,y,o,N,u,I=[],O,J=Confluence.TeamCalendars.LocalStorage,x=H.originalEventSubCalendarId,m=this;var D=580,B=700;if(d&&d.isVisible()){return d}if(d){d.remove();d=null;AJS.log("Warning: old event edit dialog was not destroyed before creating a new one.")}j=p;h=K;u=i.DefaultEventType;function z(P){var Q={};b.each(P,function(R,S){if(S===undefined){Q[R]=""}else{Q[R]=S}});return Q}function w(X,Q){var Y,P,U,V,ac,S,W,R,ab,T,aa,Z;if(j.isProcessingEvent(h)){return false}j.setProcessingEvent(h,true,C);Y=m.getField(N,"originalSubCalendarId").val();Z=m.getField(N,"childSubCalendarId").val();P=m.getField(N,"originalStartDate").val();U=b("option:selected",m.getSelect(N,"calendar")).val();V=m.getField(N,"uid").val();W=m.getSelect(N,"event-type").val();R=c.isCustomEventType(W)?i.CustomEventType:u[W];ac=m.getField(N,"allDayEvent").is(":checked");S=m.getField(N,"until");ab=m.getField(N,"originalEventType").val();T=m.getField(N,"originalCustomEventTypeId").val();aa=c.isCustomEventType(W)?W:"";J.setItem("last-selected-calendar",U);J.setItem("last-selected-calendar-type",W);if(!V){h.data(j.PREF_LAST_ALL_DAY_USED,ac.toString());k()}if(!R){return}if(R.customHandler){R.customHandler.submitForm(X,m.getField(X,"name").val(),U,j.getRenderedMacroCallbackHandler(h),function(){d.remove();j.setProcessingEvent(h,false,C);j.updateAvailableSubCalendarsInSubCalendarPanel(h)},function(){j.setProcessingEvent(h,false,C)});return}j.updateEvent(h,(function(){var ad={originalSubCalendarId:Y,originalStartDate:P,subCalendarId:U,uid:V,eventType:c.isCustomEventType(W)?"custom":W,originalEventType:ab,customEventTypeId:aa,originalCustomEventTypeId:T,childSubCalendarId:Z};b.each(Q,function(ae,af){b.extend(ad,z(af.getData()))});return ad})(),function(ad,af,ae){j.getCalendarPanel(h).fullCalendar("unselect");j.showAjaxError(h,ad,af,ae,j.ERROR_CLASS_EVENT_UPDATE);j.setProcessingEvent(h,false,C)},function(ag){j.getCalendarPanel(h).fullCalendar("unselect");j.setGenericErrors(h,null,j.ERROR_CLASS_EVENT_UPDATE);if(ag.success){Confluence.TeamCalendars.setFieldErrors(X,null);var ah=j.getSubCalendar(h,ag.subCalendar.id);if(!ah){var af=j.getSubCalendar(h,ag.subCalendar.parentId);ah=ag.subCalendar;if(ah.type==="custom"||ah.subscriptionType==="custom"){var aj=ah.customEventTypes;var ak=af.customEventTypes;if(aj&&aj.length){if(ak&&ak.length){var ae=false;for(var ai=0;ai<ak.length;ai++){if(ak[ai].customEventTypeId===aj[0].customEventTypeId){ae=true;break}}if(!ae){ak.push(aj[0])}}else{af.customEventTypes.push(aj[0])}}}af.childSubCalendars=b.merge([ah],af.childSubCalendars||[]);j.updateAvailableSubCalendarsInSubCalendarPanel(h);j.addSubCalendarEventSource(h,ah.id);if(x&&ag.subCalendar&&(ag.subCalendar.parentId!==Y||ah.id!==x)){j.reloadSubCalendar(h,x)}}else{var ad=[ah.id];if(x&&(ah.id!==x||ag.subCalendar.parentId!==Y)){ad.push(x)}j.reloadSubCalendar(h,ad)}d.remove()}else{Confluence.TeamCalendars.setFieldErrors(X,ag.fieldErrors)}j.setProcessingEvent(h,false,C)});return false}function G(Q,R){var S=j.getSubCalendarsWhichCanAddEvents(h);S.sort(function(Y,X){var W=Y.name.toLowerCase(),V=X.name.toLowerCase();return W.localeCompare(V)});var U=m.getSelect(Q,"calendar");b.each(S,function(W,V){U.append(b("<option/>",{value:V.id,text:V.name}))});if(S.length===1){U.parent().hide()}if(R.subCalendarId){var P=j.getSubCalendar(h,R.subCalendarId);if(P){U.val(P.parentId||R.subCalendarId)}}else{var T=J.getItem("last-selected-calendar");if(T){U.val(T)}}if(R!==undefined&&(c.isJiraEvent(R)||c.isJiraEventStream(R.eventType))){U.disable()}U.change(function(){var Y=m.getField(Q,"originalSubCalendarId").val();var W=m.getField(Q,"originalEventType").val();if(S.length>1&&Y!==""&&W!==""){var X=b(this).find("option:selected");var V=m.getSelect(Q,"event-type").val();if(Y===X.val()&&V===W){b("#editthisinstanceonly").enable()}else{b("#editthisinstanceonly").disable()}}v(Q,true)})}function t(Q){var R=c.isCustomEventType(Q.id)?Q.css:Q.id;var P=b("<div/>",{"class":"tc-event-type-item",title:Q.text}).append(b("<span/>",{"class":"icon_type "+R})).append(b("<span/>",{"class":"ellipsis_text",text:Q.text}));return b("<div/>").append(P).html()}function l(R){var P=j.getSubCalendarsWhichCanAddEvents(h);for(var Q in P){if(P[Q].id===R){return P[Q].disableEventTypes}}}function q(R){var P=j.getSubCalendarsWhichCanAddEvents(h);for(var Q in P){if(P[Q].id===R){return P[Q].customEventTypes}}}function F(T,Q){var S;if(!Q){return S}var R=q(T);if(R&&R.length){for(var P=0;P<R.length;P++){if(R[P].customEventTypeId===Q){S=R[P];break}}}return S}function s(P){P.sort(function(R,Q){return R.title.toUpperCase().localeCompare(Q.title.toUpperCase())});return P}function v(R,S){var X=m.getSelect(R,"event-type");if(S){X.empty()}var Y=m.getField(R,"originalEventType").val();var Q=m.getField(R,"originalSubCalendarId").val();var V=m.getSelect(R,"calendar").find("option:selected").val();var Z=l(V);var aa=s(q(V));var U=F(Q,H.customEventTypeId);var W=function(ab){for(var ac in Z){if(ab===Z[ac]){return true}}return false};if(H.id){b.each(u,function(ab,ac){if((Y===ac.id||!W(ac.id)&&(c.isJiraEvent(H)||ac.hiddenFromEventCreation===undefined))){X.append(b("<option/>",{value:ac.id,text:ac.name}))}});b.each(aa,function(ab,ac){if(!W(ac.customEventTypeId)){X.append(b("<option/>",{value:ac.customEventTypeId,"class":ac.icon,"data-custom-id":ac.customEventTypeId,text:ac.title}))}});if(S&&U){var P=false;for(var T=0;T<aa.length;T++){if(aa[T].title===U.title){P=true;break}}if(!P){X.append(b("<option/>",{value:U.customEventTypeId,"class":U.icon,"data-custom-id":U.customEventTypeId,text:U.title}))}}}else{b.each(u,function(ab,ac){if(!W(ac.id)&&(c.isJiraEvent(H)||ac.hiddenFromEventCreation===undefined)){X.append(b("<option/>",{value:ac.id,text:ac.name}))}});b.each(aa,function(ab,ac){if(!W(ac.customEventTypeId)){X.append(b("<option/>",{value:ac.customEventTypeId,"class":ac.icon,"data-custom-id":ac.customEventTypeId,text:ac.title}))}});b.each(u,function(ab,ac){if(ac.hiddenFromEventCreation!==undefined&&ac.hiddenFromEventCreation===false&&!W(ac.id)){X.append(b("<option/>",{value:ac.id,text:ac.name}))}});if(X.children().length>0){b(".field-group-event-type .type-error",R).empty();b("#event-fields-container",R).show();m.enableOkButton()}else{X.append(b("<option/>",{value:"",text:""}));b(".field-group-event-type .type-error",R).append(b("<span/>",{text:"All event types are disabled. Please add new event type to the calendar."}));b("#event-fields-container",R).hide();C.disableOkButton({buttonText:"OK"})}X.append(b("<option/>",{value:"addNewCustomEventType","class":"addNewCustomEventType",text:"Add new event type"}))}if(AJS.$.fn.auiSelect2){b(".event-edit #event-type").auiSelect2({formatSelection:t,formatResult:t,minimumResultsForSearch:-1});if(H.id&&c.isJiraEvent(H)){if(AJS.Meta.get("build-number")>=4520){b("#event-type").auiSelect2("enable",false)}else{b("#event-type").auiSelect2("disable")}}}if(H.eventType&&H.eventType==="custom"){X.change(L).val(H.customEventTypeId).trigger("change")}else{X.change(L).val(H.eventType||J.getItem("last-selected-calendar-type")||"other").trigger("change")}}function n(){m.getField(N,"uid").val(H.id||"");m.getField(N,"originalStartDate").val(H.originalStart||"");m.getField(N,"originalSubCalendarId").val(H.subCalendarId||"");m.getField(N,"originalEventType").val(H.eventType||"");m.getField(N,"originalCustomEventTypeId").val(H.customEventTypeId||"");m.getField(N,"childSubCalendarId").val(H.childSubCalendarId||"")}function L(R){if(!d){return}var Q=R.target.value;if(Q==="addNewCustomEventType"){var T=b("option:selected",m.getSelect(N,"calendar")).val();d.remove();var P=j.getSubCalendar(h,T);var S=j.showCustomEventEditForm(h,P);return}r(Q);if(!c.isJiraEventStream(Q)){m.getSelect(N,"event-type").data("previous",Q)}M()}function M(){if(d){d.getCurrentPanel().body.css({height:"auto"});b("#"+d.id).css({height:"auto"})}}function r(Y){if(!Y){return}var U=c.isCustomEventType(Y)?i.CustomEventType.fields:u[Y].fields,Q=[],ab=b("#event-fields-container"),V=c.isJiraEventStream(Y),X=V?b("#"+Y+"-event-fields",ab):b("#tc-event-fields",ab),W=m.getSelect(N,"event-type").val(),S=m.getSelect(N,"event-type").data("previous"),P,ac=m.getField(N,"originalEventType").val();b.each(b.grep(U,function(ad){return ad.type==="repeats"&&ad.defaultRecur}),function(ad,ae){if(!H.id){H.recur=ae.defaultRecur}});if(H&&c.isJiraEventStream(H.eventType)){m.getSelect(N,"event-type").attr("disabled","disabled")}if(!V&&S){var Z=c.isCustomEventType(S)?i.CustomEventType.fields:u[S].fields;b.each(b.grep(Z,function(ad){return ad.type==="text"&&ad.copyto}),function(ae,ad){P=m.getField(X,ad.id).val()})}b(".event-fields",ab).each(function(){b(this).find(".error").empty();b(this).hide()});if(X.length&&V){X.show();Q=I[Y]}else{if(X.length){X.show();b("#tc-event-fields >div").hide()}else{if(V){X=b("<div/>",{id:Y+"-event-fields","class":"event-fields"})}else{X=b("<div/>",{id:"tc-event-fields","class":"event-fields"})}ab.append(X)}b.each(U,function(ad,ae){if(V){Q[ad]=e[ae.type](ae,X,H,j,h,m);Q[ad].add();Q[ad].init()}else{Q[ad]=e.getEventField(ae,X,H,j,h,m,P)}});I[Y]=Q}var T=function(){return f[W]!==false};if(T()){C.enableOkButton()}else{C.disableOkButton({buttonText:"OK"})}C.unbind("submit").submit(function(){w(X,Q);return false});if(ac!==undefined&&ac!==""){var R=m.getField(N,"originalSubCalendarId").val();var aa=m.getSelect(N,"calendar").val();if(ac===Y&&aa===R){b("#editthisinstanceonly").enable()}else{b("#editthisinstanceonly").disable()}}b(X).off("click.calendar-reminder-setting").on("click.calendar-reminder-setting","#calendar-reminder-setting",function(){var ad=m.getSelect(N,"calendar").val();d.hide();var ae=j.getSubCalendar(h,ad);j.showCustomEventEditForm(h,ae,W);return})}AJS.unbind("show-dialog-edit-event.teamcalendar").bind("show-dialog-edit-event.teamcalendar",function(R){var S=c.isJiraEventStream(m.getSelectedEventType())?"#"+m.getSelectedEventType()+"-event-fields":"#tc-event-fields";var Q=b("#field-text-reminder .bodyInforReminderLabel",b(S,N));var T=j.getCurrentReminderForEventType(h,m);var P=T&&T.periodInMins>0;b(Q).empty().append(Confluence.TeamCalendars.Templates.Fields.bodyInforReminderLabel({reminderPeriodText:P?AJS.format("{0} before",c.showInforReminder(T.periodInMins)):"None.",reminderPeriod:P?T.periodInMins:0}));d.show()});AJS.unbind("remove-dialog-edit-event.teamcalendar").bind("remove-dialog-edit-event.teamcalendar",function(P){if(d){d.remove()}});AJS.bind("remove.dialog",function(Q,P){if(P.dialog.id=="edit-event-dialog"){d=null}});y=function(){C.submit();AJS.unbind("show-dialog-edit-event.teamcalendar");return false};o=function(){d.remove();AJS.unbind("show-dialog-edit-event.teamcalendar");return false};d=new AJS.ConfluenceDialog({id:"edit-event-dialog",width:D,height:B,onSubmit:y,onCancel:o});d.addHeader(H.title||"Create event");d.addButton("OK",y,"submit");d.addLink("Cancel",o);O=d.popup.element.find(".submit");d.addPanel("",Confluence.TeamCalendars.Templates.eventEdit(),"calendar-dialog-panel");N=d.getCurrentPanel().body;var E=function(P){f[m.getSelect(N,"event-type").val()]=P};var k=function(){var P="myCalendars";if(AJS.Meta.get("space-key")){if(AJS.Meta.get("content-id")){P="embedded"}else{if(c.isSingleCalendarView(K)){P="singleCalendar"}else{P="spaceCalendars"}}}Confluence.TeamCalendars.fireEventForAnalytics("add.event."+P)};C=b("form[name='event-edit']",N);C.disableOkButton=function(P){var Q=b.extend({buttonText:"Adding..."},P);O.text(Q.buttonText).attr("disabled","disabled").addClass("ui-state-disabled");E(false)};C.enableOkButton=function(P){var Q=b.extend({buttonText:"OK"},P);O.removeAttr("disabled").removeClass("ui-state-disabled").text(Q.buttonText);E(true)};G(N,H);d.disableOkButton=C.disableOkButton;d.enableOkButton=C.enableOkButton;v(N);n();return d},disableOkButton:function(k){d.disableOkButton(k)},enableOkButton:function(k){d.enableOkButton(k)},getSelectedEventType:function(){return this.getSelect(d.popup.element,"event-type").val()},getSelectedSubCalendarId:function(){return this.getSelect(d.popup.element,"calendar").val()},getTextSelectedEventType:function(){return this.getTextSelect(d.popup.element,"event-type")},getTextSelectedSubCalendar:function(){return this.getTextSelect(d.popup.element,"calendar")}});return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:event-edit', location = 'com/atlassian/confluence/extra/calendar3/components/manage-event/event-edit/event-field-handlers.js' */
define("tc/event-field-handlers",["jquery","tc/jira-event-field-process","tc/calendar-util","confluence-ui-components/js/user-select2"],function(g,h,d,b){g.fn.tcDatePicker=g.fn.tcDatePicker.noConflict();var e=g.tcDatePicker.noConflict();function f(k,i){var j=k instanceof g?k:g(k);j.tcDatePicker(i)}function a(k,i,j){if(/^[1-9]\d*$/.test(i)||i==="0"){if(k==="DAILY"){j.text(parseInt(i)>1?"days":"day")}else{if(k==="WEEKLY"){j.text(parseInt(i)>1?"weeks":"week")}else{if(k==="MONTHLY"){j.text(parseInt(i)>1?"months":"month")}else{if(k==="YEARLY"){j.text(parseInt(i)>1?"years":"year")}}}}}else{j.text("")}}var c={text:function(n,i,k,m,l,j){return{add:function(){i.append(Confluence.TeamCalendars.Templates.Fields.text({id:n.id,label:n.label,required:n.required,readOnly:n.readOnly}))},init:function(){g("#"+n.id+"-text",i).val(k[n.property]||"").keydown(function(){var p=g(this),o=p.val();if(!p.data("valueChangedByUser")){setTimeout(function(){if(o!==p.val()){p.data("valueChangedByUser",true)}},300)}})},setData:function(o){j.getField(i,n.id).val(o)},getData:function(){var o={};o[n.id]=j.getField(i,n.id).val();return o},getElementId:function(){return"#field-text-"+n.id}}},textarea:function(n,i,k,m,l,j){return{add:function(){i.append(Confluence.TeamCalendars.Templates.Fields.textarea({id:n.id,size:n.size,required:n.required,label:n.label,readOnly:n.readOnly}))},init:function(){g("#"+n.id+"-textarea",i).val(k[n.property]||"")},getData:function(){var o={};o[n.id]=g("textarea[name="+n.id+"]",i).val();return o},getElementId:function(){return"#field-textarea-"+n.id}}},page:function(n,i,k,m,l,j){return{add:function(){i.append(Confluence.TeamCalendars.Templates.Fields.page({id:n.id,label:n.label,required:n.required,readOnly:n.readOnly}))},init:function(){g("#"+n.id+"-text",i).val(k[n.property]||"");m.makeAutoCompleteSearch(l,g("input[name='"+n.id+"']",i),{type:["page","blogpost"]},g("."+n.id+"-suggestions",i),function(p,o){p.val(o.attr("href"))})},getData:function(){var p={},o=j.getField(i,n.id);p[n.id]=o.hasClass("with-hint")?"":o.val();return p},getElementId:function(){return"#field-page-"+n.id}}},when:function(n,i,k,m,l,j){return{add:function(){var q,r,o,p;i.append(Confluence.TeamCalendars.Templates.Fields.when({id:n.id,disableStartDateTime:n.disableStartDateTime,disableEndDateTime:n.disableEndDateTime,disableAllDay:n.disableAllDay}));q=j.getField(i,"startTime");r=j.getField(i,"endTime");o=j.getField(i,"allDayEvent");p=m.getParameter(l,"timeSuggestion");q.autocompleteTC({source:p,minLength:2});r.autocompleteTC({source:p,minLength:2});o.click(function(){if(this.checked){q.addClass("hidden");r.addClass("hidden")}else{q.removeClass("hidden");r.removeClass("hidden");if(!q.val()){q.val(m.getDefaultStartTime(l))}if(!r.val()){r.val(m.getDefaultEndTime(l))}}})},init:function(){g(".start, .end",i).each(function(){var s=g(this);f(s,{dateFormat:"ddmmyy",dayNames:m.getDayNames(),dayNamesMin:m.getDayNamesShort(),dayNamesShort:m.getDayNamesShort(),firstDay:m.getParameter(l,"firstDayOfWeek"),monthNames:m.getMonthNames(),monthNamesShort:m.getMonthNamesShort(),beforeShow:function(){g("#ui-datepicker-div").addClass("tc-datepicker")},onClose:function(){g("#ui-datepicker-div").removeClass("tc-datepicker")},onSelect:function(x){var v=e.parseDate("ddmmyy",x);if(s.hasClass("start")){var u=g(".end",i),w=new Date(parseInt(s.data("date"))),t=new Date(u.data("date")-(w.getTime()-v.getTime()));u.tcDatePicker("option","defaultDate",t);u.tcDatePicker("setDate",t);u.data("date",t.getTime()).val(function(){m.formatDate(l,t,"date",function(y){u.val(y)});return "Formatting..."})}s.tcDatePicker("option","defaultDate",v);s.tcDatePicker("setDate",v);s.data("date",v.getTime()).val(function(){m.formatDate(l,v,"date",function(y){s.val(y)});return "Formatting..."})},showAnim:""})});var q=j.getField(i,"startTime"),r=j.getField(i,"endTime"),o=j.getField(i,"allDayEvent"),p=function(t,s,v){var u=g("input[name="+t+"]",i);u.tcDatePicker("option","defaultDate",s);u.tcDatePicker("setDate",s);u.data("date",s.getTime()).val(v||function(){m.formatDate(l,s,"date",function(w){u.val(w)});return "Formatting..."})};k.start&&p("startDate",k.start,k.localizedStartDate);p("endDate",k.end||k.start,k.localizedEndDate);if(k.allDay){q.val("").addClass("hidden");r.val("").addClass("hidden");o.attr("checked","checked")}else{q.val(k.originalStartTime||k.localizedStartTime||function(){m.formatDate(l,k.start,"time",function(s){q.val(s)});return "Formatting..."}).removeClass("hidden");r.val(k.originalEndTime||k.localizedEndTime||function(){m.formatDate(l,k.end||new Date(k.start.getTime()+3600000),"time",function(s){r.val(s)});return "Formatting..."}).removeClass("hidden");o.removeAttr("checked","checked")}},getData:function(){return{startDate:j.getField(i,"startDate").val(),startTime:j.getField(i,"startTime").val(),endDate:j.getField(i,"endDate").val(),endTime:j.getField(i,"endTime").val(),allDayEvent:j.getField(i,"allDayEvent").is(":checked")}},getElementId:function(){return"#field-when"}}},repeats:function(n,i,k,m,l,j){return{add:function(){var r,v,u,p,o,q,t;i.append(Confluence.TeamCalendars.Templates.Fields.repeats({id:n.id}));r=g("select[name='calendar']",i);v=g("select[name='freq-select']",i);u=g("input[name='interval']",i);p=g(".recur-ends",i);o=g(".recur-ends-never",p);q=g(".recur-ends-until",p);t=g("input[name='until']",p);var s=function(x,w,z){var y=g("input[name="+x+"]",i);y.tcDatePicker("option","defaultDate",w);y.tcDatePicker("setDate",w);y.data("date",w.getTime()).val(z)};g("input[name='editthisinstanceonly']",i).change(function(){if(g(this).is(":checked")){j.disableCalSelect();j.showToolTip();r.attr("disabled","disabled");v.attr("disabled","disabled");u.attr("readonly","readonly");o.attr("disabled","disabled");q.attr("disabled","disabled");t.attr("readonly","readonly").tcDatePicker("disable");s("startDate",k.start,k.localizedStartDate);s("endDate",k.end||k.start,k.localizedEndDate)}else{j.enableCalSelect();j.hiddenToolTip();v.removeAttr("disabled");u.removeAttr("readonly");if(g("option:selected",v).val()){o.removeAttr("disabled");q.removeAttr("disabled");if(q.is(":checked")){t.removeAttr("readonly").tcDatePicker("enable")}else{t.tcDatePicker("disable")}}var x=e.parseDate("yy-mm-dd",k.originalStartDateTime.split("T")[0]);var w=e.parseDate("yy-mm-dd",k.originalEndDateTime.split("T")[0]);s("startDate",x,k.localizedOriginalStartDate);s("endDate",w,k.localizedOriginalEndDate)}});v.change(function(){var z=g("option:selected",this).val();var w=g("input[name='freq']",i);var x=g("input[name='byday']",i);var y=g(".interval-container",i);if(z){if(z==="WEEKLY-BYDAY"){u.attr("readonly","readonly").val("1");y.addClass("hidden");w.val("WEEKLY");x.val("MO,TU,WE,TH,FR")}else{u.removeAttr("readonly").val("1");y.removeClass("hidden");w.val(z);x.val("")}p.removeClass("hidden");o.removeAttr("disabled");if(q.removeAttr("disabled").is(":checked")){t.removeAttr("disabled").removeAttr("readonly")}}else{u.val("1");y.addClass("hidden");p.addClass("hidden");o.attr("disabled","disabled");q.attr("disabled","disabled");t.val("").attr("disabled","disabled").attr("readonly","readonly");w.val("");x.val("")}u.trigger("keydown")});u.keydown(function(){setTimeout(function(){var y=g("option:selected",v).val();var x=g(".interval-label",i);var w=g.trim(u.val());a(y,w,x)},300)});g(".recur-ends-never",i).click(function(){t.val("").attr("disabled","disabled").attr("readonly","readonly").tcDatePicker("disable")});g(".recur-ends-until",i).click(function(){t.removeAttr("disabled","disabled").removeAttr("readonly").tcDatePicker("enable")})},init:function(){var o=g(".recur-ends .datepicker-field",i);f(o,{dateFormat:"ddmmyy",dayNames:m.getDayNames(),dayNamesMin:m.getDayNamesShort(),dayNamesShort:m.getDayNamesShort(),firstDay:m.getParameter(l,"firstDayOfWeek"),monthNames:m.getMonthNames(),monthNamesShort:m.getMonthNamesShort(),beforeShow:function(){g("#ui-datepicker-div").addClass("tc-datepicker")},onClose:function(){g("#ui-datepicker-div").removeClass("tc-datepicker")},onSelect:function(t){var s=g(this),r=e.parseDate("ddmmyy",t);s.tcDatePicker("option","defaultDate",r);s.tcDatePicker("setDate",r);s.data("date",r.getTime()).val(function(){m.formatDate(l,r,"date",function(u){s.val(u)});return "Formatting..."})},showAnim:""});var p=function(r){return !r.id};var q=function(){j.getField(i,"recurrenceId").val(k.recurId||"");var x=j.getField(i,"freq").val("");var F=j.getField(i,"byday").val("");var v=j.getField(i,"interval").val("1").attr("readonly","readonly");var y=v.closest(".interval-container");var B=j.getSelect(i,"freq-select");g("option",B.attr("disabled","disabled")).removeAttr("selected");var C=j.getField(i,"editthisinstanceonly");var G=C.closest(".edit-this-instance-only-container");var D=g(".recur-ends",i);var E=j.getField(i,"recur-end").removeAttr("checked").attr("disabled","disabled");var w=j.getField(i,"until").attr("disabled","disabled").attr("readonly","readonly").val("");w.tcDatePicker("disable");if(!p(k)&&k.recur){j.disableCalSelect();j.showToolTip();G.removeClass("hidden");C.attr("checked","checked");var s=k.recur.freq;var A=k.recur.byDay;var t=k.recur.interval;D.removeClass("hidden");x.val(s||"");F.val(A||"");if(A){g("option[value='WEEKLY-BYDAY']",B).attr("selected","selected");y.addClass("hidden")}else{g("option[value='"+s+"']",B).attr("selected","selected");y.removeClass("hidden");v.val(t||"1")}var z=g(".interval-label",i);a(s,t,z);var r=k.recur.until;if(r){g(E[1]).attr("checked","checked");w.removeAttr("disabled");var u=g.fullCalendar.parseDate(r);w.tcDatePicker("setDate",u);w.tcDatePicker("option","defaultDate",u);w.val(k.recur.localizedUntil||function(){m.formatDate(l,u,"date",function(H){w.val(H)});return "Formatting..."})}else{g(E[0]).attr("checked","checked")}}else{if(p(k)&&k.recur){B.removeAttr("disabled");B.val(k.recur.freq).change();g(E[0]).attr("checked","checked")}else{j.enableCalSelect();j.hiddenToolTip();G.addClass("hidden");g("option:first",B.removeAttr("disabled")).attr("selected","selected");y.addClass("hidden");D.addClass("hidden");g(E[0]).attr("checked","checked")}}};q()},getData:function(){var o=j.getField(i,"until");return{freq:j.getField(i,"freq").val(),byday:j.getField(i,"byday").val(),interval:j.getField(i,"interval").val()||"",until:o.val(),repeatEnds:!(o.attr("readonly")||o.attr("disabled")),recurrenceId:j.getField(i,"recurrenceId").val(),editAllInRecurrenceSeries:!j.getField(i,"editthisinstanceonly").is(":checked")}},getElementId:function(){return"#field-repeats"}}},user:function(o,i,k,n,m,j){var l="#"+o.id+"-user-picker";return{add:function(){i.append(Confluence.TeamCalendars.Templates.Fields.user({id:o.id,label:o.label,required:o.required}));b.bind(i)},init:function(){var s=g(".invitees",i),r=function(){g(this).closest("li").remove();if(!g("li",s).length){s.addClass("hidden")}},q=function(){g(".invitee-left",s).filter(function(){return !g(this).attr("threedots")}).ThreeDots({max_rows:1,text_span_class:"invitee-name-display",whole_word:false})},p=function(t){if(!t.startsWith("ari:")){return"ari:cloud:identity::user/"+t}else{return t}};g(l,i).bind("selected",function(y){var v=p(y.choice.id),u=y.choice.text,w=y.choice.imgSrc,t,z=g(".invitee",s).filter(function(){return g(this).data("entity").id===v}).length>0;if(!z){if(g("li",s).length===3){s.addClass("boxed")}t=g(Confluence.TeamCalendars.Templates.Fields.userSelection({displayName:u,avatarIconUrl:w}));t.data("entity",{id:v,displayName:u}).find(".delete-invitee").click(r);s.prepend(t).removeClass("hidden");q()}g(this).val("").focus();var x=g(".who-error",i);if(x.children().length){x.empty()}g(l).auiSelect2("data",[])});if(k.invitees&&k.invitees.length){g.each(k.invitees,function(u,t){s.append(g(Confluence.TeamCalendars.Templates.Fields.userSelection({displayName:t.displayName,avatarIconUrl:t.avatarIconUrl})).data("entity",{id:t.id,displayName:t.displayName}))});g(".delete-invitee",s.removeClass("hidden")).unbind("click").click(r);q()}},getData:function(){var p={};var q=g(".invitee",i);if(q.length){p.person=g.map(q,function(r){return g(r).data("entity").id})}if(o.setTitle){p.what=q.length?g.map(q,function(r){return g(r).data("entity").displayName}).join(", "):""}return p},getElementId:function(){return"#field-user-"+o.id}}},getEventField:function(u,p,i,x,w,k,m){var s=c[u.type](u,p,i,x,w,k);var l=g(s.getElementId(),p);if(l.length){if(u.required){var t=l.find("label:first span.icon-required");if(t.length===0){l.find("label:first").append(g("<span/>",{"class":"aui-icon icon icon-required"}))}}else{l.find("label:first span.icon-required").remove()}p.append(l.show());if(u.type==="repeats"){var j=g("select[name='freq-select']",p);var r=g("input[name='interval']",p);var v=g("input[name=until]",p);var o=!(v.attr("readonly")||v.attr("disabled"));var n=g("input[name=recur-end]",p);if(u.defaultRecur){l.data("repeatData",{repeat:j.val(),interval:r.val(),repeatEnd:o,until:v.val()});j.val("YEARLY").change()}else{var q=l.data("repeatData");if(q){j.val(q.repeat).change();r.val(q.interval);if(q.repeatEnd&&q.repeatEnd==true){g(n[1]).attr("checked","checked");v.removeAttr("readonly").val(q.until).tcDatePicker("enable")}else{g(n[0]).attr("checked","checked")}l.removeData("repeatData")}}}}else{s.add();s.init()}if(u.copyto&&m!==undefined){s.setData(m)}return s},reminder:function(n,i,k,m,l,j){return{add:function(){var p=m.getCurrentReminderForEventType(l,j);g(i).find("#field-text-"+n.id).remove();var o=p&&p.periodInMins>0;i.append(Confluence.TeamCalendars.Templates.Fields.inforReminderLabel({id:n.id,label:n.label,reminderPeriodText:o?AJS.format("{0} before",d.showInforReminder(p.periodInMins)):"None.",reminderPeriod:o?p.periodInMins:0}))},init:function(){},getData:function(){return{}},getElementId:function(){return""}}},"jira-hidden-fields":function(n,i,k,m,l,j){return{add:function(){i.append(Confluence.TeamCalendars.Templates.hiddenJiraFields())},init:function(){var p=h.getSubCalendarForEvent(m,l,k),o=m.getRenderedMacroCallbackHandler(l),q=Confluence.TeamCalendars.getEditCalendarDialogHelper(i,p,o);if(!p||!p.id){q.setSubCalendarIdField("");q.setNameField("");q.setColorField("");q.setSpaceToDefault()}else{q.setSubCalendarIdField(p.id);q.setNameField(p.name);q.setColorField(p.color);q.setSpaceKeyField(p.spaceKey)}},getData:function(){}}},"jira-server-select":function(n,i,k,m,l,j){return{add:function(){i.append(Confluence.TeamCalendars.Templates.Fields.serverSelector());h.getServerSelect(i).disable()},init:function(){var p=h.getServerSelect(i),q=g(".field-group-jira-server .spinner");AJS.unbind("server-select-ready.teamcalendars");AJS.unbind("server-select-change.teamcalendars");function o(s){var r=h.getSubCalendarForEvent(m,l,k);g.each(s.jiraLinks,function(t,u){var v=g("<option/>",{value:u.id,text:u.name,"data-display-url":u.displayUrl});if(s.jiraLinks.length===1){v.prop("selected",true);var w=p.parent();w.children().hide();w.css("min-height",0);g(".oauth-error",w).show()}v.appendTo(p)});if(s.jiraLinks.length>1){g(".field-group-jira-server",i).removeClass("hidden")}if(r){if(r.applicationId){p.val(r.applicationId)}else{if(r.sourceSubCalendar&&r.sourceSubCalendar.applicationId){p.val(r.sourceSubCalendar.applicationId)}}}}p.change(function(){AJS.trigger("server-select-change.teamcalendars",i)});g.ajax({cache:false,error:function(r,t,s){m.showAjaxError(i.parent().parent(),r,t,s)},success:function(r){o(r);AJS.trigger("server-select-ready.teamcalendars",i)},complete:function(){p.enable();q.hide()},timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/jira/jiraLinks")})},getData:function(){}}},"jira-project-select":function(n,i,k,m,l,j){return{add:function(){i.append(Confluence.TeamCalendars.Templates.Fields.projectSelector());g(".tc-jira-project",i).disable()},init:function(){function o(p){if(p.id===i[0].id){g(".oauth-approve",i).remove();h.populateProjectList(n,i,k,m,l,j)}}AJS.bind("server-select-ready.teamcalendars",function(q,p){o(p)});AJS.bind("server-select-change.teamcalendars",function(q,p){o(p)})},getData:function(){}}},"jira-dates":function(n,i,k,m,l,j){return{add:function(){i.append(Confluence.TeamCalendars.Templates.editJiraCalendar())},init:function(){AJS.bind("server-select-ready.teamcalendars",function(){h.initJiraDate(n,i,k,m,l,j)});AJS.bind("server-select-change.teamcalendars",function(){h.initJiraDate(n,i,k,m,l,j)})},getData:function(){}}}};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:event-edit', location = 'com/atlassian/confluence/extra/calendar3/components/manage-event/event-edit/jira-event-field-process.js' */
define("tc/jira-event-field-process",["jquery","tc/calendar-util"],function(c,a){function e(k,f,j,l,i){function g(){if(!c("input[name='subCalendarId']",f).val()){Confluence.TeamCalendars.fireEventForAnalytics("event.create.default."+k.type+".context."+j.getParameter("calendarContext"),{})}}if(j.isProcessingSubCalendar()){return false}var h=j.setSubCalendarSpinnerIconVisible(true);g();if(j.getIncludedCalendars()){k.include=j.getIncludedCalendars()}var m=k.subCalendarId;a.putCalendarContextParams(k);c.ajax({cache:false,converters:{"text json":function(n){return n}},data:k,dataFilter:function(n){var o=c.parseJSON(n);if(o.success){Confluence.TeamCalendars.mergeSubCalendarObjectsToArray(o.payload)}return o},dataType:"json",error:function(n,p,o){j.showAjaxUpdateError(n,p,o);l()},success:function(o){j.setGenericUpdateError();if(o.success){Confluence.TeamCalendars.setFieldErrors(f,null);var n=m;if(n){j.setSubCalendars(m,o.payload);j.reloadSubCalendar(m)}else{m=o.modifiedSubCalendarId;j.setSubCalendars(m,o.payload)}i();if(!o.modifiedSubCalendarId&&j.shouldShowFeatureDiscoveryDialog(m)){j.getSubCalendarFeatureDiscoveryDialog(m)}}else{Confluence.TeamCalendars.setFieldErrors(f,o.fieldErrors);l()}},complete:function(){if(h){h.resolve()}},type:"PUT",timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/subcalendars.json")});return false}function b(f,g,i,j,h){return{type:h,parentId:i,subCalendarId:c("input[name='subCalendarId']",f).val(),name:g,description:"",color:c("input[name='color']",f).val(),location:"jira://".concat(encodeURIComponent(d.getServerSelect(f).val()||""),"?projectKey=",encodeURIComponent(c("select[name='tc-jira-project'] option:selected",f).val()),"&dateFieldName=",j)}}var d={getServerSelect:function(f){return c(".tc-jira-server",f)},getJiraOptions:function(f,h,g){c.ajax({cache:false,dataType:"json",error:function(i,k,j){f(i,k,j)},success:function(i){h(i);var j=AJS.format("We didn\'\'t find any projects. \u003ca href=\"{0}\" target=\"_blank\"\u003eCreate a JIRA project\u003c/a\u003e before continuing.",c(".tc-jira-server option:selected").data("display-url"));c(".option-project .unavailable-message").html(j)},timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.getBaseUrl()+"/rest/calendar-services/1.0/calendar/jira/"+encodeURIComponent(g)+"/query/options.json"})},getSubCalendarForEvent:function(h,g,f){if(f.eventType==="jira-calendar"||f.eventType==="jira-agile-sprint-calendar"||f.eventType==="jira-project-releases-calendar"){return h.getSubCalendar(g,f.subCalendarId)}return null},showOauthRequitedMessage:function(j,g,i,l,k){var h=c.parseJSON(j.responseText);var f=c(".oauth-error",g).empty().removeClass("hidden");i.disableOkButton({buttonText:"OK"});c(document.createElement("div")).addClass("oauth-approve aui-message hint").html(AJS.format("\u003cp class=\"title\"\u003e\u003cspan class=\"aui-icon aui-icon-info\"\u003e\u003c/span\u003e\u003c/p\u003e\u003cp class=\"info-approve\"\u003e\u003ca href=\"#\" class=\"approve-dance\"\u003e{0}\u003c/a\u003e to see list of projects\u003c/p\u003e",c(document.createElement("span")).text("Login & Approve").html())).appendTo(f).find(".approve-dance").click(function(){AppLinks.authenticateRemoteCredentials(h.oAuthUrl,function(){l.removeClass("hidden");f.addClass("hidden");i.enableOkButton();k()},function(){alert("Approval unsuccessful. Could you please try again?")});return false})},populateProjectList:function(m,j,g,p,o,i){var l=c(".tc-jira-project",j),n=c(".field-group-jira-project .spinner"),f=i.getSelectedEventType(),h=d.getServerSelect().val(),k=function(){var s=c("input[name='name']",j),q=d.getSubCalendarForEvent(p,o,g),r=function(t){if(!s.data("valueChangedByUser")){return t}return s.val()};if(!q){if(f==="jira-agile-sprint-calendar"){s.val(r(AJS.format("{0} - Sprints",c("option:selected",l).text())))}else{if(f==="jira-project-releases-calendar"){s.val(r(AJS.format("{0} - Releases",c("option:selected",l).text())))}}}};l.change(k).disable();n.show();d.getJiraOptions(function(q,s,r){n.hide();if(Confluence.TeamCalendars.isRequireOauth(q)){l.empty();d.showOauthRequitedMessage(q,j,i,l,function(){d.populateProjectList(h)})}else{l.enable();p.showAjaxError(j.parent().parent(),q,s,r)}},function(q){var s=q.projects,t=l.empty(),r=d.getSubCalendarForEvent(p,o,g);n.hide();l.enable();c.each(s,function(u,v){c(document.createElement("option")).val(v.key).text(v.name).appendTo(t)});if(r){t.val(r.projectKey)}else{k()}},h)},initJiraDate:function(q,n,h,u,t,m){var p=d.getSubCalendarForEvent(u,t,h),j=u.getRenderedMacroCallbackHandler(t),r=c("select[name='project']",n),s=function(){if(!p){var v=c("input[name='name']",n);v.val(function(){if(!v.data("valueChangedByUser")){return c("option:selected",r).val()?AJS.format("{0} - Issues",c("option:selected",r).text()):""}return v.val()});o()}};r.off("change").on("change",s);var o=function(){c(".project-error",n).empty();c(".name-error",n).empty();c(".dateFieldName-error",n).empty()};var k=function(w){var v=c(".field-group-jira-show",n);if(w){v.css("display","none")}else{v.css("display","block")}};var l=function(){var B=c(".form-mode",n),w=d.getServerSelect(n),v=c(".jira-query-options .option-project",n),z=c("select[name='project']",v),y=c(".timeZoneIdDisplay",n),x=Confluence.TeamCalendars.getEditCalendarDialogHelper(n,p,j);Confluence.TeamCalendars.setFieldErrors(n,null);c("input[name='searchFilterName']",n).addClass("with-hint").val("Search filter");c("textarea[name='jql']",n).addClass("with-hint").val("JQL query");if(!p||!p.id){x.setFormModeCreate();x.setSubCalendarIdField("");x.setNameField("");x.setDescriptionField("");x.setColorField("");x.setSpaceToDefault();x.setTimeZoneIdDisplayField("");y.hide();i(null,function(){f(function(){s()})})}else{x.setFormModeEdit();x.setSubCalendarIdField(p.id);x.setNameField(p.name);x.setDescriptionField(p.description);x.setColorField(p.color);x.setSpaceKeyField(p.spaceKey);x.setSpaceKeyAutocompleteField(p.spaceName);i(null,function(){var H=c(".jira-query-options",n),I="option-project-selected option-search-filter-selected option-jql-selected",D;c(".matrix input.radio",H).removeAttr("checked");var L=p.sourceSubCalendar||p;if(L.projectKey){var K=false;c("option",z).removeAttr("selected").each(function(){var M=c(this);if(M.val()===L.projectKey){M.attr("selected","selected");K=true;return false}});if(!K){z.append(c(document.createElement("option")).val(L.projectKey).text(L.projectName||L.projectKey).attr("selected","selected"))}c(".radio-project input.radio",H.removeClass(I).addClass("option-project-selected")).attr("checked","checked");D=v.data("hiddenDateFields")}else{if(L.searchFilterId){var E=c(".option-search-filter",H);var G=c("input[name='searchFilterName']",E);c("input[name='searchFilter']",E).val(L.searchFilterId);var C=L.searchFilterName||L.searchFilterId;var F=c(G).data("searchFilters");if(F){C=c.map(F,function(M){if(M.id===L.searchFilterId&&M.name.length>0){return M.name}})}c(G).removeClass("with-hint").val(C);c(".radio-search-filter input.radio",H.removeClass(I).addClass("option-search-filter-selected")).attr("checked","checked");D=E.data("hideDateFields")}else{if(L.jql){var J=c(".option-jql",H);c("textarea[name='jql']",J).removeClass("with-hint").val(L.jql);c(".radio-jql input.radio",H.removeClass(I).addClass("option-jql-selected")).attr("checked","checked")}}}f(function(){var N=c(".field-group-jira-show .single-dates .date-fields div.checkbox",n),M={},O=L.dateFieldNames||[];c(".date-fields input",n).removeAttr("checked");N.each(function(){var Q=c("input",this),P=Q.val();if(c.inArray(P,O)!==-1){Q.attr("checked","checked")}M[P]=c("label",this).text()});c.each(L.durations||[],function(P,V){var Q=M[V.startDateFieldName||""],U=M[V.endDateFieldName||""];if(Q&&U){var T=c(".field-group-jira-show .duration .date-fields",n),S=V.startDateFieldName+"/"+V.endDateFieldName,R="duration-"+S;c("<div/>",{"class":"checkbox"}).append(c("<input/>",{id:R,name:"dateFieldName",type:"checkbox",value:S,checked:"checked"})).append(c("<label/>",{"for":R,html:AJS.format("Start: {0}",c("<span/>",{text:Q}).html())+"<br>"+AJS.format("End: {0}",c("<span/>",{text:U}).html())})).appendTo(T);T.parent().addClass("has-selected-duration")}});if(D){k(D)}})});y.text(p.timeZoneId)}var A=c("input[name='name'], input[name='description'], input[name='spaceKeyAutocomplete'], input[name='searchFilterName'], textarea[name='jql']",n);if(j.isCalendarInEditMode()){A.removeAttr("readonly");w.removeAttr("disabled");z.removeAttr("disabled")}else{B.removeClass().addClass("form-mode read-only");A.attr("readonly","readonly");w.attr("disabled","disabled");z.attr("disabled","disabled")}};var g=function(){c("select[name='server']",n).change(function(){var x=c("select[name='server'] option:selected",n);if(x.length&&x.val()){i(null,function(){f()})}});c("input[name='spaceKeyAutocomplete']",n).bind("selected.autocomplete-content",function(y,x){c("input[name='spaceKey']",n).val(x.content.key);c(this).val(x.content.name);c(".spaceKeyAutocomplete-error",n).empty()});c(".jira-query-options .query-group input.radio",n).off("change").on("change",function(){var z=c(this).val(),y=c(".jira-query-options",n).removeClass("option-project-selected option-search-filter-selected option-jql-selected").addClass(z+"-selected"),x=c("."+z,y);c("input",x).focus(function(){var A=c(this);if(A.hasClass("with-hint")){A.removeClass("with-hint").val("")}});if("option-jql"===z){c("textarea",x).trigger("keydown",[true])}f(function(){k(x.data("hideDateFields")||!c(".option-value",x).val());var A=c(".duration",n);if(c(".date-fields",A).children().length){A.addClass("has-selected-duration")}else{A.removeClass("has-selected-duration")}})});var w=c(".option-search-filter",n);var v=c(".search-filter-suggestions",w);c("input[name='searchFilterName']",w).keydown(function(){var x=c(this);var y=x.val();setTimeout(function(){var A=x.val();if(!A||A!==y){v.empty()}if(A!==y){A=A.toLowerCase();var C=c.grep(x.data("searchFilters")||[],function(D){return D.name.toLowerCase().indexOf(A)!==-1});if(C.length){var z=c(document.createElement("div")).addClass("dropdown-container").append(c(document.createElement("div")).addClass("aui-dd-parent").append(c(document.createElement("a")).addClass("aui-dd-trigger").attr("href","#").text("Show autocomplete")).append(c(document.createElement("ul")).addClass("aui-dropdown")));var B=c(".aui-dropdown",z).appendTo(c(".aui-dd-parent",z));c.each(C,function(E,D){var F=c(document.createElement("li")).append(c(document.createElement("a")).attr("href","#").text(D.name)).data("searchFilter",D).appendTo(B).click(function(){x.val(D.name);c("input[name='searchFilter']",w).val(D.id);c(".error",w).empty();f()});if(D.description){F.attr("title",D.description)}});z.appendTo(v).dropDown("Standard",{alignment:"left"});v.removeClass("hidden")}}},300)});c("select[name='project']",n).change(function(){f()});c(".jira-query-options input[name='searchFilterName']",n).keydown(function(y){var B=y.keyCode;var x=c(this);if(!(B===38||B===40||B===13)){setTimeout(function(){n.click();var D=x.val().toLowerCase();if(D){var C=x.data("searchFilters");if(C&&c.isArray(C)){var E=c(".search-filter-suggestions .aui-dropdown li",n).each(function(){var F=c(this);if(F.data("searchFilter").name.toLowerCase().indexOf(D)===-1){F.addClass("hidden")}else{F.removeClass("hidden")}});if(E.filter(function(){return !c(this).hasClass("hidden")}).length){c(".search-filter-suggestions .aui-dd-trigger",n).trigger("click")}}}},300)}else{if(B===13){y.preventDefault();var A=c(".search-filter-suggestions .aui-dropdown li.active",n);if(A.length){var z=A.data("searchFilter");x.val(z.name);c("input[name='searchFilter']",n).val(z.id);c(".option-search-filter .error",n).empty();n.click();f()}}}});c(".add-duration",n).unbind().click(function(){AJS.log("Open Jira Duration Dialog");var z=new AJS.Dialog({height:423,width:520,id:"add-jira-duration-dialog"});z.addHeader("Add duration between issue dates");z.addPanel("",Confluence.TeamCalendars.Templates.editJiraSubCalendarDurations(),"calendar-dialog-panel");var E=z.getCurrentPanel().body,D=c(".field-group-jira-show .duration .date-fields",n),B=c(".field-group-jira-show .single-dates .date-fields",n);z.addSubmit("Add",function(){var I=c(".duration-start select option:selected",E),G=c(".duration-end select option:selected",E),H=I.val()+"/"+G.val(),K=c("div.checkbox",D).filter(function(){return c("input",this).val()===H});if(K.length){c("input",K).attr("checked","checked")}else{var J="duration-"+H;c("<div/>",{"class":"checkbox"}).append(c("<input/>",{id:J,type:"checkbox",name:"dateFieldName",value:H,checked:"checked"})).append(c("<label/>",{"for":J,html:AJS.format("Start: {0}",I.html())+"<br>"+AJS.format("End: {0}",G.html())})).prependTo(D);D.parent().addClass("has-selected-duration")}z.remove();m.show()});z.addCancel("Cancel",function(){z.remove();m.show()});var y=c.map(c("div.checkbox",B).filter(function(){return c(this).data("mappableAsDuration")}),function(G){return c("<option/>",{value:c("input",G).val(),text:c("label",G).text()})}),A=c(".duration-start select",E),F=c(".duration-end select",E),x=function(H,G){var I=z.popup.element.find(".button-panel-submit-button");if(G&&H&&G!==H){I.prop("disabled",false).removeClass("ui-state-disabled")}else{I.prop("disabled",true).addClass("ui-state-disabled")}};c.each(y,function(H,G){c(G).appendTo(A).clone().appendTo(F)});if(!y.length){c(".duration-fields",E).addClass("hidden");c(".add-fields",c(".no-selectable-date-fields",E).removeClass("hidden")).html(AJS.format("If you are a JIRA administrator, you \u003ca href=\"{0}/secure/admin/ViewCustomFields.jspa\" target=\"_blank\"\u003ecan create custom date fields\u003c/a\u003e and they will appear as options for issue start and end dates.",c(".field-group-jira-server select option:checked",n).data("display-url")))}var C=function(G,I){var H=c("option:selected",I).val();c("option",I).filter(function(){return c(this).val()}).remove();c.each(y,function(K,J){if(J.val()!==G){J.clone().appendTo(I)}});c("option",I).removeAttr("selected").filter(function(){return c(this).val()===H}).attr("selected","selected")};A.change(function(){var G=c("option:selected",this).val();C(G,F);x(G,c("option:selected",F).val())});F.change(function(){var G=c("option:selected",this).val();C(G,A);x(G,c("option:selected",A).val())});m.hide();x();z.show();return false});c(".subcalendar-cancel",n).click(function(){m.remove();return false});return n};var i=function(A,E){var B=c(".jira-query-options",n);var D=c(".query-group input.radio",B).attr("disabled","disabled").removeAttr("checked","checked");var w=c(".field-group .project-select-label",B);var z=c(".query-group",B);var G=c(".compatibility-group, .field-group-jira-show",B);var y=c(".form-mode",n).addClass("jira-query-options-loading");var x=d.getServerSelect(n).val();var v=A;var C=function(H,J,I){y.removeClass("jira-query-options-loading");z.addClass("hidden");w.removeClass("hidden");G.addClass("hidden");if(Confluence.TeamCalendars.isRequireOauth(H)){d.showOauthRequitedMessage(H,n,m,G,l)}else{if(!(v&&c.isFunction(v))){v=function(L,N,M){var K=new Array();K[0]=M;u.setGenericErrors(n.parent().parent(),K)}}v(H,J,I)}};var F=function(J){G.removeClass("hidden");y.removeClass("jira-query-options-loading");D.removeAttr("disabled","disabled");if(!J.searchRequests){c(".radio-search-filer input",n).attr("disabled","disabled")}if(!B.hasClass("option-project-selected")){B.removeClass("option-search-filter-selected option-jql-selected").addClass("option-project-selected")}c(".radio-project input",B).attr("checked","checked");if(J.jqlNotSupported){z.addClass("hidden");w.removeClass("hidden")}else{w.addClass("hidden");z.removeClass("hidden");var P=new Date().getTime();var I="jql-"+P;c("textarea[name='jql']",B).before(c(document.createElement("textarea")).attr({autocomplete:"off",cols:"20",id:I,name:"jql",rows:1,wrap:"off",placeholder:"JQL query"}).addClass("textarea with-hint").focus(function(){var T=c(this);if(T.hasClass("with-hint")){T.removeClass("with-hint").val("")}}).val("")).remove();var Q=/.+\/jql\/autocomplete.json\?fieldName=[^&]+&fieldValue=.*/;var S=c(".jqlAutoCompleteSpinner",B);B.ajaxSend(function(V,U,T){if(Q.test(T.url||"")){S.removeClass("hidden")}}).ajaxComplete(function(V,U,T){if(Q.test(T.url||"")){S.addClass("hidden")}});c(".option-jql label",B).attr("for",I);var M="jql-error-"+P;c(".jql-error",B).before(c(document.createElement("div")).addClass("error jql-error").attr("id",M)).remove();c(".dropdown-ready",B).remove();JIRA.JQLAutoComplete({fieldID:I,parser:JIRA.JQLAutoComplete.MyParser(c.parseJSON(J.jqlReservedKeywordsJson||"[]")),queryDelay:0.65,jqlFieldNames:c.parseJSON(J.visibleFieldNamesJson||"[]"),jqlFunctionNames:c.parseJSON(J.visibleFunctionNamesJson||"[]"),minQueryLength:0,allowArrowCarousel:true,autoSelectFirst:false,errorID:M,jiraApplicationId:d.getServerSelect().val(),baseUrl:Confluence.getBaseUrl()});c("textarea[name='jql']",n).keydown(function(V,U){var W=c(this);var T=W.val();if(U||V.keyCode!==27){setTimeout(function(){var Y=W.val();var Z=c(".jql-error",n);if(Y&&!W.hasClass("with-hint")&&(U||Y!==T)){c.ajax({cache:false,data:{jql:Y},error:function(){Z.empty().text("Unable to validate JQL against selected JIRA instance.")},success:function(ad){var ac=c(".jql-ok",n),ab=c(".jql-bad",n),aa=c(".duration",n);if(ad.valid){ac.removeClass("hidden");ab.addClass("hidden");f(function(){aa.addClass("can-add-duration");if(c(".date-fields div.checkbox",aa).length){aa.addClass("has-selected-duration")}else{aa.removeClass("has-selected-duration")}});W.focus()}else{ac.addClass("hidden");ab.removeClass("hidden");c(".date-fields",n).empty();k(true);aa.removeClass("can-add-duration")}},type:"PUT",url:Confluence.getBaseUrl().concat("/rest/calendar-services/1.0/calendar/jira/",encodeURIComponent(d.getServerSelect(n).val()),"/jql/validate.json"),timeout:Confluence.TeamCalendars.ajaxTimeout})}},300)}else{var X=c(".option-jql .suggestions",B);if(X.is(":visible")){X.hide();return false}}})}var R=J.searchRequests;var L=c(".option-search-filter",n);var H=c("input[name='searchFilterName']",L).removeData("searchFilters");if(R&&c.isArray(R)&&R.length){H.data("searchFilters",R);c(".option-content",L.removeData("hideDateFields")).removeClass("disabled")}else{H.attr("disabled","disabled");c(".option-content",L.data("hideDateFields",true)).addClass("disabled")}var K=J.projects;var O=c(".option-project",n);if(K&&c.isArray(K)&&K.length){var N=c("select",O).empty();c(document.createElement("option")).val("").text("Select").appendTo(N);c.each(K,function(T,U){c(document.createElement("option")).val(U.key).text(U.name).appendTo(N)});c(".option-content",O.removeData("hideDateFields")).removeClass("disabled")}else{c(".option-content",O.data("hideDateFields",true)).addClass("disabled")}if(!J.dateRangeSupported){c(".duration",n).css("visibility","hidden")}else{c(".duration",n).css("visibility","visible")}m.enableOkButton();if(E&&c.isFunction(E)){E(J)}};d.getJiraOptions(C,F,x)};var f=function(y){var x=c(".field-group-jira-show div.checkbox",n).filter(function(){return c("input",this).is(":checked")}),D=c(".jira-query-options .matrix .radio:checked",n).val(),F=c(".duration",n),A={},w="";if("option-project"===D){var v=encodeURIComponent(c(".jira-query-options .option-project select option:selected",n).val());if(v){w="/project/"+v}}else{if("option-search-filter"===D){var C=c(".jira-query-options .option-search-filter input[name='searchFilter']",n).val();if(C){w="/filter/"+encodeURIComponent(C)}}else{if("option-jql"===D){A.query=c(".jira-query-options .option-jql textarea",n).val()||"";if(A.query){w="/jql"}}}}F.removeClass("can-add-duration");if(w){var B=c(".date-fields-spinner-container",n).removeClass("hidden"),E=c(".single-dates .date-fields",n).empty(),z=c(".date-fields",F).empty();c.ajax({cache:false,data:A,dataType:"json",error:function(){B.addClass("hidden");c(".dateFieldName-error",n).text("Error retrieving list of date fields.")},success:function(I){B.addClass("hidden");var J=c("<div/>"),H=c.map(x,function(K){return c("input",K).val()}),G=c.map(I,function(K){return K.key});c.each(I,function(L,K){c("<div/>",{"class":"checkbox"}).append(c("<input/>",{id:"option-"+K.key,name:"dateFieldName",type:"checkbox",value:K.key,checked:c.inArray(K.key,H)!==-1})).append(c("<label/>",{"for":"option-"+K.key,text:K.name})).data("mappableAsDuration",K.customfield||K.key==="duedate"||K.key==="created"||K.key==="resolution").appendTo(J)});x.filter(function(){var L=c("input",this).val();if(L.indexOf("/")!==-1){var K=L.split("/",2);return K.length===2&&c.inArray(K[0],G)!==-1&&c.inArray(K[1],G)!==-1}return false}).appendTo(z.empty());J.appendTo(E.empty());if(J.children().length){k(false);F.addClass("can-add-duration")}else{F.removeClass("can-add-duration")}if(y&&c.isFunction(y)){y(I)}},timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.getBaseUrl().concat("/rest/calendar-services/1.0/calendar/jira/",encodeURIComponent(d.getServerSelect(n).val()),"/date-fields",w,".json")})}else{k(true);if(y&&c.isFunction(y)){y()}}};g();l()},CustomSubmitter:{JiraIssues:{submitForm:function(f,i,j,h,g,k){function l(){var q="",n=c(".field-group-jira-show .date-fields div.checkbox").filter(function(){return c("input:checked",this).length});c.each(n,function(){var s=c("input",this).val();if(s.indexOf("/")!==-1){var r=s.split("/",2);if(q){q+="&"}q+="duration="+encodeURIComponent(r[0]+"/"+r[1])}else{if(q){q+="&"}q+="dateFieldName="+encodeURIComponent(s)}});var o={type:"jira",parentId:j,subCalendarId:c("input[name='subCalendarId']",f).val(),name:i,description:"",color:c("input[name='color']",f).val()},m="jira://"+encodeURIComponent(d.getServerSelect(f).val()||"")+"?",p=c(".jira-query-options .matrix input.radio:checked",f).val();if("option-project"===p){m+="projectKey="+encodeURIComponent(c("select[name='project'] option:selected",f).val())}else{if("option-search-filter"===p){m+="searchFilterId="+c("input[name='searchFilter']",f).val()}else{m+="jql="+encodeURIComponent(c("textarea[name='jql']",f).val())}}if(q){m+="&"+q}o.location=m;return o}e(l(),f,h,k,g)}},JiraAgileSprints:{submitForm:function(f,i,j,h,g,k){var l=b(f,i,j,"sprint","jira-agile-sprint");e(l,f,h,k,g)}},JiraProjectReleases:{submitForm:function(f,i,j,h,g,k){var l=b(f,i,j,"versiondue","jira-project-releases");e(l,f,h,k,g)}}}};return d});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:event-edit', location = 'com/atlassian/confluence/extra/calendar3/components/manage-event/event-edit/event-types.js' */
define("tc/event-types",["jquery","tc/jira-event-field-process"],function(c,d){var b={fields:[{type:"user",id:"who",label:"Who",required:true,property:"what",setTitle:true},{type:"when",id:"people"},{type:"repeats",id:"people"},{type:"reminder",id:"reminder",label:"Reminder"},{type:"text",id:"description",property:"description",label:"Summary",copyto:"what"},{type:"page",id:"url",property:"workingUrl",label:"Related page"}]};var a={DefaultEventType:{travel:c.extend({},b,{id:"travel",name:"Travel"}),leaves:c.extend({},b,{id:"leaves",name:"Leave"}),birthdays:c.extend(true,{},b,{id:"birthdays",name:"Birthdays",fields:[{},{},{defaultRecur:{freq:"YEARLY"}}]}),jira:{id:"jira",name:"JIRA Issue Dates",hiddenFromEventCreation:true,fields:[{type:"text",id:"what",property:"title",label:"What",required:true,readOnly:true},{type:"when",id:"simple",disableEndDateTime:true,disableAllDay:true},{type:"reminder",id:"reminder",label:"Reminder"},{type:"page",id:"url",property:"workingUrl",label:"Related page",readOnly:true},{type:"textarea",id:"description",property:"description",label:"Description",size:5,readOnly:true}]},"jira-agile-sprint":{id:"jira-agile-sprint",name:"JIRA Agile Sprints",hiddenFromEventCreation:true,fields:[{type:"text",id:"what",property:"title",label:"What",required:true,readOnly:true},{type:"when",id:"simple",disableEndDateTime:true,disableAllDay:true},{type:"reminder",id:"reminder",label:"Reminder"},{type:"page",id:"url",property:"workingUrl",label:"Related page",readOnly:true},{type:"textarea",id:"description",property:"description",label:"Description",size:5,readOnly:true}]},"jira-project-releases":{id:"jira-project-releases",name:"JIRA Project Releases",hiddenFromEventCreation:true,fields:[{type:"text",id:"what",property:"title",label:"What",required:true,readOnly:true},{type:"when",id:"simple",disableEndDateTime:true,disableAllDay:true},{type:"reminder",id:"reminder",label:"Reminder"},{type:"page",id:"url",property:"workingUrl",label:"Related page",readOnly:true},{type:"textarea",id:"description",property:"description",label:"Description",size:5,readOnly:true}]},other:{id:"other",name:"Events",fields:[{type:"text",id:"what",property:"title",label:"What",required:true,copyto:"description"},{type:"user",id:"who",label:"Who",property:"what"},{type:"when",id:"simple"},{type:"repeats",id:"simple"},{type:"reminder",id:"reminder",label:"Reminder"},{type:"text",id:"where",property:"where",label:"Where"},{type:"page",id:"url",property:"workingUrl",label:"Related page"},{type:"textarea",id:"description",property:"description",label:"Description",size:5}]},"jira-calendar":{id:"jira-calendar",name:"JIRA Issue Dates",customHandler:d.CustomSubmitter.JiraIssues,hiddenFromEventCreation:!Confluence.TeamCalendars.hasJiraLink,fields:[{type:"jira-server-select",id:"server",property:"server",label:"Server",required:true},{type:"text",id:"name",property:"name",required:true,label:"Name"},{type:"reminder",id:"reminder",label:"Reminder"},{type:"jira-dates",id:"jira-dates"}]},"jira-agile-sprint-calendar":{id:"jira-agile-sprint-calendar",name:"JIRA Agile Sprints",customHandler:d.CustomSubmitter.JiraAgileSprints,hiddenFromEventCreation:!Confluence.TeamCalendars.hasJiraLink,fields:[{type:"jira-hidden-fields",id:"",property:"",required:true,label:""},{type:"jira-server-select",id:"server",property:"server",label:"Server",required:true},{type:"jira-project-select",id:"project",property:"project",label:"Project",required:true},{type:"text",id:"name",property:"title",required:true,label:"Name"},{type:"reminder",id:"reminder",label:"Reminder"}]},"jira-project-releases-calendar":{id:"jira-project-releases-calendar",name:"JIRA Project Releases",customHandler:d.CustomSubmitter.JiraProjectReleases,hiddenFromEventCreation:!Confluence.TeamCalendars.hasJiraLink,fields:[{type:"jira-hidden-fields",id:"",property:"",required:true,label:""},{type:"jira-server-select",id:"server",property:"server",label:"Server",required:true},{type:"jira-project-select",id:"project",property:"project",label:"Project",required:true},{type:"text",id:"name",property:"title",required:true,label:"Name"},{type:"reminder",id:"reminder",label:"Reminder"}]}},CustomEventType:{id:"custom",name:"Event",fields:[{type:"text",id:"what",property:"title",label:"What",required:true,copyto:"description"},{type:"user",id:"who",label:"Who",property:"what"},{type:"when",id:"simple"},{type:"repeats",id:"simple"},{type:"reminder",id:"reminder",label:"Reminder"},{type:"text",id:"where",property:"where",label:"Where"},{type:"page",id:"url",property:"workingUrl",label:"Related page"},{type:"textarea",id:"description",property:"description",label:"Description",size:5}]}};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:event-edit', location = 'com/atlassian/confluence/extra/calendar3/components/manage-event/event-edit/event-edit-dialog-combat.js' */
require(["tc/event-edit-dialog"],function(a){if(!Confluence.TeamCalendars.Dialogs){Confluence.TeamCalendars.Dialogs={}}Confluence.TeamCalendars.Dialogs.getEditEventDialog=function(d,c,e,b){return new a().getEditEventDialog(d,c,e,b)}});
}catch(e){WRMCB(e)};