(window.webpackJsonp=window.webpackJsonp||[]).push([[356],{"96U/":function(e,t,i){"use strict";var n,o=i("ERkP"),a=i.n(o),s=i("7nmT"),r=i.n(s),c=i("Jygk"),l=i.n(c),d=i("ddV6"),u=i.n(d),m=i("VrFO"),h=i.n(m),g=i("Y9Ll"),f=i.n(g),p=i("N+ot"),v=i.n(p),y=i("AuHH"),C=i.n(y),M=i("1Pcy"),b=i.n(M),E=i("5Yy7"),w=i.n(E),I=i("KEM+"),k=i.n(I),N=i("aWzz"),T=i.n(N),D=i("uDfI"),A=i("kFJ8"),x=i("L21V"),S=i("lZoD"),R=i("kD2R"),P=i("nWyW"),O=i("Z49i"),L=i("JxFu"),j=i("Clud"),H=i("7M9M"),z=i("JPM9"),_=i("dSSn"),$=i("WnYe"),V=(n={},k()(n,H.ADMIN_GLOBAL_PERMISSIONS.name,"ADMIN_GLOBAL"),k()(n,H.ADMIN_EDIT_GLOBAL_PERMISSIONS.name,"ADMIN_GLOBAL"),k()(n,H.ADMIN_SPACE_PERMISSIONS.name,"ADMIN_SPACE"),k()(n,H.ADMIN_EDIT_SPACE_PERMISSIONS.name,"ADMIN_SPACE"),k()(n,H.SPACE_PERMISSION.name,"SPACE"),k()(n,H.SPACE_RESTRICTED_PAGES.name,"SPACE_CONTENT"),n),U=function(e){function t(){var e,i;h()(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=v()(this,(e=C()(t)).call.apply(e,[this].concat(o))),k()(b()(i),"el",window.document.getElementById($.a)),i}return w()(t,e),f()(t,[{key:"isSectionMessageNeeded",value:function(e){return e&&Boolean(V[e.name])}},{key:"isGrandfathered",value:function(){return Boolean(this.el.getAttribute("data-grandfathered"))}},{key:"canUserClearPermissions",value:function(){return Boolean(this.el.getAttribute("data-canClear"))}},{key:"render",value:function(){var e=this;return this.el?a.a.createElement(j.b.Consumer,null,function(t){var i=t.location,n=(0,t.matchRoute)(i.pathname+i.search);return e.isSectionMessageNeeded(n)?r.a.createPortal(a.a.createElement(_.a,{context:V[n.name],grandfathered:e.isGrandfathered(),canClear:e.canUserClearPermissions()}),e.el):null}):null}}]),t}(o.Component);U.displayName="ChangeEditionSectionMessageLegacyCoordinator";var F=i("97Jx"),Y=i.n(F),G=i("7wq/"),Q=i.n(G),B=i("KsTJ"),W=i("Pydg"),Z=i("ZmIu"),X=i("dV0T"),q=i("XMEu"),J=i("llcG");function K(){var e=Q()(["\n  padding: 16px 0 60px;\n  min-height: 80px;\n"]);return K=function(){return e},e}var ee=B.default.div(K()),te=function(e){var t=e.isOpen,i=e.heading,n=e.cancelAction,o=e.applyAction,s=e.children;return a.a.createElement(W.b,null,t&&a.a.createElement(Z.a,{width:"small",appearance:"warning",heading:i,components:{Footer:function(){return a.a.createElement(X.d,null,a.a.createElement("span",null),a.a.createElement(q.a,null,a.a.createElement(J.a,{appearance:"subtle",onClick:n.onClick},n.text),a.a.createElement(J.a,{appearance:"warning",onClick:o.onClick},o.text)))}},onClose:n.onClick},a.a.createElement(ee,null,s)))};te.displayName="ChangeEditionNotificationDialog",te.defaultProps={isOpen:!1};var ie=i("mTU2"),ne=function(e){function t(){var e,i;h()(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=v()(this,(e=C()(t)).call.apply(e,[this].concat(o))),k()(b()(i),"state",{isNotificationOpen:!1,pageName:null}),k()(b()(i),"placeholderEl",window.document.getElementById($.c)),k()(b()(i),"openNotificationDialog",function(e){i.setState({isNotificationOpen:!0,pageName:e.target.getAttribute("data-page-title")})}),k()(b()(i),"closeNotificationDialog",function(){i.setState({isNotificationOpen:!1,pageName:null})}),i}return w()(t,e),f()(t,[{key:"componentDidMount",value:function(){var e=this,t=window.document.getElementsByClassName($.d);Array.prototype.forEach.call(t,function(t){t.addEventListener("click",e.openNotificationDialog)})}},{key:"componentWillUnmount",value:function(){var e=this,t=window.document.getElementsByClassName($.d);Array.prototype.forEach.call(t,function(t){t.removeEventListener("click",e.openNotificationDialog)})}},{key:"removeRestrictions",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.intl,i=this.state,n=i.isNotificationOpen,o=i.pageName;return this.placeholderEl?a.a.createElement(j.b.Consumer,null,function(i){var s=i.location,c=(0,i.matchRoute)(s.pathname+s.search);return c&&c.name==H.SPACE_RESTRICTED_PAGES.name?r.a.createPortal(a.a.createElement(te,{isOpen:n,cancelAction:{text:t.formatMessage(ie.a.cancelButton),onClick:e.closeNotificationDialog},applyAction:{text:t.formatMessage(ie.a.removeRestrictionButton),onClick:e.removeRestrictions},heading:t.formatMessage(ie.a.removeRestrictionTitle)},a.a.createElement(x.a,Y()({},ie.a.removeRestrictionText,{values:{pageName:o}}))),e.placeholderEl):null}):null}}]),t}(o.PureComponent);ne.displayName="ChangeEditionPageRestrictionsLegacyCoordinatorComponent";var oe=Object(x.g)(ne),ae=function(){return a.a.createElement(o.Fragment,null,a.a.createElement(U,null),a.a.createElement(oe,null))};ae.displayName="ChangeEditionLegacyCoordinator";var se=i("vplL"),re=i("c09o"),ce=i("OjRD"),le=i("9Ivk"),de=i("uh42"),ue=i("HEM+"),me=i("/FQd"),he=i("lPJD"),ge=i("qdfj"),fe=i("cphC"),pe=i("r9hL"),ve=i("d3tz"),ye=i("gHio"),Ce=i.n(ye),Me=i("7A9o");function be(){var e=Q()(["\n  flex: 0 0 auto;\n  appearance: none;\n  background: none;\n  border: none;\n  color: ",";\n  cursor: pointer;\n\n  &:focus {\n    outline: none;\n  }\n"]);return be=function(){return e},e}function Ee(){var e=Q()(["\n  flex-grow: 1;\n  color: ",";\n  text-align: center;\n"]);return Ee=function(){return e},e}function we(){var e=Q()(["\n  display: flex;\n  background-color: ",";\n  border-radius: 5px;\n  align-items: center;\n  overflow: hidden;\n  height: ","px;\n  transition: height 0.25s linear;\n"]);return we=function(){return e},e}var Ie,ke=B.default.div(we(),Me.colors.P300,function(e){return e.isOpen?50:0}),Ne=B.default.p(Ee(),"white"),Te=B.default.button(be(),"white"),De=function(e){function t(){var e,i;h()(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=v()(this,(e=C()(t)).call.apply(e,[this].concat(o))),k()(b()(i),"onDismiss",function(e){var t=i.props.onDismiss;e.stopPropagation(),e.preventDefault(),t()}),i}return w()(t,e),f()(t,[{key:"render",value:function(){var e=this.props.isOpen;return a.a.createElement(ke,{isOpen:e},a.a.createElement(Ne,null,a.a.createElement(x.a,{id:"changeboarding.dnd.pagetree.spacesettings.banner"})),a.a.createElement(Te,{onClick:this.onDismiss},a.a.createElement(Ce.a,null)))}}]),t}(o.Component);De.displayName="ReorderPagesBannerComponent";var Ae,xe=Object(pe.b)(ve.a.CHANGEBOARDING)(Ie=function(e){function t(){var e,i;h()(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=v()(this,(e=C()(t)).call.apply(e,[this].concat(o))),k()(b()(i),"state",{isOpen:!1}),k()(b()(i),"onDismiss",function(){var e=i.props,t=e.triggerAnalytics,n=e.stop;i.setState({isOpen:!1}),t("reorderpages-banner-dismissed"),n()}),i}return w()(t,e),f()(t,[{key:"componentWillMount",value:function(){this.el=l.a.document.getElementById("reorderpages-changeboarding-react-portal-placeholder")}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState({isOpen:!0})},200)}},{key:"render",value:function(){var e=this.state.isOpen;return this.el?r.a.createPortal(a.a.createElement(De,{isOpen:e,onDismiss:this.onDismiss}),this.el):null}}]),t}(o.Component))||Ie,Se=Object(fe.a)(Ae=Object(ge.a)(Ae=function(e){function t(){var e,i;h()(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=v()(this,(e=C()(t)).call.apply(e,[this].concat(o))),k()(b()(i),"shouldShowSpaceSettingChangeboarding",function(){return i.isOnReorderPages()}),k()(b()(i),"isOnReorderPages",function(){var e=i.props,t=e.matchRoute,n=e.location,o=t(n.pathname+n.search);return o&&o.name===H.SPACE_SETTINGS_REORDERPAGES.name}),i}return w()(t,e),f()(t,[{key:"render",value:function(){var e=this.props.coordinationClient;return this.shouldShowSpaceSettingChangeboarding()?a.a.createElement(he.a,{client:e,messageId:"confluence-dragdrop-spacesettings-banner"},a.a.createElement(xe,null)):null}}]),t}(o.Component))||Ae)||Ae,Re=function(e){function t(){return h()(this,t),v()(this,C()(t).apply(this,arguments))}return w()(t,e),f()(t,[{key:"render",value:function(){return a.a.createElement(me.a,null,function(e){var t=e.featureFlags;return a.a.createElement(Se,{featureFlags:t})})}}]),t}(o.Component);Re.displayName="DragDropChangeboarding";var Pe=function(e){function t(){var e,i;h()(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=v()(this,(e=C()(t)).call.apply(e,[this].concat(o))),k()(b()(i),"state",{messages:null}),i}return w()(t,e),f()(t,[{key:"getChildContext",value:function(){return{insertCss:this.props.context.insertCss||function(){}}}},{key:"componentDidMount",value:function(){var e=this,t=this.props.locale;Promise.all([Object(se.a)(t),function(e){return new Promise(function(t){Object(re.a)(e,t)})}(t)]).then(function(t){var i=u()(t,1)[0];e.setState({messages:i})})}},{key:"render",value:function(){var e=this.state.messages;if(!e)return null;var t=this.props,i=t.store,n=t.locale;return a.a.createElement(S.b,null,a.a.createElement(A.b,{client:Object(O.a)()},a.a.createElement(D.Provider,{store:i},a.a.createElement(x.d,{locale:n,messages:e},a.a.createElement(L.a,null,a.a.createElement(ue.a,{locale:n},a.a.createElement(R.ConnectedRouter,{history:de.a},a.a.createElement(o.Fragment,null,a.a.createElement(z.a,null),a.a.createElement(P.a,null),a.a.createElement(j.a,{namedRoutes:H},a.a.createElement(le.a,null,this.props.children,a.a.createElement(ce.b,null),a.a.createElement(Re,null)),a.a.createElement(ae,null))))))))))}}]),t}(o.Component);k()(Pe,"childContextTypes",{insertCss:T.a.func.isRequired}),Pe.displayName="ComponentWrapper";var Oe=i("AeT/"),Le=Object(Oe.a)({isServerRenderedPage:!0});i.e(514).then(i.bind(null,"Al9w")).then(function(e){e.subscribe(Le)});var je={insertCss:function(e){return e._insertCss()}};t.a=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"string"==typeof t&&(t=l.a.document.getElementById(t)),r.a.render(a.a.createElement(Pe,{store:Le,context:je,locale:l.a.__INITIAL_STATE__.i18n.locale,renderAsRoot:i},e),t)}},OjRD:function(e,t,i){"use strict";var n=i("i66J"),o=i("frB3"),a=i("tQaH"),s=i.n(a),r=i("VrFO"),c=i.n(r),l=i("Y9Ll"),d=i.n(l),u=i("N+ot"),m=i.n(u),h=i("AuHH"),g=i.n(h),f=i("5Yy7"),p=i.n(f),v=(i("aWzz"),i("ERkP")),y=i.n(v),C=function(e){function t(){return c()(this,t),m()(this,g()(t).apply(this,arguments))}return p()(t,e),d()(t,[{key:"render",value:function(){var e=this.props,t=e.children,i=e.eventHandlers;return Object(v.cloneElement)(t,s()({},i))}}]),t}(v.Component);C.displayName="Hover",C.defaultProps={eventHandlers:{}},C.displayName="Hover";var M,b=i("97Jx"),E=i.n(b),w=i("1Pcy"),I=i.n(w),k=i("uDfI"),N=(i("0iyY"),i("w0mW")),T=i.n(N),D={HOVER:"hover",NONE:"none"},A=Object(k.connect)()(M=function(e){function t(){var e;return c()(this,t),(e=m()(this,g()(t).call(this)))._refCallback=e._refCallback.bind(I()(e)),e.onMouseEnter=e.onMouseEnter.bind(I()(e)),e.onMouseLeave=e.onMouseLeave.bind(I()(e)),e.onComponentToShowMouseEnter=e.onComponentToShowMouseEnter.bind(I()(e)),e.onComponentToShowMouseLeave=e.onComponentToShowMouseLeave.bind(I()(e)),e.hoverId=T()("hover_"),e}return p()(t,e),d()(t,[{key:"componentDidMount",value:function(){this.props.open&&this._showHoverAfterDelay()}},{key:"componentDidUpdate",value:function(e){var t=this.props.open;e.open!==t&&(t?this._showHoverAfterDelay():this._hideHoverAfterDelay())}},{key:"componentWillUnmount",value:function(){this._hideHover()}},{key:"onMouseLeave",value:function(){this.props.shouldHide&&(this.isHoveringTarget=!1,this.toggleHover())}},{key:"onMouseEnter",value:function(){this.isHoveringTarget=!0,this.toggleHover()}},{key:"onComponentToShowMouseEnter",value:function(){this.isHoveringComponentToShow=!0,this.toggleHover()}},{key:"onComponentToShowMouseLeave",value:function(){this.props.shouldHide&&(this.isHoveringComponentToShow=!1,this.toggleHover())}},{key:"_showHoverAfterDelay",value:function(){var e=this;this.showTimer=setTimeout(function(){e._showHover()},this.props.delayShow)}},{key:"_showHover",value:function(){this.isShowing=!0;var e=this.props,t=e.gravity,i=e.componentToShow,o=e.dispatch,a=e.gap,s=e.zIndex,r=e.fixed,c=e.shouldPersistOnScrollAndResize;this._hoverTarget&&o(Object(n.b)({hoverId:this.hoverId,gravity:t,componentToShow:Object(v.cloneElement)(i,{onMouseEnter:this.onComponentToShowMouseEnter,onMouseLeave:this.onComponentToShowMouseLeave}),gap:a,target:this._hoverTarget,zIndex:s,fixed:r,shouldPersistOnScrollAndResize:c}))}},{key:"_hideHoverAfterDelay",value:function(){var e=this;this.hideTimer=setTimeout(function(){e._hideHover()},this.props.delayHide)}},{key:"_hideHover",value:function(){this.isShowing=!1,(0,this.props.dispatch)(Object(n.a)({hoverId:this.hoverId}))}},{key:"_clearTimers",value:function(){clearTimeout(this.hideTimer),clearTimeout(this.showTimer)}},{key:"isHovering",value:function(){return this.isHoveringTarget||this.isHoveringComponentToShow}},{key:"toggleHover",value:function(){var e=this.isHovering();this._clearTimers(),this.isShowing&&!e?this._hideHoverAfterDelay():!this.isShowing&&e&&this._showHoverAfterDelay()}},{key:"_getEventHandlers",value:function(e){switch(e){case D.HOVER:return{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave};case D.NONE:return{}}}},{key:"_refCallback",value:function(e){this._hoverTarget=e}},{key:"render",value:function(){var e=this.props,t=e.children,i=e.showOn,n=e.className,o=e.style,a=this._getEventHandlers(i),s={className:n,style:o};return y.a.createElement(C,{eventHandlers:a},y.a.createElement(this.props.tagName,E()({ref:this._refCallback},s),t))}}]),t}(v.Component))||M;A.defaultProps={delayHide:150,delayShow:200,gravity:"n",gap:0,showOn:D.HOVER,open:!1,tagName:"div",shouldHide:!0,shouldPersistOnScrollAndResize:!1},A.displayName="ReduxHover";var x=i("TgF9");i.d(t,"b",function(){return o.a}),i.d(t,"a",function(){return C}),i.d(t,"c",function(){return A}),i.d(t,!1,function(){}),i.d(t,!1,function(){return x.a}),i.d(t,!1,function(){})},WnYe:function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return o}),i.d(t,"d",function(){return a}),i.d(t,"c",function(){return s});var n={CONTENT:"https://confluence.atlassian.com/x/2wgzKw",SPACE:"https://confluence.atlassian.com/x/WAgzKw",SPACE_CONTENT:"https://confluence.atlassian.com/x/2wgzKw",ADMIN_SPACE:"https://confluence.atlassian.com/x/WggzKw",ADMIN_GLOBAL:"https://confluence.atlassian.com/x/MAszKw"},o="confluence-change-edition-section-message",a="confluence-change-edition-remove-restrictions-button",s="confluence-change-edition-notification-dialog"},cphC:function(e,t,i){"use strict";i.d(t,"a",function(){return I});var n=i("97Jx"),o=i.n(n),a=i("VrFO"),s=i.n(a),r=i("Y9Ll"),c=i.n(r),l=i("N+ot"),d=i.n(l),u=i("AuHH"),m=i.n(u),h=i("1Pcy"),g=i.n(h),f=i("5Yy7"),p=i.n(f),v=i("KEM+"),y=i.n(v),C=i("ERkP"),M=i.n(C),b=i("C+A9"),E=i("/FQd"),w=function(){};function I(e){var t,i;return i=t=function(t){function i(){var e,t;s()(this,i);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=d()(this,(e=m()(i)).call.apply(e,[this].concat(o))),y()(g()(t),"isEngagementDisabledForTests",Boolean(window.sessionStorage.getItem("confluence.disable-engagement-for-tests"))),t}return p()(i,t),c()(i,[{key:"render",value:function(){var t=this;return M.a.createElement(E.a,null,function(i){var n=i.cloudId,a=t.isEngagementDisabledForTests?{start:w,stop:w}:new b.a(n,"/gateway/api");return M.a.createElement(e,o()({},t.props,{coordinationClient:a}))})}}]),i}(C.Component),y()(t,"displayName","withCoordinationClient(".concat(e.displayName||e.name,")")),i}},dSSn:function(e,t,i){"use strict";var n=i("VrFO"),o=i.n(n),a=i("Y9Ll"),s=i.n(a),r=i("N+ot"),c=i.n(r),l=i("AuHH"),d=i.n(l),u=i("5Yy7"),m=i.n(u),h=i("KEM+"),g=i.n(h),f=i("7wq/"),p=i.n(f),v=i("ERkP"),y=i.n(v),C=(i("aWzz"),i("KsTJ")),M=i("L21V"),b=i("kFJ8"),E=i("2srY"),w=i.n(E),I=i("llcG"),k=i("XMEu"),N=i("wRb9"),T=i.n(N),D=i("WnYe"),A=i("mTU2"),x={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ChangeEditionSectionMessage"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenant"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"editions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edition"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:103,source:{body:"\n  query ChangeEditionSectionMessage {\n    tenant {\n      editions {\n        edition\n      }\n    }\n  }\n",name:"GraphQL request",locationOffset:{line:1,column:1}}}};function S(){var e=p()(["\n  width: 59px;\n"]);return S=function(){return e},e}function R(){var e=p()(["\n  margin: 7px 16px 0;\n"]);return R=function(){return e},e}function P(){var e=p()(["\n  margin-top: 16px;\n"]);return P=function(){return e},e}function O(){var e=p()(["\n  display: flex;\n  flex-grow: 1;\n  flex-direction: column;\n"]);return O=function(){return e},e}function L(){var e=p()(["\n  padding: 16px;\n  border-radius: 3px;\n  box-shadow: 0 0 1px rgba(9, 30, 66, 0.31),\n    0 2px 4px -1px rgba(9, 30, 66, 0.25);\n  display: flex;\n"]);return L=function(){return e},e}i.d(t,"a",function(){return V});var j=C.default.div(L()),H=C.default.div(O()),z=C.default.div(P()),_=C.default.div(R()),$=C.default.img(S()),V=function(e){function t(){return o()(this,t),c()(this,d()(t).apply(this,arguments))}return m()(t,e),s()(t,[{key:"renderSectionMessage",value:function(){var e,t=this.props,i=t.context,n=t.grandfathered,o=t.canClear;switch(i){case"CONTENT":e=A.a.contentGrandfatheredText;break;case"SPACE":e=n?o?A.a.spacePermissionsGrandfatheredText:A.a.spacePermissionsGrandfatheredNoclearText:A.a.spacePermissionsFreeText;break;case"SPACE_CONTENT":e=A.a.spaceRestrictedPagesText;break;case"ADMIN_SPACE":e=A.a.adminSpaceText;break;case"ADMIN_GLOBAL":e=A.a.adminGlobalText}return y.a.createElement(M.b,e)}},{key:"renderLinkButton",value:function(){var e,t=this.props,i=t.context,n=t.grandfathered,o=t.canClear;return e="CONTENT"===i?A.a.removeThisRestrictionButton:"SPACE"===i&&n&&o?A.a.grantAllButton:A.a.learnMoreButton,y.a.createElement(I.a,{appearance:"link",href:D.b[i]},y.a.createElement(M.b,e))}},{key:"render",value:function(){var e=this;return y.a.createElement(b.d,{query:x},function(t){var i=t.data,n=t.loading,o=t.error;return n||o?null:"FREE"!==w()(i,"tenant.editions.edition")?null:y.a.createElement(j,{className:e.props.className},y.a.createElement(H,null,e.renderSectionMessage(),y.a.createElement(z,null,y.a.createElement(k.a,null,y.a.createElement(I.a,{target:"_blank",appearance:"primary",href:"/admin/billing/applications/change-edition/confluence"},y.a.createElement(M.b,A.a.tryItNowButton)),e.renderLinkButton()))),y.a.createElement(_,null,y.a.createElement($,{src:T.a})))})}}]),t}(v.Component);g()(V,"defaultProps",{context:"CONTENT",grandfathered:!1,canClear:!0}),V.displayName="ChangeEditionSectionMessage"},i8tr:function(e,t,i){"use strict";i.r(t);var n=i("xeH2"),o=i.n(n),a=i("HvGa"),s=i.n(a),r=i("jqY8"),c=i("Jygk"),l=i.n(c),d=i("+frj"),u=i.n(d),m=i("UYEP"),h=i.n(m),g=new(h.a.View.extend({initialize:function(){this.setPageContentElByCSSSelector("#content"),this.pageHeader=null},destroy:function(){this.el&&(this.el.style.minHeight="",this.el.classList.remove("ic-shrink-to-show-sidebar")),this.pageHeader&&this.pageHeader.classList.remove("ic-shrink-to-show-sidebar")},setPageContentElByCSSSelector:function(e){var t=!1;if(e){var i=l.a.document.querySelector(e);i?this.setElement(i):t=!0}else t=!0;if(t){var n=l.a.document.querySelector("#content");this.setElement(n)}},setPageHeaderElByCSSSelector:function(e){this.pageHeader=e?l.a.document.querySelector(e):null},shrinkToShowSideBar:function(){this.el.classList.add("ic-shrink-to-show-sidebar"),this.pageHeader&&this.pageHeader.classList.add("ic-shrink-to-show-sidebar")},updateMinHeight:function(e){var t=e-this.$el.offset().top,i=parseInt(this.el.style.minHeight,10);(t>i||isNaN(i))&&(this.el.style.minHeight="".concat(t,"px"))}})),f=l.a.top,p={INLINE_COMMENTS:s.a.DarkFeatures.isEnabled("confluence-inline-comments"),RESOLVED_INLINE_COMMENTS_V2:s.a.DarkFeatures.isEnabled("frontend.resolved-inline-comments-dialog.v2"),RESOLVED_INLINE_COMMENTS:s.a.DarkFeatures.isEnabled("confluence-inline-comments-resolved"),RICH_TEXT_EDITOR:s.a.DarkFeatures.isEnabled("confluence-inline-comments-rich-editor"),DANGLING_COMMENT:s.a.DarkFeatures.isEnabled("confluence-inline-comments-dangling-comment"),LIKES_ADMIN_TOGGLE:s.a.DarkFeatures.isEnabled("optional-likes-CONFDEV-53297")},v=["dateautocomplete","confluencemacrobrowser","propertypanel","jiraconnector","dfe"],y=["autoresize","confluenceleavecomment"],C=["code"];function M(e,t,i,n,o){null!=t&&(t.isResolved()?p.RESOLVED_INLINE_COMMENTS_V2||new i({collection:e,focusCommentId:t.get("id"),formatMessage:o}).render():t.isDangling()||h.a.trigger("ic:view",t,"permalink",{isReplyComment:n}))}function b(){return s.a.Meta.get("user-display-name")||s.a.Meta.get("current-user-fullname")}function E(){return s.a.Meta.get("atlassian-account-id")}function w(e){if("number"==typeof e.selectionStart){var t=e.value.length;e.selectionStart=t,e.selectionEnd=t}else if(null!=typeof e.createTextRange){e.focus();var i=e.createTextRange();i.collapse(!1),i.select()}}function I(e){var t=o()(e).closest("a");return t.length||(t=o()(e).find("a")),t}function k(){return!!o()(".ic-sidebar #wysiwygTextarea_ifr").length}function N(e,t,i){i=i||1,e=e||o()(f).scrollTop();var n=o.a.Deferred(),a={duration:100,step:function(e){o()(f).scrollTop(e)},complete:function(){setTimeout(n.resolve,i)}};return o()({scrollTop:e}).animate({scrollTop:t},a),n.promise()}function T(){var e=l.a.frameElement&&l.a.frameElement.getAttribute("name"),t=l.a.frameElement&&"true"===l.a.frameElement.getAttribute("data-is-fallback-mode-iframe");return l.a.top!==l.a.self&&e&&"fallback-mode-iframe"===e||t}var D={overlappedSelection:function(e,t){if(e&&t){var i=o()(e.containingElement);if(i.is(".inline-comment-marker.valid")||(i=o()("<div/>").append(e.html).find(".inline-comment-marker.valid")),i.length>0&&function(e){return e.filter(function(){return o()(this).text().length>0}).length>0}(i)){var n=i.first().data("ref");return t.findWhere({markerRef:n})}}},focusedCommentUrl:function(e){return"".concat(s.a.contextPath(),"/pages/viewpage.action?pageId=").concat(s.a.Meta.get("latest-page-id"),"&focusedCommentId=").concat(e,"#comment-").concat(e)},showFocusedComment:function(e,t,i,n){var a=t.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null!=a){var r="replyToComment"===a[1],c=parseInt(a[2],10);if(e.findWhere){var l=e.findWhere({id:c});null!=l?M(e,l,i,r,n):o.a.ajax({url:"".concat(s.a.contextPath(),"/rest/inlinecomments/1.0/comments/replies/").concat(c,"/commentId")}).done(function(t){l=e.findWhere({id:t}),M(e,l,i,r,n)})}}},getAuthorAvatarUrl:function(){return s.a.Meta.get("current-user-avatar-url")?s.a.contextPath()+s.a.Meta.get("current-user-avatar-url"):"".concat(s.a.Meta.get("static-resource-url-prefix"),"/images/icons/profilepics/anonymous.png")},moveCaretToEnd:function(e){w(e),l.a.setTimeout(function(){w(e)},1)},animateSidebar:function(e,t){var i="webkitAnimationEnd oanimationend msAnimationEnd animationend",n=e.$wikiContent,a=o.a.Deferred();if(t){var s=o()(".inline-comment-marker.active");n.addClass("ic-fade-in-animation"),n.one(i,function(){o()(this).removeClass("ic-fade-in-animation")}),e.$el.addClass("ic-slide-in"),e.$el.one(i,function(){o()(this).removeClass("ic-slide-in"),s.addClass("ic-highlight-pulse"),s.one(i,function(){s.removeClass("ic-highlight-pulse")})}),a.resolve()}else n.bind(i,function(t){"ic-fade-out-animation"==t.originalEvent.animationName?(e.$wikiContent.removeClass("ic-fade-out-animation"),e.$wikiContent.css("opacity","0.5")):"ic-fade-in-animation"==t.originalEvent.animationName&&(e.$wikiContent.css("opacity","1"),e.$wikiContent.removeClass("ic-fade-in-animation"),e.$wikiContent.unbind(i))}),n.addClass("ic-fade-out-animation"),e.$el.addClass("ic-slide-out"),e.$el.on(i,function t(){e.$el.removeClass("ic-slide-out"),e._emptySidebar(),g.destroy(),n.addClass("ic-fade-in-animation"),n.css("position","static"),a.resolve(),e.$el.off(i,t)});return a.promise()},getDarkFeatures:function(){return u.a.clone(p)},getInlineLinks:I,removeInlineLinksDialog:function(e){e.each(function(){var e=I(this);e.length&&e.off("mousemove")})},isAnimationSupported:function(){return void 0!==document.body.style.animation||void 0!==document.body.style.webkitAnimation},showHighlightContent:function(e){e.parents(".expand-content.expand-hidden").each(function(){o()(this).siblings(".expand-control").click()})},getUnsupportedRtePlugins:function(){return u.a.clone(v)},getSupportedRtePlugins:function(){return u.a.clone(y)},confirmProcess:function(e,t){var i=s.a.Rte&&s.a.Rte.getEditor&&s.a.Rte.getEditor();if(!0===t){if(k()&&i&&i.isDirty())return confirm(e({id:"inline.comments.editor.lost"}))}else if(i&&i.isDirty()&&l.a.Confluence.Editor&&!l.a.Confluence.Editor.getContentType)return confirm(e({id:"inline.comments.editor.lost"}));return!0},getAuthorDisplayName:b,isKeyboardShortcutsEnable:function(){return s.a.Meta.get("use-keyboard-shortcuts")&&l.a.Confluence.KeyboardShortcuts&&l.a.Confluence.KeyboardShortcuts.enabled},addSidebarHeadingTooltip:function(e){e.$("button.ic-action-hide").tooltip({gravity:"se"}),e.$("#ic-nav-next").tooltip({gravity:"s"}),e.$("#ic-nav-previous").tooltip({gravity:"s"})},hasEditorInSidebar:k,recalculateContentHeight:function(e){var t=e.height(),i=e.offset().top+t;g.updateMinHeight(i)},resizeContentAfterLoadingImages:function(e){e=e.closest(".ic-display-comment-view");var t=this,i=o()(".confluence-embedded-image, .confluence-embedded-file img",e),n=i.length,a=0;n>0&&i.off("load").one("load",function(){++a===n&&t.recalculateContentHeight(e)}).each(function(){this.complete&&o()(this).load()})},scrollToCommentAfterToggleSideBar:function(e,t,i){var n=function(){var i=t&&t.is(":visible");if(e&&i){var n=t.offset().top-e;o()(f).scrollTop(n)}};(i=void 0!==i?i:T())?setTimeout(n,1):n()},getEditorFormat:function(e){var t=o.a.Deferred();return o.a.ajax({url:"".concat(s.a.contextPath(),"/rest/api/content/").concat(e,"?expand=body.editor"),type:"GET",dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(e){var i=e.body.editor.value;t.resolve(i)}).fail(function(e,i,n){t.reject(e,i,n)}),t.promise()},containUnsupportedMacro:function(e){var t=e.closest(".conf-macro");return!1===t.data("hasbody")||e.find('.conf-macro[data-hasbody="false"]').length>0||-1!=C.indexOf(t.data("macro-name"))},containInternalLink:function(e){return e.closest(".user-mention").length>0||e.find(".user-mention").length>0},containUserMetion:function(e){return e.closest("a[href^='/']:not('.user-mention')").length>0||e.find("a[href^='/']:not('.user-mention')").length>0},getCurrentUserInfo:function(){var e={isDefault:!0,path:"".concat(s.a.Meta.get("static-resource-url-prefix"),"/images/icons/profilepics/default.png")};return"/images/icons/profilepics/default.png"!==s.a.Meta.get("current-user-avatar-url")&&(e={isDefault:!1,path:s.a.contextPath()+s.a.Meta.get("current-user-avatar-url")}),{accountId:s.a.Meta.get("atlassian-account-id"),displayName:s.a.Meta.get("current-user-fullname"),profilePicture:e}},getOffsetTopRelativeInWindowCoordinate:function(e){return e.offset().top-o()(f).scrollTop()},scrollToActiveHighlight:function(e,t){var i=o()(f).scrollTop();return N(i,i+e-t)},scrollToTop:function(){return N(null,0,100)},sendMessageToParent:function(e){e.bridgeId="".concat(function(){return l.a.frameElement&&l.a.frameElement.getAttribute("data-bridge-id")}()),l.a.parent.postMessage(e,l.a.location.origin)},isFallbackModeIframe:T,isSPAPage:function(){return o()("#confluence-ui").length>0},getPageContentClassName:function(){return"view-page-body"},getAuthorAccountId:E,getCurrentUserData:function(){var e=null,t=null;function i(t){var i=((t||{}).data||{}).user||{},n=(i.photos||[]).find(function(e){return e.isPrimary});return e={authorAccountId:i.id,authorDisplayName:i.displayName,authorAvatarUrl:(n||{}).value}}function n(){return e={authorAccountId:E(),authorDisplayName:b(),authorAvatarUrl:s.a.contextPath()+s.a.Meta.get("current-user-avatar-url")}}return function(){return e?Promise.resolve(e):(t||(t=fetch("/cgraphql?q=InlineCommentCurrentUserData",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n          query {\n            user(current: true) {\n              id\n              displayName\n              photos {\n                value\n                isPrimary\n              }\n            }\n          }\n        ",variables:null})}).then(function(e){return e.json()}).then(i).catch(n)),t)}}()},A=h.a.Model.extend({defaults:{authorDisplayName:D.getAuthorDisplayName(),authorAccountId:s.a.Meta.get("atlassian-account-id"),authorAvatarUrl:s.a.contextPath()+s.a.Meta.get("current-user-avatar-url"),body:"",commentId:"0",hasDeletePermission:!0,hasEditPermission:Boolean(s.a.Meta.get("atlassian-account-id"))},urlRoot:function(){return"".concat(s.a.contextPath(),"/rest/inlinecomments/1.0/comments/").concat(this.get("commentId"),"/replies")},sync:function(e,t,i){return i=i||{},"create"===e&&(i.url="".concat(this.urlRoot(),"?containerId=").concat(s.a.Meta.get("latest-page-id"))),h.a.sync.call(this,e,t,i)},validate:function(){if(!this.get("body"))return!0}}),x=h.a.Collection.extend({model:A}),S=h.a.Model.extend({defaults:{authorDisplayName:D.getAuthorDisplayName(),authorAvatarUrl:s.a.contextPath()+s.a.Meta.get("current-user-avatar-url"),body:"",originalSelection:"",parentCommentId:"0",lastFetchTime:o()("meta[name=confluence-request-time]").attr("content"),hasDeletePermission:!0,hasEditPermission:!0,hasResolvePermission:!0,resolveProperties:{resolved:!1,resolvedTime:0},serializedHighlights:"",deleted:!1},urlRoot:"".concat(s.a.contextPath(),"/rest/inlinecomments/1.0/comments"),initialize:function(e){e=e||{},this._setHighlights(e.markerRef);var t=this;this.replies=new x,this.replies.url=function(){return"".concat(t.url(),"/replies")},this.set({containerId:s.a.Meta.get("latest-page-id")},{silent:!0}),this.set({containerType:s.a.Meta.get("content-type")},{silent:!0}),D.getDarkFeatures().DANGLING_COMMENT&&s.a.Meta.get("page-id")===s.a.Meta.get("latest-page-id")&&this.isDangling()&&!this.isResolved()&&this.resolve(!0,{wait:!0,dangling:!0,success:u.a.bind(function(){h.a.trigger("ic:open:dangled",this)},this),error:u.a.bind(function(){h.a.trigger("ic:resolve:dangled:failed",this)},this)})},validate:function(){if(!this.get("body"))return!0},resolve:function(e,t){t=t||{},this.save({},u.a.extend(t,{url:"".concat(this.urlRoot,"/").concat(this.get("id"),"/resolve/").concat(e,"/dangling/").concat(!0===t.dangling)}))},isResolved:function(){return this.get("resolveProperties").resolved},isDangling:function(){return void 0===this.highlight},isDeleted:function(){return this.get("deleted")},_setHighlights:function(e){var t;0!==(t=void 0!==e?o()("[data-inline-comments-target=true]:first").find('.inline-comment-marker[data-ref="'.concat(e,'"],')+'span[data-mark-type=confluenceInlineComment][data-reference="'.concat(e,'"],')+'span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="'.concat(e,'"]')):o()(".ic-current-selection")).length?(this.highlights=t,this.highlight=t.first()):(this.highlights=void 0,this.highlight=void 0)},destroy:function(e){var t=this,i=(e=e?u.a.clone(e):{}).success;return e.success=function(n){i&&i(t,n,e)},function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}}(this,e),this.sync("delete",this,e)}}),R=h.a.Collection.extend({model:S,initialize:function(){this.listenTo(this,"sort",this._removeCachedMarkers)},url:function(){var e=s.a.contextPath(),t=s.a.Meta.get("page-id");return"".concat(e,"/rest/inlinecomments/1.0/comments?")+"containerId=".concat(t)},getResolvedCount:function(){return this.getResolvedComments().length},getUnresolveCount:function(){return this.reject(function(e){return!0===e.isResolved()&&!1===e.isDeleted()}).length},getResolvedComments:function(){return this.filter(function(e){return!0===e.isResolved()&&!1===e.isDeleted()})},getResolvedCommentsDesc:function(){return u.a.sortBy(this.getResolvedComments(),function(e){return 0-e.get("resolveProperties").resolvedTime})},getNextCommentOnPage:function(){return this._getCommentAtRelativeOffset(1)},getPrevCommentOnPage:function(){return this._getCommentAtRelativeOffset(-1)},_getCommentAtRelativeOffset:function(e){var t=this.getCommentsOnPage(),i=this.findWhere({active:!0});if(void 0===i||t.length<=1)return null;var n=u.a.pluck(t,"id");return t[(u.a.indexOf(n,i.get("id"))+e+t.length)%t.length]},getCommentsOnPage:function(){return this.filter(function(e){return!1===e.isResolved()&&!e.isDangling()&&!1===e.isDeleted()||!0===e.get("active")})},getCommentsOnPageCount:function(){return this.getCommentsOnPage().length},getActiveIndexWithinPageComments:function(){var e=u.a.pluck(this.getCommentsOnPage(),"id"),t=this.findWhere({active:!0});if(void 0===t)return null;var i=t.get("id");return u.a.indexOf(e,i)},comparator:function(e,t){return void 0===this.markers&&(this.markers=o()("[data-inline-comments-target=true]:first").find(".inline-comment-marker")),void 0===e.highlight?1:void 0===t.highlight?-1:this.markers.index(e.highlight)-this.markers.index(t.highlight)},_removeCachedMarkers:function(){this.markers=void 0}}),P={};u.a.extend(P,h.a.Events),P.start=function(){!0!==this.running&&(this.running=!0,this.send=function(e,t){s.a.trigger("analytics",{name:e,data:t})},this.listenTo(h.a,"ic:highlight-panel-click",function(){this.send("confluence.highlight.actions.comment.inline")}),this.listenTo(h.a,"ic:view",function(e,t){this.send("confluence.comment.inline.view"),"nav"===t&&this.send("confluence.comment.inline.view.nav"),"permalink"===t&&this.send("confluence.comment.inline.view.permalink")}),this.listenTo(h.a,"ic:overlap",function(){this.send("confluence.comment.inline.overlap")}),this.listenTo(h.a,"ic:edit",function(){this.send("confluence.comment.inline.edit")}),this.listenTo(h.a,"ic:persist",function(){this.send("confluence.comment.inline.create")}),this.listenTo(h.a,"ic:sidebar:close",function(){this.send("confluence.comment.inline.sidebar.close")}),this.listenTo(h.a,"ic:reply:persist",function(){this.send("confluence.comment.inline.reply")}),this.listenTo(h.a,"ic:delete ic:reply:delete",function(){this.send("confluence.comment.inline.delete")}),this.listenTo(h.a,"ic:resolved",function(){this.send("confluence.comment.inline.resolved")}),this.listenTo(h.a,"ic:unresolved",function(){this.send("confluence.comment.inline.unresolved")}),this.listenTo(h.a,"ic:resolved:view",function(e){var t={total:e};this.send("confluence.comment.inline.resolved.view",t)}),this.listenTo(h.a,"ic:resolved:dismiss:recovery",function(){this.send("confluence.comment.inline.resolved.dismiss")}),this.listenTo(h.a,"ic:resolved:show:recovery",function(){this.send("confluence.comment.inline.resolved.discovery")}),this.listenTo(h.a,"ic:open:dangled",function(e){var t={commentId:e.get("id"),pageId:s.a.Meta.get("page-id")};this.send("confluence.comment.inline.open.dangled",t)}),this.listenTo(h.a,"ic:editor:load:fail",function(){var e={pageId:s.a.Meta.get("page-id")};this.send("confluence.comment.inline.editor.load.fail",e)}),this.listenTo(h.a,"ic:resolve:dangled:failed",function(e){var t={commentId:e.get("id"),pageId:s.a.Meta.get("page-id")};this.send("confluence.comment.inline.resolved.dangled.failed",t)}))},P.stop=function(){this.running=!1,this.stopListening()};var O=P,L=(i("wS3D"),"ic-current-selection");function j(){o.a.textHighlighter.createWrapper=function(e){return o()("<span></span>").addClass(e.highlightedClass)},this.$el=o()("[data-inline-comments-target=true]").first(),this.$el.length>0&&this.$el.textHighlighter({highlightedClass:L})}j.prototype.highlight=function(e){if(0!==this.$el.length){var t=o()(this.$el.getHighlighter().doHighlight(e));return this.$el.getHighlighter().serializeHighlights(t)}},j.prototype.removeHighlight=function(){if(0!==this.$el.length)return this.$el.getHighlighter().removeHighlights(),this},j.prototype.deserializeHighlights=function(e,t){if(0!==this.$el.length){var i='<span class="inline-comment-marker" data-ref="'.concat(t,'"></span>');return this.$el.getHighlighter().deserializeHighlights(e,i)}};var H=j;function z(e,t){return'<div class="ic-sidebar-heading"><div id="ic-nav-container">'.concat(1==e.createComment?U({disabled:!0,showIndex:!1},t):"",'</div><div class="ic-right-toolbar">').concat(e.showMenu?function(e,t){return"".concat(e.darkFeatures.INLINE_COMMENTS&&(e.hasDeletePermission||e.hasReplyPermission||e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS)?l.a.aui.buttons.button({type:"subtle",extraClasses:"aui-button-compact aui-dropdown2-trigger-arrowless aui-style-default ic-action-menu",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-more",text:"",dropdown2Target:"ic-menu-items"})+l.a.aui.dropdown2.contents({id:"ic-menu-items",extraClasses:"aui-style-default",content:'<ul class="aui-list-truncate">'.concat(e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?'<li class="ic-action-resolve"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolve"})),"</a></li>"):"").concat(e.hasReplyPermission?'<li class="ic-action-reply"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.reply"})),"</a></li>"):"").concat(e.hasEditPermission?'<li class="ic-action-edit"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.edit"})),"</a></li>"):"").concat(e.hasDeletePermission?'<li class="ic-action-delete"><a href="#">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.delete"})),"</a></li>"):"","</ul>")}):"")}(e,t):"").concat(l.a.aui.buttons.button({type:"text",extraClasses:"aui-button-text ic-action-hide",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-close-dialog",text:"",extraAttributes:{title:t({id:"inline.comments.sidebar.tooltip.close.description"})}}),'</div></div><div class="ic-error"></div>')}function _(e,t){var i=function(e){return"".concat(""==e.authorAccountId?l.a.aui.avatar.avatar({size:e.size,avatarImageUrl:e.authorAvatarUrl,extraClasses:"ic-author-avatar"}):'<a data-account-id="'.concat(l.a.soy.$$escapeHtml(e.authorAccountId),'" href="').concat(l.a.soy.$$escapeHtml("/people"),"/").concat(l.a.soy.$$escapeHtml("".concat(e.authorAccountId,"?ref=confluence")),'" title="" data-user-hover-bound="true">').concat(l.a.aui.avatar.avatar({size:e.size,avatarImageUrl:e.authorAvatarUrl,extraClasses:"ic-author-avatar"}),"</a>"))}({authorAvatarUrl:e.authorAvatarUrl,authorAccountId:e.authorAccountId,size:"small"}),n=function(e){return"".concat(e.accountId&&""!=e.accountId?'<a href="'.concat(function(e){return"".concat(l.a.soy.$$escapeHtml("/people"),"/").concat(l.a.soy.$$escapeHtml("".concat(e.accountId,"?ref=confluence")))}(e),'"').concat(e.canView?'class="url fn confluence-userlink" data-account-id="'.concat(l.a.soy.$$escapeHtml(e.accountId),'"'):'class="url fn"',">").concat(l.a.soy.$$escapeHtml(e.fullName),"</a>"):l.a.soy.$$escapeHtml("Anonymous"))}({canView:!!e.authorAccountId,fullName:e.authorDisplayName,accountId:e.authorAccountId});return'<div class="ic-author">'.concat(i).concat(n,"</div>")}function $(e,t){var i='<div class="ic-container ic-create-comment">'.concat(_(e),'<div class="ic-body"><form class="aui" action="">');if(e.darkFeatures.RICH_TEXT_EDITOR)i+='<div class="loading-container" />';else{var n="".concat("reply"==e.type?l.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"})):l.a.soy.$$escapeHtml(t({id:"inline.comments.create.placeholder"})));i+='<textarea class="textarea ic-textarea" name="body" placeholder="'.concat(l.a.soy.$$escapeHtml(n),'">').concat(l.a.soy.$$escapeHtml(e.text),'</textarea><div class="ic-actions"><ul><li>').concat(l.a.aui.buttons.button({tagName:"button",text:t({id:"inline.comments.sidebar.save"}),type:"link",extraClasses:"ic-action-save",isDisabled:!0}),"</li>").concat("topLevel"!=e.type?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),type:"link",extraClasses:"ic-action-discard"}),"</li>"):"","</ul></div>")}return i+="</form></div></div>"}function V(e,t){return'<div data-comment-id="'.concat(l.a.soy.$$escapeHtml(e.id),'" class="ic-container ic-display-comment">').concat(_(e),'<div class="ic-body wiki-content"><div class="ic-content">').concat(e.resolveProperties.resolved?'<blockquote><span class="ic-resolved-marker">'.concat(l.a.soy.$$escapeHtml(e.originalSelection),"</span></blockquote>"):"").concat(l.a.soy.$$filterNoAutoescape(e.body),"</div></div>").concat(e.resolveProperties.resolved?function(e,t){return"".concat(e.darkFeatures.INLINE_COMMENTS?'<div class="ic-actions"><ul class="aui-list-truncate">'.concat(e.hasResolvePermission&&!e.isDangling?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.resolved.menu.unresolve"}),type:"link",extraClasses:"ic-action-unresolve"}),"</li>"):"",'<li class="hidden">').concat(l.a.aui.buttons.button({type:"link",extraClasses:"ic-action-show-reply"}),"</li>").concat((e.hasReply,"")).concat(e.resolveProperties.resolvedTime>0?'<li class="ic-resolved-message">'.concat(l.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"success"}),"  <span>").concat(F({time:"".concat(e.isDangling&&e.resolveProperties.resolvedByDangling?l.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.dangling.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate})):l.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate}))),commentUrl:e.commentDateUrl}),"</span></li>"):"","</ul></div>"):"")}(e,t):function(e,t){return"".concat(e.darkFeatures.INLINE_COMMENTS?'<div class="ic-actions"><ul class="aui-list-truncate">'.concat(e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.resolve"}),type:"link",extraClasses:"ic-action-resolve"}),"</li>"):"",'<li class="ic-action-like"></li><li class="ic-date">').concat(F({time:e.lastModificationDate,commentUrl:e.commentDateUrl}),"</li></ul></div>"):"")}(e,t),"</div>").concat(!e.resolveProperties.resolved&&e.resolveProperties.resolvedTime>0&&e.resolveProperties.resolvedUser?'<div class="ic-unresolved-message">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.unresolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate})),"</div>"):"")}function U(e,t){return"".concat(l.a.aui.buttons.button({type:"text",id:"ic-nav-next",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-down",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.next.ic.description"})}})).concat(l.a.aui.buttons.button({type:"text",id:"ic-nav-previous",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-up",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.previous.ic.description"})}})).concat(e.showIndex?'<span class="ic-nav-x-out-of-y">'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.navigation.index.of"},{0:e.index,1:e.size})),"</span>"):"")}function F(e){return'<a class="ic-date-link" title="'.concat(l.a.soy.$$escapeHtml(e.time),'" href="').concat(l.a.soy.$$escapeHtml("/wiki".concat(e.commentUrl)),'"><span>').concat(l.a.soy.$$escapeHtml(e.time),"</span></a>")}var Y={comment:V,commentForm:$,confirmDialog:function(e,t){return'<strong class="ic-confirm-label">'.concat(l.a.soy.$$escapeHtml(e.label),'</strong><div class="ic-confirm-message">').concat(l.a.soy.$$escapeHtml(e.message),'</div><div class="ic-confirm-buttons">').concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),tagName:"button",extraClasses:["ic-action-delete-confirm","aui-button-compact"]})).concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),tagName:"button",type:"link",extraClasses:["ic-action-cancel-confirm","aui-button-compact"]}),"</div>")},createComment:function(e,t){return'<div class="ic-comment-container">'.concat("topLevel"==e.type||"pageComment"==e.type?z({showMenu:!1,createComment:!0,darkFeatures:e.darkFeatures},t):"").concat($(e,t),"</div>")},deleteComment:function(e){return'<div class="ic-comment-container ic-deleted">'.concat(z({createComment:!1,showMenu:!1},e),'<div class="ic-delete-comment-view"><h2><span class="aui-icon ic-delete-image line">::before</span>').concat(l.a.soy.$$escapeHtml(e({id:"inline.comments.sidebar.deleted"})),"</h2></div></div>")},displayComment:function(e,t){return'<div class="ic-comment-container">'.concat(z({hasDeletePermission:e.hasDeletePermission,hasResolvePermission:e.hasResolvePermission,hasEditPermission:e.hasEditPermission,hasReplyPermission:e.hasReplyPermission,showMenu:e.showMenu&&!e.resolveProperties.resolved,darkFeatures:e.darkFeatures},t)).concat(e.resolveProperties.resolved?function(e,t){return'<div class="ic-resolved-mask"><div class="ic-resolved-mask-content"><h2 class="ic-resolved-icon">'.concat(l.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})).concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolved"})),'</h2></div><div class="resolved-message-container"><div class="resolved-message-sideline"><p>').concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.message"})),"</p>").concat(l.a.aui.buttons.button({text:t({id:"adg3.onboarding.docs.link"}),href:"https://confluence.atlassian.com/display/ConfCloud/Comment+on+pages+and+blog+posts#Commentonpagesandblogposts-Resolveinlinecomments",type:"link",extraAttributes:{target:"_blank"},id:"show-resolved-comments"}),"</div></div></div>")}(0,t):V(e,t),"</div>").concat(e.resolveProperties.resolved?"":'<div class="ic-list"></div><div class="ic-reply-container">'.concat(e.darkFeatures.INLINE_COMMENTS&&e.hasReplyPermission?'<div class="ic-reply-placeholder">'.concat(_({authorAvatarUrl:e.currentAuthorAvatarUrl,authorDisplayName:e.currentAuthorDisplayName,authorAccountId:e.currentAuthorAccountId,isGDPRInlineCommentsEnabled:e.isGDPRInlineCommentsEnabled}),'<div class="ic-body"><form class="aui"><textarea class="textarea ic-textarea" name="body" placeholder="').concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"})),'"></textarea></form></div></div>'):"","</div>"))},highlightTextLink:function(e){return"".concat(l.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"link"}),"<a href='").concat(l.a.soy.$$escapeHtml(e.link),"'>").concat(l.a.soy.$$escapeHtml(e.link),"</a>")},likes:function(e,t){return"".concat(e.showLikeButton?l.a.aui.buttons.button({text:e.isLikedByUser?t({id:"inline.comments.likes.unlike"}):t({id:"inline.comments.likes.like"}),type:"link",extraClasses:"ic-like-button"}):"").concat(e.likesCount>0?'<span class="ic-like-summary"><span class="ic-small-like-icon"></span><a class="ic-likes-count" data-content-id="'.concat(l.a.soy.$$escapeHtml(e.contentId),'"><span class="ic-like-summary">').concat(l.a.soy.$$escapeHtml(e.likesCount),"</span></a></span>"):"")},navigation:U,pageComment:function(e,t){return'<div class="ic-comment-container">'.concat(z({createComment:!1,showMenu:!1},t),'<div class="ic-page-comment-view"><div class="ic-page-comment"><div class="ic-page-comment-content"><h2 class="ic-resolved-icon">').concat(l.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})).concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.saved"})),'</h2></div><div class="ic-page-comment-message-container"><div class="ic-page-comment-message-sideline"><p>').concat(l.a.soy.$$escapeHtml(t({id:"page.comments.saved.dialog.message"})),'</p><button id="show-page-comment" class="aui-button aui-button-link" data-comment-id="').concat(l.a.soy.$$escapeHtml(e.commentId),'">').concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.show.me"})),"</button></div></div></div></div></div>")},renderReply:function(e,t){return"".concat(_(e),'<div class="ic-body wiki-content"><div class="ic-content ic-reply-content">').concat(l.a.soy.$$filterNoAutoescape(e.body),"</div></div>").concat(e.darkFeatures.INLINE_COMMENTS&&!e.resolved?function(e,t){return'<div class="ic-actions"><ul>'.concat(e.hasDeletePermission?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),type:"link",extraClasses:"ic-action-delete-reply"}),"</li>"):"").concat(e.hasEditPermission?"<li>".concat(l.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.edit"}),type:"link",extraClasses:"ic-action-edit-reply"}),"</li>"):"",'<li class="ic-action-like-reply"></li><li class="ic-date">').concat(F({time:e.lastModificationDate,commentUrl:e.commentDateUrl}),"</li></ul></div>")}(e,t):"<div>".concat(F({time:e.lastModificationDate,commentUrl:e.commentDateUrl}),"</div>"))},resolvedCommentDialog:function(e,t){return"".concat(l.a.aui.dialog.dialog2({id:"ic-resolved-comment-dialog",removeOnHide:!0,extraClasses:"ic-resolved-comment-dialog-content",modal:!0,titleText:t({id:"inline.comments.resolved.view.menu"}),footerActionContent:"".concat(l.a.aui.buttons.button({id:"resolved-dialog-close-button",text:t({id:"inline.comments.sidebar.close"}),type:"link"})),content:'\x3c!-- Placeholder for error message --\x3e<div id="ic-resolved-comment-dialog-error" />'}))},showmoreReply:function(e,t){return'<div id="ic-showmore-container"><div class="ic-decor-line"/><div class="ic-decor-line"/><div class="ic-collapse-decor-center"><span>'.concat(l.a.soy.$$escapeHtml(t({id:"inline.comments.expand.replies"},{0:e.totalReplies})),"</span></div></div>")}},G=h.a.View.extend({el:"[data-inline-comments-target=true]:first",events:{"click .inline-comment-marker.valid":"commentClick","click span[data-mark-type=confluenceInlineComment].valid":"commentClick","click span[data-mark-type=annotation][data-mark-annotation-type=inlineComment].valid":"commentClick"},initialize:function(){this.collection&&(this.listenTo(this.collection,"sync remove change:deleted",this.render),this.listenTo(this.collection,"change:active",this.setActive)),this.listenTo(h.a,"ic:view ic:overlap ic:sidebar-hidden",this.clearSelection),this.listenTo(h.a,"ic:persist",this.persistComment),this.listenTo(h.a,"ic:delete",this.render),s.a.bind("qr:add-new-highlight-text".concat(".ic-highlight"),this._addQuickReloadMarker)},destroy:function(){s.a.unbind(".ic-highlight"),this.stopListening(),this.undelegateEvents()},render:function(){this.inlineLinks=[],this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment]").removeClass("valid"),this.collection.each(function(e){e.isResolved()||e.get("deleted")||!e.highlights||(e.highlights.addClass("valid"),this._pushToInlineLinks(e.highlights))},this),this._setupLinkDialog(),s.a.trigger("ic-highlight-rendered",this.collection)},_pushToInlineLinks:function(e){var t=this;e.each(function(){D.getInlineLinks(this).each(function(){o()(this).attr("href")&&t.inlineLinks.push(o()(this))})})},_setupLinkDialog:function(){var e={width:200,onHover:!0,noBind:!0,calculatePositions:this._calculatePositions,hideDelay:1e3};o()(this.inlineLinks).each(function(){var t=this;s.a.InlineDialog(t,"inline-comment-link",function(e,i,n){return e.addClass("inline-comment-link"),e.html(Y.highlightTextLink({link:t.attr("href")})),n(),!1},e)})},_calculatePositions:function(e,t,i){return{displayAbove:!0,popupCss:{top:t.target.offset().top-e.height()-10,left:i.x-e.width()/2},arrowCss:{top:e.height(),left:e.width()/2-4}}},setActive:function(e){this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment]").removeClass("active");var t=this.$('.inline-comment-marker[data-ref="'.concat(e.get("markerRef"),'"],')+'span[data-mark-type=confluenceInlineComment][data-reference="'.concat(e.get("markerRef"),'"],')+'span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="'.concat(e.get("markerRef"),'"]'));e.get("active")&&t.length&&t.addClass("active")},commentClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.$(e.currentTarget),i=t.parentsUntil(".active",".inline-comment-marker.valid");t.hasClass("active")?h.a.trigger("ic:hide-sidebar",e,!0):i.length>0?this.displayComment(i.last()):this.displayComment(t)},displayComment:function(e,t){var i=e.data("ref")||e.data("reference")||e.data("id"),n=this.collection.findWhere({markerRef:i});h.a.trigger("ic:view",n,t)},clearSelection:function(){(new H).removeHighlight()},persistComment:function(e){this.$(".ic-current-selection").removeClass("ic-current-selection").addClass("inline-comment-marker").attr("data-ref",e.get("markerRef")),this.collection.add(e)},_addQuickReloadMarker:function(e,t,i){var n=t.comment;this.$('.inline-comment-marker[data-ref="'.concat(n.dataRef,'"],')+'span[data-mark-type=confluenceInlineComment][data-reference="'.concat(n.dataRef,'"],')+'span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="'.concat(n.dataRef,'"]')).length?i.resolve(t):(new H).deserializeHighlights(n.serializedHighlights,n.dataRef)?i.resolve(t):i.reject(t)}}),Q=i("97Jx"),B=i.n(Q),W=i("m3Bd"),Z=i.n(W),X=i("ERkP"),q=i.n(X),J=i("96U/"),K=i("VrFO"),ee=i.n(K),te=i("Y9Ll"),ie=i.n(te),ne=i("N+ot"),oe=i.n(ne),ae=i("AuHH"),se=i.n(ae),re=i("5Yy7"),ce=i.n(re),le=(i("aWzz"),i("3iG9")),de=function(e){function t(){return ee()(this,t),oe()(this,se()(t).apply(this,arguments))}return ce()(t,e),ie()(t,[{key:"renderUserLink",value:function(){var e=this.props,t=e.userId,i=Z()(e,["userId"]);return q.a.createElement("a",B()({},i,{"data-account-id":t}),this.props.children)}},{key:"render",value:function(){var e=this.props.userId;return q.a.createElement(le.a,{userId:e,isAnonymous:!e,canViewProfile:!0,position:"bottom-end"},this.renderUserLink())}}]),t}(X.Component);de.displayName="InlineCommentHeader";var ue=i("FErI"),me=function(e){var t=Array.from(e.el.querySelectorAll(".ic-author")).filter(function(e){return null!==e.querySelector(".confluence-userlink")}).map(function(e){return e.querySelector(".confluence-userlink")});Object(ue.a)(t).forEach(function(e){var t=e.props,i=t["data-account-id"],n=Z()(t,["data-account-id"]);Object(J.a)(q.a.createElement(de,B()({userId:i},n),e.props.children),e.placeholder)})},he=i("1Pcy"),ge=i.n(he),fe=i("KEM+"),pe=i.n(fe),ve=i("9Kiz"),ye=function(e){function t(){var e,i;ee()(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=oe()(this,(e=se()(t)).call.apply(e,[this].concat(o))),pe()(ge()(i),"state",{inlineCommentBodyNode:null}),i}return ce()(t,e),ie()(t,[{key:"componentDidMount",value:function(){this._setInlineCommentBodyNode()}},{key:"_setInlineCommentBodyNode",value:function(){this.setState({inlineCommentBodyNode:this.props.node})}},{key:"render",value:function(){var e=this.props.body;return q.a.createElement(X.Fragment,null,q.a.createElement("p",{dangerouslySetInnerHTML:{__html:e}}),q.a.createElement(ve.a,{node:this.state.inlineCommentBodyNode,position:"bottom-end"}))}}]),t}(X.Component);ye.displayName="InlineCommentBody";var Ce=function(e){var t=e.el.querySelector(".ic-content");t&&Object(J.a)(q.a.createElement(ye,{node:t,body:t.innerHTML}),t)},Me=i("VtSi"),be=i.n(Me),Ee=i("cbiG"),we=i.n(Ee),Ie=i("LodO");function ke(){s.a.Confluence.EditorLoader.resourcesLoaded()||this.$form.find(".loading-container").spin("small")}function Ne(){s.a.Meta.set("content-type","comment"),s.a.Meta.set("use-inline-tasks","false"),s.a.Meta.set("min-editor-height",80)}function Te(e){e.$form.find(".loading-container").hide(),e.$form.find("#rte-button-publish").text(this.formatMessage({id:"inline.comments.sidebar.save"})).removeAttr("title"),e.$form.find("#toolbar-hints-draft-status").hide(),this.hideCancelButton&&e.$form.find("#rte-button-cancel").hide(),e.editor.onPostProcess.add(function(e,t){return function i(){l.a.tinymce.DOM.setStyle(l.a.tinymce.DOM.get("".concat(t.id,"_ifr")),"height","80px"),t.execCommand("mceAutoResize",{forceExec:!0}),t[e].remove(i)}}("onPostProcess",e.editor)),l.a.Confluence.Editor&&!l.a.Confluence.Editor.getContentType&&s.a.Confluence.QuickEdit.QuickEditPage.disable(),l.a.Confluence.Editor.removeAllCancelHandlers(),l.a.Confluence.Editor.removeAllSaveHandlers()}var De,Ae,xe,Se={init:function(e){return this.formatMessage=e.formatMessage,s.a.Confluence.QuickEdit.activateEditor({preActivate:ke,preInitialise:Ne,postInitialise:o.a.proxy(Te,e),toolbar:!1,$container:e.container,$form:e.form,saveHandler:e.saveHandler,cancelHandler:e.cancelHandler,fetchContent:e.fetchContent(),closeAnyExistingEditor:!0,postDeactivate:e.postDeactivate,plugins:D.getSupportedRtePlugins(),excludePlugins:D.getUnsupportedRtePlugins()})},remove:function(){return s.a.Rte&&s.a.Rte.getEditor()?s.a.Confluence.QuickEdit.deactivateEditor():o.a.Deferred().resolve()},getContent:function(){return s.a.Rte.Content.getHtml()},setEditorBusy:function(e){e?o()(".ic-sidebar #rte-spinner").spin():o()(".ic-sidebar #rte-spinner").spinStop(),o()("#rte-button-publish").prop("disabled",e)}},Re=h.a.View.extend({tagName:"div",className:"ic-create-comment-view",events:{"click .ic-action-save":"saveComment","click .ic-action-discard":"discardComment","keyup .ic-textarea":"onInput","focus .ic-textarea":"onFocus","click #show-page-comment":"showPageComment"},template:Y.createComment,initialize:function(e){this.formatMessage=e.formatMessage,this.selection=e.selection,this.type=e.type,this.onFinished=e.onFinished||function(){},this.commentText=e.commentText||"",this.stopFocus=e.stopFocus,this.serializedHighlights=e.serializedHighlights,"edit"!==e.type&&"reply"!==e.type||(this.template=Y.commentForm,h.a.trigger("ic:discard-edit"),this.listenTo(h.a,"ic:discard-edit",this.discardComment)),D.isSPAPage()?(this.isTinymceResourceReady="true"===o()(".".concat(D.getPageContentClassName())).attr("data-editor-resource-loaded"),this.isPendingRenderEditor=!1,this.listenTo(h.a,"ic:tinymce-resource-loaded",this.tinymceResourceLoaded)):this.isTinymceResourceReady=!0},tinymceResourceLoaded:function(){this.isTinymceResourceReady=!0,this.isPendingRenderEditor&&(this.isPendingRenderEditor=!1,this.renderEditor())},finish:function(){this.onFinished(),s.a.trigger("ic-jim-async-supported")},render:function(){var e=this;return we()(be.a.mark(function t(){var i,n,o;return be.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._getAuthorObject();case 2:return i=t.sent,n={type:e.type,text:e.commentText,showMenu:!1,isGDPRInlineCommentsEnabled:e.options.isGDPRInlineCommentsEnabled},o=u.a.extend({},i,n,{darkFeatures:D.getDarkFeatures()}),e.$el.html(e.template(o,e.formatMessage)),D.getDarkFeatures().RICH_TEXT_EDITOR?e.isTinymceResourceReady?e.renderEditor():(e.$(".loading-container").spin("small"),e.isPendingRenderEditor=!0):e.stopFocus||setTimeout(u.a.bind(e.focusEditor,e),1),"true"===e.options.isUnifiedProfileCardsEnabled&&me(e),D.addSidebarHeadingTooltip(e),t.abrupt("return",e);case 10:case"end":return t.stop()}},t)}))()},onInput:function(e){var t=""!==this.$(e.target).val().trim();this._saveDisable(!t)},onFocus:function(){if("edit"===this.type){var e=this.$(".textarea");D.moveCaretToEnd(e[0]),this._saveDisable(""===e.text())}},saveComment:function(e){e.preventDefault(),this._isValid()&&(this._disableForm(),"reply"===this.type?this._addReply():"edit"===this.type?this._saveEdit():this._addComment())},_getAuthorObject:function(){var e,t,i;return"edit"===this.type?(e=this.model.get("authorAvatarUrl"),t=this.model.get("authorDisplayName"),i=this.model.get("authorAccountId"),Promise.resolve({authorAvatarUrl:e,authorDisplayName:t,authorAccountId:i})):D.getCurrentUserData()},_saveEdit:function(){var e=this._getContent(),t={wait:!0,beforeSend:u.a.bind(this.beforeSendAjax,this),success:u.a.bind(this._onSaveSuccess,this),error:u.a.bind(this._showEditError,this)};this.model.save({body:e},t)},_showEditError:function(e,t){var i;this.showCaptchaError(t)||(i=401===t.status?this.formatMessage({id:"inline.comments.edit.permission"}):this.formatMessage({id:"inline.comments.server.edit.error"}),this._triggerError(i))},_triggerError:function(e,t){h.a.trigger("ic:error",e,t),this._disableForm(!1)},_addReply:function(){new A({body:this._getContent(),commentId:this.model.get("id"),hasDeletePermission:Boolean(s.a.Meta.get("atlassian-account-id"))||this.model.get("hasDeletePermission")}).save(null,{beforeSend:u.a.bind(this.beforeSendAjax,this),success:u.a.bind(this._onSaveSuccess,this),error:u.a.bind(function(e,t){this.showCaptchaError(t)||this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.reply"}))},this)})},_addComment:function(){var e=new S({originalSelection:this.selection.searchText.selectedText.replace(/\n/g,""),body:this._getContent(),matchIndex:this.selection.searchText.index,numMatches:this.selection.searchText.numMatches,serializedHighlights:this.serializedHighlights}),t={callback:this.bindPageReloadLink};e.save(null,{beforeSend:u.a.bind(this.beforeSendAjax,this),success:u.a.bind(this._onSaveSuccess,this),error:u.a.bind(function(e,i){this.showCaptchaError(i)||(409===i.status?this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.stale"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),t):412===i.status?(s.a.trigger("analytics",{name:"confluence.comment.inline.cannot.create"}),this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.create.comment"}))):this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.comment"})))},this)})},_isValid:function(){return"<p><br /></p>"!==o.a.trim(this._getContent())||(h.a.trigger("ic:error",this.formatMessage({id:"inline.comments.sidebar.comment.empty"})),!1)},_onSaveSuccess:function(e){switch(this.type){case"topLevel":e.set("hasDeletePermission",!0),h.a.trigger("ic:persist",e),h.a.trigger("ic:view",e,void 0,{ignoreConfirmDialog:!0});break;case"reply":this.model.replies.push(e),h.a.trigger("ic:reply:persist",e),this.finish();break;case"edit":h.a.trigger("ic:edit"),this.finish()}this.trackAnalyticEvent(e,this.type)},_setEditorIsNotDirty:function(){s.a.Rte.getEditor()&&(s.a.Rte.getEditor().isNotDirty=1)},_disableForm:function(e){void 0===e&&(e=!0),this._saveDisable(e),D.getDarkFeatures().RICH_TEXT_EDITOR||this.$(".ic-action-discard,.ic-textarea").prop("disabled",e).attr("aria-disabled",e)},_saveDisable:function(e){D.getDarkFeatures().RICH_TEXT_EDITOR?(Se.setEditorBusy(e),o()("#rte-button-cancel")[0].disabled=e):this.$(".ic-action-save").prop("disabled",e).attr("aria-disabled",e)},renderEditor:function(){var e=this.$(".ic-body"),t=this.commentText,i=s.a.Confluence.QuickEdit.QuickComment;if(s.a.Confluence.QuickEdit)try{s.a.Confluence.QuickEdit.deactivateEditor()}catch(e){}return Se.init({formatMessage:this.formatMessage,container:e,form:e.find("form.aui"),saveHandler:"pageComment"===this.type?i.createSaveHandler(u.a.bind(this._successCreatePageComment,this),i.saveCommentErrorHandler):u.a.bind(this.saveComment,this),cancelHandler:u.a.bind(this.discardComment,this),fetchContent:function(){var e=new o.a.Deferred;return e.resolve({editorContent:t}),e},postDeactivate:u.a.bind(function(){h.a.trigger("ic:clearError"),this.finish()},this),hideCancelButton:"topLevel"===this.type}).done(u.a.bind(this.renderEditorCompleted,this)).fail(u.a.bind(this.renderEditorFail,this))},showPageComment:function(e){var t=o()(e.target).data("comment-id"),i=o()("#comment-".concat(t));i.addClass("focused"),i.scrollToElement()},_successCreatePageComment:function(e){l.a.Confluence.CommentDisplayManager.addComment(D.getCurrentUserInfo(),e,!1,!1,!0),s.a.trigger("page.commentAddedOrUpdated",{commentId:e.id}),this._setEditorIsNotDirty(),D.getDarkFeatures().RICH_TEXT_EDITOR&&(this.keepSidebar=!0,Se.remove()),this.$el.html(Y.pageComment({commentId:e.id},this.formatMessage)),D.addSidebarHeadingTooltip(this)},renderEditorCompleted:function(){h.a.trigger("ic:clearError"),"topLevel"!==this.type&&"pageComment"!==this.type||(this.$("#rte-button-cancel").hide(),"pageComment"===this.type&&(h.a.trigger("ic:error",this.formatMessage({id:"page.comments.sidebar.warning"})),this.focusEditor())),this.captchaManager=new s.a.Confluence.QuickEditCaptchaManager(s.a.Confluence.EditorLoader.getEditorForm())},renderEditorFail:function(){var e={closeable:!0,callback:this.bindPageReloadLink};switch(this.type){case"pageComment":this._setEditorIsNotDirty();break;case"topLevel":this.$(".loading-container").hide(),this.$(".ic-create-comment").hide(),e.closeable=!1;break;case"edit":case"reply":this.finish()}h.a.trigger("ic:error",this.formatMessage({id:"inline.comments.editor.timeout"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),e),h.a.trigger("ic:editor:load:fail")},bindPageReloadLink:function(){o()(".ic-error").off("click",".ic-reload-page").on("click",".ic-reload-page",function(){return l.a.location.reload(),!1})},discardComment:function(e){e&&e.preventDefault(),h.a.trigger("ic:clearError"),this.finish()},_getContent:function(){return D.getDarkFeatures().RICH_TEXT_EDITOR?Se.getContent():this.$("textarea").val()},focusEditor:function(){if(D.getDarkFeatures().RICH_TEXT_EDITOR)if("pageComment"===this.type){var e=o()(s.a.Rte.getEditor()&&s.a.Rte.getEditor().getBody()).find("div")[0];s.a.Rte.getEditor().selection.select(e,1),s.a.Rte.getEditor().selection.collapse(1),e.focus()}else s.a.Rte.getEditor()&&s.a.Rte.getEditor().focus();else this.$(".ic-textarea:visible").focus()},destroy:function(){D.getDarkFeatures().RICH_TEXT_EDITOR&&Se.remove(),this.remove()},beforeSendAjax:function(e){var t=this.captchaManager.getCaptchaData();t&&t.id&&(e.setRequestHeader("X-Atlassian-Captcha-Id",t.id),e.setRequestHeader("X-Atlassian-Captcha-Response",t.response))},showCaptchaError:function(e){return!(404!==e.status||!e.responseText||-1==e.responseText.search(/captcha/i))&&(this.captchaManager.refreshCaptcha(),this._triggerError(this.formatMessage({id:"captcha.response.failed"})),!0)},trackAnalyticEvent:function(e,t){var i,n,a;try{i=e.attributes.id.toString(),n=e.changed.active?null:e.attributes.commentId.toString(),a=o()(".view-page-body").get(0).dataset.spaceId}catch(e){}var r={containerType:"space",containerId:a,source:"viewPageScreen",objectType:"page",objectId:s.a.Meta.get("content-id"),action:"edit"===t?"updated":"created",actionSubject:"comment",actionSubjectId:i,attributes:{commentType:"inline",pageType:s.a.Meta.get("draft-type"),parentCommentId:n}};Object(Ie.a)().then(function(e){e.sendTrackEvent(r)})}}),Pe=h.a.View.extend({tagName:"div",className:"ic-confirm-container",initialize:function(e){this.formatMessage=e.formatMessage,this.$menuEl=e.$menuEl,this.$bodyEl=e.$bodyEl,this.$menuEl.addClass("ic-action-menu-active"),this.render(),u.a.bindAll(this,"clickOutside"),this.$bodyEl.on("click",this.clickOutside)},events:{"click .ic-action-cancel-confirm":"cancel","click .ic-action-delete-confirm":"confirm"},template:Y.confirmDialog,render:function(){return this.$el.html(this.template(this.model.toJSON(),this.formatMessage)),this},clickOutside:function(e){o.a.contains(this.el,e.target)||this.el===e.target||this.cancel()},cancel:function(){this.destroy()},confirm:function(){this.trigger("ic:confirm"),this.destroy()},destroy:function(){this.$bodyEl.off("click",this.clickOutside),this.$menuEl.removeClass("ic-action-menu-active"),this.remove()}}),Oe=i("1vxf"),Le=h.a.View.extend({className:"ic-likes",render:function(){return this.el&&Object(J.a)(q.a.createElement(Oe.a,{contentId:"".concat(this.options.contentId),contentType:"comment",containerId:"".concat(this.options.containerId),containerType:this.options.containerType,isForInlineComment:!0}),this.el),this}}),je=h.a.View.extend({tagName:"div",className:"ic-display-reply",template:Y.renderReply,events:{"click .ic-action-edit-reply":"editReply","click .ic-action-delete-reply":"confirmDelete"},initialize:function(e){this.formatMessage=e.formatMessage,u.a.bindAll(this,"onEditCallback"),this.$el.attr("data-comment-id",this.model.get("id"))},_renderLikes:function(){var e=this,t=this.el&&this.el.querySelector(".ic-action-like-reply");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(function(i){i?(e.likesView&&e.likesView.remove(),e.likesView=new Le({contentId:e.model.id,el:t}).render()):t&&t.remove()}):t&&t.remove()},render:function(){var e=u.a.extend(this.model.toJSON(),{resolved:this.options.resolved,darkFeatures:D.getDarkFeatures(),isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled}),t=this.template(e,this.formatMessage);return this.$el.html(t),this._renderLikes(),"true"===this.options.isUnifiedProfileCardsEnabled&&(me(this),Ce(this)),this},editReply:function(e){var t=this;D.confirmProcess(this.formatMessage)?D.getEditorFormat(this.model.get("id")).done(function(e){t.editView=new Re({model:t.model,type:"edit",selection:{},onFinished:t.onEditCallback,commentText:e,formatMessage:t.formatMessage,isGDPRInlineCommentsEnabled:t.options.isGDPRInlineCommentsEnabled,isUnifiedProfileCardsEnabled:t.options.isUnifiedProfileCardsEnabled}),t.$el.html(t.editView.$el),t.editView.render()}).fail(function(){h.a.trigger("ic:error",t.formatMessage({id:"inline.comments.server.error.edit.reply"}))}):e&&e.currentTarget.blur()},onEditCallback:function(){this.editView&&this.editView.destroy(),this.editView=null,this.render()},deleteFail:function(e,t){401===t.status?h.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.permission"})):h.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},confirmDelete:function(e){!0===l.a.confirm(this.formatMessage({id:"inline.comments.delete.reply.confirmation.message"}))&&this.deleteReply(e)},deleteReply:function(e){o()(e.target).attr("aria-disabled",!0).prop("disabled",!0),this.model.destroy({wait:!0,error:this.deleteFail,success:function(){h.a.trigger("ic:reply:delete")}})},destroy:function(){this.likesView&&this.likesView.remove(),this.editView&&this.editView.destroy(),this.remove()}}),He=h.a.View.extend({tagName:"div",className:"ic-replies",events:{"click #ic-showmore-container":"forceShowAllReplies"},initialize:function(e){if(this.formatMessage=e.formatMessage,!e.commentModel)throw new Error("Inline Comment Model should be passed as a parameter when init ReplyListView","ReplyListView");this.replyViews=[],this.collection=e.commentModel.replies,this.source=e.source,this.listenTo(this.collection,"add remove",this.render),!0!==this.collection.isFetched&&(this.listenToOnce(this.collection,"sync",this.fetchComplete),this.collection.fetch({reset:!0,cache:!1})),this.expandReplies=!1,this.COMMENT_NUMBER_TO_COLLAPSE=4},fetchComplete:function(){this.collection.isFetched=!0,this.render(),D.resizeContentAfterLoadingImages(this.$el)},render:function(e){return!0!==this.collection.isFetched?this:e&&this.collection.last()===e?void this.appendReply(e):(this.cleanUpReplyViews(),this.$el.empty(),this.collection.length>this.COMMENT_NUMBER_TO_COLLAPSE&&!1===this.expandReplies&&"permalink"!==this.source&&this.options.commentModel&&!this.options.commentModel.isResolved()?this.renderCollapsibleReplies():this.renderFullReplies(),this.trigger("ic:reply-rendered",this.options.commentModel),this._hightlightReply(),s.a.trigger("ic-jim-async-supported"),this)},renderFullReplies:function(){this.collection.each(function(e){this.appendReply(e)},this)},forceShowAllReplies:function(){this.expandReplies=!0,this.render()},renderCollapsibleReplies:function(){this.renderExpendButton();var e=this.collection.last();this.appendReply(e)},appendReply:function(e){var t=this.createReplyView(e);this.replyViews.push(t),this.$el.append(t.render().el)},renderExpendButton:function(){this.$el.append(Y.showmoreReply({totalReplies:this.collection.length-1},this.formatMessage))},createReplyView:function(e){return new je({formatMessage:this.formatMessage,model:e,resolved:this.options.commentModel.isResolved(),shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled})},_hightlightReply:function(){if("permalink"===this.source){var e=l.a.location.search.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null!=e){var t=parseInt(e[2],10);t&&0!==t&&this.$("[data-comment-id=".concat(t,"]")).addClass("ic-comment-reply-highlight")}}},cleanUpReplyViews:function(){var e;for(e=0;e<this.replyViews.length;e++)this.replyViews[e].destroy(),this.replyViews[e]=null;this.replyViews=[]},destroy:function(){this.cleanUpReplyViews(),this.remove()}}),ze=!1,_e=h.a.View.extend({tagName:"div",events:{"click #ic-nav-previous":"showPrevious","click #ic-nav-next":"showNext"},template:Y.navigation,initialize:function(e){this.formatMessage=e.formatMessage,this.collection=this.model.collection,this.listenTo(this.collection,"change:resolveProperties",this.onResolveToggle),this.disabled=this.collection.getCommentsOnPageCount()<=1,this.listenTo(h.a,"ic:show-previous",this.showPrevious),this.listenTo(h.a,"ic:show-next",this.showNext)},render:function(){return this.$el.html(this.template({disabled:this.disabled,showIndex:!(this.model.isResolved()||this.model.get("deleted")),index:this.collection.getActiveIndexWithinPageComments()+1,size:this.collection.getCommentsOnPageCount()},this.formatMessage)),this},onResolveToggle:function(){this.disabled=this.collection.getCommentsOnPageCount()<=1,this.render()},showPrevious:function(e){if(!this.disabled&&!ze){var t=this.collection.getPrevCommentOnPage();null!=t&&h.a.trigger("ic:view",t,"nav"),e.view||(ze=!0,setTimeout(function(){ze=!1},500))}},showNext:function(e){if(!this.disabled&&!ze){var t=this.collection.getNextCommentOnPage();null!=t&&h.a.trigger("ic:view",t,"nav"),e.view||(ze=!0,setTimeout(function(){ze=!1},500))}}}),$e=h.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:Y.displayComment,events:{"click .ic-action-reply":"replyComment","click .ic-action-resolve":"resolveComment","click .ic-action-edit":"editComment","click #show-resolved-comments":"showResolvedDialogDiscovery","click .ic-reply-placeholder .textarea":"replyComment","focus .ic-reply-container .textarea":"onReplyPlaceholderFocus"},initialize:function(e){this.formatMessage=e.formatMessage,u.a.bindAll(this,"confirm","destroy","deleteFail","replyComment","resolveComment","editComment","renderCommentOnly"),this.model.set("active",!0),this.listenTo(this.model,"change:resolveProperties",this.render),this.listenTo(this.model,"remove",this.destroy),o()("body").on("click",".ic-action-delete a",this.confirm),o()("body").on("click",".ic-action-reply a",this.replyComment),o()("body").on("click",".ic-action-resolve a",this.resolveComment),o()("body").on("click",".ic-action-edit a",this.editComment),this.replyListView=new He({formatMessage:this.formatMessage,commentModel:this.model,source:e.source,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled})},render:function(){var e=this;return D.getCurrentUserData().then(function(t){e.$el.html(e.template(u.a.extend(e.model.toJSON(),{showMenu:!0,currentAuthorAvatarUrl:t.authorAvatarUrl,currentAuthorDisplayName:t.authorDisplayName,currentAuthorAccountId:t.authorAccountId,darkFeatures:D.getDarkFeatures(),isGDPRInlineCommentsEnabled:e.options.isGDPRInlineCommentsEnabled}),e.formatMessage)),e.model.isResolved()?e.$(".ic-comment-container").addClass("ic-resolved"):e.$(".ic-list").append(e.replyListView.render().el),e._renderNavigation(),e._renderLikes(),D.addSidebarHeadingTooltip(e),"true"===e.options.isUnifiedProfileCardsEnabled&&(me(e),Ce(e))}),this},_renderNavigation:function(){this.navigationView&&this.navigationView.remove(),this.navigationView=new _e({model:this.model,formatMessage:this.formatMessage}),this.navigationView.render(),this.$("#ic-nav-container").html(this.navigationView.el)},_renderLikes:function(){var e=this,t=this.el&&this.el.querySelector(".ic-action-like");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(function(i){i?(e.likesView&&e.likesView.remove(),e.likesView=new Le({contentId:e.model.id,containerId:e.model.get("containerId"),containerType:e.model.get("containerType"),el:t}).render()):t&&t.remove()}):t&&t.remove()},editComment:function(e){var t=this;(e.preventDefault(),this.editView)?this.editView.focusEditor():D.confirmProcess(this.formatMessage)&&D.getEditorFormat(this.model.get("id")).done(function(e){t.editView=new Re({model:t.model,type:"edit",selection:{},onFinished:t.renderCommentOnly,commentText:e,formatMessage:t.formatMessage,isGDPRInlineCommentsEnabled:t.options.isGDPRInlineCommentsEnabled,isUnifiedProfileCardsEnabled:t.options.isUnifiedProfileCardsEnabled}),t.$(".ic-display-comment").html(t.editView.$el),t.editView.render()}).fail(function(){h.a.trigger("ic:error",t.formatMessage({id:"inline.comments.server.error.edit.comment"}))})},renderCommentOnly:function(){this.editView&&this.editView.destroy(),this.editView=null;var e=u.a.extend(this.model.toJSON(),{darkFeatures:D.getDarkFeatures()});this.$(".ic-display-comment").html(o()(Y.comment(e,this.formatMessage)).children()),this._renderLikes()},replyComment:function(e){e&&e.preventDefault(),this.createReplyView?this.createReplyView.focusEditor():D.confirmProcess(this.formatMessage)?(this.createReplyView=new Re({formatMessage:this.formatMessage,model:this.model,type:"reply",isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,onFinished:u.a.bind(function(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null},this),isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled}),this.$(".ic-reply-container").prepend(this.createReplyView.$el),this.createReplyView.render()):e&&e.currentTarget.blur()},confirm:function(e){if(e.preventDefault(),this.model.replies.length>0)return h.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.with.reply"})),!1;var t=new Pe({formatMessage:this.formatMessage,model:new h.a.Model({label:this.formatMessage({id:"inline.comments.sidebar.delete"}),message:this.formatMessage({id:"inline.comments.delete.confirmation.message"})}),$menuEl:o()(".ic-action-menu"),$bodyEl:o()("body")});this.$(".ic-sidebar-heading").append(t.$el),this.listenTo(t,"ic:confirm",this.deleteComment)},deleteComment:function(){var e=this;this.model.destroy({wait:!0,success:function(){e.$el.html(Y.deleteComment(e.formatMessage)),e.model.set("deleted",!0),e._renderNavigation(),D.removeInlineLinksDialog(e.model.highlights),D.addSidebarHeadingTooltip(e),h.a.trigger("ic:delete")},error:this.deleteFail})},deleteFail:function(e,t){401===t.status?h.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.permission"})):409===t.status?h.a.trigger("ic:error",t.responseText):h.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},destroy:function(e){o()("body").off("click",".ic-action-delete a",this.confirm),o()("body").off("click",".ic-action-reply a",this.replyComment),o()("body").off("click",".ic-action-resolve a",this.resolveComment),o()("body").off("click",".ic-action-edit a",this.editComment),this.createReplyView&&this.createReplyView.destroy(),this.editView&&this.editView.destroy(),this.replyListView.destroy(),this.navigationView&&this.navigationView.remove(),this.likesView&&this.likesView.remove(),!0!==e&&this.remove()},resolveComment:function(e){e&&e.preventDefault(),D.confirmProcess(this.formatMessage,!0)&&this.model.resolve(!0,{wait:!0,success:u.a.bind(this.onResolveComplete,this),error:this.onResolveFail})},onResolveComplete:function(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null,h.a.trigger("ic:resolved"),D.removeInlineLinksDialog(this.model.highlights)},onResolveFail:function(e,t){401===t.status?h.a.trigger("ic:error",this.formatMessage({id:"inline.comments.resolve.permission"})):h.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},showResolvedDialogDiscovery:function(){h.a.trigger("ic:resolved:show:recovery")},onReplyPlaceholderFocus:function(e){D.getDarkFeatures().RICH_TEXT_EDITOR&&(-1!==navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&e.currentTarget.blur())}}),Ve=h.a.View.extend({tagName:"div",className:"ic-sidebar",events:{"click button.ic-action-hide":function(e){this.hide(e,!0),h.a.trigger("ic:sidebar:close")},"updateYPosition .ic-display-comment-view > .ic-comment-container":function(){this.setSidebarYPos()},"requestInlineCommentsClose .ic-display-comment-view > .ic-comment-container":function(e){var t,i=e.originalEvent.detail;if(null!=this.commentView)t=this.commentView.model.highlight;else{if(null==this.createCommentView)return;t=o()(".ic-current-selection")}i.parentElement.contains(t[0])&&(!1===this.hide(null,!0)?e.preventDefault():h.a.trigger("ic:sidebar:close"))}},initialize:function(e){e=e||{};var t=this;this.shouldSqueeze=e.shouldSqueeze,this.formatMessage=e.formatMessage,this.listenTo(h.a,"ic:view ic:overlap",this.displayComment),this.listenTo(h.a,"ic:create",this.displayCreateComment),this.listenTo(h.a,"ic:error",this.displayError),this.listenTo(h.a,"ic:hide-sidebar",this.hide),this.listenTo(h.a,"ic:clearError",this.clearError),D.getDarkFeatures().RICH_TEXT_EDITOR?s.a.bind("rte-quick-edit-ready".concat(".ic-sidebar"),function(){var e=t.$el.find("#wysiwygTextarea_ifr");0!==e.length?(new MutationObserver(function(){e.resize()}).observe(e[0],{attributes:!0,attributeFilter:["style"]}),s.a.Rte.getEditor().getContent()||t._scrollToEditorView(e)):t.$el.is(":visible")||(t.$wikiContent.css("position","static"),g.destroy())}):s.a.bind("init.rte".concat(".ic-sidebar"),u.a.bind(this.hideInEditMode,this)),this.defaultNavOffset=130,this.defaultPermalinkedCommentOffset=100,this.$wikiContent=e.$wikiContent||o()("[data-inline-comments-target=true]").first(),this.sidebarObserver=new MutationObserver(u.a.bind(this.setSidebarYPos,this)),this.sidebarObserver.observe(this.el,{childList:!0,subtree:!0}),o()(l.a).on("resize".concat(".ic-sidebar"),u.a.debounce(u.a.bind(this.setSidebarYPos,this),100)),s.a.bind("sidebar.expanded sidebar.collapsed".concat(".ic-sidebar"),u.a.debounce(u.a.bind(this.setSidebarYPos,this),50)),o()("#confluence-ui .wrapper-space-view-page").length>0&&this.$el.addClass("ic-is-spa-view-page")},destroy:function(){s.a.unbind(".ic-sidebar"),o()(l.a).off(".ic-sidebar"),this.hide(),this.remove()},displayComment:function(e,t,i){var n=function(){var n=this;if(!e.highlight.is(":hidden")||(D.showHighlightContent(e.highlight),!e.highlight.is(":hidden"))){this.distanceToTop=this.previousHighlightOffset||this.defaultNavOffset,this._emptySidebar(!0),this.commentView=new $e({formatMessage:this.formatMessage,model:e,source:t,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled}),this.show(!0);var o=e.highlight.offset().top-this.$wikiContent.offset().top;this.previousHighlightOffset=o;var a=this.commentView.render().$el;a.css("visibility","hidden"),"nav"===t?D.scrollToActiveHighlight(o,this.distanceToTop):"permalink"===t?D.scrollToActiveHighlight(o,this.defaultPermalinkedCommentOffset).done(function(){i&&i.isReplyComment&&n.commentView.replyComment()}):"quickreload"===t&&this._scrollToQuickReloadComment(e),this.$el.html(a),l.a.Confluence.Binder&&l.a.Confluence.Binder.userHover()}};void 0===i||!1===i.ignoreConfirmDialog?D.confirmProcess(this.formatMessage,!0)&&n.call(this):n.call(this),s.a.trigger("ic-jim-async-supported")},_scrollToQuickReloadComment:function(e){var t=o()(".qr-feedback:first"),i=this.defaultPermalinkedCommentOffset;t.length>0&&(i=t.height()+67);var n=e.highlight.position().top;D.scrollToActiveHighlight(n,i)},_scrollToEditorView:function(e){var t=o()("body, html"),i=this.$(".ic-display-comment-view").position().top,n=e.closest(".ic-create-comment-view").position().top+i;(t.height()<n||t.scrollTop()>n)&&t.animate({scrollTop:n},100)},displayCreateComment:function(e,t,i){var n=this.isOnUnsupportedMacro();this._emptySidebar(!0),this.createCommentView=new Re({formatMessage:this.formatMessage,collection:e,selection:t,type:n?"pageComment":"topLevel",isFocus:!1,stopFocus:!0,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,commentText:n?"<blockquote>".concat(o()("<div/>").text(t.text).html(),"</blockquote> <div/>"):"",onFinished:u.a.bind(function(){this.createCommentView.keepSidebar||this.isShowing&&this.hide()},this),serializedHighlights:i,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled}),this.show(),this.createCommentView.$el.css("visibility","hidden"),this.$el.html(this.createCommentView.$el),this.createCommentView.render()},isOnUnsupportedMacro:function(){var e=o()(".ic-current-selection");return D.containUnsupportedMacro(e)||D.containInternalLink(e)||D.containUserMetion(e)},displayError:function(e,t){t=u.a.extend({closeable:!0},t),this.clearError(),s.a.messages.warning(".ic-error",{body:e,closeable:t.closeable}),t.callback&&t.callback()},clearError:function(){o()(".ic-error").empty()},show:function(e){this.isShowing||(this._toggleSidebar(e),this.isShowing=!0)},hideInEditMode:function(e){"comment"!==s.a.Meta.get("content-type")&&(this.sidebarObserver.disconnect(),this.hide(e))},hide:function(e,t){var i=this;return e&&e.preventDefault(),!!D.confirmProcess(this.formatMessage,!0)&&(!this.isShowing||(this._toggleSidebar(t).done(function(){g.destroy(),h.a.trigger("ic:sidebar-hidden"),i.isShowing=!1}),!0))},_toggleSidebar:function(e){var t,i=o()(".inline-comment-marker.active:first, .ic-current-selection:first");i.length>0&&(t=D.getOffsetTopRelativeInWindowCoordinate(i));var n=o.a.Deferred(),a=n.promise();return this.isShowing?e&&D.isAnimationSupported()?a=D.animateSidebar(this,!1):(g.destroy(),this.$wikiContent.css("position","static"),this._emptySidebar(),n.resolve()):("true"===this.shouldSqueeze&&g.shrinkToShowSideBar(),e&&D.isAnimationSupported()?a=D.animateSidebar(this,!0):n.resolve(),this.$wikiContent.css("position","relative")),a.done(function(){D.scrollToCommentAfterToggleSideBar(t,i)}),a},_emptySidebar:function(e){this.commentView&&(this.commentView.model.unset&&this.commentView.model.unset("active"),this.commentView.destroy(),this.commentView=null),this.createCommentView&&(this.createCommentView.keepSidebar=e,this.createCommentView.destroy(),this.createCommentView=null)},setSidebarYPos:function(){if(this.isShowing){var e,t,i=this.$el.offset().top;if(null!=this.commentView)e=this.commentView.$el,t=this.commentView.model.highlight;else{if(null==this.createCommentView)return;e=this.createCommentView.$el,t=o()(".ic-current-selection")}if(t){var n=this.$(".ic-sidebar-heading").height();e.css({visibility:"visible",position:"absolute",top:"".concat(t.offset().top-i-n,"px")}),D.recalculateContentHeight(e)}}}}),Ue=i("KkZ4"),Fe=h.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:Y.comment,events:{"click .ic-action-unresolve":"unresolveComment","click .ic-action-show-reply":"showReply"},initialize:function(e){this.formatMessage=e.formatMessage,u.a.bindAll(this,"onUnresolveComplete","destroy"),this.replyListView=new He({formatMessage:this.formatMessage,commentModel:this.model}),this.listenTo(this.replyListView,"ic:reply-rendered",function(){this.renderNumberOfReplies()})},render:function(){var e=this.template(u.a.extend(this.model.toJSON(),{showMenu:!1,isDangling:this.model.isDangling(),darkFeatures:D.getDarkFeatures(),hasReply:this.model.replies.length>0}),this.formatMessage);return this.$el.html(e),this.likesView&&this.likesView.remove(),this.likesView=new Le({contentId:this.model.id,showLikeButton:!1}).render(),this.$(".ic-action-like").html(this.likesView.el),this.$el.append(this.replyListView.$el.hide()),this.replyListView.render(),this},unresolveComment:function(){h.a.trigger("ic:resolvedClearError"),this.model.resolve(!1,{wait:!0,success:this.onUnresolveComplete,error:this.onUnresolveFail})},onUnresolveComplete:function(){h.a.trigger("ic:unresolved"),this.$el.slideUp(this.destroy)},onUnresolveFail:function(e,t){401===t.status?h.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.resolve.permission"})):h.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.server.error"}))},showReply:function(){this.$(".ic-action-show-reply").parent().remove(),this.$(".ic-replies").slideDown()},renderNumberOfReplies:function(){var e,t=this.model.replies.length,i=this.$(".ic-action-show-reply");t>0?(e=1===t?this.formatMessage({id:"inline.comments.resolved.menu.show.reply"},{0:t}):this.formatMessage({id:"inline.comments.resolved.menu.show.replies"},{0:t}),i.text(e),i.parent().removeClass("hidden")):i.parent().remove()},destroy:function(){this.replyListView.destroy(),this.remove()}}),Ye=h.a.View.extend({events:{"click #resolved-dialog-close-button":"destroy"},template:Y.resolvedCommentDialog,initialize:function(e){this.formatMessage=e.formatMessage,u.a.bindAll(this,"render","destroy","_onKeyDown"),this._resolvedCommentViews=[],this.listenTo(this.collection,"change:resolveProperties",this.onResolvedChanged),this.listenTo(h.a,"ic:resolvedError",this.displayError),this.listenTo(h.a,"ic:resolvedClearError",this.clearErrors);var t=o()(this.template(null,this.formatMessage));this.setElement(t),this.dialog=s.a.dialog2(this.$el),o()(l.a.document).bind("keydown",this._onKeyDown),s.a.trigger("remove-bindings.keyboardshortcuts")},render:function(){Object(Ue.getAnalyticsWebClient)().then(function(e){e.sendTrackEvent({action:"opened",actionSubject:"dialog",attributes:{componentVersion:"v1"},source:"ResolvedInlineCommentsDialog"}).fire()});var e=o()("<div>"),t=this.collection.getResolvedCount();return 0!==t?u.a.each(this.collection.getResolvedCommentsDesc(),function(t){var i=new Fe({formatMessage:this.formatMessage,model:t});this._resolvedCommentViews.push(i),e.append(i.render().$el)},this):this.displayNoCommentMessage(),this.$(".aui-dialog2-content").append(e),this.dialog.show(),this.options.focusCommentId&&this.scrollToComment(this.options.focusCommentId),h.a.trigger("ic:resolved:view",t),s.a.trigger("ic-jim-async-supported"),this},onResolvedChanged:function(){0===this.collection.getResolvedCount()&&this.displayNoCommentMessage()},displayNoCommentMessage:function(){s.a.messages.generic(this.$(".aui-dialog2-content"),{body:this.formatMessage({id:"inline.comments.resolved.dialog.empty"}),closeable:!1})},displayError:function(e){this.clearErrors(),s.a.messages.warning(this.$("#ic-resolved-comment-dialog-error"),{body:e})},clearErrors:function(){this.$("#ic-resolved-comment-dialog-error").empty()},scrollToComment:function(e){var t=this.$(s.a.format("[data-comment-id={0}]",e));return t.length?(t.addClass("focused"),this.$(".aui-dialog2-content").animate({scrollTop:t.parent().position().top},100)):(new o.a.Deferred).reject()},_onKeyDown:function(e){this.$el&&this.$el.is(":visible")&&e.keyCode===s.a.keyCode.ESCAPE&&this.destroy()},destroy:function(){s.a.trigger("add-bindings.keyboardshortcuts"),o()(l.a.document).unbind("keydown",this._onKeyDown),this.dialog.hide(),this.dialog.remove(),u.a.each(this._resolvedCommentViews,function(e){e.destroy()}),this._resolvedCommentViews=null,this.remove()}}),Ge=h.a.Model.extend({}),Qe=h.a.Collection.extend({model:Ge,url:"".concat(s.a.contextPath(),"/rest/experimental/webfragment/panels?location=atl.page.content.footer.actions")}),Be=null,We={init:function(e,t){De=t,Be=e.commentCollection;var i=new Promise(function(t){D.getDarkFeatures().LIKES_ADMIN_TOGGLE?(e.webPanelCollection||(e.webPanelCollection=new Qe),e.webPanelCollection.fetch({cache:!1}).done(function(e){t(e.length>0)})):t(!0)});e.views.sidebar&&e.views.sidebar.destroy(),e.views.sidebar=new Ve({formatMessage:De,$wikiContent:o()("[data-inline-comments-target=true]").first(),shouldShowInlineCommentLikes:i,shouldSqueeze:e.shouldSqueeze,isUnifiedProfileCardsEnabled:e.isUnifiedProfileCardsEnabled,isGDPRInlineCommentsEnabled:e.isGDPRInlineCommentsEnabled}),g.$el.append(e.views.sidebar.$el),e.views.highlight&&e.views.highlight.destroy(),e.views.highlight=new G({collection:Be}),e.views.highlight.render()},loadSidebarOnClick:function(e){if(D.confirmProcess(De)){h.a.trigger("ic:highlight-panel-click"),o()(".inline-comment-marker,span[data-mark-type=confluenceInlineComment],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment]").removeClass("active");var t=D.overlappedSelection(e,Be);if(t){var i=o()('.inline-comment-marker[data-ref="'.concat(t.get("markerRef"),'"],')+'span[data-mark-type=confluenceInlineComment][data-reference="'.concat(t.get("markerRef"),'"],')+'span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="'.concat(t.get("markerRef"),'"]'));l.a.Confluence.HighlightAction.clearTextSelection(),t.highlight=i,h.a.trigger("ic:overlap",t)}else{var n=(new H).removeHighlight().highlight(e.range);h.a.trigger("ic:create",Be,e,n)}}},updateResolvedCommentCountInToolsMenu:function(){o()("#view-resolved-comments>span").text(De({id:"inline.comments.resolved.view.menu"})+s.a.format(" ({0})",Be.getResolvedCount()))},afterSyncCommentCollection:function(){var e=this;Be.once("sync",function(t){e.displayPermalinkedComment(t)}),Be.on("change:resolveProperties",function(){e.updateResolvedCommentCountInToolsMenu()}),this.updateResolvedCommentCountInToolsMenu()},displayPermalinkedComment:function(e){var t=l.a.location.search;D.showFocusedComment(e,t,Ye,De)},createResolvedCommentListView:function(){new Ye({formatMessage:De,collection:Be}).render()}},Ze=function(e){return We.init(e,xe),We};function Xe(){return qe.firstCaller&&(qe.firstCaller=!1,Ae&&Ae.isResolved()?Ze(qe):(Ae=o.a.Deferred()).resolve(Ze(qe))),qe.isSidebarLoaded=!1,Ae.promise()}var qe={firstCaller:!0,isSidebarLoaded:!1,commentCollection:null,webPanelCollection:null,shouldSqueeze:!1,views:{sidebar:null},init:function(e){e=e||{},qe.firstCaller=!0,qe.isSidebarLoaded=!1,qe.shouldSqueeze=e.shouldSqueeze,qe.isUnifiedProfileCardsEnabled=e.isUnifiedProfileCardsEnabled,qe.isGDPRInlineCommentsEnabled=e.isGDPRInlineCommentsEnabled,qe.commentCollection||(qe.commentCollection=new R),qe.commentCollection.reset(),g.setPageContentElByCSSSelector(e.pageContentCSSSelector),g.setPageHeaderElByCSSSelector(e.pageHeaderCSSSelector),qe.bindDOMEvents(),qe.fetch(),qe.bindQuickReloadEvents(),qe.bindAppEvents(),qe.focusOnComment(),qe.updateResolvedCount(),s.a.bind("ic.force-refetch",qe.fetch)},initAsync:function(){Xe().done(function(e){e.afterSyncCommentCollection(),e.displayPermalinkedComment(qe.commentCollection)})},destroy:function(){s.a.unbind(".ic-app"),g.destroy()},bindDOMEvents:function(){o()("body").off("click".concat(".ic-app"),"#view-resolved-comments").on("click".concat(".ic-app"),"#view-resolved-comments",function(e){e.preventDefault(),Xe().done(function(e){e.createResolvedCommentListView()})})},bindAppEvents:function(){var e="ic:resolved.".concat(".ic-app");h.a.listenTo(h.a,e,function(){qe.initAsync()})},fetch:function(){return qe.commentCollection.fetch({cache:!1}).done(function(){qe.commentCollection.getCommentsOnPageCount()>0&&qe.initAsync(),qe.commentCollection.getResolvedCount()>0&&Xe().done(function(e){e.updateResolvedCommentCountInToolsMenu()}),s.a.trigger("ic-fetch-completed",qe.commentCollection)})},focusOnComment:function(){-1!==l.a.location.search.indexOf("focusedCommentId")&&qe.initAsync()},bindQuickReloadEvents:function(){s.a.unbind("qr:show-new-thread".concat(".ic-app")).bind("qr:show-new-thread".concat(".ic-app"),function(e,t){Xe().done(function(){!function(e,t){var i=qe.commentCollection.get(t),n=!1;void 0===i&&(i=new S({id:t}),n=!0),i.fetch({success:function(e){e._setHighlights(e.get("markerRef")),n?qe.commentCollection.add(e):i.replies.isFetched=!1,h.a.trigger("ic:view",i,"quickreload")}})}(0,t)})}),s.a.unbind("qr:add-new-highlight".concat(".ic-app")).bind("qr:add-new-highlight",function(e,t,i){Xe().done(function(){s.a.trigger("qr:add-new-highlight-text",[t,i])})})},updateResolvedCount:function(){o()("#view-resolved-comments>span").text(xe({id:"inline.comments.resolved.view.menu"})+s.a.format(" ({0})",qe.commentCollection.getResolvedCount()))}};function Je(){o()(".tipsy").remove()}var Ke={init:function(e){xe=e.formatMessage,O.start(),Je(),qe.init(e),l.a.Confluence&&l.a.Confluence.HighlightAction&&l.a.Confluence.HighlightAction.registerButtonHandler("com.atlassian.confluence.plugins.confluence-inline-comments:create-inline-comment",{onClick:function(e){Xe().done(function(t){qe.isSidebarLoaded||(qe.isSidebarLoaded=!0,t.loadSidebarOnClick(e))})},shouldDisplay:l.a.Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY})},destroy:function(){Je(),qe.destroy()},notifyEditor:function(){h.a.trigger("ic:tinymce-resource-loaded")}},et=Object(r.d)("skate");if(!D.isSPAPage()){var tt=s.a.Meta.get("page-id"),it=s.a.Meta.get("latest-page-id");tt&&tt===it&&o()(Ke.init)}t.default=function(e){(function(e){return!(!__skate||!__skate.registry)&&void 0!==__skate.registry[e]})(D.getPageContentClassName())||et(D.getPageContentClassName(),{type:et.types.CLASS,attributes:{"data-content-id":{updated:function(e){this._init(e)}},"data-editor-resource-loaded":{updated:function(){Ke.notifyEditor()}}},attached:function(e){this._init(e)},detached:function(){Ke.destroy()},_init:function(t){var i=t.getAttribute("data-page-content-css-selector"),n=t.getAttribute("data-page-header-css-selector"),o=t.getAttribute("data-content-id"),a=t.getAttribute("data-should-squeeze"),s=t.getAttribute("data-unified-profile-cards"),r=t.getAttribute("data-gdpr-inline-comments");Ke.init({formatMessage:e,pageContentCSSSelector:i,pageHeaderCSSSelector:n,contentId:o,shouldSqueeze:a,isUnifiedProfileCardsEnabled:s,isGDPRInlineCommentsEnabled:r})}})}},mTU2:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i("L21V"),o=Object(n.f)({cancelButton:{id:"change-edition.general.button.cancel",defaultMessage:"Cancel",description:"Cancel button"},removeRestrictionButton:{id:"change-edition-notification-dialog.general.button.remove-restrictions",defaultMessage:"Remove restrictions",description:"Remove restrictions button"},removeRestrictionTitle:{id:"change-edition-notification-dialog.general.title.remove-restrictions",defaultMessage:"Remove page's restrictions?",description:"Remove restrictions title"},removeRestrictionText:{id:"change-edition-notification-dialog.general.text.remove-restrictions",defaultMessage:"You're on the free plan, so you can only <b>remove all restrictions</b> from the <b>{pageName}</b> page. <b>This can't be undone.</b> You won't be able to reset the restrictions later.",description:"Remove restrictions title"},tryItNowButton:{id:"change-edition-section-message.general.button.primary",defaultMessage:"Try it now",description:"A button that links to edition update page"},learnMoreButton:{id:"change-edition-section-message.general.button.link",defaultMessage:"Learn more",description:"A button that links to action description help page"},grantAllButton:{id:"change-edition-section-message.space-permissions.grandfathered.button.link",defaultMessage:"Grant all users permissions for this space",description:"Granting permissions button"},removeThisRestrictionButton:{id:"change-edition-section-message.content.grandfathered.button.link",defaultMessage:"Remove this page's restrictions",description:"Removing permissions button"},contentGrandfatheredText:{id:"change-edition-section-message.content.grandfathered.text",defaultMessage:"You're on the free plan, so you can't change the page restrictions. To set restrictions on pages, upgrade your plan.",description:"Warning message explaining why the form is not editable"},spacePermissionsFreeText:{id:"change-edition-section-message.space-permissions.free.text",defaultMessage:"You're on the free plan, so anyone who's logged in can view this space, add pages to it, and more. To set space permissions, upgrade your plan.",description:"Warning message explaining why the form is not editable"},spacePermissionsGrandfatheredText:{id:"change-edition-section-message.space-permissions.grandfathered.text",defaultMessage:"You're on the free plan, so you can't change the space permissions. To set permissions on spaces, upgrade your plan. If needed, you can grant all users permissions for this space. (Anonymous users won't be granted permissions.)",description:"Warning message explaining why the form is not editable"},spacePermissionsGrandfatheredNoclearText:{id:"change-edition-section-message.space-permissions.grandfathered.noclear.text",defaultMessage:"You're on the free plan, so you can't change the space permissions. To set permissions on spaces, upgrade your plan.",description:"Warning message explaining why the form is not editable"},spaceRestrictedPagesText:{id:"change-edition-section-message.space-restricted-pages.text",defaultMessage:"You're on the free plan, so you can only remove all restrictions from a page by clicking its lock icon below. To set restrictions on pages, upgrade your plan.",description:"Warning message explaining why the form is not editable"},adminSpaceText:{id:"change-edition-section-message.admin-space.text",defaultMessage:"You're on the free plan, so you can't set the default permissions for new spaces. Anyone who's logged in can view new spaces, add pages to them, and more. To set default space permissions, upgrade your plan.",description:"Warning message explaining why the form is not editable"},adminGlobalText:{id:"change-edition-section-message.admin-global.text",defaultMessage:"You're on the free plan, so you can't change these permissions. To set global permissions and define what people can do on your site, upgrade your plan.",description:"Warning message explaining why the form is not editable"}})},wRb9:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxOTcuNjQ3IDE4Ni44MTQiPjxkZWZzPjxzdHlsZT4uY2xzLTJ7ZmlsbDojZGUzNTBifS5jbHMtM3tmaWxsOiNmZjU2MzB9LmNscy00e2ZpbGw6I2RmZTFlNTttaXgtYmxlbmQtbW9kZTptdWx0aXBseX0uY2xzLTEwe2ZpbGw6IzI2ODRmZn08L3N0eWxlPjwvZGVmcz48ZyBzdHlsZT0iaXNvbGF0aW9uOmlzb2xhdGUiPjxnIGlkPSJMYXllcl8yIiBkYXRhLW5hbWU9IkxheWVyIDIiPjxnIGlkPSJPYmplY3RzIj48cGF0aCBjbGFzcz0iY2xzLTIiIGQ9Ik00Mi4wNjcgMGguNjEyYTggOCAwIDAgMSA4IDh2MTUuMjM0SDM0LjA2N1Y4YTggOCAwIDAgMSA4LTh6bTY2LjE1MyAwaC42MTFhOCA4IDAgMCAxIDggOHYxNS4yMzRIMTAwLjIyVjhhOCA4IDAgMCAxIDgtOHptNjYuMTUyIDBoLjYxMmE4IDggMCAwIDEgOCA4djE1LjIzNGgtMTYuNjEyVjhhOCA4IDAgMCAxIDgtOHpNMzQuMDY3IDIzLjIzNGgxNjMuNTh2MTYzLjU4SDM0LjA2N3oiLz48cGF0aCBjbGFzcz0iY2xzLTIiIGQ9Ik00Mi4wNjcgMEg1OS4yOWE4IDggMCAwIDEgOCA4djE1LjIyM0gzNC4wNjdWOGE4IDggMCAwIDEgOC04em02NS4xNzkgMGgxNy4yMjNhOCA4IDAgMCAxIDggOHYxNS4yMjNIOTkuMjQ2VjhhOCA4IDAgMCAxIDgtOHptNjUuMTc4IDBoMTcuMjIzYTggOCAwIDAgMSA4IDh2MTUuMjIzaC0zMy4yMjNWOGE4IDggMCAwIDEgOC04eiIvPjxwYXRoIGNsYXNzPSJjbHMtMyIgZD0iTTE3LjQ1NiAyMy4yMzRoMTYzLjU4djE2My41OEgxNy40NTZ6bTgtMjMuMjM0aDE3LjIyM2E4IDggMCAwIDEgOCA4djE1LjIyM0gxNy40NTZWOGE4IDggMCAwIDEgOC04em02NS4xNzggMGgxNy4yMjNhOCA4IDAgMCAxIDggOHYxNS4yMjNIODIuNjM0VjhhOCA4IDAgMCAxIDgtOHptNjUuMTc5IDBoMTcuMjIzYTggOCAwIDAgMSA4IDh2MTUuMjIzaC0zMy4yMjNWOGE4IDggMCAwIDEgOC04eiIvPjxwYXRoIGNsYXNzPSJjbHMtMyIgZD0iTTI1LjQ1NiAwaDE3LjIyM2E4IDggMCAwIDEgOCA4djE1LjIyM0gxNy40NTZWOGE4IDggMCAwIDEgOC04em02NS4xNzggMGgxNy4yMjNhOCA4IDAgMCAxIDggOHYxNS4yMjNIODIuNjM0VjhhOCA4IDAgMCAxIDgtOHptNjUuMTc5IDBoMTcuMjIzYTggOCAwIDAgMSA4IDh2MTUuMjIzaC0zMy4yMjNWOGE4IDggMCAwIDEgOC04eiIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTM1Ljc2IDU2LjgwNmgzMy4yMjNWNzIuNDFIMzUuNzZ6bTk1LjQ0MiA4MC4xNTZoMzMuMjIzdjE1LjYwNGgtMzMuMjIzeiIvPjxwYXRoIGNsYXNzPSJjbHMtNCIgZD0iTTU3LjM3IDcxLjYwNGg3MC43NWE5IDkgMCAwIDEgOSA5djM1LjM3NGE0NC4zNzUgNDQuMzc1IDAgMCAxLTQ0LjM3NCA0NC4zNzUgNDQuMzc1IDQ0LjM3NSAwIDAgMS00NC4zNzUtNDQuMzc1VjgwLjYwNWE5IDkgMCAwIDEgOS05eiIvPjxwYXRoIGQ9Ik02Ni4zNzEgNjYuNjYyaDcwLjc1YTkgOSAwIDAgMSA5IDl2MzUuMzc1YTQ0LjM3NSA0NC4zNzUgMCAwIDEtNDQuMzc1IDQ0LjM3NCA0NC4zNzUgNDQuMzc1IDAgMCAxLTQ0LjM3NS00NC4zNzRWNzUuNjYyYTkgOSAwIDAgMSA5LTl6IiBmaWxsPSIjZmFmYmZjIi8+PHBhdGggaWQ9Il9SZWN0YW5nbGVfIiBkYXRhLW5hbWU9IiZsdDtSZWN0YW5nbGUmZ3Q7IiBkPSJNNjEuMzcxIDY2LjY2Mmg3MC43NWE5IDkgMCAwIDEgOSA5djM1LjM3NWE0NC4zNzUgNDQuMzc1IDAgMCAxLTQ0LjM3NSA0NC4zNzQgNDQuMzc1IDQ0LjM3NSAwIDAgMS00NC4zNzUtNDQuMzc0Vjc1LjY2MmE5IDkgMCAwIDEgOS05eiIgZmlsbD0iI2ViZWNmMCIvPjxwYXRoIGQ9Ik05Ni43NDYgMTQ3Ljc0NGEzNi43NDkgMzYuNzQ5IDAgMCAxLTM2LjcwNy0zNi43MDdWNzguMDU4YTMuNzMzIDMuNzMzIDAgMCAxIDMuNzI5LTMuNzI5aDY1Ljk1NmEzLjczMyAzLjczMyAwIDAgMSAzLjcyOSAzLjczdjMyLjk3OGEzNi43NDkgMzYuNzQ5IDAgMCAxLTM2LjcwNyAzNi43MDd6IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDY1ZmYiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggY2xhc3M9ImNscy00IiBkPSJNMTAwLjY5IDE2My4zMTd2LTUyLjIyYTMuOTQ0IDMuOTQ0IDAgMCAwLTcuODkgMHY1Mi4yMmEyMi41MjUgMjIuNTI1IDAgMCAwLTE4LjU0NyAyMi4xNGMwIC40NTYuMDE4LjkwOC4wNDQgMS4zNTdoNy45MTNhMTQuNyAxNC43IDAgMCAxLS4wNjktMS4zNTcgMTQuNjIgMTQuNjIgMCAwIDEgMTQuNTk4LTE0LjYwNGguMDEyYTE0LjYyMSAxNC42MjEgMCAwIDEgMTQuNTk5IDE0LjYwNGMwIC40NTgtLjAyNy45MS0uMDY5IDEuMzU3aDcuOTEzYy4wMjctLjQ1LjA0NS0uOTAxLjA0NS0xLjM1N2EyMi41MjYgMjIuNTI2IDAgMCAwLTE4LjU1LTIyLjE0eiIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTE3LjQ1NiAzNi40N2gzMy4yMjN2MTUuNjA0SDE3LjQ1NnptMCAxMjEuNjUyaDMzLjIyM3YxNS42MDRIMTcuNDU2ek0xNDcuODEzIDM2LjQ3aDMzLjIyM3YxNS42MDRoLTMzLjIyM3ptMi4yNTEgMTIxLjA4MWgzMy4yMjN2MTUuNjA0aC0zMy4yMjN6Ii8+PHBhdGggaWQ9Il9QYXRoXyIgZGF0YS1uYW1lPSImbHQ7UGF0aCZndDsiIGQ9Ik0xMDcuNTI1IDEwMS4wMDNhMTEuNzggMTEuNzggMCAxIDAtMTkuODYgOC41NTUgNC4wNDIgNC4wNDIgMCAwIDEgMS4xODUgNC4wNjJsLTIuMTA0IDcuMjY4YTMgMyAwIDAgMCAyLjg4MiAzLjgzNGgxMi4yMzdhMyAzIDAgMCAwIDIuODgxLTMuODM0bC0yLjA5NS03LjI0YTQuMDc0IDQuMDc0IDAgMCAxIDEuMTgtNC4wOTQgMTEuNzE3IDExLjcxNyAwIDAgMCAzLjY5NC04LjU1MXoiIGZpbGw9IiM1ZTZjODQiLz48cGF0aCBkPSJNMTA0Ljc0NiAxMjAuODg4bC0yLjA5Ni03LjI0YTQuMDc0IDQuMDc0IDAgMCAxIDEuMTgxLTQuMDk1IDExLjc2MyAxMS43NjMgMCAwIDAtNS4wNi0xOS45MzEgMTEuOTEgMTEuOTEgMCAwIDAtOC43OTggMTAuOTk1IDExLjcxOSAxMS43MTkgMCAwIDAgMy42OTMgOC45NCA0LjA0MiA0LjA0MiAwIDAgMSAxLjE4NCA0LjA2M2wtMy4yMTQgMTEuMTAyaDEwLjIyOWEzIDMgMCAwIDAgMi44ODEtMy44MzR6IiBmaWxsPSIjMjUzODU4Ii8+PHBhdGggY2xhc3M9ImNscy0xMCIgZD0iTTgxLjc5NyAxMDAuMzFhMy45NDQgMy45NDQgMCAwIDAtMy45NDQtMy45NDRINDEuMDQyYTMuOTQ0IDMuOTQ0IDAgMCAwIDAgNy44ODhoMzYuODExYTMuOTQ0IDMuOTQ0IDAgMCAwIDMuOTQ1LTMuOTQ0eiIvPjxwYXRoIGlkPSJfUGF0aF8yIiBkYXRhLW5hbWU9IiZsdDtQYXRoJmd0OyIgZD0iTTQxLjA0MiAxMDQuMjU0aDU1LjgxMWEzLjk0NCAzLjk0NCAwIDAgMCAwLTcuODg5SDQxLjA0MmEzLjk0NCAzLjk0NCAwIDAgMCAwIDcuODg5eiIgZmlsbD0iIzAwNjVmZiIvPjxwYXRoIGNsYXNzPSJjbHMtMTAiIGQ9Ik04MS43OTcgMTAwLjMxYTMuOTQ0IDMuOTQ0IDAgMCAwLTMuOTQ0LTMuOTQ0SDQxLjA0MmEzLjk0NCAzLjk0NCAwIDAgMCAwIDcuODg4aDM2LjgxMWEzLjk0NCAzLjk0NCAwIDAgMCAzLjk0NS0zLjk0NHoiLz48cGF0aCBjbGFzcz0iY2xzLTEwIiBkPSJNMjIuNDkzIDEyMi44MDNhMjIuNDkzIDIyLjQ5MyAwIDEgMSAyMi40OTMtMjIuNDkzIDIyLjUxOCAyMi41MTggMCAwIDEtMjIuNDkzIDIyLjQ5M3ptMC0zNy4wOTdhMTQuNjA0IDE0LjYwNCAwIDEgMCAxNC42MDQgMTQuNjA0IDE0LjYyIDE0LjYyIDAgMCAwLTE0LjYwNC0xNC42MDR6Ii8+PC9nPjwvZz48L2c+PC9zdmc+"},wS3D:function(e,t){
/**
 * @license jQuery Text Highlighter
 * Copyright (C) 2011 - 2013 by mirz
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(e,t,i,n){var o={ELEMENT_NODE:1,TEXT_NODE:3},a={name:"textHighlighter"};function s(t,i){this.context=t,this.$context=e(t),this.options=e.extend({},e[a.name].defaults,i),this.init()}s.prototype={init:function(){this.$context.addClass(this.options.contextClass),this.bindEvents()},destroy:function(){this.unbindEvents(),this.$context.removeClass(this.options.contextClass),this.$context.removeData(a.name)},bindEvents:function(){},unbindEvents:function(){},highlightHandler:function(e){e.data.self.doHighlight()},doHighlight:function(t){var i=t||this.getCurrentRange();if(i&&!i.collapsed){var n=i.toString(),o="";if(1==this.options.onBeforeHighlight(i)){var a=e.textHighlighter.createWrapper(this.options),s=this.highlightRange(i,a);o=this.normalizeHighlights(s),this.options.onAfterHighlight(o,n)}return this.removeAllRanges(),o}},getCurrentRange:function(){var e,t=this.getCurrentSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e},removeAllRanges:function(){this.getCurrentSelection().removeAllRanges()},getCurrentSelection:function(){var t,i=this.getCurrentWindow();return i.getSelection?t=i.getSelection():e("iframe").length?e("iframe",top.document).each(function(){if(this.contentWindow===i)return t=rangy.getIframeSelection(this),!1}):t=rangy.getSelection(),t},getCurrentWindow:function(){var e=this.getCurrentDocument();return e.defaultView?e.defaultView:e.parentWindow},getCurrentDocument:function(){return this.context.ownerDocument?this.context.ownerDocument:this.context},highlightRange:function(t,i){if(!t.collapsed){var n=["SCRIPT","STYLE","SELECT","BUTTON","OBJECT","APPLET"],a=t.startContainer,s=t.endContainer,r=t.commonAncestorContainer,c=!0;if(0==t.endOffset){for(;!s.previousSibling&&s.parentNode!=r;)s=s.parentNode;s=s.previousSibling}else s.nodeType==o.TEXT_NODE?t.endOffset<s.nodeValue.length&&s.splitText(t.endOffset):t.endOffset>0&&(s=s.childNodes.item(t.endOffset-1));a.nodeType==o.TEXT_NODE?t.startOffset==a.nodeValue.length?c=!1:t.startOffset>0&&s==(a=a.splitText(t.startOffset)).previousSibling&&(s=a):a=t.startOffset<a.childNodes.length?a.childNodes.item(t.startOffset):a.nextSibling;var l=!1,d=a,u=[];do{if(c&&d.nodeType==o.TEXT_NODE){if(/\S/.test(d.nodeValue)){var m=i.clone(!0).get(0),h=d.parentNode;if(e.contains(this.context,h)||h===this.context){var g=e(d).wrap(m).parent().get(0);u.push(g)}}c=!1}d!=s||s.hasChildNodes()&&c||(l=!0),-1!=e.inArray(d.tagName,n)&&(c=!1),c&&d.hasChildNodes()?d=d.firstChild:null!=d.nextSibling?(d=d.nextSibling,c=!0):(d=d.parentNode,c=!1)}while(!l);return u}},normalizeHighlights:function(t){return this.flattenNestedHighlights(t),this.mergeSiblingHighlights(t),e.map(t,function(e){return void 0!==e.parentElement?null!=e.parentElement?e:null:null!=e.parentNode?e:null})},flattenNestedHighlights:function(t){var n=this;e.each(t,function(o){var a=e(this),s=a.parent(),r=s.prev(),c=s.next();if(n.isHighlight(s))if(s.css("background-color")!=a.css("background-color"))n.isHighlight(r)&&!a.get(0).previousSibling&&r.css("background-color")!=s.css("background-color")&&r.css("background-color")==a.css("background-color")&&a.insertAfter(r),n.isHighlight(c)&&!a.get(0).nextSibling&&c.css("background-color")!=s.css("background-color")&&c.css("background-color")==a.css("background-color")&&a.insertBefore(c),s.is(":empty")&&s.remove();else{var l=i.createTextNode(s.text());s.empty(),s.append(l),e(t[o]).remove()}})},mergeSiblingHighlights:function(t){var i=this;function n(t,n){return!(!n||n.nodeType!=o.ELEMENT_NODE||e(t).css("background-color")!=e(n).css("background-color")||!e(n).hasClass(i.options.highlightedClass))}e.each(t,function(){var t=this.previousSibling,i=this.nextSibling;if(n(this,t)){var o=e(t).text()+e(this).text();e(this).text(o),e(t).remove()}if(n(this,i)){o=e(this).text()+e(i).text();e(this).text(o),e(i).remove()}})},setColor:function(e){this.options.color=e},getColor:function(){return this.options.color},removeHighlights:function(t){var i=void 0!==t?t:this.context,n=this;this.getAllHighlights(i,!0).each(function(){if(1==n.options.onRemoveHighlight(this))(function(t){e(t).contents().unwrap().get(0)})(this)})},getAllHighlights:function(t,i){var n=".".concat(this.options.highlightedClass),o=e(t).find(n);return 1==i&&e(t).hasClass(this.options.highlightedClass)&&(o=o.add(t)),o},isHighlight:function(e){return e.hasClass(this.options.highlightedClass)},serializeHighlights:function(t){var i=t||this.getAllHighlights(this.context),n=this.context,a=[];return i.each(function(t,i){var s=0,r=i.firstChild.length,c=function(t,i){var n=[];do{var o=e.inArray(t,t.parentNode.childNodes);n.unshift(o),t=t.parentNode}while(t!==i);return n}(i,n);e(i).clone().empty().get(0).outerHTML;i.previousSibling&&i.previousSibling.nodeType===o.TEXT_NODE&&(s=i.previousSibling.length),a.push([e(i).text(),c.join(":"),s,r])}),JSON.stringify(a)},deserializeHighlights:function(t,i){try{var n=JSON.parse(t)}catch(e){throw new Error("Can't parse serialized highlights: ".concat(e))}var a=[],s=this,r=!0;return e.each(n,function(t,n){try{!function(t){for(var n=t[0],r=t[1].split(":"),c=t[2],l=t[3],d=r.pop(),u=null,m=s.context;void 0!==(u=r.shift());)m=m.childNodes[u];m.childNodes[d-1]&&m.childNodes[d-1].nodeType===o.TEXT_NODE&&(d-=1);var h=m.childNodes[d].splitText(c);if(h.splitText(l),h.nextSibling&&""==h.nextSibling.nodeValue&&h.parentNode.removeChild(h.nextSibling),h.previousSibling&&""==h.previousSibling.nodeValue&&h.parentNode.removeChild(h.previousSibling),n!==h.nodeValue)throw new Error("Different text");var g=e(h).wrap(i).parent().get(0);a.push(g)}(n)}catch(e){return console&&console.warn&&console.warn("Can't deserialize ".concat(t,"-th descriptor. Cause: ").concat(e)),r=!1,!0}}),r&&a}},e.fn.getHighlighter=function(){return this.data(a.name)},e.fn[a.name]=function(t){return this.each(function(){e.data(this,a.name)||e.data(this,a.name,new s(this,t))})},e.textHighlighter={createWrapper:function(t){return e("<span></span>").css("backgroundColor",t.color).addClass(t.highlightedClass)},defaults:{color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:function(){return!0},onBeforeHighlight:function(){return!0},onAfterHighlight:function(){}}}}(jQuery,window,document)}}]);
//# sourceMappingURL=inline-comments.a3960bfc2f754139ce8a-v38.js.map