<!DOCTYPE html>
<html class=""><head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
<meta name="renderer" content="webkit">
<title>10 个 Docker 镜像安全最佳实践 - DockOne.io</title>
<meta name="keywords" content="10,docker,镜像,安全,最佳,实践">
<meta name="description" content="10 个 Docker 镜像安全最佳实践 - 《Docker 镜像安全最佳实践速查表》列举了 10 个诀窍和指南，确保更安全和更高质量的 Docker 镜像处理。此外，还可以检视有关 Docker 安全的新报告《Docker 安全要趁早》。

	


1. 选用最小化基础镜像人们编写项目的 Docke...">
<meta property="qc:admins" content="460401166337656177">
<!-- base href="http://dockone.io/" --><!--[if IE]></base><![endif]-->
<link href="http://static.dockone.io/favicon.ico?t=20150328" rel="shortcut icon" type="image/x-icon">

<link rel="stylesheet" type="text/css" href="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/foot.css">

<link rel="stylesheet" type="text/css" href="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/bootstrap.css">
<link rel="stylesheet" type="text/css" href="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/icon.css">

<link href="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/common.css" rel="stylesheet" type="text/css">
<link href="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/link.css" rel="stylesheet" type="text/css">
<link href="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/style.css" rel="stylesheet" type="text/css">


<script type="text/javascript">
	var _68E3424F9F6CE3CBDBD20AF3F3070CCB="";
	var G_POST_HASH=_68E3424F9F6CE3CBDBD20AF3F3070CCB;
	var G_INDEX_SCRIPT = "";
	var G_SITE_NAME = "DockOne.io";
	var G_BASE_URL = "http://dockone.io";
	var G_STATIC_URL = "http://dockone.io/static";
	var G_UPLOAD_URL = "http://dockone.io/uploads";
	var G_USER_ID = "";
	var G_USER_NAME = "";
	var G_UPLOAD_ENABLE = "N";
	var G_UNREAD_NOTIFICATION = 0;
	var G_NOTIFICATION_INTERVAL = 100000;
	var G_CAN_CREATE_TOPIC = "";
	var G_REQUEST_URL = "/article/";

	</script>
<script src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/jquery.js" type="text/javascript"></script>
<script src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/jquery_002.js" type="text/javascript"></script>
<script src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/plug-in_module.js" type="text/javascript"></script>
<script src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/aws.js" type="text/javascript"></script>
<script src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/aw_template.js" type="text/javascript"></script>
<script src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/app.js" type="text/javascript"></script>
<script type="text/javascript" src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/compatibility.js"></script>
<!--[if lte IE 8]>
	<script type="text/javascript" src="http://dockone.io/static/js/respond.js"></script>
<![endif]-->
<style type="text/css">.fancybox-margin{margin-right:13px;}</style></head>
<body><noscript unselectable="on" id="noscript">
    <div class="aw-404 aw-404-wrap container">
        <img src="http://dockone.io/static/common/no-js.jpg">
        <p>你的浏览器禁用了JavaScript, 请开启后刷新浏览器获得更好的体验!</p>
    </div>
</noscript>


	<div class="aw-top-menu-wrap">
		<div class="container">
			<!-- logo -->
			<div class="aw-logo hidden-xs">
				<a href="http://dockone.io/"></a>
			</div>
			<!-- end logo -->
			<!-- 搜索框 -->
			<div class="aw-search-box  hidden-xs hidden-sm">
				<form class="navbar-search" action="http://dockone.io/search/" id="global_search_form" method="post">
					<input class="form-control search-query" type="text" placeholder="搜索问题、话题或人" autocomplete="off" name="q" id="aw-search-query">
					<span title="搜索" id="global_search_btns" onclick="$('#global_search_form').submit();"><i class="icon icon-search"></i></span>
					<div class="aw-dropdown">
						<div class="mod-body">
							<p class="title">输入关键字进行搜索</p>
							<ul class="aw-dropdown-list hide"></ul>
							<p class="search"><span>搜索:</span><a onclick="$('#global_search_form').submit();"></a></p>
						</div>
						<div class="mod-footer">
							<a href="http://dockone.io/publish" onclick="$('#header_publish').click();" class="pull-right btn btn-mini btn-success publish">发起问题</a>
						</div>
					</div>
				</form>
			</div>
			<!-- end 搜索框 -->
			<!-- 导航 -->
			<div class="aw-top-nav navbar">
				<div class="navbar-header">
			      <button class="navbar-toggle pull-left">
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			      </button>
			    </div>
				<nav role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
			      <ul class="nav navbar-nav">
			      	                    <li><a href="" class=""><i class="icon icon-ul"></i> 发现</a></li>

					<!-- <li><a href="http://dockone.io/question/" class="">问题</a></li>

					<li><a href="http://dockone.io/article/" class="active">文章</a></li> -->

					<li><a href="http://dockone.io/topic/"><i class="icon icon-topic"></i> 话题</a></li>
										<li><a href="http://dockone.io/help/"><i class="icon icon-bulb"></i> 帮助</a></li>			      </ul>
			    </nav>
			</div>
			<!-- end 导航 -->
			<!-- 用户栏 -->
			<div class="aw-user-nav">
				<!-- 登陆&注册栏 -->
									<a class="login btn btn-normal btn-primary" href="http://dockone.io/login/">登录</a>
					<a class="register btn btn-normal btn-success" href="http://dockone.io/account/register/">注册</a>								<!-- end 登陆&注册栏 -->
			</div>
			<!-- end 用户栏 -->
			<!-- 发起 -->
						<!-- end 发起 -->
		</div>
	</div>
	
<script type="text/javascript">
$(document).ready(function(){
$("#newClassImg").attr("src", "http://static.dockone.io/partner/banner.jpg?"+new Date().getTime());
  });
</script>
<div class="aw-container-wrap">
    <div class="container">
<br>
<a href="http://dockone.io/article/2626" target="_blank" style="display:block;margin:0 auto;margin-bottom:15px;margin-top:-40px;"><img id="newClassImg" src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/banner.jpg"></a>
        <div class="row">
            <div class="aw-content-wrap clearfix">
                <div class="col-sm-12 col-md-9 aw-main-content aw-article-content">
                    <div class="aw-mod aw-topic-bar" id="question_topic_editor" data-type="article" data-id="8828">
                        <div class="tag-bar clearfix">
                                                                                    <span class="topic-tag" data-id="7">
                                <a class="text" href="http://dockone.io/topic/Docker">Docker</a>
                            </span>
                                                        
                                                    </div>
                    </div>
                    <div class="aw-mod aw-question-detail">
                        <div class="mod-head">
                            <h1>
                                10 个 Docker 镜像安全最佳实践                            </h1>

                                                    </div>
                        <div class="mod-body">
                            <div class="content markitup-box">
                                <br>《<a href="https://res.cloudinary.com/snyk/image/upload/v1551798390/Docker_Image_Security_Best_Practices_.pdf">Docker 镜像安全最佳实践速查表</a>》列举了 10 个诀窍和指南，确保更安全和更高质量的 Docker 镜像处理。此外，还可以检视有关 Docker 安全的新报告《<a href="https://snyk.io/blog/shifting-docker-security-left/">Docker 安全要趁早</a>》。<br>
<div class="aw-upload-img-list active">
	<a href="http://dockone.io/uploads/article/20190502/dc5065c23c2ac6ac40ded2b165d1b2a6.png" target="_blank" data-fancybox-group="thumb" rel="lightbox"><img src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/dc5065c23c2ac6ac40ded2b165d1b2a6.png" class="img-polaroid" title="Docker-Image-Security-Best-Practices-.png" alt="Docker-Image-Security-Best-Practices-.png"></a>
</div>
<br>
<h3>1. 选用最小化基础镜像</h3>人们编写项目的 <code class="prettyprint">Dockerfile</code> 时，经常使用一个通用的 Docker 容器镜像作为基础，例如 <code class="prettyprint">From Node</code> 。 Node 镜像实际上是以一个完整安装的 Debian Stretch 发行版为基础，这意味着构建得到的项目容器镜像将包含一个完整的操作系统。如果该项目不需要任何通用的系统库或者系统工具应用，最好不要使用完整的操作系统作为基础镜像。<br>
<br>Synx 发布的《<a href="https://snyk.io/blog/top-ten-most-popular-docker-images-each-contain-at-least-30-vulnerabilities/">开源安全报告-2019</a>》指出，Docker Hub 上流行的很多容器镜像，都用到了包含大量已知安全漏洞的基础镜像。例如，执行 <code class="prettyprint">docker pull node</code> ，下载并使用 Node 镜像，相当于在应用中引入了一个包含 580 个已知漏洞的操作系统。<br>
<div class="aw-upload-img-list active">
	<a href="http://dockone.io/uploads/article/20190502/2f1549d32585389c04d96fec0eda2ad9.png" target="_blank" data-fancybox-group="thumb" rel="lightbox"><img src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/2f1549d32585389c04d96fec0eda2ad9.png" class="img-polaroid" title="Number_of_OS_vulnerabilities_by_docker_image.png" alt="Number_of_OS_vulnerabilities_by_docker_image.png"></a>
</div>
<br>
从上图（摘自《开源安全报告-2019》）可知，Docker Hub 上最流行的 10 个镜像都包含已知的安全漏洞。选用最小化基础镜像，即只包含项目确实需要的系统工具和库的镜像，就能最小化系统的攻击面，确保所用操作系统是安全的。<br>
<br><a href="https://snyk.io/container-vulnerability-management/">了解更多 Docker 镜像安全的知识。</a><br>
<h3>2. 设定最小权限的 USER</h3>如果 <code class="prettyprint">Dockerfile</code> 中没有指定 <code class="prettyprint">USER</code>
 ，Docker 默认将会以超级用户 root 的身份运行容器，容器所属的命名空间（namespace）因此映射为 root 
所有，这意味着容器有可能获取 Docker 宿主机的超级管理权限。不仅如此，以 root 
用户身份运行容器，还扩大了攻击面，如果容器应用中存在安全漏洞，很容易造成权限提升。<br>
<br>在实践中，一般不需要容器拥有 root 权限。为了尽量降低安全威胁，创建专门的用户和用户组，在 <code class="prettyprint">Dockerfile</code> 中使用 <code class="prettyprint">USER</code> 指定用户，确保以最小权限的用户身份运行容器应用。<br>
<br>如果基础镜像中不包含专门的用户，那么就在 <code class="prettyprint">Dockerfile</code> 中直接创建。下面就是一个这样的例子，它用到的基础镜像是 Ubuntu ：<br>
<pre class="prettyprint">FROM&nbsp;ubuntu<br>
RUN&nbsp;mkdir&nbsp;/app<br>
RUN&nbsp;groupadd&nbsp;-r&nbsp;lirantal&nbsp;&amp;&amp;&nbsp;useradd&nbsp;-r&nbsp;-s&nbsp;/bin/false&nbsp;-g&nbsp;lirantal&nbsp;lirantal<br>
WORKDIR&nbsp;/app<br>
COPY&nbsp;.&nbsp;/app<br>
RUN&nbsp;chown&nbsp;-R&nbsp;lirantal:lirantal&nbsp;/app<br>
USER&nbsp;lirantal<br>
CMD&nbsp;node&nbsp;index.js<br>
</pre><br>
在上例中：<br>
<ul><li>创建一个系统用户（ -r 选项），没有密码、没有主目录且没有 shell;</li><li>将该用户添加到前面（使用 <code class="prettyprint">groupadd</code> ）创建的用户组；</li><li>最后一段参数设定了用户名以及所属的用户组。</li></ul><br>
<br>如果你使用的是 Node.js 和 alpine 镜像，已经包含了一个用户 <code class="prettyprint">node</code>，直接使用即可：<br>
<pre class="prettyprint">FROM&nbsp;node:10-alpine&nbsp;<br>
RUN&nbsp;mkdir&nbsp;/app<br>
COPY&nbsp;.&nbsp;/app<br>
RUN&nbsp;chown&nbsp;-R&nbsp;node:node&nbsp;/app<br>
USER&nbsp;node<br>
CMD&nbsp;[“node”,&nbsp;“index.js”]<br>
</pre><br>
Node.js 应用开发者请参阅官方的<a href="https://github.com/nodejs/docker-node/blob/master/docs/BestPractices.md">Docker 和 Node.js 最佳实践</a>。<br>
<h3>3. 签名和校验镜像，防范中间人攻击</h3>Docker 
镜像的认证颇具挑战性。在生产环境使用这些镜像运行我们的代码，意味着我们对这些镜像的极大信任。因此，必须保证我们拉取的容器镜像确实是发布者发布的镜
像，没有被任何人篡改。发生镜像篡改，有可能是因为 Docker 
客户端和镜像中心之间的中间人攻击，或者是发布者的身份被人盗用并在镜像中心发布了恶意镜像。<br>
<h4>校验 Docker 镜像</h4>Docker 默认直接拉取容器镜像，不会校验镜像的来源和发布者。这意味着你有可能使用来源和发布者不明的任何镜像。<br>
<br>无论采用何种策略，最佳实践都是先校验容器镜像，通过验证后再拉取镜像。为了体验镜像校验功能，执行下列暂时开启 Docker Content Trust 的命令：<br>
<pre class="prettyprint">export&nbsp;DOCKER_CONTENT_TRUST=1<br>
</pre><br>
现在，尝试拉取一个没有签名的容器镜像——请求会被拒绝，不会拉取镜像。<br>
<h4>签名 Docker 镜像</h4>优先使用 <a href="https://hub.docker.com/search/?certification_status=certified&amp;type=image">Docker 认证</a>的镜像，即这些镜像来自经过 Docker Hub 检查和选择的可信提供者。不要使用无法检验来源和发布者的容器镜像。<br>
<br>Docker 支持镜像签名，提供了额外一层的保护。使用 <a href="https://docs.docker.com/notary/getting_started/">Docker Notary</a> 签名镜像。Notary 会检验镜像的签名，如果签名不合法，它会阻止运行该镜像。<br>
<br>如果开启了 Docker Content Trust ，构建 Docker 镜像的同时也会对镜像签名。如果是第一次签名，Docker 会为当前用户生成一个私钥，保存在 <code class="prettyprint">~/docker/trust</code> 。后续所有的镜像都会使用这个私钥签名。<br>
<br>请参考<a href="https://docs.docker.com/engine/security/trust/content_trust/">Docker 官方文档</a>，了解签名镜像的详细指令。<br>
<h3>4. 找出、修正和监控开源漏洞</h3>指定容器的基础镜像，同时也引入了该镜像包含的操作系统及系统库有可能存在的所有安全风险。<br>
<br>最好选用能够正常运行应用代码的最小化镜像，这有助于减少攻击面，因为限制了可能的安全漏洞数量。不过，这么做并没有对镜像进行安全审计，也不能防范将来发现的新漏洞。<br>
<br>因此，防范安全软件漏洞的一种方法是使用像 <a href="https://snyk.io/">Snyk</a> 这样的工具，持续扫描和监控 Docker 镜像各层可能存在的漏洞。<br>
<img src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/snyk-docker-scanning.gif" alt="Snyk Docker 扫描"><br>
使用下列命令扫描容器镜像，检查是否存在已知漏洞：<br>
<pre class="prettyprint">#&nbsp;fetch&nbsp;the&nbsp;image&nbsp;to&nbsp;be&nbsp;tested&nbsp;so&nbsp;it&nbsp;exists&nbsp;locally<br>
$&nbsp;docker&nbsp;pull&nbsp;node:10<br>
#&nbsp;scan&nbsp;the&nbsp;image&nbsp;with&nbsp;snyk<br>
$&nbsp;snyk&nbsp;test&nbsp;--docker&nbsp;node:10&nbsp;--file=path/to/Dockerfile<br>
</pre><br>
Snyk 能够监控指定的容器镜像，一旦有新发现的安全漏洞，通知用户并给出修补建议：<br>
<pre class="prettyprint">$&nbsp;snyk&nbsp;monitor&nbsp;--docker&nbsp;node:10<br>
</pre><br>
<br><blockquote><br>根据 Snyk 用户执行的镜像扫描，我们发现大约 40% 的 Docker 镜像包含已知漏洞，实际上弥补这些漏洞的新版本基础镜像已经有了。 Synx 提供了绝无仅有的修正建议功能，用户可以根据建议采取行动，升级 Docker 镜像。</blockquote>Snyk 还发现在扫描的所有镜像中，为了<a href="https://snyk.io/blog/top-ten-most-popular-docker-images-each-contain-at-least-30-vulnerabilities/">减少漏洞的数量</a>，大约 20% 的镜像需要重新构建。更多信息请参阅《开源安全报告-2019》。 <br>
<h3>5. 不要在容器镜像中包含机密信息</h3>有时候，构建包含应用的容器镜像时，需要用到一些机密信息，例如从私有仓库拉取代码所需的 SSH 私钥，或者安全私有软件包所需的令牌。如果 <code class="prettyprint">Dockerfile</code> 中包含复制机密信息的命令，构建镜像时，这行命令对应的中间容器会被缓存，导致机密数据也被缓存，有可能造成机密信息泄漏。因此，像令牌和密钥这样的机密信息必须保存在 <code class="prettyprint">Dockerfile</code> 之外。<br>
<h4>使用多阶段构建</h4>利用 Docker 的多阶段构建功能，用一个中间镜像层获取和管理机密信息，然后清除中间镜像，这样在应用镜像构建阶段不涉及敏感数据。如下面例子所示，使用代码将机密信息添加到中间层：<br>
<pre class="prettyprint">FROM:&nbsp;ubuntu&nbsp;as&nbsp;intermediate<br>
<br>
WORKDIR&nbsp;/app<br>
COPY&nbsp;secret/key&nbsp;/tmp/<br>
RUN&nbsp;scp&nbsp;-i&nbsp;/tmp/key&nbsp;build@acme/files&nbsp;.<br>
<br>
FROM&nbsp;ubuntu<br>
WORKDIR&nbsp;/app<br>
COPY&nbsp;--from&nbsp;intermediate&nbsp;/app&nbsp;.<br>
</pre><br>
<h4>使用 Docker 的 secret 管理功能</h4>使用 Docker 的 secret 管理功能（alpha 阶段），加载敏感信息文件且不会缓存这些信息：<br>
<pre class="prettyprint">#&nbsp;syntax&nbsp;=&nbsp;docker/dockerfile:1.0-experimental<br>
FROM&nbsp;alpine<br>
<br>
#&nbsp;shows&nbsp;secret&nbsp;from&nbsp;default&nbsp;secret&nbsp;location<br>
RUN&nbsp;--mount=type=secret,id=mysecret&nbsp;cat&nbsp;/run/secrets/mysecre<br>
<br>
#&nbsp;shows&nbsp;secret&nbsp;from&nbsp;custom&nbsp;secret&nbsp;location<br>
RUN&nbsp;--mount=type=secret,id=mysecret,dst=/foobar&nbsp;cat&nbsp;/foobar<br>
</pre><br>
想了解有关 Docker secret 的更多信息，请访问 Docker 官方站点。<br>
<h4>避免无意中复制机密信息</h4>往镜像中复制文件时，也要当心，避免无意中添加了机密信息。例如，下面的命令将整个构建上下文文件夹复制到 Docker 镜像，有可能把敏感文件也复制进去了：<br>
<pre class="prettyprint">COPY&nbsp;.&nbsp;.<br>
</pre><br>
如果文件夹中有敏感文件，要么先移除这些文件，要么将这些文件包含在 <code class="prettyprint">.dockerignore</code> 中，复制时会忽略这些文件：<br>
<pre class="prettyprint">private.key<br>
appsettings.json<br>
</pre><br>
<h3>6. 设定镜像的标签，保证镜像的不可更改性</h3>每个 Docker 镜像可以有多个标签（tag），代表该镜像的不同变体。最常见的标签是 <em>latest</em> ，表示这是该镜像的最新版本。镜像标签是可更改的，也就是说镜像的作者可以多次发布相同标签的镜像。<br>
<br>因此，即使你的 <code class="prettyprint">Dockerfile</code> 明确指定了使用的基础镜像及其标签，这次镜像构建和下次镜像构建仍然可能用到了不同的基础镜像。解决这个问题，有多种办法：<br>
<ul><li>优先选用最详细的镜像标签。例如，镜像有 <em>:8</em>、<em>:8.0.1</em> 和 <em>:8.0.1-alpine</em> 等标签，选择最后这个，因为它提供了最详细的信息。不要使用像 <em>latest</em> 这样过于泛泛的标签。</li><li>记
住，镜像的发布者有可能删除镜像的某个标签。如果设定了所用镜像的标签，一旦这个标签被删除，镜像构建会因为找不到基础镜像而失败。为了避免这个问题，可
以提前把该镜像复制到私有镜像中心或者公有镜像中心的私人账户下面。这么做，保证了镜像的不可更改性，同时也带来了维护私有镜像中心的负担。</li><li>使用比签名更具体的 SHA256 引用指明要使用的镜像，这能保证每次拉取都是相同内容的镜像。这么做也有风险，如果镜像改变了，以前的 SHA256 引用（散列值）也不存在了。</li></ul><br>
<br><h3>7. 使用 COPY ，不要使用 ADD</h3><strong>译者警告：这部分对 ADD 和 COPY 的描述，与 <a href="https://docs.docker.com/engine/reference/builder/#add">Docker 官方文档</a>并不吻合，译者按照自己的理解修改了这部分内容。如果要了解作者原意，请阅读<a href="https://snyk.io/blog/10-docker-image-security-best-practices/">英文原文</a>。</strong><br>
<br>从宿主机复制文件到容器镜像中的 Docker 命令有两个：<code class="prettyprint">COPY</code> 和 <code class="prettyprint">ADD</code> ，这两个命令本质上很相似，但具体功能并不相同：<br>
<ul><li>COPY - 将本地文件或者目录（递归）复制到容器镜像中的目标目录，复制来源和目标都必须明确指定。</li><li>ADD - 与 COPY 类似的功能，有两个不同：（1）如果复制来源是本地压缩文件，ADD 将把该文件解压缩到目标目录；（2）ADD 也可以将远程 URL 指定的文件下载到目标目录。</li></ul><br>
<br>为了避免可能导致的安全问题，请记住 <code class="prettyprint">COPY</code> 和 <code class="prettyprint">ADD</code> 的不同：<br>
<ul><li>使用 ADD 从远程 URL 下载文件，存在中间人攻击的风险，文件内容有可能因此被篡改。必须确保远程 URL 必须是安全的 TLS 链接，校验远程 URL 的来源和身份。<strong>译者注：实际上，官方文档并不鼓励使用 ADD 添加远程文件。</strong></li><li><br>如果复制的是本地压缩文件， ADD 自动将它解压缩到目标目录，这有可能触发 zip 炸弹或者 <a href="https://snyk.io/research/zip-slip-vulnerability">zip 任意文件覆盖</a> 漏洞。</li><li><br>相比较而言，使用 COPY 复制文件或目录，会创建一个缓存的中间镜像层，优化镜像构建的速度。 </li></ul><br>
<br><h3>8. 使用 LABEL 指定镜像元数据</h3>镜像元数据有助于用户更好地理解和使用该镜像。最常见的元数据是 <code class="prettyprint">maintainer</code> ，它说明了镜像维护者的电邮地址和名字。使用 <code class="prettyprint">LABEL</code> 命令添加镜像的元数据：<br>
<pre class="prettyprint">LABEL&nbsp;maintainer="me@acme.com"<br>
</pre><br>
除了镜像的维护者信息，添加其他你认为重要的元数据，包括提交对象的散列值、相关构建的链接、质量状态（通过所有测试了吗？）、源代码链接、SECURITY.TXT 文件的位置等。<br>
<br><a href="https://securitytxt.org/">SECURITY.TXT</a> (RFC5785) 文件说明了镜像维护者的安全披露政策。最好在镜像元数据中加上 SECURITY.TXT 的链接，例如：<br>
<pre class="prettyprint">LABEL&nbsp;securitytxt="https://www.example.com/.well-known/security.txt"<br>
</pre><br>
<br>想了解镜像元数据的更多信息，请访问 <a href="https://label-schema.org/rc1/" rel="nofollow" target="_blank">https://label-schema.org/rc1/</a> 。<br>
<br><strong>译者注：这个规范好像已经废止了，请直接访问 <a href="https://github.com/opencontainers/image-spec">OCI 镜像规范</a></strong>。<br>
<h3>9. 使用多阶段构建小而安全的镜像</h3>使用 <code class="prettyprint">Dockerfile</code> 构建应用容器镜像时，会生成很多只是构建时需要的镜像层，包括编译时所需的开发工具和库，运行单元测试所需的依赖、临时文件、机密信息等等。<br>
<br>如果保留这些镜像层，不仅会增加镜像的大小，影响镜像下载速度，而且会因为安装更多软件包而面临更大的攻击危险。这对用到的镜像也是成立的——需要使用一个专门构建应用的镜像，但不会用它来运行应用代码。<br>
<br>Go 语言就是一个很好的例子。构建一个 Go 应用需要用到 Go 编译器。编译得到的 Go 应用能够在任何操作系统上直接运行，没有任何依赖，包括 scratch 镜像。<br>
<br>Docker 因此提供了多阶段构建的功能，允许在构建过程中使用多个临时镜像，只保留最后一个镜像。这样，用户得到两个镜像：<br>
<ul><li>第一个镜像——非常大的镜像，包含了构建应用和运行测试所需的所有依赖；</li><li>第二个镜像——非常小的镜像，只包含运行应用所需的极少数依赖。</li></ul><br>
<br><h3>10. 使用静态分析工具</h3>使用静态分析工具，能够避免常见的错误，建立工程师自动遵循的最佳实践指南。<br>
<br>例如，<a href="https://github.com/hadolint/hadolint">hadolint</a> 分析 Dockerfile 并列出不符合最佳实践规则的地方。<br>
<div class="aw-upload-img-list active">
	<a href="http://dockone.io/uploads/article/20190502/595c1d0ccbf0b6a132475e4d4c092546.png" target="_blank" data-fancybox-group="thumb" rel="lightbox"><img src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/595c1d0ccbf0b6a132475e4d4c092546.png" class="img-polaroid" title="hadolint-docker-image-security.png" alt="hadolint-docker-image-security.png"></a>
</div>
<br>
在集成开发环境（IDE）中使用 hadolint 更好。例如，安装 <a href="https://marketplace.visualstudio.com/items?itemName=exiasr.hadolint">VS Code 的 hadolint 扩展</a>后，编写 Dockerfile 时，边写边检查，既快又好。<br>
<br><a href="https://snyk.io/container-vulnerability-management/">了解更多 Docker 镜像安全的知识。</a><br>
<br>把速查表打印出来，贴在某处，时刻提醒自己构建容器镜像时应该遵循的最佳安全实践！<br>
<br><strong>原文链接：<a href="https://snyk.io/blog/10-docker-image-security-best-practices/">10 Docker Image Security Best Practices</a> （译者：柳泉波）</strong>
                                                                <div class="aw-upload-img-list">
                                                                        
                                                                        
                                                                        
                                        </div>
                                
                                                                <ul class="aw-upload-file-list">
                                                                        
                                                                        
                                                                        
                                                                    </ul>
                                                            </div>
                            <div class="meta clearfix">
                                <div class="aw-article-vote pull-left disabled">
                                    <a href="javascript:;" class="agree" onclick=""><i class="icon icon-agree"></i> <b>0</b></a>
                                                                    </div>

                                <span class="pull-right  more-operate">
                                    
                                    
                                    <a class="text-color-999 dropdown-toggle" data-toggle="dropdown">
                                        <i class="icon icon-share"></i> 分享                                    </a>
                                    <div aria-labelledby="dropdownMenu" role="menu" class="aw-dropdown shareout pull-right">
                                        <ul class="aw-dropdown-list">
                                            <li><a onclick="AWS.User.share_out('tsina');"><i class="icon icon-weibo"></i> 微博</a></li>
                                            <li><a onclick="AWS.User.share_out('qzone');"><i class="icon icon-qzone"></i> QZONE</a></li>
                                            <li><a onclick="AWS.User.share_out('weixin');"><i class="icon icon-wechat"></i> 微信</a></li>
                                        </ul>
                                    </div>

                                    <em class="text-color-999">2019-05-02</em>
                                </span>
                            </div>
                        </div>
                        <div class="mod-footer">
                                                    </div>
                    </div>

                    <!-- 文章评论 -->
                    <div class="aw-mod">
                        <div class="mod-head common-head">
                            <h2>0 个评论</h2>
                        </div>

                        <div class="mod-body aw-feed-list">
                                                    </div>

                        
                                            </div>
                    <!-- end 文章评论 -->

                    <!-- 回复编辑器 -->
                    <div class="aw-mod aw-article-replay-box">
                        <a name="answer_form"></a>
                                                <p align="center">要回复文章请先<a href="http://dockone.io/login/">登录</a>或<a href="http://dockone.io/account/register/">注册</a></p>
                                            </div>
                    <!-- end 回复编辑器 -->
                </div>
                <!-- 侧边栏 -->
                <div class="col-sm-12 col-md-3 aw-side-bar hidden-sm hidden-xs">
                    <!-- 发起人 -->
                                        <div class="aw-mod user-detail">
                        <div class="mod-head">
                            <h3>发起人</h3>
                        </div>
                        <div class="mod-body">
                            <dl>
                                <dt class="pull-left aw-border-radius-5">
                                    <a href="http://dockone.io/people/bnuhero"><img alt="bnuhero" src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/09_avatar_mid.jpg"></a>
                                </dt>
                                <dd class="pull-left">
                                    <a class="aw-user-name" href="http://dockone.io/people/bnuhero" data-id="409">bnuhero</a>
                                    
                                                                        <p>读书喝茶踢球写程序</p>
                                </dd>
                            </dl>
                        </div>
                        <div class="mod-footer clearfix">
                                                        <div class="aw-topic-bar">
                                <div class="topic-bar clearfix">
                                    <span class="pull-left text-color-999">
                                        擅长话题 : &nbsp;
                                    </span>
                                                                        <span class="topic-tag">
                                        <a href="http://dockone.io/topic/Docker" class="text" data-id="7">Docker</a>
                                    </span>
                                                                        <span class="topic-tag">
                                        <a href="http://dockone.io/topic/Mesos" class="text" data-id="66">Mesos</a>
                                    </span>
                                                                        <span class="topic-tag">
                                        <a href="http://dockone.io/topic/Marathon" class="text" data-id="126">Marathon</a>
                                    </span>
                                                                        <span class="topic-tag">
                                        <a href="http://dockone.io/topic/Aurora" class="text" data-id="213">Aurora</a>
                                    </span>
                                                                        <span class="topic-tag">
                                        <a href="http://dockone.io/topic/%E5%AE%B9%E5%99%A8" class="text" data-id="149">容器</a>
                                    </span>
                                                                    </div>
                            </div>
                                                    </div>
                    </div>
                                        <!-- end 发起人 -->

                                        <!-- 推荐内容 -->
                    <div class="aw-mod">
                        <div class="mod-head">
                            <h3>推荐内容</h3>
                        </div>
                        <div class="mod-body">
                            <ul>
                                                                <li>
                                                                        <a href="http://dockone.io/article/8824">Docker Hub 回应数据泄露事件</a>
                                                                    </li>
                                                                <li>
                                                                        <a href="http://dockone.io/article/8808">房多多容器化和容器云实践</a>
                                                                    </li>
                                                                <li>
                                                                        <a href="http://dockone.io/article/8788">什么的容器？Docker 工作原理及容器化简易指南</a>
                                                                    </li>
                                                                <li>
                                                                        <a href="http://dockone.io/article/8780">DockOne微信分享（二零七）：瓜子云平台的实践经验</a>
                                                                    </li>
                                                                <li>
                                                                        <a href="http://dockone.io/article/8768">再见Docker！感谢所有人！</a>
                                                                    </li>
                                                                <li>
                                                                        <a href="http://dockone.io/article/8748">容器化 Go 开发环境的尝试</a>
                                                                    </li>
                                                                <li>
                                                                        <a href="http://dockone.io/article/8744">Docker镜像瘦身与优化</a>
                                                                    </li>
                                                                <li>
                                                                        <a href="http://dockone.io/article/8718">DockOne微信分享（二零五）：基于OVN的Kubernetes网络架构解析 </a>
                                                                    </li>
                                                                <li>
                                                                        <a href="http://dockone.io/article/8710">从技术演变的角度看互联网后台架构</a>
                                                                    </li>
                                                            </ul>
                        </div>
                    </div>
                    <!-- end 推荐内容 -->
                    
                                        <!-- 相关问题 -->
                    <div class="aw-mod aw-text-align-justify question-related-list">
                        <div class="mod-head">
                            <h3>相关问题</h3>
                        </div>
                        <div class="mod-body">
                            <ul>
                                                                <li><a href="http://dockone.io/question/151">Docker如何为企业产生价值？</a></li>
                                                                <li><a href="http://dockone.io/question/341">大家对国内的Docker meetup活动组织有什么建议和想法？比如希望在哪些城市举办？希望听到什么样的话题？</a></li>
                                                                <li><a href="http://dockone.io/question/24">请教下代码放在Docker里面还是外面呢</a></li>
                                                                <li><a href="http://dockone.io/question/10">如何学习Docker</a></li>
                                                                <li><a href="http://dockone.io/question/408">Docker container 到底应该翻译成什么？容器？集装箱？</a></li>
                                                                <li><a href="http://dockone.io/question/160">Machine、Swarm、Compose、SocketPlane这些Docker生态圈软件各解决了哪些问题？</a></li>
                                                                <li><a href="http://dockone.io/question/430">国内有哪些Docker大牛？</a></li>
                                                                <li><a href="http://dockone.io/question/574">docker书籍</a></li>
                                                                <li><a href="http://dockone.io/question/199">Docker容器使用--net=host的方式启动的，怎么用ssh去连接容器</a></li>
                                                                <li><a href="http://dockone.io/question/6">Container内不需要OS，为何需要OS的基础镜像？</a></li>
                                                                <li><a href="http://dockone.io/question/362">Docker 运行的容器时间不对，怎么解决!</a></li>
                                                            </ul>
                        </div>
                    </div>
                    <!-- end 相关问题 -->
                                    </div>
                <!-- end 侧边栏 -->
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    ANSWER_EDIT_TIME = 30;

    $(document).ready(function () {
        if ($('.aw-article-vote.disabled').length)
        {
            $('.aw-article-vote.disabled a').attr('onclick', '');
        }

        AWS.at_user_lists('#wmd-input');

        AWS.Init.init_article_comment_box($('.aw-article-comment'));
    });
</script>

	
<footer class="footer">
  <div class="subscribe-email row1 text-center">
    <h3>DockOne.io，专业的Cloud Native技术交流平台</h3>
    <p>关注Cloud Native相关的产品以及开源项目</p>
      </div>
  <div class="row1">
    <div class="copyright">
      <p> 2019 <strong>DockOne</strong>. All Rights Reserved.</p>
      <p class="">DockOne，新圈子，新思路，新视野。</p>
<p class="zz">本网站服务器由<a href="http://www.ucloud.cn/?utm_source=zanzhu&amp;utm_campaign=DokerOne&amp;utm_medium=display">UCloud云服务</a>提供。</p>
    </div>

    <div class="footer-follow">
      <ul class="cf">
        <li><a class="icons-weibo" href="http://weibo.com/dockerone" title="Weibo" target="_blank">Weibo</a></li>
        <li style="position:relative"><a class="icons-twitter" onmouseover="mousemethod('block','img1')" onmouseout="mousemethod('none','img1')" title="Wechat" target="_blank" style="cursor:pointer;">Wechat</a><img src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/wechat.jpg" style="position:absolute; top:37px; left:-32px; display:none;" id="img1" width="100"></li>
<li><a class="icons-weekly" href="http://weekly.dockone.io/" title="周报" target="_blank">周报</a></li>
 <li><a class="icons-rss" href="http://dockone.io/feed" title="Feed" target="_blank">Feed</a></li>
      </ul>
    </div>
    <script>
	function mousemethod(op,imgid){
	document.getElementById(imgid).style.display=op;
	}
</script>
  </div>

</footer>


<a class="aw-back-top hidden-xs" href="javascript:;" onclick="$.scrollTo(1, 600, {queue:true});" style="display: none;"><i class="icon icon-up"></i></a>

<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F1f6d1a718ac6b6eb3902c92775fb128e' type='text/javascript'%3E%3C/script%3E"));
</script><script src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/h.js" type="text/javascript"></script>

<!-- DO NOT REMOVE -->
<div id="aw-ajax-box" class="aw-ajax-box"></div>
<div style="display:none;" id="__crond"><img src="10%20%E4%B8%AA%20Docker%20%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%20-%20DockOne.io_files/1556815298.html" width="1" height="1"></div>

<!-- Escape time: 0.12609195709229 --><!-- / DO NOT REMOVE -->



</body></html>