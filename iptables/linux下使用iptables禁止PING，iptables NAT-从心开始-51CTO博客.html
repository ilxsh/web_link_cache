<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="favicon" rel="shortcut icon" href="https://blog.51cto.com/favicon.ico">
        <title>linux下使用iptables禁止PING，iptables NAT-从心开始-51CTO博客</title>
    <meta name="keywords" content="nginx">
<meta name="description" content="http://www.cnblogs.com/gao241/p/3522143.htmlecho “1″ &amp;gt; /proc/sys/net/ipv4/icmp_echo_ignore_all这下是别人不能ping你，你也不能ping别人将其值改为1后为禁止PING将其值改为0后为解除禁止PING其实使用iptable最简单iptables -A INPUT -p icmp –icmp-type">    <link href="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/header.css" rel="stylesheet"><link href="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/other.css" rel="stylesheet"><link href="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/right.css" rel="stylesheet"><link href="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/blog_details.css" rel="stylesheet"><link href="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/highlight.css" rel="stylesheet">
    <script type="text/javascript" async="" src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/vds.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/push.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/hm.js"></script><script>
        var HOME_URL = 'https://home.51cto.com/';
    </script>
    <script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/jquery_002.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/cookie.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/login.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/common.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/mbox.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/follow.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/vip.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/window.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/share.js"></script><style></style><link rel="stylesheet" href="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/share_style0_16.css"></head>
<body>
<img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/share_default.jpg" style="width:0; height:0; position:absolute;" border="0">
<style type="text/css">
	.service-btn{
		width: 53px;
height: 36px;
color: #1ac6fe;
line-height: 16px;
padding-top: 50px;
		display: inline-block;
		background: url(https://s1.51cto.com/images/blog/201811/02/463350acf4c693cfb3dc248bc8a2a0eb.png) no-repeat center;
	}
	.service-btn:hover{
		background: url(https://s1.51cto.com/images/blog/201811/02/2d5fa2ff4eb9ef66847aff20ba4c8bae.png) no-repeat center;
height: 36px;
color: #fff;
line-height: 16px;
padding-top: 50px;
	}
</style>
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
<![endif]-->
<div id="topbanner14" style="position: relative;width:100%;height:40px;background:url(https://s1.51cto.com/images/blog/201905/29/489c3eaa7a5cd2d47a468e69665b5772.jpg)">
<a class="close fl" href="javascript:;" style="position:absolute;width:13px;height:13px;top:0px;z-index: 20;background: url('https://s1.51cto.com/images/blog/201808/23/0363c65f527ea7c9880ab5f275303d1a.png') 0 0 no-repeat;background-size: 100% 100%;left: 50%;margin-left: 587px;"></a>
<a href="https://blog.51cto.com/cloumn/composedetail?id=9&amp;banner" target="_blank">
  <img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/42bd8bef0cd70d00b64970cadf526e69.jpg" alt="" style="position:absolute;width:1200px;height:40px;margin-left: -600px;left:50%;z-index: 10;">
</a>
</div>
<script>
    $("#topbanner14").on("click",".close",function(){
        $("#topbanner14").remove();
    })
</script>
<div class="Header">
  <div class="Page ">
    <h1 class="Logo"><a href="https://blog.51cto.com/">Logo</a></h1>
    <ul class="Navigates fl">
      <li><a href="https://blog.51cto.com/">首页</a></li>
      <li><a href="https://blog.51cto.com/original">文章</a></li>
      <li><a href="https://blog.51cto.com/blog/follow">关注</a></li>
      <li class="">
        <a class="column-stress" href="https://blog.51cto.com/cloumn/index" target="_blank">订阅专栏</a>
      </li>
                    
                  </ul>
    <ul class="Navigates Navigates-right fr">
      <li class="more maps">
        <a href="javascript:void(0);">网站导航</a>
        <div>
            <a href="https://edu.51cto.com/" target="_blank">学院</a>
            <a href="https://blog.51cto.com/" target="_blank">博客</a>
            <a href="http://down.51cto.com/" target="_blank">下载</a>
            <a href="https://home.51cto.com/" target="_blank">家园</a>
            <a href="http://bbs.51cto.com/" target="_blank">论坛</a>
            <a href="http://x.51cto.com/" target="_blank">CTO训练营</a>
            <!--a href=" http://club.51cto.com?blog" target="_blank">CTO俱乐部</a-->
            <a href="http://wot.51cto.com/" target="_blank">WOT</a>
            <a href="http://www.51cto.com/" target="_blank">51CTO</a>
            <i class="arrow"></i>
        </div>
      </li>
                <li><a href="https://blog.51cto.com/site/login?reback=https%3A%2F%2Fblog.51cto.com%2Fhao360%2F1381408&amp;logintype=reg" target="_self">注册</a></li>
          <li class="login"><a href="https://blog.51cto.com/site/login?reback=https%3A%2F%2Fblog.51cto.com%2Fhao360%2F1381408" target="_self">登录</a></li>
                        <li class="mRead">
          <a href="javascript:;">手机阅读</a>
          <div>
            <img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/blog_qr.png">
            <p>扫一扫体验手机阅读</p>
            <i class="arrow"></i>
          </div>
        </li>
            <li class="search"><a href="https://blog.51cto.com/search/index" target="_self">搜索</a></li>
                  <li class="write"><a href="javascript:;" onclick="Login()">写文章</a></li>
                  </ul>

          <div class="clear"></div>
  </div>
</div>
<script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/box.js"></script> 
<script>
    var isLogin = '0';
    var userId = '';
    var imgpath = 'https://s1.51cto.com/';
    var BLOG_URL = 'https://blog.51cto.com/';
    var msg_num_url = '/index/ajax-msg-num';
    $('.msg-follow, .msg-follow-max').eq(1).css({top: '91px'});
    $('.msg-follow, .msg-follow-max').eq(2).css({top: '121px'});
    setTimeout(function(){
            $.ajax({
                url:msg_num_url,
                type:"get",
                dataType:'json',
                success:function(res){
                    if(res.status == '0'){
                       //
                       var hasNewMsg = false;
                       if(res.data.msgNum > 0 && !$('#myMsg i').hasClass('dot')){
                            $('#myMsg i').addClass('dot');
                            hasNewMsg = true;
                       }
                       if(res.data.notifyNum > 0 && !$('#myNotify i').hasClass('dot')){
                           $('#myNotify i').addClass('dot');
                           hasNewMsg = true;
                       }
                       if(res.data.recommend_new > 0 && !$('#myRecommend i').hasClass('dot')){
                           $('#myRecommend i').addClass('dot');
                           hasNewMsg = true;
                       }
                       if(hasNewMsg && !$('#myAllMsg i').hasClass('dot')){
                           $('#myAllMsg i').addClass('dot');
                       }
                    }

                }
            });
    },70);
    //广告图
$(function(){
     new AutoAD({
      ADD:$('<a href="https://blog.51cto.com/cloumn/index?pc" class="closeMB" target="_blank" styel="display:block;"><img src="https://s1.51cto.com/images/blog/201906/03/27fe7ce575d70b6f068cb4217e18ef45.jpg"></a><a class="closeMB" style="position: absolute;right:2px;top: 3px;width: 50px;height: 40px;cursor: pointer;" href="javascript:;"></a>'),
      W:500,
      H:400,
      cookie:'blog_activity_blog72',
      mask:"#000",
      ts:'21600',
      noCBtn: true
    }) 
})    
</script>
 <script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/entrance.js" id="zhichiScript" class="zhiCustomBtn" data-args="manual=true"></script>
<a href="javascript:;" class="zhiCustomBtn" style="position: fixed;z-index: 2147483583;width: 60px;height: 6px;text-align: center;bottom:275px;right:0px;">
<span class="service-btn">在线<br>客服</span>
</a>

<script type="text/javascript">
var zhiManager = (getzhiSDKInstance());
zhiManager.on("load", function() {
    zhiManager.initBtnDOM();
});
//zhiManager.set('title','垃圾/广告信息举报');
zhiManager.set('powered',false);
zhiManager.set('color', '4285f4');
zhiManager.set('customBtn', 'true');
zhiManager.set('moduleType',2);
zhiManager.set('size',{'width':360,'height':500});

zhiManager.set('userinfo', {partnerId:'',uname:'',params:'{"用户名":""}'});
zhiManager.set('customMargin', 20);
zhiManager.set('horizontal', 20);
zhiManager.set('vertical', 90);
zhiManager.set('preVisitArgs',{'preVisitUrl': document.referrer?document.referrer:''});
zhiManager.set('curVisitArgs',{'curVisitUrl': location.href,curVisitTitle:document.title,});
</script>
<div class="Content-box" style="min-height: 1204px;">
      <link rel="stylesheet" href="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/mdeShow.css">
  <link rel="stylesheet" href="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/prism.css">
  <script type="text/javascript" charset="utf-8" src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/prism.js"></script>
<link rel="stylesheet" href="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/tinyscrollbar.css">
<script type="text/javascript" src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/jquery.js"></script>
<div class="Content Index" style="padding-bottom: 50px;">
	<div class="Page M764">
		<!-- left start -->
		<div class="artical-Left-blog">
			<div class="status">
	        					<a class="tab_name reprint">转载</a>
							</div>
			<h1 class="artical-title">linux下使用iptables禁止PING，iptables NAT</h1>
			<div class="artical-title-list">
				<div class="is-vip-bg-6 fl">
					<a href="https://blog.51cto.com/hao360" class="a-img" target="_blank"><img class="is-vip-img is-vip-img-4" data-uid="5820068" src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/wKioL1LNGtPRQT4HAAAZ-xV-2YE148_middle.jpg"></a>
				</div>
				<a href="https://blog.51cto.com/hao360" class="name fl" target="_blank" style="margin-right:0;">linux_python</a>
									                	                    <a id="checkFollow1_5820068" class="checkFollow-btn on fl" style="margin-left:8px;">关注</a>
	                	            				<a class="comment comment-num fr"><font class="comment_number">0</font>人评论</a>
				<span class="fr"></span>
				<a href="javascript:;" class="read fr">13918人阅读</a>
				<a href="javascript:;" class="time fr">2014-03-22 11:19:06</a>
				<div class="clear"></div>
			</div>
							<div class="artical-content-bak main-content editor-side-new">
          <div class="con editor-preview-side" id="result"><p style="background-color:#ffffff;border:0px;padding:0px;vertical-align:baseline;color:#333333;font-family:georgia, 'bitstream charter', serif;line-height:24px;margin-top:0px;margin-bottom:24px;"><a href="http://www.cnblogs.com/gao241/p/3522143.html" style="font-family: tahoma, helvetica, arial; font-size: 14px; line-height: 21px; white-space: normal; color: rgb(66, 133, 244);" target="_blank">http://www.cnblogs.com/gao241/p/3522143.html</a></p><p style="background-color:#ffffff;border:0px;padding:0px;vertical-align:baseline;color:#333333;font-family:georgia, 'bitstream charter', serif;line-height:24px;margin-top:0px;margin-bottom:24px;">echo “1″ &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all<br>这下是别人不能ping你，你也不能ping别人<br>将其值改为1后为禁止PING<br>将其值改为0后为解除禁止PING<br>其实使用iptable最简单<br>iptables -A INPUT -p icmp –icmp-type 8 -s 0/0 -j DROP<br>iptables -A INPUT -p icmp –icmp-type 0 -s 0/0 -j ACCEPT<br>iptables -A OUTPUT -p icmp –icmp-type 0 -s 192.168.29.1 -j DROP</p><p style="background-color:#ffffff;border:0px;padding:0px;vertical-align:baseline;color:#333333;font-family:georgia, 'bitstream charter', serif;line-height:24px;margin-top:0px;margin-bottom:24px;">iptables -A OUTPUT -p icmp –icmp-type 8 -s 192.168.29.1 -j ACCEPT</p><p><br></p><p style="padding:0px 0px 15px;color:#555555;font-family:'宋体', 'arial narrow', arial, serif;font-size:14px;line-height:28px;background-color:#ffffff;margin-top:0px;margin-bottom:0px;"><span style="color:#333333;font-family:'lucida grande', verdana, lucida, helvetica, arial, simsun, sans-serif;line-height:21px;">如何让别人ping不到自己，而自己又能ping别人,问题其实很简单，用如下脚本</span></p><p style="padding:0px 0px 15px;color:#555555;font-family:'宋体', 'arial narrow', arial, serif;font-size:14px;line-height:28px;background-color:#ffffff;margin-top:0px;margin-bottom:0px;">#/bin/bash<br>iptables -F<br>iptables -F -t nat<br>iptables -X<br>iptables -P INPUT DROP<br>iptables -P OUTPUT DROP<br>iptables -P FORWARD DROP<br><br>iptables -A INPUT -i lo -j ACCEPT<br>iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT<br>iptables -A INPUT -p tcp -m multiport --dport 80,22 -j ACCEPT<br>iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT<br><br>iptables -A OUTPUT -o lo -j ACCEPT<br>iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT<br>iptables -A OUTPUT -p tcp -m multiport --sport 80,22 -j ACCEPT<br>iptables -A OUTPUT -p icmp --icmp-type 8 -j ACCEPT</p><p style="padding:0px 0px 15px;color:#555555;font-family:'宋体', 'arial narrow', arial, serif;font-size:14px;line-height:28px;background-color:#ffffff;margin-top:0px;margin-bottom:0px;"><br></p><p style="padding:0px 0px 15px;color:#555555;font-family:'宋体', 'arial narrow', arial, serif;font-size:14px;line-height:28px;background-color:#ffffff;margin-top:0px;margin-bottom:0px;"><span style="font-family:'trebuchet ms', trebuchet, 'lucida sans unicode', 'lucida grande', 'lucida sans', arial, 'microsoft yahei', verdana, sans-serif;font-size:22px;line-height:32px;">iptables应用之禁ping和防ddos向外发包</span><br></p><p style="padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;">主要讲2个基本的实际应用，主要涉及到禁ping（ipv4）以及禁止udp，即禁止有黑客利用服务器向外发包ddos攻击方面的内容。</p><p style="padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;">一、如果没有iptables禁止ping</p><p><span class="content" style="margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;"><code class="functions" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">echo</code><code class="plain" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">1 &amp;</code><code class="keyword" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">gt</code><code class="plain" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">; /proc/sys/net/ipv4/icmp_echo_igore_all </code><code class="comments" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">#开启</code></span></p><p><span class="content" style="margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;"><code class="functions" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">echo</code><code class="plain" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">0 &amp;</code><code class="keyword" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">gt</code><code class="plain" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">; /proc/sys/net/ipv4/icmp_echo_igore_all </code><code class="comments" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">#关闭</code></span></p><p style="padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;">二、利用iptables规则禁ping</p><p><span class="content" style="margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;"><code class="plain" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">iptables -A INPUT -p icmp --icmp-</code><code class="functions" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">type</code><code class="plain" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">8 -s 0/0 -j DROP</code></span></p><p style="padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;">三、利用iptables规则，禁止服务器向外发包，防止DDOS向外攻击</p><p><span class="content" style="margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;"><code class="plain" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">iptables -I OUTPUT -p udp --dport 53 -d 8.8.8.8 -j ACCEPT </code><code class="comments" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">#允许UDP服务IP</code></span></p><p><span class="content" style="margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;"><code class="plain" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">iptables -A OUTPUT -p udp -j DROP </code><code class="comments" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">#禁止udp服务</code></span></p><p style="padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;">上述53端口和8888是DNS服务必须有的，如果不清楚本机的DNS设置，可执行以下命令得到IP：</p><p><span class="content" style="margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;"><code class="functions" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">cat</code><code class="plain" style="height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;">/etc/resolv.conf</code></span></p><p><br></p><p><br></p><h2 class="title content-title" style="margin:0px 0px 10px;padding:0px;font-size:20px;font-family:tahoma, helvetica, 'microsoft yahei', arial;color:rgb(58,58,58);font-weight:normal;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(255,0,0);background-color:rgb(0,0,0);">关于PREROUTING链和POSTROUTING链简单关系</span></h2><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);">源地址发送数据--&gt;&nbsp;{PREROUTING--&gt;路由规则--&gt;POSTROUTING}&nbsp;--&gt;目的地址接收到数据</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">PREROUTING：在进行路由判断之前所要进行的规则(DNAT/REDIRECT)</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">POSTROUTING：在进行路由判断之后所要进行的规则(SNAT/MASQUERADE)</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">源地址转换必须在POSTROUTING链上做。</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">目标地址转换必须在PREROUTING链上做。</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">下面我们来实现源地址的功能：我们假设这样一种场景：</p><p><img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/508999_1299549890zjyg.png" alt="wps_clip_p_w_picpath-31021" style="cursor: pointer;"></p><p><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);">192.168.0.254
是工作在外网的一台WEB服务器，中间的那台是企业里的NAT服务器，我们在上面添加iptables的规则，使其实现地址转换的功能，PC机是工作在企
业内部。我们的最终目的是192.168.80.30这台计算机通过NAT服务器可以访问到192.168.0.254的WEB服务。</span></p><p><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">为PC机设置网关：</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">[root@station39 ~]# route add default gw 192.168.80.129</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">下面开始来配置NAT服务器：</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">首先要开启NAT服务器的内核路由功能：</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">[root@server27 ~]# echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p><p><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">设置规则：</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">[root@server27 ~]# iptables -t nat -A POSTROUTING -s 192.168.80.0/24 -d 192.168.0.0/24 -j SNAT --to-source 192.168.0.127</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">[root@server27 ~]# iptables -t nat -L -n</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);">我们用192.168.80.130这台主机访问一下192.168.0.254的web服务，发现可以了！</span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">PS：如果我们使用路由功能来访问254这台主机的话，WEB服务器的访问日志将记录的访问地址是192.168.80.130，而如果我们使用地址转换的功能来访问的话，访问日志记录的访问地址则是192.168.0.127。.</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">一般我们上网的时候，所获得的IP都是动态的，怎么办？</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">做源地址转换的时候，还有一个小功能MASQUERADE（地址伪装），使用这个功能，我们不需要</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">指定目标地址，它会自动探测能够上互联网的地址，并自动将内网地址转换过来。缺陷：比较耗费资源。</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><br></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);">实现目标地址转换功能：</span></span><br></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/508999_1299549893RjY9.png" alt="wps_clip_p_w_picpath-1256" style="cursor: pointer;"></span></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);">场景：假设192.168.80网段为一个提供WEB服务的网站的内网，中间的为网站的NAT服务器，远端的客户端192.168.0.26想通过中间的NAT服务器来访问内部的192.168.80.130提供的WEB服务，这里就要用到目标地址转换了。</span></span></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"></span></span></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">设置192.168.80.130的网关：</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">[root@station39 ~]# route add default gw 192.168.80.129</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">开始在NAT服务器上设置规则：</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">这里依然要打开内核的路由功能</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);">[root@server27 ~]# echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">开始写规则：</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">[root@server27
 ~]# iptables -t nat -A PREROUTING -s 192.168.0.0/24 -d 192.168.0.127 -p
 tcp --dport 80 -j DNAT --to-destination 192.168.80.130</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">[root@server27 ~]# iptables -t nat -L -n</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);">规则已经写好了，我们使用192.168.0.26来访问一下192.168.0.127试试，已经可以访问了，其实提供WEB服务的是192.168..80.130这台主机，这就是目标地址转换的功能。</span></span><br></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);">我们再查看一下192.168.80.130这台WEB服务器的访问日志：</span></span></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><span style="color:rgb(44,44,44);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);"><img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/508999_1299549895v8S4.png" alt="wps_clip_p_w_picpath-24338" style="cursor: pointer;"></span></span></span></p><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);">结：最要紧的是我们要记住PREROUTING是数据从网卡流入“路由规则”之前的动作，POSTROUTING是数据从网卡流出“路由规则”之后的动作！</span></p><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);"><br></span></p><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);"><br></span></p><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);"><span style="color:rgb(85,85,85);font-family:'宋体';font-size:20px;font-weight:bold;line-height:20px;text-align:center;background-color:rgb(255,255,255);">iptables NAT</span></span></p><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);"><span style="color:rgb(85,85,85);font-family:'宋体';font-size:20px;font-weight:bold;line-height:20px;text-align:center;background-color:rgb(255,255,255);"></span></span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体', SimSun;">源地址转换SNAT&nbsp;</span></strong><span style="padding:0px;margin:0px;font-family:'宋体', SimSun;">Source NAT:就是普通路由器实现代理上网的功能。</span></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><a href="https://s3.51cto.com/wyfs02/M01/47/06/wKiom1P1o0zRko_mAADEu46M4gg338.jpg" style="padding: 0px; margin: 0px; color: rgb(66, 133, 244); text-decoration: none;" target="_blank"><img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/wKiom1P1o0zRko_mAADEu46M4gg338.jpg" title="SNAT" alt="wKiom1P1o0zRko_mAADEu46M4gg338.jpg" style="padding: 0px; margin: 0px; vertical-align: top; border: medium none; cursor: pointer;"></a></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">192.168.10.0/24
网段内计算机网关都指向192.168.10.1，S1通过eth1与互联网相连，PC1的数据报文发往S1时就把源IP改为12.34.56.78，这
样出去到互联网的报文才能够回来，回来后S1会把目标地址改为PC1的IP。S1的内核会维护一个地址转换表，自动修改相应源和目的地址。</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;"></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">包出去的时候修改源IP所以工作在<strong style="padding:0px;margin:0px;">POSTROUING</strong>链上</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">iptables -t nat -A POSTROUTING -s 192.168.10.0/24 -j SNAT --to-source 12.34.56.78</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;"></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">当使用<strong style="padding:0px;margin:0px;">ADSL</strong>通过DHCP获得公网IP时，需要用到MASQUERADE（地址伪装），可以自动把source IP改为当时获取到的。</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">iptables -t nat -A POSTROUTING -s 192.16.10.0/24 -j&nbsp;<strong style="padding:0px;margin:0px;">MASQUERADE</strong></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;"></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><strong style="padding:0px;margin:0px;">DNAT 目标地址转换：</strong></p><ul class="list-paddingleft-2" style="padding:0px 0px 0px 20px;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><li><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;">适用于没有足够的公网IP而对外提供服务场景，相当于端口映射</p></li><li><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;">也可以起到保护真实主机的作用</p></li></ul><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;"></p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">所有请求12.34.56.78web服务都转发给后端192.168.10.10的8080端口</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">iptables -t nat -A&nbsp;<strong style="padding:0px;margin:0px;">PREROUTING</strong>&nbsp;-d 12.34.56.78 -p tcp --dport 80 -j DNAT --to-destination 192.168.10.10:8080</p><p style="padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'宋体', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);">数据报文一进来未路由之前就要决定转发给谁，所以工作在PREROUTING链上</p><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);"><span style="color:rgb(85,85,85);font-family:'宋体';font-size:20px;font-weight:bold;line-height:20px;text-align:center;background-color:rgb(255,255,255);"><br></span></span></p><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);"><br></span></p><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);"><span style="background-color:rgb(0,0,0);color:rgb(255,0,0);"><strong><span style="background-color:rgb(0,0,0);font-family:tahoma, helvetica, arial;font-size:18px;line-height:21px;">iptables端口映射</span></strong></span></p><div class="code-toolbar"><pre class="brush:bash;toolbar:false  language-bash"><code class="  language-bash"><span class="token comment"># 内网通过有外网IP的机器映射端口</span>
<span class="token keyword">echo</span> 1 <span class="token operator">&gt;</span> /proc/sys/net/ipv4/ip_forward       <span class="token comment"># 在内核里打开ip转发功能</span>
route add -net 10.10.20.0 netmask 255.255.255.0 gw 10.10.20.111     <span class="token comment"># 内网需要添加默认网关，并且网关开启转发</span>
iptables -t nat -A PREROUTING -d 192.168.10.158  -p tcp --dport 9999 -j DNAT --to 10.10.20.55:22
iptables -t nat -nL                <span class="token comment"># 查看转发</span>

iptables -t nat -A PREROUTING -d 地址1 -p tcp -m tcp --dport 80 -j DNAT --to-destination 地址2:81
iptables -t nat -A POSTROUTING -s 192.168.0.0/255.255.0.0 -d 192.168.0.2 -p tcp -m tcp --dport 8180 -j SNAT --to-source 192.168.0.1
本机80端口定向到81端口
iptables -t nat -A OUTPUT -s 127.0.0.1 -p tcp --dport 80 -j DNAT --to-dest 127.0.0.1:81
将访问219.239.11.22端口8080的请求转发到192.168.0.21端口80上：
iptables -t nat -A PREROUTING -d 219.239.11.22 -p tcp -m tcp --dport 8080 -j DNAT --to-destination 192.168.0.21:80
iptables -t nat -A POSTROUTING -d 192.168.0.21 -p tcp -m tcp --dport 80 -j SNAT --to-source 192.168.0.29</code></pre><div class="toolbar"></div></div><p><br></p><p><br></p><p><br></p><h1 style="padding:15px 0px 5px;margin:0px;font-size:1.6em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(25,52,65);white-space:normal;" align="center"><span style="color:rgb(255,0,0);background-color:rgb(0,0,0);">linux iptable 使用指南</span></h1><p><span style="font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;background-color:rgb(252,255,245);">linux系统中,防火墙(Firewall),网址转换(NAT),数据包(package)记录,流量统计,这些功能是由Netfilter子系统所提供的，而iptables是控制Netfilter的工具.</span><span style="font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;background-color:rgb(252,255,245);">iptables将许多复杂的规则组织成成容易控制的方式，以便管理员可以进行分组测试，或关闭、启动某组规则。</span></p><p></p><h1 style="padding:15px 0px 5px;margin:0px;font-size:1.6em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(25,52,65);white-space:normal;">1. 术语解释</h1><ul style="padding:0px;margin:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;" class="list-paddingleft-2"><li><p><strong style="padding:0px;margin:0px;">DNAT</strong></p></li><li><p>Destination
 Network Address Translation 目标网络地址转换。 
DNAT是一种改变数据包目的ip地址的技术，经常和SNAT联用，以使多台服务器共享一个ip地址连入Internet，并且继续服务。通过对同一个
ip地址分配不同端口，来决定数据的流向。</p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;"><br></p></li><li><p><strong style="padding:0px;margin:0px;">SNAT</strong></p></li><li><p>Source Network Address Translation源网络地址转换。这是一种改变数据包源ip地址的技术， 经常用来使多台计算机分享一个Internet地址。这只在IPv4中使用，因为IPv4的地址已快用完了，IPv6将解 决这个问题。</p></li></ul><p><br></p><br><h1 style="padding:15px 0px 5px;margin:0px;font-size:1.6em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(25,52,65);white-space:normal;">2. iptable 概述</h1><h2 style="padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;">2.1. iptable的链和表结构</h2><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;"><img src="http://www.51know.info/system_security/iptable/ip_flow.PNG" alt="ip_flow.PNG" class="magnify" style="padding: 0px; margin: 0px; border: medium none; cursor: pointer;" border="0" align="middle"></p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;">如上图可以看出，iptable总体结构.</p><h2 style="padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;">2.2. 5个链(chain)</h2><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;"><img src="http://www.51know.info/system_security/iptable/iptable_chain.png" alt="iptable_chain.png" class="magnify" style="padding: 0px; margin: 0px; border: medium none; cursor: pointer;" border="0" align="middle"></p><ul style="padding:0px;margin:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;" class="list-paddingleft-2"><li><p><strong style="padding:0px;margin:0px;">PREROUTING</strong></p></li><li><p>在数据包进入防火墙之后、路由判断之前对数据包进行修改</p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;"><br></p></li><li><p><strong style="padding:0px;margin:0px;">INPUT</strong></p></li><li><p>在数据包被路由到本地之后，但在用户空间程序看到它之前对数据包进行修改</p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;"><br></p></li><li><p><strong style="padding:0px;margin:0px;">OUTPUT</strong></p></li><li><p>用户空间程序处理数据包后，由本地发出，再次被路由之前更改数据包</p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;"><br></p></li><li><p><strong style="padding:0px;margin:0px;">FORWARD</strong></p></li><li><p>在最初的路由判断之后、最后一次更改包的源地址之前对数据包进行修改</p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;"><br></p></li><li><p><strong style="padding:0px;margin:0px;">POSTROUTING</strong></p></li><li><p>在所有路由判断之后,对数据包进行修改</p></li></ul><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;"><strong style="padding:0px;margin:0px;">注意:</strong>&nbsp;链 是每个数据包流需要经过的不同环节，你可以在不同的环节根据需要设置不同的过滤策略,<strong style="padding:0px;margin:0px;">每个链的默认策略都是Accept</strong></p><h2 style="padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;">2.3. 4个表(table)</h2><ul style="padding:0px;margin:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;" class="list-paddingleft-2"><li><p><strong style="padding:0px;margin:0px;">Mangle表</strong></p></li><li><p>这个表主要用来mangle包，你可以使用mangle匹配来改变包的一些属性，比如 TOS（TYPE OF SERVICE),TTL (TIME TO LIVE),MARK(后续流量控制TC等)</p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;"><br></p></li><li><p><strong style="padding:0px;margin:0px;">Nat表</strong></p></li><li><p>此表仅用于NAT，也就是转换包的源或目标地址。注意，就象我们前面说过的，只有流的第一个 包会被这个链匹配，其后的包会自动被做相同的处理(DNAT,SNAT,MASQUERADE)</p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;"><br></p></li><li><p><strong style="padding:0px;margin:0px;">Filter表</strong></p></li><li><p>此表用来过滤数据包，我们可以在任何时候匹配包并过滤它们。 我们就是在这里根据包的内容对包做DROP或ACCEPT的.<br style="padding:0px;margin:0px;">iptalbe中,要用&nbsp;<strong style="padding:0px;margin:0px;">-t</strong>&nbsp;参数指定要操作哪个表,如果没有&nbsp;<strong style="padding:0px;margin:0px;">-t</strong>&nbsp;参数，就默认对<strong style="padding:0px;margin:0px;">filter表</strong>操作.</p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;"><br></p></li><li><p><strong style="padding:0px;margin:0px;">Raw表</strong></p></li><li><p>优先级最高，设置raw时一般是为了不再让iptables做数据包的链接跟踪处理，提高性能</p></li></ul><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;"><strong style="padding:0px;margin:0px;">注意:</strong>&nbsp;表 是规则的集合组,<strong style="padding:0px;margin:0px;">每个表中的规则条目是按顺序匹配的</strong>,你可以在数据包经过的不同环节设置规则,表的处理优先级：<strong style="padding:0px;margin:0px;">raw &gt; mangle &gt; nat &gt; filter</strong></p><h2 style="padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;">2.4. 详细的数据包流程</h2><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;"><img src="http://www.51know.info/system_security/iptable/packet_flow.png" alt="packet_flow.png" class="magnify" style="padding: 0px; margin: 0px; border: medium none; cursor: pointer;" border="0" align="middle"></p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;">从上图可以看出，数据包流环节和表的配合使用方法.</p><br><h1 style="padding:15px 0px 5px;margin:0px;font-size:1.6em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(25,52,65);white-space:normal;">3. iptable应用场景</h1><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;"><img src="http://www.51know.info/system_security/iptable/iptable_example.gif" alt="iptable_example.gif" class="magnify" style="padding: 0px; margin: 0px; border: medium none; cursor: pointer;" border="0" align="middle"></p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;">上图是应用场景的简单拓扑描述,下面的应用场景举例，都以上图为参考.<br style="padding:0px;margin:0px;"><strong style="padding:0px;margin:0px;">系统启动的时候所有的默认策略都是ACCEPT</strong>,在下面的场景举例中，我们都是在这种前提下设定iptable的<br style="padding:0px;margin:0px;"><strong style="padding:0px;margin:0px;">下面每个场景举例都是独立的，没有相关联性的</strong></p><h2 style="padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;">3.1. 网关服务器安全策略</h2><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;">目标 : 网关服务器系统自生安全策略，只对内网用户开放22端口(sshd服务)</p><div class="code-toolbar"><pre class="brush:bash;toolbar:false  language-bash"><code class="  language-bash">  <span class="token comment">#清空 filter table</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -F -t filter</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -X -t filter</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -Z -t filter</span>
  
  <span class="token comment">#清空 nat table</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -F -t nat</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -X -t nat</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -Z -t nat</span>
  
  <span class="token comment">#设置默认策略(INPUT链默认为DROP)</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -t filter -P INPUT DROP</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -t filter -P OUTPUT ACCEPT</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -t filter -P FORWARD ACCEPT</span>
  
  <span class="token comment">#回环接口(lo),默认accept</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -A INPUT -p ALL -i lo -j ACCEPT</span>
  
  <span class="token comment">#只对内网用户开放sshd服务</span>
  <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -A INPUT -p tcp -s 192.168.138.0/24 --dport 22 -j ACCEPT</span></code></pre><div class="toolbar"></div></div><p><span style="font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;background-color:rgb(252,255,245);"></span></p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;">说明: 防火墙的策略顺序一般都是 从&nbsp;<strong style="padding:0px;margin:0px;">非信任 ==&gt; 信任</strong>,默认关闭所有访问权限,然后按照需要逐条开放访问权限.</p><h2 style="padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;">3.2. 共享上网(nat)</h2><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;">目标：使局域网的用户都可以访问外网的服务器</p><div class="code-toolbar"><pre class="brush:bash;toolbar:false  language-bash"><code class="  language-bash"> <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span>
 <span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</span></code></pre><div class="toolbar"></div></div><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;"><strong style="padding:0px;margin:0px;">说明: SNAT 和 MASQUERADE 区别</strong></p><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;">SNAT
 : 不管是几个地址，必须明确的指定要SNAT的ip，适合网关服务器有固定地址或者是固定地址范围. MASQUERADE : 
是针对ADSL动态拨号这种场景而设计,从服务器的网络接口上,自动获取当前ip地址来做NAT,这样就实现了动态SNAT地址转换</p><h2 style="padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;">3.3. 内网的服务器对外服务(端口映射)</h2><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;">目标：使外网用户可以访问到局域网<strong style="padding:0px;margin:0px;">192.168.138.21</strong>这台<strong style="padding:0px;margin:0px;">HTTP</strong>服务</p><div class="code-toolbar"><pre class="brush:bash;toolbar:false  language-bash"><code class="  language-bash"><span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span>
<span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -t nat -A PREROUTING -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.138.21</span>
<span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</span></code></pre><div class="toolbar"></div></div><h2 style="padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;">3.4. 在网关服务器进行透明代理</h2><p style="padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;">目标: 使局域网用户,访问外网web服务时，自动使用squid作web透明代理服务器。</p><div class="code-toolbar"><pre class="brush:bash;toolbar:false  language-bash"><code class="  language-bash"><span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span>
<span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -t nat -A PREROUTING -s 192.168.138.0/24 -p tcp --dport 80 -i eth0 -j DNAT --to 192.168.138.1</span>
<span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -t nat -A PREROUTING -s 192.168.138.0/24 -p tcp --dport 80 -i eth0 -j REDIRECT --to 3128 </span>
<span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</span></code></pre><div class="toolbar"></div></div></div>
				</div>
															<div class="for-tag mt26">
																						<a href="https://blog.51cto.com/search/result?q=nginx" target="_blank">nginx</a>
															                				<a class="last" href="https://blog.51cto.com/hao360/category7.html" target="_blank"><i></i>系统优化</a>
                				<div class="clear"></div>
			</div>
			<div class="more-list">
				<p class="is-praise fl "><span type="1" blog_id="1381408" userid="5820068">1</span></p>
				<div class="share-box fr">
					<p class="share"><i></i>分享</p>
					<div class="bdsharebuttonbox bdshare-button-style0-16" data-bd-bind="1559668176646">
					  <span></span>
					  <a class="bds_tsina" data-cmd="tsina">微博</a>
					  <a class="bds_sqq" data-cmd="sqq">QQ</a>
					  <a class="bds_weixin" data-cmd="weixin">微信</a>
					  <img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/qr-url.png">
					</div>
				</div>
				<p class="favorites favorites-opt fr"><i></i>收藏</p>
								<div class="clear"></div>
			</div>
							<div class="artical-list">
	            					<a class="fl" href="https://blog.51cto.com/hao360/1381262" title="详解Nginx的功能策略配置和错误页面优雅显示的配置">
						上一篇：详解Nginx的功能策略配置和错...</a>
	            	            					<a class="fr" href="https://blog.51cto.com/hao360/1381431" title="iptables命令详解及tcp wrappers">
						下一篇：iptables命令详解及tcp...</a>
	            					<div class="clear"></div>
				</div>
						<div class="author-module">
				<div class="is-vip-bg-6 fl">
					<a href="https://blog.51cto.com/hao360" class="a-img" target="_blank">
						<img class="is-vip-img is-vip-img-4" data-uid="5820068" src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/wKioL1LNGtPRQT4HAAAZ-xV-2YE148_middle.jpg">
					</a>
				</div>
				<div class="author-module-center fl">
					<a class="h2" href="https://blog.51cto.com/hao360" target="_blank" style="display:inline-block;">linux_python</a>
										<h3>244篇文章，145W+人气，21粉丝</h3>
									</div>
									<div class="author-module-right author-checkFollow fr">
          	                  <a id="checkFollow2_5820068" class="follow-1 checkFollow on">关注</a>
              					</div>
        				<div class="clear"></div>
			</div>
		</div>
		<div class="artical-Left" id="comment">
			<!-- 发布评论 -->
			<div class="comment-creat">
				<div class="is-vip-bg-6 fl">
					<a href="https://blog.51cto.com/hao360" class="header-img" target="_blank">
						<img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/noavatar_middle.gif">
					</a>
				</div>
				<div class="first-publish fr publish_user_id">
					<textarea class="textareadiv textareadiv-publish" name="" id="" placeholder="提问和评论都可以，用心的回复会被更多人看到和认可" maxlength="500"></textarea>
					<div class="comment-push">
						<p class="msg fl">Ctrl+Enter&nbsp;发布</p>
													<p class="publish-btn blue-btn fr" flag="1">发布</p>
												<p class="cancel-btn cancel-btn-1 fr">取消</p>
						<div class="clear"></div>
					</div>
					<input type="hidden" class="user_id" value="5820068">
					<input type="hidden" class="reply_id" value="1381408">
					<input type="hidden" class="first_pid" value="">
				</div>
				<div class="clear"></div>
			</div>
						<div class="commentList"></div>
			<!-- page -->
			<div class="act_pageList_box"></div>
		</div>
		<!-- end left -->
		<!-- right start -->
		<div class="Blog-Right artical-Right">
			<a class="catalog" style="display: none;"></a>
			<a class="scrollTop" href="javascript:void(0);" onclick="$(window).scrollTop(0);" style="display: none;"></a>
		</div>
		<!-- end right  -->
	</div>
			<div class="special-column">
			<div class="Page M764">
									<div class="column-1">
						<h2 class="column-tit">推荐专栏<a href="https://blog.51cto.com/cloumn/index?utm_source=p" target="_blank"><span class="recommend-more-span" style="">更多</span></a></h2>
													<div class="column-box">
								<a href="https://blog.51cto.com/cloumn/detail/8" class="a-img fl cloumn-tab-par" target="_blank">
									<img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/5366d1f50328a62facbf5db1d91c319a.png">
                													</a>
								<div class="center fl">
									<a class="h2 white-space left-list" href="https://blog.51cto.com/cloumn/detail/8" target="_blank"> VMware vSAN中小企业应用案例</a>
									<h3 class="white-space">掌握VMware超融合技术</h3>
									<h4 class="white-space">共41章&nbsp;|&nbsp;<a href="https://blog.51cto.com/wangchunhai" target="_blank">王春海</a></h4>
									<h5><span class="price">
                                    ￥51.00
                                    </span><span>339人订阅</span></h5>
								</div>
								<div class="right fr">
							        																							<a class="cloumn-subscribe left-list" cid="8" href="https://blog.51cto.com/cloumn/detail/8" ask="1" target="_blank">订&nbsp;&nbsp;&nbsp;阅</a>
																			    								</div>
								<div class="clear"></div>
							</div>
													<div class="column-box">
								<a href="https://blog.51cto.com/cloumn/detail/10" class="a-img fl cloumn-tab-par" target="_blank">
									<img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/9d82eccb4e3c371eaeac41193bbef757.png">
                													</a>
								<div class="center fl">
									<a class="h2 white-space left-list" href="https://blog.51cto.com/cloumn/detail/10" target="_blank"> 基于Kubernetes企业级容器云平台落地与实践</a>
									<h3 class="white-space">容器私有云平台实践之路</h3>
									<h4 class="white-space">共15章&nbsp;|&nbsp;<a href="https://blog.51cto.com/lizhenliang" target="_blank">李振良OK</a></h4>
									<h5><span class="price">
                                    ￥51.00
                                    </span><span>589人订阅</span></h5>
								</div>
								<div class="right fr">
							        																							<a class="cloumn-subscribe left-list" cid="10" href="https://blog.51cto.com/cloumn/detail/10" ask="1" target="_blank">订&nbsp;&nbsp;&nbsp;阅</a>
																			    								</div>
								<div class="clear"></div>
							</div>
													<div class="column-box">
								<a href="https://blog.51cto.com/cloumn/detail/18" class="a-img fl cloumn-tab-par" target="_blank">
									<img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/45862f289339dc922ffda669fd74ad9b.jpg">
                													</a>
								<div class="center fl">
									<a class="h2 white-space left-list" href="https://blog.51cto.com/cloumn/detail/18" target="_blank"> 网工2.0晋级攻略 ——零基础入门Python/Ansible</a>
									<h3 class="white-space">网络工程师2.0进阶指南</h3>
									<h4 class="white-space">共30章&nbsp;|&nbsp;<a href="https://blog.51cto.com/gingerbeer" target="_blank">姜汁啤酒</a></h4>
									<h5><span class="price">
                                    ￥51.00
                                    </span><span>1539人订阅</span></h5>
								</div>
								<div class="right fr">
							        																							<a class="cloumn-subscribe left-list" cid="18" href="https://blog.51cto.com/cloumn/detail/18" ask="1" target="_blank">订&nbsp;&nbsp;&nbsp;阅</a>
																			    								</div>
								<div class="clear"></div>
							</div>
													<div class="column-box">
								<a href="https://blog.51cto.com/cloumn/detail/6" class="a-img fl cloumn-tab-par" target="_blank">
									<img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/629650e188ddde78b213e564c2e9ebff.jpg">
                													</a>
								<div class="center fl">
									<a class="h2 white-space left-list" href="https://blog.51cto.com/cloumn/detail/6" target="_blank"> 负载均衡高手炼成记</a>
									<h3 class="white-space">高并发架构之路</h3>
									<h4 class="white-space">共15章&nbsp;|&nbsp;<a href="https://blog.51cto.com/sery" target="_blank">sery</a></h4>
									<h5><span class="price">
                                    ￥51.00
                                    </span><span>505人订阅</span></h5>
								</div>
								<div class="right fr">
							        																							<a class="cloumn-subscribe left-list" cid="6" href="https://blog.51cto.com/cloumn/detail/6" ask="1" target="_blank">订&nbsp;&nbsp;&nbsp;阅</a>
																			    								</div>
								<div class="clear"></div>
							</div>
													<div class="column-box">
								<a href="https://blog.51cto.com/cloumn/detail/5" class="a-img fl cloumn-tab-par" target="_blank">
									<img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/dc6736c5fd50474b5df8b76b040e3d03.jpg">
                													</a>
								<div class="center fl">
									<a class="h2 white-space left-list" href="https://blog.51cto.com/cloumn/detail/5" target="_blank"> 带你玩转高可用</a>
									<h3 class="white-space">前百度高级工程师的架构高可用实战</h3>
									<h4 class="white-space">共15章&nbsp;|&nbsp;<a href="https://blog.51cto.com/13527416" target="_blank">曹林华</a></h4>
									<h5><span class="price">
                                    ￥51.00
                                    </span><span>458人订阅</span></h5>
								</div>
								<div class="right fr">
							        																							<a class="cloumn-subscribe left-list" cid="5" href="https://blog.51cto.com/cloumn/detail/5" ask="1" target="_blank">订&nbsp;&nbsp;&nbsp;阅</a>
																			    								</div>
								<div class="clear"></div>
							</div>
											</div>
													<div class="column-2" style="margin-top: 76px;">
						<h2 class="column-tit">猜你喜欢</h2>
						<div class="column-box">
															<a class="white-space" href="https://blog.51cto.com/hao360/2030414?source=dra" target="_blank">我的友情链接</a>
															<a class="white-space left-list" href="https://blog.51cto.com/hao360/1927316?source=dra" target="_blank">跨域资源共享 CORS 详解</a>
															<a class="white-space" href="https://blog.51cto.com/liuyu/166381?source=drt" target="_blank">nginx反向代理配置及优化</a>
															<a class="white-space left-list" href="https://blog.51cto.com/13523664/2060430?source=drt" target="_blank">Nginx配置跨域请求 Access-Control-Allow-Origin *</a>
															<a class="white-space" href="https://blog.51cto.com/onlyzq/535279?source=drt" target="_blank">关于Nginx的server_name。</a>
															<a class="white-space left-list" href="https://blog.51cto.com/ixdba/806622?source=drt" target="_blank">实战Nginx与PHP（FastCGI）的安装、配置与优化</a>
															<a class="white-space" href="https://blog.51cto.com/yucanghai/1713803?source=drt" target="_blank">服务器排障 之 nginx 499 错误的解决</a>
															<a class="white-space left-list" href="https://blog.51cto.com/nanchunle/1657410?source=drt" target="_blank">Nginx常见的错误及解决方法</a>
															<a class="white-space" href="https://blog.51cto.com/kusorz/2058591?source=drt" target="_blank">配置Nginx支持WSS（WebSocket）</a>
															<a class="white-space left-list" href="https://blog.51cto.com/storysky/486338?source=drt" target="_blank">nginx 域名跳转一例~~~(rewrite、proxy)</a>
															<a class="white-space" href="https://blog.51cto.com/liuqunying/1420556?source=drt" target="_blank">nginx 并发数问题思考：worker_connections,worker_processes与 max clients</a>
															<a class="white-space left-list" href="https://blog.51cto.com/xiaosu/1689992?source=drt" target="_blank">线上nginx的一次“no live upstreams while connecting to upstream ”分析</a>
															<a class="white-space" href="https://blog.51cto.com/sun510/2354375?source=drh" target="_blank">解析DELL R710服务器迁移操作内容</a>
															<a class="white-space left-list" href="https://blog.51cto.com/sun510/2166076?source=drh" target="_blank">开学季出大事：某教育局丢失3台虚拟机</a>
															<a class="white-space" href="https://blog.51cto.com/sun510/2164979?source=drh" target="_blank">EVA4400存储虚拟机+数据库数据恢复成功案例</a>
															<a class="white-space left-list" href="https://blog.51cto.com/sun510/2159782?source=drh" target="_blank">服务器数据恢复通用方法+服务器分区丢失恢复案例</a>
															<a class="white-space" href="https://blog.51cto.com/13642258/2151655?source=drh" target="_blank">在CentOS7上部署squid缓存服务器及代理功能</a>
															<a class="white-space left-list" href="https://blog.51cto.com/sun510/2149069?source=drh" target="_blank">EMC 5400服务器raid阵列瘫痪数据恢复成功案例</a>
															<a class="white-space" href="https://blog.51cto.com/sun510/2146600?source=drh" target="_blank">服务器数据恢复案例 / raid5阵列多块硬盘离线处理方法</a>
															<a class="white-space left-list" href="https://blog.51cto.com/sun510/2144160?source=drh" target="_blank">华为存储服务器卷丢失数据恢复成功案例</a>
														<div class="clear"></div>
						</div>
					</div>
							</div>
		</div>
		<div class="group_img_box">
		<div class="group_git_box">
                	 <img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/f92360e227f9d91cdff7ea95120630ef.png" style="width:70px;height:70px;"> 	
			<!--<img src="https://s1.51cto.com/images/blog/201810/22/078772c84eb23213ea90f577d9316ce4.png"/>-->
        		</div>
			<div class="group_code_box">
			<img src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/left-qr.jpg" width="130" height="130">
			<p>扫一扫,领取大礼包</p>
		</div>
	</div>		
	<div class="the-lowest-bg">
		<div class="the-lowest Page M764">
			<p class="is-praise fl "><span type="1" blog_id="1381408" userid="5820068">1</span></p>
			<p class="b-favorites favorites-opt fl"><i></i><b>0</b></p>
			<a class="b-reply fl"><i></i><font class="comment_number"></font></a>
			<div class="b-share fl">
				<i></i>分享
				<div class="bdsharebuttonbox bdshare-button-style0-16" data-bd-bind="1559668176646">
				  <a class="bds_tsina p2" data-cmd="tsina"></a>
				  <a class="bds_sqq p3" data-cmd="sqq"></a>
				  <a class="bds_weixin p1" data-cmd="weixin"><em class="code-icon"></em><img class="code-img" src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/qr-url.png"></a>
				</div>
			</div>
      				<div class="b-fllow author-checkFollow fr" style="margin-left: 20px;">
                        <a id="checkFollow3_5820068" class="follow-1 checkFollow on">关注</a>
          				</div>
      						<a href="https://blog.51cto.com/hao360" class="b-name fr">linux_python</a>
			<div class="is-vip-bg-6 fr">
				<a href="https://blog.51cto.com/hao360" class="b-img"><img class="is-vip-img is-vip-img-4" data-uid="5820068" src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/wKioL1LNGtPRQT4HAAAZ-xV-2YE148_middle.jpg"></a>
			</div>
			<div class="clear"></div>

		</div>
	</div>
</div>
<!-- 老博文美观处理 -->
	<script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/shCores.js"></script>
<script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/countDown.js"></script>
<script>
	var praise_url = 'https://blog.51cto.com/praise/praise'
    	addReply_url = 'https://blog.51cto.com/comments/add'
    	removeUrl = 'https://blog.51cto.com/comments/del'
    	blog_id = '1381408'
    	pv_log_info = {
            'pv_type':'blog',
            'user_id':'5820068',
            'blog_id':'1381408'
        };
    	rid = '0'
    	is_comment = '0'
    	comment_list = '/blog/ajax-comment-list'
    	comment_sort = "asc"
    	index_url = 'https://blog.51cto.com/hao360';
    	uc_url = 'https://ucenter.51cto.com/'
    	blog_url = 'https://blog.51cto.com/'
    	img_url = 'https://static1.51cto.com/edu/blog/'
    	i_user_id = ''
    	c_user_id ='5820068'
    	collect_url = 'https://blog.51cto.com/collect/add'
    	is_old = '1'
    	nicknameurl = 'https://blog.51cto.com/hao360'
    	nickname = 'linux_python'
    	myself = window.location.href;
	$('.you-like-list li:odd').css({'margin-left': '10%'});
	$('.column-box a:odd').addClass('left-list')
	$('.myUrl').text(myself).click(function(){window.open(myself)})
	setTimeout(function(){$('.Footer').css({'margin-top':'-50px'})},50)
    		function FollowBtnSucc(e){//1:未关注,2:已关注,3:互相关注
		    if(e==2||e==3){
		        $.post('/index/wxbind',{uid:userId},function(res){
		            if(res.data.wxBind == 0){//没绑定
	                    if(getCookie('follow1'))return false;
	                    box1()
	                }else{
	                    if(getCookie('follow2'))return false;
	                    box2()
	                }
		        },'json')
		    }
		}
		FollowBtn = new Follow($('#checkFollow1_5820068'),'5820068','1',['on','in','mutual','off']);
		FollowBtn.success=FollowBtnSucc;
		FollowBtn = new Follow($('#checkFollow2_5820068'),'5820068','1',['on','in','mutual','off']);
		FollowBtn.success=FollowBtnSucc;
		FollowBtn = new Follow($('#checkFollow3_5820068'),'5820068','1',['on','in','mutual','off']);
		FollowBtn.success=FollowBtnSucc;
        	if(is_old==1){
    // SyntaxHighlighter.all();
    insertCodeElement("<p style=\"background-color:#ffffff;border:0px;padding:0px;vertical-align:baseline;color:#333333;font-family:georgia, 'bitstream charter', serif;line-height:24px;margin-top:0px;margin-bottom:24px;\"><a href=\"http:\/\/www.cnblogs.com\/gao241\/p\/3522143.html\" style=\"font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;\" target=\"_blank\">http:\/\/www.cnblogs.com\/gao241\/p\/3522143.html<\/a><\/p><p style=\"background-color:#ffffff;border:0px;padding:0px;vertical-align:baseline;color:#333333;font-family:georgia, 'bitstream charter', serif;line-height:24px;margin-top:0px;margin-bottom:24px;\">echo \u201c1\u2033 &gt; \/proc\/sys\/net\/ipv4\/icmp_echo_ignore_all<br \/>\u8fd9\u4e0b\u662f\u522b\u4eba\u4e0d\u80fdping\u4f60\uff0c\u4f60\u4e5f\u4e0d\u80fdping\u522b\u4eba<br \/>\u5c06\u5176\u503c\u6539\u4e3a1\u540e\u4e3a\u7981\u6b62PING<br \/>\u5c06\u5176\u503c\u6539\u4e3a0\u540e\u4e3a\u89e3\u9664\u7981\u6b62PING<br \/>\u5176\u5b9e\u4f7f\u7528iptable\u6700\u7b80\u5355<br \/>iptables -A INPUT -p icmp \u2013icmp-type 8 -s 0\/0 -j DROP<br \/>iptables -A INPUT -p icmp \u2013icmp-type 0 -s 0\/0 -j ACCEPT<br \/>iptables -A OUTPUT -p icmp \u2013icmp-type 0 -s 192.168.29.1 -j DROP<\/p><p style=\"background-color:#ffffff;border:0px;padding:0px;vertical-align:baseline;color:#333333;font-family:georgia, 'bitstream charter', serif;line-height:24px;margin-top:0px;margin-bottom:24px;\">iptables -A OUTPUT -p icmp \u2013icmp-type 8 -s 192.168.29.1 -j ACCEPT<\/p><p><br \/><\/p><p style=\"padding:0px 0px 15px;color:#555555;font-family:'\u5b8b\u4f53', 'arial narrow', arial, serif;font-size:14px;line-height:28px;background-color:#ffffff;margin-top:0px;margin-bottom:0px;\"><span style=\"color:#333333;font-family:'lucida grande', verdana, lucida, helvetica, arial, simsun, sans-serif;line-height:21px;\">\u5982\u4f55\u8ba9\u522b\u4ebaping\u4e0d\u5230\u81ea\u5df1\uff0c\u800c\u81ea\u5df1\u53c8\u80fdping\u522b\u4eba,\u95ee\u9898\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u7528\u5982\u4e0b\u811a\u672c<\/span><\/p><p style=\"padding:0px 0px 15px;color:#555555;font-family:'\u5b8b\u4f53', 'arial narrow', arial, serif;font-size:14px;line-height:28px;background-color:#ffffff;margin-top:0px;margin-bottom:0px;\">#\/bin\/bash<br \/>iptables -F<br \/>iptables -F -t nat<br \/>iptables -X<br \/>iptables -P INPUT DROP<br \/>iptables -P OUTPUT DROP<br \/>iptables -P FORWARD DROP<br \/><br \/>iptables -A INPUT -i lo -j ACCEPT<br \/>iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT<br \/>iptables -A INPUT -p tcp -m multiport --dport 80,22 -j ACCEPT<br \/>iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT<br \/><br \/>iptables -A OUTPUT -o lo -j ACCEPT<br \/>iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT<br \/>iptables -A OUTPUT -p tcp -m multiport --sport 80,22 -j ACCEPT<br \/>iptables -A OUTPUT -p icmp --icmp-type 8 -j ACCEPT<\/p><p style=\"padding:0px 0px 15px;color:#555555;font-family:'\u5b8b\u4f53', 'arial narrow', arial, serif;font-size:14px;line-height:28px;background-color:#ffffff;margin-top:0px;margin-bottom:0px;\"><br \/><\/p><p style=\"padding:0px 0px 15px;color:#555555;font-family:'\u5b8b\u4f53', 'arial narrow', arial, serif;font-size:14px;line-height:28px;background-color:#ffffff;margin-top:0px;margin-bottom:0px;\"><span style=\"font-family:'trebuchet ms', trebuchet, 'lucida sans unicode', 'lucida grande', 'lucida sans', arial, 'microsoft yahei', verdana, sans-serif;font-size:22px;line-height:32px;\">iptables\u5e94\u7528\u4e4b\u7981ping\u548c\u9632ddos\u5411\u5916\u53d1\u5305<\/span><br \/><\/p><p style=\"padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;\">\u4e3b\u8981\u8bb22\u4e2a\u57fa\u672c\u7684\u5b9e\u9645\u5e94\u7528\uff0c\u4e3b\u8981\u6d89\u53ca\u5230\u7981ping\uff08ipv4\uff09\u4ee5\u53ca\u7981\u6b62udp\uff0c\u5373\u7981\u6b62\u6709\u9ed1\u5ba2\u5229\u7528\u670d\u52a1\u5668\u5411\u5916\u53d1\u5305ddos\u653b\u51fb\u65b9\u9762\u7684\u5185\u5bb9\u3002<\/p><p style=\"padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;\">\u4e00\u3001\u5982\u679c\u6ca1\u6709iptables\u7981\u6b62ping<\/p><p><span class=\"content\" style=\"margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;\"><code class=\"functions\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">echo<\/code><code class=\"plain\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">1 &amp;<\/code><code class=\"keyword\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">gt<\/code><code class=\"plain\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">; \/proc\/sys\/net\/ipv4\/icmp_echo_igore_all <\/code><code class=\"comments\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">#\u5f00\u542f<\/code><\/span><\/p><p><span class=\"content\" style=\"margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;\"><code class=\"functions\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">echo<\/code><code class=\"plain\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">0 &amp;<\/code><code class=\"keyword\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">gt<\/code><code class=\"plain\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">; \/proc\/sys\/net\/ipv4\/icmp_echo_igore_all <\/code><code class=\"comments\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">#\u5173\u95ed<\/code><\/span><\/p><p style=\"padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;\">\u4e8c\u3001\u5229\u7528iptables\u89c4\u5219\u7981ping<\/p><p><span class=\"content\" style=\"margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;\"><code class=\"plain\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">iptables -A INPUT -p icmp --icmp-<\/code><code class=\"functions\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">type<\/code><code class=\"plain\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">8 -s 0\/0 -j DROP<\/code><\/span><\/p><p style=\"padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;\">\u4e09\u3001\u5229\u7528iptables\u89c4\u5219\uff0c\u7981\u6b62\u670d\u52a1\u5668\u5411\u5916\u53d1\u5305\uff0c\u9632\u6b62DDOS\u5411\u5916\u653b\u51fb<\/p><p><span class=\"content\" style=\"margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;\"><code class=\"plain\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">iptables -I OUTPUT -p udp --dport 53 -d 8.8.8.8 -j ACCEPT <\/code><code class=\"comments\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">#\u5141\u8bb8UDP\u670d\u52a1IP<\/code><\/span><\/p><p><span class=\"content\" style=\"margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;\"><code class=\"plain\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">iptables -A OUTPUT -p udp -j DROP <\/code><code class=\"comments\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">#\u7981\u6b62udp\u670d\u52a1<\/code><\/span><\/p><p style=\"padding:0px;font-family:'open sans', helvetica, arial, sans-serif;font-size:14px;line-height:25.200000762939453px;margin-top:0px;margin-bottom:10px;\">\u4e0a\u8ff053\u7aef\u53e3\u548c8888\u662fDNS\u670d\u52a1\u5fc5\u987b\u6709\u7684\uff0c\u5982\u679c\u4e0d\u6e05\u695a\u672c\u673a\u7684DNS\u8bbe\u7f6e\uff0c\u53ef\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5f97\u5230IP\uff1a<\/p><p><span class=\"content\" style=\"margin:0px;padding:0px 0px 0px 1.5em;border:0px;background-p_w_picpath:none;float:none;vertical-align:baseline;height:auto;width:auto;text-indent:-1.5em;\"><code class=\"functions\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">cat<\/code><code class=\"plain\" style=\"height:auto;line-height:18px;font-family:consolas, monaco, 'bitstream vera sans mono', 'courier new', courier, monospace;font-size:14px;\">\/etc\/resolv.conf<\/code><\/span><\/p><p><br \/><\/p><p><br \/><\/p><h2 class=\"title content-title\" style=\"margin:0px 0px 10px;padding:0px;font-size:20px;font-family:tahoma, helvetica, 'microsoft yahei', arial;color:rgb(58,58,58);font-weight:normal;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(255,0,0);background-color:rgb(0,0,0);\">\u5173\u4e8ePREROUTING\u94fe\u548cPOSTROUTING\u94fe\u7b80\u5355\u5173\u7cfb<\/span><\/h2><p style=\"margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);\">\u6e90\u5730\u5740\u53d1\u9001\u6570\u636e--&gt;&nbsp;{PREROUTING--&gt;\u8def\u7531\u89c4\u5219--&gt;POSTROUTING}&nbsp;--&gt;\u76ee\u7684\u5730\u5740\u63a5\u6536\u5230\u6570\u636e<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">PREROUTING\uff1a\u5728\u8fdb\u884c\u8def\u7531\u5224\u65ad\u4e4b\u524d\u6240\u8981\u8fdb\u884c\u7684\u89c4\u5219(DNAT\/REDIRECT)<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">POSTROUTING\uff1a\u5728\u8fdb\u884c\u8def\u7531\u5224\u65ad\u4e4b\u540e\u6240\u8981\u8fdb\u884c\u7684\u89c4\u5219(SNAT\/MASQUERADE)<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u6e90\u5730\u5740\u8f6c\u6362\u5fc5\u987b\u5728POSTROUTING\u94fe\u4e0a\u505a\u3002<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u76ee\u6807\u5730\u5740\u8f6c\u6362\u5fc5\u987b\u5728PREROUTING\u94fe\u4e0a\u505a\u3002<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u4e0b\u9762\u6211\u4eec\u6765\u5b9e\u73b0\u6e90\u5730\u5740\u7684\u529f\u80fd\uff1a\u6211\u4eec\u5047\u8bbe\u8fd9\u6837\u4e00\u79cd\u573a\u666f\uff1a<\/p><p><img src=\"https:\/\/s1.51cto.com\/attachment\/201103\/8\/508999_1299549890zjyg.png\" alt=\"wps_clip_p_w_picpath-31021\" \/><\/p><p><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\">192.168.0.254\u662f\u5de5\u4f5c\u5728\u5916\u7f51\u7684\u4e00\u53f0WEB\u670d\u52a1\u5668\uff0c\u4e2d\u95f4\u7684\u90a3\u53f0\u662f\u4f01\u4e1a\u91cc\u7684NAT\u670d\u52a1\u5668\uff0c\u6211\u4eec\u5728\u4e0a\u9762\u6dfb\u52a0iptables\u7684\u89c4\u5219\uff0c\u4f7f\u5176\u5b9e\u73b0\u5730\u5740\u8f6c\u6362\u7684\u529f\u80fd\uff0cPC\u673a\u662f\u5de5\u4f5c\u5728\u4f01\u4e1a\u5185\u90e8\u3002\u6211\u4eec\u7684\u6700\u7ec8\u76ee\u7684\u662f192.168.80.30\u8fd9\u53f0\u8ba1\u7b97\u673a\u901a\u8fc7NAT\u670d\u52a1\u5668\u53ef\u4ee5\u8bbf\u95ee\u5230192.168.0.254\u7684WEB\u670d\u52a1\u3002<\/span><\/p><p><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u4e3aPC\u673a\u8bbe\u7f6e\u7f51\u5173\uff1a<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">[root@station39 ~]# route add default gw 192.168.80.129<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u4e0b\u9762\u5f00\u59cb\u6765\u914d\u7f6eNAT\u670d\u52a1\u5668\uff1a<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u9996\u5148\u8981\u5f00\u542fNAT\u670d\u52a1\u5668\u7684\u5185\u6838\u8def\u7531\u529f\u80fd\uff1a<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">[root@server27 ~]# echo 1 &gt; \/proc\/sys\/net\/ipv4\/ip_forward<\/p><p><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u8bbe\u7f6e\u89c4\u5219\uff1a<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">[root@server27 ~]# iptables -t nat -A POSTROUTING -s 192.168.80.0\/24 -d 192.168.0.0\/24 -j SNAT --to-source 192.168.0.127<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">[root@server27 ~]# iptables -t nat -L -n<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\">\u6211\u4eec\u7528192.168.80.130\u8fd9\u53f0\u4e3b\u673a\u8bbf\u95ee\u4e00\u4e0b192.168.0.254\u7684web\u670d\u52a1\uff0c\u53d1\u73b0\u53ef\u4ee5\u4e86\uff01<\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">PS\uff1a\u5982\u679c\u6211\u4eec\u4f7f\u7528\u8def\u7531\u529f\u80fd\u6765\u8bbf\u95ee254\u8fd9\u53f0\u4e3b\u673a\u7684\u8bdd\uff0cWEB\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u65e5\u5fd7\u5c06\u8bb0\u5f55\u7684\u8bbf\u95ee\u5730\u5740\u662f192.168.80.130\uff0c\u800c\u5982\u679c\u6211\u4eec\u4f7f\u7528\u5730\u5740\u8f6c\u6362\u7684\u529f\u80fd\u6765\u8bbf\u95ee\u7684\u8bdd\uff0c\u8bbf\u95ee\u65e5\u5fd7\u8bb0\u5f55\u7684\u8bbf\u95ee\u5730\u5740\u5219\u662f192.168.0.127\u3002.<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u4e00\u822c\u6211\u4eec\u4e0a\u7f51\u7684\u65f6\u5019\uff0c\u6240\u83b7\u5f97\u7684IP\u90fd\u662f\u52a8\u6001\u7684\uff0c\u600e\u4e48\u529e\uff1f<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u505a\u6e90\u5730\u5740\u8f6c\u6362\u7684\u65f6\u5019\uff0c\u8fd8\u6709\u4e00\u4e2a\u5c0f\u529f\u80fdMASQUERADE\uff08\u5730\u5740\u4f2a\u88c5\uff09\uff0c\u4f7f\u7528\u8fd9\u4e2a\u529f\u80fd\uff0c\u6211\u4eec\u4e0d\u9700\u8981<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u6307\u5b9a\u76ee\u6807\u5730\u5740\uff0c\u5b83\u4f1a\u81ea\u52a8\u63a2\u6d4b\u80fd\u591f\u4e0a\u4e92\u8054\u7f51\u7684\u5730\u5740\uff0c\u5e76\u81ea\u52a8\u5c06\u5185\u7f51\u5730\u5740\u8f6c\u6362\u8fc7\u6765\u3002\u7f3a\u9677\uff1a\u6bd4\u8f83\u8017\u8d39\u8d44\u6e90\u3002<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><br \/><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\">\u5b9e\u73b0\u76ee\u6807\u5730\u5740\u8f6c\u6362\u529f\u80fd\uff1a<\/span><\/span><br \/><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><img src=\"https:\/\/s1.51cto.com\/attachment\/201103\/8\/508999_1299549893RjY9.png\" alt=\"wps_clip_p_w_picpath-1256\" \/><\/span><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\">\u573a\u666f\uff1a\u5047\u8bbe192.168.80\u7f51\u6bb5\u4e3a\u4e00\u4e2a\u63d0\u4f9bWEB\u670d\u52a1\u7684\u7f51\u7ad9\u7684\u5185\u7f51\uff0c\u4e2d\u95f4\u7684\u4e3a\u7f51\u7ad9\u7684NAT\u670d\u52a1\u5668\uff0c\u8fdc\u7aef\u7684\u5ba2\u6237\u7aef192.168.0.26\u60f3\u901a\u8fc7\u4e2d\u95f4\u7684NAT\u670d\u52a1\u5668\u6765\u8bbf\u95ee\u5185\u90e8\u7684192.168.80.130\u63d0\u4f9b\u7684WEB\u670d\u52a1\uff0c\u8fd9\u91cc\u5c31\u8981\u7528\u5230\u76ee\u6807\u5730\u5740\u8f6c\u6362\u4e86\u3002<\/span><\/span><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><\/span><\/span><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u8bbe\u7f6e192.168.80.130\u7684\u7f51\u5173\uff1a<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">[root@station39 ~]# route add default gw 192.168.80.129<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u5f00\u59cb\u5728NAT\u670d\u52a1\u5668\u4e0a\u8bbe\u7f6e\u89c4\u5219\uff1a<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u8fd9\u91cc\u4f9d\u7136\u8981\u6253\u5f00\u5185\u6838\u7684\u8def\u7531\u529f\u80fd<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\">[root@server27 ~]# echo 1 &gt; \/proc\/sys\/net\/ipv4\/ip_forward<\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u5f00\u59cb\u5199\u89c4\u5219\uff1a<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">[root@server27 ~]# iptables -t nat -A PREROUTING -s 192.168.0.0\/24 -d 192.168.0.127 -p tcp --dport 80 -j DNAT --to-destination 192.168.80.130<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">[root@server27 ~]# iptables -t nat -L -n<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\">\u89c4\u5219\u5df2\u7ecf\u5199\u597d\u4e86\uff0c\u6211\u4eec\u4f7f\u7528192.168.0.26\u6765\u8bbf\u95ee\u4e00\u4e0b192.168.0.127\u8bd5\u8bd5\uff0c\u5df2\u7ecf\u53ef\u4ee5\u8bbf\u95ee\u4e86\uff0c\u5176\u5b9e\u63d0\u4f9bWEB\u670d\u52a1\u7684\u662f192.168..80.130\u8fd9\u53f0\u4e3b\u673a\uff0c\u8fd9\u5c31\u662f\u76ee\u6807\u5730\u5740\u8f6c\u6362\u7684\u529f\u80fd\u3002<\/span><\/span><br \/><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\">\u6211\u4eec\u518d\u67e5\u770b\u4e00\u4e0b192.168.80.130\u8fd9\u53f0WEB\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u65e5\u5fd7\uff1a<\/span><\/span><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(44,44,44);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;background-color:rgb(255,255,255);\"><img src=\"https:\/\/s1.51cto.com\/attachment\/201103\/8\/508999_1299549895v8S4.png\" alt=\"wps_clip_p_w_picpath-24338\" \/><\/span><\/span><\/span><\/p><p style=\"margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);\">\u7ed3\uff1a\u6700\u8981\u7d27\u7684\u662f\u6211\u4eec\u8981\u8bb0\u4f4fPREROUTING\u662f\u6570\u636e\u4ece\u7f51\u5361\u6d41\u5165\u201c\u8def\u7531\u89c4\u5219\u201d\u4e4b\u524d\u7684\u52a8\u4f5c\uff0cPOSTROUTING\u662f\u6570\u636e\u4ece\u7f51\u5361\u6d41\u51fa\u201c\u8def\u7531\u89c4\u5219\u201d\u4e4b\u540e\u7684\u52a8\u4f5c\uff01<\/span><\/p><p style=\"margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);\"><br \/><\/span><\/p><p style=\"margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);\"><br \/><\/span><\/p><p style=\"margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(85,85,85);font-family:'\u5b8b\u4f53';font-size:20px;font-weight:bold;line-height:20px;text-align:center;background-color:rgb(255,255,255);\">iptables NAT<\/span><\/span><\/p><p style=\"margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(85,85,85);font-family:'\u5b8b\u4f53';font-size:20px;font-weight:bold;line-height:20px;text-align:center;background-color:rgb(255,255,255);\"><\/span><\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><strong style=\"padding:0px;margin:0px;\"><span style=\"padding:0px;margin:0px;font-family:'\u5b8b\u4f53', SimSun;\">\u6e90\u5730\u5740\u8f6c\u6362SNAT&nbsp;<\/span><\/strong><span style=\"padding:0px;margin:0px;font-family:'\u5b8b\u4f53', SimSun;\">Source NAT:\u5c31\u662f\u666e\u901a\u8def\u7531\u5668\u5b9e\u73b0\u4ee3\u7406\u4e0a\u7f51\u7684\u529f\u80fd\u3002<\/span><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><a href=\"https:\/\/s3.51cto.com\/wyfs02\/M01\/47\/06\/wKiom1P1o0zRko_mAADEu46M4gg338.jpg\" style=\"padding:0px;margin:0px;color:rgb(67,67,67);text-decoration:none;\" target=\"_blank\"><img src=\"https:\/\/s3.51cto.com\/wyfs02\/M01\/47\/06\/wKiom1P1o0zRko_mAADEu46M4gg338.jpg\" title=\"SNAT\" alt=\"wKiom1P1o0zRko_mAADEu46M4gg338.jpg\" style=\"padding:0px;margin:0px;vertical-align:top;border:none;\" \/><\/a><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">192.168.10.0\/24\u7f51\u6bb5\u5185\u8ba1\u7b97\u673a\u7f51\u5173\u90fd\u6307\u5411192.168.10.1\uff0cS1\u901a\u8fc7eth1\u4e0e\u4e92\u8054\u7f51\u76f8\u8fde\uff0cPC1\u7684\u6570\u636e\u62a5\u6587\u53d1\u5f80S1\u65f6\u5c31\u628a\u6e90IP\u6539\u4e3a12.34.56.78\uff0c\u8fd9\u6837\u51fa\u53bb\u5230\u4e92\u8054\u7f51\u7684\u62a5\u6587\u624d\u80fd\u591f\u56de\u6765\uff0c\u56de\u6765\u540eS1\u4f1a\u628a\u76ee\u6807\u5730\u5740\u6539\u4e3aPC1\u7684IP\u3002S1\u7684\u5185\u6838\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u5730\u5740\u8f6c\u6362\u8868\uff0c\u81ea\u52a8\u4fee\u6539\u76f8\u5e94\u6e90\u548c\u76ee\u7684\u5730\u5740\u3002<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><br style=\"padding:0px;margin:0px;\" \/><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u5305\u51fa\u53bb\u7684\u65f6\u5019\u4fee\u6539\u6e90IP\u6240\u4ee5\u5de5\u4f5c\u5728<strong style=\"padding:0px;margin:0px;\">POSTROUING<\/strong>\u94fe\u4e0a<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">iptables -t nat -A POSTROUTING -s 192.168.10.0\/24 -j SNAT --to-source 12.34.56.78<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><br style=\"padding:0px;margin:0px;\" \/><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u5f53\u4f7f\u7528<strong style=\"padding:0px;margin:0px;\">ADSL<\/strong>\u901a\u8fc7DHCP\u83b7\u5f97\u516c\u7f51IP\u65f6\uff0c\u9700\u8981\u7528\u5230MASQUERADE\uff08\u5730\u5740\u4f2a\u88c5\uff09\uff0c\u53ef\u4ee5\u81ea\u52a8\u628asource IP\u6539\u4e3a\u5f53\u65f6\u83b7\u53d6\u5230\u7684\u3002<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">iptables -t nat -A POSTROUTING -s 192.16.10.0\/24 -j&nbsp;<strong style=\"padding:0px;margin:0px;\">MASQUERADE<\/strong><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><br style=\"padding:0px;margin:0px;\" \/><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><strong style=\"padding:0px;margin:0px;\">DNAT \u76ee\u6807\u5730\u5740\u8f6c\u6362\uff1a<\/strong><\/p><ul class=\"list-paddingleft-2\" style=\"padding:0px 0px 0px 20px;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><li><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;\">\u9002\u7528\u4e8e\u6ca1\u6709\u8db3\u591f\u7684\u516c\u7f51IP\u800c\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u573a\u666f\uff0c\u76f8\u5f53\u4e8e\u7aef\u53e3\u6620\u5c04<\/p><\/li><li><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;\">\u4e5f\u53ef\u4ee5\u8d77\u5230\u4fdd\u62a4\u771f\u5b9e\u4e3b\u673a\u7684\u4f5c\u7528<\/p><\/li><\/ul><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\"><br style=\"padding:0px;margin:0px;\" \/><\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u6240\u6709\u8bf7\u6c4212.34.56.78web\u670d\u52a1\u90fd\u8f6c\u53d1\u7ed9\u540e\u7aef192.168.10.10\u76848080\u7aef\u53e3<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">iptables -t nat -A&nbsp;<strong style=\"padding:0px;margin:0px;\">PREROUTING<\/strong>&nbsp;-d 12.34.56.78 -p tcp --dport 80 -j DNAT --to-destination 192.168.10.10:8080<\/p><p style=\"padding:0px;margin-top:0px;margin-bottom:0px;clear:both;height:auto;color:rgb(85,85,85);font-family:'\u5b8b\u4f53', 'Arial Narrow', arial, serif;font-size:14px;line-height:28px;white-space:normal;background-color:rgb(255,255,255);\">\u6570\u636e\u62a5\u6587\u4e00\u8fdb\u6765\u672a\u8def\u7531\u4e4b\u524d\u5c31\u8981\u51b3\u5b9a\u8f6c\u53d1\u7ed9\u8c01\uff0c\u6240\u4ee5\u5de5\u4f5c\u5728PREROUTING\u94fe\u4e0a<\/p><p style=\"margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);\"><span style=\"color:rgb(85,85,85);font-family:'\u5b8b\u4f53';font-size:20px;font-weight:bold;line-height:20px;text-align:center;background-color:rgb(255,255,255);\"><br \/><\/span><\/span><\/p><p style=\"margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;background-color:rgb(255,255,255);\"><br \/><\/span><\/p><p style=\"margin-top:0px;margin-bottom:0px;padding:0px;color:rgb(69,69,69);font-family:tahoma, helvetica, arial;font-size:14px;line-height:21px;white-space:normal;background-color:rgb(255,255,255);\"><span style=\"background-color:rgb(0,0,0);color:rgb(255,0,0);\"><strong><span style=\"background-color:rgb(0,0,0);font-family:tahoma, helvetica, arial;font-size:18px;line-height:21px;\">iptables\u7aef\u53e3\u6620\u5c04<\/span><\/strong><\/span><\/p><pre class=\"brush:bash;toolbar:false\">#&nbsp;\u5185\u7f51\u901a\u8fc7\u6709\u5916\u7f51IP\u7684\u673a\u5668\u6620\u5c04\u7aef\u53e3\necho&nbsp;1&nbsp;&gt;&nbsp;\/proc\/sys\/net\/ipv4\/ip_forward&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;\u5728\u5185\u6838\u91cc\u6253\u5f00ip\u8f6c\u53d1\u529f\u80fd\nroute&nbsp;add&nbsp;-net&nbsp;10.10.20.0&nbsp;netmask&nbsp;255.255.255.0&nbsp;gw&nbsp;10.10.20.111&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;\u5185\u7f51\u9700\u8981\u6dfb\u52a0\u9ed8\u8ba4\u7f51\u5173\uff0c\u5e76\u4e14\u7f51\u5173\u5f00\u542f\u8f6c\u53d1\niptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-d&nbsp;192.168.10.158&nbsp;&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;9999&nbsp;-j&nbsp;DNAT&nbsp;--to&nbsp;10.10.20.55:22\niptables&nbsp;-t&nbsp;nat&nbsp;-nL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;\u67e5\u770b\u8f6c\u53d1\n\niptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-d&nbsp;\u5730\u57401&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;DNAT&nbsp;--to-destination&nbsp;\u5730\u57402:81\niptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-s&nbsp;192.168.0.0\/255.255.0.0&nbsp;-d&nbsp;192.168.0.2&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;8180&nbsp;-j&nbsp;SNAT&nbsp;--to-source&nbsp;192.168.0.1\n\u672c\u673a80\u7aef\u53e3\u5b9a\u5411\u523081\u7aef\u53e3\niptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;OUTPUT&nbsp;-s&nbsp;127.0.0.1&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;DNAT&nbsp;--to-dest&nbsp;127.0.0.1:81\n\u5c06\u8bbf\u95ee219.239.11.22\u7aef\u53e38080\u7684\u8bf7\u6c42\u8f6c\u53d1\u5230192.168.0.21\u7aef\u53e380\u4e0a\uff1a\niptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-d&nbsp;219.239.11.22&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;8080&nbsp;-j&nbsp;DNAT&nbsp;--to-destination&nbsp;192.168.0.21:80\niptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-d&nbsp;192.168.0.21&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;SNAT&nbsp;--to-source&nbsp;192.168.0.29<\/pre><p><br \/><\/p><p><br \/><\/p><p><br \/><\/p><h1 align=\"center\" style=\"padding:15px 0px 5px;margin:0px;font-size:1.6em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(25,52,65);white-space:normal;\"><span style=\"color:rgb(255,0,0);background-color:rgb(0,0,0);\">linux iptable \u4f7f\u7528\u6307\u5357<\/span><\/h1><p><span style=\"font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;background-color:rgb(252,255,245);\">linux\u7cfb\u7edf\u4e2d,\u9632\u706b\u5899(Firewall),\u7f51\u5740\u8f6c\u6362(NAT),\u6570\u636e\u5305(package)\u8bb0\u5f55,\u6d41\u91cf\u7edf\u8ba1,\u8fd9\u4e9b\u529f\u80fd\u662f\u7531Netfilter\u5b50\u7cfb\u7edf\u6240\u63d0\u4f9b\u7684\uff0c\u800ciptables\u662f\u63a7\u5236Netfilter\u7684\u5de5\u5177.<\/span><span style=\"font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;background-color:rgb(252,255,245);\">iptables\u5c06\u8bb8\u591a\u590d\u6742\u7684\u89c4\u5219\u7ec4\u7ec7\u6210\u6210\u5bb9\u6613\u63a7\u5236\u7684\u65b9\u5f0f\uff0c\u4ee5\u4fbf\u7ba1\u7406\u5458\u53ef\u4ee5\u8fdb\u884c\u5206\u7ec4\u6d4b\u8bd5\uff0c\u6216\u5173\u95ed\u3001\u542f\u52a8\u67d0\u7ec4\u89c4\u5219\u3002<\/span><\/p><p><\/p><h1 style=\"padding:15px 0px 5px;margin:0px;font-size:1.6em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(25,52,65);white-space:normal;\">1. \u672f\u8bed\u89e3\u91ca<\/h1><ul style=\"padding:0px;margin:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\" class=\"list-paddingleft-2\"><li><p><strong style=\"padding:0px;margin:0px;\">DNAT<\/strong><\/p><\/li><li><p>Destination Network Address Translation \u76ee\u6807\u7f51\u7edc\u5730\u5740\u8f6c\u6362\u3002 DNAT\u662f\u4e00\u79cd\u6539\u53d8\u6570\u636e\u5305\u76ee\u7684ip\u5730\u5740\u7684\u6280\u672f\uff0c\u7ecf\u5e38\u548cSNAT\u8054\u7528\uff0c\u4ee5\u4f7f\u591a\u53f0\u670d\u52a1\u5668\u5171\u4eab\u4e00\u4e2aip\u5730\u5740\u8fde\u5165Internet\uff0c\u5e76\u4e14\u7ee7\u7eed\u670d\u52a1\u3002\u901a\u8fc7\u5bf9\u540c\u4e00\u4e2aip\u5730\u5740\u5206\u914d\u4e0d\u540c\u7aef\u53e3\uff0c\u6765\u51b3\u5b9a\u6570\u636e\u7684\u6d41\u5411\u3002<\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;\"><br \/><\/p><\/li><li><p><strong style=\"padding:0px;margin:0px;\">SNAT<\/strong><\/p><\/li><li><p>Source Network Address Translation\u6e90\u7f51\u7edc\u5730\u5740\u8f6c\u6362\u3002\u8fd9\u662f\u4e00\u79cd\u6539\u53d8\u6570\u636e\u5305\u6e90ip\u5730\u5740\u7684\u6280\u672f\uff0c \u7ecf\u5e38\u7528\u6765\u4f7f\u591a\u53f0\u8ba1\u7b97\u673a\u5206\u4eab\u4e00\u4e2aInternet\u5730\u5740\u3002\u8fd9\u53ea\u5728IPv4\u4e2d\u4f7f\u7528\uff0c\u56e0\u4e3aIPv4\u7684\u5730\u5740\u5df2\u5feb\u7528\u5b8c\u4e86\uff0cIPv6\u5c06\u89e3 \u51b3\u8fd9\u4e2a\u95ee\u9898\u3002<\/p><\/li><\/ul><p><br \/><\/p><br \/><h1 style=\"padding:15px 0px 5px;margin:0px;font-size:1.6em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(25,52,65);white-space:normal;\">2. iptable \u6982\u8ff0<\/h1><h2 style=\"padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;\">2.1. iptable\u7684\u94fe\u548c\u8868\u7ed3\u6784<\/h2><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\"><img align=\"middle\" src=\"http:\/\/www.51know.info\/system_security\/iptable\/ip_flow.PNG\" border=\"0\" alt=\"ip_flow.PNG\" class=\"magnify\" style=\"padding:0px;margin:0px;border:none;\" \/><\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\">\u5982\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0ciptable\u603b\u4f53\u7ed3\u6784.<\/p><h2 style=\"padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;\">2.2. 5\u4e2a\u94fe(chain)<\/h2><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\"><img align=\"middle\" src=\"http:\/\/www.51know.info\/system_security\/iptable\/iptable_chain.png\" border=\"0\" alt=\"iptable_chain.png\" class=\"magnify\" style=\"padding:0px;margin:0px;border:none;\" \/><\/p><ul style=\"padding:0px;margin:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\" class=\"list-paddingleft-2\"><li><p><strong style=\"padding:0px;margin:0px;\">PREROUTING<\/strong><\/p><\/li><li><p>\u5728\u6570\u636e\u5305\u8fdb\u5165\u9632\u706b\u5899\u4e4b\u540e\u3001\u8def\u7531\u5224\u65ad\u4e4b\u524d\u5bf9\u6570\u636e\u5305\u8fdb\u884c\u4fee\u6539<\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;\"><br \/><\/p><\/li><li><p><strong style=\"padding:0px;margin:0px;\">INPUT<\/strong><\/p><\/li><li><p>\u5728\u6570\u636e\u5305\u88ab\u8def\u7531\u5230\u672c\u5730\u4e4b\u540e\uff0c\u4f46\u5728\u7528\u6237\u7a7a\u95f4\u7a0b\u5e8f\u770b\u5230\u5b83\u4e4b\u524d\u5bf9\u6570\u636e\u5305\u8fdb\u884c\u4fee\u6539<\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;\"><br \/><\/p><\/li><li><p><strong style=\"padding:0px;margin:0px;\">OUTPUT<\/strong><\/p><\/li><li><p>\u7528\u6237\u7a7a\u95f4\u7a0b\u5e8f\u5904\u7406\u6570\u636e\u5305\u540e\uff0c\u7531\u672c\u5730\u53d1\u51fa\uff0c\u518d\u6b21\u88ab\u8def\u7531\u4e4b\u524d\u66f4\u6539\u6570\u636e\u5305<\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;\"><br \/><\/p><\/li><li><p><strong style=\"padding:0px;margin:0px;\">FORWARD<\/strong><\/p><\/li><li><p>\u5728\u6700\u521d\u7684\u8def\u7531\u5224\u65ad\u4e4b\u540e\u3001\u6700\u540e\u4e00\u6b21\u66f4\u6539\u5305\u7684\u6e90\u5730\u5740\u4e4b\u524d\u5bf9\u6570\u636e\u5305\u8fdb\u884c\u4fee\u6539<\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;\"><br \/><\/p><\/li><li><p><strong style=\"padding:0px;margin:0px;\">POSTROUTING<\/strong><\/p><\/li><li><p>\u5728\u6240\u6709\u8def\u7531\u5224\u65ad\u4e4b\u540e,\u5bf9\u6570\u636e\u5305\u8fdb\u884c\u4fee\u6539<\/p><\/li><\/ul><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\"><strong style=\"padding:0px;margin:0px;\">\u6ce8\u610f:<\/strong>&nbsp;\u94fe \u662f\u6bcf\u4e2a\u6570\u636e\u5305\u6d41\u9700\u8981\u7ecf\u8fc7\u7684\u4e0d\u540c\u73af\u8282\uff0c\u4f60\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u73af\u8282\u6839\u636e\u9700\u8981\u8bbe\u7f6e\u4e0d\u540c\u7684\u8fc7\u6ee4\u7b56\u7565,<strong style=\"padding:0px;margin:0px;\">\u6bcf\u4e2a\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u90fd\u662fAccept<\/strong><\/p><h2 style=\"padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;\">2.3. 4\u4e2a\u8868(table)<\/h2><ul style=\"padding:0px;margin:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\" class=\"list-paddingleft-2\"><li><p><strong style=\"padding:0px;margin:0px;\">Mangle\u8868<\/strong><\/p><\/li><li><p>\u8fd9\u4e2a\u8868\u4e3b\u8981\u7528\u6765mangle\u5305\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528mangle\u5339\u914d\u6765\u6539\u53d8\u5305\u7684\u4e00\u4e9b\u5c5e\u6027\uff0c\u6bd4\u5982 TOS\uff08TYPE OF SERVICE),TTL (TIME TO LIVE),MARK(\u540e\u7eed\u6d41\u91cf\u63a7\u5236TC\u7b49)<\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;\"><br \/><\/p><\/li><li><p><strong style=\"padding:0px;margin:0px;\">Nat\u8868<\/strong><\/p><\/li><li><p>\u6b64\u8868\u4ec5\u7528\u4e8eNAT\uff0c\u4e5f\u5c31\u662f\u8f6c\u6362\u5305\u7684\u6e90\u6216\u76ee\u6807\u5730\u5740\u3002\u6ce8\u610f\uff0c\u5c31\u8c61\u6211\u4eec\u524d\u9762\u8bf4\u8fc7\u7684\uff0c\u53ea\u6709\u6d41\u7684\u7b2c\u4e00\u4e2a \u5305\u4f1a\u88ab\u8fd9\u4e2a\u94fe\u5339\u914d\uff0c\u5176\u540e\u7684\u5305\u4f1a\u81ea\u52a8\u88ab\u505a\u76f8\u540c\u7684\u5904\u7406(DNAT,SNAT,MASQUERADE)<\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;\"><br \/><\/p><\/li><li><p><strong style=\"padding:0px;margin:0px;\">Filter\u8868<\/strong><\/p><\/li><li><p>\u6b64\u8868\u7528\u6765\u8fc7\u6ee4\u6570\u636e\u5305\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4efb\u4f55\u65f6\u5019\u5339\u914d\u5305\u5e76\u8fc7\u6ee4\u5b83\u4eec\u3002 \u6211\u4eec\u5c31\u662f\u5728\u8fd9\u91cc\u6839\u636e\u5305\u7684\u5185\u5bb9\u5bf9\u5305\u505aDROP\u6216ACCEPT\u7684.<br style=\"padding:0px;margin:0px;\" \/>iptalbe\u4e2d,\u8981\u7528&nbsp;<strong style=\"padding:0px;margin:0px;\">-t<\/strong>&nbsp;\u53c2\u6570\u6307\u5b9a\u8981\u64cd\u4f5c\u54ea\u4e2a\u8868,\u5982\u679c\u6ca1\u6709&nbsp;<strong style=\"padding:0px;margin:0px;\">-t<\/strong>&nbsp;\u53c2\u6570\uff0c\u5c31\u9ed8\u8ba4\u5bf9<strong style=\"padding:0px;margin:0px;\">filter\u8868<\/strong>\u64cd\u4f5c.<\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;\"><br \/><\/p><\/li><li><p><strong style=\"padding:0px;margin:0px;\">Raw\u8868<\/strong><\/p><\/li><li><p>\u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u8bbe\u7f6eraw\u65f6\u4e00\u822c\u662f\u4e3a\u4e86\u4e0d\u518d\u8ba9iptables\u505a\u6570\u636e\u5305\u7684\u94fe\u63a5\u8ddf\u8e2a\u5904\u7406\uff0c\u63d0\u9ad8\u6027\u80fd<\/p><\/li><\/ul><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\"><strong style=\"padding:0px;margin:0px;\">\u6ce8\u610f:<\/strong>&nbsp;\u8868 \u662f\u89c4\u5219\u7684\u96c6\u5408\u7ec4,<strong style=\"padding:0px;margin:0px;\">\u6bcf\u4e2a\u8868\u4e2d\u7684\u89c4\u5219\u6761\u76ee\u662f\u6309\u987a\u5e8f\u5339\u914d\u7684<\/strong>,\u4f60\u53ef\u4ee5\u5728\u6570\u636e\u5305\u7ecf\u8fc7\u7684\u4e0d\u540c\u73af\u8282\u8bbe\u7f6e\u89c4\u5219,\u8868\u7684\u5904\u7406\u4f18\u5148\u7ea7\uff1a<strong style=\"padding:0px;margin:0px;\">raw &gt; mangle &gt; nat &gt; filter<\/strong><\/p><h2 style=\"padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;\">2.4. \u8be6\u7ec6\u7684\u6570\u636e\u5305\u6d41\u7a0b<\/h2><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\"><img align=\"middle\" src=\"http:\/\/www.51know.info\/system_security\/iptable\/packet_flow.png\" border=\"0\" alt=\"packet_flow.png\" class=\"magnify\" style=\"padding:0px;margin:0px;border:none;\" \/><\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\">\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u6570\u636e\u5305\u6d41\u73af\u8282\u548c\u8868\u7684\u914d\u5408\u4f7f\u7528\u65b9\u6cd5.<\/p><br \/><h1 style=\"padding:15px 0px 5px;margin:0px;font-size:1.6em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(25,52,65);white-space:normal;\">3. iptable\u5e94\u7528\u573a\u666f<\/h1><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\"><img align=\"middle\" src=\"http:\/\/www.51know.info\/system_security\/iptable\/iptable_example.gif\" border=\"0\" alt=\"iptable_example.gif\" class=\"magnify\" style=\"padding:0px;margin:0px;border:none;\" \/><\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\">\u4e0a\u56fe\u662f\u5e94\u7528\u573a\u666f\u7684\u7b80\u5355\u62d3\u6251\u63cf\u8ff0,\u4e0b\u9762\u7684\u5e94\u7528\u573a\u666f\u4e3e\u4f8b\uff0c\u90fd\u4ee5\u4e0a\u56fe\u4e3a\u53c2\u8003.<br style=\"padding:0px;margin:0px;\" \/><strong style=\"padding:0px;margin:0px;\">\u7cfb\u7edf\u542f\u52a8\u7684\u65f6\u5019\u6240\u6709\u7684\u9ed8\u8ba4\u7b56\u7565\u90fd\u662fACCEPT<\/strong>,\u5728\u4e0b\u9762\u7684\u573a\u666f\u4e3e\u4f8b\u4e2d\uff0c\u6211\u4eec\u90fd\u662f\u5728\u8fd9\u79cd\u524d\u63d0\u4e0b\u8bbe\u5b9aiptable\u7684<br style=\"padding:0px;margin:0px;\" \/><strong style=\"padding:0px;margin:0px;\">\u4e0b\u9762\u6bcf\u4e2a\u573a\u666f\u4e3e\u4f8b\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u6ca1\u6709\u76f8\u5173\u8054\u6027\u7684<\/strong><\/p><h2 style=\"padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;\">3.1. \u7f51\u5173\u670d\u52a1\u5668\u5b89\u5168\u7b56\u7565<\/h2><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\">\u76ee\u6807 : \u7f51\u5173\u670d\u52a1\u5668\u7cfb\u7edf\u81ea\u751f\u5b89\u5168\u7b56\u7565\uff0c\u53ea\u5bf9\u5185\u7f51\u7528\u6237\u5f00\u653e22\u7aef\u53e3(sshd\u670d\u52a1)<\/p><pre class=\"brush:bash;toolbar:false\">&nbsp;&nbsp;#\u6e05\u7a7a&nbsp;filter&nbsp;table\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-F&nbsp;-t&nbsp;filter\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-X&nbsp;-t&nbsp;filter\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-Z&nbsp;-t&nbsp;filter\n&nbsp;&nbsp;\n&nbsp;&nbsp;#\u6e05\u7a7a&nbsp;nat&nbsp;table\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-F&nbsp;-t&nbsp;nat\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-X&nbsp;-t&nbsp;nat\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-Z&nbsp;-t&nbsp;nat\n&nbsp;&nbsp;\n&nbsp;&nbsp;#\u8bbe\u7f6e\u9ed8\u8ba4\u7b56\u7565(INPUT\u94fe\u9ed8\u8ba4\u4e3aDROP)\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-t&nbsp;filter&nbsp;-P&nbsp;INPUT&nbsp;DROP\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-t&nbsp;filter&nbsp;-P&nbsp;OUTPUT&nbsp;ACCEPT\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-t&nbsp;filter&nbsp;-P&nbsp;FORWARD&nbsp;ACCEPT\n&nbsp;&nbsp;\n&nbsp;&nbsp;#\u56de\u73af\u63a5\u53e3(lo),\u9ed8\u8ba4accept\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;ALL&nbsp;-i&nbsp;lo&nbsp;-j&nbsp;ACCEPT\n&nbsp;&nbsp;\n&nbsp;&nbsp;#\u53ea\u5bf9\u5185\u7f51\u7528\u6237\u5f00\u653esshd\u670d\u52a1\n&nbsp;&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;-s&nbsp;192.168.138.0\/24&nbsp;--dport&nbsp;22&nbsp;-j&nbsp;ACCEPT<\/pre><p><span style=\"font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;background-color:rgb(252,255,245);\"><\/span><\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\">\u8bf4\u660e: \u9632\u706b\u5899\u7684\u7b56\u7565\u987a\u5e8f\u4e00\u822c\u90fd\u662f \u4ece&nbsp;<strong style=\"padding:0px;margin:0px;\">\u975e\u4fe1\u4efb ==&gt; \u4fe1\u4efb<\/strong>,\u9ed8\u8ba4\u5173\u95ed\u6240\u6709\u8bbf\u95ee\u6743\u9650,\u7136\u540e\u6309\u7167\u9700\u8981\u9010\u6761\u5f00\u653e\u8bbf\u95ee\u6743\u9650.<\/p><h2 style=\"padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;\">3.2. \u5171\u4eab\u4e0a\u7f51(nat)<\/h2><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\">\u76ee\u6807\uff1a\u4f7f\u5c40\u57df\u7f51\u7684\u7528\u6237\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5916\u7f51\u7684\u670d\u52a1\u5668<\/p><pre class=\"brush:bash;toolbar:false\">&nbsp;[root@localhost]#&nbsp;echo&nbsp;1&nbsp;&gt;&nbsp;\/proc\/sys\/net\/ipv4\/ip_forward\n&nbsp;[root@localhost]#&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-o&nbsp;ppp0&nbsp;-j&nbsp;MASQUERADE<\/pre><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\"><strong style=\"padding:0px;margin:0px;\">\u8bf4\u660e: SNAT \u548c MASQUERADE \u533a\u522b<\/strong><\/p><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\">SNAT : \u4e0d\u7ba1\u662f\u51e0\u4e2a\u5730\u5740\uff0c\u5fc5\u987b\u660e\u786e\u7684\u6307\u5b9a\u8981SNAT\u7684ip\uff0c\u9002\u5408\u7f51\u5173\u670d\u52a1\u5668\u6709\u56fa\u5b9a\u5730\u5740\u6216\u8005\u662f\u56fa\u5b9a\u5730\u5740\u8303\u56f4. MASQUERADE : \u662f\u9488\u5bf9ADSL\u52a8\u6001\u62e8\u53f7\u8fd9\u79cd\u573a\u666f\u800c\u8bbe\u8ba1,\u4ece\u670d\u52a1\u5668\u7684\u7f51\u7edc\u63a5\u53e3\u4e0a,\u81ea\u52a8\u83b7\u53d6\u5f53\u524dip\u5730\u5740\u6765\u505aNAT,\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u52a8\u6001SNAT\u5730\u5740\u8f6c\u6362<\/p><h2 style=\"padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;\">3.3. \u5185\u7f51\u7684\u670d\u52a1\u5668\u5bf9\u5916\u670d\u52a1(\u7aef\u53e3\u6620\u5c04)<\/h2><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\">\u76ee\u6807\uff1a\u4f7f\u5916\u7f51\u7528\u6237\u53ef\u4ee5\u8bbf\u95ee\u5230\u5c40\u57df\u7f51<strong style=\"padding:0px;margin:0px;\">192.168.138.21<\/strong>\u8fd9\u53f0<strong style=\"padding:0px;margin:0px;\">HTTP<\/strong>\u670d\u52a1<\/p><pre class=\"brush:bash;toolbar:false\">[root@localhost]#&nbsp;echo&nbsp;1&nbsp;&gt;&nbsp;\/proc\/sys\/net\/ipv4\/ip_forward\n[root@localhost]#&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;DNAT&nbsp;--to-destination&nbsp;192.168.138.21\n[root@localhost]#&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-o&nbsp;ppp0&nbsp;-j&nbsp;MASQUERADE<\/pre><h2 style=\"padding:5px 0px;margin:0px;font-size:1.4em;font-family:'Helvetica Neue', 'Trebuchet MS', Arial, sans-serif;color:rgb(160,8,13);white-space:normal;\">3.4. \u5728\u7f51\u5173\u670d\u52a1\u5668\u8fdb\u884c\u900f\u660e\u4ee3\u7406<\/h2><p style=\"padding:5px 0px;margin-top:0px;margin-bottom:0px;font-family:'Helvetica Neue', Tahoma, 'Trebuchet MS', sans-serif;font-size:12.8px;line-height:19.2px;white-space:normal;\">\u76ee\u6807: \u4f7f\u5c40\u57df\u7f51\u7528\u6237,\u8bbf\u95ee\u5916\u7f51web\u670d\u52a1\u65f6\uff0c\u81ea\u52a8\u4f7f\u7528squid\u4f5cweb\u900f\u660e\u4ee3\u7406\u670d\u52a1\u5668\u3002<\/p><pre class=\"brush:bash;toolbar:false\">[root@localhost]#&nbsp;echo&nbsp;1&nbsp;&gt;&nbsp;\/proc\/sys\/net\/ipv4\/ip_forward\n[root@localhost]#&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;192.168.138.0\/24&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-i&nbsp;eth0&nbsp;-j&nbsp;DNAT&nbsp;--to&nbsp;192.168.138.1\n[root@localhost]#&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;192.168.138.0\/24&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-i&nbsp;eth0&nbsp;-j&nbsp;REDIRECT&nbsp;--to&nbsp;3128&nbsp;\n[root@localhost]#&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-o&nbsp;ppp0&nbsp;-j&nbsp;MASQUERADE<\/pre>", '#result');
  }

  function insertCodeElement(content, container){
    container = container || document;
    // 创建一个 div 来放置获取到的内容，这样就可以把 content 字符串内容转换成 dom
    // 方便我们对这个 dom 进行操作（只是创建 div，并没有插入到文档，他只存在于内存中）
    var parent = document.createElement('div');
    parent.innerHTML = content;

    // 找到 parent 中的所有 pre 标签，并遍历
    var $pres = $(parent).find('pre');
    $pres.each(function(index, el) {
      var $el = $(el),
          html = $el.html(),
          code = document.createElement('code'),
          elClass = $el.attr('class');
      if(!elClass) {return};
          // 获取 pre 标签中，class 属性中包含的本段代码所有的编程语言
      var language = elClass.substring(6, elClass.indexOf(';'));

      code.className = 'language-' + language;
      code.innerHTML = html;

      $el.html(code);
    });

    $(container).html(parent.innerHTML);

    // 最后，调用 Prism 的方法来高亮代码
    Prism.highlightAll();
  }
	window._bd_share_config={
    "common":{
      "bdText":"linux下使用iptables禁止PING，iptables NAT",
      "bdDesc":$("#abstract_bdshare").text(),
      "bdMini":"2",
      "bdMiniList":false,
      "bdPic":"https://s1.51cto.com/images/201710/25/bd540a4f14d822f6e69087758699358b.jpg",
      "bdStyle":"0",
      "bdSize":"16"
    },
    "share":{}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
  setTimeout(function(){
  	$('.bdsharebuttonbox a').removeAttr('title')
  },1000);

	var now_time = 1559668174; //当前时间
  setInterval(function(){now_time+=0.01},10);

  // 初始化页面
  updatePage();
  // 页面tab切换
  zDate.visibilityAction(function () {
    zDate.getServerTime(function (e) {
      var updateResult = new Date(e).getTime();
      now_time = +updateResult.toString().substr(0, 10);
      updatePage();
    });
   })
  // 定时刷新现在时间
  setInterval(function () {
    zDate.getServerTime(function (e) {
      var updateResult = new Date(e).getTime();
      now_time = +updateResult.toString().substr(0, 10);
      updatePage();
    });
  }, 1000*60*2);
  // 页面刷新
  function updatePage() {
    $('.presell').each(function(index, item) {
      var end_time = $(this).data('end'); // 结束时间
      if (!end_time) {
        return;
      }
      var me = $(this);
      if (me.lastTime) {
        clearInterval(me.lastTime);
        me.lastTime = null;
      } else {
        me.lastTime = setInterval(function() {
          zDate.setLastTimePc(me.find('.timespan'), (end_time*1000-now_time*1000), me.lastTime, function() {
						me.parents('.right').find('.cloumn-subscribe').removeClass('presell-color');
						me.remove();
						$('.pre-tips').remove();
					});
        }, 10);
      }
    });
  }
		//二维码显示
		$(".group_git_box").hover(function(){
			$(this).parents('.group_img_box').find(".group_code_box").show()
		},function(){
			$(this).parents('.group_img_box').find(".group_code_box").hide()
		})  
</script>
</div>
<script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/marked.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/highlight.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/detail_mp.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/detail.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/details_new.js"></script><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/copy.js"></script>    
<div style="display:none">
    <iframe scrolling="no" src="http://log.51cto.com/pageview.php?frompos=blog_art" width="0" height="0" frameborder="0"></iframe>
</div>

<script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/pvlog.js"></script>
<script>
  $(".gotop").click(function(){$(window).scrollTop(0)})
</script>


    <script type="text/javascript">
    //百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2283d46608159c3b39fc9f1178809c21";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();

    //自动推送链接
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
    </script>

    <script type="text/javascript">
      var _vds = _vds || [];
      window._vds = _vds;
      (function(){
        _vds.push(['setAccountId', '8c51975c40edfb67']);
        (function() {
          var vds = document.createElement('script');
          vds.type='text/javascript';
          vds.async = true;
          vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'assets.growingio.com/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
      //document.write(decodeURI("%3Cscript src='https://tongji.51cto.com/frontend/tj.gif' type='text/javascript'%3E%3C/script%3E"));
    </script>
    
<script>
  var uid = '';
  var BLOG_URL = 'https://blog.51cto.com/';
</script>
<script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/jquery_003.js"></script>
<script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/time-on-page.js" charset="utf-8"></script>
<script>
    (function(){
        var wh=$(window).height(),fh=$('.Footer').outerHeight(true),hh=$('.Header').outerHeight(true)
        $('.Content-box').css({'min-height': wh-fh-hh})
    })()
</script>


<div id="zhichiBtnBox" style="position: fixed; z-index: 2147483583; box-shadow: rgba(15, 66, 76, 0.25) 0px 0px 14px 0px; width: 60px; height: 60px; border-radius: 50%; background-color: rgb(66, 133, 244); background-image: url(&quot;//www.sobot.com/chat/frame/imgs/icon.png&quot;); background-repeat: no-repeat; background-position: 18px -58px; right: 40px; bottom: 90px; display: none;"><a hidefocus="" id="zhichiBtn" style="position:relative;text-decoration: none; outline: none; font-family: Microsoft Yahei, Arial, Helvetica; color: #fff; font-size: 16px; display: inline-block; margin: 0; padding: 0; border: none; line-height:43px; float:none;width:100%;height:100%;border-radius:50%;"><span class="zc-advice-icon-btn-title" style="box-shadow: rgba(107, 113, 114, 0.15) 0px 2px 4px 0px; border: 1px solid rgb(235, 239, 240); font-family: Microsoft Yahei, Arial, Helvetica; color: rgb(85, 85, 86); font-size: 13px; margin: 0px; text-align: right; background: rgb(255, 255, 255) none repeat scroll 0% 0%; position: absolute; top: 15px; right: 70px; text-overflow: ellipsis; white-space: nowrap; word-break: normal; display: none; border-radius: 3px; padding: 0px 5px; height: 30px; line-height: 30px;">咨询在线客服</span></a><i style="position:absolute;top:0px;right:0px;padding:1px;line-height:20px;text-align:center;color:#fff;font-weight:bold;height:18px;min-width:18px;background-color:#ed5c5c;border-radius:18px;font-size:12px;display:none;font-style:normal;" id="zhichiCount"></i></div><script src="linux%E4%B8%8B%E4%BD%BF%E7%94%A8iptables%E7%A6%81%E6%AD%A2PING%EF%BC%8Ciptables%20NAT-%E4%BB%8E%E5%BF%83%E5%BC%80%E5%A7%8B-51CTO%E5%8D%9A%E5%AE%A2_files/offlineMsgSize.json"></script></body></html>