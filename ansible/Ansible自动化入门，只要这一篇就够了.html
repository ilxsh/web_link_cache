<!DOCTYPE html>
<!-- saved from url=(0070)https://baijiahao.baidu.com/s?id=1650879841344431164&wfr=spider&for=pc -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="referrer" content="always"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><link rel="shortcut icon" href="https://gss0.bdstatic.com/5bd1bjqh_Q23odCf/static/wiseindex/img/favicon64.ico" type="image/x-icon"><link rel="apple-touch-icon-precomposed" href="https://gss0.bdstatic.com/5bd1bjqh_Q23odCf/static/wiseindex/img/screen_icon_new.png"><title>Ansible自动化入门，只要这一篇就够了</title><link rel="stylesheet" href="./Ansible自动化入门，只要这一篇就够了_files/land_min_pack_34b2c65.css"><meta itemprop="dateUpdate" content="2019-11-22 13:48:24"></head><body style=""><script>/* eslint-disable */var s_domain = {"protocol":"https:","staticUrl":"https://ss0.bdstatic.com/5aV1bjqh_Q23odCf/","base":"","baseuri":"","passconf":"http://passport.baidu.com/ubrwsbas","logout":"https://passport.baidu.com/?logout&u=","bs":"https://www.baidu.com","sp":"http://hi.baidu.com/","ssllist":{"a.hiphotos.baidu.com":"ss0.baidu.com/94o3dSag_xI4khGko9WTAnF6hhy","b.hiphotos.baidu.com":"ss1.baidu.com/9vo3dSag_xI4khGko9WTAnF6hhy","c.hiphotos.baidu.com":"ss3.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy","d.hiphotos.baidu.com":"ss0.baidu.com/-Po3dSag_xI4khGko9WTAnF6hhy","e.hiphotos.baidu.com":"ss1.baidu.com/-4o3dSag_xI4khGko9WTAnF6hhy","f.hiphotos.baidu.com":"ss2.baidu.com/-vo3dSag_xI4khGko9WTAnF6hhy","g.hiphotos.baidu.com":"ss3.baidu.com/-fo3dSag_xI4khGko9WTAnF6hhy","h.hiphotos.baidu.com":"ss0.baidu.com/7Po3dSag_xI4khGko9WTAnF6hhy","1.su.bdimg.com":"ss0.bdstatic.com/k4oZeXSm1A5BphGlnYG","t10.baidu.com":"ss0.baidu.com/6ONWsjip0QIZ8tyhnq","t11.baidu.com":"ss1.baidu.com/6ONXsjip0QIZ8tyhnq","t12.baidu.com":"ss2.baidu.com/6ONYsjip0QIZ8tyhnq","himg.bdimg.com":"ss1.bdstatic.com/7Ls0a8Sm1A5BphGlnYG","cdn00.baidu-img.cn":"ss0.bdstatic.com/9bA1vGba2gU2pMbfm9GUKT-w","cdn01.baidu-img.cn":"ss0.bdstatic.com/9bA1vGfa2gU2pMbfm9GUKT-w"}};var s_session = {"ssid":"5153b20a","logid":"","sid":"31731_1451_21084_31780_31673_31464_30824_22159","nid":"9637286766742930286","qid":""};var s_advert = {"isBjh":"1","contentUrl":"http://baijiahao.baidu.com/s?id=1650879841344431164","contentPlatformId":"3","contentType":"1","pvid":"9e29f90c0001cdc0","time":"2020-06-02 14:42:26","contentAccType":"1","ctk":"c005d1898cb1ca8c","contentAccId":"hHsWMIJiQFB_ji7Gulmu3Q","ctk_b":"ce6bcfebf6e1bd2c","logid":"2546485780","dtime":"1591080146","grade":"3","createTimeAccLevel":"2"};</script><script>/* eslint-disable */var bds={se:{},su:{urdata:[],urSendClick:function(){},urStatic:"https://ss.bdimg.com"},util:{},use:{},comm:{domain:"",ubsurl:"",tn:"",queryEnc:"",queryId:"",inter:"",sugHost:"",query:"",qid:"",cid:"",sid:"",stoken:"",serverTime:"",user:"",username:"",loginAction:[],useFavo:"",pinyin:"",favoOn:"",curResultNum:"0",rightResultExist:false,protectNum:0,zxlNum:0,pageNum:1,pageSize:10,ishome:1,newindex:1}};var name,navigate,al_arr=[];var selfOpen=window.open;eval("var open = selfOpen;");var isIE=navigator.userAgent.indexOf("MSIE")!=-1&&!window.opera;var E=bds.ecom={};bds.se.mon={loadedItems:[],load:function(){},srvt:-1};try{bds.se.mon.srvt=parseInt(document.cookie.match(new RegExp("(^| )BDSVRTM=([^;]*)(;|$)"))[2]);document.cookie="BDSVRTM=;expires=Sat, 01 Jan 2000 00:00:00 GMT"}catch(e){}var bdUser=bds.comm.user?bds.comm.user:null,bdQuery=bds.comm.query,bdUseFavo=bds.comm.useFavo,bdFavoOn=bds.comm.favoOn,bdCid=bds.comm.cid,bdSid=bds.comm.sid,bdServerTime=bds.comm.serverTime,bdQid=bds.comm.queryId,bdstoken=bds.comm.stoken,login_success=[];</script><div id="detail-page"><div class="line-shadow"></div><div class="item-wrap"><div id="header_wrap" class="header_wrap"><div class="header_content"><div class="header_logo"><a href="https://www.baidu.com/" id="result_logo" data-clklog="tid:139;cst:2;logInfo:head_logo;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:1;" data-rid="head_0"><img src="./Ansible自动化入门，只要这一篇就够了_files/logo_top.png" alt="到百度首页" title="到百度首页"></a></div><div class="header_menu" data-rid="header_menu"><a href="https://www.baidu.com/" class="index" data-clklog="tid:142;cst:2;logInfo:head_menu" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:1;type:backindex" data-rid="head_1">百度首页</a><span class="line"></span><div id="userBlock" class="login" style="display: inline-block;"><a href="https://passport.baidu.com/v2/?login&amp;tpl=mn&amp;u=http://www.baidu.com" class="login" data-clklog="tid:142;cst:2;logInfo:head_menu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:1;type:login" data-rid="head_2">登录</a><a href="http://i.baidu.com/" id="usrname" class="usrname" data-clklog="tid:142;cst:2;logInfo:head_menu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:1;type:usrname;" data-rid="head_2"><span id="nametxt">后知后觉后觉醒</span></a><div id="user_menu" data-showlog="tid:131;cst:1;logInfo:usrmenu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:1;" class="s-isindex-wrap s-user-set-menu menu-top" style="display: none;"><a href="http://i.baidu.com/" id="usrname" class="usrname" data-clklog="tid:142;cst:2;logInfo:head_menu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:1;type:usrname;" data-rid="head_2"></a><div><a href="http://i.baidu.com/" id="usrname" class="usrname" data-clklog="tid:142;cst:2;logInfo:head_menu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:1;type:usrname;" data-rid="head_2"></a><a href="http://i.baidu.com/center" target="_blank" data-tid="1000" data-clklog="tid:146;cst:2;logInfo:usrmenu;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:1;type:center;" data-rid="usr_menu_1">个人中心</a><a href="http://passport.baidu.com/" data-tid="1001" target="_blank" data-clklog="tid:146;cst:2;logInfo:usrmenu;" data-extralog="rid:;pos:2;extra:;isBaiJiaHao:1;login:1;type:passport;" data-rid="usr_menu_2">帐号设置</a><a class="s-feedback" style="overflow:hidden" href="https://baijiahao.baidu.com/s?id=1650879841344431164&amp;wfr=spider&amp;for=pc#" onclick="return false;" data-clklog="tid:146;cst:2;logInfo:usrmenu;" data-extralog="rid:;pos:3;extra:;isBaiJiaHao:1;login:1;type:feedback;" data-rid="header_menu_3">意见反馈</a><a class="quit" style="overflow:hidden" href="https://passport.baidu.com/?logout&amp;u=https://www.baidu.com" data-clklog="tid:146;cst:2;logInfo:usrmenu;" data-extralog="rid:;pos:4;extra:;isBaiJiaHao:1;login:1;type:quit;" data-rid="usr_menu_4">退出</a></div><span class="menu-arrow"><em></em></span></div></div></div></div></div></div><div class="title_border"><div class="anci_header_content"><div class="article-title"><h2>Ansible自动化入门，只要这一篇就够了</h2></div><div class="article-desc clearfix"><div class="author-icon"><img src="./Ansible自动化入门，只要这一篇就够了_files/timg"><i class="author-vip author-vip-3"></i></div><div class="author-txt"><p class="author-name">虫虫搜奇</p><div class="article-source article-source-bjh"><span class="date">发布时间：19-11-22</span><span class="time">13:48</span><span class="account-authentication">科技达人，优质创作者</span></div></div></div></div></div><div id="content-container" class="content-container clearfix" data-showlog="tid:126;cst:1;logInfo:landing;" data-extralog="flow:2;st:news;rid:9637286766742930286;pos:0;extra:;source:1;isBaijiahao:1;login:1;appId:1593008639420175;" data-ratio="1" data-rid="page"><div id="left-container" class="left-container"><div class="item-wrap"><div class="article " id="article" data-islow-browser="0"><div class="article-content"><p><span class="bjh-p">我们知道现在自动化工具中，最简单、易于上手，而且最流行的当属Ansible莫属了。和Chef、Puppet等Ruby工具甚至同时Python系的Saltstack等CS架构的自动化工具相比虽然执行性能上可能会稍一点，但是无需客户端，只需SSH就可以管理优势还是相当明显的。服务器上架后无需额外操作就可以直接进行操作，比如服务器的初始化标准配置等。本文虫虫给大家介绍就是Ansible入门教程，如果此前已有对应的基础可以忽略本文。<span class="bjh-br"></span></span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./Ansible自动化入门，只要这一篇就够了_files/a8773912b31bb05156d92772c42b13b14bede047.jpeg" data-loaded="0"></div><p><span class="bjh-h3">概述</span></p><p><span class="bjh-p">Ansible是一个开源配置管理工具，可以使用它来自动化任务，部署应用程序实现IT基础架构。Ansible可以用来自动化日常任务，比如，服务器的初始化配置、安全基线配置、更新和打补丁系统，安装软件包等。Ansible架构相对比较简单，仅需通过SSH连接客户机执行任务即可：</span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./Ansible自动化入门，只要这一篇就够了_files/d0c8a786c9177f3ef2e7a557829ef2c29e3d5674.jpeg" data-loaded="0"></div><p><span class="bjh-p">Ansible使用过程中会用到一些概念术语，我们先介绍一下。</span></p><p><span class="bjh-p">Ansible的与节点有关的重要术语包括控制节点，受管节点，清单和主机文件：</span></p><p><span class="bjh-p">控制节点（Control node）：指安装了Ansible的主机，也叫Ansible服务器端,管理机。 Ansible控制节点主要用于发布运行任务，执行控制命令。Ansible的程序都安装在控制节点上，控制节点需要安装Python和Ansible所需的各种依赖库。注意：目前Ansible还不能安装在Windows下。</span></p><p><span class="bjh-p">受控节点（Managed nodes）：也叫客户机，就是想用Ansible执行任务的客户服务器。</span></p><p><span class="bjh-p">清单（Inventory）：受控节点的列表，就是所有要管理的主机列表。</span></p><p><span class="bjh-p">host文件：清单列表通常保存在一个名为host文件中。在host文件中，可以使用IP地址或者主机名来表示具体的管理主机和认证信息，并可以根据主机的用户进行分组。缺省文件：/etc/ansible/hosts，可以通过-i指定自定义的host文件。</span></p><p><span class="bjh-p">模块（Modules）：模块是Ansible执行特定任务的代码块。比如：添加用户，上传文件和对客户机执行ping操作等。Ansible现在默认自带450多个模块，，Ansible Galaxy公共存储库则包含大约1600个模块。</span></p><p><span class="bjh-p">任务（Task）：是Ansible客户机上执行的操作。可以使用ad-hoc单行命令执行一个任务。</span></p><p><span class="bjh-p">剧本(Playbook):是利用YAML标记语言编写的可重复执行的任务的列表，playbook实现任务的更便捷的读写和贡献。比如，在Github上有大量的Ansible playbooks共享，你要你有一双善于发现的眼睛你就能找到大量的宝藏。</span></p><p><span class="bjh-p">角色（roles）：角色是Ansible 1.2版本引入的新特性，用于层次性、结构化地组织playbook。roles能够根据层次型结构自动装载变量文件、tasks以及handlers等。</span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./Ansible自动化入门，只要这一篇就够了_files/7c1ed21b0ef41bd512788660a38b48ce38db3dd6.jpeg" data-loaded="0"></div><p><span class="bjh-h3">Ansible的优势</span></p><p><span class="bjh-p">Ansible作为最受欢迎的自动化配置工具，主要得益于其设计上的优势。</span></p><p><span class="bjh-h3">无需客户端</span></p><p><span class="bjh-p">与Chef、Puppet以及Saltstack（现在也支持Agentless方式salt-ssh）不同，Ansible是无客户端Agent的，所以无需在客户机上安装或配置任何程序，就可以运行Ansible任务。由于Ansible不会在客户机上安装任何软件或运行监听程序，因此消除了许多管理开销，我们可以在即可上手使用Ansible管理服务器，同时Ansible的更新也不会影响任何客户机。</span></p><p><span class="bjh-h3">使用SSH进行通讯</span></p><p><span class="bjh-p">默认情况下，Ansible使用SSH协议在管理机和客户机之间进行通信。可以使用SFTP与客户机进行安全的文件传输。</span></p><p><span class="bjh-h3">并行执行</span></p><p><span class="bjh-p">Ansible与客户机并行通信，可以更快地运行自动化任务。默认情况下，forks值为5，可以按需，在配置文件中增大该值。</span></p><p><span class="bjh-h3">安装Ansible</span></p><p><span class="bjh-p">Ansible可以运行在任何机器上，但是对管理机有一定要求。管理机应安装Python 2（2.7）或Python 3（3.5或更高版本），另外，管理机不支持Windows控制节点。我们可以使用Linux发行版包管理器、源码安装或者Python包管理器（PIP）来安装Ansible。</span></p><p><span class="bjh-h3">redhat系</span></p><p><span class="bjh-p">sudo yum install ansible 或者dnf install ansible</span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./Ansible自动化入门，只要这一篇就够了_files/6159252dd42a28349e91ed56a9e400ef15cebf14.jpeg" data-loaded="0"></div><p><span class="bjh-h3">ubuntu</span></p><p><span class="bjh-p">sudo apt update</span></p><p><span class="bjh-p">sudo apt install software-properties-common</span></p><p><span class="bjh-p">sudo apt-add-repository --yes --update ppa:ansible/ansible</span></p><p><span class="bjh-p">sudo apt install ansible</span></p><p><span class="bjh-h3">通过Pip安装</span></p><p><span class="bjh-p">pip install --user ansible</span></p><p><span class="bjh-p">或者全局性安装</span></p><p><span class="bjh-p">sudo pip install ansible</span></p><p><span class="bjh-h3">源码安装</span></p><p><span class="bjh-p">git clone github.com/ansible/ansible.git</span></p><p><span class="bjh-p">cd ./ansible</span></p><p><span class="bjh-p">source ./hacking/env-setup</span></p><p><span class="bjh-p">安装成功后，可以使用下面命令检查Ansible的安装版本：</span></p><p><span class="bjh-p">ansible –version</span></p><p><span class="bjh-p">ansible 2.9.1</span></p><p><span class="bjh-p">config file = /etc/ansible/ansible.cfg</span></p><p><span class="bjh-p">configured module search path = [u'/home/xx/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']</span></p><p><span class="bjh-p">ansible python module location = /usr/lib/python2.7/site-packages/ansible</span></p><p><span class="bjh-p">executable location = /usr/bin/ansible</span></p><p><span class="bjh-p">python version = 2.7.5 (default, Oct 30 2018, 23:45:53) [GCC 4.8.5 20150623 (Red Hat 4.8.5-36)]</span></p><p><span class="bjh-h3">安全配置</span></p><p><span class="bjh-p">为了使Ansible与客户端通信，需要使用用户帐户配置管理机和客户机。为了方便快捷安全，一般会配置证书方式连接客户机。</span></p><p><span class="bjh-h3">帐号规划</span></p><p><span class="bjh-p">假设我们有四台客户机（node1，node2，node3和node4）和管理机（manage）。为了方便，我们创建一个ansible用户帐户，将该ansible用户添加到wheel组，然后配置SSH身份验证。在配置新用户帐户时，请在所有节点上创建该帐户（注意可以使用ansible批量创建）：</span></p><p><span class="bjh-p">sudo useradd ansible</span></p><p><span class="bjh-p">然后将ansible用户添加到wheel组：</span></p><p><span class="bjh-p">sudo usermod -aG wheel ansible</span></p><p><span class="bjh-p">为用户设置密码：</span></p><p><span class="bjh-p">sudo passwd ansible</span></p><p><span class="bjh-p">接下来，使用visudo配置/etc/sudoers文件,赋予ansible用户使用sudo执行特权命令：</span></p><p><span class="bjh-p">%wheel ALL=(ALL) NOPASSWD: ALL</span></p><p><span class="bjh-h3">配置证书登陆</span></p><p><span class="bjh-p">在所有客户机和管理上创建新的ansible用户之后，我们在管理机（ansible用户）生成SSH密钥，然后将SSH公钥复制到所有客户机。</span></p><p><span class="bjh-p">sudo su - ansible</span></p><p><span class="bjh-p">ssh-keygen</span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./Ansible自动化入门，只要这一篇就够了_files/dcc451da81cb39db60181bbd2247c021a91830dc.jpeg" data-loaded="0"></div><p><span class="bjh-p">现在，将SSH公钥复制到所有客户机，这使管理机ansible用户无需输入密码即可登录客户机：</span></p><p><span class="bjh-p">ssh-copy-id ansible@node1</span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./Ansible自动化入门，只要这一篇就够了_files/a71ea8d3fd1f41345dca1fc7d74e5ccfd0c85e65.jpeg" data-loaded="0"></div><p><span class="bjh-p">第一次使用，完成以后，就可以直接用证书登陆了。</span></p><p><span class="bjh-h3">Ansible配置</span></p><p><span class="bjh-p">默认的配置文件位于/etc/ansible/ansible.cfg下。可以使用此配置文件来修改绝Ansible大多数设置，一般无需额外多配置，默认配置应能满足大多数使用情况。关于Ansible配置文件，其执行程序会按照一定顺序搜索配置：</span></p><p><span class="bjh-p">Ansible按照以下顺序搜索配置文件，优先配置优先使用，而忽略其余配置文件：</span></p><p><span class="bjh-p">$ANSIBLE_CONFIG环境变量。</span></p><p><span class="bjh-p">任务当前目录下的：ansible.cfg（如果在当前目录中）。</span></p><p><span class="bjh-p">当前用户下的ansible.cfg：~/.ansible.cfg</span></p><p><span class="bjh-p">默认配置文件：/etc/ansible/ansible.cfg。</span></p><p><span class="bjh-p">默认清单配置文件位于/etc/ansible/hosts中，但是通过ansible.cfg配置文件中修改此位置。也可以通过-i自定义hosts清单。</span></p><p><span class="bjh-p">为了安全起见，虫虫建议你，不要直接在/etc/ansible/host配置清单，尤其是有用户认账等信息时候。对于长期不执行ansible可以将host文件加密锁定，防止信息泄露，引起安全事故。</span></p><p><span class="bjh-p">清单文件格式如下：</span></p><p><span class="bjh-p">[nodes]</span></p><p><span class="bjh-p">node1</span></p><p><span class="bjh-p">node2</span></p><p><span class="bjh-p">node3</span></p><p><span class="bjh-p">node4</span></p><p><span class="bjh-p">[web]</span></p><p><span class="bjh-p">node2</span></p><p><span class="bjh-p">node3</span></p><p><span class="bjh-p">可以对不同用途分组，用[]指定分组名。</span></p><p><span class="bjh-h3">Ansible ad-hoc单行命令执行</span></p><p><span class="bjh-p">ad-hoc命令行是我们可以随手执行的单个ansible任务，是ansible任务快速执行方式。对于一些快速获取的任务使用ad-doc命令非常简便有效，而且有助于我们学习和熟悉Ansible的使用。</span></p><p><span class="bjh-h3">命令行选项</span></p><p><span class="bjh-p">常用的Ansible命令行选项如下：</span></p><p><span class="bjh-p">-b，--become：特权方式运行命令。</span></p><p><span class="bjh-p">-m：要使用的模块名称。</span></p><p><span class="bjh-p">-a，--args：制定模块所需的参数。</span></p><p><span class="bjh-p">-u：制定连接的用户名。</span></p><p><span class="bjh-p">-h，--help显示帮助内容。</span></p><p><span class="bjh-p">-v，--verbose以详细信息模式运行命令，可以用来调试错误。</span></p><p><span class="bjh-p">更多选项和说明详见Ansible官方文档。下面我们介绍几个简单实例示范：</span></p><p><span class="bjh-p">使用ping模块检查与客户机的连接性，请执行以下操作：</span></p><p><span class="bjh-p">ansible all -m ping</span></p><p><span class="bjh-p">在上面的命令中，all指定Ansible应该在所有主机上运行此命令，也可以按照分组比如nodes 或者主机 node1等。执行结果如下：</span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./Ansible自动化入门，只要这一篇就够了_files/574e9258d109b3de16fdb17f3feea584800a4c3a.jpeg" data-loaded="0"></div><p><span class="bjh-p">可见node1是通的，而node2和node4不通。</span></p><p><span class="bjh-h3">使用ad-hoc命令管理软件包</span></p><p><span class="bjh-p">使用Ansible的ad-hoc命令，可以给客户端安装软件包。我们只需执行一个单行命令，然后实现安装。</span></p><p><span class="bjh-p">比如：在分组客户机安装Apache只需要执行：</span></p><p><span class="bjh-p">ansible web -m yum yum -a "name=httpd state=present" -b</span></p><p><span class="bjh-h3">使用ad-hoc命令管理服务</span></p><p><span class="bjh-p">上面我们给web组的客户机批量安装了Apache服务器，下面我们来看怎么启动httpd服务。</span></p><p><span class="bjh-p">启动httpd服务只需要执行：</span></p><p><span class="bjh-p">ansible web -b -m service -a "name=httpd enabled=yes"</span></p><p><span class="bjh-p">要启动，重新启动和停止该服务，只需state参数的值更改为started以启动服务，restarted以重新启动服务，stop来停止服务：</span></p><p><span class="bjh-p">ansible webservers -b -m service -a "name=httpd state=started"</span></p><p><span class="bjh-p">Ansible ad-hoc命令非常出色，适合于运行单个任务。具体任务模块可以参考官方文档。</span></p><p><span class="bjh-h3">Ansible Playbook</span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./Ansible自动化入门，只要这一篇就够了_files/d53f8794a4c27d1e3a342170e984646bdcc438cf.jpeg" data-loaded="0"></div><p><span class="bjh-p">Playbook 是Ansible提供的最强大的任务执行方法。与ad-hoc命令不同，Playbooks配置在文件中，可以重用和共享给其他人。</span></p><p><span class="bjh-p">playbooks是以YAML标记语言来定义的。每个playbook由一个或多个play组成。play的目标是将一组主机映射到任务中去。每个play包含一个或多个任务，这些任务每次执行一次。</span></p><p><span class="bjh-p">下面是一个简单的Ansible httpd.yaml playbook，用于给web组上安装Apache服务器：</span></p><p><span class="bjh-p">---</span></p><p><span class="bjh-p">- hosts: web</span></p><p><span class="bjh-p">remote_user: ansible</span></p><p><span class="bjh-p">tasks:</span></p><p><span class="bjh-p">- name: Ensure apache is installed and updated</span></p><p><span class="bjh-p">yum:</span></p><p><span class="bjh-p">name: httpd</span></p><p><span class="bjh-p">state: latest</span></p><p><span class="bjh-p">become: yes</span></p><p><span class="bjh-p">执行playbook使用ansible-playbook命令，格式如下：</span></p><p><span class="bjh-p">ansible-playbook -i &lt;hostfile&gt; &lt;playbook.yaml&gt;</span></p><p><span class="bjh-p">ansible-playbook httpd.yaml结果：</span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./Ansible自动化入门，只要这一篇就够了_files/c8ea15ce36d3d5394a3a9997c8d62055352ab033.jpeg" data-loaded="0"></div><p><span class="bjh-p">下面是一个综合多个任务的多个play的playbook，实现</span></p><p><span class="bjh-p">安装apche服务器。</span></p><p><span class="bjh-p">在Web服务器组中启用并启动httpd服务。</span></p><p><span class="bjh-p">在所有客户机上安装git。</span></p><p><span class="bjh-p">其内容如下：</span></p><p><span class="bjh-p">---</span></p><p><span class="bjh-p">- hosts: web</span></p><p><span class="bjh-p">remote_user: ansible</span></p><p><span class="bjh-p">become: yes</span></p><p><span class="bjh-p">tasks:</span></p><p><span class="bjh-p">- name: Installing apache</span></p><p><span class="bjh-p">yum:</span></p><p><span class="bjh-p">name: httpd</span></p><p><span class="bjh-p">state: latest</span></p><p><span class="bjh-p">- name: Enabling httpd service</span></p><p><span class="bjh-p">service:</span></p><p><span class="bjh-p">name: httpd</span></p><p><span class="bjh-p">enabled: yes</span></p><p><span class="bjh-p">notify:</span></p><p><span class="bjh-p">- name: restart httpd</span></p><p><span class="bjh-p">handlers:</span></p><p><span class="bjh-p">- name: restart httpd</span></p><p><span class="bjh-p">service:</span></p><p><span class="bjh-p">name: httpd</span></p><p><span class="bjh-p">state: restarted</span></p><p><span class="bjh-p">- hosts: all</span></p><p><span class="bjh-p">remote_user: ansible</span></p><p><span class="bjh-p">become: yes</span></p><p><span class="bjh-p">tasks:</span></p><p><span class="bjh-p">- name: Installing git</span></p><p><span class="bjh-p">yum:</span></p><p><span class="bjh-p">name: git</span></p><p><span class="bjh-p">state: latest</span></p><p><span class="bjh-h3">总结</span></p><p><span class="bjh-p">Ansible是一个方便快捷又功能强大的自动化执行和配置管理工具。本文只是Ansible的入门教程，介绍了Ansible的基本概念、优势、安装，配置和简单的使用。师傅领进门修行靠自己，Ansible更强大的功能和实现自己基于它的全任务自动化需要自己使用探索。当然前面也提到了网络上尤其是Github上已经有大量Ansible的技术积累(ansible-role-xxxx)可供大家学习参考。</span></p></div><audio height="0" width="0" id="musicAudio" data-play-index=""><source></audio></div></div></div><div id="right-container" class="right-container"><div class="item-wrap"><div class="recent-article" data-pos=""><h2>作者最新文章<ul><li data-showlog="tid:135;cst:1;logInfo:recent_article;" data-extralog="rid:;pos:0;extra:;isBaiJiaHao:1;login:1;" data-rid="recent_article_0"><h3 class="item-title"><a href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9596272960174226472%22%7D&amp;n_type=1&amp;p_from=3" data-clklog="tid:147;cst:2;logInfo:recent_article;" data-extralog="rid:;pos:0;extra:;isBaiJiaHao:1;login:1;" target="_blank">Linux 内核5.7发布，新功能变化总结</a></h3><div class="item-desc hide"><span class="info-date">06-01</span><span class="info-time">12:20</span></div></li><li data-showlog="tid:135;cst:1;logInfo:recent_article;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:1;" data-rid="recent_article_1"><h3 class="item-title"><a href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9415747994195523394%22%7D&amp;n_type=1&amp;p_from=3" data-clklog="tid:147;cst:2;logInfo:recent_article;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:1;" target="_blank">受SaltStack漏洞影响，思科6台VIRL-PE后端服务器被黑</a></h3><div class="item-desc hide"><span class="info-date">05-29</span><span class="info-time">14:33</span></div></li><li data-showlog="tid:135;cst:1;logInfo:recent_article;" data-extralog="rid:;pos:2;extra:;isBaiJiaHao:1;login:1;" data-rid="recent_article_2"><h3 class="item-title"><a href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_10423050415407482177%22%7D&amp;n_type=1&amp;p_from=3" data-clklog="tid:147;cst:2;logInfo:recent_article;" data-extralog="rid:;pos:2;extra:;isBaiJiaHao:1;login:1;" target="_blank">新型弱电场口罩可杀冠状病毒</a></h3><div class="item-desc hide"><span class="info-date">05-29</span><span class="info-time">10:23</span></div></li></ul></h2></div></div><div class="item-wrap"><div class="related-news"><div class="news-content "><h2>相关文章</h2><ul><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:0;extra:;isBaiJiaHao:1;login:1;" data-rid="related_news_0"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:0;extra:;isBaiJiaHao:1;login:1;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9030210783117053122%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">网页游戏编程预告</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:1;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9030210783117053122%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./Ansible自动化入门，只要这一篇就够了_files/u=3406486783,1770175709&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:1;extra:;isBaiJiaHao:1;login:1;" data-rid="related_news_1"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:1;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9489833023237735950%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">Flask实战！从后台管理到人脸识别，六款优质Flask开源项目介绍</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:2;extra:;isBaiJiaHao:1;login:1;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9489833023237735950%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./Ansible自动化入门，只要这一篇就够了_files/u=1654807196,2735772762&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:2;extra:;isBaiJiaHao:1;login:1;" data-rid="related_news_2"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:2;extra:;isBaiJiaHao:1;login:1;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_10117282618206796211%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">Python是啥？竟然彻底改变了老板对我的看法……</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:3;extra:;isBaiJiaHao:1;login:1;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_10117282618206796211%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./Ansible自动化入门，只要这一篇就够了_files/u=46015090,3691105267&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:3;extra:;isBaiJiaHao:1;login:1;" data-rid="related_news_3"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:3;extra:;isBaiJiaHao:1;login:1;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9378361686770292948%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">Java基础教程：Java包和权限修饰符</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:4;extra:;isBaiJiaHao:1;login:1;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9378361686770292948%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./Ansible自动化入门，只要这一篇就够了_files/u=1212578926,3663498729&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:4;extra:;isBaiJiaHao:1;login:1;" data-rid="related_news_4"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:4;extra:;isBaiJiaHao:1;login:1;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9137750429096806496%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">华为为什么不用国产操作系统鸿蒙替代Windows？</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:5;extra:;isBaiJiaHao:1;login:1;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9137750429096806496%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./Ansible自动化入门，只要这一篇就够了_files/u=2805007600,628332662&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li></ul></div></div><div id="relateAd" ad-id="relate-js" class="wangmeng-ad" data-showlog="tid:369;cst:1;logInfo:adsjs;" data-clklog="tid:370;cst:2;logInfo:adsjs;" data-extralog="rid:;pos:5;extra:;baijiahao:1;login:1;"></div></div></div></div><div id="bottom-container" class="bottom-container "><div class="copy-right"><div class="baidu-info"><a class="sethome" href="https://www.baidu.com/cache/sethelp/index.html" target="_blank"><span>设为首页</span></a><span class="copyright-text"><span>©&nbsp;Baidu&nbsp;</span><a href="https://www.baidu.com/duty/" target="_blank">使用百度前必读</a>&nbsp;<a href="http://jianyi.baidu.com/" target="_blank">意见反馈</a>&nbsp;<span>京ICP证030173号&nbsp;</span><img width="13" height="16" src="./Ansible自动化入门，只要这一篇就够了_files/copy_rignt_24.png"></span></div><div class="recordcode"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11000002000001" target="_blank"><i></i>京公网安备11000002000001号</a></div></div><div class="back-to-top" data-showlog="tid:133;cst:1;logInfo:back_to_top;" data-clklog="tid:138;cst:2;logInfo:back_to_top;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:1;" data-rid="back_to_top" style="visibility: hidden;"><div class="icon-text"><span>返回顶部</span></div><div class="icon-arrow"><span></span></div></div></div></div><script type="text/javascript">window.onload = function () {var contentContainer = document.getElementById('content-container');var bottomContainer = document.getElementById('bottom-container');var rightContainer = document.getElementById('right-container');var minContentHeight = window.innerHeight - bottomContainer.offsetHeight;if (contentContainer.offsetHeight < minContentHeight) {contentContainer.style.height = minContentHeight + 'px';bottomContainer.className += ' fixed';}if (rightContainer.children.length === 0) {rightContainer.style.width = parseInt(rightContainer.offsetWidth + 1, 10) + 'px';}};</script><script type="text/javascript" src="./Ansible自动化入门，只要这一篇就够了_files/jquery_0affbc1.js.download"></script><script type="text/javascript" src="./Ansible自动化入门，只要这一篇就够了_files/land_min_pack_8e22d87.js.download"></script><script type="text/javascript" src="./Ansible自动化入门，只要这一篇就够了_files/index_bd58962.js.download"></script></body></html>