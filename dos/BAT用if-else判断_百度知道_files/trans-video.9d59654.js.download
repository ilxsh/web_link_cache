define("question-new:widget/js/trans-video/trans-video",function(e,t,i){var a=e("common:widget/js/util/tangram/tangram"),o=e("common:widget/js/util/log/log"),n=e("question-new:widget/videos/js/cyberplayer"),d=e("question-new:widget/js/trans-video/intersection-observer"),r={},l={},c={},s=function(e,t){this.init=function(e,t){var i=this;window.IntersectionObserver&&d.init(),window.onbeforeunload||(window.onbeforeunload=function(){for(var e in r)o.send({mid:e,count:r[e],page:"qb",module:"qb-answer-video",qid:F.context("page").qid});for(var t in l)o.send({mid:t,count:l[t],page:"qb",module:"qb-ask-video",qid:F.context("page").qid});for(var i in c)c[i].totalPlayTime&&o.send({mid:i,originDuration:c[i].duration,totalPlayTime:c[i].totalPlayTime,page:"qb",qid:F.context("page").qid,rid:c[i].rid})}),e&&t?i.createPlayer(e,t):i.createPlayers(e)},this.createPlayers=function(e){var t=this,i=a(document.getElementById(e)),d=i.find("vvideo");d.length>0&&(o.addKey({isVideo:"isVideo"}),o.send({videoQb:"video-qb-answer",page:"qb",module:"qb-answer-video",action:"pv",qid:F.context("page").qid}));for(var l=0;l<d.length;l++){var s=d[l].id,m=d[l].getAttribute("src"),u=d[l].getAttribute("img"),g=d[l].getAttribute("mid"),p=d[l].getAttribute("rid"),y=d[l].getAttribute("duration"),b=d[l].getAttribute("transcodeStatus")||0,v=2===parseInt(b,10);c[s]={duration:y,rid:p},function(i){t[i]=n(i).setup({flashplayer:"https://gss0.bdstatic.com/7051cy89QMgCncy6lo7D0j9wexYrbOWh7c50/videoPage/cyberplayer.flash.swf",width:519,height:310,autostart:!1,stretching:"uniform",volume:100,controls:!0,repeat:!1,controlbar:{barlogo:!0},repeat:!0,starttime:0,image:u,file:m,ak:""}).on("ready",function(){a(body).find(".jw-warning").each(function(){a(this).hide()}),a(body).find(".machine-recommend-image-icon").each(function(){a(this).hide()});var e="margin-bottom: 15px;"+document.getElementById(i).getAttribute("style");document.getElementById(i).setAttribute("style",e);var o=document.getElementById(i),n=o.querySelector(".jw-display-icon-container");o.querySelector(".jw-media").id=""+i,a(n).hide();var d=document.createElement("div");if(d.setAttribute("class","play-icon"),document.getElementById(i).appendChild(d),v&&a(d).click(function(){t[i].play()}),!v){var l=document.createElement("div");a(l).css({width:"100%",height:"100%",position:"absolute",zIndex:2,top:0,left:0}),document.getElementById(i).appendChild(l)}var c=new IntersectionObserver(function(e){e=e[0];var t=e.target.id;e.intersectionRatio&&(r[t]?r[t]+=1:r[t]=1)});c.observe(document.getElementById(""+i))}).on("play",function(n){"buffering"===n.oldstate&&o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:p,mid:i,action:"videoplay",duration:y});var d=document.getElementById(i).querySelector(".play-icon");a(d).hide(),t[i].start=+new Date,t[i].totalPlayTime=t[i].totalPlayTime||0,c[i].totalPlayTime=t[i].totalPlayTime||0}).on("time",function(a){t[i].duration=a.position,t[i].totalPlayTime+=+new Date-t[i].start,c[i].totalPlayTime=t[i].totalPlayTime,t[i].start=+new Date,a.position>3&&!t[i].hasPlayed&&(t[i].hasPlayed=!0,o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:p,action:"play",mid:i}))}).on("pause",function(){t[i].totalPlayTime+=+new Date-t[i].start,c[i].totalPlayTime=t[i].totalPlayTime,t[i].status="pause",t[i].duration>3&&o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:p,action:"duration",duration:t[i].duration,totalPlayTime:t[i].totalPlayTime,mid:i})}).on("complete",function(){t[i].status="complete",t[i].totalPlayTime+=+new Date-t[i].start,c[i].totalPlayTime=t[i].totalPlayTime,t[i].duration>3&&o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:p,action:"duration",duration:t[i].duration,totalPlayTime:t[i].totalPlayTime,mid:i}),o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:p,action:"totalPlayTime",totalPlayTime:t[i].totalPlayTime,mid:i,duration:y})}).on("error",function(){o.send({action:"video-play-error",area:"qb-pc",qid:F.context("page").qid,mid:i,rid:p})}),o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:p,mid:g,action:"pv"})}(s)}},this.createPlayer=function(e,t){o.send({area:"ask-video",action:"pv",mid:t.mid,originDuration:t.duration,isVertical:t.height>t.width});var i=this,d=t.transcodeStatus||0,r=2===parseInt(d,10);i[e]=n(e).setup({flashplayer:"https://gss0.bdstatic.com/7051cy89QMgCncy6lo7D0j9wexYrbOWh7c50/videoPage/cyberplayer.flash.swf",width:519,height:310,autostart:!1,stretching:"uniform",volume:100,controls:!0,repeat:!1,controlbar:{barlogo:!0},repeat:!0,starttime:0,image:t.cover_img,file:t.video_url,ak:""}).on("ready",function(){a(body).find(".jw-warning").each(function(){a(this).hide()}),a(body).find(".machine-recommend-image-icon").each(function(){a(this).hide()});var t=document.getElementById(e).querySelector(".jw-display-icon-container");a(t).hide();var o=document.createElement("div");if(o.setAttribute("class","play-icon"),document.getElementById(e).appendChild(o),r&&a(o).click(function(){i[e].play()}),!r){var n=document.createElement("div");a(n).css({width:"100%",height:"100%",position:"absolute",zIndex:2,top:0,left:0}),document.getElementById(e).appendChild(n)}var d=new IntersectionObserver(function(e){e=e[0];var t=e.target.id;e.intersectionRatio&&(l[t]?l[t]+=1:l[t]=1)});d.observe(document.getElementById("videoBox"))}).on("play",function(){var t=document.getElementById(e).querySelector(".play-icon");a(t).hide()}).on("time",function(a){i.duration=a.position,a.position>3&&!i.hasPlayed&&(i.hasPlayed=!0,o.send({page:"qb",module:"qb-ask-video",qid:F.context("page").qid,area:e,action:"play",mid:t.mid}))}).on("pause",function(){i.duration>3&&o.send({page:"qb",module:"qb-ask-video",qid:F.context("page").qid,area:e,action:"duration",duration:i.duration,mid:t.mid})}).on("complete",function(){i.duration>3&&o.send({page:"qb",module:"qb-ask-video",qid:F.context("page").qid,area:e,action:"duration",duration:i.duration,mid:t.mid})}),o.addKey({isVideo:"isVideo"}),o.send({page:"qb",module:"qb-ask-video",qid:F.context("page").qid,area:e,mid:t.mid,action:"pv",videoQb:"video-qb-ask"})},this.init(e,t)};i.exports=s});