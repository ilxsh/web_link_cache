;/*!question-new:widget/ask/replyer/replyer.js*/
define("question-new:widget/ask/replyer/replyer",function(require,exports,module){function clearStorage(e){var t=Storage.get("IKNOW_QB_ANSWER_AUTOSAVE")||{};t[e]&&t[e][curQid]&&delete t[e][curQid],Storage.set("IKNOW_QB_ANSWER_AUTOSAVE",t)}function initContent(e){e.answerfr=F.context("extra").answerfr,e.feedback=F.context("feedback"),e.entry="uhome_homecenter_video"===F.context("extra").entry?"recommend_video_list_qb":F.context("extra").entry;var t=Storage.get("IKNOW_QB_ANSWER_AUTOSAVE")||{},o="1"===F.context("user").isLogin?curUid:"nologin";t[o]&&t[o][curQid]&&answerBar.size()&&(editor=editor||getEditor(editorGuide.content,"answer-editor",!0,!1,beforeJump,beforeError,"uhome_homecenter_video"===F.context("extra").entry||"qb_right_videoquestion"===F.context("extra").entry,e,!1,null,!0),log.addKey({auto_expand_editor:1}),$(".wgt-search-relate, .search-relate").show(),editorStatus="up",editor.addListener("ready",function(){editor.setEditorContent(t[o][curQid].content)}))}function getEditor(e,t,o,i,a,n,r,s,d,c,l){t=t||"answer-editor",o=null!=o?o:!0;var u="1"===F.context("user").isLogin,g="1"===F.context("page").isAdopted,m="1"===F.context("newbest"),p=["该提问求助发自手机，请精简回答，方便查看","这个问题你有什么看法，展开讲讲...","提问者正在等待您的回答","请输入您的回答...","详细的问题说明，有助于回答者给出准确的答案","1.步骤类：①整体简介②所需工具/原料③方法/步骤④注意事项<br>2.常识类：①直接回答问题②详细给出具体原因/理由/介绍<br>3.原因类：①详细解释原因/理由②提供有效解决方案（构成见步骤类）<br>4.其他类型详见高质量标准（点击回答框右侧图片）"],h="";h=m?p[1]:u&&g?p[3]:p[2];var v=["undo","redo","removeformat","|","bold","italic","paragraph","|","insertunorderedlist","insertorderedlist","horizontal","blockquote","|","link","insertimage","uploadvideo","map","template","uploadbaiduyun","insertgoods","fullscreen"];"74"===F.context("page").cidTop&&v.push("|","insertcode");var f=Storage.get("SHOW_VIDEO_ANSWER_GIF")||{},w=new Date,b="answer-"+w.getFullYear()+"-"+(w.getMonth()+1)+"-"+w.getDate(),_=!1;f&&!f[b]&&"uhome_homecenter_video"!==F.context("extra").entry&&"qb_right_videoquestion"!==F.context("extra").entry&&(_=!0,f={},f[b]=1,Storage.set("SHOW_VIDEO_ANSWER_GIF",f));var x=F.context("user").bjhGoods||{},y={};if(0===+x.status){y.hasInsertGoodsAuth=!0,x.auth_info?(y.isBindAli=!0,y.aliPid=x.auth_info):y.isBindAli=!1;var b="showInsertGoods"+$.cookie.get("BAIDUID");Storage.get(b)?y.isShowGuideAnimate=!1:(Storage.set(b,!0),y.isShowGuideAnimate=!0)}else y={hasInsertGoodsAuth:!1,isBindAli:!1,isShowGuideAnimate:!1};var I={imageCaption:!0,needHttpsAutoTrans:!0,insertVideoBtnNeedNewIcon:1!==parseInt(F.context("baiduyunTip"),10)&&"uhome_homecenter_video"!==F.context("extra").entry&&"qb_right_videoquestion"!==F.context("extra").entry,insertBaiduYunBtnNeedNewIcon:1===parseInt(F.context("baiduyunTip"),10),showVideoGif:_,forceRecreate:i,dontShowAtFirst:r,scaleEnabled:d,initialFrameWidth:"100%",initialFrameHeight:c||280,toolbars:[v],initialContent:e?e:h,maximumWords:9999,token:F.context("user").stoken},S=UEditor.getEditor(t,$.extend(I,y)),k=!0;F.context("user").isFromBusiness&&(k=!1),S.iknowInit({isLogin:u,submitBtn:"提交回答",anonymouse:k,extraParam:{qid:F.context("page").qid}},function(e){e&&$(e).click(function(e){if($("#"+t).find(".change-to-ueditor").size()&&r){var o=$(".cover-ueditor .toast");return o.show(),void setTimeout(function(){o.hide()},3e3)}editorSubmitHandler(e,S,a,n,s,l)});var i=$(e).closest(".addons");o&&i.append('<p class="answer-editstatus">'+EDITING_HTML+"</p>")});var T=!1,q=function(){T||(T=!0,log.send({action:"input",area:"answer-editor"}))},j=function(){editCountDown&&clearTimeout(editCountDown),editCountDown=setTimeout(function(){var e=editor.getEditorContent(),t=Storage.get("IKNOW_QB_ANSWER_AUTOSAVE")||{},i={time:(new Date).getTime(),content:e,key:curQid},a="1"===F.context("user").isLogin?curUid:"nologin";if("1"===F.context("user").isLogin&&t[curUid])t[curUid][curQid]=i,!$.trim(e)&&t[curUid][curQid]&&delete t[curUid][curQid];else if("1"===F.context("user").isLogin){if(!$.trim(e))return;t[curUid]={},t[curUid][curQid]=i}else if(t.nologin)t.nologin[curQid]=i,!$.trim(e)&&t.nologin[curQid]&&delete t.nologin[curQid];else{if(!$.trim(e))return;t.nologin={},t.nologin[curQid]=i}Storage.set("IKNOW_QB_ANSWER_AUTOSAVE",t),o&&$("#answer-editor").find(".answer-editstatus").html(EDITING_HTML).show(),editingCountDown&&clearTimeout(editingCountDown),editingCountDown=setTimeout(function(){clearTimeout(editingCountDown),o&&$("#answer-editor").find(".answer-editstatus").html(EDITED_HTML)},800);var n=$.object.values(t[a]),r=n.length,s=10;if(r>s){n=n.sort(function(e,t){return e.time-t.time});for(var d=0;r-s>d;d++)delete t[a][n[d].key];Storage.set("IKNOW_QB_ANSWER_AUTOSAVE",t)}},1e3)};return S.addListener("contentChange",q),o&&S.addListener("contentChange",j),S}function showLoad(){$(editor.container).hasClass("iknow-editor-fullscreen")&&editor&&editor.submitBtn&&(editor.submitBtn.style.display="none");var e=$(".layerBg"),t=$("#edui1"),o=t.width()-2,i=t.height()-2,a="height:"+i+"px;width:"+o+"px";if(e.length)e.attr("style",a).show();else{var n=$("<div style='"+a+"' class='layerBg'></div>"),r=$("<span class='loading-layer'></span>");t.append(n,r)}}function createTip(e,t){if($(".loading-layer").hide(),$(".layerBg").hide(),$("."+e).length)$("."+e).show();else{var o=$("#edui1"),i=o.width()-2,a=(o.height()-2,$("<div class='tipLayer'></div>"));o.append(a);var n=$(".tipLayer");n.attr("class","tipLayer "+e).html("<span class='icon'></span><div>"+t+"</div>"),n.css({"margin-left":(i-$(".tipLayer").width())/2+"px",width:"100px"})}}function visitJoin(e){var t="",o=[],i=visitJoinData.length;$(".loading-layer").hide(),$(".layerBg").hide(),i.length<=3?($.each(visitJoinData,function(e,o){t+=['<div class="visit-join-model-item">','<a target="_blank" href="/uteam/view?teamId='+o.teamId+'" class="visit-join-model-img"><img src="'+o.imgUrl+'" alt=""></a>','<h3><a target="_blank" href="/uteam/view?teamId='+o.teamId+'">'+(o.teamName.length>7?o.teamName.slice(0,7):o.teamName)+"</a></h3>","<p><span>"+o.cname+"</span>"+o.userNum+"人</p>",'<a href="javascript:void(0);" data-teamid="'+o.teamId+'" class="visit-join-model-btn">加入</a></div>'].join("")}),o.push(t)):$.each(visitJoinData,function(e,a){t+=['<div class="visit-join-model-item"><a target="_blank" href="/uteam/view?teamId='+a.teamId+'" class="visit-join-model-img"><img src="'+a.imgUrl+'" alt=""></a>','<h3><a target="_blank" href="/uteam/view?teamId='+a.teamId+'">'+(a.teamName.length>7?a.teamName.slice(0,7):a.teamName)+"</a></h3>","<p><span>"+a.cname+"</span>"+a.userNum+"人</p>",'<a href="javascript:void(0);" data-teamid="'+a.teamId+'" class="visit-join-model-btn">加入</a></div>'].join(""),((e+1)%3===0&&0!==e||e===i-1)&&(o.push(t),t="")}),Dialog.alert($visitJoinModelTemplate.html(),{className:"visit-join-model-wrap",title:"提交成功",width:500,height:396,open:function(){var t,a,n=$("#visit-join-model-content");carouselInstance||(carouselInstance=new Carousel({direction:"horizontal",controls:!1,activeIndex:0,items:o,interval:0}),carouselInstance.render(n)),t=n.find(".visit-join-model-btn"),t.click(function(){var e=$(this);e.hasClass("visit-join-model-active")?e.removeClass("visit-join-model-active"):(t.removeClass("visit-join-model-active"),e.addClass("visit-join-model-active"))}),a=n.find(".visit-join-control"),3>=i?a.hide():a.click(function(){var e=$(this),t=e.data("action"),o=0,i=carouselInstance.items.length;"left"===t?e.hasClass("visit-join-control-left-disable")||(carouselInstance.prev(),o=carouselInstance.getActiveIndex()-1,0>=o?e.addClass("visit-join-control-left-disable"):e.removeClass("visit-join-control-left-disable"),e.siblings().removeClass("visit-join-control-right-disable")):e.hasClass("visit-join-control-right-disable")||(carouselInstance.next(),o=carouselInstance.getActiveIndex()+1,o>=i-1?e.addClass("visit-join-control-right-disable"):e.removeClass("visit-join-control-right-disable"),e.siblings().removeClass("visit-join-control-left-disable"))}),$(".visit-join-model-wrap .ui-dialog-titlebar-close").click(function(){$.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e()})},buttons:[{text:"确定",click:function(){var t,o=$("#visit-join-model-content"),i=o.find(".visit-join-model-btn"),a=$("#visit-join-warn");i.each(function(){var e=$(this);return e.hasClass("visit-join-model-active")?(t=e,!0):void 0}),t?($.post("/uteam/submit/applyJoin",{fr:"recalert",teamId:t.data("teamid")},function(t){"string"==typeof t&&(t=$.parseJSON(t)),Dialog.close(),0!==t.errno?Dialog.alert(t.errmsg,{className:"visit-join-model-error",open:function(){$(".visit-join-model-error .ui-dialog-titlebar-close").click(function(){$.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e()})},buttons:[{text:"确定",click:function(){$.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e()}}]}):($.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e())}),log.send({module:"question",action:"visit-join",page:"unview",area:"join-alert"})):(a.animate({height:24}),setTimeout(function(){a.animate({height:0})},1e3))}}]}),log.send({module:"question",action:"visit-join",page:"unview",area:"alert"})}function renderAddtags(e){log.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",addtagsHatch:1});var t=juicer($("#replyer-addtags-tmpl").html());$("body").append(t.render(e));var o=Number(Storage.get("showCount"))+1;Storage.set("showCount",o),$(".tags-box").on("click","li",function(){var e=$(this);e.hasClass("selected")?e.removeClass("selected"):e.addClass("selected")}),$(".addtags-box").on("click",".addtags-close",function(){$(".addtags-box").remove(),location.reload()}).on("click",".addtags-notip",function(){$(".addtags-box").remove(),log.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",addtagsNotip:1}),Storage.set("addtagsHatch","notip"),location.reload()}).on("click",".addtags-sub",function(){var e=getTags();0===e.length?(log.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",notAddtags:1}),window.open("https://zhidao.baidu.com/ihome#body"),location.reload()):(log.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",hasAddtags:1}),$.ajax({url:"/submit/user",type:"post",dataType:"json",data:{cm:100522,tags:e,stoken:F.context("user").stoken}}).done(function(e){0===e.errorNo?setTimeout(function(){window.location="https://zhidao.baidu.com/ihome#body"},500):Dialog.alert(e.errorMsg)}).fail(function(){Dialog.alert("网络故障，请重试")}))})}function getTags(){var e=[];return $(".tags-box li").each(function(){var t=$(this);t.hasClass("selected")&&e.push(t.text())}),e.join("	")}function renderTags(){log.addKey({subHatch:1});var e=juicer($("#replyer-tags-tmpl").html());$("body").append(e.render()),Storage.set("subshowCount",Number(Storage.get("subshowCount"))+1),$(".tags-content").on("click",".tags-close",function(){$(".tags-box").remove(),location.reload()}).on("click",".tags-notip",function(){$(".tags-box").remove(),log.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",subaddtagsNotip:1}),Storage.set("skipHatch","notip"),location.reload()}).on("click",".tags-sub",function(){log.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",subHatchskip:1}),window.open("https://zhidao.baidu.com/ihome#body"),location.reload()})}function reloadPage(){var e=location.href;e.indexOf("hideOtherAnswer")<0?(e.indexOf("#")>0&&(e=e.substring(0,e.indexOf("#"))),location.href=e+=e.indexOf("?")>0?"&hideOtherAnswer=true&newAnswer=1":"?hideOtherAnswer=true&newAnswer=1"):location.reload()}function beforeError(){$(".loading-layer").hide(),$(".layerBg").hide(),log.send({area:"submit",action:"submit-error"})}function beforeJump(e,t){clearStorage(curUid),0==F.context("user").isNew&&0==F.context("user").isHaveCid&&$.ajax({type:"post",url:"/submit/user",data:{cm:100522,word:F.context("page").cid,stoken:F.context("user").stoken}});var o="normal";if($("#answer-for-lottery").size()){var i=juicer($("#answer-for-lottery").html());o="datichoujiang",$("body").append(i.render(t)),$(".affairs-box").on("click",".affairs-close",function(){$(".affairs-box").remove(),setTimeout(function(){$.ajax({url:"/task/api/taskcomnotice",type:"post",data:{op:"reply",from:"PC"},dataType:"json",success:function(e){e.errno||1!==e.data.notice?reloadPage():task.openTaskFinishRewardDialog(e.data,reloadPage)}})},2e3)})}else if(visitJoinData&&visitJoinData.length&&"show"!==$.cookie.get("VISIT_VISIT_MODEL"))visitJoin(function(){reloadPage()});else{Storage.get("showCount")||Storage.set("showCount",0),Storage.get("subshowCount")||Storage.set("subshowCount",0);var a=!F.context("user").tag&&"notip"!==Storage.get("addtagsHatch")&&Storage.get("showCount")<2,n=F.context("user").tag&&0!==F.context("user").tag.length&&"notip"!==Storage.get("skipHatch")&&Storage.get("subshowCount")<2;a&&"true"===F.context("isUnview")?$.ajax({url:"/misc/getrecommendtag",type:"post",dataType:"json",data:{qid:F.context("page").qid}}).done(function(e){0===e.error?renderAddtags(e.data):Dialog.alert(e.errorMsg)}).fail(function(){Dialog.alert("网络故障，请重试")}):n&&"true"===F.context("isUnview")?renderTags():(createTip("success-tip","提交成功"),setTimeout(function(){$.ajax({url:"/task/api/taskcomnotice",type:"post",data:{op:"reply",from:"PC"},dataType:"json",success:function(e){e.errno||1!==e.data.notice?reloadPage():task.openTaskFinishRewardDialog(e.data,reloadPage)}})},2e3))}log.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",rid:t.aid,qid:F.context("page").qid,"10per":F.context("per10"),beforeDialog:o})}function editorSubmitHandler(e,editor,beforeJump,beforeError,answerOptions,showLoading){if(e.preventDefault(),!submitLoading&&(answerOptions.cm=100009,submitLoading=!0,setTimeout(function(){submitLoading=!1},1e3),editor.checkEditor())){var content=editor.getEditorContent();content.indexOf("<baiduyun")>0&&log.send({module:"question-new",page:"question",area:"answer-with-yun",action:"pv"});var hasAliGoods=content.indexOf("aligoods")>-1,txtLength=editor.getContentLength(!0);if(hasAliGoods){var reg=/\<p\>(?=\<aligoods)/g,beforeAliContent=content.split(reg)[0];if($(beforeAliContent).text().length<100)return void popTip("前100字的回答中不可添加商品卡，请修改后重新提交吧")}if(hasAliGoods&&200>txtLength)return void popTip("挂载商品的回答需≥200字，请丰富内容后再提交吧");var key="submitInsertgoods"+$.cookie.get("BAIDUID");if(hasAliGoods&&!Storage.get(key)){Storage.set(key,!0);var insertgoodsConfirmTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="insertgoods-confirm-wrapper">    <div class="title">提交提示</div>    <div class="tips-wrapper">        <div class="tip-item">            <span class="tip-icon"></span>            <span class="tip-content">                因该回答包含回答带货将在48小时内审核完毕，审核通过后您的回答及回答带货才可展现，请至                <a class="tip-detail" href="/ihome/homepage/myanwser?tab_type=goodsReview" target="_blank">个人中心-我的回答-商品审核</a>中查看审核进度。            </span>        </div>        <div class="tip-item">            <span class="tip-icon"></span>            <span class="tip-content">                您挂载的商品仅可在移动端问答页被浏览者查看。            </span>        </div>        <div class="tip-item">            <span class="tip-icon"></span>            <span class="tip-content">                若您挂载的商品违反知道规范或与问答相关性较差，官方将有权取消您的回答带货权益。            </span>        </div>    </div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0](),confirmDialog=new Dialog({content:insertgoodsConfirmTpl,width:410,height:360,dialogClass:"ui-dialog-new",buttons:[{text:"返回修改",click:function(){confirmDialog.close()}},{text:"确认提交",click:function(){confirmDialog.close(),confirmSubmit(showLoading)}}]})}else confirmSubmit(showLoading)}}function confirmSubmit(e){var t="uhome_homecenter_video"===F.context("extra").entry?"recommend_video_list":F.context("extra").entry,o={cm:100009,qid:F.context("page").qid,title:F.context("extra").title,answerfr:F.context("extra").answerfr,feedback:F.context("feedback"),entry:t},i=$.url.getQueryValue(location.href,"youliao_id");i&&(o.youliao_id=i),0==F.context("user").isNew&&0!=$.cookie.get("IK_FORCE_UHOME")&&$.cookie.set("IK_FORCE_UHOME","0",{expires:31536e6,path:"/"}),F.context("extra").entry.indexOf("team_teamtask_")>-1&&(o.teamId=$.url.getQueryValue(window.location.href,"teamId"),o.taskId=$.url.getQueryValue(window.location.href,"taskId"));var a=editor.getEditorContent();o.co=a,o.cite="",o.rich=1,o.edit="new",editor.authcode&&editor.authcode.submitParam(o),editor.anonymouse&&editor.anonymouse.checked&&(o.anoy=1);var n="";o.co&&o.co.match(/<strong>/)&&o.co.match(/<em>/)?n="both":o.co&&o.co.match(/<strong>/)?n="replyBold":o.co&&o.co.match(/<em>/)&&(n="replyRed"),log.send({area:"answer_submit_btn",action:"answer",privilegeSubmit:n,uid:F.context("user").uid}),e&&showLoad(),ec.fire("login.check",{isLogin:function(e){function t(){new Submit({params:o,hasJump:!1,syncId:"answer",jumpSubmitDelay:4500,editor:editor,beforeJump:beforeJump,beforeError:beforeError})}localStorage.removeItem("HAS_NOT_COMMIT_ID"),localStorage.removeItem("HAS_NOT_COMMIT_CONTENT"),1===e.isRealName&&0===$("#passport-accRealName-pop").length?ec.fire("login.realName",{onHide:function(){$(".loading-layer").hide(),$(".layerBg").hide()},onSubmitSuccess:function(){t()}}):1===e.isRealName&&$("#passport-accRealName-pop").length>0?($("#passport-accRealName-pop").show(),$("body").children("div:first-child").show(),$("#passport-accRealName-pop").is(":hidden")?($(".loading-layer").hide(),$(".layerBg").hide()):($(".loading-layer").show(),$(".layerBg").show())):t()},noLogin:function(){$(".loading-layer").hide(),$(".layerBg").hide(),localStorage.setItem("HAS_NOT_COMMIT_ID",F.context("page").qid),localStorage.setItem("HAS_NOT_COMMIT_CONTENT",o.co),log.send({area:"answer_click_loginpop",action:"pv"}),ec.fire("login.log",{onLoginSuccess:function(e){e&&(F.context("user").stoken=e.stoken),1===e.isRealName?($(".loading-layer").hide(),$(".layerBg").hide()):new Submit({params:o,hasJump:!1,syncId:"answer",editor:editor,beforeJump:function(){clearStorage("nologin"),log.send({area:"submit",action:"unlogin-submit-success"}),visitJoinData&&visitJoinData.length&&"show"!==$.cookie.get("VISIT_VISIT_MODEL")?visitJoin(function(){reloadPage()}):(createTip("success-tip","提交成功"),setTimeout(function(){$.ajax({url:"/task/api/taskcomnotice",type:"post",data:{op:"reply",from:"PC"},dataType:"json",success:function(e){e.errno||1!==e.data.notice?reloadPage():task.openTaskFinishRewardDialog(e.data,reloadPage)}})},2e3))},beforeError:function(){$(".loading-layer").hide(),$(".layerBg").hide(),log.send({area:"submit",action:"unlogin-submit-error"})},authcode:editor.authcode||null})}})}})}function showGif(e){var t='<img class="gif" height="72" width="157" src="https://gss0.bdstatic.com/7051cy89RcgCncy6lo7D0j9wexYrbOWh7c50/iknow/answer-video/PCask-1.gif">',o=e.key;$("#"+o+" .edui-editor-toolbarbox .edui-for-insertvideo").append(t),setTimeout(function(){if($("#"+o+" .edui-editor-toolbarbox .edui-for-insertvideo img:last-child").remove(),1!==parseInt(F.context("baiduyunTip"),10)){var e='<span class="insertvideobtn-newicon"></span>';$("#"+o+" .edui-editor-toolbarbox .edui-for-insertvideo").append(e)}},4600)}function coverUeditor(e,t){var o='<div class="cover-ueditor"><span class="change-to-ueditor">默认编辑器</span><div class="toast">请先上传视频再提交回答哦~</div><div class="upload-icon"><div class="upload-svg"></div><p class="upload-text">上传视频</p></div><div class="step"><p>1.请上传与回答相关的视频，在回答中添加无关视频将会导致回答被删除</p><p>2.视频时长在8秒到20分钟内，视频大小需小于2G</p><p>3.无水印，高清晰度视频更佳</p></div></div>',i=document.getElementById(e);i.innerHTML+=o,e="#"+e,$(e+" .cover-ueditor").on("click",function(){$(e+" .cover-ueditor").remove(),$(e+" .change-to-ueditor").remove(),$(e+" .edui-editor").show(),setTimeout(function(){t.execCommand("newinsertvideo")},500)}),$(e+" .change-to-ueditor").on("click",function(){$(e+" .cover-ueditor").remove(),$(e+" .change-to-ueditor").remove(),$(e+" .edui-editor").show();var o=Storage.get("SHOW_VIDEO_ANSWER_GIF")||{},i=new Date,a="answer-"+i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate();o&&!o[a]&&(o={},o[a]=1,Storage.set("SHOW_VIDEO_ANSWER_GIF",o),showGif(t))})}var $=require("common:widget/js/util/tangram/tangram"),UEditor=require("common:widget/js/logic/ueditor/ueditor"),log=require("common:widget/js/util/log/log"),ec=require("common:widget/js/util/event/event"),Submit=require("common:widget/js/logic/submit/submit"),Dialog=require("common:widget/js/ui/dialog/dialog"),Carousel=require("common:widget/js/ui/carousel/carousel"),juicer=require("common:widget/lib/juicer/juicer"),Storage=require("common:widget/js/util/store/store"),editorGuide=require("question-new:widget/ask/editor-guide/editor-guide"),popTip=require("common:widget/js/ui/pop-tip/pop-tip"),task=require("common:widget/task/task-last"),answerBar=$("#answer-bar"),editorStatus="down",editor=null,curQid=""+F.context("page").qid,curUid=""+F.context("user").uid,EDITING_HTML='<i class="iknow-icons answer-editing-icon">&#xe630;</i>回答自动保存中',EDITED_HTML="你输入的回答已保存",editCountDown=null,editingCountDown=null,urlRegObj={ql:/browse(?:\/\d+(?:$|\?lm=2|\?[^lm])|$|\/$|\/\?lm=2)/i,ql_tab_hscore:/browse\/\d*\?lm\=4/,ql_tab_zero:/browse\/\d*\?lm\=8/,ql_tab_emergency:/browse\/\d*\?lm\=16/,zhuanti:/zhidao\.baidu\.com\/s\/([a-zA-Z0-9_\-]+)/,search:/zhidao\.baidu\.com\/search/};!function(){var e,t=document.referrer,o="";for(var i in urlRegObj)if(e=t.match(urlRegObj[i])){o=i;break}if(o&&"zhuanti"==o&&(o=e[1]),!o){var a=$.url.queryToJson(location.search||"");a&&"uc_push"==a.fr&&(o="keyword"==a.push?"uc_tab_keyword":"category"==a.push?"uc_tab_class":"uc_tab_recommand")}var n=F.context("page").isFromWap,r=o+(parseInt(n)?";wap_question_replyed":"");F.context("extra",{title:r,answerfr:r})}(),function(){var e={home:/zhidao\.baidu\.com\/$/,browse:/zhidao\.baidu\.com\/browse/,ihome:/zhidao\.baidu\.com\/ihome(?!\/hangjia)/,qb:/zhidao\.baidu\.com\/question/,hangjia:/zhidao\.baidu\.com\/mavin\/home\/index/,team:/zhidao\.baidu\.com\/team/},t=location.href,o=document.referrer,i=$.url.getQueryValue(t,"entry")||"";if(""==i){for(var a in e)if(o.match(e[a])){i="qb_"+a+"_none";break}i=""==i?"qb_none_none":i}F.context("extra").entry=i}();var answerOptions={qid:F.context("page").qid,title:F.context("extra").title};initContent(answerOptions),log.addKey({has_better_answer_btn:answerBar.length&&answerBar.is(":visible")?1:0}),answerBar.click(function(){var e=$(this).text();log.send({module:"question",action:"click",page:"replyer",area:"have-better-answer-btn",btn_type:e,isLogin:"1"===F.context("user").isLogin?1:0}),editor=editor||getEditor(editorGuide.content,"answer-editor",!0,!1,beforeJump,beforeError,"uhome_homecenter_video"===F.context("extra").entry||"qb_right_videoquestion"===F.context("extra").entry,answerOptions,!1,null,!0),"down"===editorStatus?(editor.expandEditor(function(e){e.style.overflow="inherit",$("#answer-editor").css({visibility:"inherit"})}),editorStatus="up",$(".wgt-search-relate, .search-relate").show()):(editor.collapseEditor(function(e){e.style.overflow="hidden",$("#answer-editor").css({visibility:"hidden"})}),editorStatus="down",$(".wgt-search-relate, .search-relate").hide())});var carouselInstance=null,visitJoinData=F.context("visitJoin"),$visitJoinModelTemplate=$("#visit-join-model-template"),submitLoading=!1;if(function(){if($(".wgt-search-relate").length||"uhome_homecenter_video"===F.context("extra").entry||"qb_right_videoquestion"===F.context("extra").entry)$(".wgt-search-relate").length||"uhome_homecenter_video"!==F.context("extra").entry&&"qb_right_videoquestion"!==F.context("extra").entry||$(".wgt-replyer-line").css("margin-bottom","15px");else{$("<a/>").html('<span class="iknow-icons">&#xe631;</span>搜索资料').addClass("search-relate").attr("href","http://www.baidu.com/s?wd="+encodeURIComponent(F.context("page").title)+"&ie=utf-8").attr("target","_blank").hide().insertBefore("#answer-bar")}}(),"uhome_homecenter_video"===F.context("extra").entry||"qb_right_videoquestion"===F.context("extra").entry||"1"!==F.context("page").isView||"1"===F.context("isExpandAnswer")||F.context("page").qid===localStorage.getItem("HAS_NOT_COMMIT_ID")&&"1"===F.context("user").isLogin){if(!answerBar.size())return;$(function(){log.addKey({auto_expand_editor:1}),$(".wgt-search-relate, .search-relate").show(),editor=editor||getEditor(editorGuide.content,"answer-editor",!0,!1,beforeJump,beforeError,"uhome_homecenter_video"===F.context("extra").entry||"qb_right_videoquestion"===F.context("extra").entry,answerOptions,!1,null,!0),editorGuide(editor),editor.addListener("ready",function(){var e=localStorage.getItem("HAS_NOT_COMMIT_CONTENT");e&&F.context("page").qid===e&&editor.setEditorContent(e)}),("uhome_homecenter_video"===F.context("extra").entry||"qb_right_videoquestion"===F.context("extra").entry)&&coverUeditor("answer-editor",editor),"1"===F.context("isExpandAnswer")&&"1"===F.context("page").isView&&(editorStatus="up")})}module.exports=getEditor});