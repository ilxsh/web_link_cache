var forumApp=angular.module("forumApp",["ui.router","controllers","directives","o2oApiServices","localServices","utilitiesServices"]),controllers=angular.module("controllers",[]),directives=angular.module("directives",[]),o2oApiServices=angular.module("o2oApiServices",["ngResource"]),localApiServices=angular.module("localServices",["ngResource"]),utilitiesServices=angular.module("utilitiesServices",[]),loadingInstance;jQuery.support.cors=!0;loadingInstance=null;forumApp.config(["$httpProvider","$stateProvider",function(n,t){n.interceptors.push(["$rootScope","$q",function(){return{request:function(n){return $.cookie("access_token")!=undefined&&(n.headers.Authorization="Bearer "+$.cookie("access_token")),n}}}]);n.interceptors.push("authHttpResponseInterceptor");n.defaults.headers.get||(n.defaults.headers.get={});n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";n.defaults.headers.get["Cache-Control"]="no-cache";n.defaults.headers.get.Pragma="no-cache";n.interceptors.push("authHttpResponseInterceptor");t.state("Focus",{url:"/Focus",controller:"FocusCtrl",templateUrl:"/Client/Views/User/Focus.html"}).state("MyTopic",{url:"/MyTopic",controller:"MyTopicCtrl",templateUrl:"/Client/Views/User/MyTopic.html"}).state("Setting",{url:"/Setting",controller:"SettingCtrl",templateUrl:"/Client/Views/User/Setting.html"}).state("History",{url:"/History",controller:"HistoryCtrl",templateUrl:"/Client/Views/User/History.html"}).state("Message",{url:"/Message",controller:"MessageCtrl",templateUrl:"/Client/Views/User/Message.html"}).state("Dynamics",{url:"/Dynamics",controller:"DynamicsCtrl",templateUrl:"/Client/Views/User/Dynamics.html"}).state("CircleManage",{url:"/CircleManage",controller:"CircleManageCtrl",templateUrl:"/Client/Views/User/CircleManage.html"}).state("CircleTopicList",{url:"/CircleTopicList/:ID",controller:"CircleTopicListCtrl",templateUrl:"/Client/Views/User/CircleTopicList.html"})}]).factory("authHttpResponseInterceptor",["$q",function(n){return{request:function(n){return n&&n.showLoadingTip&&loadingInstance==null&&(n.method=="GET"?loadingInstance=layer.msg("正在加载中，请耐心等待....",{icon:16,shade:.2,time:0}):n.method=="POST"&&(loadingInstance=layer.msg("正在请求中，请耐心等待....",{icon:16,shade:.2,time:0}))),n},response:function(t){return layer.close(loadingInstance),loadingInstance=null,t||n.when(t)},responseError:function(t){if(layer.close(loadingInstance),loadingInstance=null,t.status===500&&layer.msg("唔！不好意思，服务器请求失败，请检查网络是否良好，稍后重试。",{icon:5}),t.status===401){var i=window.location.href,r=window.location.protocol;location.href=r+"//"+window.location.host+"/Account/Login/?ReturnUrl="+encodeURIComponent(i)}return n.reject(t)}}}]);var sourceUrl="http://forumapi.learnfuture.com/",sourceRoute=sourceUrl+"api",o2oSourceUrl="http://api.learnfuture.com/",o2oSourceRoute=o2oSourceUrl+"api",fileType="/",POST="POST",GET="GET";localApiServices.factory("LocalTopicService",["$resource",function(n){return n("/api/Topic/:actionName"+fileType,{},{Create:{method:POST,params:{actionName:"Create"},isArray:!1},Edit:{method:POST,params:{actionName:"Edit"},isArray:!1}})}]);localApiServices.factory("TopicService",["$resource",function(n){return n(sourceRoute+"/Topic/:actionName"+fileType,{},{GetHighLightList:{method:GET,params:{actionName:"GetHighLightList"},isArray:!1,showLoadingTip:!0},GetHotestList:{method:GET,params:{actionName:"GetHotestList"},isArray:!1,showLoadingTip:!0},GetLastestTopic:{method:GET,params:{actionName:"GetLastestTopic"},isArray:!0},GetToppestViewTopic:{method:GET,params:{actionName:"GetToppestViewTopic"},isArray:!0},GetToppestPostTopic:{method:GET,params:{actionName:"GetToppestPostTopic"},isArray:!0},ThumbsUpTopic:{method:POST,params:{actionName:"ThumbsUpTopic"},isArray:!1},CollectTopic:{method:POST,params:{actionName:"CollectTopic"},isArray:!1},CancelCollectTopic:{method:POST,params:{actionName:"CancelCollectTopic"},isArray:!1},GetTopicListByCircle:{method:GET,params:{actionName:"GetTopicListByCircle"},isArray:!1},GetDetail:{method:GET,params:{actionName:"GetDetail"},isArray:!1},GetMyCollectTopic:{method:GET,params:{actionName:"GetMyCollectTopic"},isArray:!1},GetThumbupTopic:{method:GET,params:{actionName:"GetThumbupTopic"},isArray:!1},GetMyTopic:{method:GET,params:{actionName:"GetMyTopic"},isArray:!1},HighLight:{method:POST,params:{actionName:"HighLight"},isArray:!1},CancelHighLight:{method:POST,params:{actionName:"CancelHighLight"},isArray:!1},Top:{method:POST,params:{actionName:"Top"},isArray:!1},CancelTop:{method:POST,params:{actionName:"CancelTop"},isArray:!1},GetTopicOfMyManageCircle:{method:GET,params:{actionName:"GetTopicOfMyManageCircle"},isArray:!1},Disable:{method:POST,params:{actionName:"Disable"},isArray:!1},Enable:{method:POST,params:{actionName:"Enable"},isArray:!1},GetSearchList:{method:GET,params:{actionName:"GetSearchList"},isArray:!1},GetList:{method:GET,params:{actionName:"GetList"},isArray:!1},Disable:{method:POST,params:{actionName:"Disable"},isArray:!1},CancelThumbsUpTopic:{method:POST,params:{actionName:"CancelThumbsUpTopic"},isArray:!1}})}]);localApiServices.factory("CircleService",["$resource",function(n){return n(sourceRoute+"/Circle/:actionName"+fileType,{},{GetRecomment:{method:GET,params:{actionName:"GetRecomment"},isArray:!0},Follow:{method:POST,params:{actionName:"Follow"},isArray:!1},CancelFollow:{method:POST,params:{actionName:"CancelFollow"},isArray:!1},GetAllCircle:{method:GET,params:{actionName:"GetAllCircle"},isArray:!0},GetListForAddTopic:{method:GET,params:{actionName:"GetListForAddTopic"},isArray:!0},GetMyFollowCircle:{method:GET,params:{actionName:"GetMyFollowCircle"},isArray:!1},GetMyManageCircle:{method:GET,params:{actionName:"GetMyManageCircle"},isArray:!1},GetByID:{method:GET,params:{actionName:"GetByID"},isArray:!1},GetSearchCircle:{method:GET,params:{actionName:"GetSearchCircle"},isArray:!1}})}]);localApiServices.factory("UsefulLinkService",["$resource",function(n){return n(sourceRoute+"/UsefulLink/:actionName"+fileType,{},{GetUsefulLink:{method:GET,params:{actionName:"GetUsefulLink"},isArray:!0}})}]);localApiServices.factory("PostService",["$resource",function(n){return n(sourceRoute+"/Post/:actionName"+fileType,{},{GetAnwsers:{method:GET,params:{actionName:"GetAnwsers"},isArray:!0},GetComments:{method:GET,params:{actionName:"GetComments"},isArray:!0},Create:{method:POST,params:{actionName:"Create"},isArray:!1},Edit:{method:POST,params:{actionName:"Edit"},isArray:!1},ThumbsUp:{method:POST,params:{actionName:"ThumbsUp"},isArray:!1},GetThumbsUpTime:{method:GET,params:{actionName:"GetThumbsUpTime"},isArray:!1},Delete:{method:POST,params:{actionName:"Delete"},isArray:!1},Adopt:{method:POST,params:{actionName:"Adopt"},isArray:!1},CancelThumbsUp:{method:POST,params:{actionName:"CancelThumbsUp"},isArray:!1}})}]);localApiServices.factory("UserCenterService",["$resource",function(n){return n(sourceRoute+"/UserCenter/:actionName"+fileType,{},{GetUserFocus:{method:GET,params:{actionName:"GetUserFocus"},isArray:!1},GetUserMessage:{method:GET,params:{actionName:"GetUserMessage"},isArray:!1},UpdateUserMessage:{method:POST,params:{actionName:"UpdateUserMessage"},isArray:!1},UpdatePassword:{method:POST,params:{actionName:"UpdatePassword"},isArray:!1},UpdateUserAvatar:{method:POST,params:{actionName:"UpdateUserAvatar"},isArray:!1},GetUserAvatar:{method:GET,params:{actionName:"GetUserAvatar"},isArray:!1}})}]);localApiServices.factory("HistoryService",["$resource",function(n){return n(sourceRoute+"/History/:actionName"+fileType,{},{GetMyListToday:{method:GET,params:{actionName:"GetMyListToday"},isArray:!1},GetMyListYesterday:{method:GET,params:{actionName:"GetMyListYesterday"},isArray:!1},GetMyListThisWeek:{method:GET,params:{actionName:"GetMyListThisWeek"},isArray:!1}})}]);localApiServices.factory("DynamicsService",["$resource",function(n){return n(sourceRoute+"/Dynamics/:actionName"+fileType,{},{GetMyList:{method:GET,params:{actionName:"GetMyList"},isArray:!1},ClearMyList:{method:POST,params:{actionName:"ClearMyList"},isArray:!1},Delete:{method:POST,params:{actionName:"Delete"},isArray:!1}})}]);localApiServices.factory("MessageService",["$resource",function(n){return n(sourceRoute+"/Message/:actionName"+fileType,{},{GetMyList:{method:GET,params:{actionName:"GetMyList"},isArray:!1},ClearMyList:{method:POST,params:{actionName:"ClearMyList"},isArray:!1},Delete:{method:POST,params:{actionName:"Delete"},isArray:!1},Read:{method:POST,params:{actionName:"Read"},isArray:!1}})}]);localApiServices.factory("AttachmentService",["$resource",function(n){return n(sourceRoute+"/Attachment/:actionName"+fileType,{},{Create:{method:POST,params:{actionName:"Create"},isArray:!1},GetByID:{method:GET,params:{actionName:"GetByID"},isArray:!1}})}]);localApiServices.factory("anchorScroll",function(){function t(t,i,r){var u=$(window).height();t=$(t);r=r>0?r:u/10;$("html, body").animate({scrollTop:i?t.offset().top-r:t.offset().top+t.outerHeight()+r-u},{duration:200,easing:"linear",complete:function(){n(t)||t[0].scrollIntoView(!!i)}})}function n(n){function e(n){return n>f&&n<o}n=$(n);var r=$(window),t=r.height(),u=n.offset().top,i=n.outerHeight(),f=r.scrollTop(),o=f+t;return e(u+(i>t?t:i)/2)?!0:i>t?e(u+i-t/2):!1}return{toView:t,inView:n}});o2oApiServices.factory("SmsService",["$resource",function(n){return n(o2oSourceRoute+"/SMS/:actionName"+fileType,{},{SendSMS:{method:POST,params:{actionName:"SendSMS"},isArray:!1}})}]);o2oApiServices.factory("FileService",["$resource",function(n){return n(o2oSourceRoute+"/File/:actionName"+fileType,{},{GetParams:{method:GET,params:{actionName:"GetParams"},isArray:!1}})}]);utilitiesServices.factory("Editor",function(){function n(n){var i=function(n){n=$.extend({IsMobile:!1,ElementID:"default",ParamsApi:o2oSourceRoute+"/file/GetParams",OssImageServer:"http://canwayimage.oss-cn-hangzhou.aliyuncs.com/",PublicImageServer:"http://image.learnfuture.com/"},n);var i=window.wangEditor,t=new i("#"+n.ElementID);t.customConfig.uploadImgShowBase64=!0;t.customConfig.uploadOssGetParamsApi=n.ParamsApi;t.customConfig.uploadOssImageServer=n.OssImageServer;t.customConfig.uploadPublicImageServer=n.PublicImageServer;t.customConfig.zIndex=100;t.customConfig.menus=n.IsMobile==!1?["head","bold","italic","underline","strikeThrough","foreColor","backColor","link","justify","emoticon","image","table","undo","redo"]:["image"];try{t.create()}catch(r){console.log("富文本编辑器浏览初始化异常，原因是页面上没有指定id的元素。")}return t},r=function(n){t.txt.html(n)},u=function(n){t.txt.append(n)},f=function(){return t.txt.html()},e=function(){t.txt.clear()},o=function(){var n=t.txt.text(),i=t.txt.html();return!n&&i.indexOf("<img")<0?!0:!1},t=i(n);return{SetContent:function(n){r(n)},AppendContent:function(n){u(n)},GetContent:function(n){return o()?"":f(n)},ClearContent:function(){e()}}}return n});utilitiesServices.factory("LinkHelper",function(){return{LinkBlank:function(n){var r="web-a-link-blank",t=document.getElementById(r),i;t==null&&(t=document.createElement("a"),t.setAttribute("id",r),t.setAttribute("target","_blank"),t.setAttribute("display","none"),document.body.appendChild(t));t.setAttribute("href",n);i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0);t.dispatchEvent(i)},Link:function(n){var r="web-a-link",t=document.getElementById(r),i;t==null&&(t=document.createElement("a"),t.setAttribute("id",r),t.setAttribute("display","none"),document.body.appendChild(t));t.setAttribute("href",n);i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0);t.dispatchEvent(i)}}});controllers.controller("AppTopicDetailCtrl",["$scope","TopicService","PostService","Editor","AttachmentService","LinkHelper",function(n,t,i,r,u,f){var h=layuiForm(),o=new r({ElementID:"answer-editor",IsMobile:!0}),s=new r({ElementID:"answer-edit-editor"}),e;n.TopicID=angular.element("#data_Id").val();n.haslogin=angular.element("#data_haslogin").val();n.thetopictype=angular.element("#data_topictype").val();n.isloadingviewtopic=!0;n.isloadingposttopic=!0;n.isloadingpostlist=!0;n.firstclickthumbup=!0;n.theanswer="";n.init=function(){t.GetToppestViewTopic({},{},function(t){n.ViewTopic=t;n.isloadingviewtopic=!1});t.GetToppestPostTopic({},{},function(t){n.PostTopic=t;n.isloadingposttopic=!1});i.GetAnwsers({topicID:n.TopicID},{},function(t){n.PostList=t;n.isloadingpostlist=!1;angular.forEach(n.PostList,function(n){n.isshowcomment=!1;n.replycontentbig=""})})};n.init();n.getcomment=function(n){n.isshowcomment==!1?i.GetComments({postID:n.ID},{},function(t){n.comment=t;angular.forEach(n.comment,function(n){n.isshowreply=!1;n.replycontent=""});n.isshowcomment=!0}):n.isshowcomment=!1};n.replytosomeone=function(t){if(!n.haslogin){n.startApp();return}t.isshowreply==!0?t.isshowreply=!1:(t.placeholder="回复 "+t.UserNickName,t.isshowreply=!0)};n.replytosomeonesubmit=function(t,r){if(!n.haslogin){n.startApp();return}var u={Content:r.replycontent,TopicID:n.TopicID,ParentPostID:r.ID};i.Create({},u,function(n){n.Success?(layer.msg("评论成功"),i.GetComments({postID:t.ID},{},function(n){t.comment=n;angular.forEach(t.comment,function(n){n.isshowreply=!1;n.replycontent=""})})):layer.msg(n.Message)})};e={versions:function(){var n=navigator.userAgent,t=navigator.appVersion;return{trident:n.indexOf("Trident")>-1,presto:n.indexOf("Presto")>-1,webKit:n.indexOf("AppleWebKit")>-1,gecko:n.indexOf("Gecko")>-1&&n.indexOf("KHTML")==-1,mobile:!!n.match(/AppleWebKit.*Mobile.*/),ios:!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:n.indexOf("Android")>-1||n.indexOf("Adr")>-1,iPhone:n.indexOf("iPhone")>-1,iPad:n.indexOf("iPad")>-1,webApp:n.indexOf("Safari")==-1,weixin:n.indexOf("MicroMessenger")>-1,qq:n.match(/\sQQ/i)==" qq"}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};n.startApp=function(){e.versions.android&&(window.location="learnfuture://canway/canway");e.versions.ios&&window.webkit.messageHandlers.AppModel.postMessage("登录")};n.cancelreplytosomeone=function(n){n.replycontent="";n.isshowreply=!1};n.cancelreply=function(n){n.isshowcomment=!1;n.replycontentbig=""};n.createbigcomment=function(t){if(!n.haslogin){n.startApp();return}if(t.replycontentbig==null||t.replycontentbig==""){layer.msg("评论内容不能为空");return}var r={Content:t.replycontentbig,TopicID:n.TopicID,ParentPostID:t.ID};i.Create({},r,function(n){n.Success?(layer.msg("评论成功"),t.replycontentbig="",i.GetComments({postID:t.ID},{},function(n){t.comment=n;t.CommentCount=n.length;angular.forEach(t.comment,function(n){n.isshowreply=!1;n.replycontent=""})})):layer.msg(n.Message)})};n.createanswer=function(){if(!n.haslogin){n.startApp();return}if(n.theanswer=o.GetContent(),n.theanswer==""){layer.msg("回答内容不能为空");return}var t={Content:n.theanswer,TopicID:n.TopicID,ParentPostID:""};i.Create({},t,function(t){t.Success?(layer.msg("回答成功"),n.theanswer="",o.ClearContent(),i.GetAnwsers({topicID:n.TopicID},{},function(t){n.PostList=t;n.isloadingpostlist=!1;angular.forEach(n.PostList,function(n){n.isshowcomment=!1;n.replycontentbig=""})})):layer.msg(t.Message)})};n.updateAnswer=function(){if(!n.haslogin){n.startApp();return}if(n.theanswer=editor.getContent(),n.theanswer==""){layer.msg("回答内容不能为空");return}var t={Content:n.theanswer,TopicID:n.TopicID,ParentPostID:""};i.Create({},t,function(t){t.Success?(layer.msg("回答成功"),n.theanswer="",i.GetAnwsers({topicID:n.TopicID},{},function(t){n.PostList=t;n.isloadingpostlist=!1;angular.forEach(n.PostList,function(n){n.isshowcomment=!1;n.replycontentbig=""})})):layer.msg(t.Message)})};n.topicthumbsup=function(){if(!n.haslogin){n.startApp();return}n.firstclickthumbup==!0&&(n.thumbup=!1,n.firstclickthumbup=!1);n.topicisthumbuping==!0||(n.topicisthumbuping=!0,n.thumbup==!1?t.ThumbsUpTopic({ID:n.TopicID},{},function(t){t.Success?($("#red_thumbup").css("color","red"),document.getElementById("topicthumbuptime").innerHTML=parseInt(document.getElementById("topicthumbuptime").innerHTML)+1,n.topicisthumbuping=!1,n.thumbup=!0):(layer.msg(t.Message),n.topicisthumbuping=!1)}):t.CancelThumbsUpTopic({ID:n.TopicID},{},function(t){t.Success?($("#red_thumbup").css("color","#ccc"),document.getElementById("topicthumbuptime").innerHTML=parseInt(document.getElementById("topicthumbuptime").innerHTML)-1,n.topicisthumbuping=!1,n.thumbup=!1):(layer.msg(t.Message),n.topicisthumbuping=!1)}))};n.canceltopicthumbsup=function(){if(!n.haslogin){n.startApp();return}n.firstclickthumbup==!0&&(n.thumbup=!0,n.firstclickthumbup=!1);n.topicisthumbuping==!0||(n.topicisthumbuping=!0,n.thumbup==!0?t.CancelThumbsUpTopic({ID:n.TopicID},{},function(t){t.Success?($("#cancel_thumbup").css("color","#ccc"),document.getElementById("topicthumbuptime").innerHTML=parseInt(document.getElementById("topicthumbuptime").innerHTML)-1,n.topicisthumbuping=!1,n.thumbup=!1):(layer.msg(t.Message),n.topicisthumbuping=!1)}):t.ThumbsUpTopic({ID:n.TopicID},{},function(t){t.Success?($("#cancel_thumbup").css("color","red"),document.getElementById("topicthumbuptime").innerHTML=parseInt(document.getElementById("topicthumbuptime").innerHTML)+1,n.topicisthumbuping=!1,n.thumbup=!0):(layer.msg(t.Message),n.topicisthumbuping=!1)}))};n.collecttopic=function(){if(!n.haslogin){n.startApp();return}if(n.isthumbuping!=!0){var i=document.getElementById("collecttopicbutton").innerHTML;i=="收藏"?(n.isthumbuping=!0,t.CollectTopic({ID:n.TopicID},{},function(t){t.Success?(n.isthumbuping=!1,layer.msg("收藏成功"),document.getElementById("collecttopicbutton").innerHTML="取消收藏",document.getElementById("collecttopicbutton").className="layui-btn layui-btn-mini jie-admin layui-btn-danger"):(layer.msg(t.Message),n.isthumbuping=!1)})):(n.isthumbuping=!0,t.CancelCollectTopic({ID:n.TopicID},{},function(t){t.Success?(n.isthumbuping=!1,layer.msg("取消收藏成功"),document.getElementById("collecttopicbutton").innerHTML="收藏",document.getElementById("collecttopicbutton").className="layui-btn layui-btn-mini jie-admin"):(layer.msg(t.Message),n.isthumbuping=!1)}))}};n.thumbuppost=function(t){if(!n.haslogin){n.startApp();return}n.isthumbupingpost==!0||(n.isthumbupingpost=!0,t.HasThumbsUp==!1?i.ThumbsUp({ID:t.ID},{},function(i){i.Success?(t.ThumbsUpCount=t.ThumbsUpCount+1,t.HasThumbsUp=!0,n.isthumbupingpost=!1):(layer.msg(i.Message),n.isthumbupingpost=!1)}):i.CancelThumbsUp({ID:t.ID},{},function(i){i.Success?(t.ThumbsUpCount=t.ThumbsUpCount-1,t.HasThumbsUp=!1,n.isthumbupingpost=!1):(layer.msg(i.Message),n.isthumbupingpost=!1)}))};n.adoptpost=function(t){if(!n.haslogin){n.startApp();return}layer.msg("确定采纳该回答？",{btn:["确认","取消"],time:0,yes:function(n){i.Adopt({ID:t.ID},{},function(n){n.Success?(layer.msg("采纳成功"),t.IsAdopt=!0,$("#notadopt").css("display","none"),$("#alreadyadopt").css("display","inline-block")):layer.msg(n.Message)});layer.close(n)}})};n.deletepost=function(t,r){if(!n.haslogin){n.startApp();return}layer.msg("确定删除该评论？",{btn:["确认","取消"],time:0,yes:function(n){i.Delete({ID:t.ID},{},function(n){n.Success?(layer.msg("删除成功"),i.GetComments({postID:r.ID},{},function(n){r.comment=n;r.CommentCount=n.length;angular.forEach(r.comment,function(n){n.isshowreply=!1;n.replycontent=""});r.isshowcomment=!0})):layer.msg(n.Message)});layer.close(n)}})};n.editAnswer=function(t){if(!n.haslogin){n.startApp();return}s.SetContent(t.Content);layer.open({type:1,shade:!1,skin:"layui-layer-rim",title:["编辑回答","font-size:16px;"],area:["700px","450px"],content:$("#answer-editor-dialog"),btn:["确定"],yes:function(r){var u=s.GetContent();t.Content=u;n.isloadingpostlist=!0;i.Edit({},t,function(t){t.Success?(layer.msg("保存成功！"),i.GetAnwsers({topicID:n.TopicID},{},function(t){n.PostList=t;n.isloadingpostlist=!1;angular.forEach(n.PostList,function(n){n.isshowcomment=!1;n.replycontentbig=""})})):layer.msg(t.Message)});layer.close(r)},cancel:function(){}})};n.downloadAttachment=function(n){u.GetByID({id:n},{},function(n){f.Link(n.Url)})}}]);controllers.controller("ArticleCtrl",["$scope","TopicService","CircleService","anchorScroll",function(n,t,i,r){n.isloadingnewestlist=!0;n.isloadingcirclelist=!0;n.highlightlistboxshow=!0;n.highlighttype=999;n.hotlistboxshow=!0;n.highlightsearchkey="";n.ishighlight="";n.isfinish="";n.searchhighlight=function(i){t.GetList({keyword:n.highlightsearchkey,pageIndex:i,Type:1,ishighlight:n.ishighlight,isfinish:n.isfinish},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1;r.toView("#thehighlightbox",!0,0)})};n.changehighlighttype=function(i){i==n.highlighttype||(n.highlighttype=i,n.highlightsearchkey="",n.highlighttype==0?(n.ishighlight="",n.isfinish=!1):n.highlighttype==1?(n.ishighlight="",n.isfinish=!0):n.highlighttype==2?(n.ishighlight=!0,n.isfinish=""):n.highlighttype==999&&(n.ishighlight="",n.isfinish=""),t.GetList({keyword:n.highlightsearchkey,pageIndex:1,Type:1,ishighlight:n.ishighlight,isfinish:n.isfinish},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1}))};n.searchhighlightkeyword=function(){t.GetList({keyword:n.highlightsearchkey,pageIndex:1,Type:1,ishighlight:n.ishighlight,isfinish:n.isfinish},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1})};n.gotohighlightindex=function(t){n.searchhighlight(t)};n.myKeyup1=function(t){var i=window.event?t.keyCode:t.which;i==13&&n.searchhighlightkeyword()}}]);controllers.controller("CircleDetailCtrl",["$scope","CircleService","UsefulLinkService","TopicService","anchorScroll",function(n,t,i,r,u){n.CircleID=angular.element("#data_Id").val();n.highlightlistboxshow=!0;n.highlighttype=999;n.hotlistboxshow=!0;n.highlightsearchkey="";n.init=function(){i.GetUsefulLink({},{},function(t){n.linklist=t})};n.init();n.searchhighlight=function(t,i){t?r.GetTopicListByCircle({CircleID:n.CircleID,keyword:n.highlightsearchkey,pageIndex:i,Type:n.highlighttype},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1;u.toView("#thehighlightbox",!0,70)}):r.GetTopicListByCircle({CircleID:n.CircleID,keyword:n.highlightsearchkey,pageIndex:i},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1;u.toView("#thehighlightbox",!0,70)})};n.changehighlighttype=function(t){t==n.highlighttype||(n.highlighttype=t,n.highlightsearchkey="",t==999?r.GetTopicListByCircle({CircleID:n.CircleID,keyword:n.highlightsearchkey,pageIndex:1},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1}):r.GetTopicListByCircle({CircleID:n.CircleID,keyword:n.highlightsearchkey,pageIndex:1,Type:n.highlighttype},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1}))};n.searchhighlightkeyword=function(){n.highlighttype==999?r.GetTopicListByCircle({CircleID:n.CircleID,keyword:n.highlightsearchkey,pageIndex:1},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1}):r.GetTopicListByCircle({CircleID:n.CircleID,keyword:n.highlightsearchkey,pageIndex:1,Type:n.highlighttype},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1})};n.gotohighlightindex=function(t){n.highlighttype==999?n.searchhighlight(!1,t):n.searchhighlight(!0,t)};n.myKeyup1=function(t){var i=window.event?t.keyCode:t.which;i==13&&n.searchhighlightkeyword()};n.follow=function(){n.isfollowing||(n.isfollowing=!0,t.Follow({ID:n.CircleID},{},function(t){if(t.Success){layer.msg("已成功关注");n.isfollowing=!1;$("#cancel").css("display","inline-block");$("#follow").css("display","none");var i=parseInt($("#"+n.CircleID+"follow")[0].innerText)+1;$("#"+n.CircleID+"follow").text(i)}else n.isfollowing=!1,layer.msg(t.Message)}))};n.cancelfollow=function(){n.iscanceling||(n.iscanceling=!0,t.CancelFollow({ID:n.CircleID},{},function(t){if(t.Success){layer.msg("已取消关注");n.iscanceling=!1;$("#cancel").css("display","none");$("#follow").css("display","inline-block");var i=parseInt($("#"+n.CircleID+"follow")[0].innerText)-1;$("#"+n.CircleID+"follow").text(i)}else n.iscanceling=!1,layer.msg(t.Message)}))}}]);controllers.controller("CircleListCtrl",["$scope","CircleService",function(n,t){n.follow=function(i){n.isfollowing||(n.isfollowing=!0,t.Follow({ID:i},{},function(t){if(t.Success){n.isfollowing=!1;layer.msg("已成功关注");$("#"+i+"_cancel").css("display","inline-block");$("#"+i+"_follow").css("display","none");$("#"+i+"_cancel2").css("display","inline-block");$("#"+i+"_follow2").css("display","none");var r=parseInt($("#"+i+"follow1")[0].innerText)+1;$("#"+i+"follow1").text(r);$("#"+i+"follow2").text(r)}else n.isfollowing=!1,layer.msg(t.Message)}))};n.cancelfollow=function(i){n.iscanceling||(n.iscanceling=!0,t.CancelFollow({ID:i},{},function(t){if(t.Success){layer.msg("已取消关注");n.iscanceling=!1;$("#"+i+"_cancel").css("display","none");$("#"+i+"_follow").css("display","inline-block");$("#"+i+"_cancel2").css("display","none");$("#"+i+"_follow2").css("display","inline-block");var r=parseInt($("#"+i+"follow1")[0].innerText)-1;$("#"+i+"follow1").text(r);$("#"+i+"follow2").text(r)}else n.iscanceling=!1,layer.msg(t.Message)}))}}]);controllers.controller("FollowCircleDetailCtrl",["$scope","CircleService","UsefulLinkService","TopicService","anchorScroll",function(n,t,i,r,u){n.CircleID=angular.element("#data_Id").val();n.highlightlistboxshow=!0;n.highlighttype=999;n.hotlistboxshow=!0;n.highlightsearchkey="";n.init=function(){i.GetUsefulLink({},{},function(t){n.linklist=t})};n.init();n.searchhighlight=function(t,i){t?r.GetTopicListByCircle({CircleID:n.CircleID,keyword:n.highlightsearchkey,pageIndex:i,Type:n.highlighttype},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1;u.toView("#thehighlightbox",!0,70)}):r.GetTopicListByCircle({CircleID:n.CircleID,keyword:n.highlightsearchkey,pageIndex:i},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1;u.toView("#thehighlightbox",!0,70)})};n.changehighlighttype=function(t){t==n.highlighttype||(n.highlighttype=t,n.highlightsearchkey="",t==999?n.searchhighlight(!1,1):n.searchhighlight(!0,1))};n.searchhighlightkeyword=function(){n.highlighttype==999?n.searchhighlight(!1,1):n.searchhighlight(!0,1)};n.gotohighlightindex=function(t){n.highlighttype==999?n.searchhighlight(!1,t):n.searchhighlight(!0,t)};n.myKeyup1=function(t){var i=window.event?t.keyCode:t.which;i==13&&n.searchhighlightkeyword()};n.follow=function(){n.isfollowing||(n.isfollowing=!0,t.Follow({ID:n.CircleID},{},function(t){t.Success?(layer.msg("已成功关注"),n.isfollowing=!1,$("#cancel").css("display","inline-block"),$("#follow").css("display","none")):(n.isfollowing=!1,layer.msg(t.Message))}))};n.cancelfollow=function(){n.iscanceling||(n.iscanceling=!0,t.CancelFollow({ID:n.CircleID},{},function(t){t.Success?(layer.msg("已取消关注"),n.iscanceling=!1,$("#cancel").css("display","none"),$("#follow").css("display","inline-block"),window.location.href="http://"+window.location.host+"/circle/myfollow"):(n.iscanceling=!1,layer.msg(t.Message))}))}}]);controllers.controller("HomeIndexCtrl",["$scope","TopicService","CircleService","UsefulLinkService","anchorScroll",function(n,t,i,r,u){n.isloadingnewestlist=!0;n.isloadingcirclelist=!0;n.highlightlistboxshow=!0;n.highlighttype=999;n.hotlistboxshow=!0;n.highlightsearchkey="";n.hotlistboxshow=!0;n.hottype=999;n.hotboxshow=!0;n.hotsearchkey="";n.init=function(){t.GetLastestTopic({},{},function(t){n.newestlist=t;n.isloadingnewestlist=!1});i.GetRecomment({},{},function(t){n.circlelist=t;n.isloadingcirclelist=!1});r.GetUsefulLink({},{},function(t){n.linklist=t})};n.init();n.searchhighlight=function(i,r){i?t.GetHighLightList({keyword:n.highlightsearchkey,pageIndex:r,Type:n.highlighttype},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1;u.toView("#thehighlightbox",!0,0)}):t.GetHighLightList({keyword:n.highlightsearchkey,pageIndex:r},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1;u.toView("#thehighlightbox",!0,0)})};n.changehighlighttype=function(i){i==n.highlighttype||(n.highlighttype=i,n.highlightsearchkey="",i==999?t.GetHighLightList({keyword:n.highlightsearchkey,pageIndex:1},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1}):t.GetHighLightList({keyword:n.highlightsearchkey,pageIndex:1,Type:n.highlighttype},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1}))};n.searchhighlightkeyword=function(){n.highlighttype==999?t.GetHighLightList({keyword:n.highlightsearchkey,pageIndex:1},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1}):t.GetHighLightList({keyword:n.highlightsearchkey,pageIndex:1,Type:n.highlighttype},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1})};n.gotohighlightindex=function(t){n.highlighttype==999?n.searchhighlight(!1,t):n.searchhighlight(!0,t)};n.myKeyup1=function(t){var i=window.event?t.keyCode:t.which;i==13&&n.searchhighlightkeyword()};n.searchhot=function(i,r){i?t.GetHotestList({keyword:n.hotsearchkey,pageIndex:r,Type:n.hottype},{},function(t){n.HotList=t;n.hotlistboxshow=!1;u.toView("#hotlistbox",!0,0)}):t.GetHotestList({keyword:n.hotsearchkey,pageIndex:r},{},function(t){n.HotList=t;n.hotlistboxshow=!1;u.toView("#hotlistbox",!0,0)})};n.changehottype=function(i){i==n.hottype||(n.hottype=i,n.hotsearchkey="",i==999?t.GetHotestList({keyword:n.hotsearchkey,pageIndex:1},{},function(t){n.HotList=t;n.hotlistboxshow=!1;u.toView("#hotlistbox",!0,0)}):t.GetHotestList({keyword:n.hotsearchkey,pageIndex:1,Type:n.hottype},{},function(t){n.HotList=t;n.hotlistboxshow=!1}))};n.searchhotkeyword=function(){n.hottype==999?t.GetHotestList({keyword:n.hotsearchkey,pageIndex:1},{},function(t){n.HotList=t;n.hotlistboxshow=!1}):t.GetHotestList({keyword:n.hotsearchkey,pageIndex:1,Type:n.hottype},{},function(t){n.HotList=t;n.hotlistboxshow=!1})};n.gotohotindex=function(t){n.hottype==999?n.searchhot(!1,t):n.searchhot(!0,t)};n.myKeyup2=function(t){var i=window.event?t.keyCode:t.which;i==13&&n.searchhotkeyword()}}]);controllers.controller("QuestionCtrl",["$scope","TopicService","CircleService","anchorScroll",function(n,t,i,r){n.isloadingnewestlist=!0;n.isloadingcirclelist=!0;n.highlightlistboxshow=!0;n.highlighttype=999;n.hotlistboxshow=!0;n.highlightsearchkey="";n.ishighlight="";n.isfinish="";n.searchhighlight=function(i){t.GetList({keyword:n.highlightsearchkey,pageIndex:i,Type:0,ishighlight:n.ishighlight,isfinish:n.isfinish},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1;r.toView("#thehighlightbox",!0,0)})};n.changehighlighttype=function(i){i==n.highlighttype||(n.highlighttype=i,n.highlightsearchkey="",n.highlighttype==0?(n.ishighlight="",n.isfinish=!1):n.highlighttype==1?(n.ishighlight="",n.isfinish=!0):n.highlighttype==2?(n.ishighlight=!0,n.isfinish=""):n.highlighttype==999&&(n.ishighlight="",n.isfinish=""),t.GetList({keyword:n.highlightsearchkey,pageIndex:1,Type:0,ishighlight:n.ishighlight,isfinish:n.isfinish},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1}))};n.searchhighlightkeyword=function(){t.GetList({keyword:n.highlightsearchkey,pageIndex:1,Type:0,ishighlight:n.ishighlight,isfinish:n.isfinish},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1})};n.gotohighlightindex=function(t){n.searchhighlight(t)};n.myKeyup1=function(t){var i=window.event?t.keyCode:t.which;i==13&&n.searchhighlightkeyword()}}]);controllers.controller("ResourceCtrl",["$scope","TopicService","CircleService","anchorScroll",function(n,t,i,r){n.isloadingnewestlist=!0;n.isloadingcirclelist=!0;n.highlightlistboxshow=!0;n.highlighttype=999;n.hotlistboxshow=!0;n.highlightsearchkey="";n.ishighlight="";n.isfinish="";n.searchhighlight=function(i){t.GetList({keyword:n.highlightsearchkey,pageIndex:i,Type:2,ishighlight:n.ishighlight,isfinish:n.isfinish},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1;r.toView("#thehighlightbox",!0,0)})};n.changehighlighttype=function(i){i==n.highlighttype||(n.highlighttype=i,n.highlightsearchkey="",n.highlighttype==0?(n.ishighlight="",n.isfinish=!1):n.highlighttype==1?(n.ishighlight="",n.isfinish=!0):n.highlighttype==2?(n.ishighlight=!0,n.isfinish=""):n.highlighttype==999&&(n.ishighlight="",n.isfinish=""),t.GetList({keyword:n.highlightsearchkey,pageIndex:1,Type:2,ishighlight:n.ishighlight,isfinish:n.isfinish},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1}))};n.searchhighlightkeyword=function(){t.GetList({keyword:n.highlightsearchkey,pageIndex:1,Type:2,ishighlight:n.ishighlight,isfinish:n.isfinish},{},function(t){n.HighLightList=t;n.highlightlistboxshow=!1})};n.gotohighlightindex=function(t){n.searchhighlight(t)};n.myKeyup1=function(t){var i=window.event?t.keyCode:t.which;i==13&&n.searchhighlightkeyword()}}]);controllers.controller("SearchCtrl",["$scope","TopicService","CircleService","anchorScroll",function(n,t,i){n.searchkeyword=angular.element("#data_key").val();n.searchedword=angular.copy(n.searchkeyword);n.showtopic=!0;n.gototopicpage=function(i){t.GetSearchList({keyword:n.searchkeyword,pageIndex:i},{},function(t){n.topiclist=t;n.showtopic=!0;n.searchedword=angular.copy(n.searchkeyword)})};n.gototopicpage(1);n.gotocirclepage=function(t){i.GetSearchCircle({Name:n.searchkeyword,pageIndex:t},{},function(t){n.circlelist=t;n.showtopic=!1;n.searchedword=angular.copy(n.searchkeyword)})};n.search=function(){n.showtopic?n.gototopicpage(1):n.gotocirclepage(1)};n.myKeyup=function(t){var i=window.event?t.keyCode:t.which;i==13&&n.search()}}]);controllers.controller("TopicCreateCtrl",["$scope","CircleService","TopicService","LocalTopicService","Editor",function(n,t,i,r,u){var f=layuiForm(),e,o;n.isApp=angular.element("#data_IsApp").val();document.body.clientWidth<750&&(n.isApp=!0);e=new u({ElementID:"editor",IsMobile:n.isApp});n.CircleID=angular.element("#data_CircleID").val();n.thetype=angular.element("#data_Type").val();n.data={};n.data.allReward=[{Name:"无",Value:0},{Name:"1",Value:1},{Name:"2",Value:2},{Name:"3",Value:3},{Name:"4",Value:4},{Name:"5",Value:5}];n.datacontainer={Type:"",Title:"",Content:"",CircleID:"",Reward:n.data.allReward[0],PicUrl:"/captcha?r="+ +Math.random(),Code:"",Circle:{},isask:!0,AttachmentList:[]};n.thetype!=""?(n.datacontainer.Type=n.thetype,$("input[name='Type']:radio[value="+n.datacontainer.Type+"]").attr("checked","true")):$("input[name='Type']:radio[value=0]").attr("checked","true");t.GetListForAddTopic({},{},function(t){n.data.allcircle=t;n.CircleID!=""&&angular.forEach(n.data.allcircle,function(t){t.ID==n.CircleID&&(n.datacontainer.Circle=t)});o()});n.changecode=function(){n.isuploading||(n.datacontainer.PicUrl="/captcha?r="+Math.random())};n.validate=function(){var t=$("input[name='Type']:checked").val();n.datacontainer.isask=t==0?!0:!1;n.datacontainer.Type=t};f.on("submit(submit)",function(t){if(n.datacontainer.Type=t.field.Type,n.datacontainer.Title=t.field.Title,n.datacontainer.Content=e.GetContent(),n.datacontainer.Keyword=t.field.Keyword,n.datacontainer.Description=t.field.Description,n.datacontainer.CircleID=t.field.Circle,n.datacontainer.Code=t.field.Code,n.datacontainer.Reward=t.field.Reward=="?"?0:t.field.Reward,!n.datacontainer.Content){layer.msg("内容不可空");return}n.isuploading=!0;r.Create({},n.datacontainer,function(t){if(n.isuploading=!1,t.Success){if(n.isApp){var i=t.Target.URL;t.Target.URL=i.replace("detail","appdetail")}document.location.href=t.Target.URL}else layer.msg(t.Message),n.changecode(),n.datacontainer.Code=""})});o=function(){setTimeout(function(){f.render()},200)}}]);controllers.controller("TopicDetailCtrl",["$scope","TopicService","PostService","Editor","AttachmentService","LinkHelper",function(n,t,i,r,u,f){var s=layuiForm(),e,o;n.isApp=!1;document.body.clientWidth<750&&(n.isApp=!0);e=new r({ElementID:"answer-editor",IsMobile:n.isApp});o=new r({ElementID:"answer-edit-editor",IsMobile:n.isApp});n.TopicID=angular.element("#data_Id").val();n.haslogin=angular.element("#data_haslogin").val();n.thetopictype=angular.element("#data_topictype").val();n.isloadingviewtopic=!0;n.isloadingposttopic=!0;n.isloadingpostlist=!0;n.firstclickthumbup=!0;n.theanswer="";n.init=function(){t.GetToppestViewTopic({},{},function(t){n.ViewTopic=t;n.isloadingviewtopic=!1});t.GetToppestPostTopic({},{},function(t){n.PostTopic=t;n.isloadingposttopic=!1});i.GetAnwsers({topicID:n.TopicID},{},function(t){n.PostList=t;n.isloadingpostlist=!1;angular.forEach(n.PostList,function(n){n.isshowcomment=!1;n.replycontentbig=""})})};n.init();layer.photos({photos:".detail-body",anim:5});n.getcomment=function(n){n.isshowcomment==!1?i.GetComments({postID:n.ID},{},function(t){n.comment=t;angular.forEach(n.comment,function(n){n.isshowreply=!1;n.replycontent=""});n.isshowcomment=!0}):n.isshowcomment=!1};n.replytosomeone=function(n){n.isshowreply==!0?n.isshowreply=!1:(n.placeholder="回复 "+n.UserNickName,n.isshowreply=!0)};n.replytosomeonesubmit=function(t,r){var u={Content:r.replycontent,TopicID:n.TopicID,ParentPostID:r.ID};i.Create({},u,function(n){n.Success?(layer.msg("评论成功"),i.GetComments({postID:t.ID},{},function(n){t.comment=n;angular.forEach(t.comment,function(n){n.isshowreply=!1;n.replycontent=""})})):layer.msg(n.Message)})};n.cancelreplytosomeone=function(n){n.replycontent="";n.isshowreply=!1};n.cancelreply=function(n){n.isshowcomment=!1;n.replycontentbig=""};n.createbigcomment=function(t){if(t.replycontentbig==null||t.replycontentbig==""){layer.msg("评论内容不能为空");return}var r={Content:t.replycontentbig,TopicID:n.TopicID,ParentPostID:t.ID};i.Create({},r,function(n){n.Success?(layer.msg("评论成功"),t.replycontentbig="",i.GetComments({postID:t.ID},{},function(n){t.comment=n;t.CommentCount=n.length;angular.forEach(t.comment,function(n){n.isshowreply=!1;n.replycontent=""})})):layer.msg(n.Message)})};n.createanswer=function(){if(n.theanswer=e.GetContent(),n.theanswer==""){layer.msg("回答内容不能为空");return}var t={Content:n.theanswer,TopicID:n.TopicID,ParentPostID:""};i.Create({},t,function(t){t.Success?(layer.msg("回答成功"),n.theanswer="",e.ClearContent(),i.GetAnwsers({topicID:n.TopicID},{},function(t){n.PostList=t;n.isloadingpostlist=!1;angular.forEach(n.PostList,function(n){n.isshowcomment=!1;n.replycontentbig=""})})):layer.msg(t.Message)})};n.updateAnswer=function(){if(n.theanswer=editor.getContent(),n.theanswer==""){layer.msg("回答内容不能为空");return}var t={Content:n.theanswer,TopicID:n.TopicID,ParentPostID:""};i.Create({},t,function(t){t.Success?(layer.msg("回答成功"),n.theanswer="",i.GetAnwsers({topicID:n.TopicID},{},function(t){n.PostList=t;n.isloadingpostlist=!1;angular.forEach(n.PostList,function(n){n.isshowcomment=!1;n.replycontentbig=""})})):layer.msg(t.Message)})};n.topicthumbsup=function(){n.firstclickthumbup==!0&&(n.thumbup=!1,n.firstclickthumbup=!1);n.topicisthumbuping==!0||(n.topicisthumbuping=!0,n.thumbup==!1?t.ThumbsUpTopic({ID:n.TopicID},{},function(t){t.Success?($("#red_thumbup").css("color","red"),document.getElementById("topicthumbuptime").innerHTML=parseInt(document.getElementById("topicthumbuptime").innerHTML)+1,n.topicisthumbuping=!1,n.thumbup=!0):(layer.msg(t.Message),n.topicisthumbuping=!1)}):t.CancelThumbsUpTopic({ID:n.TopicID},{},function(t){t.Success?($("#red_thumbup").css("color","#ccc"),document.getElementById("topicthumbuptime").innerHTML=parseInt(document.getElementById("topicthumbuptime").innerHTML)-1,n.topicisthumbuping=!1,n.thumbup=!1):(layer.msg(t.Message),n.topicisthumbuping=!1)}))};n.canceltopicthumbsup=function(){n.firstclickthumbup==!0&&(n.thumbup=!0,n.firstclickthumbup=!1);n.topicisthumbuping==!0||(n.topicisthumbuping=!0,n.thumbup==!0?t.CancelThumbsUpTopic({ID:n.TopicID},{},function(t){t.Success?($("#cancel_thumbup").css("color","#ccc"),document.getElementById("topicthumbuptime").innerHTML=parseInt(document.getElementById("topicthumbuptime").innerHTML)-1,n.topicisthumbuping=!1,n.thumbup=!1):(layer.msg(t.Message),n.topicisthumbuping=!1)}):t.ThumbsUpTopic({ID:n.TopicID},{},function(t){t.Success?($("#cancel_thumbup").css("color","red"),document.getElementById("topicthumbuptime").innerHTML=parseInt(document.getElementById("topicthumbuptime").innerHTML)+1,n.topicisthumbuping=!1,n.thumbup=!0):(layer.msg(t.Message),n.topicisthumbuping=!1)}))};n.collecttopic=function(){if(n.isthumbuping!=!0){var i=document.getElementById("collecttopicbutton").innerHTML;i=="收藏"?(n.isthumbuping=!0,t.CollectTopic({ID:n.TopicID},{},function(t){t.Success?(n.isthumbuping=!1,layer.msg("收藏成功"),document.getElementById("collecttopicbutton").innerHTML="取消收藏",document.getElementById("collecttopicbutton").className="layui-btn layui-btn-mini jie-admin layui-btn-danger"):(layer.msg(t.Message),n.isthumbuping=!1)})):(n.isthumbuping=!0,t.CancelCollectTopic({ID:n.TopicID},{},function(t){t.Success?(n.isthumbuping=!1,layer.msg("取消收藏成功"),document.getElementById("collecttopicbutton").innerHTML="收藏",document.getElementById("collecttopicbutton").className="layui-btn layui-btn-mini jie-admin"):(layer.msg(t.Message),n.isthumbuping=!1)}))}};n.thumbuppost=function(t){n.isthumbupingpost==!0||(n.isthumbupingpost=!0,t.HasThumbsUp==!1?i.ThumbsUp({ID:t.ID},{},function(i){i.Success?(t.ThumbsUpCount=t.ThumbsUpCount+1,t.HasThumbsUp=!0,n.isthumbupingpost=!1):(layer.msg(i.Message),n.isthumbupingpost=!1)}):i.CancelThumbsUp({ID:t.ID},{},function(i){i.Success?(t.ThumbsUpCount=t.ThumbsUpCount-1,t.HasThumbsUp=!1,n.isthumbupingpost=!1):(layer.msg(i.Message),n.isthumbupingpost=!1)}))};n.adoptpost=function(n){layer.msg("确定采纳该回答？",{btn:["确认","取消"],time:0,yes:function(t){i.Adopt({ID:n.ID},{},function(t){t.Success?(layer.msg("采纳成功"),n.IsAdopt=!0,$("#notadopt").css("display","none"),$("#alreadyadopt").css("display","inline-block")):layer.msg(t.Message)});layer.close(t)}})};n.deletepost=function(n,t){layer.msg("确定删除该评论？",{btn:["确认","取消"],time:0,yes:function(r){i.Delete({ID:n.ID},{},function(n){n.Success?(layer.msg("删除成功"),i.GetComments({postID:t.ID},{},function(n){t.comment=n;t.CommentCount=n.length;angular.forEach(t.comment,function(n){n.isshowreply=!1;n.replycontent=""});t.isshowcomment=!0})):layer.msg(n.Message)});layer.close(r)}})};n.editAnswer=function(t){o.SetContent(t.Content);layer.open({type:1,shade:!1,skin:"layui-layer-rim",title:["编辑回答","font-size:16px;"],area:["300px","300px"],content:$("#answer-editor-dialog"),btn:["确定"],yes:function(r){var u=o.GetContent();t.Content=u;n.isloadingpostlist=!0;i.Edit({},t,function(t){t.Success?(layer.msg("保存成功！"),i.GetAnwsers({topicID:n.TopicID},{},function(t){n.PostList=t;n.isloadingpostlist=!1;angular.forEach(n.PostList,function(n){n.isshowcomment=!1;n.replycontentbig=""})})):layer.msg(t.Message)});layer.close(r)},cancel:function(){}})};n.downloadAttachment=function(n){u.GetByID({id:n},{},function(n){f.Link(n.Url)})}}]);controllers.controller("TopicEditCtrl",["$scope","CircleService","TopicService","LocalTopicService","Editor",function(n,t,i,r,u){var e=layuiForm(),f,o,s;document.body.clientWidth<750&&(n.isApp=!0);f=new u({ElementID:"editor",IsMobile:n.isApp});n.CircleID=angular.element("#data_TopicID").val();i.GetDetail({ID:n.CircleID},{},function(t){n.datacontainer=t;n.datacontainer.PicUrl="/captcha?r="+ +Math.random();n.datacontainer.isask=n.datacontainer.Type==0?!0:!1;$("input[name='Type']:radio[value="+n.datacontainer.Type+"]").attr("checked","true");f.SetContent(n.datacontainer.Content);s()});n.changecode=function(){n.isuploading||(n.datacontainer.PicUrl="/captcha?r="+ +Math.random())};o=function(){var t="";return n.datacontainer.Title==""&&(t+="帖子标题不能为空\n"),n.datacontainer.Content==""&&(t+="帖子内容不能为空\n"),n.datacontainer.Keyword==""&&(t+="帖子关键词不能为空\n"),n.datacontainer.Description==""&&(t+="帖子描述不能为空\n"),n.datacontainer.Code==""&&(t+="请输入验证答案\n"),t!=""?(layer.msg(t),!1):!0};n.Edit=function(){o()&&(n.datacontainer.Type=$("input[name='Type']:checked").val(),n.datacontainer.CircleID=n.datacontainer.Circle.ID,n.datacontainer.Type!=0&&(n.datacontainer.Reward=0),n.isuploading=!0,r.Edit({},n.datacontainer,function(t){n.isuploading=!1;t.Success?document.location.href=t.Target.URL:layer.msg(t.Message)}))};e.on("submit(submit)",function(t){if(n.datacontainer.Title=t.field.Title,n.datacontainer.Content=f.GetContent(),n.datacontainer.Keyword=t.field.Keyword,n.datacontainer.Description=t.field.Description,n.datacontainer.Code=t.field.Code,n.datacontainer.Reward=t.field.Reward=="?"?0:t.field.Reward,!n.datacontainer.Content){layer.msg("内容不可空");return}n.isuploading=!0;r.Edit({},n.datacontainer,function(t){n.isuploading=!1;t.Success?document.location.href=t.Target.URL:(layer.msg(t.Message),n.changecode(),n.datacontainer.Code="")})});s=function(){setTimeout(function(){e.render()},200)}}]);controllers.controller("AccountForgetPasswordCtrl",["$scope","SmsService",function(n,t){var i,r,u,f,e;n.model={thecodekey:parseInt(Math.random()*1e8),SmsTiming:0,CanSendSMS:!0};n.model.PicCodeUrl=o2oSourceUrl+"captcha?r="+n.model.thecodekey;i=layuiForm();i.verify({pass:[/^[\S]{6,32}$/,"密码必须6到32位，且不能出现空格"]});r={Success:angular.element("#data-result-success").val()=="True",Message:angular.element("#data-result-message").val()};u=function(){r.Success||layer.msg(r.Message,{icon:5})};n.changePicCodeUrl=function(){n.model.thecodekey=parseInt(Math.random()*1e8);n.model.PicCodeUrl=o2oSourceUrl+"captcha?r="+n.model.thecodekey};n.sendSms=function(){var r=angular.element("#L_phone").val();if(i.config.verify.phone[0].test(r)==!1&&layer.msg(i.config.verify.phone[1],{icon:5}),n.thepiccode=$("#L_vercode").val(),n.thepiccode.length!=4){layer.msg("请输入图片验证码",{icon:5});return}t.SendSMS({},{Mobile:r,ClientId:"O2OPortal",PicKey:n.model.thecodekey,PicValue:n.thepiccode},function(n){n.Success?(layer.msg("短信发送成功,请注意查收!"),e(60)):layer.msg(n.Message,{icon:5})})};i.on("submit(regist)",function(n){return n.field.ConfirmPassword!=n.field.Password?(layer.msg("新密码和确认密码不一致！",{icon:5}),!1):!0});u();f=function(){n.model.SmsTiming--;n.model.SmsTiming<=0&&(clearInterval(n.smsTimingInterval),n.model.CanSendSMS=!0,n.changePicCodeUrl(),$("#L_vercode").val(""))};e=function(t){n.model.SmsTiming=t;n.model.CanSendSMS=!1;n.smsTimingInterval=window.setInterval(function(){n.$apply(f)},1e3)}}]);controllers.controller("AccountLoginCtrl",["$scope",function(n){n.model={PicCodeUrl:"/captcha?r="+ +Math.random()};var r=layuiForm(),t={Success:angular.element("#data-result-success").val()=="True",Message:angular.element("#data-result-message").val()},i=function(){t.Success||layer.msg(t.Message,{icon:5})};n.changePicCodeUrl=function(){var t=Math.random();n.model.PicCodeUrl="/captcha?r="+t};i()}]);controllers.controller("AccountRegistCtrl",["$scope","SmsService",function(n,t){var i,r,u;n.model={thecodekey:parseInt(Math.random()*1e8),SmsTiming:0,CanSendSMS:!0};n.model.PicCodeUrl=o2oSourceUrl+"captcha?r="+n.model.thecodekey;i=layuiForm();i.verify({pass:[/^[\S]{6,32}$/,"密码必须6到32位，且不能出现空格"]});r={Success:angular.element("#data-result-success").val()=="True",Message:angular.element("#data-result-message").val()};u=function(){r.Success||layer.msg(r.Message,{icon:5})};n.changePicCodeUrl=function(){n.model.thecodekey=parseInt(Math.random()*1e8);n.model.PicCodeUrl=o2oSourceUrl+"captcha?r="+n.model.thecodekey};n.sendSms=function(){var r=angular.element("#L_phone").val();if(i.config.verify.phone[0].test(r)==!1){layer.msg(i.config.verify.phone[1],{icon:5});return}if(n.thepiccode=$("#L_vercode").val(),n.thepiccode.length!=4){layer.msg("请输入图片验证码",{icon:5});return}t.SendSMS({},{Mobile:r,ClientId:"O2OPortal",PicKey:n.model.thecodekey,PicValue:n.thepiccode},function(t){t.Success?(layer.msg("短信发送成功,请注意查收!"),o(60)):(layer.msg(t.Message,{icon:5}),n.changePicCodeUrl())})};i.on("submit(regist)",function(n){return n.field.ConfirmPassword!=n.field.Password?(layer.msg("密码和确认密码不一致！",{icon:5}),!1):!0});u();var f=function(){n.model.SmsTiming--;n.model.SmsTiming<=0&&(clearInterval(e),n.model.CanSendSMS=!0)},e=null,o=function(t){n.model.SmsTiming=t;n.model.CanSendSMS=!1;var i=window.setInterval(function(){n.$apply(f)},1e3)}}]);controllers.controller("CircleManageCtrl",["$scope","$state","CircleService",function(n,t,i){n.settab(8);i.GetMyManageCircle({pageIndex:1},{},function(t){n.list=t});n.gotoDetail=function(n){t.go("CircleTopicList",{ID:n})}}]);controllers.controller("CircleTopicListCtrl",["$scope","$state","CircleService","TopicService","$stateParams",function(n,t,i,r,u){n.settab(8);i.GetByID({ID:u.ID},{},function(t){n.circle=t});n.goto=function(t){r.GetTopicOfMyManageCircle({CircleID:u.ID,pageIndex:t},{},function(t){n.list=t})};n.goto(1);n.HighLight=function(n){r.HighLight({ID:n.TopicID},{},function(t){t.Success?(layer.msg("加精成功"),n.IsHighlight=!0):layer.msg(t.Message)})};n.CancelHighLight=function(n){r.CancelHighLight({ID:n.TopicID},{},function(t){t.Success?(layer.msg("取消加精成功"),n.IsHighlight=!1):layer.msg(t.Message)})};n.Top=function(n){r.Top({ID:n.TopicID},{},function(t){t.Success?(layer.msg("置顶成功"),n.IsTop=!0):layer.msg(t.Message)})};n.CancelTop=function(n){r.CancelTop({ID:n.TopicID},{},function(t){t.Success?(layer.msg("取消置顶成功"),n.IsTop=!1):layer.msg(t.Message)})};n.Enable=function(n){r.Enable({ID:n.TopicID},{},function(t){t.Success?(layer.msg("启用成功"),n.Disabled=!1):layer.msg(t.Message)})};n.Disable=function(n){r.Disable({ID:n.TopicID},{},function(t){t.Success?(layer.msg("禁用成功"),n.Disabled=!0):layer.msg(t.Message)})}}]);controllers.controller("DynamicsCtrl",["$scope","DynamicsService",function(n,t){n.settab(5);n.GetMyList=function(){t.GetMyList({},{},function(t){n.list=t.Records})};n.GetMyList();n.delete=function(i){t.Delete({dynamicsID:i},{},function(t){t.Success?(layer.msg("删除成功"),angular.forEach(n.list,function(t,r){t.ID==i&&n.list.splice(r,1)})):layer.msg(t.Message)})};n.deleteall=function(){t.ClearMyList({},{},function(t){t.Success?(layer.msg("清空成功"),n.list=[]):layer.msg(t.Message)})}}]);controllers.controller("FocusCtrl",["$scope","UserCenterService","TopicService","CircleService",function(n,t,i,r){n.firstloadcomplete=!1;t.GetUserFocus({},{},function(t){n.datacontainer=t;n.firstloadcomplete=!0});n.gotoCollectTopicindex=function(t){i.GetMyCollectTopic({pageIndex:t},{},function(t){n.datacontainer.CollectTopicList=t})};n.gotoCircleListindex=function(t){r.GetMyFollowCircle({pageIndex:t},{},function(t){n.datacontainer.CircleList=t})};n.gotoThumbupTopicindex=function(t){i.GetThumbupTopic({pageIndex:t},{},function(t){n.datacontainer.ThumbupTopicList=t})};n.cancelfollow=function(t){n.iscanceling||(n.iscanceling=!0,r.CancelFollow({ID:t},{},function(t){t.Success?(layer.msg("已取消关注"),n.iscanceling=!1,n.gotoCircleListindex(n.datacontainer.CircleList.PageIndex)):(n.iscanceling=!1,layer.msg(t.Message))}))};n.cancelcollect=function(t){i.CancelCollectTopic({ID:t.ID},{},function(t){t.Success?(layer.msg("取消收藏成功"),n.gotoCollectTopicindex(n.datacontainer.CollectTopicList.PageIndex)):layer.msg(t.Message)})}}]);controllers.controller("HistoryCtrl",["$scope","HistoryService",function(n,t){n.settab(4);n.isshowtoday=!0;n.isshowyesterday=!0;n.isshowthisweek=!0;n.init=function(){t.GetMyListToday({pageIndex:1},{},function(t){n.todaylist=t.Records});t.GetMyListYesterday({pageIndex:1},{},function(t){n.yesterdaylist=t.Records});t.GetMyListThisWeek({pageIndex:1},{},function(t){n.thisweeklist=t.Records})};n.init();n.changetoday=function(){n.isshowtoday=!n.isshowtoday};n.changeyesterday=function(){n.isshowyesterday=!n.isshowyesterday};n.changethisweek=function(){n.isshowthisweek=!n.isshowthisweek}}]);controllers.controller("MessageCtrl",["$scope","MessageService",function(n,t){n.settab(6);n.GetMyList=function(){t.GetMyList({},{},function(i){n.list=i.Records;t.Read({},{},function(){})})};n.GetMyList();n.delete=function(i){t.Delete({messageID:i},{},function(t){t.Success?(layer.msg("删除成功"),angular.forEach(n.list,function(t,r){t.ID==i&&n.list.splice(r,1)})):layer.msg(t.Message)})};n.deleteall=function(){t.ClearMyList({},{},function(t){t.Success?(layer.msg("清空成功"),n.list=[]):layer.msg(t.Message)})}}]);controllers.controller("MyTopicCtrl",["$scope","TopicService",function(n,t){n.settab(3);n.isfirstloadcomplete=!1;n.goto=function(i){t.GetMyTopic({pageIndex:i},{},function(t){n.list=t;n.isfirstloadcomplete=!0})};n.goto(1)}]);controllers.controller("SettingCtrl",["$scope","UserCenterService",function(n,t){n.settab(7);t.GetUserMessage({},{},function(t){n.message=t;n.message.sex!=0&&$("input[name='sex']:radio[value="+n.message.sex+"]").attr("checked","true")});n.submitmessage=function(){n.message.sex=$("input[name='sex']:checked").val();n.message.sex==undefined&&(n.message.sex=0);t.UpdateUserMessage({},n.message,function(n){n.Success?layer.msg("用户信息修改成功，需要重新登陆才会显示修改后的信息。"):layer.msg(n.Message)})};n.password={PasswordNow:"",PasswordNew:"",PasswordConfirm:""};n.editpassword=function(){if(n.password.PasswordNow==""){layer.msg("请输入当前密码");return}if(n.password.PasswordNew==""){layer.msg("请输入新密码");return}if(n.password.PasswordConfirm==""){layer.msg("请确认密码");return}if(n.password.PasswordNew.length<6||n.password.PasswordNew.length>16){layer.msg("新密码要有6到16个字符");return}if(n.password.PasswordNew!=n.password.PasswordConfirm){layer.msg("两次密码不匹配");return}t.UpdatePassword({},n.password,function(t){t.Success?(layer.msg("修改成功"),n.password={PasswordNow:"",PasswordNew:"",PasswordConfirm:""}):layer.msg(t.Message)})};n.getuseravatar=function(){t.GetUserAvatar({},{},function(t){n.useravatar=t.Message})};n.getuseravatar();n.saveavatar=function(i){t.UpdateUserAvatar({picurl:i},{},function(t){t.Success&&(n.useravatar=i,layer.msg("用户信息修改成功，需要重新登陆才会显示修改后的信息。"))})}}]);controllers.controller("UserHomeCtrl",["$scope",function(n){n.model={Text:"HelloWorld!"}}]);controllers.controller("UserIndexCtrl",["$scope","$state",function(n,t){n.settab=function(n){$(".layui-nav-item").removeClass("layui-this");$("#tab"+n).addClass("layui-this")};t.go("Focus")}]);directives.directive("ngInsertHtml",function(){return{require:"?ngInsertHtml",restrict:"A",scope:{ngInsertHtml:"="},link:function(n,t){t[0].innerHTML=n.ngInsertHtml}}});directives.directive("fileUpload",["$timeout","FileService","AttachmentService",function(n,t,i){return{restrict:"EA",template:'<div class="lf-upload-button" >            <input id="{{eId}}" type="file" name="file" class="upload-file" >            <span class="upload-icon"><i class="layui-icon"><\/i>点击上传<\/span><\/div>            <span>（支持附件类型：zip | rar | png | bmp | jpg | ppt | doc | docx | xlsx）<\/span>            <table class="layui-table" lay-skin="line">             <colgroup><col width="80%"><col width="10%"><col width="10%"><\/colgroup>             <tbody>             <tr ng-repeat="att in attachmentList">              <td ng-bind-template="{{att.Name}}"><\/td>              <td ng-bind-template="{{att.SizeView}}" style="text-align:center;"><\/td>              <td class="ng-hide" ng-show="att.State" style="text-align:center;"><img style="height:20px;" src="/Content/Images/gif/loading-0.gif" /><\/td>              <td class="ng-hide" style="text-align:center;cursor:pointer;" ng-click="deleteAttachment(att)" ng-hide="att.State"><i class="layui-icon"><\/i><\/td>             <\/tr>             <\/tbody>            <\/table>',scope:{eId:"@eId",attachmentList:"=attachmentList"},repalce:!0,link:function(r){var e=52428800,u=function(n){layer.msg(n,{icon:5})},o=function(n){for(var i=r.attachmentList,f=i.length,u={Index:-1,Obj:null},t=0;t<f;t++)if(i[t].ID==n){u.Index=t;u.Obj=i[t];break}return u},s=function(n){r.attachmentList.push(n)},f=function(n){var t=o(n.ID);t.Index>-1&&r.attachmentList.splice(t.Index,1)},h=function(n){var t={Passed:!1,Files:[],ErrorMsg:""};return $.each(n,function(n,i){var r=i.name,u=i.size;if(r&&u){if(/\.(zip|rar|png|bmp|jpg|ppt|doc|docx|xlsx)$/i.test(r)===!1){t.ErrorMsg+=r+":文件类型不允许上传;";return}if(e<u){t.ErrorMsg+=r+":文件太大不允许上传";return}t.Files.push(i)}}),t.Files.length&&(t.Passed=!0),t},c=function(n){var c=o2oSourceUrl+"api/file/GetParams",e="http://canwayimage.oss-cn-hangzhou.aliyuncs.com/",o="http://image.learnfuture.com/",h=36e5;t.GetParams({},{},function(t){try{var c=t;$.each(n,function(n,t){var v=new XMLHttpRequest,a,l;v.open("post",e,!0);v.setRequestHeader("X-Requested-With","XMLHttpRequest");a=new FormData;a.append("key",c.dir+"${filename}");a.append("name",t.name);a.append("policy",c.policy);a.append("OSSAccessKeyId",c.accessid);a.append("success_action_status","200");a.append("signature",c.signature);a.append("file",t);l={Name:t.name,Url:"--",Size:t.size,State:1};s(l);v.timeout=h;v.ontimeout=function(){f(l);r.$apply();u("上传附件超时，可能网速有点慢，请稍后重试")};v.send(a);v.addEventListener("load",function(){l.Url=o+c.dir+t.name;l.State=undefined;i.Create({},l,function(n){n.Success?(l.ID=n.Target.ID,l.AssociationID=n.Target.AssociationID,l.SizeView=n.Target.SizeView):(f(l),u(n.Message))})})})}catch(l){u("附件上传失败，请稍后重试")}})},l=n(function(){$("#"+r.eId).change(function(){var t=$("#"+r.eId)[0].files,n=h(t);(document.getElementById(r.eId).value="",n.ErrorMsg&&u(n.ErrorMsg),n.Passed)&&c(n.Files)})},1e3);r.deleteAttachment=function(n){f(n)}}}}]);directives.directive("avatarUpload",["FileService","UserCenterService",function(n,t){return{restrict:"EA",template:'<div>    <input id="{{eId}}" style="position: absolute; width: 20px; margin-left: 100px;height:10px;margin-top:10px;display:none;"  name="{{eId}}" type="file" />    <button class="layui-btn layui-btn-small" ng-click="uploadClick()" style="position: absolute; width: 120px; line-height:22px;" title="PNG/JPG/GIF 格式图片">上传图片<\/button>   <\/div>',scope:{eId:"@eId",avatarUrl:"=avatarUrl"},replace:!0,transclude:!0,link:function(i){var f=102400,r=function(n){layer.msg(n,{icon:5})},e=function(){return layer.msg("正在上传图片...",{icon:16,shade:.2,time:0})},u=function(n){layer.close(n)},o=function(n){var t={Passed:!1,Files:[],ErrorMsg:""};return $.each(n,function(n,i){var r=i.name,u=i.size;if(r&&u){if(/\.(jpg|jpeg|png|bmp|gif)$/i.test(r)===!1){t.ErrorMsg+=r+":图片类型不允许上传;";return}if(f<u){t.ErrorMsg+=r+":图片太大不允许上传";return}t.Files.push(i)}}),t.Files.length&&(t.Passed=!0),t},s=function(f){var c=o2oSourceUrl+"api/file/GetParams",o="http://canwayimage.oss-cn-hangzhou.aliyuncs.com/",s="http://image.learnfuture.com/",h=36e5;n.GetParams({},{},function(n){try{var c=n;$.each(f,function(n,f){var a=new XMLHttpRequest,l,v;a.open("post",o,!0);a.setRequestHeader("X-Requested-With","XMLHttpRequest");l=new FormData;l.append("key",c.dir+"${filename}");l.append("name",f.name);l.append("policy",c.policy);l.append("OSSAccessKeyId",c.accessid);l.append("success_action_status","200");l.append("signature",c.signature);l.append("file",f);v=e();a.timeout=h;a.ontimeout=function(){u(v);r("图片上传失败超时，可能网速有点慢，请稍后重试")};a.send(l);a.addEventListener("load",function(){var n=s+c.dir+f.name;t.UpdateUserAvatar({picurl:n},{},function(t){t.Success?(i.avatarUrl=n,layer.msg("用户信息修改成功，需要重新登陆才会显示修改后的信息。"),u(v)):u(v)})})})}catch(l){r("图片上传失败，请稍后重试")}})};i.uploadClick=function(){$("#"+i.eId).change(function(){var t=$("#"+i.eId)[0].files,n=o(t);if(document.getElementById(i.eId).value="",n.ErrorMsg){r(n.ErrorMsg);return}s(n.Files)});$("#"+i.eId).click()}}}}]);directives.directive("turnred",function(){return{priority:-12e7,require:"?ngModel",restrict:"A",scope:{ngModel:"=",key:"@theKey"},link:function(n,t){var o=n.key,f=n.key,r,i,u,e;f!=null&&(r=decodeURIComponent(f),n.ngModel!=""&&n.ngModel!=undefined&&(i=n.ngModel.toLowerCase().indexOf(r.toLowerCase()),i>-1&&(u=n.ngModel.substring(i,i+r.length),e=n.ngModel.replace(u,"<b style='color:red;font-weight:normal;'>"+u+"<\/b>"),t.empty(),t.append(e))))}}});jQuery.extend({createUploadIframe:function(n,t){var r="jUploadFrame"+n,i;return window.ActiveXObject?(i=document.createElement('<iframe id="'+r+'" name="'+r+'" />'),typeof t=="boolean"?i.src="javascript:false":typeof t=="string"&&(i.src=t)):(i=document.createElement("iframe"),i.id=r,i.name=r),i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",document.body.appendChild(i),i},createUploadForm:function(n,t){var u="jUploadForm"+n,f="jUploadFile"+n,i=$('<form  action="" method="POST" name="'+u+'" id="'+u+'" enctype="multipart/form-data"><\/form>'),r=$("#"+t),e=$(r).clone();return $(r).attr("id",f),$(r).before(e),$(r).appendTo(i),$(i).css("position","absolute"),$(i).css("top","-1200px"),$(i).css("left","-1200px"),$(i).appendTo("body"),i},addOtherRequestsToForm:function(n,t){var u=$('<input type="hidden" name="" value="">'),i,r;for(i in t)name=i,value=t[i],r=u.clone(),r.attr({name:name,value:value}),$(r).appendTo(n);return n},ajaxFileUpload:function(n){var r,e,t,f,i;n=jQuery.extend({},jQuery.ajaxSettings,n);r=(new Date).getTime();i=jQuery.createUploadForm(r,n.fileElementId);n.data&&(i=jQuery.addOtherRequestsToForm(i,n.data));var h=jQuery.createUploadIframe(r,n.secureuri),u="jUploadFrame"+r,o="jUploadForm"+r;n.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");e=!1;t={};n.global&&jQuery.event.trigger("ajaxSend",[t,n]);f=function(r){var f=document.getElementById(u),o,h;try{f.contentWindow?(t.responseText=f.contentWindow.document.body?f.contentWindow.document.body.innerHTML:null,t.responseXML=f.contentWindow.document.XMLDocument?f.contentWindow.document.XMLDocument:f.contentWindow.document):f.contentDocument&&(t.responseText=f.contentDocument.document.body?f.contentDocument.document.body.innerHTML:null,t.responseXML=f.contentDocument.document.XMLDocument?f.contentDocument.document.XMLDocument:f.contentDocument.document)}catch(s){jQuery.handleError(n,t,null,s)}if(t||r=="timeout"){e=!0;try{o=r!="timeout"?"success":"error";o!="error"?(h=jQuery.uploadHttpData(t,n.dataType),n.success&&n.success(h,o),n.global&&jQuery.event.trigger("ajaxSuccess",[t,n])):jQuery.handleError(n,t,o)}catch(s){o="error";jQuery.handleError(n,t,o,s)}n.global&&jQuery.event.trigger("ajaxComplete",[t,n]);n.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop");n.complete&&n.complete(t,o);jQuery(f).unbind();setTimeout(function(){try{$(f).remove();$(i).remove()}catch(r){jQuery.handleError(n,t,null,r)}},100);t=null}};n.timeout>0&&setTimeout(function(){e||f("timeout")},n.timeout);try{i=$("#"+o);$(i).attr("action",n.url);$(i).attr("method","POST");$(i).attr("target",u);i.encoding?i.encoding="multipart/form-data":i.enctype="multipart/form-data";$(i).submit()}catch(s){jQuery.handleError(n,t,null,s)}return window.attachEvent?document.getElementById(u).attachEvent("onload",f):document.getElementById(u).addEventListener("load",f,!1),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;if(data=type=="xml"||data?r.responseXML:r.responseText,type=="script"&&jQuery.globalEval(data),type=="json"){var data=r.responseText,rx=new RegExp("<pre.*?>(.*?)<\/pre>","i"),am=rx.exec(data),data=am?am[1]:"";eval("data = "+data)}return type=="html"&&jQuery("<div>").html(data).evalScripts(),data}})(function(){jQuery.extend({handleError:function(n,t,i,r){n.error&&n.error.call(n.context||n,t,i,r);n.global&&(n.context?jQuery(n.context):jQuery.event).trigger("ajaxError",[t,n,r])},httpData:function(xhr,type,s){var ct=xhr.getResponseHeader("content-type"),xml=type=="xml"||!type&&ct&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.tagName=="parsererror")throw"parsererror";return s&&s.dataFilter&&(data=s.dataFilter(data,type)),typeof data=="string"&&(type=="script"&&jQuery.globalEval(data),type=="json"&&(data=window.eval("("+data+")"))),data}})})