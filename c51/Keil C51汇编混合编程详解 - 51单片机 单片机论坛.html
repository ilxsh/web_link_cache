
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gbk" />
<title>Keil C51汇编混合编程详解 - 51单片机 单片机论坛 </title>
<link href="http://www.51hei.com/bbs/dpj-24471-1.html" rel="canonical" />

<meta name="MSSmartTagsPreventParsing" content="True" />
<meta http-equiv="MSThemeCompatible" content="Yes" />
<base href="http://www.51hei.com/bbs/" /><link rel="stylesheet" type="text/css" href="data/cache/style_1_common.css?h49" /><link rel="stylesheet" type="text/css" href="data/cache/style_1_forum_viewthread.css?h49" /><script type="text/javascript">var STYLEID = '1', STATICURL = 'static/', IMGDIR = 'static/image/common', VERHASH = 'h49', charset = 'gbk', discuz_uid = '0', cookiepre = '5Qbx_2132_', cookiedomain = '', cookiepath = '/', showusercard = '1', attackevasive = '0', disallowfloat = 'newthread', creditnotice = '1|威望|,2|黑币|,3|贡献|', defaultstyle = '', REPORTURL = 'aHR0cDovL3d3dy41MWhlaS5jb20vYmJzL2Rwai0yNDQ3MS0xLmh0bWw=', SITEURL = 'http://www.51hei.com/bbs/', JSPATH = 'data/cache/', DYNAMICURL = '';</script>
<script src="data/cache/common.js?h49" type="text/javascript"></script>
<meta name="application-name" content="单片机论坛" />
<meta name="msapplication-tooltip" content="单片机论坛" />
<meta name="msapplication-task" content="name=门户;action-uri=http://www.51hei.com/bbs/portal.php;icon-uri=http://www.51hei.com/bbs/static/image/common/portal.ico" /><meta name="msapplication-task" content="name=论坛;action-uri=http://www.51hei.com/bbs/;icon-uri=http://www.51hei.com/bbs/static/image/common/bbs.ico" />
<meta name="msapplication-task" content="name=群组;action-uri=http://www.51hei.com/bbs/group.php;icon-uri=http://www.51hei.com/bbs/static/image/common/group.ico" /><meta name="msapplication-task" content="name=;action-uri=http://www.51hei.com/bbs/home.php;icon-uri=http://www.51hei.com/bbs/static/image/common/home.ico" /><script src="data/cache/forum.js?h49" type="text/javascript"></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?85fb66a4d8a26adebaeeafa1df93222e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>

<body id="nv_forum" class="pg_viewthread" onkeydown="if(event.keyCode==27) return false;">
<div id="append_parent"></div><div id="ajaxwaitid"></div>
<div id="toptb" class="cl">
<div class="wp">
<div class="z"><a href="javascript:;"  onclick="setHomepage('http://www.51hei.com/bbs/');">设为首页</a><a href="http://www.51hei.com/bbs/"  onclick="addFavorite(this.href, '单片机论坛');return false;">收藏本站</a></div>
<div class="y">
<a id="switchblind" href="javascript:;" onclick="toggleBlind(this)" title="开启辅助访问" class="switchblind">开启辅助访问</a>
<a href="javascript:;" id="switchwidth" onclick="widthauto(this)" title="切换到宽版" class="switchwidth">切换到宽版</a>
</div>
</div>
</div>

<div id="qmenu_menu" class="p_pop blk" style="display: none;">
<div class="ptm pbw hm">
请 <a href="javascript:;" class="xi2" onclick="lsSubmit()"><strong>登录</strong></a> 后使用快捷导航<br />没有帐号？<a href="member.php?mod=register" class="xi2 xw1">立即注册</a>
</div>
<div id="fjump_menu" class="btda"></div></div><div id="hd">
<div class="wp">
<div class="hdc cl"><h2><a href="http://www.51hei.com/bbs/" title="单片机论坛"><img src="static/image/common/logo.png" alt="单片机论坛" border="0" /></a></h2><script src="data/cache/logging.js?h49" type="text/javascript"></script>
<form method="post" autocomplete="off" id="lsform" action="member.php?mod=logging&amp;action=login&amp;loginsubmit=yes&amp;infloat=yes&amp;lssubmit=yes" onsubmit="return lsSubmit();">
<div class="fastlg cl">
<span id="return_ls" style="display:none"></span>
<div class="y pns">
<table cellspacing="0" cellpadding="0">
<tr>
<td>
<span class="ftid">
<select name="fastloginfield" id="ls_fastloginfield" width="40" tabindex="900">
<option value="username">用户名</option>
<option value="email">Email</option>
</select>
</span>
<script type="text/javascript">simulateSelect('ls_fastloginfield')</script>
</td>
<td><input type="text" name="username" id="ls_username" autocomplete="off" class="px vm" tabindex="901" /></td>
<td class="fastlg_l"><label for="ls_cookietime"><input type="checkbox" name="cookietime" id="ls_cookietime" class="pc" value="2592000" tabindex="903" checked="checked"/>自动登录</label></td>
<td>&nbsp;<a href="javascript:;" onclick="showWindow('login', 'member.php?mod=logging&action=login&viewlostpw=1')">找回密码</a></td>
</tr>
<tr>
<td><label for="ls_password" class="z psw_w">密码</label></td>
<td><input type="password" name="password" id="ls_password" class="px vm" autocomplete="off" tabindex="902" /></td>
<td class="fastlg_l"><button type="submit" class="pn vm" tabindex="904" style="width: 75px;"><em>登录</em></button></td>
<td>&nbsp;<a href="member.php?mod=register" class="xi2 xw1">立即注册</a></td>
</tr>
</table>
<input type="hidden" name="quickforward" value="yes" />
<input type="hidden" name="handlekey" value="ls" />
</div>

<div class="fastlg_fm y" style="margin-right: 10px; padding-right: 10px">
<p><a href="http://www.51hei.com/bbs/connect.php?mod=login&op=init&referer=forum.php%3Fmod%3Dviewthread%26tid%3D24471%26extra%3Dpage%253D1%26page%3D1%26&statfrom=login_simple"><img src="static/image/common/qq_login.gif" class="vm" alt="QQ登录" /></a></p>
<p class="hm xg1" style="padding-top: 2px;">只需一步，快速开始</p>
</div>
</div>
</form>

</div>

<div id="nv">
<a href="javascript:;" id="qmenu" onmouseover="delayShow(this, function () {showMenu({'ctrlid':'qmenu','pos':'34!','ctrlclass':'a','duration':2});showForummenu(2);})">快捷导航</a>
<ul><li class="a" id="mn_Ne347" ><a href="http://www.51hei.com/" hidefocus="true"  >首页</a></li><li id="mn_Nfad7" ><a href="http://www.51hei.com/bbs/" hidefocus="true"  >论坛</a></li><li id="mn_N63af" ><a href="http://www.51hei.com/bbs/mcu-h24-1.html" hidefocus="true"  >问答区</a></li><li id="mn_Nf5b2" ><a href="http://www.51hei.com/mcuteach/252.html" hidefocus="true" target="_blank"  >单片机教程</a></li><li id="mn_Ne3ee" ><a href="http://www.51hei.com/sp/" hidefocus="true" target="_blank"  >视频教程</a></li></ul>
</div>
<div class="p_pop h_pop" id="mn_userapp_menu" style="display: none"></div><div id="mu" class="cl">
</div><div class="a_mu"><p align="left" style="margin-top: 0px; margin-bottom: 6px; text-indent:13px;padding-top:6px">
  <font color="#FF0000">热门：</font>
<a href="http://www.51hei.com/bbs/mcu-2-1.html">51单片机</a> |
<a href="http://www.51hei.com/bbs/mcu-h24-1.html">24小时必答区</a> |						
<a href="http://www.51hei.com/bbs/mcu-xuexi-1.html">单片机教程</a> |						
<a href="http://www.51hei.com/bbs/mcu-diy-1.html">单片机DIY制作</a> |
<a href="http://www.51hei.com/bbs/mcu-stm32-1.html">STM32</a> |
<a href="http://www.51hei.com/bbs/mcu-cortexm3-1.html">Cortex M3</a> |						
<a href="http://www.51hei.com/bbs/mcu-dianzi-1.html">模数电子</a> |						
<a href="http://www.51hei.com/bbs/mcu-dianzidiy-1.html">电子DIY制作</a> |
<a href="http://www.51hei.com/bbs/mcu-gongfangdiy-1.html">音响/功放</a> |
<a href="http://www.51hei.com/bbs/mcu-cj-1.html">拆机乐园</a> |
<a href="http://www.51hei.com/bbs/mcu-Arduino-1.html">Arduino</a> |
<a href="http://www.51hei.com/bbs/mcu-20-1.html">嵌入式OS</a> |                                                
<a href="http://www.51hei.com/bbs/mcu-8-1.html">程序设计</a>
</p>
</div><div id="scbar" class="cl">
<form id="scbar_form" method="post" autocomplete="off" onsubmit="searchFocus($('scbar_txt'))" action="search.php?searchsubmit=yes" target="_blank">
<input type="hidden" name="mod" id="scbar_mod" value="search" />
<input type="hidden" name="formhash" value="4b27fe9d" />
<input type="hidden" name="srchtype" value="title" />
<input type="hidden" name="srhfid" value="2" />
<input type="hidden" name="srhlocality" value="forum::viewthread" />
<table cellspacing="0" cellpadding="0">
<tr>
<td class="scbar_icon_td"></td>
<td class="scbar_txt_td"><input type="text" name="srchtxt" id="scbar_txt" value="请输入搜索内容" autocomplete="off" x-webkit-speech speech /></td>
<td class="scbar_type_td"><a href="javascript:;" id="scbar_type" class="xg1" onclick="showMenu(this.id)" hidefocus="true">搜索</a></td>
<td class="scbar_btn_td"><button type="submit" name="searchsubmit" id="scbar_btn" sc="1" class="pn pnc" value="true"><strong class="xi2">搜索</strong></button></td>
<td class="scbar_hot_td">
<div id="scbar_hot">
</div>
</td>
</tr>
</table>
</form>
</div>
<ul id="scbar_type_menu" class="p_pop" style="display: none;"><li><a href="javascript:;" rel="curforum" fid="2" >本版</a></li><li><a href="javascript:;" rel="forum" class="curtype">帖子</a></li><li><a href="javascript:;" rel="group">群组</a></li><li><a href="javascript:;" rel="user">用户</a></li></ul>
<script type="text/javascript">
initSearchmenu('scbar', '');
</script>
</div>
</div>


<div id="wp" class="wp">
<script type="text/javascript">var fid = parseInt('2'), tid = parseInt('24471');</script>

<script src="data/cache/forum_viewthread.js?h49" type="text/javascript"></script>
<script type="text/javascript">zoomstatus = parseInt(1);var imagemaxwidth = '733';var aimgcount = new Array();</script>

<style id="diy_style" type="text/css"></style>
<!--[diy=diynavtop]--><div id="diynavtop" class="area"></div><!--[/diy]-->
<div id="pt" class="bm cl">
<div class="z">
<a href="./" class="nvhm" title="首页">单片机论坛</a><em>&raquo;</em><a href="/bbs/">论坛</a> <em>&rsaquo;</em> <a href="http://www.51hei.com/bbs/forum.php?gid=1">嵌入式/单片机论坛</a> <em>&rsaquo;</em> <a href="http://www.51hei.com/bbs/mcu-2-1.html">51单片机</a> <em>&rsaquo;</em> <a href="http://www.51hei.com/bbs/dpj-24471-1.html">Keil C51汇编混合编程详解</a>
</div>
</div>

<style id="diy_style" type="text/css"></style>
<div class="wp">
<!--[diy=diy1]--><div id="diy1" class="area"></div><!--[/diy]-->
</div>

<div id="ct" class="wp cl">
<div id="pgt" class="pgs mbm cl ">
<div class="pgt"></div>
<span class="y pgb"><a href="http://www.51hei.com/bbs/mcu-2-1.html">返回列表</a></span>
<a id="newspecial" onmouseover="$('newspecial').id = 'newspecialtmp';this.id = 'newspecial';showMenu({'ctrlid':this.id})" onclick="showWindow('newthread', 'forum.php?mod=post&action=newthread&fid=2')" href="javascript:;" title="发新帖"><img src="static/image/common/pn_post.png" alt="发新帖" /></a></div>



<div id="postlist" class="pl bm">
<table cellspacing="0" cellpadding="0">
<tr>
<td class="pls ptn pbn">
<div class="hm ptn">
<span class="xg1">查看:</span> <span class="xi1">1766</span><span class="pipe">|</span><span class="xg1">回复:</span> <span class="xi1">0</span>
</div>
</td>
<td class="plc ptm pbn vwthd">
<div class="y">
<a href="http://www.51hei.com/bbs/forum.php?mod=viewthread&amp;action=printable&amp;tid=24471" title="打印" target="_blank"><img src="static/image/common/print.png" alt="打印" class="vm" /></a>
<a href="http://www.51hei.com/bbs/forum.php?mod=redirect&amp;goto=nextoldset&amp;tid=24471" title="上一主题"><img src="static/image/common/thread-prev.png" alt="上一主题" class="vm" /></a>
<a href="http://www.51hei.com/bbs/forum.php?mod=redirect&amp;goto=nextnewset&amp;tid=24471" title="下一主题"><img src="static/image/common/thread-next.png" alt="下一主题" class="vm" /></a>
</div>
<span class="xg1 side_btn">
<a onclick="setcookie('close_leftinfo', 1);location.reload();" title="收起左侧" class="btn_s_close" href="javascript:;"><img src="static/image/common/control_l.png" alt="收起左侧" class="vm" /></a>
</span>
<h1 class="ts">
<span id="thread_subject">Keil C51汇编混合编程详解</span>
</h1>
<span class="xg1">
<a href="http://www.51hei.com/bbs/dpj-24471-1.html" onclick="return copyThreadUrl(this, '单片机论坛')" >[复制链接]</a>
</span>
</td>
</tr>
</table>


<table cellspacing="0" cellpadding="0" class="ad">
<tr>
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table><div id="post_82746" ><table id="pid82746" class="plhin" summary="pid82746" cellspacing="0" cellpadding="0">
<tr>
<td class="pls" rowspan="2">
<div id="favatar82746" class="pls favatar">
 <a name="lastpost"></a><div class="p_pop blk bui card_gender_" id="userinfo82746" style="display: none; ">
<div class="m z">
<div id="userinfo82746_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://www.51hei.com/bbs/space-uid-59306.html" target="_blank" class="xi2">lxw0326</a></strong>
<em>当前离线</em>
</div><dl class="cl">
<dt>积分</dt><dd><a href="http://www.51hei.com/bbs/home.php?mod=space&uid=59306&do=profile" target="_blank" class="xi2">34</a></dd>
</dl>
<div class="imicn">
<a href="http://www.51hei.com/bbs/home.php?mod=space&amp;uid=59306&amp;do=profile" target="_blank" title="查看详细资料"><img src="static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar"><a href="http://www.51hei.com/bbs/space-uid-59306.html" class="avtm" target="_blank"><img src="http://www.51hei.com/bbs/uc_server/data/avatar/000/05/93/06_avatar_middle.jpg" onerror="this.onerror=null;this.src='http://www.51hei.com/bbs/uc_server/images/noavatar_middle.gif'" /></a></div>
</div>
</div>
</td>
	
<td class="plc">
<div class="pi">
<div id="fj" class="y">
<label class="z">电梯直达</label>
<input type="text" class="px p_fre z" size="2" onkeyup="$('fj_btn').href='forum.php?mod=redirect&ptid=24471&authorid=0&postno='+this.value" onkeydown="if(event.keyCode==13) {window.location=$('fj_btn').href;return false;}" title="跳转到指定楼层" />
<a href="javascript:;" id="fj_btn" class="z" title="跳转到指定楼层"><img src="static/image/common/fj_btn.png" alt="跳转到指定楼层" class="vm" /></a>
</div>
<strong>
<a href="http://www.51hei.com/bbs/dpj-24471-1.html"   id="postnum82746" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
楼主</a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon82746" src="static/image/common/online_member.gif" />
<a href="http://www.51hei.com/bbs/space-uid-59306.html" target="_blank" class="xi2">lxw0326</a>
<em id="authorposton82746">发表于 2014-2-27 14:58</em>
<span class="pipe">|</span>
<a href="http://www.51hei.com/bbs/forum.php?mod=viewthread&amp;tid=24471&amp;page=1&amp;authorid=59306" rel="nofollow">只看该作者</a>
<span class="none"><img src="static/image/common/arw_r.gif" class="vm" alt="回帖奖励" /></span>
<span class="pipe show">|</span><a href="http://www.51hei.com/bbs/forum.php?mod=viewthread&amp;tid=24471&amp;extra=page%3D1&amp;ordertype=1"  class="show">倒序浏览</a>
<span class="pipe show">|</span><a href="javascript:;" onclick="readmode($('thread_subject').innerHTML, 82746);" class="show">阅读模式</a>
</div>
</div>
</div><div class="pct"><style type="text/css">.pcb{margin-right:0}</style><div class="pcb">
 
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_82746">
<div align="left"><font face="宋体">一、在</font>C51<font face="宋体">中嵌入汇编</font></div><br />
<div align="left"><font face="宋体">在这个例子里，阐述了编写</font>c51<font face="宋体">程序调用汇编函数的一种方法，这个外部函数的入口参数是一个字符型变量和一个位变量，返回值是一个整型变量。例中，先用</font>c51<font face="宋体">写出这个函数的主体，然后用</font>SRC<font face="宋体">控制指令编译产生</font>asm<font face="宋体">文件，进一步修改这个</font>asm<font face="宋体">文件就得到我们所要的汇编函数。该方法让编译器自动完成各种段的安排，提高了汇编程序的编写效率。</font></div><br />
<div align="left">step1. <font face="宋体">按写普通</font>c51<font face="宋体">程序方法，建立工程，在里面导入</font>main.c<font face="宋体">文件和</font>CFUNC.c<font face="宋体">文件。相关文件如下：</font></div><br />
<div align="left">//main.c<font face="宋体">文件</font></div><div align="left">#include &lt; reg51.h &gt;</div><div align="left">#define uchar unsigned char</div><div align="left">#define uint unsigned int</div><div align="left">extern uint AFUNC(uchar v_achr,bitv_bflag);</div><div align="left">void main()</div><div align="left">{</div><div align="left">&nbsp; &nbsp;bit BFLAG;</div><div align="left">&nbsp; &nbsp;uchar mav_chr;</div><div align="left">&nbsp; &nbsp;uint&nbsp; &nbsp; mvintrslt;</div><div align="left">&nbsp; &nbsp;mav_chr=0xd4; BFLAG=1;</div><div align="left">&nbsp; &nbsp;mvintrslt=AFUNC(mav_chr,BFLAG);</div><div align="left">}</div><div align="left">//CFUNC.c<font face="宋体">文件</font></div><div align="left">#define uchar unsigned char</div><div align="left">#define uint unsigned int</div><div align="left">uint AFUNC(uchar v_achr,bit v_bflag)</div><div align="left">{</div><div align="left">&nbsp; &nbsp;uchar tmp_vchr;</div><div align="left">&nbsp; &nbsp;uint&nbsp;&nbsp;tp_vint;</div><div align="left">&nbsp; &nbsp;tmp_vchr=v_achr;</div><div align="left">&nbsp; &nbsp;tp_vint=(uint)v_bflag;</div><div align="left">&nbsp; &nbsp;return tmp_vchr+(tp_vint&lt;&lt;8);</div><div align="left">}</div><br />
<div align="left">step2. <font face="宋体">在</font> Project <font face="宋体">窗口中包含汇编代码的</font> C <font face="宋体">文件上右键，选择“</font>Optionsfor ...<font face="宋体">”，点击右边的“</font>Generate Assembler SRC File<font face="宋体">”和“</font>Assemble SRC File<font face="宋体">”，使检查框由灰色变成黑色</font>(<font face="宋体">有效</font>)<font face="宋体">状态</font>;</div><br />
<div align="left">step3. <font face="宋体">根据选择的编译模式，把相应的库文件（如</font>Small <font face="宋体">模式时，是</font> Keil\C51\Lib\C51S.Lib<font face="宋体">）加入工程中，该文件必须作为工程的最后文件；</font></div><br />
<div align="left">step4. build<font face="宋体">这个工程后将会产生一个</font>CFUNC.SRC<font face="宋体">的文件，将这个文件改名为</font>CFUNC.A51<font face="宋体">（也可以通过编译选项直接产生</font>CFUNC.A51<font face="宋体">文</font></div><div align="left">&nbsp; &nbsp;&nbsp; &nbsp;<font face="宋体">件），然后在工程里去掉库文件（如</font>C51S.Lib)<font face="宋体">和</font>CFUNC.c,<font face="宋体">而将</font>CFUNC.A51<font face="宋体">添加到工程里。</font></div><br />
<div align="left">//CFUNC.SRC<font face="宋体">文件如下</font></div><div align="left">.\CFUNC.SRC generated from: CFUNC.c</div><div align="left">NAME CFUNC</div><div align="left">?PR?_AFUNC?CFUNC&nbsp; &nbsp;&nbsp;&nbsp;SEGMENT CODE</div><div align="left">?BI?_AFUNC?CFUNC&nbsp; &nbsp;&nbsp;&nbsp;SEGMENT BIT OVERLAYABLE</div><div align="left">&nbsp; &nbsp;PUBLIC&nbsp; &nbsp; ?_AFUNC?BIT</div><div align="left">&nbsp; &nbsp;PUBLIC&nbsp; &nbsp; _AFUNC</div><div align="left">&nbsp; &nbsp;RSEG&nbsp;&nbsp;?BI?_AFUNC?CFUNC</div><div align="left">?_AFUNC?BIT:</div><div align="left">&nbsp; &nbsp;v_bflag?041:&nbsp; &nbsp;DBIT&nbsp; &nbsp;1</div><div align="left">; #define uchar unsigned char</div><div align="left">; #define uint unsigned int</div><div align="left">;</div><div align="left">; uint AFUNC(uchar v_achr,bit v_bflag)</div><div align="left">&nbsp; &nbsp;RSEG&nbsp;&nbsp;?PR?_AFUNC?CFUNC</div><div align="left">_AFUNC:</div><div align="left">&nbsp; &nbsp;USING&nbsp; &nbsp; 0</div><div align="left">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;; SOURCE LINE # 5</div><div align="left">;---- Variable 'v_achr?040' assigned toRegister 'R7' ----</div><div align="left">; {</div><div align="left">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;; SOURCE LINE # 6</div><div align="left">;&nbsp; &nbsp; uchar tmp_vchr;</div><div align="left">;&nbsp; &nbsp; uint&nbsp; &nbsp; tp_vint;</div><div align="left">;</div><div align="left">;&nbsp; &nbsp; tmp_vchr=v_achr;</div><div align="left">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;; SOURCE LINE # 10</div><div align="left">;---- Variable 'tmp_vchr?042' assigned toRegister 'R5' ----</div><div align="left">&nbsp; &nbsp;MOV&nbsp; &nbsp;&nbsp; &nbsp;R5,AR7</div><div align="left">;&nbsp; &nbsp; tp_vint=(uint)v_bflag;</div><div align="left">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;; SOURCE LINE # 11</div><div align="left">&nbsp; &nbsp;MOV&nbsp; &nbsp;&nbsp; &nbsp;C,v_bflag?041</div><div align="left">&nbsp; &nbsp;CLR&nbsp; &nbsp;&nbsp; &nbsp;A</div><div align="left">&nbsp; &nbsp;RLC&nbsp; &nbsp;&nbsp; &nbsp;A</div><div align="left">;---- Variable 'tp_vint?043' assigned toRegister 'R6/R7' ----</div><div align="left">;&nbsp; &nbsp; return tmp_vchr+(tp_vint&lt;&lt;8);</div><div align="left">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;; SOURCE LINE # 12</div><div align="left">&nbsp; &nbsp;MOV&nbsp; &nbsp;&nbsp; &nbsp;R6,A</div><div align="left">&nbsp; &nbsp;MOV&nbsp; &nbsp;&nbsp; &nbsp;R4,#00H</div><div align="left">&nbsp; &nbsp;CLR&nbsp; &nbsp;&nbsp; &nbsp;A</div><div align="left">&nbsp; &nbsp;ADD&nbsp; &nbsp;&nbsp; &nbsp;A,R5</div><div align="left">&nbsp; &nbsp;MOV&nbsp; &nbsp;&nbsp; &nbsp;R7,A</div><div align="left">&nbsp; &nbsp;MOV&nbsp; &nbsp;&nbsp; &nbsp;A,R4</div><div align="left">&nbsp; &nbsp;ADDC&nbsp; &nbsp;&nbsp;&nbsp;A,R6</div><div align="left">&nbsp; &nbsp;MOV&nbsp; &nbsp;&nbsp; &nbsp;R6,A</div><div align="left">; }</div><div align="left">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;; SOURCE LINE # 13</div><div align="left">?C0001:</div><div align="left">&nbsp; &nbsp;RET</div><div align="left">; END OF _AFUNC</div><div align="left">&nbsp; &nbsp;END</div><br />
<div align="left">step5. <font face="宋体">检查</font>main.c<font face="宋体">的“</font>GenerateAssembler SRC File<font face="宋体">”和“</font>Assemble SRC File<font face="宋体">”是否有效，若是有效则点击使检查框变成无效状态；再次</font>build<font face="宋体">这个工程，到此你已经得到汇编函数的主体，修改函数里面的汇编代码就得到你所需的汇编函数了。</font></div><br />
<br />
<br />
<br />
<br />
<br />
<div align="left"><font face="宋体">二、</font> keil<font face="宋体">中直接嵌入汇编</font></div><br />
<div align="left">step1<font face="宋体">、在</font>C<font face="宋体">文件中要嵌入汇编代码片以如下方式加入汇编代码：</font></div><div align="left">#pragma ASM</div><div align="left">; Assembler Code Here</div><div align="left">#pragma ENDASM</div><br />
<div align="left">step2<font face="宋体">、在</font> Project <font face="宋体">窗口中包含汇编代码的</font> C <font face="宋体">文件上右键，选择“</font>Optionsfor ...<font face="宋体">”，点击右边的“</font>Generate Assembler SRC File<font face="宋体">”和“</font>Assemble SRC File<font face="宋体">”，使检查框由灰色变成黑色</font>(<font face="宋体">有效</font>)<font face="宋体">状态；</font></div><br />
<div align="left">step3<font face="宋体">、根据选择的编译模式，把相应的库文件</font>(<font face="宋体">如</font> Small <font face="宋体">模式时，是</font>Keil\C51\Lib\C51S.Lib)<font face="宋体">加入工程中</font>, <font face="宋体">该文件必须作为工程的最后文件；</font></div><br />
<div align="left">step4<font face="宋体">、编译，即可生成目标代码。</font></div><br />
<br />
<br />
<br />
</td></tr></table>


</div>
<div id="comment_82746" class="cm">
</div>

<div id="post_rate_div_82746"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div id="p_btn" class="mtw mbm hm cl">
<div class="tshare cl">
<b>分享到:&nbsp;</b>


<a href="http://www.51hei.com/bbs/home.php?mod=spacecp&ac=plugin&id=qqconnect:spacecp&pluginop=share&sh_type=4&thread_id=24471" id="k_share_to_qq" title="QQ好友和群" target="_blank"><i><img src="static/image/common/qq_share.png" alt="QQ好友和群" />QQ好友和群</i></a>
<a href="javascript:void(0);" id="k_qqshare" onclick="postToQzone();" title="QQ空间"><i><img src="static/image/common/qzone.gif" alt="QQ空间" />QQ空间</i></a>
<a href="javascript:void(0)" onclick="postToWb();" id="k_weiboshare" title="腾讯微博"><i><img src="static/image/common/weibo.png" alt="腾讯微博" />腾讯微博</i></a>
<a href="javascript:void(0);" onclick="postToPengyou();" id="k_pengyoushare" title="腾讯朋友"><i><img src="static/image/common/pengyou.png" alt="腾讯朋友" />腾讯朋友</i></a>
<script type="text/javascript">
function postToWb(){
var _t = encodeURI(document.title);
var _url = encodeURIComponent(document.location);
var _appkey = encodeURI("ce7fb946290e4109bdc9175108b6db3a");
var _pic = "";
var _site = encodeURIComponent("单片机论坛");
var _from = 'discuz';
var _u = 'http://v.t.qq.com/share/share.php?url='+_url+'&appkey='+_appkey+'&site='+_site+'&pic='+_pic+'&title='+_t+'&from='+_from;
window.open( _u,'', 'width=700, height=680, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, location=yes, resizable=no, status=no' );
}
function postToPengyou(){
var _url = encodeURIComponent(document.location.href);
var _site = encodeURIComponent("单片机论坛");
var _title = encodeURIComponent("Keil C51汇编混合编程详解");
var _pics = "";
var _from = 'discuz';
var _u = 'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?to=pengyou&url='+_url+'&site='+_site+'&title='+_title+'&pics='+_pics+'&from='+_from;
window.open(_u);
}
</script>
	

</div>

<a href="http://www.51hei.com/bbs/home.php?mod=spacecp&amp;ac=favorite&amp;type=thread&amp;id=24471&amp;formhash=4b27fe9d" id="k_favorite" onclick="showWindow(this.id, this.href, 'get', 0);" onmouseover="this.title = $('favoritenumber').innerHTML + ' 人收藏'" title="收藏本帖"><i><img src="static/image/common/fav.gif" alt="收藏" />收藏<span id="favoritenumber" style="display:none">0</span></i></a>

<a class="followp" href="home.php?mod=spacecp&amp;ac=follow&amp;op=relay&amp;tid=24471&amp;from=forum" onclick="showWindow('relaythread', this.href, 'get', 0);" title="转播求扩散"><i><img src="static/image/common/rt.png" alt="转播" />转播</i></a>
<a class="sharep" href="home.php?mod=spacecp&amp;ac=share&amp;type=thread&amp;id=24471" onclick="showWindow('sharethread', this.href, 'get', 0);" title="分享推精华"><i><img src="static/image/common/oshr.png" alt="分享" />分享</i></a>
<a href="http://www.51hei.com/bbs/forum.php?mod=collection&amp;action=edit&amp;op=addthread&amp;tid=24471" id="k_collect" onclick="showWindow(this.id, this.href);return false;" onmouseover="this.title = $('collectionnumber').innerHTML + ' 人淘帖'" title="淘好帖进专辑"><i><img src="static/image/common/collection.png" alt="分享" />淘帖<span id="collectionnumber" style="display:none">0</span></i></a>
<a id="recommend_add" href="forum.php?mod=misc&amp;action=recommend&amp;do=add&amp;tid=24471&amp;hash=4b27fe9d"  onclick="showWindow('login', this.href)" onmouseover="this.title = $('recommendv_add').innerHTML + ' 人顶'" title="顶一下"><i><img src="static/image/common/rec_add.gif" alt="顶" />顶<span id="recommendv_add" style="display:none">0</span></i></a>
<a id="recommend_subtract" href="forum.php?mod=misc&amp;action=recommend&amp;do=subtract&amp;tid=24471&amp;hash=4b27fe9d"  onclick="showWindow('login', this.href)" onmouseover="this.title = $('recommendv_subtract').innerHTML + ' 人踩'" title="踩一下"><i><img src="static/image/common/rec_subtract.gif" alt="踩" />踩<span id="recommendv_subtract" style="display:none">0</span></i></a>
</div>
</td>
</tr>
<tr id="_postposition82746"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="forum.php?mod=post&amp;action=reply&amp;fid=2&amp;tid=24471&amp;reppost=82746&amp;extra=page%3D1&amp;page=1" onclick="showWindow('reply', this.href)">回复</a>
</em>

<p>
<a href="javascript:;" id="mgc_post_82746" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport82746', 'misc.php?mod=report&rtype=post&rid=82746&tid=24471&fid=2', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_82746_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_82746')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="postlistreply" class="pl"><div id="post_new" class="viewthread_table" style="display: none"></div></div>
</div>


<form method="post" autocomplete="off" name="modactions" id="modactions">
<input type="hidden" name="formhash" value="4b27fe9d" />
<input type="hidden" name="optgroup" />
<input type="hidden" name="operation" />
<input type="hidden" name="listextra" value="page%3D1" />
<input type="hidden" name="page" value="1" />
</form>



<div class="pgs mtm mbm cl">
<span class="pgb y"><a href="http://www.51hei.com/bbs/mcu-2-1.html">返回列表</a></span>
<a id="newspecialtmp" onmouseover="$('newspecial').id = 'newspecialtmp';this.id = 'newspecial';showMenu({'ctrlid':this.id})" onclick="showWindow('newthread', 'forum.php?mod=post&action=newthread&fid=2')" href="javascript:;" title="发新帖"><img src="static/image/common/pn_post.png" alt="发新帖" /></a>
</div>

<!--[diy=diyfastposttop]--><div id="diyfastposttop" class="area"></div><!--[/diy]-->
<script type="text/javascript">
var postminchars = parseInt('6');
var postmaxchars = parseInt('140000');
var disablepostctrl = parseInt('0');
</script>

<div id="f_pst" class="pl bm bmw">
<form method="post" autocomplete="off" id="fastpostform" action="forum.php?mod=post&amp;action=reply&amp;fid=2&amp;tid=24471&amp;extra=page%3D1&amp;replysubmit=yes&amp;infloat=yes&amp;handlekey=fastpost" onSubmit="return fastpostvalidate(this)">
<table cellspacing="0" cellpadding="0">
<tr>
<td class="pls">
</td>
<td class="plc">

<span id="fastpostreturn"></span>


<div class="cl">
<div id="fastsmiliesdiv" class="y"><div id="fastsmiliesdiv_data"><div id="fastsmilies"></div></div></div><div class="hasfsl" id="fastposteditor">
<div class="tedt mtn">
<div class="bar">
<span class="y">
<a href="http://www.51hei.com/bbs/forum.php?mod=post&amp;action=reply&amp;fid=2&amp;tid=24471" onclick="return switchAdvanceMode(this.href)">高级模式</a>
</span><script src="data/cache/seditor.js?h49" type="text/javascript"></script>
<div class="fpd">
<a href="javascript:;" title="文字加粗" class="fbld">B</a>
<a href="javascript:;" title="设置文字颜色" class="fclr" id="fastpostforecolor">Color</a>
<a id="fastpostimg" href="javascript:;" title="图片" class="fmg">Image</a>
<a id="fastposturl" href="javascript:;" title="添加链接" class="flnk">Link</a>
<a id="fastpostquote" href="javascript:;" title="引用" class="fqt">Quote</a>
<a id="fastpostcode" href="javascript:;" title="代码" class="fcd">Code</a>
<a href="javascript:;" class="fsml" id="fastpostsml">Smilies</a>
</div></div>
<div class="area">
<div class="pt hm">
您需要登录后才可以回帖 <a href="member.php?mod=logging&amp;action=login" onclick="showWindow('login', this.href)" class="xi2">登录</a> | <a href="member.php?mod=register" class="xi2">立即注册</a>


<a href="http://www.51hei.com/bbs/connect.php?mod=login&op=init&referer=forum.php%3Fmod%3Dviewthread%26tid%3D24471%26extra%3Dpage%253D1%26page%3D1%26&statfrom=login" target="_top" rel="nofollow"><img src="static/image/common/qq_login.gif" class="vm" /></a>

</div>
</div>
</div>
</div>
</div>
<div id="seccheck_fastpost">
</div>


<input type="hidden" name="formhash" value="4b27fe9d" />
<input type="hidden" name="usesig" value="" />
<input type="hidden" name="subject" value="  " />
<p class="ptm pnpost">
<a href="http://www.51hei.com/bbs/home.php?mod=spacecp&amp;ac=credit&amp;op=rule&amp;fid=2" class="y" target="_blank">本版积分规则</a>
<button type="button" onclick="showWindow('login', 'member.php?mod=logging&action=login&guestmessage=yes')" onmouseover="checkpostrule('seccheck_fastpost', 'ac=reply');this.onmouseover=null" name="replysubmit" id="fastpostsubmit" class="pn pnc vm" value="replysubmit" tabindex="5"><strong>发表回复</strong></button>
<label class="lb"><input type="checkbox" name="adddynamic" class="pc" value="1" />回帖并转播</label>
<label for="fastpostrefresh"><input id="fastpostrefresh" type="checkbox" class="pc" />回帖后跳转到最后一页</label>
<script type="text/javascript">if(getcookie('fastpostrefresh') == 1) {$('fastpostrefresh').checked=true;}</script>
</p>
</td>
</tr>
</table>
</form>
</div>

<script type="text/javascript">
var connect_qzone_share_url = 'http://www.51hei.com/bbs/home.php?mod=spacecp&ac=plugin&id=qqconnect:spacecp&pluginop=share&sh_type=1&thread_id=24471';
var connect_weibo_share_url = 'http://www.51hei.com/bbs/home.php?mod=spacecp&ac=plugin&id=qqconnect:spacecp&pluginop=share&sh_type=2&thread_id=24471';
var connect_thread_info = {
thread_url: 'http://www.51hei.com/bbs/dpj-24471-1.html',
thread_id: '24471',
post_id: '82746',
forum_id: '2',
author_id: '59306',
author: 'lxw0326'
};

connect_autoshare = '0';
connect_isbind = '';
if(connect_autoshare == 1 && connect_isbind) {
_attachEvent(window, 'load', function(){
connect_share(connect_weibo_share_url, connect_openid);
});
}
</script>


<script type="text/javascript">document.onkeyup = function(e){keyPageScroll(e, 0, 0, 'forum.php?mod=viewthread&tid=24471', 1);}</script>
</div>

<div class="wp mtn">
<!--[diy=diy3]--><div id="diy3" class="area"></div><!--[/diy]-->
</div>

<script type="text/javascript">
function succeedhandle_followmod(url, msg, values) {
var fObj = $('followmod_'+values['fuid']);
if(values['type'] == 'add') {
fObj.innerHTML = '不收听';
fObj.href = 'home.php?mod=spacecp&ac=follow&op=del&fuid='+values['fuid'];
} else if(values['type'] == 'del') {
fObj.innerHTML = '收听TA';
fObj.href = 'home.php?mod=spacecp&ac=follow&op=add&hash=4b27fe9d&fuid='+values['fuid'];
}
}
fixed_avatar([82746], 1);
</script>	</div>


<script type="text/javascript">var cookieLogin = Ajax("TEXT");cookieLogin.get("connect.php?mod=check&op=cookie", function() {});</script>

<div id="ft" class="wp cl">
<div id="flk" class="y">
<p>
<a href="http://www.51hei.com/bbs/forum.php?mobile=yes" >手机版</a><span class="pipe">|</span><a href="http://www.51hei.com/bbs/forum.php?mod=misc&action=showdarkroom" >小黑屋</a><span class="pipe">|</span><strong><a href="http://www.51hei.com/bbs/" target="_blank">单片机论坛</a></strong>
<span class="pipe">|</span><a target="_blank" href="//shang.qq.com/wpa/qunwpa?idkey=0ff5ba174e874070f5b0e594c2d897c820f0f1940a319ef2ad6e453cad77f0c2"><img border="0" src="//pub.idqqimg.com/wpa/images/group.png" alt="51黑电子论坛技术交流" title="51黑电子论坛技术交流"></a>
<a href="http://wpa.qq.com/msgrd?V=3&amp;uin=125739409&amp;Site=单片机论坛&amp;Menu=yes&amp;from=discuz" target="_blank" title="QQ"><img src="static/image/common/site_qq.jpg" alt="QQ"></a>
管理员QQ:125739409;技术交流QQ群636986012</p>
<p class="xs0">

<span id="debuginfo">
</span>
</p>
</div>
<div id="frt">
<p>Powered by <strong><a href="http://www.51hei.com" target="_blank">单片机教程网</a></strong> </p>
<p class="xs0"><img src="http://www.51hei.com/myf/wxbb.jpg" style="height:88px;"> </p>
</div></div>
<script src="home.php?mod=misc&ac=sendmail&rand=1578994019" type="text/javascript"></script>
<div id="scrolltop">
<span><a href="http://www.51hei.com/bbs/forum.php?mod=post&amp;action=reply&amp;fid=2&amp;tid=24471&amp;extra=page%3D1&amp;page=1" onclick="showWindow('reply', this.href)" class="replyfast" title="快速回复"><b>快速回复</b></a></span>
<span hidefocus="true"><a title="返回顶部" onclick="window.scrollTo('0','0')" class="scrolltopa" ><b>返回顶部</b></a></span>
<span>
<a href="http://www.51hei.com/bbs/mcu-2-1.html" hidefocus="true" class="returnlist" title="返回列表"><b>返回列表</b></a>
</span>
</div>
<script type="text/javascript">_attachEvent(window, 'scroll', function () { showTopLink(); });checkBlind();</script>
