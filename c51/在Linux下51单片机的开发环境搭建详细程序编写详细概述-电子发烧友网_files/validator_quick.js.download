!function(e,t){t.fn.Valid=function(){var e={chk:{user:/[\w\u4E00-\u9FA5\uF900-\uFA2D]{3,15}/,account:/^(1[3|4|5|8|7|9][0-9]\d{8}|[569]{1}\d{3}[-]?\d{4}|^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+)$/,loginPwd:/\S{6,20}/,pwd:/^(?![^a-zA-Z]+$)(?!\D+$).{6,20}$/,recheck:/.+/,email:/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/,code:/^[\w\u4E00-\u9FA5\uF900-\uFA2D]{4}$/,smscode:/^\d{6}$/,"*":/\S+/,m:/^(1[3|4|5|8|7|9][0-9]\d{8}|[569]{1}\d{3}[-]?\d{4})$/},tipText:{user:"用户名不能少于3个字符",account:"请填写正确格式的手机号码/邮箱",loginPwd:"请填写6-20位密码",pwd:"请填写6-20位密码，须包含字母与数字",code:"验证码格式不正确",smscode:"手机验证码格式不正确","*":"不能为空",m:"请填写正确格式的手机号码",recheck:"两次输入不一致",email:"请填写正确的邮箱"},utils:{ajaxUrl:function(e){var a=this;t.ajax({url:e,data:a.serialize(),type:"post",datatype:"json",success:function(e){0==e.error_code?c.call(a):r.call(a,e.msg)}})},showErr:function(e){var a=this;a.filter(":text,:password").addClass("ui-text-err");var i=a.next(".ui-err");(i.length?i:t("<span class='ui-err'></span>").insertAfter(a)).text(e),a.data("valid",!1)},removeErr:function(){var e=this;this.removeClass("ui-text-err").next(".ui-err").remove(),e.data("valid",!0)}}},a=0,i=0,n=decodeURIComponent(document.location.hash.replace(/^#/,""));t.postMessage(t("body").outerHeight()+"",n,parent);var s,l=e.chk,o=e.utils,r=o.showErr,c=o.removeErr,d=e.tipText,f="",h=t(this),u=h.find("[type=submit]"),m=h.find("[datatype]"),g=t(".ajax_msg");g=0==g.length?h.find(".ajax_msg"):g;var p=function(){u.text(h[0].btnText).removeAttr("disabled")};if(t("#regist_form").length||t("#findpwd_form").length||t("#needverify").length||t("#accountForm").length)if(s)s.show();else{s=new noCaptcha;var v="FFFF0000000001784D08",b="login",w=[v,(new Date).getTime(),Math.random()].join(":"),x={renderTo:"#drag_verify",appkey:v,scene:b,token:w,callback:function(e){t("#csessionid").val(e.csessionid),t("#sig").val(e.sig),t("#token").val(w),t("#aliscene").val(b),g.html("")}};s.init(x),s.changeResetDataTypeItem=["account","m"],setInterval(function(){var e=t(".clickCaptcha");e.length&&(!e[0].expend_height&&e.filter(":visible").length?(e[0].expend_height=!0,t.postMessage(t("body").outerHeight()+230+"",n,parent)):e[0].expend_height&&e.filter(":hidden").length&&t("#csessionid").val()&&(e[0].expend_height=!1,t.postMessage(t("body").outerHeight()+"",n,parent)))},100),t.postMessage(t("body").outerHeight()+"",n,parent)}m.blur(function(){var e=t(this),a=e.attr("datatype"),i=e.val(),s=e.attr("ajaxurl"),f=e.attr("data-required");if("0"!=f||""!=i){if(l[a].test(i))s?o.ajaxUrl.call(e,s):c.call(e),e.is("[recheck]")&&i!==m.filter("[name="+e.attr("recheck")+"]").val()&&r.call(e,d.recheck),("account"==a||"m"==a)&&(l.m.test(i)?(t(".J_mobCode").show(),t("#drag_verify").show()):t(".J_mobCode").hide());else{if("smscode"==e.attr("datatype"))return;r.call(e,d[a])}t.postMessage(t("body").outerHeight()+"",n,parent)}}).focus(function(){c.call(t(this)),g.html("")}).change(function(){s&&(void 0===s.changeResetDataTypeItem||s.changeResetDataTypeItem&&~t.inArray(t(this).attr("datatype"),s.changeResetDataTypeItem))&&(s.reload(),t("#csessionid").val(""),t("#sig").val(""),t("#token").val(""),t("#aliscene").val(""))}),h.submit(function(e){e.preventDefault();var l=!0,o=this;return m=m.filter(":visible"),m=m.filter(":enabled"),m.each(function(){var e=t(this);if("0"!=e.attr("data-required")||""!=e.val())return void 0===e.data("valid")&&m.blur(),l=!!e.data("valid"),l||e.blur().focus(!1),l}),s&&(h.find("[name=csessionid]").val()||(h.find(".ajax_msg").html("请先拖动上方滑块到合适位置"),l=!1)),l&&"disabled"!=u.attr("disabled")&&t.ajax({url:h.attr("action"),type:h.attr("method"),datatype:"json",data:h.serialize(),beforeSend:function(){o.btnText=u.text()||u.val(),u.text("请稍候...").attr("disabled","disabled")},success:function(e){var l=!!e.data&&e.data.syncurl,c="",d=n.match(/\w+:\/\/[^\/]*/);if(d=d?d[0]:"","failed"==e.status){if("40030"==e.field){if("login_form"==h.attr("id"))var v="#drag_verify_log";else var v="#drag_verify";s=new noCaptcha;var b="FFFF0000000001784D08",w="login",x=[b,(new Date).getTime(),Math.random()].join(":"),y={renderTo:v,appkey:b,scene:w,token:x,callback:function(e){h.find("[name=csessionid]").val(e.csessionid),h.find("[name=sig").val(e.sig),h.find("[name=token").val(x),h.find("[name=aliscene").val(w),g.html("")}};s.init(y),setInterval(function(){var e=t(".clickCaptcha");e.length&&(!e[0].expend_height&&e.filter(":visible").length?(e[0].expend_height=!0,t.postMessage(t("body").outerHeight()+230+"",n,parent)):e[0].expend_height&&e.filter(":hidden").length&&t("#csessionid").val()&&(e[0].expend_height=!1,t.postMessage(t("body").outerHeight()+"",n,parent)))},100),t.postMessage(t("body").outerHeight()+"",n,parent)}s&&(s.reload(),t("#csessionid").val(""),t("#sig").val(""),t("#token").val(""),t("#aliscene").val("")),e.field&&m.filter("[name="+e.field+"]").length>0?r.call(m.filter("[name="+e.field+"]"),e.msg):h.find(".ajax_msg").html(e.msg),h.find("[name=code]").text(""),h.find(".verify").click(),p(),u.text(o.btnText).removeAttr("disabled")}else{if(e.verification)return void(window.location.href=e.verification+"#"+d);if(f=e.data.referer,i=0,"self"==e.data.target){if(l){for(var k=0;k<l.length;k++)c+="<img src='"+l[k]+"'/>";t(c).hide().appendTo("body").on("error",function(){i++,i==l.length&&(top.location.href=f)})}else top.location.href=f;{setTimeout(function(){top.location.href=f},3e3)}}else if(l){a=l.length;for(var _=0;a>_;_++)0==l[_].search(d)?t.postMessage(encodeURIComponent(l[_]),n,parent):c+="<img src="+l[_]+">";if(t(c).hide().appendTo("body").on("error",function(){i++}),f){setTimeout(function(){top.location.href=unescape(window.location.hash.replace("#",""))},3e3)}}else f.search("/User/account")>=0?location.href=f:top.location.href=f.replace(/&amp;/g,"&");u.text("请稍候...").attr("disabled","disabled")}},error:function(){p(),u.text(o.btnText).removeAttr("disabled")}}),!1}),h.find(".J_mobCode a").click(function(){var e=t(this);if(e.hasClass("disabled"))return!1;if(!t("[name=token]").val())return h.find(".ajax_msg").html("请先拖动上方滑块到合适位置"),!1;var a=e.attr("dataurl")||"/register/regsms";t.ajax({url:a,data:h.find("[name=code],[name=account],[name=phone],[name=csessionid],[name=sig],[name=token],[name=aliscene]").serialize(),type:"post",datatype:"json",beforeSend:function(){e.addClass("disabled")},success:function(a){switch(0!=a.error_code&&(s.reload(),t("#csessionid").val(""),t("#sig").val(""),t("#token").val(""),t("#aliscene").val("")),a.error_code){case 0:c.call(m.filter("[name=code]"));var i=60,l=setInterval(function(){i--,e.html(i+"秒"),0==i&&(clearTimeout(l),e.removeClass("disabled").html("获取验证码"))},1e3);break;case 4:e.closest("form").find(".verify").click(),r.call(m.filter("[name=code]"),a.msg),e.removeClass("disabled");break;default:h.find(".ajax_msg").html(a.msg),e.removeClass("disabled"),t.postMessage(t("body").outerHeight()+"",n,parent)}}})}),t(".get_mobile_code a").click(function(){var e=t("form").find("[name=code]"),a=new RegExp(/^[\w\u4E00-\u9FA5\uF900-\uFA2D]{4}$/);if(c.call(e),g.html(""),!a.test(e.val()))return void r.call(e,"验证码不正确");var i=t(this);t.ajax({url:"/login/loginsms",type:"post",data:e.serialize(),beforeSend:function(){i.hasClass("disabled")||i.addClass("disabled")},success:function(t){switch(t.error_code){case 0:c.call(i);var a=60,n=setInterval(function(){a--,i.html(a+"秒"),0==a&&(clearTimeout(n),i.removeClass("disabled").html("获取验证码"))},1e3);break;case 4:i.closest("form").find(".verify").click(),r.call(e.filter("[name=code]"),t.msg);break;default:h.find(".ajax_msg").html(t.msg)}},complete:function(){i.removeClass("disabled")}})}),t("#jq-change_mobile a").click(function(){t("#jq-change_mobile").hide(),t("#jq-mobile-input-box").show()});var y=null,k=null;t.receiveMessage(function(e){function s(){var e=location.href;e.search("/password/changepwd")>=0?document.body.innerHTML='<div class="success_tip"><span class="iconfont changePwdSucc">&#xe605;</span>密码修改成功</div>':e.search("/user/account")>=0?document.body.innerHTML='<span class="iconfont changePwdSucc">&#xe605;</span>修改成功':(window.ActiveXObject&&!window.XMLHttpRequest&&(document.location="about:blank"),f?parent.location=f:t.postMessage("reload",n,parent))}var l=1e4,o=arguments;"success"==e.data?(i==a-1?s():(clearTimeout(k),k=setTimeout(function(){o.callee({data:"success"})},200)),null==y&&(y=setTimeout(s,l))):"object"==typeof e.data&&e.data.UC_MSG_NAME||(h.find(".ajax_msg").html("失败"),p())})},t("form").each(function(e,a){t(a).Valid()}),t(".ckeckPwdStrength").each(function(e,a){var i=t('<ul id="pwdStrength"><li>弱</li><li>中</li><li>强</li></ul>');t(a).after(i.hide()),t(a).on("keyup","input[type=password]",function(){var e=t(this).val(),a=new RegExp("^(?=.{10,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9]).*$","g"),n=new RegExp("^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$","g"),s=new RegExp("(?=.{6,}).*","g");0==e.length?i.hide():s.test(e)?a.test(e)?(i.find("li:eq(0)").attr("class","thick"),i.find("li:eq(1)").attr("class","middle"),i.find("li:eq(2)").attr("class","strong"),i.show()):n.test(e)?(i.find("li:eq(0)").attr("class","thick"),i.find("li:eq(1)").attr("class","middle"),i.find("li:eq(2)").attr("class",""),i.show()):(i.find("li:eq(0)").attr("class","thick"),i.find("li:eq(1)").attr("class",""),i.find("li:eq(2)").attr("class",""),i.show()):(i.find("li:eq(0)").attr("class",""),i.find("li:eq(1)").attr("class",""),i.find("li:eq(2)").attr("class",""),i.show()),parentUrl=decodeURIComponent(document.location.hash.replace(/^#/,"")),t.postMessage(t("body").outerHeight()+"",parentUrl,parent)})})}(window,$);