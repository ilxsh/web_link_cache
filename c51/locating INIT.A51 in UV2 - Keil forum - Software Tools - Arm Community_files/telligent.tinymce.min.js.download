(function(){tinymce.PluginManager.add("bottomtoolbar",function(b,u){var q=[];$.each(b.settings.menu,function(t,f){var a=[];$.each((f.items||"").split(/[ ,]/),function(h,l){("|"==l||b.menuItems[l])&&a.push("|"==l?{text:"|"}:b.menuItems[l])});0<a.length&&(b.addButton("menu_"+t,{type:"menubutton",text:f.title||"",menu:a}),q.push("menu_"+t))});q=q.join(" ");0>b.settings.toolbar.indexOf(q)&&(b.settings.toolbar=q+" "+(b.settings.toolbar||""));b.on("Init",function(){var t=b.getContainer(),f=$(".mce-edit-area",
t).css("border-width","0 0 1px 0");$(".mce-menubar",t).hide();$(".mce-toolbar-grp",t).insertAfter(f)})});tinymce.PluginManager.add("embeddables",function(b,u){var q=tinymce.html.Node,t=tinymce.util.JSON,f=this,a=null,h=0;f.editor=b;f.url=u;f.isEmbeddableSpan=function(c){return c&&"SPAN"===c.nodeName&&this.editor.dom.hasClass(c,"mceInsertEmbeddableItem")};f.openDialog=function(c,b){function l(){var d=$(x.getEl());$(".mceembeddableConfigureEmbeddable",d).prepend(s)}function k(){window.clearTimeout(v);
try{var d=$(".mcetelligent-frame",$(x.getEl()));if(0==d.length)return;document.activeElement!=d&&($.contains(x.getEl(),document.activeElement)||x.statusbar.focus());var c=d.get(0).contentWindow;if(c&&c.document&&0<(c.location+"").indexOf("embeddables/configure")){F&&(F=!1,s.hide(),d.css("visibility","visible"));var g=$("html",c.document).outerHeight(!0);$("*",c.document.body).each(function(){var d=$(this),c=d.css("position");if("absolute"==c||"fixed"==c){var a=d.offsetParent(),b=a.css("overflow-y");
0<a.length&&("hidden"==b||"scroll"==b)&&(c="");if("absolute"==c||"fixed"==c)c=d.offset(),c.top+d.outerHeight()>g&&(g=c.top+d.outerHeight(!0))}});var g=g+12,a=parseInt(d.css("height"),10);if(a!=g&&Math.abs(a-g)>w&&100<g){d.css("height",g+"px");for(var b=$(d.get(0).parentNode),l=x.getEl();0<b.length&&b.get(0)!=l;)b.hasClass("mce-abs-layout")||"absolute"==b.css("position")?b.css("height",g+"px"):b.css("height","auto"),b=b.parent();x.reflow()}}}catch(m){}v=window.setTimeout(function(){k()},250)}function g(d){return p.typeid!=
d?"":p.configuration}function d(d,c,g){d={typeid:d,id:c,configuration:g,elementId:"mceInsertEmbeddable"+h++};f.editor.execCommand("mceRepaint");d=f.dataToSpan(d);f.editor.selection.setNode(d);f.editor.nodeChanged();x.close()}var p={typeid:b},r,f=this,x,y="Insert {0}",v=null;if(null!=a&&0!=a.length){r=c?c:f.editor.selection.getNode();f.isEmbeddableSpan(r)&&(p=f.editor.dom.getAttrib(r,"data-mce-json"))&&(p=t.parse(p),y="Edit {0}");y=tinymce.util.I18n.translate(y);for(r=0;r<a.length;r++)if(a[r].typeid==
p.typeid){y=y.replace(/\{0\}/,a[r].name);break}r=$("<div></div>").css({width:"100px",height:"10px",overflow:"scroll"}).appendTo($("body"));var z=$("<div></div>").css({width:"100%",height:"20px"}).appendTo(r).outerWidth();r.remove();var w=100-z;f.editor.getParam("evolution_contenttypeid");$.telligent.evolution.url.encode(window.location);var s=$('<div class="ui-loading" style="color: #ddd; font-size: 50px; box-sizing: border-box; position: relative; top: 30px;"></div>'),F=!0;window.Embeddable={setConfiguration:d,
getConfiguration:g,ready:function(){k()},unready:function(){window.clearTimeout(v)}};x=f.editor.windowManager.open({layout:"flow",title:tinymce.util.I18n.translate(y),body:[{type:"container",html:'<div class="mceembeddableConfigureEmbeddable" style="width:680px; height: 100px;">'+f.getConfigurationHtml(p.typeid,p,"visibility:hidden;")+"</div>"}],buttons:[{text:"Ok",onclick:function(){var d=$(x.getEl());$(".mcetelligent-frame",d).get(0).contentWindow.embedFormSubmit()},subtype:"primary"},{text:"Cancel",
onclick:function(){x.close()}}],width:680});l()}};f.loadConfiguration=function(c,a,b){a.html(f.getConfigurationHtml(c,b))};f.getConfigurationHtml=function(c,a,b){c=f.url+"../../../apis/embeddables/configure?typeId="+c;null!=a&&(c+="&id="+a.id);return'<iframe class="mcetelligent-frame" role="button" tabindex="0" style="width: 100%; height: 200px; overflow: hidden;'+(b||"")+'" src="'+c+'" scrolling="no"></iframe>'};f.resolveWhitespace=function(c){if(!c)return c;" "==c.substr(0,1)&&(c="&nbsp;"+c.substr(1));
" "==c.substr(c.length-1)&&(c=c.substr(0,c.length-1)+"&nbsp;");return c};f.textToSpan=function(c){var a=this,b=a.editor;if(c.parent){for(var l=new q("div"),g=/\[embed:([^\]]*)\]/gi,d,p=0;d=g.exec(c.value);)(function(){for(var g=RegExp.$1.split(/:/g),r=g[0],v=g[1],z="",w=2;w<g.length;w++)z+=g[w];var s={id:v,typeid:r,configuration:z,elementId:"mceInsertEmbeddable"+h++};if(0<d.index)for(g=b.parser.parse(a.resolveWhitespace(c.value.substr(p,d.index-p))).getAll("p"),r=0;r<g.length;r++)for(;null!=(v=g[r].walk());)l.append(v);
g=new q("span",1);g.attr({id:s.elementId,"class":"mceItem mceInsertEmbeddableItem mceNonEditable","data-mce-json":t.serialize(s,"'"),contenteditable:"false"});l.append(g);a.getPreview(s,function(d,c,g,a){if(g=b.dom.get(s.elementId))a&&$(g).append($('<span class="preview">'+a+"</span>")),c=$('<span class="type-info">'+c+"</span>"),d&&c.prepend('<img src="'+d+'" />'),$(g).append(c)})})(),p=g.lastIndex;if(0<p){if(p<c.value.length)for(var g=b.parser.parse(a.resolveWhitespace(c.value.substr(p))).getAll("p"),
r=0;r<g.length;r++)for(var f;null!=(f=g[r].walk());)l.append(f);c.replace(l);l.unwrap()}}};f.spanToObject=function(c,a){var b;if(b=c.attr("data-mce-json")){b=t.parse(b);var l=f.generateEmbedCode(b);b=new q("#text",3);b.raw=!0;b.value=l;c.replace(b)}};f.dataToSpan=function(c){var a=this.editor,b=this.editor.dom.create("span",{id:c.elementId,"class":"mceItem mceInsertEmbeddableItem mceNonEditable","data-mce-json":t.serialize(c,"'"),contenteditable:"false"});this.getPreview(c,function(b,g,d,l){if(d=
a.dom.get(c.elementId))l&&$(d).append($('<span class="preview">'+l+"</span>")),g=$('<span class="type-info">'+g+"</span>"),b&&g.prepend('<img src="'+b+'" />'),$(d).append(g)});return b};f.getCallbackUrl=function(c){for(var a=this.url+"../../../apis/embeddables?",b={},l=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),g=0;g<l.length;g++){var d=l[g].split(/=/);2==d.length&&(b[d[0]]=d[1])}for(var p in c)b[encodeURIComponent(p)]=encodeURIComponent(c[p]);c=!0;for(p in b)c?c=!1:a+="&",a+=
p+"="+b[p];return a};f.getPreview=function(c,a){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"preview"}),data:"token="+encodeURIComponent(this.generateEmbedCode(c)),content_type:"application/x-www-form-urlencoded",success:function(c){c=tinymce.util.JSON.parse(c);try{c&&c.name?a(c.imageUrl,c.name,c.description,c.previewHtml):a("","","","")}catch(b){}},error:function(c){try{a("","","","")}catch(b){}}})};f.generateEmbedCode=function(c){return"[embed:"+c.typeid+":"+c.id+":"+c.configuration+"]"};
f.editor.on("PreInit",function(){f.editor.parser.addNodeFilter("#text",function(c){for(var a=c.length;a--;)f.textToSpan(c[a])});f.editor.serializer.addNodeFilter("span",function(c,a,b){a=c.length;for(var l;a--;)l=c[a],-1!==(l.attr("class")||"").indexOf("mceInsertEmbeddableItem")&&f.spanToObject(l,b)})});f.editor.on("init",function(){f.editor.on("dblclick",function(c){c=c.target;if(!f.isEmbeddableSpan(c)&&(c=c.parentNode,!c||!f.isEmbeddableSpan(c)))return;var b=f.editor.dom.getAttrib(c,"data-mce-json");
if(b)for(var b=t.parse(b),l=0;l<a.length;l++)a[l].typeid==b.typeid&&a[l].configurable&&f.openDialog(c)})});a=b.settings.evolution_embeddables;b.on("ResolveName",function(c){"span"===c.name&&f.isEmbeddableSpan(c.target)&&(c.name=tinymce.util.I18n.translate("embeddable"))});for(var l=0;l<a.length;l++)(function(c){b.addMenuItem("embed"+c.typeid,{text:tinymce.util.I18n.translate("Insert {0}").replace(/\{0\}/,c.name),context:"insert",image:0<c.previewUrl.length?c.previewUrl:null,prependToContext:!0,onClick:function(a){c.configurable?
f.openDialog(null,c.typeid):(a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var a=16*Math.random()|0;return("x"==c?a:a&3|8).toString(16)}),a={typeid:c.typeid,id:a,configuration:"",elementId:"mceInsertEmbeddable"+h++},f.editor.execCommand("mceRepaint"),a=f.dataToSpan(a),f.editor.selection.setNode(a),f.editor.nodeChanged())}})})(a[l]);b.addMenuItem("editembeddable",{text:"Edit embeddable",onclick:function(c){f.openDialog(b.selection.getNode())},context:"edit",prependToContext:!0,
onPostRender:function(c){c.control.hide();b.on("NodeChange",function(){var l=b.selection.getNode();c.control.hide();if("SPAN"==l.nodeName&&f.isEmbeddableSpan(l)&&(data=f.editor.dom.getAttrib(l,"data-mce-json")))for(data=t.parse(data),l=0;l<a.length;l++)if(a[l].typeid==data.typeid&&a[l].configurable){var h=c.control.getEl();$(".mce-text",h).text(tinymce.util.I18n.translate("Edit {0}").replace(/\{0\}/,a[l].name));0<a[l].previewUrl.length?$(".mce-ico",h).css("background-image","url('"+a[l].previewUrl+
"')"):$(".mce-ico",h).css("background-image","none");c.control.show();break}},!0)}});b.addButton("editembeddable",{text:"Edit",onclick:function(){f.openDialog(b.selection.getNode())}});b.addButton("removeembeddable",{text:"Remove",onclick:function(){b.dom.remove(b.selection.getNode())}});b.addContextToolbar(function(c){return f.isEmbeddableSpan(c)},"editembeddable removeembeddable")});tinymce.PluginManager.add("emoticons",function(b,u){var q=tinymce.html.Node,t=tinymce.util.JSON,f=1,a=this,h={},l=
!1,c=!1,m=/[ \s\t]+/,n=/[ \s\t]/,k,g,d={container:null,selected:null,selectedIndex:-1,current:null},p=null,r=null,A=-1,x=0;a.editor=b;a.url=u;a.openDialog=function(){function d(){$.fn.evolutionTip.hide();m.empty();h.show();a.loadEmoticons(p.val(),function(d,a){d==p.val()&&(a&&(n=null,$.each(a,function(d,a){m.append($('<div class="mceemoticon-emoticon" data-id="'+a.id+'" tabindex="0" role="button">'+a.previewHtml+"</div>").on("keydown",function(d){13==d.keyCode&&$(this).trigger("click")}).on("click",
function(){l(a.id,a.previewHtml)}).on("mouseover",function(){$(this).addClass("mceEmoticonsSelected");var d=this;n!=a.id&&(window.clearTimeout(B),g(),B=window.setTimeout(function(){c(d,a)},333),n=a.id)}).on("mouseout",function(){$(this).removeClass("mceEmoticonsSelected")}))})),h.hide())})}function c(d,k){var p=k.variations;0==p.length&&g();if(!r){r=document.createElement("div");b.dom.setAttrib(r,"class","mceEmoticonsList mceEmoticonVariationsList");b.dom.setAttrib(r,"style","position:absolute; z-index: 200001;");
var m=document.createElement("ul");r.appendChild(m);document.body.appendChild(r)}r.childNodes[0].innerHTML="";r.style.display="block";var m=a.getWindowScrollOffset(window),v=a.getWindowScrollOffset(b.getWin()),h=null,h=b.dom.getPos(d),h={left:h.x,top:h.y,width:d.offsetWidth,height:d.offsetHeight},B=h.left+h.width;r.style.top=h.top-v.y+m.y+"px";r.style.left=B+"px";$.each(p,function(d,c){var a=document.createElement("li");a.style.cursor="pointer";$(a).append('<span class="mceEmoticonsPreview">'+c.previewHtml+
'</span><span class="mceEmoticonsLabel">'+c.name+"</span>");a.onclick=function(){l(c.id,c.previewHtml)};a.onmouseover=function(){a.className="mceEmoticonsSelected"};a.onmouseout=function(){a.className=""};r.childNodes[0].appendChild(a)})}function g(){r&&(r.style.display="none");n=null}function l(d,c){var b={id:"mceEmoticon"+f,emoticonId:d};f++;window.clearTimeout(B);g();a.editor.execCommand("mceRepaint");a.editor.selection.setContent('<span contenteditable="false" class="mceItem mceEmoticon mceNonEditable" id="'+
b.id+'" data-mce-json="'+t.serialize(b,"'")+'">'+c+"</span>");a.editor.nodeChanged();$.fn.evolutionTip.hide();k.close()}var k,p,m,h,r=null,B=null,n=null;k=a.editor.windowManager.open({title:tinymce.util.I18n.translate("Insert emoticon"),body:[{type:"container",html:'<table role="presentation" border="0" cellpadding="4" cellspacing="0" class="mcetelligent-form"><tr><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td>\t\t\t<select id="mceemoticon-collection" name="mceemoticon-collection" class="mce-textbox mcemedia-type" style="width: 390px;">\t\t\t</select>\t\t</td>\t</tr>\t</table></td></tr></table><div class="mceemoticon-listwrapper"><div class="mceemoticon-loading">'+
tinymce.util.I18n.translate("Loading...")+'</div><div class="mceemoticon-list"></div></div>'}],buttons:[{text:"Cancel",onclick:function(){k.close()}}],width:410,height:390});(function(){var c=$(k.getEl());c.on("click",function(){g()});p=$("#mceemoticon-collection",c).glowDropDownList({selectedItemWidth:390,selectedItemHeight:28,itemsWidth:390,itemsHeight:250,itemsHtml:[],showHtmlWhenSelected:!0,className:"mceemoticon-collection"}).on("change",function(){d()});$(".mceemoticon-collection",c).attr("role",
"button");m=$(".mceemoticon-list",c);h=$(".mceemoticon-loading",c).hide();a.loadEmoticonCollections(function(c){c&&(p.empty(),$.each(c,function(d,c){p.glowDropDownList("add",p.glowDropDownList("createItem",{value:c.id,text:c.name,html:'<div class="mceemoticon-collectionitem"><div class="mceemoticon-collectionpreview">'+c.previewHtml+'</div><div class="mceemoticon-collectionlabel">'+c.name+"</div>"}))}),p.glowDropDownList("refresh"),d())})})();k.on("close",function(){g()})};a.handleKeyDown=function(d,
g){if(l){if(40==g.keyCode)return 1==x?this.highlightNextVariation():this.highlightNextEmoticon(),this.cancelEvent(g);if(38==g.keyCode)return 1==x?this.highlightPreviousVariation():this.highlightPreviousEmoticon(),this.cancelEvent(g);if(13==g.keyCode)return this.selectEmoticon(d,this.getCurrentWord(d)),c=!1,this.cancelEvent(g);if(27==g.keyCode)return c=!1,this.hideEmoticons(),this.cancelEvent(g);if(37==g.keyCode&&1==x)return a.setVariationMode(0),this.cancelEvent(g);if(39==g.keyCode&&0==x)return a.setVariationMode(1),
this.cancelEvent(g)}};a.cancelEvent=function(d){d.preventDefault();d.stopImmediatePropagation();d.stopPropagation();return!1};a.getLastTypedCharacter=function(d,c){var a=d.getDoc(),g=d.selection.getSel();if(g.focusNode&&g.focusOffset){if(a=g.focusNode.nodeValue,0<=g.focusOffset-1&&a&&a.length>=g.focusOffset)return a.charAt(g.focusOffset-1)}else if(a.selection&&a.selection.createRange){g=a.selection.createRange();if(!(g.parentElement&&g.moveToPoint&&g.moveStart&&g.getBoundingClientRect))return"";if(null!=
g.parentElement())try{g.parentElement().focus()}catch(b){}g=a.selection.createRange();a=g.getBoundingClientRect();0==a.left&&0==a.top&&(g.moveToElementText(g.parentElement()),a=g.getBoundingClientRect(),a.left=a.right);a.left+=0==g.boundingLeft?a.right-a.left:0;a.top=(a.bottom+a.top)/2;g.moveToPoint(a.left,a.top);g.moveStart("character",-1);return g.text}return""};a.handleKeyUp=function(d,a){var b=this.getLastTypedCharacter(d,a);(l||c||":"==b)&&(40!=a.keyCode&&38!=a.keyCode&&13!=a.keyCode&&27!=a.keyCode&&
37!=a.keyCode&&39!=a.keyCode)&&(b=this.getCurrentWord(d),c||(k=!0,g=""),100<b.length||""==b||m.test(b.substr(1))?(c=!1,this.hideEmoticons()):(c=!0,0<b.length&&(k||b.length-1<=g.length||b.substr(1,g.length)!=g)?(l=!0,this.showEmoticons(d,b)):this.hideEmoticons()))};a.setVariationMode=function(d){0==d&&0!=x?(r&&(r.className="",A=-1,r=null),x=0):1==d&&1!=x&&(x=1,a.setHighlightedVariation(0))};a.highlightNextVariation=function(){p&&(r&&p.childNodes[0].childNodes.length>A+1)&&(r.className="",A++,r=p.childNodes[0].childNodes[A],
r.className="mceEmoticonsSelected")};a.highlightPreviousVariation=function(){p&&(r&&0<p.childNodes[0].childNodes.length&&0<A)&&(r.className="",A--,r=p.childNodes[0].childNodes[A],r.className="mceEmoticonsSelected")};a.setHighlightedVariation=function(d){p&&(p.childNodes[0].childNodes.length>d&&0<=d)&&(r&&(r.className=""),A=d,r=p.childNodes[0].childNodes[A],r.className="mceEmoticonsSelected",a.setVariationMode(1))};a.showVariations=function(){null!=d.current&&d.current[d.selectedIndex]&&d.current[d.selectedIndex].variations&&
0!=d.current[d.selectedIndex].variations.length||a.hideVariations();var c=d.current[d.selectedIndex].variations;if(!p){p=document.createElement("div");b.dom.setAttrib(p,"class","mceEmoticonsList mceEmoticonVariationsList");b.dom.setAttrib(p,"style","position:absolute; z-index: 200001;");var g=document.createElement("ul");p.appendChild(g);document.body.appendChild(p)}r=null;p.childNodes[0].innerHTML="";p.style.display="block";var g=this.getWindowScrollOffset(window),l=this.getWindowScrollOffset(b.getWin()),
k=null,k=d.container.childNodes[0].childNodes[d.selectedIndex],m=b.dom.getPos(k),k={left:m.x,top:m.y,width:k.offsetWidth,height:k.offsetHeight},m=k.top+g.y-2*l.y,h=k.left+k.width;k.top+g.y>$(window).height()/2?(p.style.bottom=$("body").outerHeight()-(m+l.y)-k.height+"px",p.style.left=h+"px",p.style.top="auto"):(p.style.top=m+l.y+"px",p.style.left=h+"px",p.style.bottom="auto");r=null;p.childNodes[0].innerHTML="";for(var n=b.selection.getBookmark(2),l=0;l<c.length;l++)g=document.createElement("li"),
g.style.cursor="pointer",$(g).html('<span class="mceEmoticonsPreview">'+c[l].previewHtml+'</span><span class="mceEmoticonsLabel">'+c[l].name+"</span>"),g.onclick=function(){b.selection.moveToBookmark(n);a.selectEmoticon(b,a.getCurrentWord(b))},g.onmouseover=function(){a.setHighlightedVariation(parseInt(b.dom.getAttrib(this,"data-index")))},b.dom.setAttrib(g,"data-index",l),b.dom.setAttrib(g,"data-id",c[l].id),b.dom.setAttrib(g,"data-preview",c[l].previewHtml),p.childNodes[0].appendChild(g)};a.highlightNextEmoticon=
function(){d.container&&(d.selected&&d.container.childNodes[0].childNodes.length>d.selectedIndex+1)&&(d.selected.className="",d.selectedIndex++,d.selected=d.container.childNodes[0].childNodes[d.selectedIndex],d.selected.className="mceEmoticonsSelected",a.showVariations())};a.highlightPreviousEmoticon=function(){d.container&&(d.selected&&0<d.container.childNodes[0].childNodes.length&&0<d.selectedIndex)&&(d.selected.className="",d.selectedIndex--,d.selected=d.container.childNodes[0].childNodes[d.selectedIndex],
d.selected.className="mceEmoticonsSelected",a.showVariations())};a.setHighlightedEmoticon=function(c){d.container&&(d.selected&&d.container.childNodes[0].childNodes.length>c&&0<=c)&&(d.selected.className="",d.selectedIndex=c,d.selected=d.container.childNodes[0].childNodes[d.selectedIndex],d.selected.className="mceEmoticonsSelected",a.setVariationMode(0),a.showVariations())};a.showEmoticons=function(a,c){var b=this;if(!d.container){d.container=document.createElement("div");a.dom.setAttrib(d.container,
"class","mceEmoticonsList");a.dom.setAttrib(d.container,"style","position:absolute; z-index: 200001;");var l=document.createElement("ul");d.container.appendChild(l);document.body.appendChild(d.container)}d.selected=null;d.container.childNodes[0].innerHTML="";var m=document.createElement("li");m.innerHTML=tinymce.util.I18n.translate("Loading...");d.container.childNodes[0].appendChild(m);d.container.style.display="block";var l=this.getWindowScrollOffset(window),p=a.dom.getPos(a.getContentAreaContainer()),
h=this.getWindowScrollOffset(a.getWin()),r=a.dom.getPos(a.selection.getNode()),n=0,B=0,B=a.selection.getRng();B.expand&&B.expand("word");var f=null;0==B.getClientRects().length?B.parentElement&&B.getBoundingClientRect&&B.moveToPoint&&B.moveStart?(B.moveToElementText(B.parentElement()),f=B.getBoundingClientRect(),f.left=f.right,f.left+=0==B.boundingLeft?f.right-f.left:0,B.moveToPoint(f.left,f.top),B.moveStart("character",-1),f=B.getClientRects()[0]):B.insertNode&&(n=a.getWin().document.createElement("span"),
B.insertNode(n),f=a.dom.getPos(n),f={left:f.x,top:f.y,width:0,height:n.offsetHeight},n.parentNode.removeChild(n)):f=B.getClientRects()[0];f&&(!f.width&&!f.height&&f.right&&f.bottom)&&(f={width:f.right-f.left,height:f.bottom-f.top,left:f.left-p.x,top:f.top-p.y});f?(n=f.top+f.height,B=f.left):(n=1.3*parseInt(a.dom.getStyle(a.selection.getNode(),"font-size",!0))+r.y,B=r.x);n+p.y>$(window).height()/2?(d.container.style.bottom=$("body").outerHeight()-(p.y+l.y+n-h.y)+f.height+"px",d.container.style.left=
p.x+l.x+B-h.x+"px",d.container.style.top="auto"):(d.container.style.top=p.y+l.y+n-h.y+"px",d.container.style.left=p.x+l.x+B-h.x+"px",d.container.style.bottom="auto");d.lastSearchText=c;window.clearTimeout(d.searchHandle);var t=a.selection.getBookmark(2);d.searchHandle=window.setTimeout(function(){b.searchForEmoticons(c,function(c,l){if(d.lastSearchText==c)if(b.hideVariations(),d.selected=null,d.container.childNodes[0].innerHTML="",d.current=l||[],l&&0!=l.length){k=!0;g=c;for(var p=0;p<l.length;p++)m=
document.createElement("li"),m.style.cursor="pointer",$(m).html('<span class="mceEmoticonsPreview">'+l[p].previewHtml+'</span><span class="mceEmoticonsLabel">'+l[p].name+"</span>"),m.onclick=function(){a.selection.moveToBookmark(t);b.selectEmoticon(a,b.getCurrentWord(a))},m.onmouseover=function(){b.setHighlightedEmoticon(parseInt(a.dom.getAttrib(this,"data-index")))},a.dom.setAttrib(m,"data-index",p),a.dom.setAttrib(m,"data-id",l[p].id),a.dom.setAttrib(m,"data-preview",l[p].previewHtml),d.container.childNodes[0].appendChild(m),
d.selected||(d.selectedIndex=p,d.selected=m,d.selected.className="mceEmoticonsSelected");b.showVariations()}else k&&(g=c.substr(0,c.length-1),k=!1),b.hideEmoticons()})},249)};a.hideEmoticons=function(c){d.container&&(d.container.style.display="none",d.selected=null,d.selectedIndex=-1);a.hideVariations();l=!1};a.hideVariations=function(d){p&&(p.style.display="none",r=null,A=-1);x=0};a.getCurrentWord=function(d){var a=d.getDoc();d=d.selection.getSel();if(d.focusNode&&d.focusOffset){var a=d.focusNode.nodeValue,
c=d.focusOffset-1;if(null==a||0==a.length)return"";d=0;for(var g=c;0<=g;g--)if(":"==a.charAt(g)){d=g;break}g=a.substr(d,c+1-d);if(0<g.length&&":"==g.charAt(0).toString()&&(0==d||n.test(a.substr(d-1,1))))return g}else if(a.selection&&a.selection.createRange){d=a.selection.createRange();if(!(d.parentElement&&d.moveToPoint&&d.moveStart&&d.getBoundingClientRect))return"";if(null!=d.parentElement())try{d.parentElement().focus()}catch(b){}d=a.selection.createRange();a=d.getBoundingClientRect();0==a.left&&
0==a.top&&(d.moveToElementText(d.parentElement()),a=d.getBoundingClientRect(),a.left=a.right);a.left+=0==d.boundingLeft?a.right-a.left:0;a.top=(a.bottom+a.top)/2;d.moveToPoint(a.left,a.top);d.moveStart("word",-1);d.moveStart("character",-1);a=d.text;d=0;for(g=a.length-1;0<=g;g--)if(":"==a.charAt(g)){d=g;break}g=a.substr(d,a.length-d);if(0<g.length&&":"==g.charAt(0).toString()&&(0==d||n.test(a.substr(d-1,1))))return g}return""};a.selectEmoticon=function(a,g){var c;c=1==x?r:d.selected;if(!(0>=g.length)&&
c){var b=a.selection.getRng();if(b.setStart)b.setStart(b.startContainer,b.startOffset-g.length);else if(b.parentElement&&b.getBoundingClientRect&&b.moveToPoint&&b.moveStart){var l=b.getBoundingClientRect();0==l.left&&0==l.top&&(b.moveToElementText(b.parentElement()),l=b.getBoundingClientRect(),l.left=l.right,l.left+=0==b.boundingLeft?l.right-l.left:0,b.moveToPoint(l.left,l.top));b.moveStart("character",-1*g.length)}l={id:"mceEmoticon"+f,emoticonId:a.dom.getAttrib(c,"data-id")};f++;a.selection.setRng(b);
a.selection.setContent('<span contenteditable="false" class="mceItem mceEmoticon mceNonEditable" id="'+l.id+'" data-mce-json="'+t.serialize(l,"'")+'">'+a.dom.getAttrib(c,"data-preview")+"</span>");a.nodeChanged();this.hideEmoticons()}};a.getWindowScrollOffset=function(d){var a=0,g=0;"number"==typeof d.pageXOffset?(a=d.pageXOffset,g=d.pageYOffset):d.document.body&&(d.document.body.scrollLeft||d.document.body.scrollTop)?(a=d.document.body.scrollLeft,g=d.document.body.scrollTop):d.document.documentElement&&
(d.document.documentElement.scrollLeft||d.document.documentElement.scrollTop)&&(a=document.documentElement.scrollLeft,g=document.documentElement.scrollTop);return{x:a,y:g}};a.getCodePoint=function(d,a){if(null===d)throw TypeError();var g=String(d),c=g.length,b=a?Number(a):0;b!=b&&(b=0);if(!(0>b||b>=c)){var l=g.charCodeAt(b);return 55296<=l&&(56319>=l&&c>b+1)&&(g=g.charCodeAt(b+1),56320<=g&&57343>=g)?{code:1024*(l-55296)+g-56320+65536,isSurrogate:!0}:{code:l,isSurrogate:!1}}};a.spanToObject=function(d,
a){var g,c;if(g=d.attr("data-mce-json"))g=t.parse(g),g.emoticonId&&(c=new q("#text",3),c.raw=!0,c.value="[emoticon:"+g.emoticonId+"]");c?d.replace(c):d.remove()};a.resolveWhitespace=function(d){if(!d)return d;" "==d.substr(0,1)&&(d="&nbsp;"+d.substr(1));" "==d.substr(d.length-1)&&(d=d.substr(0,d.length-1)+"&nbsp;");return d};a.isStart=function(d){return h.unicode&&void 0!==h.unicode[d.toString(16)]};a.requiresMore=function(d){for(var a=h.unicode[d[0].toString(16)],g,c=1;c<d.length;c++){if(void 0===
a)return!1;g=a[d[c].toString(16)];if(void 0!==g)a=g;else if(8205!=d[c])return!1}return void 0!==a&&void 0===a.id};a.couldHaveMore=function(d){for(var a=h.unicode[d[0].toString(16)],g,c=1;c<d.length;c++){if(void 0===a)return!1;g=a[d[c].toString(16)];if(void 0!==g)a=g;else if(8205!=d[c])return!1}return void 0===a?!1:void 0!==a.id?1<Object.keys(a).length:0<Object.keys(a).length};a.isValidCombination=function(d){for(var a=h.unicode[d[0].toString(16)],g,c=1;c<d.length;c++){if(void 0===a)return!1;g=a[d[c].toString(16)];
if(void 0!==g)a=g;else if(8205!=d[c])return!1}return void 0!==a&&void 0!==a.id};a.getId=function(d){for(var a=h.unicode[d[0].toString(16)],g,c=1;c<d.length;c++){if(void 0===a)return null;g=a[d[c].toString(16)];if(void 0!==g)a=g;else if(8205!=d[c])return null}return void 0===a||void 0===a.id?null:a.id};a.parseEmojiInLine=function(){function d(a,g){0>g&&(g=0);if(3==a.nodeType){var c=a.data.length;g>c&&(g=c)}return g}function g(a,c){1!=a.nodeType||a.hasChildNodes()?b.setStart(a,d(a,c)):b.setStartBefore(a)}
function c(a,g){1!=a.nodeType||a.hasChildNodes()?b.setEnd(a,d(a,g)):b.setEndAfter(a)}for(var b,l,k,p,m,h,B,r=!0,n=!1,A;r;)(function(){r=!1;b=a.editor.selection.getRng(!0).cloneRange();if(1>b.startOffset){h=b.endContainer.previousSibling;if(!h){if(!b.endContainer.firstChild||!b.endContainer.firstChild.nextSibling)return;h=b.endContainer.firstChild.nextSibling}B=h.length;g(h,B);c(h,B);if(1>b.endOffset)return;l=b.endOffset;k=h}else{k=b.endContainer;if(3!=k.nodeType&&k.firstChild){for(;3!=k.nodeType&&
k.firstChild;)k=k.firstChild;3==k.nodeType&&(g(k,0),c(k,k.nodeValue.length))}l=1==b.endOffset?2:b.endOffset}g(k,Math.max(0,l-200));c(k,l);m=b.toString();for(var d=0;d<m.length&&!r;d++){var v=a.getCodePoint(m,d),x=!0,y;if(a.isStart(v.code)){A=v.isSurrogate?2:1;f++;var q=[];q.push(v.code);if(a.requiresMore(q))for(;x&&a.requiresMore(q);)(y=a.getCodePoint(m,d+(v.isSurrogate?2:1)))?(q.push(y.code),a.isValidCombination(q)||a.requiresMore(q)?(d+=v.isSurrogate?2:1,v=y,A+=y.isSurrogate?2:1):(q.pop(),x=!1)):
x=!1;if(x&&a.couldHaveMore(q))for(;x&&a.couldHaveMore(q);)(y=a.getCodePoint(m,d+(v.isSurrogate?2:1)))?(q.push(y.code),a.isValidCombination(q)||a.couldHaveMore(q)?(d+=v.isSurrogate?2:1,v=y,A+=y.isSurrogate?2:1):(q.pop(),x=!1)):x=!1;if(a.isValidCombination(q)){p=a.editor.selection.getBookmark();g(k,d+(v.isSurrogate?2:1)-A);c(k,d+(v.isSurrogate?2:1));var u={id:"mceEmoticon"+f,emoticonId:a.getId(q)},x=tinymce.activeEditor.dom.create("span",{id:u.id,"class":"mceItem mceEmoticon mceNonEditable","data-mce-json":t.serialize(u,
"'"),contenteditable:"false"});x.appendChild(document.createTextNode(tinymce.util.I18n.translate("???")));a.editor.selection.setRng(b);a.editor.selection.setNode(x);a.getPreview(u,function(d){var g=a.editor.dom.get(u.id);g&&(g.innerHTML=d)});n=r=!0;a.editor.selection.moveToBookmark(p)}}v.isSurrogate&&d++}})();n&&(a.editor.selection.moveToBookmark(p),a.editor.nodeChanged())};a.replaceEmojiInText=function(d){for(var g,c=0;c<d.length;c++){var b=a.getCodePoint(d,c);g=a.isStart(b.code);var l=!0,k,p=c;
if(g){g=b.isSurrogate?2:1;f++;var m=[];m.push(b.code);if(a.requiresMore(m))for(;l&&a.requiresMore(m);)(k=a.getCodePoint(d,c+(b.isSurrogate?2:1)))?(m.push(k.code),a.isValidCombination(m)||a.requiresMore(m)?(c+=b.isSurrogate?2:1,b=k,g+=k.isSurrogate?2:1):(m.pop(),l=!1)):l=!1;if(l&&a.couldHaveMore(m))for(;l&&a.couldHaveMore(m);)(k=a.getCodePoint(d,c+(b.isSurrogate?2:1)))?(m.push(k.code),a.isValidCombination(m)||a.couldHaveMore(m)?(c+=b.isSurrogate?2:1,b=k,g+=k.isSurrogate?2:1):(m.pop(),l=!1)):l=!1;a.isValidCombination(m)&&
(l="[emoticon:"+a.getId(m)+"]",d=d.substr(0,p)+l+d.substr(p+g),c+=g-(b.isSurrogate?2:1))}b.isSurrogate&&c++}return d};a.textToSpan=function(d){var a=this,g=a.editor;if(d.parent){for(var c=new q("div"),b=/\[emoticon:([^\]]+)\]/g,l,k=0;l=b.exec(d.value);)(function(){var b={id:"mceEmoticon"+f,emoticonId:RegExp.$1};if(0<l.index)for(var m=g.parser.parse(a.resolveWhitespace(d.value.substr(k,l.index-k))).getAll("p"),p=0;p<m.length;p++)for(var h;null!=(h=m[p].walk());)c.append(h);m=new q("span",1);c.append(m);
m.attr({id:b.id,"class":"mceItem mceEmoticon mceNonEditable","data-mce-json":t.serialize(b,"'"),contenteditable:"false"});p=new q("#text",3);p.raw=!0;p.value=tinymce.util.I18n.translate("???");m.append(p);a.getPreview(b,function(d){var a=g.dom.get(b.id);a&&(a.innerHTML=d)})})(),k=b.lastIndex,f++;if(0<k){if(k<d.value.length)for(var b=g.parser.parse(a.resolveWhitespace(d.value.substr(k))).getAll("p"),m=0;m<b.length;m++)for(var p;null!=(p=b[m].walk());)c.append(p);d.replace(c);c.unwrap()}}};a.getPreview=
function(d,g){tinymce.util.XHR.send({url:a.getCallbackUrl({t:"p",emoticonId:d.emoticonId}),success:function(d){d=tinymce.util.JSON.parse(d);try{d&&d.html?g(d.html):g("")}catch(a){}},error:function(d){try{g("")}catch(a){}}})};a.searchForEmoticons=function(d,a){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"searchemoticons",query:d}),success:function(g){g=tinymce.util.JSON.parse(g);try{g&&g.emoticons?a(d,g.emoticons):a(d,null)}catch(c){}},error:function(g){try{a(d,null)}catch(c){}}})};a.loadEmoticonCollections=
function(d){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"listcollections"}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.collections?d(a.collections):d(null)}catch(g){}},error:function(a){try{d(null)}catch(g){}}})};a.loadEmoticons=function(d,a){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"listemoticons",collectionId:d}),success:function(g){g=tinymce.util.JSON.parse(g);try{g&&g.emoticons?a(d,g.emoticons):a(d,null)}catch(c){}},error:function(g){try{a(d,null)}catch(c){}}})};
a.loadEmoji=function(){tinymce.util.XHR.send({url:a.url+"../../../apis/emoticons?t=emojijson",success:function(d){d=tinymce.util.JSON.parse(d);try{d&&(h=d)}catch(a){}},error:function(d){}})};a.getCallbackUrl=function(d){for(var a=this.url+"../../../apis/emoticons?",g={},c=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),b=0;b<c.length;b++){var l=c[b].split(/=/);2==l.length&&(g[l[0]]=l[1])}for(var k in d)g[encodeURIComponent(k)]=encodeURIComponent(d[k]);d=!0;for(k in g)d?d=!1:a+="&",
a+=k+"="+g[k];return a};var y=!0===b.getParam("evolution_emoticons");b.on("PreInit",function(){b.parser.addNodeFilter("#text",function(d){for(var g=d.length;g--;)a.textToSpan(d[g])});b.serializer.addNodeFilter("span",function(d,g,c){g=d.length;for(var b;g--;)b=d[g],-1!==(b.attr("class")||"").indexOf("mceEmoticon")&&a.spanToObject(b,c)});b.on("keyup",function(d){a.parseEmojiInLine();if(y)return a.handleKeyUp(b,d)},!0);y&&(b.on("keydown",function(d){return a.handleKeyDown(b,d)},!0),b.on("click",function(){a.hideEmoticons()}))});
y&&(b.addCommand("mceInsertEmoticon",function(){a.openDialog()}),b.addMenuItem("emoticon",{text:"Insert emoticon",icon:"emoticons",cmd:"mceInsertEmoticon",context:"insert",prependToContext:!0}));b.on("ResolveName",function(d){"span"===d.name&&b.dom.hasClass(d.target,"mceEmoticon")&&(d.name=tinymce.util.I18n.translate("emoticon"))});b.on("PastePreProcess",function(d){d.content=a.replaceEmojiInText(d.content)});b.on("BeforeSetContent",function(d){d.content=a.replaceEmojiInText(d.content)});b.addButton("emoticonremove",
{text:"Remove",onclick:function(){b.dom.remove(b.selection.getNode())}});b.addContextToolbar(function(d){return b.dom.is(d,"span.mceEmoticon")&&b.getBody().contains(d)},"emoticonremove");a.loadEmoji()});(function(){function b(u,q,t){return u?u.is("body")?u.css(q)==t:u.css(q)==t?b(u.parent(),q,t):!1:!1}tinyMCE.$.cssHooks.fontFamily={get:function(u){if(u&&("#"==u.nodeName.substr(0,1)||"BODY"==u.nodeName))return"inherit";u=$(u);var q=u.css("font-family");return b(u.parent(),"font-family",q)?"inherit":
q}};tinyMCE.$.cssHooks.fontSize={get:function(u){if(u&&("#"==u.nodeName.substr(0,1)||"BODY"==u.nodeName))return"inherit";u=$(u);var q=u.css("font-size");return b(u.parent(),"font-size",q)?"inherit":q}}})();tinymce.PluginManager.add("enhancements",function(b,u){function q(d,a){for(var g=0;g<a.length;g++)if(d.nodeName==a[g])return!0;return d.parentNode?q(d.parentNode,a):!1}function t(){c.enhancements_initialheight=$(b.getContainer()).height();b.save();b.remove()}function f(){if(tinymce.EditorManager.get(a))return!1;
var d=new tinymce.Editor(a,c,tinymce);d.render();$(d.getContainer()).css({display:""});return!0}var a=b.id,h,l,c=b.settings,m=null;window.mceReflow=window.mceReflow||{};h=$.telligent.evolution.messaging.subscribe("reflow.reflowstart",function(d){var g=tinymce.EditorManager.get(a);g&&(d.target&&d.target.has&&0<d.target.has(g.getContainer()).length)&&($.telligent.evolution.messaging.unsubscribe(h),window.mceReflow[a]=!0,t())});l=$.telligent.evolution.messaging.subscribe("reflow.reflowend",function(d){var g=
$("#"+a);0<g.length&&(d.target&&d.target.has&&0<d.target.has(g[0]).length)&&window.mceReflow[a]&&(f()&&$.telligent.evolution.messaging.unsubscribe(l),window.mceReflow[a]=!1)});b.on("remove",function(d){window.mceReflow[a]||$.telligent.evolution.messaging.unsubscribe(l);$.telligent.evolution.messaging.unsubscribe(h)});b.on("contextmenu",function(d){(""==$.trim(b.selection.getContent({format:"text"}))||d.shiftKey)&&q(d.target,["TABLE","TBODY","TR","TH","TD"])||d.stopImmediatePropagation()},!0);b.on("PreInit",
function(){function d(d){var a=b.theme.panel.find(d)[0];if(null!=a)return window.setTimeout(function(){try{var d=a.keyboardNav||a.parents().eq(-1)[0].keyboardNav;d&&d.focusFirst(a)}catch(g){}},10),!0}var a=$(b.getContainer());b.settings.enhancements_wrappercss&&a.addClass(b.settings.enhancements_wrappercss);a.addClass("mce-editor-blur").removeClass("mce-editor-focus");a.css({height:(c.enhancements_initialheight||b.settings.height||300)+"px",overflow:"hidden"});b.shortcuts.add("Shift+Alt+M","",function(){d("menubar")||
d("toolbar")});b.shortcuts.add("Shift+Alt+T","",function(){d("toolbar")});b.shortcuts.add("Shift+Alt+C","",function(){b.notificationManager.close()})});b.on("Init",function(){window.setTimeout(function(){$(b.getContainer()).css({height:"auto",overflow:"visible"})},10)});b.on("focus",function(){var d=$(b.getContainer());d.hasClass("mce-editor-blue")&&d.removeClass("mce-editor-blur").addClass("mce-editor-focus")});b.on("blur",function(){var d=$(b.getContainer());d.hasClass("mce-editor-blur")&&d.addClass("mce-editor-blur").removeClass("mce-editor-focus")});
0<=b.settings.plugins.indexOf("autoresize")&&(b.settings.autoresize_max_height=0.67*$(window).height(),$(window).on("resized",function(){b.settings.autoresize_max_height=0.67*$(window).height()}));if(b.settings.enhancements_placeholder){var n=$('<div class="mce-placeholder"></div>').html(b.settings.enhancements_placeholder).on("click",function(){b.execCommand("mceFocus",!1)}),k=!0,g=function(){var d=b.getContent();return d&&0<d.length&&!/^(<p>\s*?<\/p>|\s*|<div>\s*?<\/div>)*$/i.test(d)?!0:!1};b.on("init",
function(){$(b.getContentAreaContainer()).css("position","relative").append(n);g()?n.hide():n.show()});b.on("focus",function(){k&&(n.hide(),k=!1)});b.on("blur",function(){g()?n.hide():n.show();k=!0});b.on("change setContent",function(){k&&(g()?n.hide():n.show())})}b.addMenuItem("removelink",{text:"Remove link",cmd:"unlink",context:"edit",prependToContext:!0,onPostRender:function(d){d.control.hide();b.on("NodeChange",function(){"A"==b.selection.getNode().nodeName?d.control.show():d.control.hide()},
!0)}});b.addMenuItem("editlink",{text:"Edit link",icon:"link",cmd:"mceLink",context:"edit",prependToContext:!0,onPostRender:function(d){d.control.hide();b.on("NodeChange",function(){"A"==b.selection.getNode().nodeName?d.control.show():d.control.hide()},!0)}});b.addMenuItem("insertlink",{text:"Insert link",icon:"link",cmd:"mceLink",context:"insert",prependToContext:!0,onPostRender:function(d){d.control.hide();b.on("NodeChange",function(){"A"==b.selection.getNode().nodeName?d.control.hide():d.control.show()},
!0)}});b.addMenuItem("indent",{text:"Indent",icon:"indent",cmd:"indent",context:"format"});b.addMenuItem("outdent",{text:"Outdent",icon:"outdent",cmd:"outdent",context:"format"});b.on("dblclick",function(d){"A"==b.selection.getNode().nodeName&&b.execCommand("mceLink")});return{moveTo:function(d){$("#"+a).parent()[0]!=$(d)[0]&&(t(),$("#"+a).appendTo(d),f())},focusAndView:function(){var d=function(){var a=$(b.getContainer()),g=a.offset();if(a=a.height()){var c=$(window),l=c.scrollTop(),c=c.height(),
k=Math.max(0,c-$("body").height());l+c<g.top+a?$("body, html").animate({scrollTop:(a>c-k?g.top-k:g.top-(c-a-5))+"px"},200,"swing",function(){b.focus()}):l+k>g.top?$("body, html").animate({scrollTop:g.top-k+"px"},200,"swing",function(){b.focus()}):b.focus()}else window.clearTimeout(m),m=window.setTimeout(function(){d()},50)};d()}}});tinymce.PluginManager.add("hashtags",function(b,u){var q=tinymce.html.Node,t=tinymce.util.JSON,f=!1,a=!1,h=/[-_~`!@#$%^&*()=+{[}\]\\|;:'",<.> \s\t]+/i,l,c,m={container:null,
selected:null,selectedIndex:-1},n=1,k=this;k.editor=b;k.url=u;k.handleKeyDown=function(g,d){if(!this.disabledState&&f){if(40==d.keyCode)return this.highlightNextHashtag(),this.cancelEvent(d);if(38==d.keyCode)return this.highlightPreviousHashtag(),this.cancelEvent(d);if(13==d.keyCode)return this.selectHashtag(g,this.getCurrentWord(g)),a=!1,this.cancelEvent(d);if(27==d.keyCode)return a=!1,this.hideHashtags(),this.cancelEvent(d)}};k.cancelEvent=function(a){a.preventDefault();a.stopImmediatePropagation();
a.stopPropagation();return!1};k.getLastTypedCharacter=function(a,d){var c=a.getDoc(),b=a.selection.getSel();if(b.focusNode&&b.focusOffset){if(c=b.focusNode.nodeValue,0<=b.focusOffset-1&&c&&c.length>=b.focusOffset)return c.charAt(b.focusOffset-1)}else if(c.selection&&c.selection.createRange){b=c.selection.createRange();if(!(b.parentElement&&b.moveToPoint&&b.moveStart&&b.getBoundingClientRect))return"";if(null!=b.parentElement())try{b.parentElement().focus()}catch(l){}b=c.selection.createRange();c=
b.getBoundingClientRect();0==c.left&&0==c.top&&(b.moveToElementText(b.parentElement()),c=b.getBoundingClientRect(),c.left=c.right);c.left+=0==b.boundingLeft?c.right-c.left:0;c.top=(c.bottom+c.top)/2;b.moveToPoint(c.left,c.top);b.moveStart("character",-1);return b.text}return""};k.handleKeyUp=function(g,d){if(!this.disabledState){var b=this.getLastTypedCharacter(g,d);(f||a||"#"==b)&&(40!=d.keyCode&&38!=d.keyCode&&13!=d.keyCode&&27!=d.keyCode)&&(b=this.getCurrentWord(g),a||(l=!0,c=""),256<b.length||
""==b||h.test(b.substr(1))?(a=!1,this.hideHashtags()):(a=!0,2<b.length&&(l||b.length-1<=c.length||b.substr(1,c.length)!=c)?(f=!0,this.showHashtags(g,b.substr(1))):this.hideHashtags()))}};k.highlightNextHashtag=function(){m.container&&(m.selected&&m.container.childNodes[0].childNodes.length>m.selectedIndex+1)&&(m.selected.className="",m.selectedIndex++,m.selected=m.container.childNodes[0].childNodes[m.selectedIndex],m.selected.className="mceHashtagsSelected")};k.highlightPreviousHashtag=function(){m.container&&
(m.selected&&0<m.container.childNodes[0].childNodes.length&&0<m.selectedIndex)&&(m.selected.className="",m.selectedIndex--,m.selected=m.container.childNodes[0].childNodes[m.selectedIndex],m.selected.className="mceHashtagsSelected")};k.setHighlightdHashtag=function(a){m.container&&(m.selected&&m.container.childNodes[0].childNodes.length>a&&0<=a)&&(m.selected.className="",m.selectedIndex=a,m.selected=m.container.childNodes[0].childNodes[m.selectedIndex],m.selected.className="mceHashtagsSelected")};
k.showHashtags=function(a,d){var b=this;if(!m.container){m.container=document.createElement("div");a.dom.setAttrib(m.container,"class","mceHashtagsList");a.dom.setAttrib(m.container,"style","position:absolute; z-index: 200001;");var k=document.createElement("ul");m.container.appendChild(k);document.body.appendChild(m.container)}m.selected=null;m.container.childNodes[0].innerHTML="";var h=document.createElement("li");h.innerHTML=tinymce.util.I18n.translate("Loading...");m.container.childNodes[0].appendChild(h);
m.container.style.display="block";var k=this.getWindowScrollOffset(window),n=a.dom.getPos(a.getContentAreaContainer()),f=this.getWindowScrollOffset(a.getWin()),t=a.dom.getPos(a.selection.getNode()),q=0,w=0,w=a.selection.getRng();w.expand&&w.expand("word");var s=null;0==w.getClientRects().length?w.parentElement&&w.getBoundingClientRect&&w.moveToPoint&&w.moveStart?(w.moveToElementText(w.parentElement()),s=w.getBoundingClientRect(),s.left=s.right,s.left+=0==w.boundingLeft?s.right-s.left:0,w.moveToPoint(s.left,
s.top),w.moveStart("character",-1),s=w.getClientRects()[0]):w.insertNode&&(q=a.getWin().document.createElement("span"),w.insertNode(q),s=a.dom.getPos(q),s={left:s.x,top:s.y,width:0,height:q.offsetHeight},q.parentNode.removeChild(q)):s=w.getClientRects()[0];s&&(!s.width&&!s.height&&s.right&&s.bottom)&&(s={width:s.right-s.left,height:s.bottom-s.top,left:s.left-n.x,top:s.top-n.y});s?(q=s.top+s.height,w=s.left):(q=1.3*parseInt(a.dom.getStyle(a.selection.getNode(),"font-size",!0))+t.y,w=t.x);q+n.y>$(window).height()/
2?(m.container.style.bottom=$("body").outerHeight()-(n.y+k.y+q-f.y)+s.height+"px",m.container.style.left=n.x+k.x+w-f.x+"px",m.container.style.top="auto"):(m.container.style.top=n.y+k.y+q-f.y+"px",m.container.style.left=n.x+k.x+w-f.x+"px",m.container.style.bottom="auto");m.lastSearchText=d;window.clearTimeout(m.searchHandle);var F=a.selection.getBookmark(2);m.searchHandle=window.setTimeout(function(){b.searchForHashtags(d,function(d,k){if(m.lastSearchText==d)if(m.selected=null,m.container.childNodes[0].innerHTML=
"",k&&0!=k.length){l=!0;c=d;for(var n=0;n<k.length;n++)h=document.createElement("li"),h.style.cursor="pointer",h.innerHTML=k[n].previewhtml,h.onclick=function(){a.selection.moveToBookmark(F);b.selectHashtag(a,b.getCurrentWord(a))},h.onmouseover=function(){b.setHighlightdHashtag(parseInt(a.dom.getAttrib(this,"data-index")))},a.dom.setAttrib(h,"data-index",n),a.dom.setAttrib(h,"data-tagname",k[n].name),m.container.childNodes[0].appendChild(h),m.selected||(m.selectedIndex=n,m.selected=h,m.selected.className=
"mceHashtagsSelected")}else l&&(c=d.substr(0,d.length-1),l=!1),b.hideHashtags()})},249)};k.hideHashtags=function(a){m.container&&(m.container.style.display="none",m.selected=null,m.selectedIndex=-1);f=!1};k.getCurrentWord=function(a){var d=a.getDoc();a=a.selection.getSel();if(a.focusNode&&a.focusOffset){var d=a.focusNode.nodeValue,c=a.focusOffset-1;if(null==d||0==d.length)return"";a=0;for(var b=c;0<=b;b--)if("#"==d.charAt(b)){a=b;break}d=d.substr(a,c+1-a);if(0<d.length&&"#"==d.charAt(0).toString())return d}else if(d.selection&&
d.selection.createRange){a=d.selection.createRange();if(!(a.parentElement&&a.moveToPoint&&a.moveStart&&a.getBoundingClientRect))return"";if(null!=a.parentElement())try{a.parentElement().focus()}catch(l){}a=d.selection.createRange();d=a.getBoundingClientRect();0==d.left&&0==d.top&&(a.moveToElementText(a.parentElement()),d=a.getBoundingClientRect(),d.left=d.right);d.left+=0==a.boundingLeft?d.right-d.left:0;d.top=(d.bottom+d.top)/2;a.moveToPoint(d.left,d.top);a.moveStart("word",-1);a.moveStart("character",
-1);d=a.text;a=0;for(b=d.length-1;0<=b;b--)if("#"==d.charAt(b)){a=b;break}d=d.substr(a,d.length-a);if(0<d.length&&"#"==d.charAt(0).toString())return d}return""};k.selectHashtag=function(a,d){if(!(0>=d.length)&&m.selected){var c=a.selection.getRng();if(c.setStart)c.setStart(c.startContainer,c.startOffset-d.length);else if(c.parentElement&&c.getBoundingClientRect&&c.moveToPoint&&c.moveStart){var b=c.getBoundingClientRect();0==b.left&&0==b.top&&(c.moveToElementText(c.parentElement()),b=c.getBoundingClientRect(),
b.left=b.right,b.left+=0==c.boundingLeft?b.right-b.left:0,c.moveToPoint(b.left,b.top));c.moveStart("character",-1*d.length)}b={id:"mceHashtag"+(new Date).getTime(),tagName:a.dom.getAttrib(m.selected,"data-tagname")};a.selection.setRng(c);a.selection.setContent('<span contenteditable="false" class="mceItem mceHashtag mceNonEditable" id="'+b.id+'" data-mce-json="'+t.serialize(b,"'")+'">'+m.selected.innerHTML+"</span>");a.nodeChanged();this.hideHashtags()}};k.isHashtagSpan=function(a){return a&&"SPAN"===
a.nodeName&&this.editor.dom.hasClass(a,"mceHashtag")};k.spanToObject=function(a,d){var c,b;(c=a.attr("data-mce-json"))&&!a.isEmpty()&&(c=t.parse(c),c.tagName&&(b=new q("#text",3),b.raw=!0,b.value="[tag:"+c.tagName+"]"));b?a.replace(b):a.remove()};k.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};k.textToSpan=function(a){var d=this,c=d.editor;if(a.parent){for(var b=new q("div"),l=/\[tag:([^\]]+)\]/g,
k,m=0;k=l.exec(a.value);)(function(){var l={id:"mceHashtag"+n,tagName:k[1]};if(0<k.index)for(var h=c.parser.parse(d.resolveWhitespace(a.value.substr(m,k.index-m))).getAll("p"),f=0;f<h.length;f++)for(var A;null!=(A=h[f].walk());)b.append(A);h=new q("span",1);b.append(h);h.attr({id:l.id,"class":"mceItem mceHashtag mceNonEditable","data-mce-json":t.serialize(l,"'"),contenteditable:"false"});f=new q("#text",3);f.raw=!0;f.value=tinymce.util.I18n.translate("???");h.append(f);d.getHashtagPreview(l,function(d){var a=
c.dom.get(l.id);a&&(a.innerHTML=d)})})(),m=l.lastIndex,n++;if(0<m){if(m<a.value.length)for(var l=c.parser.parse(d.resolveWhitespace(a.value.substr(m))).getAll("p"),h=0;h<l.length;h++)for(var f;null!=(f=l[h].walk());)b.append(f);a.replace(b);b.unwrap()}}};k.getWindowScrollOffset=function(a){var d=0,c=0;"number"==typeof a.pageXOffset?(d=a.pageXOffset,c=a.pageYOffset):a.document.body&&(a.document.body.scrollLeft||a.document.body.scrollTop)?(d=a.document.body.scrollLeft,c=a.document.body.scrollTop):a.document.documentElement&&
(a.document.documentElement.scrollLeft||a.document.documentElement.scrollTop)&&(d=document.documentElement.scrollLeft,c=document.documentElement.scrollTop);return{x:d,y:c}};k.getHashtagPreview=function(a,d){a.tagName?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"p",tagname:a.tagName}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.html?0==a.html.indexOf("#")?d(a.html.substr(1)):d(a.html):d("")}catch(c){}},error:function(a){try{d("")}catch(c){}}}):d("")};k.searchForHashtags=function(a,
d){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"s",query:a}),success:function(c){c=tinymce.util.JSON.parse(c);try{c&&c.hashtags?d(a,c.hashtags):d(a,null)}catch(b){}},error:function(c){try{d(a,null)}catch(b){}}})};k.getCallbackUrl=function(a){for(var d=this.url+"../../../apis/hashtags?",c={},b=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),l=0;l<b.length;l++){var k=b[l].split(/=/);2==k.length&&(c[k[0]]=k[1])}for(var m in a)c[encodeURIComponent(m)]=encodeURIComponent(a[m]);a=
!0;for(m in c)a?a=!1:d+="&",d+=m+"="+c[m];return d};b.on("PreInit",function(){b.parser.addNodeFilter("#text",function(a){for(var d=a.length;d--;)k.textToSpan(a[d])});b.serializer.addNodeFilter("span",function(a,d,c){d=a.length;for(var b;d--;)b=a[d],-1!==(b.attr("class")||"").indexOf("mceHashtag")&&k.spanToObject(b,c)});b.on("keydown",function(a){return k.handleKeyDown(b,a)},!0);b.on("keyup",function(a){return k.handleKeyUp(b,a)},!0);b.on("click",function(){k.hideHashtags()})});b.on("ResolveName",
function(a){"span"===a.name&&b.dom.hasClass(a.target,"mceHashtag")&&(a.name=tinymce.util.I18n.translate("hashtag"))});b.addMenuItem("removehashtag",{text:"Remove hashtag",cmd:"mceRemoveHashtag",stateSelector:"span.mceHashtag",context:"insert",prependToContext:!0,onPostRender:function(a){a.control.hide();b.on("NodeChange",function(){var d,c;d=b.dom.getParent(b.selection.getStart(),function(a){return b.dom.hasClass(a,"mceHashtag")});c=b.dom.getParent(b.selection.getEnd(),function(a){return b.dom.hasClass(a,
"mceHashtag")});d||c?a.control.show():a.control.hide()},!0)}});b.addCommand("mceRemoveHashtag",function(){var a,d;d=b.selection.getNode();k.isHashtagSpan(d)&&(a=b.dom.getAttrib(d,"data-mce-json"))&&(a=t.parse(a));a&&b.dom.setOuterHTML(d,d.innerHTML)});b.addButton("hashtagremove",{text:"Remove",onclick:function(){b.dom.remove(b.selection.getNode())}});b.addContextToolbar(function(a){return b.dom.is(a,"span.mceHashtag")&&b.getBody().contains(a)},"hashtagremove")});tinymce.PluginManager.add("media",
function(b,u){var q=tinymce.html.Node,t=tinymce.util.JSON,f=0,a=this,h=!1;a.editor=b;a.url=u;a.isMediaSpan=function(a){return a&&"SPAN"===a.nodeName&&this.editor.dom.hasClass(a,"mceInsertMediaItem")};a.createData=function(a,c){var b=Math.round(0.8*jQuery(this.editor.getDoc()).width()),h=Math.round(0.8*jQuery(this.editor.getDoc()).height());if(320<b||!c)b=320;if(240<h||!c)h=240;b>tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&(b=tinyMCE_TelligentEvolutionOptions.MediaMaxWidth);
h>tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&(h=tinyMCE_TelligentEvolutionOptions.MediaMaxHeight);return{id:"mceInsertMedia"+(new Date).getTime(),src:a,width:b,height:h}};a.openDialog=function(a){function c(a){return/float:\s*left/i.test(a)?"float:left;":/float:\s*right/i.test(a)?"float:right;":""}function b(){var a=$(A.getEl());d.embedAsHtml&&d.html?($(".mcemedia-altcontainer, .mcemedia-alignmentcontainer",a).show(),$(".mcemedia-previewwrapper",
a).height(q-($(".mcemedia-altcontainer",a).outerHeight()+$(".mcemedia-alignmentcontainer",a).outerHeight()))):($(".mcemedia-altcontainer, .mcemedia-alignmentcontainer",a).hide(),$(".mcemedia-previewwrapper",a).css("height",""))}function h(){var a=$(A.getEl());$(".mcemedia-prev",a).hide();$(".mcemedia-prevloading",a).show();r.getPreview(d,function(c){try{c&&c.html&&0<c.html.length?(d.embedAsHtml=c.embedAsHtml,d.escapedSrc=c.url,d.html=c.html,b(),$(".mcemedia-prev",a).html(c.html)):d.src&&0<d.src.length?
(d.embedAsHtml=!1,d.escapeSrc=null,d.html=null,b(),c&&c.error?$(".mcemedia-prev",a).text(c.error):$(".mcemedia-prev",a).text(tinymce.util.I18n.translate("No preview is available"))):(d.embedAsHtml=!1,d.escapeSrc=null,d.html=null,b(),$(".mcemedia-prev",a).text(tinymce.util.I18n.translate("No file or URL is selected"))),$(".mcemedia-prevloading",a).hide(),$(".mcemedia-prev",a).show(),c&&c.html&&0<c.html.length?(w=!0,$(".mce-primary button",a).removeAttr("disabled")):(w=!1,$(".mce-primary button",a).attr("disabled",
"disabled"))}catch(l){}})}function k(a){var c=$(A.getEl());if(!a){d.type=$(".mcemedia-type",c).val();d.width=isNaN(parseInt($(".mcemedia-width",c).val(),10))?0:parseInt($(".mcemedia-width",c).val(),10);d.height=isNaN(parseInt($(".mcemedia-height",c).val(),10))?0:parseInt($(".mcemedia-height",c).val(),10);var b=d.src;"url"==$(".mcemedia-type",c).val()?d.src=$(".mcemedia-url",c).val():"upload"==$(".mcemedia-type",c).val()?d.src=s:"search"==$(".mcemedia-type",c).val()&&(0<$(".mcemedia-search",c).glowLookUpTextBox("count")?
d.src=$(".mcemedia-search",c).glowLookUpTextBox("getByIndex",0).Value:d.src="");if(b!=d.src)d.embedAsHtml=!1,d.escapedSrc=d.src,d.html="";else if(d.embedAsHtml&&(b=$(".mcemedia-prev img",c),0<b.length)){b.attr("alt",$(".mcemedia-alt").val());var l=$(".mcemedia-alignment").val();""!=l?(b.attr("style",l),"float:right;"==l?b.attr("class","align-right"):"float:left;"==l&&b.attr("class","align-left")):(b.attr("style",null),b.attr("class",null));d.html=$(".mcemedia-prev",c).html()}}else if(!d.type||"url"!=
d.type&&"upload"!=d.type&&"search"!=d.type||d.src&&0<d.src.length||"upload"==d.type&&0==$(".uploadoption",c).length)d.type="url";$(".mcemedia-urlcontainer",c).hide();$(".mcemedia-uploadcontainer",c).hide();$(".mcemedia-searchcontainer",c).hide();$(".mcemedia-"+d.type+"container",c)&&$(".mcemedia-"+d.type+"container",c).show();$(".mcemedia-type",c).val(d.type);$(".mcemedia-width",c).val(0<d.width?d.width:"");$(".mcemedia-height",c).val(0<d.height?d.height:"");a&&($(".mcemedia-alt",c).val(d.alt||""),
$(".mcemedia-alignment",c).val(d.alignment||""));a&&d.src&&$(".mcemedia-url",c).val(d.src)}function g(){var a=$(A.getEl());w=!1;$(".mce-primary button",a).attr("disabled","disabled");k(!1);h()}var d,f,r=this,A,x="Insert image/video/file",q;f=r.editor.selection.getNode();if(r.isMediaSpan(f)){if(d=r.editor.dom.getAttrib(f,"data-mce-json")){d=t.parse(d);var x=parseInt($(f).css("width"),10)||d.width,v=parseInt($(f).css("height"),10)||d.height;if(v!=d.renderedHeight||x!=d.renderedWidth)d.height=v,d.width=
x;x="Edit media"}}else if(f.src){var z=f.src,x=v=null;(0==z.indexOf(window.location.origin)||"/"==z.substr(0,1))&&0<=z.indexOf("/resized-image/")&&/\/resized\-image\/\_\_size\/([0-9]+)x([0-9]+)\/\_\_key\/(.*)/gi.exec(z)&&(z=$.telligent.evolution.site.getBaseUrl()+"cfs-file/__key/"+RegExp.$3,x=RegExp.$1,v=RegExp.$2);x=r.editor.dom.getAttrib(f,"width")||x;v=r.editor.dom.getAttrib(f,"height")||v;d={src:z,width:x,height:v,alt:$(f).attr("alt")||"",alignment:c($(f).attr("style")||"")};x="Edit image"}d||
(d=r.createData(r.editor.selection.getContent({format:"text"})),d.type=a);r.resize(d);var w=!1,s=null;A=r.editor.windowManager.open({title:tinymce.util.I18n.translate(x),body:[{type:"container",html:'<table role="presentation" border="0" cellpadding="4" cellspacing="0" class="mcetelligent-form"><tr><td><label for="type">'+tinymce.util.I18n.translate("From")+'</label></td><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td>\t\t\t<select id="type" name="type" class="mce-textbox mcemedia-type" style="width: 260px;">\t\t\t\t<option value="url">'+
tinymce.util.I18n.translate("Web (URL)")+'</option>\t\t\t\t<option class="mcemedia-uploadoption" value="upload">'+tinymce.util.I18n.translate("File Upload")+'</option>\t\t\t\t<option class="mcemedia-searchoption" value="search">'+tinymce.util.I18n.translate("Community (Search)")+'</option>\t\t\t</select>\t\t</td>\t</tr>\t</table></td></tr><tr class="mcemedia-urlcontainer"><td><label for="url">'+tinymce.util.I18n.translate("URL")+'</label></td><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td><input id="url" name="url" type="text" value="" class="mce-textbox mcemedia-url" style="width: 260px;" /></td>\t</tr>\t</table></td></tr><tr class="mcemedia-uploadcontainer" style="display: none;"><td><label for="file">'+
tinymce.util.I18n.translate("File")+'</label></td><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td><div id="file" class="mcemedia-file"></div></td>\t</tr>\t</table></td></tr><tr class="mcemedia-searchcontainer" style="display: none;"><td valign="top"><label for="search">'+tinymce.util.I18n.translate("Search")+'</label></td><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td><input id="search" name="search" type="text" class="mcemedia-search" value="" style="width: 260px;" /></td>\t</tr>\t</table></td></tr><tr><td><label for="width">'+
tinymce.util.I18n.translate("Dimensions")+'</label></td><td>\t<table role="presentation" border="0" cellpadding="0" cellspacing="0">\t\t<tr>\t\t\t<td><input type="text" id="width" name="width" class="mce-textbox mcemedia-width" value="" size="3" /> '+tinymce.util.I18n.translate("x")+' <input class="mce-textbox mcemedia-height" type="text" id="height" name="height" value="" size="3" /></td>\t\t</tr>\t</table></td></tr><tr class="mcemedia-altcontainer" style="display: none;"><td><label for="alt">'+
tinymce.util.I18n.translate("Alternate Text")+'</label></td><td>\t<table role="presentation" border="0" cellpadding="0" cellspacing="0">\t\t<tr>\t\t\t<td><input type="text" id="alt" name="alt" class="mce-textbox mcemedia-alt" value="" style="width: 260px;" /></td>\t\t</tr>\t</table></td></tr><tr class="mcemedia-alignmentcontainer" style="display: none;"><td><label for="alignment">'+tinymce.util.I18n.translate("Alignment")+'</label></td><td>\t<table role="presentation" border="0" cellpadding="0" cellspacing="0">\t\t<tr>     <td><select id="alignment" name="alignment" class="mce-textbox mcemedia-alignment" style="width: 260px;">\t\t\t\t<option value="">'+
tinymce.util.I18n.translate("Inline with text")+'</option>\t\t\t\t<option value="float:left;">'+tinymce.util.I18n.translate("Left of text")+'</option>\t\t\t\t<option value="float:right;">'+tinymce.util.I18n.translate("Right of text")+'</option>\t\t\t</select></td>\t\t</tr>\t</table></td></tr></table><div class="mcemedia-previewwrapper"><div class="mcemedia-prevloading" style="display:none">'+tinymce.util.I18n.translate("Loading...")+'</div><div class="mcemedia-prev"></div></div>'}],buttons:[{text:"Ok",
onclick:function(){var a=$(A.getEl());d.src&&w&&(g(),r.editor.execCommand("mceRepaint"),d.embedAsHtml&&d.html?r.editor.selection.setContent(d.html):r.editor.selection.setNode(r.dataToSpan(d)),r.editor.nodeChanged(),$(".mcemedia-file",a).remove(),A.close())},subtype:"primary"},{text:"Cancel",onclick:function(){A.close()}}]});(function(){var a=$(A.getEl());q=$(".mcemedia-previewwrapper",a).innerHeight();$(".mce-primary button",a).attr("disabled","disabled");r.supportsUpload()||$(".mcemedia-uploadoption",
a).remove();r.supportsLocalFiles()||$(".mcemedia-searchoption",a).remove();k(!0);h();$(".mcemedia-search",a).glowLookUpTextBox({delimiter:",",emptyHtml:"",maxValues:1,onGetLookUps:function(a,d){r.searchForMedia(d,function(c){if(d==a.glowLookUpTextBox("getCurrentSearchText")){for(var b=[],l=0;l<c.length;l++)b[b.length]=a.glowLookUpTextBox("createLookUp",c[l].url,c[l].url,c[l].previewHtml,!0);0==b.length&&(b[b.length]=a.glowLookUpTextBox("createLookUp","","",tinymce.util.I18n.translate("No matching files were found."),
!1));a.glowLookUpTextBox("updateSuggestions",b)}})},selectedLookUpsHtml:[]}).bind("glowLookUpTextBoxChange",function(){g()});$(".mcemedia-file",a).glowUpload({fileFilter:null,width:"260px",uploadUrl:r.getUploadUrl()}).bind("glowUploadBegun",function(){$(".mcemedia-fileurl",a).val("")}).bind("glowUploadComplete",function(){r.finalizeFileUpload($(".mcemedia-file",a).glowUpload("val").name,function(a){s=a;g()})});$("input, select",a).on("change",function(){g()})})()};a.getInfo=function(){return{longname:"Insert Media",
author:"Telligent",authorurl:"http://telligent.com",version:"6.5"}};a.getFilename=function(a){var c=a.lastIndexOf("/");return 0<=c&&c<a.length?a.substr(c+1):a+""};a.dataToSpan=function(a,c){var b=this.editor,h;this.resize(a);h=this.editor.dom.create("span",{id:a.id,"class":"mceItem mceNonEditable mceInsertMediaItem","data-mce-json":t.serialize(a,"'"),style:"width:"+a.renderedWith+"px; height:"+a.renderedHeight+"px;",contenteditable:"false",spellcheck:"false"});this.getMediaType(a,function(c,g,d,h,
f){var n=b.dom.get(a.id);n&&(h&&$(n).css({"background-image":"url("+h+")"}).addClass("mceInsertMedaiWithPreview"),$(n).css({width:g+"px",height:d+"px"}).attr("title",f).addClass("mceInsertMediaItem"+c).html("<span>"+f+"</span>"),a.renderedWidth=g,a.renderedHeight=d)});return h};a.dataToHtml=function(a,c){return this.editor.serializer.serialize(this.dataToSpan(a,c),{forced_root_block:"",force_absolute:c})};a.htmlToData=function(a){var c,b;b={};if(c=this.editor.parser.parse(a).getAll("span")[0])if(b=
t.parse(c.attr("data-mce-json")),a=parseInt($(c).css("width"),10),c=parseInt($(c).css("height"),10),c!=b.renderedHeight||a!=b.renderedWidth)b.height=c,b.width=a;this.resize(b);return b};a.spanToObject=function(a,c){var b,h,k;if(b=a.attr("data-mce-json")){b=t.parse(b);for(var g=(a.attr("style")||"").split(";"),d=b.width,f=b.height,r=0;r<g.length;r++)k=g[r].split(":"),"width"==$.trim(k[0])?(k=parseInt(k[1],10))&&(d=k):"height"==$.trim(k[0])&&(k=parseInt(k[1],10))&&(f=k);if(f!=b.renderedHeight||d!=b.renderedWidth)b.height=
f,b.width=d,b.renderedHeight=null,b.renderedWidth=null;b.src&&(this.resize(b),h=new q("#text",3),h.raw=!0,h.value="[View:"+(b.escapedSrc?b.escapedSrc:b.src),h.value=0<b.width?h.value+(":"+b.width):h.value+":0",h.value=0<b.height?h.value+(":"+b.height):h.value+":0",h.value+="]");h?a.replace(h):a.remove()}};a.resizeCfsImg=function(a,c){var b=a.attr("src"),h=a.attr("width")||0,k=a.attr("height")||0;0!=b.indexOf(window.location.origin)&&"/"!=b.substr(0,1)||(0==h||0==k)||/\/resized\-image\/\_\_size\/([0-9]+)x([0-9]+)\/\_\_key\/(.*)/gi.exec(b)&&
(RegExp.$1!=h&&RegExp.$2!=k)&&a.attr({width:null,height:null,src:"/resized-image/__size/"+h+"x"+k+"/__key/"+RegExp.$3,"data-mce-src":"/resized-image/__size/"+h+"x"+k+"/__key/"+RegExp.$3})};a.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};a.textToSpan=function(a){var c=this,b=c.editor;if(a.parent){for(var h=new q("div"),k=/\[view:([^\]]+?)(?:\:([0-9]+)(?:\:([0-9]+))?)?\]/gi,g,d=0;g=k.exec(a.value);)(function(){var k=
RegExp.$1,p=RegExp.$2||0,r=RegExp.$3||0,v={id:"mceInsertMedia"+f++,src:k,width:p,height:r};c.resize(v);if(0<g.index)for(k=b.parser.parse(c.resolveWhitespace(a.value.substr(d,g.index-d))).getAll("p"),p=0;p<k.length;p++)for(;null!=(r=k[p].walk());)h.append(r);k=new q("span",1);h.append(k);k.attr({id:v.id,"class":"mceItem mceNonEditable mceInsertMediaItem",style:"width: "+v.renderedWidth+"px; height:"+v.renderedHeight+"px;","data-mce-json":t.serialize(v,"'"),contenteditable:"false",spellcheck:"false"});
c.getMediaType(v,function(a,d,c,g,l){var k=b.dom.get(v.id);k&&(g&&$(k).css({"background-image":"url("+g+")"}).addClass("mceInsertMedaiWithPreview"),$(k).css({width:d+"px",height:c+"px"}).attr("title",l).addClass("mceInsertMediaItem"+a).html("<span>"+l+"</span>"),v.renderedWidth=d,v.renderedHeight=c)})})(),d=k.lastIndex;if(0<d){if(d<a.value.length)for(var k=b.parser.parse(c.resolveWhitespace(a.value.substr(d))).getAll("p"),p=0;p<k.length;p++)for(var r;null!=(r=k[p].walk());)h.append(r);a.replace(h);
h.unwrap()}}};a.getCallbackUrl=function(a){for(var c=this.url+"../../../apis/media?",b={},h=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),k=0;k<h.length;k++){var g=h[k].split(/=/);2==g.length&&(b[g[0]]=g[1])}for(var d in a)b[encodeURIComponent(d)]=encodeURIComponent(a[d]);a=!0;for(d in b)a?a=!1:c+="&",c+=d+"="+b[d];return c};a.getPreview=function(a,c){var b=this;a.src&&0!=a.src.length?tinymce.util.XHR.send({url:b.getCallbackUrl({t:"gp",url:a.src,width:a.width,height:a.height,contentTypeId:b.editor.getParam("evolution_contenttypeid")||
""}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.html?c(a):a&&a.error?c(a):c("")}catch(b){}},error:function(a){b.editor.windowManager.alert(tinymce.util.I18n.translate("An error occurred while attempting to preview the file."));try{c("")}catch(l){}}}):c("")};a.getMediaType=function(a,c){var b=this;a.src&&0!=a.src.length?tinymce.util.XHR.send({url:b.getCallbackUrl({t:"gmt",url:a.src,width:a.width,height:a.height}),success:function(h){h=tinymce.util.JSON.parse(h);try{h&&h.type?c(h.type,
h.width,h.height,h.url,h.label):c("Empty",a.width,a.height,null,b.getFilename(a.src))}catch(k){}},error:function(h){try{c("Empty",a.width,a.height,null,b.getFilename(a.src))}catch(k){}}}):c("Empty",a.width,a.height,null,"")};a.searchForMedia=function(a,c){var b=this;window.clearTimeout(b.searchTimeout);b.searchTimeout=window.setTimeout(function(){a&&0!=a.length?tinymce.util.XHR.send({url:b.getCallbackUrl({t:"s",query:a}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.results?c(a.results):
(a&&a.error&&alert(a.error),c(""))}catch(b){}},error:function(a){try{c([])}catch(b){}}}):c([])},499)};a.getUploadUrl=function(){return tinyMCE_TelligentEvolutionOptions.DirectUploadUrl};a.finalizeFileUpload=function(a,c){a&&0!=a.length?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"fu",file:a,uploadContext:tinyMCE_TelligentEvolutionOptions.DirectUploadContext}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.url?c(a.url):(a&&a.error&&alert(a.error),c(""))}catch(b){}},error:function(a){alert(tinymce.util.I18n.translate("An error occurred while uploading the file."));
try{c("")}catch(b){}}}):c("")};a.supportsUpload=function(){return!0===b.getParam("evolution_upload")};a.supportsLocalFiles=function(){return!0===b.getParam("evolution_localfiles")};a.resize=function(a){a.width>tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&(a.width=tinyMCE_TelligentEvolutionOptions.MediaMaxWidth);a.height>tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&(a.height=tinyMCE_TelligentEvolutionOptions.MediaMaxHeight);
a.renderedWidth&&0!=a.renderedWidth||(a.renderedWidth=!a.width||0>=a.width?0<a.height?Math.round(4*a.height/3):0<tinyMCE_TelligentEvolutionOptions.MediaMaxWidth?tinyMCE_TelligentEvolutionOptions.MediaMaxWidth:320:a.width,a.renderedWidth>tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&(a.renderedWidth=tinyMCE_TelligentEvolutionOptions.MediaMaxWidth));a.renderedHeight&&0!=a.renderedHeight||(a.renderedHeight=!a.height||0>=a.height?0<tinyMCE_TelligentEvolutionOptions.MediaMaxHeight?
tinyMCE_TelligentEvolutionOptions.MediaMaxHeight:Math.round(3*a.renderedWidth/4):a.height,a.renderedHeight>tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&(a.renderedHeight=tinyMCE_TelligentEvolutionOptions.MediaMaxHeight))};a.initializeDirectUpload=function(b){var c=null;jQuery("#"+b.id).glowUpload({fileFilter:null,renderMode:"link",uploadUrl:a.getUploadUrl()}).on("glowUploadError",function(){a.hideShade();editor.windowManager.alert(tinymce.util.I18n.translate("An error occurred while uploading a file."));
e.preventDefault();e.stopImmediatePropagation();e.stopPropagation()}).on("glowUploadFileProgress",function(c,b){a.showShade(tinymce.util.I18n.translate("Uploading '{0}' ({1}%)...").replace("{0}",b.name).replace("{1}",b.percent));c.preventDefault();c.stopImmediatePropagation();c.stopPropagation()}).on("glowUploadComplete",function(b,l){a.hideShade();b.preventDefault();b.stopImmediatePropagation();b.stopPropagation();a.finalizeFileUpload(jQuery(this).glowUpload("val").name,function(b){var g={};g.id=
"mceInsertMedia"+(new Date).getTime();g.type="url";g.width=320;g.height=240;g.src=b;g.embedAsHtml=!1;g.escapedSrc=g.src;g.html="";a.getPreview(g,function(d){try{d&&(d.html&&0<d.html.length)&&(d&&d.html&&0<d.html.length)&&(g.embedAsHtml=d.embedAsHtml,g.escapedSrc=d.url,g.html=d.html,a.editor.execCommand("mceRepaint"),c&&(a.editor.selection.moveToBookmark(c),c=null),g.embedAsHtml&&g.html?a.editor.selection.setContent(g.html):a.editor.selection.setNode(a.dataToSpan(g)))}catch(b){}})})}).on("click",function(){c=
a.editor.selection.getBookmark();return!0})};a.showShade=function(b){clearTimeout(a.hideTimeout);var c=jQuery(a.editor.getContentAreaContainer()).width();b?a.shadeMessage.text(b).css({display:"block",width:c+"px"}):a.shadeMessage.css("display","none");a.shade.height(jQuery(a.editor.getContentAreaContainer()).height()).width(c).css("display","block")};a.hideShade=function(){clearTimeout(a.hideTimeout);a.hideTimeout=setTimeout(function(){a.shade.css("display","none");a.shadeMessage.css("display","none")},
999)};a.nodeContainsContent=function(a){for(var c=0;c<a.children.length;c++)if("SPAN"==a.children[c].nodeName)return!0;return!1};b.on("PreInit",function(){b.parser.addNodeFilter("#text",function(b){for(var c=b.length;c--;)a.textToSpan(b[c])});b.serializer.addNodeFilter("span",function(b,c,h){c=b.length;var f;if(!h||!h.selection)for(;c--;)f=b[c],-1!==(f.attr("class")||"").indexOf("mceInsertMediaItem")?a.spanToObject(f,h):-1!==(f.attr("src")||"").indexOf("/__key/")&&a.resizeCfsImg(f,h)})});b.on("init",
function(){var l=jQuery("<div></div>").css({position:"absolute",top:"0px",left:"0px"});jQuery(b.getContentAreaContainer()).css("position","relative");jQuery(b.getContentAreaContainer()).append(l);a.shade=jQuery('<div class="mceDragDropShade"></div>').css({position:"absolute",display:"none",left:"0px",top:"0px"});a.shadeMessage=jQuery('<div class="mceDragDropMessage"></div>').css({position:"absolute",display:"none",left:"0px",top:"0px"});l.append(a.shade).append(a.shadeMessage);!a.supportsUpload()||
(h||!jQuery.fn.glowUpload||tinymce.isIE6||tinymce.isIE7||tinymce.isIE8||tinymce.isIE9)||(b.plugins.tips&&b.plugins.tips.defaultTip&&b.plugins.tips.defaultTip(tinymce.util.I18n.translate("Add images and other files by dragging them into the editor.")),h=!0,jQuery(b.getBody()).on("dragover dragenter",function(){a.showShade(tinymce.util.I18n.translate("Upload file(s)"))}),jQuery(b.getBody()).parent().on("dragover dragenter",function(){a.showShade(tinymce.util.I18n.translate("Upload file(s)"))}),jQuery(b.getContainer()).on("dragleave dragend drop mouseout",
function(){a.hideShade()}),jQuery(b.getContainer()).glowUpload({fileFilter:null,renderMode:"dragdrop",uploadUrl:a.getUploadUrl()}).on("glowUploadError",function(){a.hideShade();editor.windowManager.alert(tinymce.util.I18n.translate("An error occurred while uploading a file."))}).on("glowUploadFileProgress",function(c,b){a.showShade(tinymce.util.I18n.translate("Uploading '{0}' ({1}%)...").replace("{0}",b.name).replace("{1}",b.percent))}).on("glowUploadComplete",function(c,h){a.hideShade();a.finalizeFileUpload(h.name,
function(c){var k={};k.id="mceInsertMedia"+(new Date).getTime();k.type="url";k.width=320;k.height=240;k.src=c;k.embedAsHtml=!1;k.escapedSrc=k.src;k.html="";a.getPreview(k,function(c){try{c&&(c.html&&0<c.html.length)&&(c&&c.html&&0<c.html.length)&&(k.embedAsHtml=c.embedAsHtml,k.escapedSrc=c.url,k.html=c.html,b.execCommand("mceRepaint"),k.embedAsHtml&&k.html?b.selection.setContent(k.html):b.selection.setNode(a.dataToSpan(k)))}catch(d){}})})}));a.editor.on("dblclick",function(c){if(b.dom.hasClass(c.target,
"mceInsertMediaItem"))a.openDialog(c.target);else if(b.dom.hasClass(c.target.parentNode,"mceInsertMediaItem"))a.openDialog(c.target.parentNode);else if("IMG"==c.target.nodeName&&c.target.src&&(!c.target.className||0>c.target.className.indexOf("mce"))){for(var h=c.target.parentNode;h&&"BODY"!=h.nodeName;){if(h.className&&0<=h.className.indexOf("mce"))return;h=h.parentNode}a.openDialog(c.target)}});a.editor.on("NodeChange",function(){var c=b.selection.getNode();"A"==c.nodeName&&c.href&&!a.nodeContainsContent(c)?
a.editor.execCommand("mceTip",!1,tinymce.util.I18n.translate("Select 'Convert link to preview' from the 'Edit' menu to preview this link.")):b.dom.hasClass(c,"mceInsertMediaItem")&&a.editor.execCommand("mceTip",!1,tinymce.util.I18n.translate("Select 'Convert preview to link' from the 'Edit' menu to just show a link to this file/site."))},!0)});b.on("PastePreProcess",function(h){function c(a,d,c){var b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="blob";b.onreadystatechange=function(a){4==
this.readyState&&(200==this.status&&"blob"==this.responseType?d(new Blob([this.response],{type:this.getResponseHeader("Content-Type")})):c())};b.send()}function m(a,d,c,b){if("image/"!=a.type.substr(0,6))b();else{var g=a.type.substr(6);if("png"!=g&&"gif"!=g&&"jpg"!=g&&"jpeg"!=g&&"pjpeg"!=g)b();else{"pjpeg"==g&&(g="jpeg");var k=Math.ceil(a.size/1048576),h=[],l;for(l=0;l<k;l++)(function(){var c=new FormData;c.append("File",a.slice(1048576*l,Math.min(a.size,1048576*(l+1)),"image/"+g),d+"."+g);c.append("FileName",
d+"."+g);c.append("TotalChunks",k);c.append("CurrentChunk",l);c.append("UploadContextId",tinyMCE_TelligentEvolutionOptions.DirectUploadContext);h.push(jQuery.telligent.evolution.post({url:jQuery.telligent.evolution.site.getBaseUrl()+"api.ashx/v2/cfs/temporary.json",data:c,contentType:!1,processData:!1}))})();jQuery.when.apply(jQuery,h).done(function(a){a&&a.UploadedFile&&a.UploadedFile.DownloadUrl?c(a.UploadedFile.DownloadUrl):b()}).fail(function(){b()})}}}function t(a,d,c,b){var g,k,h,l;a=a.split(/[:;,]/g,
4);if("data"!=a[0]||"base64"!=a[2])b();else if("image"!=a[1].substr(0,5))b();else{var f=a[1].substr(6);if("png"!=f&&"gif"!=f&&"jpg"!=f&&"jpeg"!=f&&"pjpeg"!=f)b();else{"pjpeg"==f&&(f="jpeg");try{k=window.atob(a[3]);h=[];for(g=0;g<k.length;g++)h.push(k.charCodeAt(g));l=new Blob([new Uint8Array(h)],{type:"image/"+f});m(l,d,c,b)}catch(p){b()}}}}function k(d,b,g,k){"data:"==d.substr(0,5)?t(d,b,g,k):c(d,function(a){m(a,b,function(a){g(a)},function(){k()})},function(){tinymce.util.XHR.send({url:a.getCallbackUrl({t:"si",
url:d,fileName:b,uploadContext:tinyMCE_TelligentEvolutionOptions.DirectUploadContext}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.url?g(a.url):k()}catch(d){k()}},error:function(a){k()}})})}function g(d,c,g,h){if(!(a.supportsUpload()&&window.FormData&&window.Blob&&window.Uint8Array&&window.atob&&window.jQuery&&jQuery.telligent&&jQuery.telligent.evolution&&jQuery.telligent.evolution.post))return"";var l="pastedimage"+(new Date).getTime()+"v"+ ++f;k(c,l,function(d){var c=b.dom.get(l);
if(c){var k={};k.id="mceInsertMedia"+l;k.type="url";k.width=g;k.height=h;k.src=d;k.embedAsHtml=!1;k.escapedSrc=k.src;k.html="";a.getPreview(k,function(d){try{d&&(d.html&&0<d.html.length)&&(d&&d.html&&0<d.html.length)&&(k.embedAsHtml=d.embedAsHtml,k.escapedSrc=d.url,k.html=d.html,k.embedAsHtml&&k.html?b.dom.setOuterHTML(c,k.html):b.dom.replace(a.dataToSpan(k),c))}catch(g){}})}},function(){window.setTimeout(function(){b.dom.remove(l)},250)});return'<span id="'+l+'" contenteditable="false" class="mceItem mceNonEditable mceInsertMediaItem mceInsertMediaItem mceInsertMediaItemImage" style="width: '+
g+"px; height: "+h+'px; color: Transparent;">...</span>'}var d=/<(img)\s[^>]*?src="([^"]*)"[^>]*>/gi,p=/width=\"?(\d+)\"?/i,r=/style=\"?[^ "]*?width:\s*(\d+)px/i,q=/height=\"?(\d+)\"?/i,x=/style=\"?[^ "]*?height:\s*(\d+)px/i,y,v=0,z="",w,s;if(0===h.content.indexOf("data:image/"))h.content=g("img",h.content,320,240);else{for(;y=d.exec(h.content);){y.index>v&&(z+=h.content.substr(v,y.index-v));v=NaN;if(s=p.exec(y[0]))v=parseInt(s[1],10);isNaN(v)&&(s=r.exec(y[0]))&&(v=parseInt(s[1],10));isNaN(v)&&(v=
320);w=NaN;if(s=q.exec(y[0]))w=parseInt(s[1],10);isNaN(w)&&(s=x.exec(y[0]))&&(w=parseInt(s[1],10));isNaN(w)&&(w=240);z+=g(y[1],y[2],v,w);v=d.lastIndex}v<h.content.length&&(z+=h.content.substr(v));h.content=z}});b.on("ResolveName",function(a){"span"===a.name&&b.dom.hasClass(a.target,"mceInsertMediaItem")&&(a.name=tinymce.util.I18n.translate("media"))});b.on("NodeChange",function(){var a=b.selection.getNode();b.dom.hasClass(a,"mceInsertMediaItem")&&window.setTimeout(function(){b.selection.controlSelection.showResizeRect(a)},
2)});b.addCommand("mceInsertMedia",function(){a.openDialog("upload")});b.addCommand("mceInsertMediaToPreview",function(){var h=b.selection.getNode();if("A"!=h.nodeName)for(var c=0;c<h.childNodes.length;c++)if("A"==h.childNodes[c].nodeName&&h.childNodes[c].href){h=h.childNodes[c];break}if("A"==h.nodeName){var f=a.createData(h.href,!0);f.renderedWidth=f.width;f.renderedHeight=f.height;a.getPreview(f,function(c){try{c&&(c.html&&0<c.html.length)&&(f.embedAsHtml=c.embedAsHtml,f.escapedSrc=c.url,f.html=
c.html),f.embedAsHtml?$(h).replaceWith(f.html):b.dom.replace(a.dataToSpan(f),h,!1)}catch(k){}})}});b.addCommand("mceInsertMediaToLink",function(){var h,c,f;c=b.selection.getNode();a.isMediaSpan(c)?(h=b.dom.getAttrib(c,"data-mce-json"))&&(h=t.parse(h)):"IMG"==c.nodeName&&c.src&&(h={src:c.src});h&&(f=document.createElement("a"),f.href=h.src,f.innerHTML=h.src,b.dom.replace(f,c,!1))});b.addMenuItem("media",{text:"Insert image/video/file",icon:"media",cmd:"mceInsertMedia",context:"insert",prependToContext:!0});
b.addMenuItem("removemedia",{text:"Convert preview to link",cmd:"mceInsertMediaToLink",icon:"link",context:"edit",prependToContext:!0,onPostRender:function(a){a.control.hide();b.on("NodeChange",function(){var c=b.selection.getNode();b.dom.hasClass(c,"mceInsertMediaItem")?a.control.show():a.control.hide()},!0)}});b.addMenuItem("previewmedia",{text:"Convert link to preview",cmd:"mceInsertMediaToPreview",icon:"media",context:"edit",prependToContext:!0,onPostRender:function(h){h.control.hide();b.on("NodeChange",
function(){var c=b.selection.getNode();"A"==c.nodeName&&c.href&&!a.nodeContainsContent(c)?h.control.show():h.control.hide()},!0)}});b.addMenuItem("editmedia",{text:"Edit media",icon:"media",cmd:"mceInsertMedia",context:"edit",prependToContext:!0,onPostRender:function(a){a.control.hide();b.on("NodeChange",function(){var c=b.selection.getNode();b.dom.hasClass(c,"mceInsertMediaItem")?a.control.show():a.control.hide()},!0)}});b.addMenuItem("editimage",{text:"Edit image",icon:"image",cmd:"mceInsertMedia",
context:"edit",prependToContext:!0,onPostRender:function(a){a.control.hide();b.on("NodeChange",function(){var c=b.selection.getNode();"SPAN"==c.nodeName&&c.src&&(!c.className||0>c.className.indexOf("mce"))?a.control.show():a.control.hide()},!0)}});b.addButton("insertmediadirect",{title:"Insert image/video/file",cmd:"mceInsertMediaIgnore",icon:"image",onPostRender:function(b){a.supportsUpload()&&jQuery.fn.glowUpload?a.initializeDirectUpload(b.control.getEl()):b.control.hide()}});b.addButton("editmedia",
{text:"Edit",cmd:"mceInsertMedia"});b.addButton("removemedia",{text:"Remove",onclick:function(){b.dom.remove(b.selection.getNode())}});b.addButton("convertmediatolink",{text:"Convert to link",cmd:"mceInsertMediaToLink"});b.addContextToolbar(function(a){if(b.dom.hasClass(a,"mceInsertMediaItem"))return!0;if("IMG"==a.nodeName&&a.src&&(!a.className||0>a.className.indexOf("mce"))){for(a=a.parentNode;a&&"BODY"!=a.nodeName;){if(a.className&&0<=a.className.indexOf("mce"))return!1;a=a.parentNode}return!0}return!1},
"editmedia removemedia convertmediatolink")});tinymce.PluginManager.add("mentions",function(b,u){var q=tinymce.html.Node,t=tinymce.util.JSON,f=!1,a=!1,h,l,c={container:null,selected:null,selectedIndex:-1},m=1,n=this;n.editor=b;n.url=u;n.handleKeyDown=function(c,b){if(!this.disabledState&&f){if(40==b.keyCode)return this.highlightNextMentionable(),this.cancelEvent(b);if(38==b.keyCode)return this.highlightPreviousMentionable(),this.cancelEvent(b);if(13==b.keyCode)return this.selectMentionable(c,this.getCurrentWord(c)),
a=!1,this.cancelEvent(b);if(27==b.keyCode)return a=!1,this.hideMentionables(),this.cancelEvent(b)}};n.cancelEvent=function(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();return!1};n.getLastTypedCharacter=function(a,c){var d=a.getDoc(),b=a.selection.getSel();if(b.focusNode&&b.focusOffset){if(d=b.focusNode.nodeValue,0<=b.focusOffset-1&&d&&d.length>=b.focusOffset)return d.charAt(b.focusOffset-1)}else if(d.selection&&d.selection.createRange){b=d.selection.createRange();if(!(b.parentElement&&
b.moveToPoint&&b.moveStart&&b.getBoundingClientRect))return"";if(null!=b.parentElement())try{b.parentElement().focus()}catch(h){}b=d.selection.createRange();d=b.getBoundingClientRect();0==d.left&&0==d.top&&(b.moveToElementText(b.parentElement()),d=b.getBoundingClientRect(),d.left=d.right);d.left+=0==b.boundingLeft?d.right-d.left:0;d.top=(d.bottom+d.top)/2;b.moveToPoint(d.left,d.top);b.moveStart("character",-1);return b.text}return""};n.handleKeyUp=function(b,c){if(!this.disabledState){var d=this.getLastTypedCharacter(b,
c);(f||a||"@"==d)&&(40!=c.keyCode&&38!=c.keyCode&&13!=c.keyCode&&27!=c.keyCode)&&(d=this.getCurrentWord(b),a||(h=!0,l=""),256<d.length||""==d?(a=!1,this.hideMentionables()):(a=!0,2<d.length&&(h||d.length-1<=l.length||d.substr(1,l.length)!=l)?(f=!0,this.showMentionables(b,d.substr(1))):this.hideMentionables()))}};n.highlightNextMentionable=function(){c.container&&(c.selected&&c.container.childNodes[0].childNodes.length>c.selectedIndex+1)&&(c.selected.className="",c.selectedIndex++,c.selected=c.container.childNodes[0].childNodes[c.selectedIndex],
c.selected.className="mceMentionablesSelected")};n.highlightPreviousMentionable=function(){c.container&&(c.selected&&0<c.container.childNodes[0].childNodes.length&&0<c.selectedIndex)&&(c.selected.className="",c.selectedIndex--,c.selected=c.container.childNodes[0].childNodes[c.selectedIndex],c.selected.className="mceMentionablesSelected")};n.setHighlightdMention=function(a){c.container&&(c.selected&&c.container.childNodes[0].childNodes.length>a&&0<=a)&&(c.selected.className="",c.selectedIndex=a,c.selected=
c.container.childNodes[0].childNodes[c.selectedIndex],c.selected.className="mceMentionablesSelected")};n.showMentionables=function(a,b){var d=this;if(!c.container){c.container=document.createElement("div");a.dom.setAttrib(c.container,"class","mceMentionablesList");a.dom.setAttrib(c.container,"style","position:absolute; z-index: 200001;");var f=document.createElement("ul");c.container.appendChild(f);document.body.appendChild(c.container)}c.selected=null;c.container.childNodes[0].innerHTML="";var m=
document.createElement("li");m.innerHTML=tinymce.util.I18n.translate("Loading...");c.container.childNodes[0].appendChild(m);c.container.style.display="block";var f=this.getWindowScrollOffset(window),t=a.dom.getPos(a.getContentAreaContainer()),n=this.getWindowScrollOffset(a.getWin()),q=a.dom.getPos(a.selection.getNode()),v=0,z=0,z=a.selection.getRng();z.expand&&z.expand("word");var w=null;0==z.getClientRects().length?z.parentElement&&z.getBoundingClientRect&&z.moveToPoint&&z.moveStart?(z.moveToElementText(z.parentElement()),
w=z.getBoundingClientRect(),w.left=w.right,w.left+=0==z.boundingLeft?w.right-w.left:0,z.moveToPoint(w.left,w.top),z.moveStart("character",-1),w=z.getClientRects()[0]):z.insertNode&&(v=a.getWin().document.createElement("span"),z.insertNode(v),w=a.dom.getPos(v),w={left:w.x,top:w.y,width:0,height:v.offsetHeight},v.parentNode.removeChild(v)):w=z.getClientRects()[0];w&&(!w.width&&!w.height&&w.right&&w.bottom)&&(w={width:w.right-w.left,height:w.bottom-w.top,left:w.left-t.x,top:w.top-t.y});w?(v=w.top+w.height,
z=w.left):(v=1.3*parseInt(a.dom.getStyle(a.selection.getNode(),"font-size",!0))+q.y,z=q.x);v+t.y>$(window).height()/2?(c.container.style.bottom=$("body").outerHeight()-(t.y+f.y+v-n.y)+w.height+"px",c.container.style.left=t.x+f.x+z-n.x+"px",c.container.style.top="auto"):(c.container.style.top=t.y+f.y+v-n.y+"px",c.container.style.left=t.x+f.x+z-n.x+"px",c.container.style.bottom="auto");c.lastSearchText=b;window.clearTimeout(c.searchHandle);var s=a.selection.getBookmark(2);c.searchHandle=window.setTimeout(function(){d.searchForMentions(b,
function(b,g){if(c.lastSearchText==b)if(c.selected=null,c.container.childNodes[0].innerHTML="",g&&0!=g.length){h=!0;l=b;for(var f=0;f<g.length;f++)m=document.createElement("li"),m.style.cursor="pointer",m.innerHTML=g[f].previewhtml,m.onclick=function(){a.selection.moveToBookmark(s);d.selectMentionable(a,d.getCurrentWord(a))},m.onmouseover=function(){d.setHighlightdMention(parseInt(a.dom.getAttrib(this,"data-index")))},a.dom.setAttrib(m,"data-index",f),a.dom.setAttrib(m,"data-contentid",g[f].contentid),
a.dom.setAttrib(m,"data-contenttypeid",g[f].contenttypeid),c.container.childNodes[0].appendChild(m),c.selected||(c.selectedIndex=f,c.selected=m,c.selected.className="mceMentionablesSelected")}else h&&(l=b.substr(0,b.length-1),h=!1),d.hideMentionables()})},249)};n.hideMentionables=function(a){c.container&&(c.container.style.display="none",c.selected=null,c.selectedIndex=-1);f=!1};n.getCurrentWord=function(a){var b=a.getDoc();a=a.selection.getSel();if(a.focusNode&&a.focusOffset){var b=a.focusNode.nodeValue,
d=a.focusOffset-1;if(null==b||0==b.length)return"";a=0;for(var c=d;0<=c;c--)if("@"==b.charAt(c)){a=c;break}b=b.substr(a,d+1-a);if(0<b.length&&"@"==b.charAt(0).toString())return b}else if(b.selection&&b.selection.createRange){a=b.selection.createRange();if(!(a.parentElement&&a.moveToPoint&&a.moveStart&&a.getBoundingClientRect))return"";if(null!=a.parentElement())try{a.parentElement().focus()}catch(h){}a=b.selection.createRange();b=a.getBoundingClientRect();0==b.left&&0==b.top&&(a.moveToElementText(a.parentElement()),
b=a.getBoundingClientRect(),b.left=b.right);b.left+=0==a.boundingLeft?b.right-b.left:0;b.top=(b.bottom+b.top)/2;a.moveToPoint(b.left,b.top);a.moveStart("word",-1);a.moveStart("character",-1);b=a.text;a=0;for(c=b.length-1;0<=c;c--)if("@"==b.charAt(c)){a=c;break}b=b.substr(a,b.length-a);if(0<b.length&&"@"==b.charAt(0).toString())return b}return""};n.selectMentionable=function(a,b){if(!(0>=b.length)&&c.selected){var d=a.selection.getRng();if(d.setStart)d.setStart(d.startContainer,d.startOffset-b.length);
else if(d.parentElement&&d.getBoundingClientRect&&d.moveToPoint&&d.moveStart){var h=d.getBoundingClientRect();0==h.left&&0==h.top&&(d.moveToElementText(d.parentElement()),h=d.getBoundingClientRect(),h.left=h.right,h.left+=0==d.boundingLeft?h.right-h.left:0,d.moveToPoint(h.left,h.top));d.moveStart("character",-1*b.length)}h={id:"mceMention"+(new Date).getTime(),contentId:a.dom.getAttrib(c.selected,"data-contentid"),contentTypeId:a.dom.getAttrib(c.selected,"data-contenttypeid")};a.selection.setRng(d);
d=(d=$(c.selected).find(".mentionable-suggestion-preview"))&&0<d.length?d.html():c.selected.innerHTML;a.selection.setContent('<span contenteditable="false" class="mceItem mceMention mceNonEditable" id="'+h.id+'" data-mce-json="'+t.serialize(h,"'")+'">'+d+"</span>");a.nodeChanged();this.hideMentionables()}};n.isMentionSpan=function(a){return a&&"SPAN"===a.nodeName&&this.editor.dom.hasClass(a,"mceMention")};n.spanToObject=function(a,b){var d,c;(d=a.attr("data-mce-json"))&&!a.isEmpty()&&(d=t.parse(d),
d.contentId&&d.contentTypeId&&(c=new q("#text",3),c.raw=!0,c.value="[mention:"+d.contentId+":"+d.contentTypeId+"]"));c?a.replace(c):a.remove()};n.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};n.textToSpan=function(a){var b=this,d=b.editor;if(a.parent){for(var c=new q("div"),h=/\[mention:([a-fA-F0-9]{32}):([a-fA-F0-9]{32})\]/g,l,f=0;l=h.exec(a.value);)(function(){var h={id:"mceMention"+
m,contentId:RegExp.$1,contentTypeId:RegExp.$2};if(0<l.index)for(var n=d.parser.parse(b.resolveWhitespace(a.value.substr(f,l.index-f))).getAll("p"),r=0;r<n.length;r++)for(var v;null!=(v=n[r].walk());)c.append(v);n=new q("span",1);c.append(n);n.attr({id:h.id,"class":"mceItem mceMention mceNonEditable","data-mce-json":t.serialize(h,"'"),contenteditable:"false"});r=new q("#text",3);r.raw=!0;r.value=tinymce.util.I18n.translate("???");n.append(r);b.getMentionPreview(h,function(a){var b=d.dom.get(h.id);
b&&(b.innerHTML=a)})})(),f=h.lastIndex,m++;if(0<f){if(f<a.value.length)for(var h=d.parser.parse(b.resolveWhitespace(a.value.substr(f))).getAll("p"),n=0;n<h.length;n++)for(var v;null!=(v=h[n].walk());)c.append(v);a.replace(c);c.unwrap()}}};n.getWindowScrollOffset=function(a){var b=0,d=0;"number"==typeof a.pageXOffset?(b=a.pageXOffset,d=a.pageYOffset):a.document.body&&(a.document.body.scrollLeft||a.document.body.scrollTop)?(b=a.document.body.scrollLeft,d=a.document.body.scrollTop):a.document.documentElement&&
(a.document.documentElement.scrollLeft||a.document.documentElement.scrollTop)&&(b=document.documentElement.scrollLeft,d=document.documentElement.scrollTop);return{x:b,y:d}};n.getMentionPreview=function(a,b){a.contentId&&a.contentTypeId?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"p",contentid:a.contentId,contenttypeid:a.contentTypeId}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.html?b(a.html):b("")}catch(c){}},error:function(a){try{b("")}catch(c){}}}):b("")};n.searchForMentions=
function(a,b){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"s",query:a}),success:function(d){d=tinymce.util.JSON.parse(d);try{d&&d.mentionables?b(a,d.mentionables):b(a,null)}catch(c){}},error:function(d){try{b(a,null)}catch(c){}}})};n.getCallbackUrl=function(a){for(var b=this.url+"../../../apis/mentions?",d={},c=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),h=0;h<c.length;h++){var l=c[h].split(/=/);2==l.length&&(d[l[0]]=l[1])}for(var f in a)d[encodeURIComponent(f)]=encodeURIComponent(a[f]);
a=!0;for(f in d)a?a=!1:b+="&",b+=f+"="+d[f];return b};b.on("PreInit",function(){b.parser.addNodeFilter("#text",function(a){for(var b=a.length;b--;)n.textToSpan(a[b])});b.serializer.addNodeFilter("span",function(a,b,d){b=a.length;for(var c;b--;)c=a[b],-1!==(c.attr("class")||"").indexOf("mceMention")&&n.spanToObject(c,d)});b.on("keydown",function(a){return n.handleKeyDown(b,a)},!0);b.on("keyup",function(a){return n.handleKeyUp(b,a)},!0);b.on("click",function(){n.hideMentionables()})});b.on("ResolveName",
function(a){"span"===a.name&&b.dom.hasClass(a.target,"mceMention")&&(a.name=tinymce.util.I18n.translate("mention"))});b.addMenuItem("removemention",{text:"Remove mention",cmd:"mceRemoveMention",stateSelector:"span.mceMention",context:"insert",prependToContext:!0,onPostRender:function(a){a.control.hide();b.on("NodeChange",function(){var c,d;c=b.dom.getParent(b.selection.getStart(),function(a){return b.dom.hasClass(a,"mceMention")});d=b.dom.getParent(b.selection.getEnd(),function(a){return b.dom.hasClass(a,
"mceMention")});c||d?a.control.show():a.control.hide()},!0)}});b.addCommand("mceRemoveMention",function(){var a,c;c=b.selection.getNode();n.isMentionSpan(c)&&(a=b.dom.getAttrib(c,"data-mce-json"))&&(a=t.parse(a));a&&b.dom.setOuterHTML(c,c.innerHTML)});b.addButton("mentionremove",{text:"Remove",onclick:function(){b.dom.remove(b.selection.getNode())}});b.addContextToolbar(function(a){return b.dom.is(a,"span.mceMention")&&b.getBody().contains(a)},"mentionremove")});tinymce.PluginManager.add("modalpopups",
function(b,u){var q=tinymce.ui.Panel.extend({modal:!0,Defaults:{border:1,layout:"flex",containerCls:"panel",role:"dialog",border:"0 0 0 0",callbacks:{submit:function(){this.fire("submit",{data:this.toJSON()})},close:function(){this.close()}}},modalElm:null,init:function(b){var f=this;f._super(b);f.isRtl()&&(f.classes=(f.classes||"")+" rtl");f._fixed=!1;b.buttons&&(f.statusbar=new tinymce.ui.Panel({layout:"flex",border:"0 0 0 0",spacing:3,padding:10,align:"center",pack:"start",defaults:{type:"button"},
items:b.buttons,classes:"foot"}),f.statusbar.parent(f));f.on("click",function(a){-1!=a.target.className.indexOf(f.classPrefix+"close")&&f.close()});f.on("cancel",function(){f.close()});f.aria("describedby",f.describedBy||f._id+"-none");f.aria("label",b.title);f._fullscreen=!1;f.modalElm=document.createElement("div");f.modalElm.style.visibility="hidden";$(document.getElementsByTagName("body")).append(f.modalElm);$(f.modalElm).html(f.renderHtml());f.postRender();f.reflow();window.setTimeout(function(){$(".mce-floatpanel.mce-arrow").hide();
f.modalElm.style.visibility="visible";f.modalElm=$.glowModal({html:f.modalElm,title:b.title,onClose:function(){f.modalIsClosed||(f.modalIsClosed=!0,f.close())}});b.onShown&&b.onShown.call(f)},1)},recalc:function(){var b=this.statusbar,f,a,h;this._fullscreen&&(this.layoutRect(tinymce.DOM.getWindowSize()),this.layoutRect().contentH=this.layoutRect().innerH);this._super();f=this.layoutRect();this.settings.title&&!this._fullscreen&&(a=f.headerW,a>f.w&&(h=f.x-Math.max(0,a/2),this.layoutRect({w:a,x:h}),
h=!0));b&&(b.layoutRect({w:this.layoutRect().innerW}).recalc(),a=b.layoutRect().minW+f.deltaW,a>f.w&&(h=f.x-Math.max(0,a-f.w),this.layoutRect({w:a,x:h}),h=!0));h&&this.recalc();$.glowModal.refresh()},initLayoutRect:function(){var b=this._super(),f=0;this.statusbar&&(f+=this.statusbar.layoutRect().h);b.deltaH+=f;b.minH+=f;b.h+=f;b.x=1;b.y=1;return b},close:function(){this.fire("close").isDefaultPrevented()||(this.remove(),this.modalIsClosed||$.glowModal.close(),$.glowModal.defaults.openInParentModal=
this._openInParentModal);return this},renderHtml:function(){var b=this._layout,f=this._id,a=this.settings,h="",l=a.html;this.preRender();b.preRender(this);a.url&&(l='<iframe src="'+a.url+'" tabindex="-1"></iframe>');"undefined"==typeof l&&(l=b.renderHtml(this));this.statusbar&&(h=this.statusbar.renderHtml());return'<div id="'+f+'" class="'+this.classes+'" hidefocus="1"><div class="'+this.classPrefix+'reset" role="application"><div id="'+f+'-body" class="'+this.bodyClasses+'">'+l+"</div>"+h+"</div></div>"},
fullscreen:function(b){},resizeTo:function(){},resizeBy:function(){},resizeToContent:function(){},hide:function(){},hideAll:function(){},postRender:function(){var b=this;setTimeout(function(){b.classes=(b.classes||"")+" in"},0);b._super();b.statusbar&&b.statusbar.postRender();b.focus();b.on("submit",function(f){f.isDefaultPrevented()||b.close()})},focus:function(){var b=this;window.setTimeout(function(){if(null!=b.modalElm){var f=$(b.modalElm).find('input[type!="hidden"], select, textarea').first();
if(0<f.length)f.focus();else if(f=$(b.modalElm).find("iframe").first(),0<f.length)f.on("load",function(){try{$(b.modalElm).find("iframe").get(0).contentWindow.$('input[type!="hidden"], select, textarea').first().focus()}catch(a){}})}},250)},submit:function(){return this.fire("submit",{data:this.toJSON()})},remove:function(){this._super();this.statusbar&&this.statusbar.remove()},getContainerElm:function(){return this.modalElm},getContentWindow:function(){var b=this.getEl().getElementsByTagName("iframe")[0];
return b?b.contentWindow:null}});b.windowManager=new function(b){function f(){if(a.windows.length)return a.windows[a.windows.length-1]}var a=this;a.windows=[];b.on("remove",function(){for(;0<a.windows.length;)$.glowModal.close(),a.windows.pop()});$(window).on("scroll",function(){var a=f();if(a)try{$(a.modalElm).click()}catch(b){}});a.open=function(h,l){var c;b.editorManager.setActive(b);h.title=h.title||" ";h.url=h.url||h.file;h.url&&(h.width=parseInt(h.width||320,10),h.height=parseInt(h.height||
240,10));h.body&&(h.items={defaults:h.defaults,type:h.bodyType||"form",items:h.body});h.url||h.buttons||(h.buttons=[{text:"Ok",subtype:"primary",onclick:function(){c.find("form")[0].submit()}},{text:"Cancel",onclick:function(){c.close()}}]);var f=$.glowModal.defaults.openInParentModal;$.glowModal.defaults.openInParentModal=!1;c=new q(h);c._openInParentModal=f;c.modalIsClosed=!1;a.windows.push(c);c.on("close",function(){for(var h=a.windows.length;h--;)a.windows[h]===c&&a.windows.splice(h,1);a.windows.length||
b.focus()});if(h.data)c.on("postRender",function(){this.find("*").each(function(a){var b=a.name();b in h.data&&a.value(h.data[b])})});c.features=h||{};c.params=l||{};1===a.windows.length&&b.nodeChanged();return c};a.alert=function(a,l,c){window.alert(b.translate(a));l?l.call(c||this):b.focus()};a.confirm=function(a,l,c){l.call(c||this,window.confirm(b.translate(a)))};a.close=function(){f()&&f().close()};a.getParams=function(){return f()?f().params:null};a.setParams=function(a){f()&&(f().params=a)};
a.getWindows=function(){return windows}}(b)});tinymce.PluginManager.add("preview",function(b,u){function q(f){var a="";tinymce.util.XHR.send({url:t({t:"p",ct:b.settings.evolution_contenttypeid||""}),data:"html="+encodeURIComponent(f)+"&baseUrl="+encodeURIComponent(b.documentBaseURI.getURI()),content_type:"application/x-www-form-urlencoded",async:!1,success:function(b){b=tinymce.util.JSON.parse(b);try{b&&(b.preview?a=b.preview:b.error&&jQuery.telligent.evolution.notifications.show(b.error,{type:"error"}))}catch(l){}},
error:function(a){}});return a}function t(b){for(var a=u+"../../../apis/preview?",h={},l=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),c=0;c<l.length;c++){var m=l[c].split(/=/);2==m.length&&(h[m[0]]=m[1])}for(var n in b)h[encodeURIComponent(n)]=encodeURIComponent(b[n]);b=!0;for(n in h)b?b=!1:a+="&",a+=n+"="+h[n];return a}b.addCommand("mcePreview",function(){var f=b.windowManager.open({title:tinymce.util.I18n.translate("Preview"),width:640,height:500,html:'<iframe src="about:blank" style="height: 500px; width:100%;" class="mcetelligent-frame with-border"></iframe>',
buttons:{text:"Close",onclick:function(){f.close()}},onShown:function(){var a=this.getEl("body").firstChild.contentWindow.document;a.open();a.write(q(b.getContent()));a.close()}})});b.addMenuItem("preview",{text:"Preview",cmd:"mcePreview",icon:"preview",context:"tools"})});tinymce.PluginManager.add("quotes",function(b,u){var q=tinymce.html.Node,t=tinymce.util.JSON,f=0,a=this;a.editor=b;a.url=u;a.getInfo=function(){return{longname:"Insert Quote",author:"Telligent",authorurl:"http://telligent.com",
version:"6.5"}};a.dataToDiv=function(a,b){var c=this.editor,f;f=this.editor.dom.create("div",{id:a.id,"class":"mceItem mceNonEditable mceQuote","data-mce-json":t.serialize(a,"'"),contenteditable:"false"});f.innerHTML="...";this.getPreview(a,function(b){var l=c.dom.get(a.id);l&&(l.innerHTML=b)});return f};a.dataToHtml=function(a,b){return this.editor.serializer.serialize(this.dataToDiv(a,b),{forced_root_block:"",force_absolute:b})};a.htmlToData=function(a){var b;b={};(a=this.editor.parser.parse(a).getAll("div")[0])&&
(b=t.parse(a.attr("data-mce-json")));return b};a.divToObject=function(a,b){var c,f;if(c=a.attr("data-mce-json"))c=t.parse(c),c.code&&(f=new q("#text",3),f.raw=!0,f.value=decodeURIComponent(c.code)),f?a.replace(f):a.remove()};a.processQuotesInHtml=function(a,b){for(var c=/(\[quote[^\]]*\][\s\S]*?\[\/quote\])/gi,m=0,n,k=[];n=c.exec(a);){var g=encodeURIComponent(RegExp.$1),g={id:"mceQuote"+f++,code:g};0<n.index&&k.push(a.substr(m,n.index-m));b?k.push('<span id="'+g.id+'" class="mceItem mceNonEditable mceQuote" contenteditable="false" data-mce-json="'+
$.telligent.evolution.html.encode(t.serialize(g,"'"))+'">...</span>'):k.push('<div id="'+g.id+'" class="mceItem mceNonEditable mceQuote" contenteditable="false" data-mce-json="'+$.telligent.evolution.html.encode(t.serialize(g,"'"))+'">...</div>');m=c.lastIndex}m<a.length&&k.push(a.substr(m));return k.join("")};a.getCallbackUrl=function(a){for(var b=this.url+"../../../apis/quotes?",c={},f=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),n=0;n<f.length;n++){var k=f[n].split(/=/);2==
k.length&&(c[k[0]]=k[1])}for(var g in a)c[encodeURIComponent(g)]=encodeURIComponent(a[g]);a=!0;for(g in c)a?a=!1:b+="&",b+=g+"="+c[g];return b};a.getPreview=function(a,b){a.code&&0!=a.code.length?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"p"}),data:"bb="+a.code,content_type:"application/x-www-form-urlencoded",success:function(c){c=tinymce.util.JSON.parse(c);try{c&&c.html?b(c.html):b(decodeURIComponent(a.code))}catch(f){}},error:function(c){try{b(decodeURIComponent(a.code))}catch(f){}}}):b("")};
b.on("PreInit",function(){b.on("BeforeSetContent",function(b){b.content=a.processQuotesInHtml(b.content,b.selection)});b.parser.addNodeFilter("span",function(h){for(var f=h.length;f--;)(function(c){if(-1!==(c.attr("class")||"").indexOf("mceQuote")){var h=c.attr("data-mce-json");h&&(h=t.parse(h),h.code&&window.setTimeout(function(){var c=b.dom.get(h.id),f;if(c){f=document.createElement("div");$(f).attr({id:h.id,"data-mce-json":t.serialize(h,"'"),contenteditable:"false"}).addClass("mceItem mceQuote mceNonEditable").html("...");
if(c.parentNode&&"P"==c.parentNode.nodeName){var g=$.trim(c.parentNode.textContent||"");0!=g.length&&"..."!=g||1!=c.parentNode.children.length?($(c.parentNode).after(f),b.dom.remove(c)):b.dom.replace(f,c.parentNode,!1);$(f).after("<p><br/></p>")}else b.dom.replace(f,c,!1);a.getPreview(h,function(a){var c=b.dom.get(h.id);c&&(c.innerHTML=a)})}},1))}})(h[f])});b.parser.addNodeFilter("div",function(h){for(var f=h.length;f--;)(function(c){if(-1!==(c.attr("class")||"").indexOf("mceQuote")){var h=c.attr("data-mce-json");
h&&(h=t.parse(h),h.code&&a.getPreview(h,function(a){var c=b.dom.get(h.id);c&&(c.innerHTML=a)}))}})(h[f])});b.serializer.addNodeFilter("div",function(b,f,c){f=b.length;for(var m;f--;)m=b[f],-1!==(m.attr("class")||"").indexOf("mceQuote")&&a.divToObject(m,c)})});b.on("ResolveName",function(a){"div"===a.name&&b.dom.hasClass(a.target,"mceQuote")&&(a.name=tinymce.util.I18n.translate("Blockquote"))});b.addButton("removequote",{text:"Remove",onclick:function(){b.dom.remove(b.selection.getNode())}});b.addContextToolbar(function(a){return b.dom.hasClass(a,
"mceQuote")},"removequote")});tinymce.PluginManager.add("source",function(b){function u(){var q=b.windowManager.open({title:"Source code",body:[{type:"textbox",name:"code",multiline:!0,minWidth:b.getParam("code_dialog_width",600),minHeight:b.getParam("code_dialog_height",Math.min(tinymce.DOM.getViewPort().h-200,500)),spellcheck:!1,style:"direction: ltr; text-align: left"},{type:"checkbox",name:"wordwrap",label:"Wrap long lines",checked:!0,onchange:function(b){jQuery(q.find("#code")[0].getEl()).evolutionCodeEditor("wordWrap",
b.control.checked())}}],onSubmit:function(t){b.focus();b.undoManager.transact(function(){b.setContent(t.data.code)});b.selection.setCursorLocation();b.nodeChanged()}});q.find("#code").value(b.getContent({source_view:!0}));jQuery&&jQuery(q.find("#code")[0].getEl()).evolutionCodeEditor({mode:"html",wordWrap:!0})}b.addCommand("mceSourceEditor",u);b.addButton("source",{icon:"code",tooltip:"Source code",onclick:u});b.addMenuItem("source",{icon:"code",text:"Source code",context:"tools",onclick:u})});tinymce.PluginManager.add("submit",
function(b,u){var q=function(b){b.preventDefault();b.stopImmediatePropagation();b.stopPropagation();return!1};tinymce.ui.SubmitPanel=tinymce.ui.PanelButton.extend({init:function(b){this._super(b);this.classes.add("submitpanel");this.classes.remove("btn")},renderHtml:function(){var b=this._id,f=[];f.push('<div id="'+b+'" class="'+this.classes+'" role="presentation" aria-haspopup="false">');this.settings.editor.settings.submit_enabletoggle&&(f.push('<div id="'+b+'_enable_wrapper" class="mce-submitpanel-message">'),
f.push('<input id="'+b+'_enable" type="checkbox" role="presentation" />'),f.push('<label for="'+b+'_enable" tabindex="-1" role="presentation">'+(this.settings.editor.settings.submit_entermessage||"Press enter to send")+"</label>"),f.push("</div>"));f.push('<div class="mce-widget mce-btn mce-primary mce-btn-has-text mce-submitpanel-button" id="'+b+'_send" tabindex="0" role="button"><button style="width:100%; height:100%;" tabindex="-1" type="button"><span class="mce-txt">');f.push(this.settings.editor.settings.submit_buttontext||
"Send");f.push("</span></button></div>");f.push("</div>");return f.join("")},focus:function(){try{var b=$(this.id+"_send",this.getEl());if(0<b.length)return b.focus(),this;var f=$(this.id+"_enable",this.getEl());if(0<f.length)return f.focus(),this}catch(a){}return this},postRender:function(){function b(){var a=!1;l.is(":checked")?(h.css("display","none"),a=!0):(h.css("display","inline-block"),a=!1);null!=window.localStorage&&window.localStorage.setItem("tinymce-entertosubmit",a.toString())}function f(a,
b){for(var c=0;c<b.length;c++)if(a.nodeName==b[c])return!0;return a.parentNode?f(a.parentNode,b):!1}var a=this,h,l,c,m;m=0;c=$("#"+a._id);h=$("#"+a._id+"_send");l=$("#"+a._id+"_enable");cbx_wrapper=$("#"+a._id+"_enable_wrapper");c.closest(".mce-btn-group").css("width","100%").children("div").css("white-space","normal");var n=window["_submit_"+a.settings.editor.id]||null,k,g;n?(k=n.prehtml,g=n.posthtml):(n={},(k=a.settings.editor.settings.submittable_prehtml)&&(k=$(k)),(g=a.settings.editor.settings.submittable_posthtml)&&
(g=$(g)),n.prehtml=k,n.posthtml=g,window["_submit_"+a.settings.editor.id]=n);k&&c.prepend(k);g&&c.append(g);c.find('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').on("keydown keyup",function(a){a.stopPropagation();$(document).trigger("keydown",a)});a.settings.editor.settings.submit_enabletoggle&&(c=a.settings.editor.settings.submit_entertosubmit,null!=window.localStorage&&null!==window.localStorage.getItem("tinymce-entertosubmit")&&(c="true"==window.localStorage.getItem("tinymce-entertosubmit")),
c?(l.removeClass("mce-submitpanel-unchecked").addClass("mce-submitpanel-checked"),l.attr("checked",!0)):l.removeClass("mce-submitpanel-checked").addClass("mce-submitpanel-unchecked"),a.settings.editor.on("keydown",function(b){if(13==b.keyCode&&l.is(":checked")&&!(b.shiftKey||b.altKey||b.metaKey||b.ctrlKey)){var c=(new Date).getTime(),h=a.settings.editor.selection.getNode();if(f(h,["UL","OL","DL"]))m=c;else if(2E3<c-m)return a.settings.editor.settings.submit_onsubmit&&a.settings.editor.settings.submit_onsubmit(a.settings.editor),
q(b)}},!0),l.on("change",function(a){b()}),b());h.on("click",function(b){a.settings.editor.settings.submit_onsubmit&&a.settings.editor.settings.submit_onsubmit(a.settings.editor);return q(b)}).on("keydown",function(b){if(13==b.keyCode&&!(b.shiftKey||b.altKey||b.metaKey||b.ctrlKey))return a.settings.editor.settings.submit_onsubmit&&a.settings.editor.settings.submit_onsubmit(a.settings.editor),q(b)})}});b.on("Init",function(){var q=$(b.getContainer()),f=function(){470<q.width()?q.removeClass("mce-submitpanel-narrow"):
q.addClass("mce-submitpanel-narrow")};q.on("resized",function(){f()});f()});b.addButton("submit",{type:"SubmitPanel",editor:b})});tinymce.PluginManager.add("tinyautosave",function(b,u){function q(){var a=A[this.key];a.timer&&window.clearInterval(a.timer);tinymce.dom.Event.remove(window,"unload",a.saveFinalDelegate);this.editor.onRemove.remove(a.saveFinalDelegate);delete A[this.key]}function t(a){if(!a)return!0;var b,c;b=tinymce.is;if(b(a,"string"))(b=x[a])?c=b[a]:x[a]=c=tinymce.resolve(a);else if(b(a,
"function"))c=a;else return!0;return c.apply(this)}function f(){var a=A[this.key];a.saveDelegate();a.disposeDelegate()}function a(){var a=!1;try{var h=A[this.key],f=tinymce.is,l=new Date,m,n,r,p;if(this.editor&&!h.busy){h.busy=!0;m=b.getContent();if(f(m,"string")&&m.length>=h.minSaveLength){if(!t.call(this,this.onPreSave))return h.busy=!1;n=new Date(l.getTime()+6E4*h.retentionMinutes);try{k?localStorage.setItem(h.dataKey,n.toString()+","+m.replace(/,/g,"&#44;")):g?sessionStorage.setItem(h.dataKey,
n.toString()+","+m.replace(/,/g,"&#44;")):d?(y.setAttribute(A[this.key].dataKey,m),y.expires=n.toUTCString(),y.save("TinyMCE")):(r=h.dataKey+"=",p="; expires="+n.toUTCString(),document.cookie=r+c(m).slice(0,4096-r.length-p.length)+p),a=!0}catch(q){t.call(this,this.onSaveError)}a&&(h.canRestore=!0,t.call(this,this.onPostSave))}h.busy=!1}}catch(s){}return a}function h(){var a=A[this.key],c=null,h=tinymce.is,f,n;if(this.editor&&a.canRestore&&!a.busy){a.busy=!0;if(t.call(this,this.onPreRestore))try{k||
g?(c=((k?localStorage.getItem(a.dataKey):sessionStorage.getItem(a.dataKey))||"").toString(),f=c.indexOf(","),c=-1==f?null:c.slice(f+1,c.length).replace(/&#44;/g,",")):d?c=l(this):(n=a.cookieFilter.exec(document.cookie))&&(c=m(n[1])),h(c,"string")?(b.getContent().replace(/\s|&nbsp;|<\/?p[^>]*>|<br[^>]*>/gi,""),b.setContent(c),t.call(this,this.onPostRestore)):b.windowManager.alert(tinymce.util.I18n.translate("No content was available to restore."))}catch(r){t.call(this,this.onRestoreError)}a.busy=!1}}
function l(a){y.load("TinyMCE");return y.getAttribute(A[a.key].dataKey)}function c(a){return a.replace(/[\x00-\x1f]+|&nbsp;|&#160;/gi," ").replace(/(.)\1{5,}|[%&;=<]/g,function(a){return 1<a.length?"%0"+a.charAt(0)+a.length.toString()+"%":p[a]})}function m(a){return a.replace(/%[1-5]|%0(.)(\d+)%/g,function(a,b,c){var d;if(2==a.length)return r[a];a=[];d=0;for(c=parseInt(c);d<c;d++)a.push(b);return a.join("")})}function n(a,b){return function(){return b.apply(a)}}var k=!1,g=!1,d=!1,p={"%":"%1","&":"%2",
";":"%3","=":"%4","<":"%5"},r={"%1":"%","%2":"&","%3":";","%4":"=","%5":"<"},A={},x={},y=null,v={dataKey:"TinyAutoSave",cookieFilter:null,saveDelegate:null,saveFinalDelegate:null,restoreDelegate:null,disposeDelegate:null,intervalSeconds:60,retentionMinutes:20,minSaveLength:50,canRestore:!1,busy:!1,timer:null};try{localStorage.setItem("TinyAutoSave_Test_","OK"),"OK"===localStorage.getItem("TinyAutoSave_Test_")&&(localStorage.removeItem("TinyAutoSave_Test_"),k=!0)}catch(z){try{sessionStorage.setItem("TinyAutoSave_Test_",
"OK"),"OK"===sessionStorage.getItem("TinyAutoSave_Test_")&&(sessionStorage.removeItem("TinyAutoSave_Test_"),g=!0)}catch(w){d=tinymce.isIE}}var s=this,F=tinymce.is,G=tinymce.resolve,C,D,E;s.editor=b;s.id=b.id;s.url=u;s.key=b.getParam("tinyautosave_key",b.id);C=function(b){var c=b.key,d=A[c];d||(d=A[c]=tinymce.extend({},v,{dataKey:v.dataKey+c,saveDelegate:n(b,a),saveFinalDelegate:n(b,f),restoreDelegate:n(b,h),disposeDelegate:n(b,q),cookieFilter:RegExp("(?:^|;\\s*)"+v.dataKey+c+"=([^;]*)(?:;|$)","i")}));
return d}(s);C.intervalSeconds=Math.max(1,parseInt(b.getParam("tinyautosave_interval_seconds",null)||b.getParam("tinyautosave_interval",C.intervalSeconds)));C.retentionMinutes=Math.max(1,parseInt(b.getParam("tinyautosave_retention_minutes",null)||b.getParam("tinyautosave_retention",C.retentionMinutes)));C.minSaveLength=Math.max(1,parseInt(b.getParam("tinyautosave_minlength",C.minSaveLength)));C.saveDelegate=n(s,a);C.saveFinalDelegate=n(s,f);C.restoreDelegate=n(s,h);b.addCommand("mceTinyAutoSave",
C.saveDelegate);b.addCommand("mceTinyAutoSaveRestore",C.restoreDelegate);b.addMenuItem("tinyautosave",{text:"Restore lost content",icon:"restoredraft",cmd:"mceTinyAutoSaveRestore",context:"tools",prependToContext:!0,onPostRender:function(a){window.setInterval(function(){s.hasSavedContent()?a.control.show():a.control.hide()},250)}});C.timer=window.setInterval(C.saveDelegate,1E3*C.intervalSeconds);b.on("init",function(){d&&(y||(y=b.getElement()),y.style.behavior="url('#default#userData')");C.canRestore=
s.hasSavedContent();D=b.getParam("tinyautosave_oninit",null);F(D,"string")&&(E=G(D),F(E,"function")&&E.apply(s))});s.getInfo=function(){return{longname:"TinyAutoSave",author:"Speednet",authorurl:"http://www.speednet.biz/",infourl:"http://tinyautosave.googlecode.com/",version:"2.1.3"}};s.clear=function(){var a=A[this.key];k?localStorage.removeItem(a.dataKey):g?sessionStorage.removeItem(a.dataKey):d?y.removeAttribute(A[this.key].dataKey):tinymce.util.Cookie.remove(a.dataKey);a.canRestore=!1};s.hasSavedContent=
function(){var a=A[this.key],b=new Date,c,h;try{if(k||g){c=((k?localStorage.getItem(a.dataKey):sessionStorage.getItem(a.dataKey))||"").toString();h=c.indexOf(",");if(8<h&&h<c.length-1){if(new Date(c.slice(0,h))>b)return!0;k?localStorage.removeItem(a.dataKey):sessionStorage.removeItem(a.dataKey)}return!1}return d?0<(l(this)||"").length:0<(tinymce.util.Cookie.get(a.dataKey)||"").length}catch(f){return!1}}});tinymce.PluginManager.add("tips",function(b,u){var q=null,t=[],f=null,a=this;a.isDefaultNode=
function(a){return null==a||"P"==a.nodeName||"BR"==a.nodeName||"BODY"==a.nodeName};a.getRandomDefaultTip=function(){return 0==t.length?"":1==t.length?t[0]:t[Math.round(Math.random()*(t.length-1))]};a.updateTip=function(a,b){b&&(f=b);q&&q.text(a)};b.addCommand("mceTip",function(h,f){a.updateTip(f,b.selection.getNode()||"unknown");return!0});b.on("NodeChange",function(){var h=b.selection.getNode()||{nodeName:"P"};f&&f!=h&&(a.isDefaultNode(h)?a.updateTip(a.getRandomDefaultTip(),h):a.updateTip("",h))},
!0);b.on("init",function(){q=jQuery('<div class="mce-first mce-flow-layout-item"></div>').css({padding:"8px",color:"rgba(0,0,0,.33)"});jQuery(".mce-container-body .mce-path",b.getContainer()).before(q);var h=b.selection.getNode()||{nodeName:"P"};a.isDefaultNode(h)&&a.updateTip(a.getRandomDefaultTip(),h)});return{defaultTip:function(h){t.push(h);h=b.selection.getNode()||{nodeName:"P"};a.isDefaultNode(h)&&a.updateTip(a.getRandomDefaultTip(),h)}}});tinymce.PluginManager.add("tokens",function(b,u){var q=
tinymce.html.Node,t=tinymce.util.JSON,f=0,a=this;a.editor=b;a.url=u;a.isToken=function(a){var b=this;if(!a)return!1;if(b.editor.dom.hasClass(a,"mceTokenItem"))return a;a=b.editor.dom.getParent(a,function(a){return b.editor.dom.hasClass(a,"mceTokenItem")});return null!=a?a:!1};a.openDialog=function(){function a(){var b=$(y.getEl());$(".mce-primary button",b).attr("disabled","disabled");E=new tinymce.Editor(w,$.extend({},x.editor.settings,{selector:null,width:600,height:330,resize:!1}),tinymce.EditorManager);
E.render();D=x.getTokens(G);var h=$(".mcetoken-token",b);$.each(D,function(){var a=$('<option value="'+this.id.toLowerCase()+'"></option>');a.text(this.name);a.data("token",this);h.append(a)});h.on("change",function(){n()});$(".mcetoken-linkurltarget, .mcetoken-imageurlwidth, .mcetoken-imageurlheight, .mcetoken-truncateat, .mcetoken-conditionvalue, .mcetoken-maxcount",b).on("change",function(){f()});$(".mcetoken-imageurlwidth, .mcetoken-imageurlheight, .mcetoken-truncateat, .mcetoken-conditionvalue, .mcetoken-maxcount",
b).on("keyup",function(){f()});$(".mcetoken-truncate",b).on("change",function(){p()});$(".mcetoken-condition",b).on("change",function(){k()});$(".mcetoken-conditiontemplate",b).on("change",function(){g()});$(".mcetoken-template",b).on("change",function(){d()});c(!0)}function b(a){var c={};a=(a||"").split(/&/g);for(var d=0;d<a.length;d++){var h=a[d].split("=");2==h.length&&(c[decodeURIComponent(h[0])]=decodeURIComponent(h[1]).replace(/\+/g," "))}return c}function c(a,c){var h=$(y.getEl());if(a){if(q.tokenId){u=
null;for(var g=0;g<D.length&&!u;g++)D[g].id.toLowerCase()==q.tokenId.toLowerCase()&&(u=D[g]);if(u){$(".mcetoken-token",h).val(u.id.toLowerCase());n();g=b(q.configuration);if("container"==u.type)g["max-characters"]&&(s["after-truncation-template"]=g["after-truncation-template"]||"",$(".mcetoken-truncate",h).val("maxlength"),$(".mcetoken-truncateat",h).val(g["max-characters"]),p()),s["sub-template"]=g["sub-template"]||"";else if("enumerable"==u.type)$(".mcetoken-maxcount",h).val(g["max-count"]||"10"),
s["item-template"]=g["item-template"]||"",s["empty-template"]=g["empty-template"]||"",s["before-template"]=g["before-template"]||"",s["after-template"]=g["after-template"]||"";else if("linkurl"==u.type){var f=b(g["tag-attributes"]);"_blank"==f.target&&$(".mcetoken-linkurltarget",h).val("_blank");s["title-template"]=g["title-template"]||"";s["internal-template"]=g["internal-template"]||""}else"imageurl"==u.type?(f=b(g["tag-attributes"]),$(".mcetoken-imageurlwidth",h).val(f.width||""),$(".mcetoken-imageurlheight",
h).val(f.height||""),s["title-template"]=g["title-template"]||""):(g["max-characters"]&&(s["after-truncation-template"]=g["after-truncation-template"]||"",$(".mcetoken-truncate",h).val("maxlength"),$(".mcetoken-truncateat",h).val(g["max-characters"]),p()),g["comparison-type"]&&($(".mcetoken-condition",h).val(g["comparison-type"]),f=g["comparison-value"]||"",/\$\{[^\}]+\}/.test(f)?($(".mcetoken-conditiontemplate",h).val("template"),$(".mcetoken-conditionvalue",h).val(""),s["comparison-value"]=f):($(".mcetoken-conditiontemplate",
h).val("simple"),$(".mcetoken-conditionvalue",h).val(f)),s["true-template"]=g["true-template"]||"",s["false-template"]=g["false-template"]||"",k()));d(!1)}}u||n()}else if(u){q.tokenId=u.id;g={};d();if("container"==u.type)"maxlength"==$(".mcetoken-truncate",h).val()&&(g["max-characters"]=parseInt($(".mcetoken-truncateat",h).val(),10),g["after-truncation-template"]=s["after-truncation-template"]||""),g["sub-template"]=s["sub-template"]||"";else if("enumerable"==u.type)g["max-count"]=parseInt($(".mcetoken-maxcount",
h).val(),10),g["item-template"]=s["item-template"]||"",g["empty-template"]=s["empty-template"]||"",g["before-template"]=s["before-template"]||"",g["after-template"]=s["after-template"]||"";else if("linkurl"==u.type)f={},"_blank"==$(".mcetoken-linkurltarget",h).val()&&(f.target="_blank"),g["tag-attributes"]=$.param(f),g["title-template"]=s["title-template"]||"",g["internal-template"]=s["internal-template"]||"";else if("imageurl"==u.type){var f={},m=parseInt($(".mcetoken-imageurlwidth",h).val(),10);
isNaN(m)||(f.width=m);m=parseInt($(".mcetoken-imageurlheight",h).val(),10);isNaN(m)||(f.height=m);g["tag-attributes"]=$.param(f);g["title-template"]=s["title-template"]||""}else"maxlength"==$(".mcetoken-truncate",h).val()&&(g["max-characters"]=parseInt($(".mcetoken-truncateat",h).val(),10),g["after-truncation-template"]=s["after-truncation-template"]||""),""!=$(".mcetoken-condition",h).val()&&(g["comparison-type"]=$(".mcetoken-condition",h).val(),"simple"==$(".mcetoken-conditiontemplate",h).val()?
g["comparison-value"]=$(".mcetoken-conditionvalue",h).val():g["comparison-value"]=s["comparison-value"]||"",g["true-template"]=s["true-template"]||"",g["false-template"]=s["false-template"]||"");q.configuration=$.param(g)}else q.tokenId=null,q.configuration=null}function f(){var a=$(y.getEl()),b=!0;"maxlength"==$(".mcetoken-truncate",a).val()&&(isNaN(parseInt($(".mcetoken-truncateat",a).val(),10))||1>parseInt($(".mcetoken-truncateat",a).val(),10))&&(b=!1);null!=u&&"enumerable"==u.type&&(isNaN(parseInt($(".mcetoken-maxcount",
a).val(),10))||1>parseInt($(".mcetoken-maxcount",a).val(),10))&&(b=!1);null!=u&&"imageurl"==u.type&&(0<$(".mcetoken-imageurlwidth",a).val().length&&(isNaN(parseInt($(".mcetoken-imageurlwidth",a).val(),10))||0>parseInt($(".mcetoken-imageurlwidth",a).val(),10))&&(b=!1),0<$(".mcetoken-imageurlheight",a).val().length&&(isNaN(parseInt($(".mcetoken-imageurlheight",a).val(),10))||0>parseInt($(".mcetoken-imageurlheight",a).val(),10))&&(b=!1));b?$(".mce-primary button",a).removeAttr("disabled"):$(".mce-primary button",
a).attr("disabled","disabled")}function n(){var a=$(y.getEl());s={};q.tokenId=$(".mcetoken-token",a).val();if(q.tokenId){u=null;for(var b=0;b<D.length&&!u;b++)D[b].id.toLowerCase()==q.tokenId.toLowerCase()&&(u=D[b])}else u=null;u?"container"==u.type?(b=$(".mcetoken-template",a),b.html(""),b.append($('<option value="sub-template">'+tinymce.util.I18n.translate("Content")+"</option>")),$(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).show(),$(".mcetoken-truncationcontainer",
a).show(),$(".mcetoken-maxcountcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",a).hide(),$(".mcetoken-truncate",a).val(""),d(!1)):"enumerable"==u.type?(b=$(".mcetoken-template",a),b.html(""),b.append($('<option value="item-template">'+tinymce.util.I18n.translate("Each item")+"</option>")),b.append($('<option value="empty-template">'+tinymce.util.I18n.translate("No items")+"</option>")),b.append($('<option value="before-template">'+tinymce.util.I18n.translate("Before all items")+
"</option>")),b.append($('<option value="after-template">'+tinymce.util.I18n.translate("After all items")+"</option>")),$(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).show(),$(".mcetoken-truncationcontainer",a).hide(),$(".mcetoken-maxcountcontainer",a).show(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",a).hide(),$(".mcetoken-maxcount",a).val("10"),$(".mcetoken-truncate",a).val(""),d(!1)):"linkurl"==u.type?(b=$(".mcetoken-template",
a),b.html(""),b.append($('<option value="internal-template">'+tinymce.util.I18n.translate("Content")+"</option>")),b.append($('<option value="title-template">'+tinymce.util.I18n.translate("Title text")+"</option>")),$(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).show(),$(".mcetoken-truncationcontainer",a).hide(),$(".mcetoken-maxcountcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",a).show(),$(".mcetoken-linkurltarget",
a).val(""),d(!1)):"imageurl"==u.type?(b=$(".mcetoken-template",a),b.html(""),b.append($('<option value="title-template">'+tinymce.util.I18n.translate("Title text")+"</option>")),$(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).show(),$(".mcetoken-truncationcontainer",a).hide(),$(".mcetoken-maxcountcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).show(),$(".mcetoken-linkurltargetcontainer",a).hide(),$(".mcetoken-imageurlwidth",a).val(""),$(".mcetoken-imageurlheight",
a).val(""),d(!1)):(b=$(".mcetoken-template",a),b.html(""),$(".mcetoken-conditioncontainer",a).show(),$(".mcetoken-condition",a).val(""),$(".mcetoken-conditionvalue",a).hide(),$(".mcetoken-conditionvalue",a).val(""),$(".mcetoken-conditiontemplate",a).val("simple"),$(".mcetoken-conditiontemplate",a).hide(),$(".mcetoken-templatecontainer",a).hide(),$(".mcetoken-truncationcontainer",a).show(),$(".mcetoken-maxcountcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",
a).hide(),$(".mcetoken-truncate",a).val("")):($(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).hide(),$(".mcetoken-truncationcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",a).hide(),$(".mcetoken-truncate",a).val(""));f();r()}function k(){var a=$(y.getEl());if($(".mcetoken-condition",a).val()){var b=$(".mcetoken-template",a);$('.mcetoken-template option[value="true-template"]',a).remove();$('.mcetoken-template option[value="false-template"]',
a).remove();b.append($('<option value="true-template">'+tinymce.util.I18n.translate("Vary condition is true")+"</option>"));b.append($('<option value="false-template">'+tinymce.util.I18n.translate("Vary condition is false")+"</option>"));2==$(".mcetoken-template option",a).length?($(".mcetoken-templatecontainer",a).show(),d(!1)):d();$(".mcetoken-conditiontemplate",a).show();g()}else $('.mcetoken-template option[value="true-template"]',a).remove(),$('.mcetoken-template option[value="false-template"]',
a).remove(),0==$(".mcetoken-template option",a).length?$(".mcetoken-templatecontainer",a).hide():d(),$(".mcetoken-conditiontemplate",a).hide(),$(".mcetoken-conditionvalue",a).hide();f();r()}function g(){var a=$(y.getEl());"simple"==$(".mcetoken-conditiontemplate",a).val()?($('.mcetoken-template option[value="comparison-value"]',a).remove(),$(".mcetoken-conditionvalue").show(),0==$(".mcetoken-template option",a).length?$(".mcetoken-templatecontainer").hide():d()):($('.mcetoken-template option[value="comparison-value"]',
a).remove(),$(".mcetoken-conditionvalue",a).hide(),$(".mcetoken-template",a).append($('<option value="comparison-value">'+tinymce.util.I18n.translate("Condition comparison value")+"</option>")),1==$(".mcetoken-template option",a).length?($(".mcetoken-templatecontainer",a).show(),d(!1)):d());r()}function d(a){var b=$(y.getEl());if(!1!==a&&C)try{var c=E.getContent();if(result=/^<p>((?:(?!<p(?: |>)).)*)<\/p>$/.exec(c))c=RegExp.$1;s[C]=c}catch(h){}C=$(".mcetoken-template",b).val();a=$.merge([],G);if(("item-template"==
C||"after-truncation-template"==C||"sub-template"==C)&&u&&u.dataTypeIds&&0<u.dataTypeIds.length)for(b=0;b<u.dataTypeIds.length;b++){for(var c=!1,g=0;g<a.length&&!c;g++)a[g].toLowerCase()==u.dataTypeIds[b].toLowerCase()&&(c=!0);c||a.push(u.dataTypeIds[b])}E.settings.tokenDataTypeIds=a;a="";s[C]&&(a=s[C]);b=!1;try{E.setContent(a),""!=a&&""==E.getContent()&&(b=!0)}catch(l){b=!0}b&&window.setTimeout(function(){d(!1)},199);f()}function p(){var a=$(y.getEl());"maxlength"==$(".mcetoken-truncate",a).val()?
($(".mcetoken-truncationlengthcontainer",a).show(),$(".mcetoken-template",a).append($('<option value="after-truncation-template">'+tinymce.util.I18n.translate("After length limited")+"</option>")),1==$(".mcetoken-template option",a).length?($(".mcetoken-templatecontainer",a).show(),d(!1)):d()):($(".mcetoken-truncationlengthcontainer",a).hide(),$('.mcetoken-template option[value="after-truncation-template"]',a).remove(),0==$(".mcetoken-template option",a).length?$(".mcetoken-templatecontainer",a).hide():
d());f();r()}function r(){var a=y.items().toArray()[0],b=0,c=0;$("table.mcetelligent-form, div.mcetoken-templatecontainer",$(y.getEl())).each(function(){var a=$(this);a.is(":visible")&&(b<a.width()&&(b=a.width()),c+=a.height())});b+=40;c+=120;a.reflow();y.resizeTo(b,c)}var q,x=this,y,v="Insert token",z=x.isToken(x.editor.selection.getStart());z||(z=x.isToken(x.editor.selection.getEnd()));z&&(q=x.editor.dom.getAttrib(z,"data-mce-json"))&&(q=t.parse(q),v="Edit token");q||(q={id:"mceToken"+(new Date).getTime(),
tokenId:"",configuration:""});var w="editor"+(new Date).getTime(),s={},u=null,G=x.editor.settings.tokenDataTypeIds||[],C=null,D=null,E=null;y=x.editor.windowManager.open({title:tinymce.util.I18n.translate(v),body:[{type:"container",html:'<table role="presentation" border="0" cellpadding="4" cellspacing="0" class="mcetelligent-form"><tr>         <td><label for="token">'+tinymce.util.I18n.translate("Show")+'</label></td>          <td>            <select id="token" class="mce-textbox mcetoken-token" name="type">            </select>          </td>        </tr>                   <tr class="mcetoken-linkurltargetcontainer" style="display: none;">                      <td><label for="linkurltarget">'+
tinymce.util.I18n.translate("Open in")+'</label></td>                      <td>                          <select class="mce-textbox mcetoken-linkurltarget" id="linkurltarget" name="linkurltarget">                              <option value="">'+tinymce.util.I18n.translate("The current window")+'</option>                              <option value="_blank">'+tinymce.util.I18n.translate("A new window")+'</option>                          </select>                      </td>                  </tr>                  <tr id="imageurlsizecontainer" class="mcetoken-imageurlsizecontainer" style="display: none;">                      <td><label for="imageurlwidth">'+
tinymce.util.I18n.translate("With size")+'</label></td>                      <td>                          <input id="imageurlwidth" class="mce-textbox mcetoken-imageurlwidth" name="imageurlwidth" type="text" value="" columns="4" style="width: 5em;" />'+tinymce.util.I18n.translate("x")+'                          <input id="imageurlheight" class="mce-textbox mcetoken-imageurlheight" name="imageurlheight" type="text" value="" columns="4" style="width: 5em;" />                      </td>                  </tr>                  <tr id="truncationcontainer" class="mcetoken-truncationcontainer" style="display: none;">                      <td><label for="truncate">'+
tinymce.util.I18n.translate("With")+'</label></td>                      <td>                          <select id="truncate" class="mce-textbox mcetoken-truncate" name="type">                              <option value="">'+tinymce.util.I18n.translate("Unlimited length")+'</option>                              <option value="maxlength">'+tinymce.util.I18n.translate("Length limited to:")+'</option>            </select>                          <span id="truncationlengthcontainer" class="mcetoken-truncationlengthcontainer" style="display: none;">                              <input id="truncateat" class="mcetoken-truncateat mce-textbox" name="truncateat" type="text" value="" columns="4" style="width: 5em;" />                              <label for="truncateat">'+
tinymce.util.I18n.translate("characters")+'</label>                          </span>                      </td>                  </tr>        <tr id="conditioncontainer" class="mcetoken-conditioncontainer" style="display: none;">          <td><label for="condition">'+tinymce.util.I18n.translate("Varied")+'</label></td>          <td>                          <select id="condition" class="mce-textbox mcetoken-condition" name="type">                              <option value="">'+tinymce.util.I18n.translate("By nothing (render value directly)")+
'</option>                              <option value="e">'+tinymce.util.I18n.translate("When equal to")+'</option>                              <option value="lt">'+tinymce.util.I18n.translate("When less than")+'</option>                              <option value="lte">'+tinymce.util.I18n.translate("When less than or equal to")+'</option>                              <option value="gt">'+tinymce.util.I18n.translate("When greater than")+'</option>                              <option value="gte">'+
tinymce.util.I18n.translate("When greater than or equal to")+'</option>            </select>                          <select id="conditiontemplate" class="mce-textbox mcetoken-conditiontemplate">                              <option value="simple">'+tinymce.util.I18n.translate("value:")+'</option>                              <option value="template">'+tinymce.util.I18n.translate("condition template")+'</option>                          </select>                          <input id="conditionvalue" class="mce-textbox mcetoken-conditionvalue" name="conditionvalue" type="text" value="" style="width: 8em;" />          </td>        </tr>                  <tr id="maxcountcontainer" class="mcetoken-maxcountcontainer" style="display: none;">                      <td><label for="maxcount">'+
tinymce.util.I18n.translate("Limited to")+'</label></td>                      <td>                          <input id="maxcount" class="mce-textbox mcetoken-maxcount" name="maxcount" type="text" value="" style="width: 5em;" />                          '+tinymce.util.I18n.translate("items")+'                      </td>                  </tr>                <tr class="mcetoken-templatecontainer">                  <td><label for="template">'+tinymce.util.I18n.translate("Template")+'</label></td>                  <td>                        <select id="template" class="mce-textbox mcetoken-template" name="template">                        </select>                  </td>                </tr></table><div class="mcetoken-templatecontainer" style="width:600px; height:500px;"> <textarea id="'+
w+'"></textarea></div>'}],buttons:[{text:"Ok",onclick:function(){q.id&&(f(),c(!1,void 0),x.editor.execCommand("mceRepaint"),z&&x.editor.selection.select(z),x.editor.selection.setNode(x.dataToNode(q)),x.editor.nodeChanged(),y.close())},subtype:"primary"},{text:"Cancel",onclick:function(){y.close()}}]});window.setTimeout(function(){a()},10)};a.dataToNode=function(a,b){var c=this.editor,f;f=this.editor.dom.create("span",{id:a.id,"class":"mceItem mceTokenItem mceNonEditable","data-mce-json":t.serialize(a,
"'"),contenteditable:"false"},tinymce.util.I18n.translate("???"));this.getPreview(a,function(b,f){var g=c.dom.get(a.id);if(g)if(f){var d=c.dom.create("div",{id:a.id,"class":"mceItem mceTokenItem mceNonEditable","data-mce-json":t.serialize(a,"'"),contenteditable:"false"},b);g.parentNode.replaceChild(d,g)}else g.innerHTML=b});return f};a.dataToHtml=function(a,b){return this.editor.serializer.serialize(this.dataToNode(a,b),{forced_root_block:"",force_absolute:b})};a.htmlToData=function(a){var b,c;c=
{};a=this.editor.parser.parse(a);(b=a.getAll("span")[0])?c=t.parse(b.attr("data-mce-json")):(b=a.getAll("div")[0])&&(c=t.parse(b.attr("data-mce-json")));return c};a.nodeToObject=function(a,b){var c,f;if(c=a.attr("data-mce-json"))c=t.parse(c),c.tokenId&&(f=new q("#text",3),f.raw=!0,f.value="${token:"+c.tokenId,c.configuration&&(f.value+=":"+c.configuration),f.value+="}"),f?a.replace(f):a.remove()};a.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-
1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};a.textToObject=function(a){var b=this,c=b.editor;if(a.parent){for(var m=new q("div"),n=/\$\{token:([0-9a-f]{8,8}-[0-9a-f]{4,4}-[0-9a-f]{4,4}-[0-9a-f]{4,4}-[0-9a-f]{12,12})(?::([^}]*))?\}/gi,k,g=0;k=n.exec(a.value);)(function(){var d={id:"mceToken"+(new Date).getTime()+("v"+f++),tokenId:RegExp.$1,configuration:RegExp.$2?RegExp.$2:""};if(0<k.index)for(var n=c.parser.parse(b.resolveWhitespace(a.value.substr(g,k.index-g))),n=n.getAll("p"),p=0;p<n.length;p++)for(var u;null!=
(u=n[p].walk());)m.append(u);p=new q("span",1);m.append(p);p.attr({id:d.id,"class":"mceItem mceTokenItem mceNonEditable","data-mce-json":t.serialize(d,"'"),contenteditable:"false"});n=new q("#text",3);n.raw=!0;n.value=tinymce.util.I18n.translate("???");p.append(n);(function(a){b.getPreview(a,function(b,g){var h=c.dom.get(a.id);if(h){if(g){var f=c.dom.create("div",{id:d.id,"class":"mceItem mceTokenItem mceNonEditable","data-mce-json":t.serialize(d,"'"),contenteditable:"false"},b);h.parentNode.replaceChild(f,
h)}else h.innerHTML=b;c.undoManager.clear();c.undoManager.add()}})})(d)})(),g=n.lastIndex;if(0<g){if(g<a.value.length)for(var n=c.parser.parse(b.resolveWhitespace(a.value.substr(g))).getAll("p"),d=0;d<n.length;d++)for(var p;null!=(p=n[d].walk());)m.append(p);a.replace(m);m.unwrap()}}};a.cancelEvent=function(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();return!1};a.getCallbackUrl=function(b){for(var f=a.url+"../../../apis/tokens?",c={},m=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),
n=0;n<m.length;n++){var k=m[n].split(/=/);2==k.length&&(c[k[0]]=k[1])}for(var g in b)c[encodeURIComponent(g)]=encodeURIComponent(b[g]);b=!0;for(g in c)b?b=!1:f+="&",f+=g+"="+c[g];return f};a.getTokens=function(b){var f=[];tinymce.util.XHR.send({url:a.getCallbackUrl({t:"lt"}),data:"dataTypeIds="+(b||[]).join(","),content_type:"application/x-www-form-urlencoded",async:!1,success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.tokens&&(f=a.tokens)}catch(b){}},error:function(a){alert(tinymce.util.I18n.translate("An error occurred while retrieving tokens."))}});
return f};a.getPreview=function(b,f){var c="${token:"+b.tokenId;b.configuration&&(c+=":"+b.configuration);c+="}";tinymce.util.XHR.send({url:a.getCallbackUrl({t:"pt"}),data:"token="+encodeURIComponent(c),content_type:"application/x-www-form-urlencoded",success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.preview?f(a.preview,"true"==a.block):f("???",!1)}catch(b){f("???",!1)}},error:function(a){f("???",!1)}})};b.on("PreInit",function(){b.parser.addNodeFilter("#text",function(b){for(var f=b.length;f--;)a.textToObject(b[f])});
b.serializer.addNodeFilter("div",function(b,f,c){f=b.length;for(var m;f--;)m=b[f],-1!==(m.attr("class")||"").indexOf("mceTokenItem")&&a.nodeToObject(m,c)});b.serializer.addNodeFilter("span",function(b,f,c){f=b.length;for(var m;f--;)m=b[f],-1!==(m.attr("class")||"").indexOf("mceTokenItem")&&a.nodeToObject(m,c)});b.on("dblclick",function(f){(f=a.isToken(b.selection.getStart()))||(f=a.isToken(b.selection.getEnd()));if(!1!==f)return a.openDialog(),!1})});b.addCommand("mceToken",function(){a.openDialog()});
b.addCommand("mceTokenRemove",function(){var f;f=b.selection.getNode();(f=a.isToken(f))&&b.dom.remove(f,!1)});b.on("ResolveName",function(b){!1!==a.isToken(b.target)&&(b.name=tinymce.util.I18n.translate("token"))});b.addMenuItem("removetoken",{text:"Remove token",cmd:"mceTokenRemove",stateSelector:"span.mceToken",context:"edit",prependToContext:!0,onPostRender:function(f){f.control.hide();b.on("NodeChange",function(){var l=b.selection.getNode();!1!==a.isToken(l)?f.control.show():f.control.hide()},
!0)}});b.addMenuItem("edittoken",{text:"Edit token",icon:"code",cmd:"mceToken",context:"edit",prependToContext:!0,onPostRender:function(f){f.control.hide();b.on("NodeChange",function(){var l=b.selection.getNode();!1!==a.isToken(l)?f.control.show():f.control.hide()},!0)}});b.addMenuItem("token",{text:"Insert token",icon:"code",cmd:"mceToken",context:"insert",prependToContext:!0});b.addButton("edittoken",{text:"Edit",cmd:"mceToken"});b.addButton("removetoken",{text:"Remove",onclick:function(){b.dom.remove(b.selection.getNode())}});
b.addContextToolbar(function(b){return a.isToken(b)},"edittoken removetoken")})})();
